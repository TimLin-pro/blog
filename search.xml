<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[„ÄêËØë„ÄëBinder Âíå WindowToken]]></title>
    <url>%2Fblog%2F2020%2F06%2F13%2F%E3%80%90%E8%AF%91%E3%80%91Binders-%E5%92%8C-Window%20Tokens%2F</url>
    <content type="text"><![CDATA[ÂéüÊñáÈìæÊé•Ôºöhttps://www.androiddesignpatterns.com/2013/07/binders-window-tokens.html ÂâçË®Ä Android Á≥ªÁªüÁöÑÊ†∏ÂøÉËÆæËÆ°ÁõÆÊ†á‰πã‰∏ÄÊòØÊèê‰æõ‰∏Ä‰∏™ÂºÄÊîæÂπ≥Âè∞ÔºåËøô‰∏™Âπ≥Âè∞‰∏ç‰æùËµñ‰∏≠Â§ÆÊú∫ÊûÑÊù•È™åËØÅÂ∫îÁî®Á®ãÂ∫èÊòØ‰∏çÊòØÁúüÂÉèÂÆÉ‰ª¨ÂØπÂ§ñÂÆ£Áß∞ÁöÑÈÇ£Ê†∑ËøêË°å„ÄÇ ‰∏∫‰∫ÜÂÆûÁé∞Ëøô‰∏™ÁõÆÊ†áÔºåAndroid ‰ΩøÁî®Â∫îÁî®Á®ãÂ∫èÊ≤ôÁÆ±‰ª•Âèä Linux ËøõÁ®ãÈöîÁ¶ª Êù•Èò≤Ê≠¢Â∫îÁî®Á®ãÂ∫è‰ª•‰∏çÂèóÊéßÂà∂ÊàñËÄÖ‰∏çÂÆâÂÖ®ÁöÑÊñπÂºèËÆøÈóÆÁ≥ªÁªüÊàñÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫è „ÄÇ ÈÄâÊã©ËØ•‰ΩìÁ≥ªÁªìÊûÑÊó∂Ë¶ÅÂêåÊó∂ËÄÉËôëÂºÄÂèë‰∫∫ÂëòÂíåËÆæÂ§áÁî®Êà∑ÔºöÂèåÊñπÈÉΩ‰∏çÈúÄË¶Å‰∏∫Ê≠§ÈááÁî®È¢ùÂ§ñÁöÑÊ≠•È™§Êù• ‰øùÊä§ËÆæÂ§áÂÖçÂèóÊÅ∂ÊÑèÂ∫îÁî®Á®ãÂ∫èÁöÑ‰æµÂÆ≥„ÄÇ Á≥ªÁªüÂ∫îËØ•Â∏ÆÊàë‰ª¨Ëá™Âä®Â§ÑÁêÜÂ•ΩËøô‰∏ÄÂàá„ÄÇ ÂæàÈïøÊó∂Èó¥‰ª•Êù•ÔºåÊàë‰∏ÄÁõ¥Â∞ÜËøôÁßçÂÆâÂÖ®ÁúãÊàêÊòØÁêÜÊâÄÂΩìÁÑ∂ÁöÑÔºåËÄåÊ≤°ÊúâÂÆåÂÖ®‰∫ÜËß£ÂÆÉÁöÑÂÆûÈôÖËøêË°åÊñπÂºè„ÄÇ ‰ΩÜÊòØÊúÄËøëÊàëÂèòÂæóÂ•ΩÂ•á‰∫Ü„ÄÇ Âì™ÁßçÊú∫Âà∂ËÉΩÂ§üÈòªÊ≠¢ÊàëÂπ≤‰∏ãÈù¢Ëøô‰∫õÂùè‰∫ãÂë¢„ÄÇ‰æãÂ¶ÇÔºåÊ¨∫È™óÁ≥ªÁªüËÆ©ÂÆÉÈáäÊîæÂè¶‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫èËé∑ÂèñÁöÑÂî§ÈÜíÈîÅÔºåÊàñËÄÖÊòØÊääÂè¶‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫èÁöÑ Window ‰ªéÂ±èÂπïÈöêËóèÊéâÔºü Êõ¥ÊôÆÈÅçÂú∞ÔºåAndroid ÁöÑÊ†∏ÂøÉÁ≥ªÁªüÊúçÂä° ÊòØÊÄé‰πàÂÆûÁé∞Êó¢È´òÊïàÂèàÂÆâÂÖ®Âú∞ÂìçÂ∫îÁ¨¨‰∏âÊñπÂ∫îÁî®Á®ãÂ∫èÂèëÂá∫ÁöÑËØ∑Ê±ÇÁöÑÔºü ËÆ©ÊàëÂêÉÊÉäÁöÑÊòØÔºåÂá†‰πéÊâÄÊúâÈóÆÈ¢òÁöÑÁ≠îÊ°àÈÉΩÈùûÂ∏∏ÁÆÄÂçïÔºöBinder„ÄÇ Binders ÊòØ Android ‰ΩìÁ≥ªÁªìÊûÑÁöÑÂü∫Áü≥Ôºõ ‰ªñ‰ª¨‰ªéÂºÄÂèë‰∫∫ÂëòÈÇ£ÈáåÊäΩË±° IPC ÁöÑÂ∫ïÂ±ÇÁªÜËäÇÔºåËÆ©Â∫îÁî®Á®ãÂ∫èÂèØ‰ª•ÂæàÁÆÄÂçïÂú∞Ë∑üÁ≥ªÁªüÊúçÂä° ‰ª•ÂèäÂÖ∂‰ªñËøúÁ®ãÊúçÂä°ÁªÑ‰ª∂ËøõË°åÈÄö‰ø°„ÄÇ ‰ΩÜÊòØ Binders ËøòÊúâËÆ∏Â§öÂÖ∂‰ªñÂæàÈÖ∑ÁöÑÁâπÊÄßÔºåÂÆÉ‰ª¨‰ª•ÂêÑÁßçÂ∑ßÂ¶ôÁöÑÊñπÂºèÂú®Êï¥‰∏™Á≥ªÁªü‰∏≠ÂæóÂà∞‰∫ÜÂπøÊ≥õ‰ΩøÁî®Ôºå‰ΩøÊ°ÜÊû∂ËÉΩÂ§üÊõ¥ÂÆπÊòìËß£ÂÜ≥ÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ ËøôÁØáÊñáÁ´†‰∏ªË¶ÅËØ¶ÁªÜ‰ªãÁªçÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∏™ÁâπÈúÄÁâπÊÄß‚Äî‚ÄîBinder Tokens Binder Tokens Binder ÂØπË±°ÁöÑ‰∏Ä‰∏™ÊúâË∂£ÁâπÊÄßÊòØÔºåÊØè‰∏™ binder ÂÆû‰æãÂú®Á≥ªÁªü‰∏≠ÊâÄÊúâËøõÁ®ã‰πãÈó¥ÈÉΩ‰øùÊåÅÂîØ‰∏ÄÁöÑË∫´‰ªΩÔºåÊó†ËÆ∫ÂÆÉË∑®Ë∂äÂ§öÂ∞ëËøõÁ®ãËæπÁïåÊàñÂà∞Ëææ‰ΩïÂ§Ñ„ÄÇ Ëøô‰∏™ÂäüËÉΩÊòØ Binder ÂÜÖÊ†∏È©±Âä®Á®ãÂ∫èÊèê‰æõÁöÑÔºåËøô‰∏™È©±Âä®Á®ãÂ∫èÂàÜÊûêÊØè‰∏™ Binder ‰∫ãÂä°ÁöÑÂÜÖÂÆπÔºåÂπ∂‰∏∫ÂÖ∂ÁúãÂà∞ÁöÑÊØè‰∏™ Binder ÂØπË±°ÂàÜÈÖç‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑ 32 ‰ΩçÊï¥Êï∞ÂÄº„ÄÇ ‰∏∫‰∫ÜÁ°Æ‰øù Java ÁöÑ==ËøêÁÆóÁ¨¶ÈÅµÂÆà Binder ÂîØ‰∏ÄÁöÑÔºåË∑®ËøõÁ®ãÁöÑÂØπË±°Ê†áËØÜÂçèÂÆöÔºåÂØπ Binder ÁöÑÂØπË±°ÂºïÁî®ÁöÑÂØπÂæÖ‰∏éÂÖ∂‰ªñÂØπË±°ÁöÑÂØπÂæÖÊúâÊâÄ‰∏çÂêå„ÄÇ ÂÖ∑‰ΩìÊù•ËØ¥ÔºåÊØè‰∏™ Binder ÁöÑÂØπË±°ÂºïÁî®ÈÉΩË¢´ÂàÜÈÖç‰∫Ü 1„ÄÅÊåáÂêëÂêå‰∏ÄËøõÁ®ã‰∏≠ÁöÑ Binder ÂØπË±°ÁöÑËôöÊãüÂÜÖÂ≠òÂú∞ÂùÄÔºåÊàñËÄÖ 2„ÄÅÂîØ‰∏ÄÁöÑ 32 ‰ΩçÂè•ÊüÑÔºàÁî± Binder ÂÜÖÊ†∏È©±Âä®Á®ãÂ∫èÂàÜÈÖçÔºâÔºåÂú®‰∏çÂêåÁöÑËøáÁ®ã‰∏≠ÊåáÂêë Binder ÁöÑËôöÊãüÂÜÖÂ≠òÂú∞ÂùÄ„ÄÇ Binder ÂÜÖÊ†∏È©±Âä®Á®ãÂ∫è‰ºö‰∏∫ÂÖ∂ÁúãÂà∞ÁöÑÊØè‰∏™ Binder Áª¥Êä§Êú¨Âú∞Âú∞ÂùÄÂà∞ËøúÁ®ã Binder Âè•ÊüÑÁöÑÊò†Â∞ÑÔºàÂèç‰πã‰∫¶ÁÑ∂ÔºâÔºåÂπ∂‰∏∫ÊØè‰∏™ Binder ÁöÑÂØπË±°ÂºïÁî®ÂàÜÈÖçÈÄÇÂΩìÁöÑÂÄºÔºå‰ª•Á°Æ‰øùÂç≥‰ΩøÂú®ËøúÁ®ãËøõÁ®ã‰∏≠Ôºåequals ÊñπÊ≥ïÁöÑË°å‰∏∫ËÉΩÂ§üÁ¨¶ÂêàÈ¢ÑÊúü Binder Êã•ÊúâÂîØ‰∏ÄÂØπË±°Ë∫´‰ªΩ„ÄÇËøô‰∏ÄÊù°ËßÑÂàô‰ΩøÂæóÂÆÉ‰ª¨ÂèØ‰ª•Áî®‰∫éÁâπÊÆäÁõÆÁöÑÔºö‰Ωú‰∏∫ÂÖ±‰∫´ÁöÑÂÆâÂÖ®ËÆøÈóÆ‰ª§Áâå„ÄÇ Binder ÊòØÂÖ®Â±ÄÂîØ‰∏ÄÁöÑÔºåËøôÊÑèÂë≥ÁùÄÂ¶ÇÊûúÂàõÂª∫‰∏Ä‰∏™ Binder ÂØπË±°ÔºåÂàôÊ≤°ÊúâÂÖ∂‰ªñ‰∫∫ÂèØ‰ª•ÂàõÂª∫‰∏éÂÆÉÁõ∏Á≠âÁöÑ‰∏Ä‰∏™ÂØπË±°ÔºåÔºà‰∏ñÁïå‰∏äÊ≤°ÊúâÂÆåÂÖ®Áõ∏ÂêåÁöÑ‰∏§ÁâáÂè∂Â≠êÔºå‰πüÊ≤°ÊúâÂÆåÂÖ®Áõ∏ÂêåÁöÑ‰∏§‰∏™ Binder ÂØπË±°Ôºâ„ÄÇ Âõ†Ê≠§Ôºåapp framework ÂπøÊ≥õ‰ΩøÁî® Binder tokenÔºå‰ª•Á°Æ‰øùÂçè‰ΩúËøõÁ®ã‰πãÈó¥ÁöÑÂÆâÂÖ®‰∫§‰∫íÔºöÂÆ¢Êà∑Á´ØÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™ Binder ÂØπË±°‰Ωú‰∏∫Ë∑ü server ËøõÁ®ãÂÖ±‰∫´ÁöÑ‰ª§ÁâåÔºåÂπ∂‰∏î server ËøõÁ®ãÂèØ‰ª•Áî®ÂÆÉÊù•È™åËØÅ ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÔºåËÄå‰∏ç‰ºöË¢´ÂÖ∂‰ªñ‰∫∫Ê¨∫È™ó WindowToken Â¶ÇÊûú‰Ω†‰πãÂâçÁúã Android ‰∏≠ View Á±ªÁöÑÂÆòÊñπÊñáÊ°£Ôºå‰Ω†ÂèØËÉΩÂÅ∂ÁÑ∂ÂèëÁé∞‰∫Ü getWindowToken ÊñπÊ≥ïÔºåÂπ∂‰∏î‰ºöÂ•ΩÂ•áÂÆÉÁöÑÂê´‰πâÊòØ‰ªÄ‰πà„ÄÇ È°æÂêçÊÄù‰πâÔºåwindow token ÊòØ Binder tokens ÁöÑ‰∏ÄÁßçÁâπÊÆäÁ±ªÂûãÔºåWindow Manager ‰ΩøÁî®ÂÆÉÊù•ÂîØ‰∏ÄÂú∞Ê†áËØÜÁ≥ªÁªü‰∏≠ÁöÑ Window „ÄÇ window token ÂØπ‰∫éÂÆâÂÖ®ÊÄßÂæàÈáçË¶ÅÔºåÂõ†‰∏∫ÂÆÉ‰ª¨‰ΩøÊÅ∂ÊÑèÂ∫îÁî®Á®ãÂ∫èÊó†Ê≥ïÂú®ÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÁöÑÁ™óÂè£‰∏äÁªòÂà∂„ÄÇ window Manager ÈÄöËøáË¶ÅÊ±ÇÂ∫îÁî®Á®ãÂ∫èÂ∞ÜÂÆÉÁöÑ window token ‰Ωú‰∏∫ÊØè‰∏™Ê∑ªÂä†ÊàñÂà†Èô§Á™óÂè£ÁöÑËØ∑Ê±ÇÁöÑÂèÇÊï∞Êù•‰øùËØÅ ‰∏äËø∞ÈóÆÈ¢ò‰∏ç‰ºöÂèëÁîü„ÄÇÂ¶ÇÊûú token ‰∏çÂåπÈÖçÔºåÂàô window manager ‰ºöÊãíÁªùËØ•ËØ∑Ê±ÇÂπ∂ÊäõÂá∫ BadTokenException ÂºÇÂ∏∏„ÄÇ Â¶ÇÊûúÊ≤°Êúâ window token ÔºåÂàôÊó†Ê≥ïÊâßË°åÊ≠§ÂøÖË¶ÅÁöÑËØÜÂà´Ê≠•È™§ÔºåÂπ∂‰∏î window manager Â∞ÜÊó†Ê≥ï‰øùÊä§Ëá™Â∑±ÂÖçÂèóÊÅ∂ÊÑèÂ∫îÁî®Á®ãÂ∫èÁöÑÊîªÂáª ÁúãÂà∞ËøôÔºå‰Ω†ÂèØËÉΩ‰ºöÊÉ≥Áü•ÈÅìÔºåÂÆûÈôÖÂºÄÂèë‰∏≠ÊúâÂì™‰∫õÂú∫ÊôØÈúÄË¶ÅÁî®Âà∞ window token„ÄÇ‰∏ãÈù¢‰∏æÂá†‰∏™‰æãÂ≠ê üëá 1„ÄÅÂΩìÂ∫îÁî®Á®ãÂ∫èÈ¶ñÊ¨°ÂêØÂä®Êó∂ÔºåAMS ‰ºöÂàõÂª∫‰∏ÄÁßçÁâπÊÆäÁöÑÁ™óÂè£‰ª§ÁâåÔºåÁß∞‰∏∫Â∫îÁî®Á®ãÂ∫èÁ™óÂè£‰ª§ÁâåÔºåÂÆÉÂîØ‰∏ÄÂú∞Ê†áËØÜÂ∫îÁî®Á®ãÂ∫èÁöÑÈ°∂Á∫ßÂÆπÂô®Á™óÂè£„ÄÇAMS Â∞ÜÊ≠§‰ª§ÁâåÂêåÊó∂Êèê‰æõÁªô app Âíå WMSÔºåÂπ∂‰∏îÂ∫îÁî®Á®ãÂ∫èÊØèÊ¨°Ë¶ÅÂêëÂ±èÂπïÊ∑ªÂä†Êñ∞Á™óÂè£Êó∂ÔºåÈÉΩ‰ºöÂ∞Ü token ÂèëÈÄÅÁªô WMS „ÄÇ ËøôÊ†∑ÂèØ‰ª•Á°Æ‰øùÂ∫îÁî®Á®ãÂ∫èÂíå WMS ‰πãÈó¥ÁöÑÂÆâÂÖ®‰∫§‰∫íÔºàËÆ©ÂÆÉÊó†Ê≥ïÂú®ÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫è‰πã‰∏äÊ∑ªÂä†Á™óÂè£ÔºâÔºåÂπ∂‰Ωø AMS ÂèØ‰ª•ËΩªÊùæÂú∞Áõ¥Êé•Âêë WMS ÂèëÂá∫ËØ∑Ê±Ç„ÄÇ ‰æãÂ¶ÇÔºåAMS ÂèØ‰ª•ËØ¥‚ÄúÈöêËóèÊ≠§‰ª§ÁâåÁöÑÊâÄÊúâÁ™óÂè£‚ÄùÔºåÁÑ∂Âêé WMS Â∞ÜËÉΩÂ§üÊ≠£Á°ÆËØÜÂà´Â∫îÂÖ≥Èó≠ÁöÑ‰∏ÄÁªÑÁ™óÂè£„ÄÇ 2„ÄÅÂÆûÁé∞Ëá™Â∑±ÁöÑËá™ÂÆö‰πâ launcher ÁöÑÂºÄÂèë‰∫∫ÂëòÂèØ‰ª•ÈÄöËøáË∞ÉÁî® sendWallpaperCommandÔºàIBinder windowTokenÔºåString actionÔºåint xÔºåint yÔºåint zÔºåBundle extrasÔºâÊñπÊ≥ï‰∏é‰Ωç‰∫éÂÖ∂ÂêéÊñπÁöÑÂä®ÊÄÅÂ£ÅÁ∫∏Á™óÂè£ËøõË°å‰∫§‰∫í„ÄÇ ‰∏∫Á°Æ‰øù launcher ‰ª•Â§ñÁöÑÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÊó†Ê≥ï‰∏éÂä®ÊÄÅÂ£ÅÁ∫∏ËøõË°å‰∫§‰∫íÔºåËØ•Ê°ÜÊû∂Ë¶ÅÊ±ÇÂºÄÂèë‰∫∫ÂëòÂ∞Ü window token ‰Ωú‰∏∫ËØ•ÊñπÊ≥ïÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰º†ÈÄí„ÄÇ Â¶ÇÊûú window token Êú™Ê†áËØÜ‰Ωç‰∫éÂ¢ôÁ∫∏È°∂ÈÉ®ÁöÑÂΩìÂâçÂâçÊôØÊ¥ªÂä®Á™óÂè£ÔºåÂàôÂ∞ÜÂøΩÁï•ËØ•ÂëΩ‰ª§Âπ∂ÊâìÂç∞Ë≠¶Âëä 3„ÄÅÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•ÈÄöËøáË∞ÉÁî® hideSoftInputFromWindowÔºàIBinder windowTokenÔºåint flagsÔºâÊñπÊ≥ïÊù•Ë¶ÅÊ±Ç InputMethodManager ÈöêËóèËΩØÈîÆÁõòÔºå‰ΩÜÊòØÂøÖÈ°ªÊèê‰æõÁ™óÂè£‰ª§Áâå‰Ωú‰∏∫ËØ∑Ê±ÇÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ Â¶ÇÊûú‰ª§Áâå‰∏éÂΩìÂâçÊé•ÂèóËæìÂÖ•ÁöÑÁ™óÂè£ÊâÄÂ±ûÁöÑÁ™óÂè£‰ª§Áâå‰∏çÂåπÈÖçÔºåÂàô InputMethodManager Â∞ÜÊãíÁªùËØ•ËØ∑Ê±Ç„ÄÇ Ëøô‰ΩøÂæóÊÅ∂ÊÑèÂ∫îÁî®Á®ãÂ∫èÊó†Ê≥ïÂº∫Âà∂ÂÖ≥Èó≠Áî±Âè¶‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫èÊâìÂºÄÁöÑËΩØÈîÆÁõò 4„ÄÅÊâãÂä®Â∞ÜÊñ∞ window Ê∑ªÂä†Âà∞Â±èÂπï‰∏äÁöÑÂ∫îÁî®Á®ãÂ∫èÔºà‰πüÂ∞±ÊòØË∞ÉÁî® addView(ViewÔºåWindowManager.LayoutParams) ÊñπÊ≥ïÔºâÂèØËÉΩÈúÄË¶ÅÈÄöËøáËÆæÁΩÆ WindowManager.LayoutParams.token Â≠óÊÆµÊù•ÊåáÂÆöÂÖ∂Â∫îÁî®Á®ãÂ∫èÁöÑ window token„ÄÇ Âõ†‰∏∫ getWindowManager() ÊñπÊ≥ï‰ºöËøîÂõû‰∏Ä‰∏™ WindowManagerÔºåÂÆÉÂ∞ÜËá™Âä®‰∏∫ÊÇ®ËÆæÁΩÆ‰ª§ÁâåÁöÑÂÄºÔºåÊâÄ‰ª•Â§ßÈÉ®ÂàÜÊôÆÈÄöÁöÑÂ∫îÁî®Á®ãÂ∫èÈÉΩ‰∏çÂ§™ÂèØËÉΩ‰ºöËøôÊ†∑ÂÅö„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÔºåÂ¶ÇÊûúÂ∞ÜÊù•Âú®Êüê‰∏™Êó∂ÂÄôÈÅáÂà∞ÈúÄË¶Å‰ªéÂêéÂè∞ÊúçÂä°ÂêëÂ±èÂπïÊ∑ªÂä† panel window ÁöÑÂú∫ÊôØÔºåÈúÄË¶ÅÈÄöËøáÂ∫îÁî®Á®ãÂ∫è window token ÊâãÂä®Á≠æÁΩ≤ËØ∑Ê±ÇÊâçËÉΩÂÆûÁé∞ÊÄªÁªì Â∞ΩÁÆ° Binder Tokens ÁöÑÂ≠òÂú®ÂØπÂºÄÂèë‰∫∫ÂëòÊù•ËØ¥Âá†‰πéÊòØÈÄèÊòéÁöÑÔºå‰ΩÜÊòØ‰∏∫‰∫Ü‰øùÈöúÂÆâÂÖ®Ôºå Binder Token Âú®Á≥ªÁªü‰∏≠Ë¢´ÂπøÊ≥õÂ∫îÁî®„ÄÇ Android ÊòØ‰∏Ä‰∏™Â§ßËßÑÊ®°ÁöÑÂçè‰ΩúËøõÁ®ãÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºåÂÆÉ‰æùËµñ‰∫é Binder ÂØπË±°Âú®ËÆæÂ§á‰∏äÊâÄÊúâËøõÁ®ã‰πãÈó¥ÈÉΩÊòØÂîØ‰∏ÄÁöÑ„ÄÇ Binder Tokens ÊòØÊ°ÜÊû∂‰∏≠ÂêÑÁßç‰∫§‰∫í ËÉåÂêéÁöÑÈ©±Âä®ÂäõÔºåÂ¶ÇÊûúÊ≤°ÊúâÂÆÉ‰ª¨ÔºåÈÇ£‰πà app ËøõÁ®ã‰∏éÁ≥ªÁªüËøõÁ®ã‰πãÈó¥ÁöÑÂÆâÂÖ®ÈÄö‰ø°Â∞ÜÂæàÈöæÂÆûÁé∞„ÄÇ ÂèÇËÄÉÊñáÁåÆ 1„ÄÅËøô‰∏™ÊñáÊ°£ÂÆûÈôÖ‰∏äÊöóÁ§∫‰∫Ü Binders ÂèØ‰ª•Ëøô‰πàÁî®Ôºö‚ÄúÂè™ÈúÄÁõ¥Êé•ÂÆû‰æãÂåñ‰∏Ä‰∏™ÂéüÂßãÁöÑ Binder ÂØπË±°ÔºåÂ∞±ÂèØ‰ª•ÊääÂÆÉÁî®‰ΩúÂèØÂú®ÂêÑ‰∏™ËøõÁ®ã‰πãÈó¥ÂÖ±‰∫´ÁöÑ‰ª§Áâå„ÄÇ‚Äùhttps://developer.android.com/reference/android/os/Binder.html 2„ÄÅÂú® frameworks/base/services/java/com/android/server ÁõÆÂΩï‰∏ã ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂ÔºåËøô‰∏™Êñá‰ª∂ÂæàÊúâÂèØËÉΩ‰ºö‰ª•ÊüêÁßçÂΩ¢Âºè‰ΩøÁî® Binder token„ÄÇÂè¶‰∏Ä‰∏™ÂæàÈÖ∑ÁöÑ‰æãÂ≠êÊ∂âÂèäÁä∂ÊÄÅÊ†è„ÄÅÈÄöÁü•ÁÆ°ÁêÜÂô®ÂíåÁ≥ªÁªü UI„ÄÇÂÖ∑‰ΩìËÄåË®ÄÔºåStatusBarManagerService Áª¥Êä§‰∏Ä‰∏™ binder token Âà∞ Notification ÁöÑÂÖ®Â±ÄÊò†Â∞Ñ„ÄÇÂΩì NotificationManagerService ÂêëÁä∂ÊÄÅÊ†èÁÆ°ÁêÜÂô®Ôºà status bar managerÔºâËØ∑Ê±ÇÂêëÁä∂ÊÄÅÊ†èÊ∑ªÂä†ÈÄöÁü•Êó∂ÔºåÁä∂ÊÄÅÊ†èÁÆ°ÁêÜÂô®‰ºöÂàõÂª∫‰∏Ä‰∏™ËÉΩÂ§üÊÉü‰∏ÄÊ†áËØÜËøô‰∏™ ÈÄöÁü• ÁöÑ binder token ÔºåÂπ∂Â∞ÜÂÖ∂‰º†ÈÄíÁªôÈÄöÁü•ÁÆ°ÁêÜÂô®Âíå SystemUI„ÄÇÁî±‰∫éËøô‰∏â‰∏™ËßíËâ≤ÈÉΩÁü•ÈÅìÈÄöÁü•ÁöÑ binder token ÔºåÂõ†Ê≠§‰ªéÈÇ£‰πãÂêéÔºåÂØπÈÄöÁü•ÁöÑ‰ªª‰ΩïÊõ¥Êîπ(‰æãÂ¶ÇÈÄöÁü•ÁÆ°ÁêÜÂô®ÂèñÊ∂àÈÄöÁü•ÔºåÊàñËÄÖ SystemUI Ê£ÄÊµãÂà∞Áî®Êà∑‰ªéÂ±èÂπï‰∏äÊªëÂä®‰∫Ü‰∏Ä‰∏™ÈÄöÁü•)ÈÉΩÂ∞ÜÈ¶ñÂÖàÁªèËøá Áä∂ÊÄÅÊ†èÁÆ°ÁêÜÂô®„ÄÇËøô‰ΩøÂæó‰∏â‰∏™Á≥ªÁªüÊúçÂä°Êõ¥ÂÆπÊòì‰øùÊåÅÂêåÊ≠•: Áä∂ÊÄÅÊ†èÁÆ°ÁêÜÂô®ÂèØ‰ª•Ë¥üË¥£ÈõÜ‰∏≠ÊâÄÊúâÂÖ≥‰∫éÂΩìÂâçÂ∫îËØ•ÊòæÁ§∫Âì™‰∫õÈÄöÁü•ÁöÑ‰ø°ÊÅØÔºåËÄå‰∏çÈúÄË¶Å SystemUI Âíå notification manager ‰πãÈó¥Áõ¥Êé•ËøõË°å‰∫§‰∫í 3„ÄÅÊã•Êúâ android.permission.SYSTEM_ALERT_WINDOW ÊùÉÈôêÔºàÂèàÁß∞‚Äú‰ªéÂÖ∂‰ªñÂ∫îÁî®‰∏äÁªòÂõæ‚ÄùÊùÉÈôêÔºâÁöÑÂ∫îÁî®Á®ãÂ∫èÊòØÊ≠§ËßÑÂàôÁöÑÊòéÊòæ‰æãÂ§ñ„ÄÇ Facebook Messenger Âíå DicePlayer ÊòØ‰∏§‰∏™ÊµÅË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÈúÄË¶ÅÊ≠§ÊùÉÈôêÔºåÂπ∂‰ΩøÁî®ÂÆÉÂú®ÂêéÂè∞ÊúçÂä°ÁöÑÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫è‰πã‰∏äÊ∑ªÂä†Á™óÂè£„ÄÇFacebook Messenger Âíå DicePlayer ÊòØ‰∏§‰∏™ÊµÅË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÈúÄË¶ÅÊ≠§ÊùÉÈôêÔºåÂπ∂‰ΩøÁî®ÂÆÉÂú®ÂêéÂè∞ÊúçÂä°ÁöÑÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫è‰πã‰∏äÊ∑ªÂä†Á™óÂè£ 4 „ÄÇActivityManagerService ÊòØÂÖ®Â±ÄÁ≥ªÁªüÊúçÂä°ÔºàÂú® System Server ËøõÁ®ã‰∏≠ËøêË°åÔºâÔºåÂÆÉË¥üË¥£ÂêØÂä®ÔºàÂíåÁÆ°ÁêÜÔºâÊñ∞ÁªÑ‰ª∂Ôºå‰æãÂ¶Ç‚ÄúActivity Âíå Service‚Äù„ÄÇ ÂÆÉËøòÊ∂âÂèä Áª¥Êä§ÂÜÖÊ†∏‰∏≠ low-memory handler ‰ΩøÁî®ÁöÑ OOM Ë∞ÉÊï¥ÔºåÊùÉÈôêÔºå‰ªªÂä°ÁÆ°ÁêÜÁ≠â 5„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøáË∞ÉÁî® getApplicationWindowToken() Êù•Ëé∑Âæó‰∏Ä‰∏™ÂºïÁî®https://developer.android.com/reference/android/view/View#getApplicationWindowToken() 6„ÄÅËøô‰∏™Ëß£Èáä‰ªÖ‰ªÖËß¶ÂèäË°®Èù¢„ÄÇÊúâÂÖ≥ SurfaceFlinger„ÄÅWindowManager ÂíåÂ∫îÁî®Á®ãÂ∫è‰πãÈó¥Â¶Ç‰Ωï‰∫§‰∫íÁöÑÊõ¥ËØ¶ÁªÜÁöÑËß£ÈáäÔºåËØ∑ÂèÇÈòÖÊú¨Êñá„ÄÇ„ÄåSurfaceFlinger Âíå Hardware Composer„Äç‰∏ÄËäÇÁöÑÁ¨¨‰∏âÊÆµÁÆÄË¶ÅÂú∞ÊèêÂà∞‰∫Ü‰º†ÈÄíÁªôÂ∫îÁî®Á®ãÂ∫èÁöÑ Binder Â∫îÁî®Á®ãÂ∫è window token„ÄÇhttp://source.android.com/devices/graphics/architecture.htm]]></content>
      <categories>
        <category>AndroidÁ≥ªÁªüÊú∫Âà∂</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Message ÂºïÂèëÁöÑ DialogFragment ÂÜÖÂ≠òÊ≥ÑÊºèÂàÜÊûê‰∏éËß£ÂÜ≥ÊñπÊ°à]]></title>
    <url>%2Fblog%2F2020%2F06%2F12%2FMessage-%E5%BC%95%E5%8F%91%E7%9A%84-DialogFragment-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[Q:ÂíãÂõû‰∫ãÔºüÊ≠£Â∏∏‰ΩøÁî® Dialog Âíå DialogFragment ‰πüÊúâÂèØËÉΩ‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÔºüA: ‚Ä¶.ÊòØÁöÑÔºåËØ¥Êù•ËØùÈïø„ÄÇ ÈïøËØùÁü≠ËØ¥Ôºö Êüê‰∏Ä‰∏™ HandlerThread ÁöÑ Looper#loop ÊñπÊ≥ïÔºå‰∏ÄÁõ¥Á≠âÂæÖ queue#next ÊñπÊ≥ïËøîÂõûÔºå‰ΩÜÊòØÂÆÉÁöÑ msg Â±ÄÈÉ®ÂèòÈáèËøòÂºïÁî®ÁùÄ‰∏ä‰∏Ä‰∏™Âæ™ÁéØ‰∏≠Â∑≤ÁªèË¢´ÊîæÂà∞ Message Pool ‰∏≠ MessageÔºåÊàë‰ª¨Áß∞‰πã‰∏∫ MessageA„ÄÇ DialogFragment#onActivityCreated ÊñπÊ≥ï‰∏≠Ôºå‰ºöË∞ÉÁî® Dialog#setOnCancelListener ÊñπÊ≥ïÔºåÂ∞ÜËá™Ë∫´ÁöÑÂºïÁî®‰Ωú‰∏∫ listener ÂèÇÊï∞‰º†ÈÄíÁªôËØ•ÊñπÊ≥ï Dialog#setOnCancelListener ÊñπÊ≥ïÂÜÖÈÉ®Ôºå‰ºöÂ∞ùËØï‰ªé Message Pool ‰∏≠Ëé∑Âèñ‰∏Ä‰∏™ MessageÔºåÂèñÂá∫ÁöÑ Message ÂàöÂ•ΩÊòØ MessageAÔºåÁÑ∂ÂêéÂ∞Ü‰º†ÂÖ•ÁöÑ Listener ÂÆû‰æãËµãÂÄºÁªô MessageA#obj„ÄÇ Â§ñÈÉ®Ë∞ÉÁî® cancel ÁöÑÊó∂ÂÄôÔºåDialog ÂÜÖÈÉ®‰ºöÂ∞Ü MessageA Êã∑Ë¥ù‰∏Ä‰ªΩÔºåÊàë‰ª¨Áß∞ÂÆÉ‰∏∫ MessageBÔºåÁÑ∂ÂêéÂ∞Ü MessageB ÂèëÈÄÅÂà∞Ê∂àÊÅØÈòüÂàó‰∏≠„ÄÇ DialogFragment Êî∂Âà∞ onDestory ÂõûË∞É‰πãÂêéÔºåLeakCanary ÂºÄÂßãÁõëÂê¨Ëøô‰∏™ DialogFragment ÊòØÂê¶Ê≠£Â∏∏Ë¢´ÂõûÊî∂ÔºåÂèëÁé∞Ëøô‰∏™ÂÆû‰æã‰∏ÄÁõ¥Â≠òÂú®Ôºådump ÂÜÖÂ≠òÔºåÂàÜÊûêÂºïÁî®ÈìæÔºåÊä•ÂëäÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò„ÄÇ ÂÖ∑‰ΩìÁªÜËäÇ‰ªãÁªçËßÅ‰∏ãÊñáüëá 1„ÄÅÈóÆÈ¢òÂºÄÂèëÁöÑÊó∂ÂÄôÔºå LeakCanary Êä•Âëä‰∫Ü‰∏Ä‰∏™ËØ°ÂºÇÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÈìæ„ÄÇ Êìç‰ΩúË∑ØÂæÑÔºöapp ÊòæÁ§∫ DialogFragment ÁÑ∂ÂêéÁÇπÂáªÂ§ñÈÉ®‰ΩøÂÖ∂Ê∂àÂ§±Ôºå‰πãÂêé LeakCanary Â∞±Êä•‰∫ÜÂ¶Ç‰∏ãÈóÆÈ¢òÔºö ‰ªé‰∏äÈù¢ÁöÑÊà™Âõæ üëÜ ÂèØ‰ª•ÁúãÂá∫ÔºöGCRoot ÊòØ HandlerThread Ê≠£Âú®ÊâßË°åÁöÑÊñπÊ≥ï‰∏≠ÁöÑ‰∏Ä‰∏™Â±ÄÈÉ®ÂèòÈáè„ÄÇËøô‰∏™Â±ÄÈÉ®ÂèòÈáèÂº∫ÂºïÁî®‰∫Ü‰∏Ä‰∏™ Message ÂØπË±°Ôºåmessage ÁöÑ obj Â≠óÊÆµÂèàÂº∫ÂºïÁî®‰∫Ü NormalDialogFragment ÔºåÂØºËá¥ÂÖ∂Ë∞ÉÁî®‰∫Ü onDestory ÊñπÊ≥ï‰πãÂêéÔºå‰πüÊó†Ê≥ïË¢´ÂõûÊî∂„ÄÇ 2„ÄÅÂàÜÊûêÊ≥®ÔºöÊú¨Êñá‰∏≠ÁöÑ„ÄåHandlerThread„ÄçÊ≥õÊåáÈÇ£‰∫õÂ∏¶Êúâ Looper Âπ∂‰∏îÂºÄÂêØ‰∫ÜÊ∂àÊÅØÂæ™ÁéØÔºàË∞ÉÁî®‰∫Ü Looper#loopÔºâÁöÑÁ∫øÁ®ã DialogFragment ‰∏∫Âï•‰ºöË¢´‰∏Ä‰∏™ Message ÁöÑ obj Â≠óÊÆµÂº∫ÂºïÁî®ÔºüËÄå‰∏îÈÇ£ËøòÊòØ‰∏Ä‰∏™Ë¢´ HandlerThread ÂºïÁî®ÁùÄÁöÑ Message„ÄÇ ÂõûÈ°æ‰∏Ä‰∏ãÊàë‰ª¨Ê≠£Â∏∏ÊòæÁ§∫ DialogFragment ÁöÑÊµÅÁ®ãÔºö1„ÄÅÂÆû‰æãÂåñ DialogFragmentÔºå2„ÄÅË∞ÉÁî® DialogFragment#show ÊñπÊ≥ïËÆ©ÂÖ∂ÊòæÁ§∫Âá∫Êù•„ÄÇËøô‰∏™ÊµÅÁ®ã‰∏≠ÊúâÂèØËÉΩÂØºËá¥ Fragment Ë¢´ Message Âº∫ÂºïÁî®ÂêóÔºü È¶ñÂÖàÁúã DialogFragment ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÊòØ‰∏Ä‰∏™Á©∫ÂÆûÁé∞„ÄÇÊéíÈô§„ÄÇ ÂÖ∂Ê¨°Áúã DialogFragment show ÊñπÊ≥ïÈÄªËæëÂ¶Ç üëáÔºå‰πüÊòØÊ≠£Â∏∏ÁöÑ Fragment ÊòæÁ§∫ÈÄªËæë„ÄÇÊéíÈô§„ÄÇ 1234567public void show(@NonNull FragmentManager manager, @Nullable String tag) &#123; mDismissed = false; mShownByMe = true; FragmentTransaction ft = manager.beginTransaction(); ft.add(this, tag); ft.commit();&#125; ÈöæÈÅìÊòØ show ËøáÁ®ãÁöÑÊüê‰∏™Ê≠•È™§‰∏≠ÂéªËé∑Âèñ‰∫Ü MessageÔºü Âú® DialogFragment#onActivityCreated ÊñπÊ≥ï‰∏≠ÔºåÂèØ‰ª•ÁúãÂà∞ 123456789101112@Overridepublic void onActivityCreated(@Nullable Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); if (!mShowsDialog) &#123; return; &#125; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å mDialog.setCancelable(mCancelable); mDialog.setOnCancelListener(this);//ËÆæÁΩÆ cancel ÁõëÂê¨Âô® mDialog.setOnDismissListener(this);//ËÆæÁΩÆ dismiss ÁõëÂê¨Âô® //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å&#125; ‰ª• Dialog#setOnCancelListener ÊñπÊ≥ï‰∏∫‰æã üëá 12345678910111213public void setOnCancelListener(@Nullable OnCancelListener listener) &#123; if (mCancelAndDismissTaken != null) &#123; throw new IllegalStateException( "OnCancelListener is already taken by " + mCancelAndDismissTaken + " and can not be replaced."); &#125; if (listener != null) &#123; //Listener ‰∏ç‰∏∫ nullÔºåÂèñÂá∫‰∏ÄÊù° messageÔºà‰ºöÂ∞ùËØïÂÖà‰ªé pool ‰∏≠Ëé∑ÂèñÔºåÂ¶ÇÊûúÊ≤°ÊúâÊ∂àÊÅØÊâç‰ºö new ‰∏Ä‰∏™Êñ∞ÁöÑÔºâ ËøôÊòØ‰∏Ä‰∏™ÊØîËæÉÂÖ≥ÈîÆÁöÑÁÇπÔºåÂêéÁª≠‰ºöËÆ≤Âà∞ mCancelMessage = mListenersHandler.obtainMessage(CANCEL, listener); &#125; else &#123; mCancelMessage = null; &#125;&#125; ÂèØ‰ª•ÁúãÂà∞ÔºåDialog#setOnCancelListener ÊñπÊ≥ï‰ºö‰ªéÊ∂àÊÅØÊ±†‰∏≠Ëé∑Âèñ‰∏ÄÊù° messageÔºåÂπ∂ËµãÂÄºÁªô Dialog ÁöÑ mCancelMessage ÊàêÂëòÂèòÈáè„ÄÇ Ëøô‰∏™ message ‰ªÄ‰πàÊó∂ÂÄô‰ºöÁî®Âà∞ÔºüÂΩì cancel ÊñπÊ≥ïË¢´Ë∞ÉÁî®ÁöÑÊó∂ÂÄô„ÄÇ‰∏ãÈù¢Áúã‰∏ã Dialog#cancel ÊñπÊ≥ï Dialog#cancel ÊñπÊ≥ï üëá 12345678910@Overridepublic void cancel() &#123; if (!mCanceled &amp;&amp; mCancelMessage != null) &#123; mCanceled = true; // Obtain a new message so this dialog can be re-used //Â§çÂà∂‰∏Ä‰ªΩÔºåÁÑ∂ÂêéÂèëÈÄÅ„ÄÇËøôÈáå‰∏∫Âï•ÈúÄË¶ÅÂ§çÂà∂ËÄå‰∏çÊòØÁî®ÂéüÊù•ÁöÑÊ∂àÊÅØÔºüÁúãÂÆòÊñπÁöÑÊ≥®ÈáäËØ¥ÔºåÊòØ‰∏∫‰∫Ü Dialog ËÉΩÂ§üË¢´Â§çÁî®„ÄÇÔºàÊâÄË∞ì„ÄåÂ§çÁî®„ÄçÂ∫îËØ•ÊòØÊåáÔºåDialog cancel ‰πãÂêéÔºåÂÜçË∞ÉÁî® show ËøòÂèØ‰ª•ÊòæÁ§∫Âá∫Êù•, Âπ∂‰∏î‰πãÂâçËÆæÁΩÆÁöÑÁõëÂê¨ÈÉΩËøòÊúâÊïàÔºâ Message.obtain(mCancelMessage).sendToTarget(); &#125; dismiss();&#125; ÈáçÁÇπ üëáüëáüëá ‰πüÂ∞±ÊòØËØ¥ÔºåÊàë‰ª¨Ë∞ÉÁî® Dialog#setOnCancelListener ÊñπÊ≥ï‰ªéÊ∂àÊÅØÊ±†Ëé∑ÂèñÂà∞ÁöÑ Message ÊúÄÁªàÊòØ‰∏ç‰ºöË¢´ÂèëÈÄÅÂá∫ÂéªÁöÑ„ÄÇÂõ†Ê≠§ Message#recycleUnchecked ÊñπÊ≥ï‰∏ç‰ºöË¢´Ë∞ÉÁî®„ÄÇ ‰ΩÜÊòØÂç≥‰ΩøÊ≤°ÊúâÂèëÈÄÅÂá∫ÂéªÔºå‰πüÂè™ÊòØ Dialog ÁöÑ‰∏Ä‰∏™ÊàêÂëòÂèòÈáèÂëÄÔºåDialog ÈîÄÊØÅÁöÑÊó∂ÂÄôÔºåËøô‰∏™ message Â∫îËØ•‰πüËÉΩË¢´ÂõûÊî∂Ôºå‰∏çËá≥‰∫éÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÂêßÔºü ÂÜçÁúãÂõûÂâçÈù¢ LeakCanary Êä•Âá∫Êù•ÁöÑÂºïÁî®ÈìæÔºåGCRoot ÊòØ‰∏Ä‰∏™ HandlerThread ‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÇ Q:ÂõûÈ°æ‰∏Ä‰∏ã Android ÁöÑÊ∂àÊÅØÊú∫Âà∂‰∏≠ÔºåMessage ÊòØÂ¶Ç‰ΩïË¢´‰ΩøÁî®ÁöÑÔºü A:Êàë‰ª¨ÈÄöËøá Handler#postDelayed() ÊàñËÄÖÊòØ Message#sendToTarget ÊñπÊ≥ïÂèëÈÄÅÁöÑÊ∂àÊÅØÔºåÊúÄÁªàÈÉΩ‰ºöËøõÂÖ•Âà∞ ÂΩìÂâçÁ∫øÁ®ãÁöÑ MessageQueue ‰∏≠ÔºåÁÑ∂Âêé Looper#loop ÊñπÊ≥ï‰∏çÊñ≠Âú∞‰ªéÈòüÂàó‰∏≠ÂèñÂá∫ MessageÔºåÊ¥æÂèëÊâßË°å„ÄÇÂΩìÊ∂àÊÅØÈòüÂàó‰∏∫Á©∫ÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºö‰ºëÁú†„ÄÇÁ≠âÂà∞ÊúâÊñ∞ÁöÑ message ÂèØ‰ª•ÂèñÂá∫ÁöÑÊó∂ÂÄôÔºåÈáçÊñ∞Âî§ÈÜí„ÄÇ Looper#loop ÊñπÊ≥ï 123456789101112public static void loop() &#123; final Looper me = myLooper(); final MessageQueue queue = me.mQueue; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å for (;;) &#123; Message msg = queue.next(); // might block //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å msg.target.dispatchMessage(msg); //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å msg.recycleUnchecked(); &#125;&#125; Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºåmsg Ê¥æÂèëÂà∞ÁõÆÊ†áÂØπË±°‰πãÂêéÔºåÈÉΩ‰ºöË∞ÉÁî® msg.recycleUnchecked() ÊñπÊ≥ïÂÆåÊàêÈáçÁΩÆÔºåÊîæÂÖ•Ê∂àÊÅØÊ±†„ÄÇ ÈöæÈÅìÊâßË°å for Âæ™ÁéØ‰Ωì‰∏≠ÁöÑ‰∏ÄÊ¨°Ëø≠‰ª£‰πãÂêéÔºåmsg Â±ÄÈÉ®ÂèòÈáèËøòÊòØÊåÅÊúâ‰∏ä‰∏Ä‰∏™Ëø≠‰ª£‰∏≠ÁöÑ Message ÁöÑÂº∫ÂºïÁî®Ôºü Â¶ÇÊûúËøô‰∏™ÂÅáËÆæÊàêÁ´ãÔºåÈÇ£‰πà‰∏äÈù¢ÁöÑÊ≥ÑÊºèÂ∞±ËØ¥ÂæóÈÄö‰∫Ü„ÄÇ 2.1„ÄÅ È™åËØÅÂí±‰ª¨ÂèØ‰ª•ÂÜô‰∏ÄÊÆµÁ±ª‰ººÁöÑ‰ª£Á†ÅÔºåÁÑ∂ÂêéÁî® javap ÂëΩ‰ª§Êü•ÁúãÂ≠óËäÇÁ†ÅÈ™åËØÅ‰∏Ä‰∏ã„ÄÇ Êñ∞Âª∫‰∏Ä‰∏™ Test.java Êñá‰ª∂ÔºåÊ∑ªÂä†Â¶Ç‰∏ã‰ª£Á†ÅÔºö 123456789import java.util.concurrent.BlockingQueue;public class Test &#123; static void loop(BlockingQueue&lt;String&gt; blockingQueue) throws InterruptedException &#123; while (true) &#123; String msg = blockingQueue.take(); System.out.println(msg); &#125; &#125;&#125; ÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§Ôºö javac Test.javajavap -v Test loop ÊñπÊ≥ïÂØπÂ∫îÁöÑÂ≠óËäÇÁ†ÅÂ¶Ç‰∏ã üëáÔºö 12345678910111213141516171819202122static void loop(java.util.concurrent.BlockingQueue&lt;java.lang.String&gt;) throws java.lang.InterruptedException; descriptor: (Ljava/util/concurrent/BlockingQueue;)V flags: ACC_STATIC Code: stack=2, locals=2, args_size=1 0: aload_0 #Âä†ËΩΩ slot0 ÁöÑÂèÇÊï∞ Â∞ÜÁ¨¨0‰∏™ÂºïÁî®Á±ªÂûãÊú¨Âú∞ÂèòÈáèÊé®ÈÄÅËá≥Ê†àÈ°∂ÔºåÂõ†‰∏∫ÊòØÈùôÊÄÅÊñπÊ≥ïÔºåÊ≤°Êúâ thisÔºåÂõ†Ê≠§ÔºåÊòØÊñπÊ≥ïÂèÇÊï∞ÂàóË°®‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞Ôºå‰πüÂ∞±ÊòØÂä†ËΩΩ BlockingQueue 1: invokeinterface #2, 1 // InterfaceMethod java/util/concurrent/BlockingQueue.take:()Ljava/lang/Object; 6: checkcast #3 // class java/lang/String 9: astore_1 #Â∞Ü blockingQueue.take(); ÊâßË°åÁöÑÁªìÊûúÔºà‰∏Ä‰∏™ String Á±ªÂûãÁöÑÂÄºÔºâÂ≠òÂà∞Á¨¨‰∏Ä‰∏™ slot 10: getstatic #4 // Field java/lang/System.out:Ljava/io/PrintStream; 13: aload_1 # Â∞ÜÁ¨¨1‰∏™ÂºïÁî®Á±ªÂûãÊú¨Âú∞ÂèòÈáèÊé®ÈÄÅËá≥Ê†àÈ°∂ 14: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 17: goto 0 #Êó†Êù°‰ª∂Ë∑≥ËΩ¨Âà∞Á¨¨ 0 Ë°å LineNumberTable: line 6: 0 line 7: 10 line 8: 17 StackMapTable: number_of_entries = 1 frame_type = 0 /* same */ Exceptions: throws java.lang.InterruptedException Signature: #18 // (Ljava/util/concurrent/BlockingQueue&lt;Ljava/lang/String;&gt;;)V ‰ªé‰∏äÈù¢ÁöÑÂ≠óËäÇÁ†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÂΩì‰∏Ä‰∏™Ëø≠‰ª£ÊâßË°åÁªìÊùü‰πãÂêéÔºåÈ¶ñÂÖà‰ºöË∑≥ËΩ¨‰ºöÂæ™ÁéØ‰ΩìÁöÑÁ¨¨‰∏ÄË°åÔºå‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠ÂØπÂ∫îÁöÑÂ∞±ÊòØ blockingQueue#take ËøôË°å‰ª£Á†Å„ÄÇÊ≠§Êó∂ÔºåÂ±ÄÈÉ®ÂèòÈáè‰∏≠ÁöÑ slot1ÔºåËøòÊòØÊåáÂêë‰∏ä‰∏ÄÊ¨°Ëø≠‰ª£‰∏≠ÁöÑ String ÂèòÈáè„ÄÇÂ¶ÇÊûú blockingQueue ‰∏≠Â∑≤ÁªèÊ≤°ÊúâÂÖÉÁ¥†‰∫ÜÔºåËøôÊó∂Â∞±‰ºö‰∏ÄÁõ¥Á≠âÂæÖ‰∏ã‰∏Ä‰∏™ÂÖÉÁ¥†ÊèíÂÖ•ÔºåËÄå‰∏ä‰∏ÄÊ¨°Ëø≠‰ª£‰∏≠ÁöÑ String ÂèòÈáèËôΩÁÑ∂Â∑≤ÁªèÊ≤°ÊúâÁî®‰∫ÜÔºå‰ΩÜÊòØÂõ†‰∏∫Ë¢´Â±ÄÈÉ®ÂèòÈáèË°®ÂºïÁî®ÁùÄÔºåÊó†Ê≥ïË¢´ GC„ÄÇ ÈáçÁÇπ üëáüëáüëá ÂõûÂà∞Êàë‰ª¨ÁöÑ‰∏ªÁ∫øÔºå Looper#loop ÊñπÊ≥ï‰∏≠ for Âæ™ÁéØ‰Ωì‰∏≠ÁöÑÁ¨¨‰∏ÄË°åÔºåqueue.next(); ÊñπÊ≥ïÔºåÂΩìÊ∂àÊÅØÈòüÂàó‰∏≠Ê≤°ÊúâÊ∂àÊÅØÁöÑÊó∂ÂÄôÔºåËøô‰∏™Ë∞ÉÁî®‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£Èáå„ÄÇÊ≠§Êó∂ msg Ê≤°ÊúâË¢´ÈáçÊñ∞ËµãÂÄº„ÄÇÂõ†Ê≠§Ôºåloop ÊñπÊ≥ïÁöÑÂ±ÄÈÉ®ÂèòÈáèË°®‰∏≠ËøòÊòØÊåÅÊúâÂØπ‰∏ä‰∏Ä‰∏™Ëø≠‰ª£‰∏≠ message ÂÆû‰æãÁöÑÂºïÁî®„ÄÇ ËôΩÁÑ∂ loop ÊñπÊ≥ïÁªìÂ∞æÊâßË°å‰∫Ü msg.recycleUnchecked(); ÊñπÊ≥ïÔºå‰ºöÂ∞Ü message ‰∏≠ÁöÑÂ≠óÊÆµÈÉΩÁΩÆ‰∏∫Á©∫ÂÄºÔºå‰ΩÜÊòØÔºå‰∏éÊ≠§ÂêåÊó∂ÔºåÂÆÉ‰ºöÂ∞ÜËøô‰∏™ message ÊîæÂÖ•Âà∞ pool ‰∏≠„ÄÇËøô‰∏™Êó∂ÂÄôÔºåmessage Â∑≤ÁªèÂºÄÂßã„ÄåÊ≥ÑÊºè„Äç‰∫Ü„ÄÇ ÂÜçÂõûÂà∞ÂâçÈù¢ÔºåDialogFragment#onActivityCreated ÊñπÊ≥ï‰∏≠Ôºå‰ºöË∞ÉÁî® Dialog#setOnCancelListener ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂÜÖÈÉ®Âèà‰ºöÂ∞ùËØï‰ªéÊ∂àÊÅØÊ±†‰∏≠Âèñ‰∏Ä‰∏™ message„ÄÇÂ¶ÇÊûúÂàöÂ•ΩÂèñÂà∞ÁöÑ message ÊòØË¢´Êüê‰∏™ MessageQueue ‰∏∫Á©∫ÁöÑ handlerThread ÁöÑ loop ÊñπÊ≥ï ÔºàÂØπÂ∫îÁöÑÊ†àÂ∏ß‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáèË°®ÔºâÊâÄÂºïÁî®ÁùÄÁöÑÔºåÈÇ£‰πà DialogFragment ÈîÄÊØÅÁöÑÊó∂ÂÄôÔºåLeakCanary Â∞±‰ºöÊä•ÂëäËØ¥ÂÜÖÂ≠òÊ≥ÑÊºè‰∫ßÁîü‰∫Ü„ÄÇ ÈáçÁÇπ üëÜüëÜüëÜ Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö 2.2„ÄÅÂ§çÁé∞Q:Áúã‰∏äÈù¢ÁöÑÊèèËø∞ÔºåËøô‰∏™ÂÜÖÂ≠òÊ≥ÑÊºèË¶ÅËß¶ÂèëÁöÑÊù°‰ª∂ËøòÊòØÊØîËæÉ‰∏•ËãõÁöÑÔºåÊúâ‰ªÄ‰πàÂ§çÁé∞Ë∑ØÂæÑÂêóÔºü A:Âõ†‰∏∫Ëøô‰∏™Ê≥ÑÊºèË∑ü message Â§çÁî®ÊúâÂæàÂ§ßÂÖ≥Á≥ª„ÄÇË¶ÅÂ§çÁé∞Ëøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨ÂèØ‰ª•ÂÖàÁúã‰∏ãÊ∂àÊÅØÊ±†‰∏≠ÁöÑ message message#recycleUnchecked ÊñπÊ≥ï‰ª•Âèä Message#obtain ÊñπÊ≥ï 1234567891011121314151617181920212223242526void recycleUnchecked() &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; next = sPool; //Áõ∏ÂΩì‰∫éÊèíÂÖ•ÈòüÂ§¥ sPool = this; sPoolSize++; &#125; &#125;&#125;public static Message obtain() &#123; synchronized (sPoolSync) &#123; if (sPool != null) &#123; //ÂèñÂá∫ÈòüÈ¶ñÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥† Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // clear in-use flag sPoolSize--; return m; &#125; &#125; return new Message();&#125; ‰ªé üëÜ ‰∏§‰∏™ÊñπÊ≥ïÂèØ‰ª•ÁúãÂá∫Ôºö Message ÂõûÊî∂ÁöÑÊó∂ÂÄôÔºå‰ºöÊèíÂÖ•ÂõûÊî∂Ê±†ÂàóË°®ÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥† Message ÈáçÁî®ÁöÑÊó∂ÂÄôÔºå‰ºöÂèñÂá∫ÂõûÊî∂Ê±†ÈìæË°®ÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥† ‰πüÂ∞±ÊòØËØ¥ÔºåÂèñÂá∫ÁöÑ message ‰∏ÄËà¨ÊòØÊúÄÊñ∞ÊèíÂÖ•ÁöÑ„ÄÇÂõ†Ê≠§ÔºåÂèØ‰ª•Â∞ùËØï‰ΩøÁî®Â¶Ç‰∏ã‰ª£Á†ÅËøõË°åÂ§çÁé∞„ÄÇ 123456789101112131415161718192021222324class MainActivity : AppCompatActivity() &#123; //Êñ∞Âª∫‰∏Ä‰∏™Âêç‰∏∫ BackgroundThread ÁöÑHandlerThread private val background = HandlerThread("BackgroundThread") .apply &#123; start() &#125; private val backgroundHandler = Handler(background.looper) override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) setContentView(R.layout.activity_main) mBtnShowNormalDialogFragment.setOnClickListener &#123; //ÂæÄ ÈÄöËøá backgroundHandler ÂæÄ background HandlerThread ‰∏≠ÁöÑ MessageQueue ÊèíÂÖ•‰∏ÄÊù° msg backgroundHandler.post(Runnable &#123; //Ë∞ÉÁî® runOnUiThreadÔºåÂæÄ‰∏ªÁ∫øÁ®ãÁöÑ MessageQueue ÊèíÂÖ•‰∏ÄÊù° msg„ÄÇÂõ†‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂπ∂Èùû‰∏ªÁ∫øÁ®ãÔºåÂõ†Ê≠§‰ºöÂæÄ‰∏ªÁ∫øÁ®ãÈòüÂàó‰∏≠ post ‰∏Ä‰∏™ Message(Ëøô‰∏™ message ÂõûÂÖàÂ∞ùËØï‰ªé pool ‰∏≠ÂèñÔºåÂ§ßÊ¶ÇÁéá‰ºöÂèñÂà∞ backgroundHandler ÂàöÂàöÊâßË°åÂÆåË¢´ÂõûÊî∂ÁöÑ message Ôºâ runOnUiThread &#123; val fragment = NormalDialogFragment() fragment.apply &#123; show(supportFragmentManager, "NormalFragment") &#125; &#125; &#125;) &#125; &#125;&#125; ËøêË°å‰πãÂêéÔºåÁÇπÂáª‰Ωø DialogFragment Ê∂àÂ§±ÔºåÁ≠âÂæÖ 10s Â∑¶Âè≥ÔºåLeakCanary ÂèØËÉΩÂ∞±‰ºöÊä•ÂëäÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò‰∫Ü„ÄÇ 2.3„ÄÅmessage ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂΩ±ÂìçQÔºöÊ≥ÑÊºèÁöÑÂÜÖÂ≠òÊòØÂê¶‰ºö‰∏çÊñ≠Â¢ûÈïøÔºüÊòØÁü≠ÊöÇÊ≥ÑÊºèËøòÊòØÈïøÊó∂Èó¥ÁöÑÊ≥ÑÊºèÔºü Â≠òÂú®Â¢ûÈïøÁöÑÂèØËÉΩÊÄßÔºå‰ΩÜÊòØÊòØÊúâ‰∏äÈôêÁöÑ„ÄÇ - Â¢ûÈïøÁöÑ‰∏äÈôê‰∏ªË¶ÅÁúã Â∫îÁî®‰∏≠ÊúâÂ§öÂ∞ë‰∏™‰πãÂâçÊâßË°åËøá Message ‰ΩÜÊòØÁõÆÂâçÈòüÂàó‰∏∫Á©∫ÁöÑÂ∏¶Êúâ Looper ÁöÑ ThreadÔºåËøôÁßçÁ±ªÂûãÁöÑ Thread Êï∞ÁõÆË∂äÂ§öÔºåMessage Ê≥ÑÊºèÁöÑÊ¶ÇÁéáÂ∞±Ë∂äÈ´ò„ÄÇ - ÂøΩÁï•ÈÇ£‰∫õ‰∏çÊòØÈÄöËøáÁªßÊâø HandlerThread ÂÆûÁé∞ÁöÑ Â∏¶ Looper ÁöÑ Thread„ÄÇTODO app Â∏∏È©ªÁöÑ ‰∏ªË¶ÅÂΩ±ÂìçÁöÑÊòØÁ±ª‰ºº‰∫é Dialog ËøôÁßç‰ªéÊ∂àÊÅØÊ±†‰∏≠Ëé∑Âèñ‰∫Ü Message ‰ΩÜÊòØ‰∏ÄÁõ¥Ê≤°ÊúâË∞ÉÁî® Message#recycle ÊñπÊ≥ïÁöÑÊÉÖÂÜµ„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÈúÄË¶ÅÁ≠âÂæÖÁõ∏Â∫îÁöÑÁ∫øÁ®ãÊúâÊñ∞ÁöÑ Message ÂÖ•ÈòüÂàóÂπ∂‰∏îË¢´ÂèñÂá∫‰πãÂêéÔºåÊâç‰ºöÈáäÊîæ„ÄÇ - Â¶ÇÊûúÊúâË∞ÉÁî® recycleÔºåÂç≥‰Ωø message ‰∏ÄÁõ¥Ë¢´Âè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑ Looper#loop ÊñπÊ≥ï Â±ÄÈÉ®ÂºïÁî®ÁùÄÔºåÁúüÊ≠£Áî®Âà∞ËøôÊù° message Ë¢´ÊâßË°åÂÆåÔºå‰πü‰ºöË∞ÉÁî® Message#recycleUnchecked ÊñπÊ≥ïÂ∞Ü Ê∂àÊÅØÁöÑÂÜÖÂÆπÊ∏ÖÈô§Êéâ„ÄÇ 3„ÄÅËß£ÂÜ≥ÊñπÊ°à3.1„ÄÅÁ≥ªÁªü‰æß Android ÂÆòÊñπÊ∂àÊÅØÊú∫Âà∂‰∏≠Ôºå Java Â±ÇÁöÑ‰ª£Á†Å‰∏≠Â∫îËØ•Âú® Looper#loop ÊñπÊ≥ïÁöÑÊú´Â∞æÔºåÂ∞Ü msg ÂèòÈáèÁΩÆ‰∏∫ null„ÄÇ ART„ÄÅDalvik ‰∏≠ÂΩìÂºïÁî®ÂèòÈáèÊó†ÊïàÊó∂ÔºåÂèØ‰ª•Â∞ÜÂØπÂ∫îÁöÑ slot ÁΩÆ‰∏∫ null 3.2„ÄÅApp ‰æßÁõ∏ÂØπÈÄöÁî®ÁöÑËß£ÂÜ≥ÊñπÊ°à Â¶ÇÊûúÊòØ library ÁöÑÂºÄÂèëËÄÖÔºåËá™Â∑±ÂºÄÂèëÁöÑ library ‰ΩøÁî®Âà∞‰∫Ü HandlerThreadÔºåÊÉ≥Èò≤Ê≠¢Ëá™Â∑±ÁöÑÂ∫ì‰∏≠ÁöÑ HandlerThread ÂºïÂèëÁ±ª‰ººÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢òÔºåÂèØ‰ª•Â∞Ü handlerThread ÁöÑ looper ‰º†ÈÄíÁªô‰∏ãÈù¢ÁöÑ flushStackLocalLeaks ÊñπÊ≥ï„ÄÇ 1234567891011121314/** * Êé•Êî∂ handlerThread ÁöÑ looper * */fun flushStackLocalLeaks(looper: Looper) &#123; val handler = Handler(looper) handler.post &#123; //ÂΩìÈòüÂàóÈó≤ÁΩÆÁöÑÊó∂ÂÄôÔºåÂ∞±ÁªôÂÆÉÂèëÈÄÅÁ©∫ÁöÑ messageÔºå‰ª•Á°Æ‰øù‰∏ç‰ºöÂèëÁîü message ÂÜÖÂ≠òÊ≥ÑÊºè Looper.myQueue().addIdleHandler &#123; handler.sendMessageDelayed(handler.obtainMessage(), 1000) //ËøîÂõû trueÔºå‰∏ç‰ºöËá™Âä®ÁßªÈô§ return@addIdleHandler true &#125; &#125;&#125; ÈíàÂØπ appÔºåÂèØ‰ª•ÈÄöËøá Thread.getAllStackTraces().keys ÊñπÊ≥ïËé∑ÂèñÊâÄÊúâÁöÑÁ∫øÁ®ã„ÄÇËø≠‰ª£ÈÅçÂéÜÔºåÂà§Êñ≠Á∫øÁ®ãÊòØÂê¶‰∏∫ HandlerThreadÔºåÂ¶ÇÊûúÊòØÔºåÂàôË∞ÉÁî®‰∏äÈù¢ÁöÑ flushStackLocalLeaks ÊñπÊ≥ï„ÄÇÈááÁî®ËøôÁßçÊñπÊ°àË¶ÅÊ≥®ÊÑèÁöÑÁÇπÊòØÔºåË¶ÅÊ≥®ÊÑèË∞ÉÁî®Êó∂Êú∫ÔºåÁ°Æ‰øùË∞ÉÁî®ÁöÑÊó∂ÂÄôÊâÄÊúâÁöÑ HandlerThread ÈÉΩÂ∑≤ÁªèÂêØÂä®‰∫ÜÔºå‰∏çÁÑ∂‰ºöÊúâÈÅóÊºèÁöÑÊÉÖÂÜµ„ÄÇ 123456Thread.getAllStackTraces().keys.*forEach* &#123; thread -&gt; if (thread is HandlerThread &amp;&amp; thread.isAlive) &#123; //Ê∑ªÂä† IdleHandler flushStackLocalLeaks(thread.looper) &#125;&#125; ‰ΩÜÊòØËøôÁßçÊñπÊ°à‰πüÂ≠òÂú®‰∏çË∂≥ÁöÑÂú∞ÊñπÔºö App ‰∏≠ÂèØËÉΩÂ≠òÂú®Â∏¶Êúâ Looper Âíå MessageQueue ÁöÑ Thread ‰ΩÜÂèà‰∏çÊòØÈÄöËøáÁªßÊâø HandlerThread Êù•ÂÆûÁé∞ÁöÑÔºåÈúÄË¶ÅÁî®Êõ¥ÈÄöÁî®ÁöÑÂà§Êñ≠ÊñπÂºè„ÄÇ Looper ÊòØÂ≠òÂú® Thread ÁöÑ threadLocalMap ÈáåÈù¢ÁöÑÔºå‰ªÖÈÄöËøáÁ∫øÁ®ãÂÆû‰æãÂØπË±°ÔºåÂπ∂‰∏çÊòØÂæàÂ•ΩËé∑Âèñ„ÄÇ Á≥ªÁªüÁâàÊú¨ÈôêÂà∂„ÄÇ Looper#getQueue ÊñπÊ≥ïÊòØ API Level 23 ÊâçÊ∑ªÂä†ÁöÑ Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÁõ¥Êé•Áî®ËøôÁßçÊñπÂºèÊó†Ê≥ïÊ∂µÁõñ &lt;= Android 5.1 ÁâàÊú¨ÁöÑÁ≥ªÁªü„ÄÇ Looper#myQueue ÊñπÊ≥ïÊ≤°Êúâ API ÈôêÂà∂Ôºå‰ΩÜÊòØÂÆÉÂè™ËÉΩÊãøÂà∞ÂΩìÂâçÁ∫øÁ®ãÁöÑ queueÔºåÊ≤°Ê≥ïÈÄöËøáÁ∫øÁ®ãÂÆû‰æãÂéªËé∑Âèñ queue ÈíàÂØπÁâàÊú¨ &lt; 6.0 ÁöÑÊâãÊú∫ÔºåÂèØ‰ª•ËÄÉËôëÈÄöËøáÂèçÂ∞ÑËé∑Âèñ Looper#mQueue Â≠óÊÆµËß£ÂÜ≥ Âè™ÈíàÂØπ Dialog/DialogFragment Ê≥ÑÊºèÁöÑËß£ÂÜ≥ÊñπÊ°àÔºö Âú®‰øùËØÅ Dialog ÂéüÊúâÁöÑÂ§çÁî®ÂäüËÉΩÊ≠£Â∏∏ËøêË°åÁöÑÂâçÊèê‰∏ãÔºöÊúâ‰∏§‰∏™ÊÄùË∑ØÔºö ÊÄùË∑ØÔºö‰ªé pool ‰∏≠ÂèñÂá∫ÁöÑ message ÊúâÂèØËÉΩÊòØË¢´ÂÖ∂‰ªñÊüê‰∏™ HandlerThread ÂºïÁî®ÁùÄÁöÑÔºåÈÇ£Êàë‰ª¨‰∏çË¶Å‰ªé pool ‰∏≠ÂèñÊ∂àÊÅØÔºåËÄåÊòØÁõ¥Êé• new Message ‰∏çÂ∞±Ê≤°ÊúâËøô‰∏™ÈóÆÈ¢ò‰∫ÜÂêóÔºü Êü•Áúã Dialog Ê∫êÁ†Å mCancelMessage mDismissMessage mShowMessage ËÆøÈóÆÊùÉÈôêÈÉΩÊòØ private ÁöÑÔºåËôΩÁÑ∂ÂèØ‰ª•ÈÄöËøáÁªßÊâøÈáçÂÜô setOnXxxListener ÊñπÊ≥ïÔºå‰ΩÜÊòØ‰∏ç‰ΩøÁî®ÂèçÂ∞ÑÁöÑËØùÔºåÊó†Ê≥ï‰∏∫ mCancelMessage ËµãÂÄº„ÄÇ ÂèçÂ∞ÑÊúâÁÇπ hackÔºåÊàë‰ª¨‰ºòÂÖàÁúãÁúãÊòØÂê¶ÊúâÂà´ÁöÑÊñπÊ°à„ÄÇ Dialog ‰∏≠ËøòÊúâ Dialog#setCancelMessage„ÄÅ‰ª•Âèä setDismissMessage ÊñπÊ≥ïÔºåÂèØ‰ª•ÂÆûÁé∞ÂØπ cancelMessage Âíå dismissMessage ËµãÂÄºÔºå‰ΩÜÊòØÊ≤°Êúâ setShowMessage ËøôÊ†∑ÁöÑÊñπÊ≥ï„ÄÇËøôÁßçÊñπÂºèË¶ÜÁõñ‰∏çÂÖ®Èù¢„ÄÇ Âè¶‰∏ÄÁßçÊÄùË∑ØÔºåÂàáÊñ≠ÂºïÁî®Èìæ ÂÆö‰πâ‰∏Ä‰∏™ÁªßÊâøËá™ Dialog ÁöÑ AvoidLeakDialog ÈáçÂÜô setOnDismissListener setOnShowListener setOnCancelListener ÊñπÊ≥ïÔºåÂ∞Ü‰º†ÂÖ•ÁöÑ Listener ÂåÖË£Ö‰∏ÄÂ±Ç„ÄÇÂêåÊó∂‰∏∫‰∫ÜÈÅøÂÖç Listener ÂèòÈáèÂõ†‰∏∫‰ªÖË¢´Âº±ÂºïÁî®ËÄÖÔºåÂØºËá¥Âú® GC ÁöÑÊó∂ÂÄôË¢´ÊèêÂâçÂõûÊî∂ÔºåËøòÂ∫îËØ•Ê∑ªÂä†Âú® ÈáçÂÜôÁöÑ Dialog ‰∏≠Ê∑ªÂä†‰∏â‰∏™ÊàêÂëòÂèòÈáèÔºåÂ≠òÂÇ®ÂØπÂ∫î Listener ÁöÑÂÄº„ÄÇÁÑ∂ÂêéÂÆö‰πâ‰∏Ä‰∏™ DialogFragment ÁöÑÂ≠êÁ±ªÔºåAvoidfLeakDialogFragmentÔºåÈáçÂÜô onCreateDialog ÊñπÊ≥ïÔºåËøîÂõûËá™ÂÆö‰πâÁöÑ Dialog„ÄÇ ‰ª• setOnShowListener ÊñπÊ≥ï‰∏∫‰æãÔºåÂåÖË£ÖÁ±ªÂ¶Ç‰∏ãÔºö 1234567class WrappedShowListener(delegate: DialogInterface.OnShowListener?) : DialogInterface.OnShowListener &#123; private var weakRef = WeakReference(delegate) override fun onShow(dialog: DialogInterface?) &#123; weakRef.get()?.onShow(dialog) &#125;&#125; ÊúÄÁªà‰ª£Á†ÅÔºö AvoidLeakDialog AvoidLeakFragment ÈôÑÔºöÂÖ∂‰ªñËß£ÂÜ≥ÊñπÊ°à square ‰ª•ÂèäÂÖ∂‰ªñÁΩë‰∏äÁöÑÊñáÁ´†‰∏≠ÔºåÊúâ‰∏ÄÁßçËß£ÂÜ≥ÊñπÊ°àÔºåÊòØÂ∞ÜËÆæÁΩÆÁªô Dialog ÁöÑ Listener ÂåÖË£Ö‰∏ÄÂ±Ç‰∏∫ ClearOnDetachListener ÔºåÁÑ∂Âêé‰∏öÂä°ÊñπË∞ÉÁî® Dialog#show ÊñπÊ≥ï‰πãÂêéÔºåÂÜçÂéªÊâãÂä® clearOnDetach ÊñπÊ≥ï„ÄÇ ËøôÁßçÊñπÊ≥ïÁ°ÆÂÆûÂèØ‰ª•Ëß£ÂÜ≥ÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØÂ≠òÂú®ËøôÊ†∑ÁöÑÈóÆÈ¢òÔºöÂú® dialog Ë∞ÉÁî® dimiss ÊñπÊ≥ï‰πãÂêéÔºåÂÜçË∞ÉÁî® show ÊñπÊ≥ïÁöÑËØùÔºåÂéüÊù•ËÆæÁΩÆÁöÑ Listener Â∞±Â§±Êïà‰∫Ü„ÄÇ 123456789101112131415161718192021222324/** * https://medium.com/square-corner-blog/a-small-leak-will-sink-a-great-ship-efbae00f9a0f * square ÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇView detach ÁöÑÊó∂ÂÄôÂ∞±Â∞ÜÂºïÁî®ÁΩÆ‰∏∫ null ‰∫ÜÔºå * ‰ºöÂØºËá¥ Dialog ÈáçÊñ∞ÊòæÁ§∫ÁöÑÊó∂ÂÄôÔºåÂéüÊù•ËÆæÁΩÆÁöÑ Listener Êî∂‰∏çÂà∞ÂõûË∞É * * Âú® show ‰πãÂêéÔºåË∞ÉÁî® clearOnDetach * */class ClearOnDetachListener(private var delegate: DialogInterface.OnClickListener?) : DialogInterface.OnClickListener &#123; override fun onClick(dialog: DialogInterface?, which: Int) &#123; delegate?.onClick(dialog, which) &#125; fun clearOnDetach(dialog: Dialog) &#123; dialog.*window*?.*decorView*?.*viewTreeObserver*?.addOnWindowAttachListener(object : ViewTreeObserver.OnWindowAttachListener &#123; override fun onWindowDetached() &#123; Log.d(*TAG*, "onWindowDetached: ") delegate = null &#125; override fun onWindowAttached() &#123; &#125; &#125;) &#125;&#125; ‰ΩøÁî®ÊñπÂºè 123456val clearOnDetachListener = ClearOnDetachListener(DialogInterface.OnClickListener **&#123;** dialog, which **-&gt; &#123;&#125; &#125;**)val dialog = AlertDialog.Builder(this) .setPositiveButton("sure", clearOnDetachListener) .show()clearOnDetachListener.clearOnDetach(dialog) 4„ÄÅÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê https://medium.com/square-corner-blog/a-small-leak-will-sink-a-great-ship-efbae00f9a0f „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>ÂÜÖÂ≠òÊ≥ÑÊºè</tag>
        <tag>Ê∫êÁ†ÅÂàÜÊûê</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰∏∫‰ªÄ‰πàÊé®Ëçê‰ΩøÁî®ÁªÜÁ≤íÂ∫¶ÁöÑÈÄöÁü•ÊñπÊ≥ïÊõ¥Êñ∞ RecyclerViewÔºü]]></title>
    <url>%2Fblog%2F2020%2F05%2F29%2F%E6%BA%90%E7%A0%81%E8%A7%92%E5%BA%A6%E5%88%86%E6%9E%90%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E7%BB%86%E7%B2%92%E5%BA%A6%E7%9A%84%E9%80%9A%E7%9F%A5%E6%96%B9%E6%B3%95%E6%9B%B4%E6%96%B0RecyclerView%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[‰∏∫‰ªÄ‰πàÊàë‰ª¨Âú®ÊúâÊï∞ÊçÆÂà∑Êñ∞ÁöÑÊó∂ÂÄôÊé®ËçêÂ§ßÂÆ∂‰ΩøÁî® notifyItemXxxChanged Á≠âÊñπÊ≥ïËÄå‰∏çÊòØ‰ΩøÁî® notifyDataSetChanged ÊñπÊ≥ïÂë¢Ôºü Âõ†‰∏∫ Âú®Ë∞ÉÁî® notifyDataSetChanged ÊñπÊ≥ïÂêéÔºåÊâÄÊúâÁöÑÂ≠ê view ÔºàÊó†ËÆ∫ÊòØÂê¶ÁúüÁöÑÈúÄË¶ÅÊõ¥Êñ∞ÔºâÈÉΩ‰ºöË¢´Ê∑ªÂä†‰∏Ä‰∏™Ê†áËÆ∞ÔºåËøô‰∏™Ê†áËÆ∞ÂØºËá¥ÂÆÉ‰ª¨ÊúÄÂêéÈÉΩË¢´ÁºìÂ≠òÂà∞ RecyclerPool ‰∏≠ÔºåÁÑ∂ÂêéÈáçÊñ∞ÁªëÂÆöÊï∞ÊçÆ„ÄÇÂπ∂‰∏îÁî±‰∫é RecyclerPool ÊúâÂÆπÈáèÈôêÂà∂ÔºåÂ¶ÇÊûú‰∏çÂ§üÊúÄÂêéÂ∞±Ë¶ÅÈáçÊñ∞ÂàõÂª∫Êñ∞ÁöÑËßÜÂõæ‰∫Ü„ÄÇ ‰ΩÜÊòØ‰ΩøÁî® notifyItemXxxChanged Á≠âÊñπÊ≥ï‰ºöÂ∞Ü ViewHolder ÁºìÂ≠òÂà∞ mChangedScrap Âíå mAttachedScrap ‰∏≠ÔºåËøô‰∏§‰∏™ÁºìÂ≠òÊòØÊ≤°ÊúâÂÆπÈáèÈôêÂà∂ÁöÑÔºåÊâÄ‰ª•ÂéüÊúâÁöÑ ViewHolder ÂèØ‰ª•ÂæóÂà∞ÊúÄÂ§ßÁ®ãÂ∫¶ÁöÑÂ§çÁî®ÔºåÂü∫Êú¨‰∏çÈúÄË¶ÅÈáçÊñ∞ÂàõÂª∫Êñ∞ÁöÑ ViewHolderÔºåÂè™ÊòØ mChangedScrap ‰∏≠ÁöÑËßÜÂõæÈúÄË¶ÅÈáçÊñ∞ÊâßË°å bind„ÄÇ ÂàÜÊûê1„ÄÅRecyclerView ‰∏≠ÁöÑËßÇÂØüËÄÖÊ®°Âºè‰∏ÄËà¨Êàë‰ª¨ÈÉΩÊòØË∞ÉÁî® Adapter#notifyXxx ÊñπÊ≥ïÈÄöÁü•Êï∞ÊçÆÂèòÊõ¥ÔºåÁÑ∂Âêé RecyclerView ‰ºöÂà∑Êñ∞ÔºåËøôÁßçÊú∫Âà∂Áúã‰∏äÂéªÊòØ‰∏çÊòØÊúâÁÇπÁúºÁÜüÔºüÊòØÁöÑÔºåRecyclerView ‰∏≠‰ΩøÁî®Âà∞‰∫ÜÊàë‰ª¨Â∏∏ËßÅÁöÑËßÇÂØüËÄÖÊ®°Âºè„ÄÇ Â¶Ç‰∏ãÊó∂Â∫èÂõæÊâÄÁ§∫Ôºö ËØ¥Êòé Adapter ‰∏≠ÁöÑÊï∞ÊçÆÊòØË¢´ËßÇÂØüËÄÖÔºå‰πüÂ∞±ÊòØ‰∏äÂõæ‰∏≠ÁöÑ AdapterDataObservable„ÄÇ RecyclerViewDataObserver ÊòØËßÇÂØüËÄÖÔºåÂú®Êï∞ÊçÆÈõÜÂèòÂåñÊó∂ÂÅöÂá∫ÂØπÂ∫îÁöÑÂìçÂ∫î„ÄÇRecyclerView ÈÄöËøáÁªÑÂêàÁöÑÊñπÂºè‰ΩøÁî®Âà∞Ëøô‰∏™Á±ª„ÄÇ Ê≥®ÂÜåËøáÁ®ãÔºöÂ§ñÈÉ®Ë∞ÉÁî® RecyclerView#setAdapter ÊñπÊ≥ïÁöÑÊó∂ÂÄôÔºåRecyclerView ‰ºöÂ∞ÜËá™Ë∫´ÁöÑ‰∏Ä‰∏™ RecyclerViewDataObserver ÂÆû‰æãÊ≥®ÂÜå‰∏∫ÁõëÂê¨ËÄÖ„ÄÇ ÈÄöÁü•ËøáÁ®ãÔºöÂ§ñÈÉ®Ë∞ÉÁî® Adapter#notifyXxxChanged ÊñπÊ≥ïÊó∂Ôºå‰ºöËß¶Âèë AdapterDataObservable#notifyXxxChangedÔºåÊúÄÁªàÈÄöÁü•Âà∞‰∏äÈù¢Ê≥®ÂÜåÁöÑ RecyclerViewDataObserver ÂØπÂ∫îÁöÑÊñπÊ≥ï„ÄÇ 2„ÄÅnotifyDataSetChanged‰ª• notifyDataSetChanged ÊñπÊ≥ï‰∏∫‰æãÔºåËØ•ÊñπÊ≥ïÊúÄÁªà‰ºöË∞ÉÁî®Âà∞ RecyclerViewDataObserver#onChanged ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ï‰ºöÂ§ÑÁêÜÁªìÊûÑÊÄßÂèòÂåñ „ÄÇÂÖ∑‰ΩìÂÆûÁé∞‰Ωç‰∫é processDataSetCompletelyChange ÊñπÊ≥ï‰∏≠ÔºåËØ•ÊñπÊ≥ï‰ºöË∞ÉÁî®RecyclerView#markKnownViewsInvalid Â∞Ü ViewHolder Ê†áËÆ∞‰∏∫ invalid„ÄÇ 12345678910111213void markKnownViewsInvalid() &#123; final int childCount = mChildHelper.getUnfilteredChildCount(); for (int i = 0; i &lt; childCount; i++) &#123; final ViewHolder holder = getChildViewHolderInt(mChildHelper.getUnfilteredChildAt(i)); if (holder != null &amp;&amp; !holder.shouldIgnore()) &#123; //Â∞ÜÂΩìÂâç RecyclerView ÁöÑÊâÄÊúâÂ≠ê ViewHolder Ê∑ªÂä† FLAG_UPDATE Âíå FLAG_INVALID Ê†áËÆ∞ holder.addFlags(ViewHolder.FLAG_UPDATE | ViewHolder.FLAG_INVALID); &#125; &#125; markItemDecorInsetsDirty(); //ÂØπ mCachedView ‰∏≠ÁöÑÂ≠ê ViewHolder Ê∑ªÂä† FLAG_UPDATE Âíå FLAG_INVALID Ê†áËÆ∞ mRecycler.markKnownViewsInvalid();&#125; Ëøô‰∏§‰∏™Ê†áËÆ∞ÔºàFLAG_UPDATE„ÄÅFLAG_INVALIDÔºâ‰∏éÂêéÁª≠ÁöÑÊõ¥Êñ∞‰ª•ÂèäÁºìÂ≠òÊúâÂæàÂ§ßÁöÑÂÖ≥Á≥ªÔºàÂú®ÂêéÈù¢ÂÜÖÂÆπ‰ºöËØ¥ÊòéÔºâ ÈáçÁÇπüëÜüëÜüëÜ ÂÅáËÆæÊ≠§Êó∂Ê≤°Êúâ pendingUpdateÔºàÊ≥®ÔºöAdapterHelper#mPendingUpdates ‰∏≠Â≠òÂÇ®ÁùÄÂ§ñÈÉ®Ë∞ÉÁî® notifyXxx ÊñπÊ≥ïËß¶ÂèëÁöÑ UpdateOpÔºå‰∏Ä‰∏™ UpdateOp ÂØπÂ∫î‰∏ÄÊ¨°Êõ¥Êñ∞Êìç‰ΩúÔºâ Ôºå‰ºöËß¶Âèë requestLayout„ÄÇ ÊúÄÁªàË∞ÉÁî®Âà∞ ViewRootImpl#requestLayoutÔºåËß¶Âèë scheduleTraversalsÔºåÁ≠â‰∏ã‰∏ÄÊ¨°ÂûÇÁõ¥‰ø°Âè∑ËøáÊù•ÁöÑÊó∂ÂÄôÔºåËß¶Âèë performTraversalÔºåÈáçÊñ∞ËøõË°åÂ∏ÉÂ±Ä„ÄÇ ‰πüÂ∞±ÊòØËØ¥‰ºöË∞ÉÁî®Âà∞ RecyclerView#dispatchLayout ÊñπÊ≥ïÔºåÁÑ∂ÂêéËß¶Âèë dispatchLayoutStep1„ÄÅ2„ÄÅ3„ÄÇÊ≠•È™§ 2 ‰ºöËß¶Âèë LayoutManager#onLayoutChildren ÔºàÂºÄÂêØÈ¢ÑÊµãÂä®ÁîªÁöÑÊÉÖÂÜµ‰∏ãÔºåÊ≠•È™§ 1 ‰πü‰ºöËß¶Âèë onLayoutChildrenÔºâ ‰ª• LinearLayoutManager ‰∏∫‰æãÔºåonLayoutChildren ÊñπÊ≥ïÂÜÖÈÉ®‰ºöË∞ÉÁî® detachAndScrapAttachedViews ÊñπÊ≥ï 1234567public void detachAndScrapAttachedViews(@NonNull Recycler recycler) &#123; final int childCount = getChildCount(); for (int i = childCount - 1; i &gt;= 0; i--) &#123; final View v = getChildAt(i); scrapOrRecycleView(recycler, i, v); &#125;&#125; 123456789101112131415private void scrapOrRecycleView(Recycler recycler, int index, View view) &#123; final ViewHolder viewHolder = getChildViewHolderInt(view); //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å //ÂâçÈù¢ÁöÑÊ†áÂøó‰ΩçÔºåÂú®ËøôÁî®Âà∞‰∫Ü„ÄÇ //Â¶ÇÊûú‰∏∫ invalid Âπ∂‰∏îÊ≤°ÊúâË¢´ removed Âπ∂‰∏î Ê≤°ÊúâstableIdÔºàÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÈÉΩ‰∏ç‰ºöËÆæÁΩÆ stableIdÔºâÔºåÂõ†Ê≠§ÔºåË∞ÉÁî® notifyDatasetChange ÊñπÊ≥ïÔºå‰ºöËµ∞Âà∞üëáËøô‰∏™ if ÂàÜÊîØÔºåÂ∞Ü ViewHolder Ê∑ªÂä†Âà∞ RecyclerViewPool ‰∏≠„ÄÇ if (viewHolder.isInvalid() &amp;&amp; !viewHolder.isRemoved() &amp;&amp; !mRecyclerView.mAdapter.hasStableIds()) &#123; removeViewAt(index); recycler.recycleViewHolderInternal(viewHolder); &#125; else &#123; detachViewAt(index); recycler.scrapView(view); mRecyclerView.mViewInfoStore.onViewDetached(viewHolder); &#125;&#125; ‰πüÂ∞±ÊòØËØ¥ÔºåÊ≤°ÊúâÁªô Adapter ËÆæÁΩÆ hasStableId ÁöÑÊÉÖÂÜµ‰∏ãÔºånotifyDataSetChange ÊñπÊ≥ïËß¶ÂèëÁöÑÊõ¥Êñ∞Ôºå‰ºö‰Ωø ViewHolder Ë¢´ÊîæÂà∞ RecycledViewPool ‰∏≠ÔºåËÄåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåRecycledViewPool ‰∏≠ÊØèÁßç itemType ÁöÑ ViewHolder ÁºìÂ≠ò‰∏äÈôê‰∏∫ 5 ‰∏™ÔºåÂ¶ÇÊûúÂ±èÂπïÊòæÁ§∫ÁöÑViewHolder ÂØπÂ∫îÁöÑ itemType ÊØîËæÉÂçï‰∏ÄÔºåÂπ∂‰∏îÊòæÁ§∫ÁöÑ‰∏™Êï∞Ë∂ÖËøá 5 ‰∏™ÔºåÂÅáËÆæÂ±èÂπï‰∏≠ÊòæÁ§∫ÁöÑÁõ∏Âêå itemType ÁöÑ ViewHolder ‰∏™Êï∞‰∏∫ nÔºåÈÇ£‰πàÂ∞Ü‰ºöÊúâ n-5 ‰∏™ ViewHolder Âõ†‰∏∫ÁºìÂ≠òÊª°‰∫ÜÔºåËÄåÊó†Ê≥ïÊîæÂÖ• RecyclerViewPoolÔºå‰πüÂ∞±‰∏çËÉΩÂ§çÁî®‰∫ÜÔºåËøôÂ∞ÜÂØºËá¥ÂêéÁª≠ÈúÄË¶ÅÈáçÊñ∞ÂàõÂª∫Áõ∏Â∫îÁöÑ ViewHolder„ÄÇ üëÜüëÜüëÜ ÂàíÈáçÁÇπÔºÅ 3„ÄÅnotifyItemXxxChangeÁªÜÁ≤íÂ∫¶ÁöÑÊõ¥Êñ∞ÊñπÊ≥ïÔºåÊï¥‰ΩìÊÄùË∑ØÔºåÊüê‰∏Ä‰∏™/Â§ö‰∏™ item ÂèòÂåñ‰∫ÜÔºåÈÇ£‰πàÈÄöÁü•ÂØπÂ∫îÁöÑ item ÔºåËØ∂ÔºåËÄÅÈìÅÔºåÊï∞ÊçÆÊõ¥Êñ∞‰∫ÜÔºå‰Ω†ÂæóÈáçÊñ∞ÊâßË°å‰∏ÄÊ¨° bindViewHolder„ÄÇ ÂÜçÊù•ÁúãÁúã notifyItemChangeÔºåÊúÄÁªà‰πü‰ºöË∞ÉÁî®Âà∞ RecyclerViewDataObserver#onItemRangeChanged ÔºåÈ¶ñÂÖàËß¶Âèë AdapterHelper#onItemRangeChangedÔºåÂæÄÈòüÂàó‰∏≠Ê∑ªÂä†‰∏Ä‰∏™ update Êìç‰Ωú„ÄÇÂ¶ÇÊûú mPendingUpdates ÈòüÂàó‰∏≠Âè™Êúâ‰∏Ä‰∏™ itemÔºåÈÇ£‰πàÁõ¥Êé•Ë∞ÉÁî® RecyclerView#requestLayout ÔºåÁõëÂê¨‰∏ã‰∏Ä‰∏™ÂûÇÁõ¥ÂêåÊ≠•‰ø°Âè∑ÔºåËøõË°åÂà∑Êñ∞ 123456789//AdapterHelper#onItemRangeChangedboolean onItemRangeChanged(int positionStart, int itemCount, Object payload) &#123; if (itemCount &lt; 1) &#123; return false; &#125; mPendingUpdates.add(obtainUpdateOp(UpdateOp.UPDATE, positionStart, itemCount, payload)); mExistingUpdateTypes |= UpdateOp.UPDATE; return mPendingUpdates.size() == 1;&#125; Q:ÂèØ‰ª•ÁúãÂà∞‰∏äÈù¢Ëøô‰∏™ÊñπÊ≥ïÂæÄÈòüÂàó‰∏≠Ê∑ªÂä†‰∫Ü‰∏Ä‰∏™ UpdateOpÔºåÂú®Âì™ÈáåÂèñÂá∫Êù•ÊâßË°åÂë¢Ôºü A: ‰ºö‰ªé AdapterHelper#consumePostponedUpdates ÊñπÊ≥ï‰∏≠ÂèñÂá∫ÈÄöÁü• Callback ÂéªÊâßË°å„ÄÇ 123456789101112131415161718192021void consumeUpdatesInOnePass() &#123; // we still consume postponed updates (if there is) in case there was a pre-process call // w/o a matching consumePostponedUpdates. consumePostponedUpdates(); final int count = mPendingUpdates.size(); for (int i = 0; i &lt; count; i++) &#123; UpdateOp op = mPendingUpdates.get(i); switch (op.cmd) &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å case UpdateOp.UPDATE: mCallback.onDispatchSecondPass(op); mCallback.markViewHoldersUpdated(op.positionStart, op.itemCount, op.payload); break; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å &#125; if (mOnItemProcessedCallback != null) &#123; mOnItemProcessedCallback.run(); &#125; &#125; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å&#125; Ëøô‰∏™ AdapterHelper#mCallback Ëøô‰∏™ÊàêÂëòÂèòÈáèÊòØÂú®‰ªÄ‰πàÊó∂ÂÄôËµãÂÄºÁöÑÔºüÂèØ‰ª•ÁúãÂà∞AdapterHelper ÊûÑÈÄ†ÂáΩÊï∞Êé•Âèó‰∏Ä‰∏™ Callback ÂèÇÊï∞„ÄÇÂΩì RecyclerView Âú®ÂàùÂßãÂåñÊó∂Ôºå‰ºöË∞ÉÁî® RecyclerView#initAdapterManagerÔºåÂàõÂª∫‰∏Ä‰∏™ AdapterHelperÔºåÊ≠§Êó∂‰ºöÈÄöËøáÂàõÂª∫ÂåøÂêçÂÜÖÈÉ®Á±ªÁöÑÊñπÂºèÊûÑÈÄ†‰∏Ä‰∏™ Callback ÂÆû‰æãÔºå‰º†ÈÄíÁªô AdapterHelperÔºåAdapterHelper Âú®Ê∂àË¥πÊìç‰ΩúÂ∫èÂàóÁöÑÊó∂ÂÄôÔºå‰ºöË∞ÉÁî® Callback Áõ∏Â∫îÁöÑÊñπÊ≥ï„ÄÇ ÂõûÂΩí‰∏ªÁ∫øÔºåÊàë‰ª¨Ë∞ÉÁî®‰∫Ü notifyItemChange ÊñπÊ≥ïÔºå‰ºöËß¶Âèë CallBack ÁöÑ onDispatchSecondPass Âíå markViewHoldersUpdated„ÄÇË∑ü‰∏äÈù¢ÁöÑ notifyDataSetChange ÊñπÊ≥ïÁ±ª‰ººÔºåËøôÈáåÊúÄÁªà‰πüËß¶Âèë‰∫Ü‰∏Ä‰∏™ viewHolder ÁöÑÊ†áËÆ∞Ë°å‰∏∫ÔºåËøô‰∏™Ê†áËÆ∞ÊòØÈÄöËøáË∞ÉÁî® RecyclerView#viewRangeUpdate ÂÆåÊàêÁöÑ„ÄÇÂè™‰∏çËøá 1234567891011121314151617181920// RecyclerView#viewRangeUpdatevoid viewRangeUpdate(int positionStart, int itemCount, Object payload) &#123; final int childCount = mChildHelper.getUnfilteredChildCount(); final int positionEnd = positionStart + itemCount; for (int i = 0; i &lt; childCount; i++) &#123; final View child = mChildHelper.getUnfilteredChildAt(i); final ViewHolder holder = getChildViewHolderInt(child); if (holder == null || holder.shouldIgnore()) &#123; continue; &#125; if (holder.mPosition &gt;= positionStart &amp;&amp; holder.mPosition &lt; positionEnd) &#123; //Ê†áËÆ∞‰∏∫ FLAG_UPDATE holder.addFlags(ViewHolder.FLAG_UPDATE); //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å &#125; &#125; // ÂêåÊó∂‰πü‰ºöÁªô RecyclerView.Recycler#mCachedViews ‰∏≠ÁöÑ‰Ωç‰∫éÂå∫Èó¥ÂÜÖÁöÑ ViewHolder Âä†‰∏ä ViewHolder.FLAG_UPDATE Ê†áËÆ∞Ôºå mRecycler.viewRangeUpdate(positionStart, itemCount);&#125; ÁªÜÁ≤íÂ∫¶ÈÄöÁü•ÁöÑÊñπÊ≥ïÔºå‰πü‰ºöÁªô ViewHolder Êâì‰∏ä‰∏Ä‰∏™ flagÔºåÂè™ÊòØËøô‰∏™ flag ÁöÑÂÄºË∑ü notifyDataSetChange ÊñπÊ≥ïÈÄöÁü•Êõ¥Êñ∞Êó∂‰∏çÂêå„ÄÇ Ëøô‰∏™ flag Âï•Êó∂ÂÄô‰ºöÊ¥æ‰∏äÁî®Âú∫Âë¢Ôºü ÁªÜÁ≤íÂ∫¶ÈÄöÁü•ÂêåÊ†∑‰ºöËß¶ÂèëÂ∏ÉÂ±ÄÔºåË∞ÉÁî®Âà∞ onLayoutChildren ÊñπÊ≥ïÔºåÊúÄÁªà‰πü‰ºöËß¶ÂèëÂâçÈù¢ÊèêÂà∞ÁöÑ scrapOrRecycleView 12345678910111213private void scrapOrRecycleView(Recycler recycler, int index, View view) &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å if (viewHolder.isInvalid() &amp;&amp; !viewHolder.isRemoved() &amp;&amp; !mRecyclerView.mAdapter.hasStableIds()) &#123; removeViewAt(index); recycler.recycleViewHolderInternal(viewHolder); &#125; else &#123; //Âõ†‰∏∫Ê∑ªÂä†ÁöÑ flag ÊòØ FLAG_UPDATE Ôºå‰ºöËµ∞Âà∞Ëøô‰∏™ÈÄªËæëÂàÜÊîØ detachViewAt(index); recycler.scrapView(view); mRecyclerView.mViewInfoStore.onViewDetached(viewHolder); &#125;&#125; È¶ñÂÖàË∞ÉÁî® detachViewAt ÊñπÊ≥ïÂ∞Ü ViewHolder ÂØπÂ∫îÁöÑ view ‰∏≠ recyclerView ‰∏≠ÁßªÈô§ÔºåÊ≥®ÊÑèÔºåË∑ü removeView ‰∏çÂêåÁöÑÊòØÔºåËøô‰∏™ÊñπÊ≥ïÂè™ÊòØÂ∞Ü view ‰ªé parent ÁöÑ mChildren Êï∞ÁªÑ‰∏≠ÁßªÈô§ÔºåÂ∞Ü view ÁöÑ parent ÁΩÆ‰∏∫ nullÔºå‰ΩÜÊòØÂπ∂ÈùûÁúüÊ≠£ÁöÑÁßªÈô§ÔºåÂõ†Ê≠§‰∏ç‰ºöËß¶ÂèërequestLayout Âíå invalidate„ÄÇ‰ΩÜÊòØËøôÁßçÁä∂ÊÄÅ‰πüÂè™ÊòØÊöÇÊó∂ÁöÑÔºå‰∏ÄËà¨‰ºöÂæàÂø´Ëß¶Âèë attachViewToParent ÊàñËÄÖÊòØ removeDetachedView„ÄÇ ÂÖ∑‰ΩìÁúã‰∏ã RecyclerView.Recycler#scrapView ÊñπÊ≥ïÔºåÁªô FLAG_UPDATE ÁöÑ ViewHolder ‰ºöË¢´Ê∑ªÂä†Âà∞ mChangedScrap ‰∏≠ÔºåÂêéÁª≠ÈáçÊñ∞ÊâßË°å bind„ÄÇÁÑ∂ÂêéÂÖ∂‰ªñviewÔºå‰ºöË¢´ÊîæÂà∞ mAttachedScrap ‰∏≠„ÄÇÊó†ËÆ∫ÊòØ mAttachedScrap ËøòÊòØ mChangedScrap ÔºåÈÉΩÊ≤°ÊúâÂÆπÈáèÈôêÂà∂ÔºåÂõ†Ê≠§ÔºåÂ±èÂπï‰∏äÁöÑ ViewHolder ÂêéÁª≠ËÉΩÂ§üÂæóÂà∞Êõ¥Â§ßÁ®ãÂ∫¶ÁöÑÂ§çÁî®„ÄÇ 123456789101112131415void scrapView(View view) &#123; final ViewHolder holder = getChildViewHolderInt(view); if (holder.hasAnyOfTheFlags(ViewHolder.FLAG_REMOVED | ViewHolder.FLAG_INVALID) || !holder.isUpdated() || canReuseUpdatedViewHolder(holder)) &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å holder.setScrapContainer(this, false); mAttachedScrap.add(holder); &#125; else &#123; if (mChangedScrap == null) &#123; mChangedScrap = new ArrayList&lt;ViewHolder&gt;(); &#125; holder.setScrapContainer(this, true); mChangedScrap.add(holder); &#125;&#125;]]></content>
      <categories>
        <category>Android</category>
        <category>Ê∫êÁ†ÅÂàÜÊûê</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Ê∑±ÂÖ•ÁêÜËß£ RecyclerView ÁºìÂ≠òÊú∫Âà∂]]></title>
    <url>%2Fblog%2F2020%2F05%2F02%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3RecyclerView%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[‰ΩøÁî® ScrollView ÁöÑÊó∂ÂÄôÔºåÂÆÉÁöÑÊâÄÊúâÂ≠ê view ÈÉΩ‰ºö‰∏ÄÊ¨°ÊÄßË¢´Âä†ËΩΩÂá∫Êù•„ÄÇËÄåÊ≠£Á°Æ‰ΩøÁî® RecyclerView ÂèØ‰ª•ÂÅöÂà∞ÊåâÈúÄÂä†ËΩΩÔºåÊåâÈúÄÁªëÂÆöÔºåÂπ∂ÂÆûÁé∞Â§çÁî®„ÄÇÊú¨Êñá‰∏ªË¶ÅÂàÜÊûê RecyclerView ÁºìÂ≠òÂ§çÁî®ÁöÑÂéüÁêÜ„ÄÇ ‰ªéÁºìÂ≠òËé∑Âèñ ViewHolder ÊµÅÁ®ãÊ¶ÇËßà‰ªéÁºìÂ≠òËé∑ÂèñÁöÑÂ§ßËá¥ÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö ËØ¥ÊòéÔºö Âú®ÂàõÂª∫ ViewHolder ‰πãÂâçÔºåRecyclerView ‰ºöÂÖà‰ªéÁºìÂ≠ò‰∏≠Â∞ùËØïËé∑ÂèñÊòØÂê¶ÊúâÁ¨¶ÂêàË¶ÅÊ±ÇÁöÑ ViewHolderÔºåËØ¶ËßÅ Recycler#tryGetViewHolderForPositionByDeadline ÊñπÊ≥ï Á¨¨‰∏ÄÊ¨°ÔºåÂ∞ùËØï‰ªé mChangedScrap ‰∏≠Ëé∑Âèñ„ÄÇ Âè™ÊúâÂú® mState.isPreLayout() ‰∏∫ true Êó∂Ôºå‰πüÂ∞±ÊòØÈ¢ÑÂ∏ÉÂ±ÄÈò∂ÊÆµÔºåÊâç‰ºöÂÅöËøôÊ¨°Â∞ùËØï„ÄÇ „ÄåÈ¢ÑÂ∏ÉÂ±Ä„ÄçÁöÑÊ¶ÇÂøµ‰ºöÂú®ÂêéÈù¢‰ªãÁªç„ÄÇ Á¨¨‰∫åÊ¨°ÔºågetScrapOrHiddenOrCachedHolderForPosition() Ëé∑Âæó ViewHolder„ÄÇ Â∞ùËØï‰ªé 1. mAttachedScrap 2.mHiddenViews 3.mCachedViews ‰∏≠Êü•Êâæ ViewHolder ÂÖ∂‰∏≠ mAttachedScrap Âíå mCachedViews ÈÉΩÊòØ Recycler ÁöÑÊàêÂëòÂèòÈáè Â¶ÇÊûúÊàêÂäüËé∑Âæó ViewHolder ÂàôÊ£ÄÈ™åÂÖ∂ÊúâÊïàÊÄßÔºå Ëã•Ê£ÄÈ™åÂ§±Ë¥•ÂàôÂ∞ÜÂÖ∂ÂõûÊî∂Âà∞ RecyclerViewPool ‰∏≠ Ê£ÄÈ™åÊàêÂäüÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® Á¨¨‰∏âÊ¨°ÔºåÂ¶ÇÊûúÁªô Adapter ËÆæÁΩÆ‰∫Ü stableIdÔºåË∞ÉÁî® getScrapOrCachedViewForId Â∞ùËØïËé∑Âèñ ViewHolder„ÄÇ Ë∑üÁ¨¨‰∫åÊ¨°ÁöÑÂå∫Âà´Âú®‰∫éÔºå‰πãÂâçÊòØÊ†πÊçÆ position Êü•ÊâæÔºåÁé∞Âú®ÊòØÊ†πÊçÆ id Êü•Êâæ Á¨¨ÂõõÊ¨°ÔºåmViewCacheExtension ‰∏ç‰∏∫Á©∫ÁöÑËØùÔºåÂàôË∞ÉÁî® ViewCacheExtension#getViewForPositionAndType ÊñπÊ≥ïÂ∞ùËØïËé∑Âèñ View Ê≥®ÔºöViewCacheExtension ÊòØÁî±ÂºÄÂèëËÄÖËÆæÁΩÆÁöÑÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰∏∫Á©∫Ôºå‰∏ÄËà¨Êàë‰ª¨‰πü‰∏ç‰ºöËÆæÁΩÆ„ÄÇËøôÂ±ÇÁºìÂ≠òÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÂèØ‰ª•ÂøΩÁï•„ÄÇ Á¨¨‰∫îÊ¨°„ÄÇÂ∞ùËØï‰ªé RecyclerViewPool ‰∏≠Ëé∑ÂèñÔºåÁõ∏ÊØîËæÉ‰∫é mCachedViewsÔºå‰ªé mRecyclerPool ‰∏≠ÊàêÂäüËé∑Âèñ ViewHolder ÂØπË±°ÂêéÂπ∂Ê≤°ÊúâÂÅöÂêàÊ≥ïÊÄßÂíå item ‰ΩçÁΩÆÊ†°È™åÔºåÂè™Ê£ÄÈ™å viewType ÊòØÂê¶‰∏ÄËá¥„ÄÇ ‰ªé RecyclerViewPool ‰∏≠ÂèñÂá∫Êù•ÁöÑ ViewHolder ÈúÄË¶ÅÈáçÊñ∞ÊâßË°å bind ÊâçËÉΩ‰ΩøÁî®„ÄÇ Â¶ÇÊûú‰∏äÈù¢‰∫îÊ¨°Â∞ùËØïÈÉΩÂ§±Ë¥•‰∫ÜÔºåË∞ÉÁî® RecyclerView.Adapter#createViewHolder ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ ViewHolder ÊúÄÂêéÊ†πÊçÆ ViewHolder ÁöÑÁä∂ÊÄÅÔºåÁ°ÆÂÆöÊòØÂê¶ÈúÄË¶ÅË∞ÉÁî® bindViewHolder ËøõË°åÊï∞ÊçÆÁªëÂÆö„ÄÇ ÈóÆÈ¢òÈ¢ÑÂ∏ÉÂ±Ä„ÄÅÈ¢ÑÊµãÂä®ÁîªÊòØ‰ªÄ‰πàÔºüÁêÜËß£„ÄåÈ¢ÑÂ∏ÉÂ±Ä„ÄçÈúÄË¶ÅÂÖà‰∫ÜËß£„ÄåÈ¢ÑÊµãÂä®Áîª„Äç„ÄÇËÄÉËôëËøôÊ†∑‰∏Ä‰∏™Âú∫ÊôØÔºö Áî®Êà∑Êúâ A„ÄÅB„ÄÅC ‰∏â‰∏™ itemÔºåAÔºåB ÂàöÂ•ΩÊòæÁ§∫Âú®Â±èÂπï‰∏≠ÔºåËøô‰∏™Êó∂ÂÄôÔºåÁî®Êà∑Êää B Âà†Èô§‰∫ÜÔºåÈÇ£‰πàÊúÄÁªà C ‰ºöÊòæÁ§∫Âú® B ÂéüÊù•ÁöÑ‰ΩçÁΩÆ Â¶ÇÊûú C ‰ªéÂ∫ïÈÉ®Âπ≥ÊªëÂú∞ÊªëÂä®Âà∞‰πãÂâç B ÁöÑ‰ΩçÁΩÆÂ∞Ü‰ºöÊõ¥Á¨¶ÂêàÁõ¥Ëßâ„ÄÇ‰ΩÜÊòØË¶ÅÂÅöÂà∞ËøôÁÇπÂÆûÈôÖ‰∏äÊ≤°ÈÇ£‰πàÁÆÄÂçï„ÄÇÂõ†‰∏∫Êàë‰ª¨Âè™Áü•ÈÅì C ÊúÄÁªàÁöÑ‰ΩçÁΩÆÔºå‰ΩÜÊòØ‰∏çÁü•ÈÅì C ÁöÑËµ∑Âßã‰ΩçÁΩÆÂú®Âì™ÈáåÔºåÊó†Ê≥ïÁ°ÆÂÆö C Â∫îËØ•‰ªéÂì™ÈáåÊªëÂä®ËøáÊù•„ÄÇÂ¶ÇÊûúÊ†πÊçÆÊúÄÁªàÁöÑÁä∂ÊÄÅÔºåÂ∞±Êñ≠ÂÆö C Â∫îËØ•Ë¶Å‰ªéÂ∫ïÈÉ®ÊªëÂä®ËøáÊù•ÁöÑËØùÔºåÂæàÂèØËÉΩÊòØÊúâÈóÆÈ¢òÁöÑ„ÄÇÂõ†‰∏∫Âú®ÂÖ∂‰ªñÁ±ªÂûãÁöÑ LayoutManager ‰∏≠ÔºåÂÆÉÂèØËÉΩÊòØ‰ªé‰æßÈù¢ÊàñËÄÖÊòØÂÖ∂‰ªñÂú∞ÊñπÊªëÂä®ËøáÊù•ÁöÑ„ÄÇ ÈÇ£Ê†πÊçÆÂéüÁä∂ÊÄÅ‰∏éÊúÄÁªàÁä∂ÊÄÅ‰πãÈó¥ÁöÑÂ∑ÆÂºÇÔºåËÉΩ‰∏çËÉΩÂæóÂá∫Êàë‰ª¨Â∫îËØ•ÊâßË°å‰ªÄ‰πàÊ†∑ÁöÑÂàáÊç¢Âä®ÁîªÂë¢ÔºüÁ≠îÊ°à‰æùÁÑ∂ÊòØ no„ÄÇÂõ†‰∏∫Âú®ÂéüÁä∂ÊÄÅ‰∏≠ÔºåC Ê†πÊú¨Â∞±‰∏çÂ≠òÂú®„ÄÇÔºàËøô‰∏™Êó∂ÂÄôÔºåÊàë‰ª¨Âπ∂‰∏çÁü•ÈÅìÔºåB Ë¶ÅË¢´Âà†Èô§‰∫ÜÔºåÂ¶ÇÊûúÊää C ÁªôÂä†ËΩΩÂá∫Êù•ÔºåÂæàÂèØËÉΩÊòØ‰∏ÄÁßçËµÑÊ∫êÊµ™Ë¥π„ÄÇÔºâ ËÆæËÆ° RecyclerView ÁöÑÂ∑•Á®ãÂ∏àÊòØËøô‰πàËß£ÂÜ≥ÁöÑ„ÄÇÂΩì Adapter ÂèëÁîüÂèòÂåñÁöÑÊó∂ÂÄôÔºåRecyclerView ‰ºöËÆ© LayoutManager ËøõË°å‰∏§Ê¨°Â∏ÉÂ±Ä„ÄÇ Á¨¨‰∏ÄÊ¨°ÊòØÈ¢ÑÂ∏ÉÂ±Ä„ÄÇÂ∞Ü‰πãÂâçÂéüÁä∂ÊÄÅ ‰∏ãÁöÑ item ÈÉΩÂ∏ÉÂ±ÄÂá∫Êù•„ÄÇÂπ∂‰∏îÊ†πÊçÆ Adapter ÁöÑ notify ‰ø°ÊÅØÔºåÊàë‰ª¨Áü•ÈÅìÂì™‰∫õ item Âç≥Â∞ÜÂèòÂåñ‰∫ÜÔºåÊâÄ‰ª•ÂèØ‰ª•Âä†ËΩΩÂá∫Âè¶Â§ñÁöÑ View„ÄÇÂú®‰∏äËø∞‰æãÂ≠ê‰∏≠ÔºåÂõ†‰∏∫Áü•ÈÅì B Â∑≤ÁªèË¢´Âà†Èô§‰∫ÜÔºåÊâÄ‰ª•ÂèØ‰ª•ÊääÂ±èÂπï‰πãÂ§ñÁöÑ C ‰πüÂä†ËΩΩÂá∫Êù•„ÄÇ Á¨¨‰∫å‰∏™ÔºåÊúÄÁªàÁöÑÂ∏ÉÂ±ÄÔºå‰πüÂ∞±ÊòØÂèòÂåñÂÆåÊàê‰πãÂêéÁöÑÂ∏ÉÂ±Ä„ÄÇ ËøôÊ†∑Âè™Ë¶ÅÊØîËæÉÂâçÂêéÂ∏ÉÂ±ÄÁöÑÂèòÂåñÔºåÂ∞±ËÉΩÂæóÂá∫Â∫îËØ•ÊâßË°å‰ªÄ‰πàÂä®Áîª‰∫Ü„ÄÇ ËøôÁßçË¥üË¥£ÊâßË°åÂä®ÁîªÁöÑ view Âú®ÂéüÂ∏ÉÂ±ÄÊàñÊñ∞Â∏ÉÂ±Ä‰∏≠‰∏çÂ≠òÂú®ÁöÑÂä®ÁîªÔºåÂ∞±Áß∞‰∏∫È¢ÑÊµãÂä®Áîª„ÄÇ È¢ÑÂ∏ÉÂ±ÄÊòØÂÆûÁé∞È¢ÑÊµãÂä®ÁîªÁöÑ‰∏Ä‰∏™Ê≠•È™§„ÄÇ ‰∏ãÈù¢‰∏§‰∏™Âä®ÂõæÂ±ïÁ§∫‰∫ÜÊôÆÈÄöÂä®Áîª‰∏éÈ¢ÑÊµãÂä®ÁîªÊïàÊûúÁöÑÂå∫Âà´Ôºö ÊôÆÈÄöÂä®Áîª üëá È¢ÑÊµãÂä®Áîª üëá ÂÖ≥‰∫éÈ¢ÑÊµãÂä®ÁîªÔºåÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÈòÖËØªËøôÁØáÊñáÁ´†„ÄÇ ÂÖ≥‰∫é ScrapScrap ÁºìÂ≠òÂàóË°®ÔºàmChangedScrap„ÄÅmAttachedScrapÔºâÊòØ RecyclerView ÊúÄÂÖàÊü•Êâæ ViewHolder Âú∞ÊñπÔºåÂÆÉË∑ü RecyclerViewPool ÊàñËÄÖ ViewCache ÊúâÂæàÂ§ßÁöÑÂå∫Âà´„ÄÇ mChangedScrap Âíå mAttachedScrap Âè™Âú®Â∏ÉÂ±ÄÈò∂ÊÆµ‰ΩøÁî®„ÄÇÂÖ∂‰ªñÊó∂ÂÄôÂÆÉ‰ª¨ÊòØÁ©∫ÁöÑ„ÄÇÂ∏ÉÂ±ÄÂÆåÊàê‰πãÂêéÔºåËøô‰∏§‰∏™ÁºìÂ≠ò‰∏≠ÁöÑ viewHolderÔºå‰ºöÁßªÂà∞ mCacheView ÊàñËÄÖ RecyclerViewPool ‰∏≠„ÄÇ ÂΩì LayoutManager ÂºÄÂßãÂ∏ÉÂ±ÄÁöÑÊó∂ÂÄôÔºàÈ¢ÑÂ∏ÉÂ±ÄÊàñËÄÖÊòØÊúÄÁªàÂ∏ÉÂ±ÄÔºâÔºåÂΩìÂâçÂ∏ÉÂ±Ä‰∏≠ÁöÑÊâÄÊúâ viewÔºåÈÉΩ‰ºöË¢´ dump Âà∞ scrap ‰∏≠ÔºàÂÖ∑‰ΩìÂÆûÁé∞ÂèØËßÅ LinearLayoutManager#onLayoutChildren() ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü detachAndScrapAttachedViews() ÔºâÔºåÁÑ∂Âêé LayoutManager Êå®‰∏™Âú∞ÂèñÂõû viewÔºåÈô§Èùû view ÂèëÁîü‰∫Ü‰ªÄ‰πàÂèòÂåñÔºåÂê¶ÂàôÂÆÉ‰ºöÈ©¨‰∏ä‰ªé scrap ‰∏≠ÂõûÂà∞ÂéüÊù•ÁöÑ‰ΩçÁΩÆ„ÄÇ ‰ª•‰∏äÂõæ‰∏∫‰æãÔºåÊàë‰ª¨Âà†Èô§Êéâ bÔºåË∞ÉÁî® notifyItemRemove ÊñπÊ≥ïÔºåËß¶ÂèëÈáçÊñ∞Â∏ÉÂ±ÄÔºåËøôÊó∂ a,b,c ÈÉΩ‰ºöË¢´ dump Âà∞ scrap ‰∏≠ÔºåÁÑ∂Âêé LayoutManager ‰ºö‰ªé scrap ‰∏≠ÂèñÂõû a Âíå c„ÄÇ ÂÅè‰∏™È¢òÔºåËøô‰∏™Êó∂ÂÄôÔºåb ÂéªÂì™‰∫ÜÔºü RecyclerView ÁúãÂà∞ b Ê≤°ÊúâÂá∫Áé∞Âú®ÊúÄÁªàÁöÑÂ∏ÉÂ±Ä‰∏≠Ôºå‰ºö unscrap ÂÆÉÔºåËÆ©ÂÆÉÊâßË°å‰∏Ä‰∏™Ê∂àÂ§±ÁöÑÂä®ÁîªÁÑ∂ÂêéÈöêËóè„ÄÇÂä®ÁîªÊâßË°åÂÆå‰πãÂêéÔºåb Ë¢´ÊîæÂà∞ RecyclerViewPool ‰∏≠„ÄÇ ‰∏∫‰ªÄ‰πà LayoutManager ÈúÄË¶ÅÂÖàÊâßË°å detachÔºåÁÑ∂ÂêéÂÜçÈáçÊñ∞ attach Ëøô‰∫õ viewÔºåËÄå‰∏çÊòØÂè™ÁßªÈô§Âì™‰∫õÂèòÂåñÁöÑÂ≠ê view Âë¢ÔºüScrap ÁºìÂ≠òÂàóË°®ÁöÑÂ≠òÂú®ÔºåÊòØ‰∏∫‰∫ÜÈöîÁ¶ª LayoutManager Âíå RecyclerView.Recycler ‰πãÈó¥ÁöÑÂÖ≥Ê≥®ÁÇπ/ËÅåË¥£„ÄÇLayoutManager ‰∏çÈúÄË¶ÅÁü•ÈÅìÂì™‰∏Ä‰∏™Â≠ê view Â∫îËØ•‰øùÁïô ÊàñËÄÖÊòØ Â∫îËØ•Ë¢´ÂõûÊî∂Âà∞ pool ‰∫¶ÊàñËÄÖÂÖ∂‰ªñ‰ªÄ‰πàÂú∞Êñπ„ÄÇËøôÊòØ Recycler ÁöÑËÅåË¥£„ÄÇ Èô§‰∫ÜÂú®Â∏ÉÂ±ÄÊó∂‰∏ç‰∏∫Á©∫Â§ñÔºåËøòÊúâÂè¶‰∏Ä‰∏™‰∏é scrap ÊúâÂÖ≥ÁöÑËßÑÂæãÔºöÊâÄÊúâ scrap ÁöÑ view ÈÉΩ‰ºöË∑ü RecyclerView ÂàÜÁ¶ª„ÄÇViewGroup ‰∏≠ÁöÑ attachView Âíå detachView ÊñπÊ≥ïË∑ü addView Âíå removeView ÊñπÊ≥ïÂæàÂÉèÔºå‰ΩÜÊòØ‰∏ç‰ºöËß¶ÂèëËØ∑Ê±ÇÂ∏ÉÂ±Ä‰ºöÈáçÁªòÁöÑ‰∫ã‰ª∂„ÄÇÂÆÉ‰ª¨Âè™ÊòØ‰ªé ViewGroup ÁöÑÂ≠ê view ÂàóË°®‰∏≠Âà†Èô§ÂØπÂ∫îÁöÑÂ≠ê viewÔºåÂπ∂Â∞ÜËØ•Â≠ê view ÁöÑ parent ËÆæÁΩÆ‰∏∫ null„ÄÇdetached Áä∂ÊÄÅÂøÖÈ°ªÊòØ‰∏¥Êó∂ÔºåÂêéÈù¢Á¥ßÈöèÁùÄ attach ÊàñËÄÖ remove ‰∫ã‰ª∂ Â¶ÇÊûúÂú®ËÆ°ÁÆó‰∏Ä‰∏™Êñ∞Â∏ÉÂ±ÄÁöÑÊó∂ÂÄôÔºåÂ∑≤ÁªèÊ∑ªÂä†‰∫Ü‰∏ÄÂ†ÜÂ≠ê viewÔºåÂèØ‰ª•ÊîæÂøÉÁöÑÂ∞ÜÂÆÉ‰ª¨ÂÖ®ÈÉ® detach ÔºåRecyclerview Â∞±ÊòØËøô‰πàÂÅöÁöÑ„ÄÇ Attached vs Changed scrapRecycler Á±ª‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞‰∏§‰∏™ÂçïÁã¨ÁöÑ scrap ÂÆπÂô®: mAttachedScrap Âíå mChangedScrap„ÄÇ‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏§‰∏™Âë¢Ôºü ViewHolder Âè™ÊúâÂú®Êª°Ë∂≥‰∏ãÈù¢ÊÉÖÂÜµÊâç‰ºöË¢´Ê∑ªÂä†Âà∞ mChangedScrapÔºöÂΩìÂÆÉÂÖ≥ËÅîÁöÑ item ÂèëÁîü‰∫ÜÂèòÂåñÔºànotifyItemChanged ÊàñËÄÖ notifyItemRangeChanged Ë¢´Ë∞ÉÁî®ÔºâÔºåÂπ∂‰∏î ItemAnimator Ë∞ÉÁî® ViewHolder#canReuseUpdatedViewHolder ÊñπÊ≥ïÊó∂ÔºåËøîÂõû‰∫Ü false„ÄÇÂê¶ÂàôÔºåViewHolder ‰ºöË¢´Ê∑ªÂä†Âà∞AttachedScrap ‰∏≠„ÄÇ canReuseUpdatedViewHolder ËøîÂõû ‚Äúfalse‚Äù Ë°®Á§∫Êàë‰ª¨Ë¶ÅÊâßË°åÁî®‰∏Ä‰∏™ view ÊõøÊç¢Âè¶‰∏Ä‰∏™ view ÁöÑÂä®ÁîªÔºå‰æãÂ¶ÇÊ∑°ÂÖ•Ê∑°Âá∫Âä®Áîª„ÄÇ ‚Äútrue‚ÄùË°®Á§∫Âä®ÁîªÂú® view ÂÜÖÈÉ®ÂèëÁîü„ÄÇ mAttachedScrap Âú® Êï¥‰∏™Â∏ÉÂ±ÄËøáÁ®ã‰∏≠ÈÉΩËÉΩ‰ΩøÁî®Ôºå‰ΩÜÊòØ changed scrap ‚Äî Âè™ËÉΩÂú®È¢ÑÂ∏ÉÂ±ÄÈò∂ÊÆµ‰ΩøÁî®„ÄÇ ËøôÊòØÊúâÈÅìÁêÜÁöÑÔºöÂú®Â∏ÉÂ±ÄÂêéÔºåÊñ∞ÁöÑ ViewHolder Â∫îËØ•ÊõøÊç¢Êéâ‚ÄúÊîπÂèò‰∫ÜÁöÑ‚ÄùËßÜÂõæÔºåÂõ†Ê≠§ AttachedScrap Âú®Â∏ÉÂ±ÄÂêéÊòØÊ≤°ÊúâÁî®ÁöÑ„ÄÇ Êõ¥ÊîπÂä®ÁîªÊâßË°åÂÆåÊàêÂêéÔºåchange scrap Â∞ÜÊåâÈ¢ÑÊúüÊñπÂºèËΩ¨Â≠òÂà∞ pool ‰∏≠ ÈªòËÆ§ÁöÑ ItemAnimator ÂèØ‰ª•Âú® 3 ÁßçÊÉÖÂÜµ‰∏ãÈáçÁî®Êõ¥Êñ∞ÁöÑ ViewHolderÔºö Ë∞ÉÁî®‰∫Ü setSupportsChangeAnimations(false)„ÄÇ Ë∞ÉÁî®‰∫Ü notifyDataSetChanged ËÄå‰∏çÊòØ notifyItemChanged Êàñ notifyItemRangeChanged „ÄÇ Êèê‰æõ‰∫ÜËøôÊ†∑ÁöÑÊõ¥Êîπ payloadÔºöadapter.notifyItemChanged(indexÔºåanyObject)„ÄÇ ÊúÄÂêé‰∏ÄÁßçÊÉÖÂÜµÊòæÁ§∫‰∫Ü‰∏ÄÁßçÂæàÂ•ΩÁöÑÊñπÊ≥ïÔºåÂΩìÂè™ÊÉ≥Êõ¥Êîπ‰∏Ä‰∫õÂÜÖÈÉ®ÂÖÉÁ¥†Êó∂ÔºåÂèØ‰ª•ÈÅøÂÖçÂàõÂª∫/ÁªëÂÆöÊñ∞ÁöÑ ViewHolder„ÄÇ Hidden Views ÊòØ‰ªÄ‰πàÔºüÂâçÈù¢ÊèêÂà∞Âú®Á¨¨‰∫åÊ¨°Â∞ùËØïËé∑Âèñ ViewHolder ÁöÑÊó∂ÂÄôÔºåÊúâ‰∏Ä‰∏™Â≠êÊ≠•È™§‰ºö‰ªé hidden view ‰∏≠ÊêúÁ¥¢ÔºåËøôÈáåÁöÑ hidden view ÊåáÁöÑÊòØ‰ªÄ‰πàÔºü„Äåhidden view„ÄçÊåáÁöÑÊòØÈÇ£‰∫õÊ≠£Âú®‰ªé RecyclerView ËæπÁïå‰∏≠ËÑ±Á¶ªÁöÑ view„ÄÇ‰∏∫‰∫ÜËÆ©Ëøô‰∫õ view Ê≠£Á°ÆÂú∞ÊâßË°åÂØπÂ∫îÁöÑÂàÜÁ¶ªÂä®ÁîªÔºåÂÆÉ‰ª¨‰ªçÁÑ∂‰Ωú‰∏∫ RecyclerView ÁöÑÂ≠ê view Ë¢´‰øùÁïô‰∏ãÊù•„ÄÇ Á´ôÂú® LayoutManager ÁöÑËßíÂ∫¶ÔºåËøô‰∫õ view Â∑≤Áªè‰∏çÂ≠òÂú®‰∫ÜÔºåÂõ†Ê≠§‰∏çÂ∫îËØ•Ë¢´ÂåÖÂê´Âú®ËÆ°ÁÆóÈáåÈù¢„ÄÇÊØîÂ¶Ç Âú®ÈÉ®ÂàÜ view Ê≠£Âú®ÊâßË°åÊ∂àÂ§±Âä®ÁîªÁöÑËøáÁ®ã‰∏≠ÔºåË∞ÉÁî® LayoutManager#getChildAt ÊñπÊ≥ïÔºåËøô‰∫õ view ‰∏çÁÆóÂú®‰∏ãÊ†áÈáåÈù¢„ÄÇÊù•Ëá™ LayoutManager ÁöÑÊâÄÊúâÂØπ getChildAt()„ÄÅgetChildCount()„ÄÅaddView() Á≠âÁöÑÊñπÊ≥ïË∞ÉÁî® Âú®Â∫îÁî®Âà∞ÂÆûÈôÖÁöÑÂèØÂõûÊî∂view ‰πãÂâçÔºåÈÉΩË¶ÅÈÄöËøá ChildHelper Â§ÑÁêÜÔºåChildHelper ÁöÑËÅåË¥£ÊòØÈáçÊñ∞ËÆ°ÁÆóÈùûÈöêËóèÁöÑÂ≠ê view ÂàóË°®ÂíåÂÆåÊï¥ÁöÑÂ≠ê view ÂàóË°®‰πãÈó¥ÁöÑÁ¥¢Âºï„ÄÇ ËØ∑ËÆ∞‰ΩèÔºåÊàë‰ª¨Ê≠£Âú®ÊêúÁ¥¢Ë¶ÅÊèê‰æõÁªô LayoutManager ÁöÑËßÜÂõæÔºå‰ΩÜÊòØ LayoutManager ‰∏çÂ∫î‰∫ÜËß£ÈöêËóè ViewÔºÅ ‰∏æ‰∏Ä‰∏™ÂÆûÈôÖÁöÑüå∞ÔºöËøôÁßçËÆ©‰∫∫Ë¥πËß£ÁöÑ‚Äú‰ªéÈöêËóèÁöÑ view ÂºπË∑≥‚ÄùÔºàbouncing from hidden viewsÔºâÊú∫Âà∂ÂØπ‰∫éÂ§ÑÁêÜ‰∏ãÈù¢ËøôÁßçÊÉÖÂÜµËÄåË®ÄÊòØÂæàÊúâÂøÖË¶ÅÁöÑ„ÄÇ ËÄÉËôëËøôÁßçÂú∫ÊôØÔºåÊàë‰ª¨ÊèíÂÖ•‰∏Ä‰∏™ item ÔºåÁÑ∂ÂêéÂú®ÊèíÂÖ•Âä®ÁîªÂÆåÊàê‰πãÂâçÔºåÈ©¨‰∏äÂà†Èô§ËØ• itemÔºö Êàë‰ª¨ÊÉ≥Ë¶ÅÁúãÂà∞ÁöÑÊòØ b ‰ªé c ÁßªÈô§Êó∂ÁöÑ‰ΩçÁΩÆÂºÄÂßãÂêë‰∏äÂπ≥Áßª„ÄÇ ‰ΩÜÊòØÂú®ÈÇ£‰∏™Êó∂ÂÄôÔºåb ÊòØ‰∏Ä‰∏™ÈöêËóèÁöÑ viewÔºÅ Â¶ÇÊûúÊàë‰ª¨ÂøΩÁï•‰∫ÜÂÆÉÔºà‚ÄúÈöêËóè‚ÄùÁöÑ bÔºâÔºåÈÇ£‰ºöÂØºËá¥Âú®Áé∞Êúâ b ‰∏ãÈù¢ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ b„ÄÇÊõ¥Á≥üÁ≥ïÁöÑÊòØÔºåËøô‰∏§‰∏™ view ‰ºöÈáçÂè†ÔºåÂõ†‰∏∫ Êñ∞ÁöÑ b ‰ºöÂæÄ‰∏äÔºåÊóßÁöÑ b ‰ºöÂæÄ‰∏ã„ÄÇ ‰∏∫‰∫ÜÈÅøÂÖçËøôÁßçÈîôËØØÔºåÂú®ÊêúÁ¥¢ ViewHolder ÁöÑËæÉÊó©Ê≠•È™§‰πã‰∏Ä‰∏≠ÔºåRecyclerView ‰ºöËØ¢ÈóÆ ChildHelper ÊòØÂê¶ÂÖ∑ÊúâÂêàÈÄÇÁöÑ hidden view„ÄÇ ÊâÄË∞ì„ÄåÂêàÈÄÇ„ÄçÔºåË°®Á§∫Ëøô‰∏™ view Ë∑üÊàë‰ª¨ÈúÄË¶ÅÁöÑ‰ΩçÁΩÆÁõ∏ÂÖ≥ËÅîÔºåÂπ∂ÂÖ∑ÊúâÊ≠£Á°ÆÁöÑ view typeÔºåÂπ∂‰∏îËøô‰∏™ view ÁöÑË¢´ÈöêËóèÁöÑÂéüÂõ†‰∏çÊòØ‰∏∫‰∫ÜÁßªÈô§ÊéâÂÆÉÔºàÊàë‰ª¨‰∏çÂ∫îËØ•ËÆ©Ë¢´ÁßªÈô§ÁöÑ view Â§çÊ¥ªÔºâ Â¶ÇÊûúÊúâËøôÊ†∑ÁöÑ view ÔºåRecyclerView ‰ºöÂ∞ÜÂÖ∂ËøîÂõûÂà∞ LayoutManager Âπ∂Â∞ÜÂÖ∂Ê∑ªÂä†Âà∞ preLayout ‰∏≠‰ª•Ê†áËÆ∞Â∫î‰ªéÂÖ∂ËøõË°åÂä®ÁîªÂ§ÑÁêÜÁöÑ‰ΩçÁΩÆÔºàËØ¶ËßÅ recordAnimationInfoIfBouncedHiddenView ÊñπÊ≥ïÔºâ„ÄÇ ‰ªÄ‰πàÔºüÂú® Â∏ÉÂ±ÄÂâçÂêé Ê∑ªÂä†ÂÜÖÂÆπ‰∏çÂ∫îËØ•ÊòØ LayoutManager ÁöÑËÅåË¥£ÂêóÔºüÊÄé‰πàÁé∞Âú® RecyclerView ‰πüÂú®ÂæÄ preLayout ‰∏≠Ê∑ªÂä†viewÔºü ÊòØÁöÑÔºåËøôÁßçÊú∫Âà∂ÁúãËµ∑Êù•ÊúâÁÇπËÅåË¥£ÈÉ®ÂàÜÔºå‰ΩÜËøôÊòØ‰πüËØ¥ÊòéÊàë‰ª¨ÊúâÂøÖË¶Å‰∫ÜËß£ÂÆÉ„ÄÇ Stable Id ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºüÁêÜËß£ stable Id ÁâπÊÄßÁöÑÊúÄÈáçË¶ÅÁöÑ‰∏Ä‰∏™ÁÇπÊòØÔºåÂÆÉÂè™‰ºöÂú®Ë∞ÉÁî® notifyDataSetChanged ÊñπÊ≥ï‰πãÂêéÔºåÂΩ±Âìç RecyclerView ÁöÑË°å‰∏∫„ÄÇ Â¶ÇÊûúË∞ÉÁî® notifyDataSetChanged ÁöÑÊó∂ÂÄôÔºåAdapter Âπ∂Ê≤°ÊúâËÆæÁΩÆ hasStableIdÔºåRecyclerView ‰∏çÁü•ÈÅì ÂèëÁîü‰∫Ü‰ªÄ‰πàÔºåÂì™‰∏Ä‰∫õ‰∏úË•øÂèòÂåñ‰∫ÜÔºåÊâÄ‰ª•ÔºåÂÆÉÂÅáËÆæÊâÄÊúâÁöÑ‰∏úË•øÈÉΩÂèò‰∫ÜÔºåÊØè‰∏Ä‰∏™ ViewHolder ÈÉΩÊòØÊó†ÊïàÁöÑÔºåÂõ†Ê≠§Â∫îËØ•ÊääÂÆÉ‰ª¨ÊîæÂà∞ RecyclerViewPool ËÄå‰∏çÊòØ scrap ‰∏≠„ÄÇ Â¶ÇÊûúÊúâ Stable IdÔºåÈÇ£ÈÇ£Â∞Ü‰ºöÊòØÂÉè‰∏ãÈù¢ËøôÊ†∑Ôºö ViewHolder ‰ºöËøõÂÖ• scrap ËÄå‰∏çÊòØ pool ‰∏≠„ÄÇÁÑ∂Âêé‰ºöÈÄöËøáÁâπÂÆöÁöÑ IdÔºàAdapter ‰∏≠ÁöÑ getItemId Ëé∑ÂèñÂà∞ÁöÑ idÔºâËÄå‰∏çÊòØ postion Âà∞ scrap ‰∏≠Êü•Êâæ ViewHolder„ÄÇ Â•ΩÂ§ÑÊòØ‰ªÄ‰πàÔºü ‰∏ç‰ºöÂØºËá¥ RecyclerViewPool Ê∫¢Âá∫ÔºåÂõ†Ê≠§ÈùûÂøÖÈ°ªÊÉÖÂÜµ‰∏ãÔºå‰∏çÈúÄË¶ÅÂàõÂª∫Êñ∞ÁöÑ ViewHolder„ÄÇ‰πãÂâçÁöÑ ViewHolder ‰ºöÈáçÊñ∞ÁªëÂÆöÔºåÂõ†‰∏∫ Id Ê≤°ÊúâÂèòÂåñ‰∏ç‰ª£Ë°®ÂÜÖÂÆπÊ≤°ÊúâÂèòÂåñ ÊúÄÂ§ßÂ•ΩÂ§ÑÁöÑÂ•ΩÂ§ÑÊòØ ÊîØÊåÅÂä®Áîª„ÄÇ‰∏äÈù¢ÁßªÂä® item4 Âà∞ item6 ÁöÑ‰ΩçÁΩÆ„ÄÇÊ≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÈúÄË¶ÅË∞ÉÁî® notifyItemMoved(4,6) ÊâçËÉΩÂæóÂà∞‰∏Ä‰∏™ÁßªÂä®Âä®Áîª„ÄÇ‰ΩÜÊòØÈÄöËøá stable idÔºåË∞ÉÁî® notifyDataSetChanged ‰πüËÉΩÊîØÊåÅËøô‰∏ÄÁÇπ„ÄÇÂõ†‰∏∫ RecyclerView ÂèØ‰ª•ÁúãÂà∞ÁâπÂÆö id ÁöÑ view Âú®Êñ∞ÊóßÂ∏ÉÂ±ÄÁöÑ‰∏äÁöÑ‰ΩçÁΩÆÔºå Ë¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåËøôÈáåÁöÑÂä®ÁîªÂè™ÊîØÊåÅÁÆÄÂçïÁöÑÂä®ÁîªÔºåÈ¢ÑÊµãÂä®ÁîªÊó†Ê≥ïÊîØÊåÅ„ÄÇ Â¶ÇÊûúÊàë‰ª¨Âú®Êñ∞Â∏ÉÂ±Ä‰∏≠ÁúãÂà∞‰∏Ä‰∫õ IDÔºåËÄåÂú®ÊóßÂ∏ÉÂ±Ä‰∏≠Ê≤°ÊúâÔºåÈÇ£‰πàÊàë‰ª¨Â¶Ç‰ΩïÁü•ÈÅìÂÆÉÊòØÊñ∞ÊèíÂÖ•ÁöÑ item ËøòÊòØ‰ªéÊüêÂ§ÑÁßªÂÖ•ÁöÑ itemÔºåÂú®Âêé‰∏ÄÁßçÊÉÖÂÜµ‰∏ãÂÆÉÁ©∂Á´üÊòØ‰ªéÂì™ÈáåÊù•ÁöÑÂë¢Ôºü ÈÄöÂ∏∏ÔºåËøô‰∫õÈóÆÈ¢òÁöÑÁ≠îÊ°à‰ºöÂú®È¢ÑÂ∏ÉÂ±Ä‰∏≠ÊâæÂà∞ÔºåÊ†πÊçÆÈÄÇÈÖçÂô®ÁöÑÊõ¥ÊîπÔºåËØ•Â∏ÉÂ±ÄÂ∑≤Ë∂ÖÂá∫ RecyclerView ÁöÑËåÉÂõ¥Ôºå‰ΩÜÁé∞Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºå Êàë‰ª¨‰∏çÁü•ÈÅìËøô‰∫õÊõ¥ÊîπÂÖ∑‰ΩìÊòØ‰ªÄ‰πà ÊÄª‰ΩìËÄåË®ÄÔºåstable id ÁöÑ‰ΩøÁî®Âú∫ÊôØ‰ºº‰πéÊØîËæÉÊúâÈôê„ÄÇ ‰∏çËøáÔºåËøòÊòØÊúâËøôÊ†∑‰∏Ä‰∏™‰ΩøÁî®Âú∫ÊôØÔºöÂ¶ÇÊûúÊòØ‰ªé ListView ËøÅÁßªÂà∞ RecyclerViewÔºåÂ∞ÜÊâÄÊúâ notifyDataSetChanged Ë∞ÉÁî®ÔºåÈÉΩËΩ¨Êç¢‰∏∫ÁâπÂÆöÊõ¥ÊîπÁöÑÈÄöÁü•ÂèØËÉΩ‰ºöÂæàÁóõËã¶„ÄÇ Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåstable id ÂèØ‰ª•Êèê‰æõÁªô‰Ω†Êèê‰æõÁÆÄÂçïÁöÑ RecyclerView Âä®Áîª„ÄÇ ÁºìÂ≠ò‰ºòÂåñÂÆûË∑µ Â∞ΩÈáè‰ΩøÁî® notifyItemXxx ÊñπÊ≥ïËøõË°åÁªÜÁ≤íÂ∫¶ÁöÑÈÄöÁü•Êõ¥Êñ∞ÔºåËÄå‰∏çÊòØ notifyDatasetChanged Â¶ÇÊûúÂèòÊõ¥ÂâçÂêéÊòØ‰∏§‰∏™Êï∞ÊçÆÈõÜÔºåÊó†Ê≥ïÁ°ÆÂÆöÂÖ∑‰ΩìÂì™‰∏Ä‰∫õÊï∞ÊçÆÈ°πÂèòÂåñ‰∫ÜÔºåÂèØ‰ª•ËÄÉËôë‰ΩøÁî® DiffUtil „ÄÇ Â¶ÇÊûúÊï∞ÊçÆÈõÜËæÉÂ§ßÔºåÂª∫ËÆÆÁªìÂêà‰ΩøÁî® AsyncListDiffer Âú®Â≠êÁ∫øÁ®ãÂÅö diff ËøêÁÆó„ÄÇ Â¶ÇÊûúÁâπÂÆö viewType ÁöÑ item Âè™Êúâ‰∏Ä‰∏™ÔºåÂèØ‰ª•ÈÄöËøá RecyclerView#getRecycledViewPool()#setMaxRecycledViews(viewType,1); Êù•Ë∞ÉÊï¥ÁºìÂ≠òÂå∫ÁöÑÂ§ßÂ∞èÔºåÂáèÂ∞ëÂÜÖÂ≠òÂç†Áî® Â¶ÇÊûúÁâπÂÆö viewType ÁöÑ item ÁâπÂà´Â§öÔºå‰ΩÜÊòØ‰∏çÂæó‰∏çÈÄöËøá notifyDataSetChange ÊñπÊ≥ïÊõ¥Êñ∞Êï∞ÊçÆÔºåÂèØ‰ª•ÈÄöËøá‰∏ãÈù¢ËøôÁßçÊñπÂºèÔºåÂú®ÂèòÊõ¥ÂâçË∞ÉÂ§ßÁºìÂ≠òÔºåÂèòÊõ¥ÂÆåÊàêÂêéÔºåË∞ÉÂ∞èÁºìÂ≠ò„ÄÇËøôÊ†∑Â∏ÉÂ±ÄÂèòÂåñ‰πüÂèØ‰ª•ÊúÄÂ§ßÁ®ãÂ∫¶Âú∞Â§çÁî®Â∑≤ÊúâÁöÑ ViewHolder„ÄÇ 123456789mRecyclerView.getRecycledViewPool().setMaxRecycledViews(0, Â±èÂπïÊòæÁ§∫ÁöÑitemÊÄªÊï∞+7 );mAdapter.notifyDataSetChanged();new Handler().post(new Runnable() &#123; @Override public void run() &#123; mRecyclerView.getRecycledViewPool() .setMaxRecycledViews(0, 5); &#125;&#125;); Â¶ÇÊûú RecyclerView ‰∏≠ÁöÑÊØè‰∏™ item ÈÉΩÊòØ‰∏Ä‰∏™ RecyclerViewÔºå Âπ∂‰∏îÂ≠ê RecyclerView ÁöÑ item type Áõ∏ÂêåÂèØ‰ª•ÈÄöËøá RecyclerView#setRecycledViewPool(); ÊñπÊ≥ïÔºåÂÆûÁé∞ÁºìÂ≠òÊ±†ÁöÑÂ§çÁî®„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê https://android.jlelse.eu/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714 http://www.programmersought.com/article/4558924504/ https://juejin.im/post/5b79a0b851882542b13d204b https://juejin.im/post/5c696ba9e51d457f136d24ff Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
  </entry>
  <entry>
    <title><![CDATA[Android ‰∏≠Êõ¥Êñ∞ UI ÁöÑÁ∫øÁ®ãÈôêÂà∂ÈóÆÈ¢òÊé¢Á©∂]]></title>
    <url>%2Fblog%2F2020%2F04%2F18%2FAndroid%20%E4%B8%AD%E6%9B%B4%E6%96%B0%20UI%20%E7%9A%84%E7%BA%BF%E7%A8%8B%E9%99%90%E5%88%B6%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6%2F</url>
    <content type="text"><![CDATA[Android ‰∏≠Â≠êÁ∫øÁ®ãÁúüÁöÑ‰∏çËÉΩÊõ¥Êñ∞ UI ÂêóÔºüÂÖàËØ¥ÁªìËÆ∫ÔºöAndroid ‰∏≠Â≠êÁ∫øÁ®ãÂú®Êª°Ë∂≥‰∏ÄÂÆöÁöÑÊù°‰ª∂‰∏ãÂèØ‰ª•Êõ¥Êñ∞ UI„ÄÇ Âú® ViewRootImpl ËøòÊ≤°ÂàõÂª∫Âá∫Êù•‰πãÂâç UI ‰øÆÊîπÁöÑÊìç‰ΩúÊ≤°ÊúâÁ∫øÁ®ãÈôêÂà∂„ÄÇ Âú® ViewRootImpl ÂàõÂª∫ÂÆåÊàê‰πãÂêé ‰øùËØÅ„ÄåÂàõÂª∫ ViewRootImpl ÁöÑÊìç‰Ωú„ÄçÂíå„ÄåÊâßË°å‰øÆÊîπ UI ÁöÑÊìç‰Ωú„ÄçÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ãÂç≥ÂèØ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåË¶ÅÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî® ViewManager#addView Âíå ViewManager#updateViewLayout ÁöÑÊñπÊ≥ï„ÄÇ Ê≥®ÔºöViewManager ÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåWindowManger Êé•Âè£ÁªßÊâø‰∫ÜËøô‰∏™Êé•Âè£ÔºåÊàë‰ª¨ÈÄöÂ∏∏ÈÉΩÊòØÈÄöËøá WindowMangerÔºàÂÖ∑‰ΩìÂÆûÁé∞‰∏∫ WindowMangerImplÔºâ ËøõË°å view ÁöÑ add remove update Êìç‰ΩúÁöÑ„ÄÇ ÂØπÂ∫îÁöÑÁ∫øÁ®ãÈúÄË¶ÅÂàõÂª∫ Looper Âπ∂‰∏îË∞ÉÁî® Looper#loop ÊñπÊ≥ïÔºåÂºÄÂêØÊ∂àÊÅØÂæ™ÁéØ„ÄÇ ‰∏Ä‰∏™Ê†óÂ≠êÔºö12345678910111213141516public class MainActivity extends AppCompatActivity &#123; private ImageView mImageView; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mImageView = (ImageView)findViewById(R.id.iv); new Thread(new Runnable() &#123; @Override public void run() &#123; mImageView.setImageResource(R.drawable.ic_book);//Êõ¥Êñ∞ ui &#125; &#125;).start(); &#125;&#125; Â¶Ç‰∏äÂú® onCreate ÊñπÊ≥ï‰∏≠Êñ∞Âª∫‰∏Ä‰∏™Á∫øÁ®ãÂØπ mImageView ËøõË°å‰∫ÜÊìç‰ΩúÔºåÊàêÂäü‰ªéÂ≠êÁ∫øÁ®ãÊõ¥Êñ∞‰∫Ü ui„ÄÇ ‰ΩÜÊòØÂ¶ÇÊûúËÆ©Á∫øÁ®ã sleep ‰∏ÄÊÆµÊó∂Èó¥ÔºàÊØîÂ¶Ç 300msÔºâÔºå 1234567891011new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(300);//Áù°Áú† 300 ms &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; mImageView.setImageResource(R.drawable.ic_book);//Êõ¥Êñ∞ ui &#125;&#125;).start(); ÈÇ£‰πàÂ∞±ÂæàÂèØËÉΩ‰ºöÊä•Â¶Ç‰∏ãÈîôËØØÔºö(Â¶ÇÊûú 300ms ‰∏çÊä•ÈîôÔºåÂèØÂ∞ÜÂÖ∂Êîπ‰∏∫ 1000ms) 12345678910111213android.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views. at android.view.ViewRootImpl.checkThread(ViewRootImpl.java:7194) at android.view.ViewRootImpl.invalidateChildInParent(ViewRootImpl.java:1111) at android.view.ViewGroup.invalidateChild(ViewGroup.java:4833) at android.view.View.invalidateInternal(View.java:12102) at android.view.View.invalidate(View.java:12062) at android.view.View.invalidate(View.java:12046) at android.widget.ImageView.setImageDrawable(ImageView.java:456) at android.support.v7.widget.AppCompatImageView.setImageDrawable(AppCompatImageView.java:100) at android.support.v7.widget.AppCompatImageHelper.setImageResource(AppCompatImageHelper.java:89) at android.support.v7.widget.AppCompatImageView.setImageResource(AppCompatImageView.java:94) at com.android.rdc.librarysystem.MainActivity$1.run(MainActivity.java:52) at java.lang.Thread.run(Thread.java:818) ÂàÜÊûêËØ•ÂºÇÂ∏∏ÊòØ‰ªéÂì™ÈáåÊäõÂá∫ÁöÑÔºü ‰ªéÂá∫ÈîôÁöÑÂ†ÜÊ†à‰ø°ÊÅØ‰∏≠ÂèØ‰ª•ÂºÇÂ∏∏ÁúãÂà∞ÊòØ ViewRootImpl#checkThread() ÊñπÊ≥ï‰∏≠ÊäõÂá∫ÁöÑ„ÄÇ 123456void checkThread() &#123; if (mThread != Thread.currentThread()) &#123; throw new CalledFromWrongThreadException( "Only the original thread that created a view hierarchy can touch its views."); &#125;&#125; ÂΩìËÆøÈóÆ UI Êó∂ÔºåViewRootImpl ‰ºöË∞ÉÁî® checkThread ÊñπÊ≥ïÂéªÊ£ÄÊü•ÂΩìÂâçËÆøÈóÆ UI ÁöÑÁ∫øÁ®ãÊòØÂê¶‰∏∫ÂàõÂª∫ UI ÁöÑÈÇ£‰∏™Á∫øÁ®ãÔºåÂ¶ÇÊûú‰∏çÊòØ„ÄÇÂàô‰ºöÊäõÂá∫ÂºÇÂ∏∏„ÄÇ‰ΩÜÊòØ‰∏∫‰ªÄ‰πà‰∏ÄÂºÄÂßãÂú® MainActivity ÁöÑ onCreate ÊñπÊ≥ï‰∏≠ÂàõÂª∫‰∏Ä‰∏™Â≠êÁ∫øÁ®ãËÆøÈóÆ UIÔºåÁ®ãÂ∫èËøòÊòØÊ≠£Â∏∏ËÉΩË∑ëËµ∑Êù•Âë¢Ôºü ‰∏äËø∞‰æãÂ≠ê‰∏≠ÁöÑ Thread ÊâßË°åÊó∂ÔºåViewRootImpl ËøòÊ≤°ÂàõÂª∫ÔºåViewRootImpl Êó†Ê≥ïÂØπ view tree ÁöÑÊ†πËäÇÁÇπ DecorView ÊâßË°å performTraversalsÔºåview tree ÈáåÁöÑÊâÄÊúâ View ÈÉΩÊ≤°ÊúâË¢´ËµãÂÄº mAttachInfoÔºàÊ≥®ÔºöAttachInfo ‰∏≠Â≠òÂÇ®‰∫Ü‰∏ÄÁªÑ‰ø°ÊÅØ„ÄÇÂΩì View Ë¢´ËøûÊé•Âà∞ÂÆÉÁöÑÁà∂ËäÇÁÇπÊó∂Ôºå‰ºöÁªôËøô‰∏™ View ÁöÑ AttachInfo ËµãÂÄºÔºâ„ÄÇ Âú® onCreate ÂÆåÊàêÊó∂ÔºåActivity Âπ∂Ê≤°ÊúâÂÆåÊàêÂàùÂßãÂåñ view tree„ÄÇview tree ÁöÑÂàùÂßãÂåñÊòØ‰ªé ViewRootImpl ÊâßË°å performTraversals ÂºÄÂßãÔºåËøô‰∏™ËøáÁ®ã‰ºöÂØπ view tree ËøõË°å‰ªéÊ†πËäÇÁÇπ DecorView ÂºÄÂßãÁöÑÈÅçÂéÜÔºåÂØπÊâÄÊúâËßÜÂõæÂÆåÊàêÂàùÂßãÂåñÔºåÂàùÂßãÂåñÂåÖÊã¨ËßÜÂõæÁöÑÂ§ßÂ∞èÂ∏ÉÂ±ÄÔºå‰ª•Âèä AttachInfoÔºåViewParent Á≠âÂ±ûÊÄßÂüüÁöÑÂàùÂßãÂåñ„ÄÇ ImageView#setImageResourceËß¶ÂèëÁöÑË∞ÉÁî®ÊµÅÁ®ã 123456789101112131415161718192021222324ImageView#setImageResource --&gt; Â¶ÇÊûúÊúÄÊñ∞ËµÑÊ∫êÁöÑÂÆΩÂ∫¶ÊàñËÄÖÈ´òÂ∫¶Ë∑üÂ∑≤ÊúâÁöÑ‰∏çÂêåÔºå --&gt; View#requestLayout --&gt; Êª°Ë∂≥Êù°‰ª∂ÔºåÊúÄÁªà‰ºöË∞ÉÁî® ViewRootImpl#requestLayout --&gt; View#invalidate --&gt; View#invalidate(boolean) --&gt; View#invalidateInternal //Â¶ÇÊûú if mAttachInfo ‰ª•Âèä mParent ÈÉΩ‰∏ç‰∏∫Á©∫ --&gt; ViewGroup#invalidateChild //ËøôÈáå‰ºö‰∏çÊñ≠Âæ™ÁéØÂéªÂèñ‰∏ä‰∏Ä‰∏™ÁªìÁÇπÁöÑ mParent,‰∏ÄÁõ¥Âà∞ mParent == null ‰πüÂ∞±ÊòØÂà∞ËææÈ°∂ÈÉ® View ‰∏∫Ê≠¢ --&gt; ViewRootImpl#invalidateChildInParent // Ê≥®ÊÑè DecorView ÁöÑ mParent ÊòØ ViewRootImpl --&gt; ViewRootImpl#checkThread //Âú®ËøôÈáåÊâßË°å checkThreadÔºåÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã‰∏çÊòØÂàõÂª∫ UI ÁöÑÁ∫øÁ®ãÂàôÊäõÂá∫ÂºÇÂ∏∏ else ----------------------------------------------------------------------//View#invalidateInternal final AttachInfo ai = mAttachInfo;final ViewParent p = mParent;//Âè™ÊúâÂΩì mAttachInfo ‰ª•Âèä mParent ÈÉΩ‰∏ç‰∏∫Á©∫Êó∂ÔºåÊâç‰ºöËß¶ÂèëÈáçÁªòif (p != null &amp;&amp; ai != null &amp;&amp; l &lt; r &amp;&amp; t &lt; b) &#123; //.... p.invalidateChild(this, damage);&#125; ‰ªé‰∏äËø∞ÊµÅÁ®ãÂèØ‰ª•ÁúãÂá∫ÔºåÂè™ÊúâÂú® mAttachInfo ‰ª•Âèä mParent ÈÉΩ‰∏ç‰∏∫Á©∫Êó∂Ôºå ViewGroup#invalidateChild Êâç‰ºöË¢´Ë∞ÉÁî®ÔºåËØ•ÊñπÊ≥ïÊúÄÁªà‰ºöËß¶Âèë checkThreadÔºåËÄåÂêë‰∏äÈù¢ÊâÄÊèêÂà∞ÁöÑÔºå onCreate ÊñπÊ≥ïË∞ÉÁî®Êó∂ ViewRootImpl ËøòÊú™ÂàõÂª∫Ôºå mAttachInfo ‰ª•Âèä mParent Âùá‰∏∫ nullÔºåÊâÄ‰ª•Âú®Â≠êÁ∫øÁ®ã‰øÆÊîπ UI ‰∏ç‰ºöÊä•Èîô„ÄÇ ‰ΩÜÊòØËøô‰∏™Êó∂ÂÄôÂØπ View ÁöÑ‰øÆÊîπÊòØÊúâÊïàÊûúÁöÑ„ÄÇÈÇ£‰πàÔºåViewRootImpl ÂàõÂª∫‰πãÂâçÁöÑÔºåÁ®ãÂ∫èÂØπ UI ÁöÑÊõ¥Êñ∞Êìç‰ΩúÊòØÂ¶Ç‰ΩïËøõË°åÁöÑÂë¢ÔºüÂú®ÊúÄÂàùÁöÑImageView#setImageResource ÊñπÊ≥ï‰∏≠Â∑≤ÁªèÂ∞ÜË¶ÅÂõæÁâáËµÑÊ∫ê id ËµãÁªô‰∫ÜImageView ÁöÑ‰∏Ä‰∏™Â±ûÊÄß mResource ÔºåÁ≠âÂà∞ ViewRootImpl ÂàõÂª∫ÂÆåÊØï‰πãÂêéÂ∞±ÂèØ‰ª•ÂæóÂà∞Êõ¥Êñ∞‰∫Ü„ÄÇ ViewRootImpl ‰ΩïÊó∂Ë¢´ÂàõÂª∫ÔºüÂõûËøáÂ§¥ÁúãÔºåÊäõÂºÇÂ∏∏ÁöÑÊñπÊ≥ïÊó¢ÁÑ∂ÊòØ ViewRootImpl ‰∏≠ÁöÑÊñπÊ≥ïÔºåÈÇ£È¶ñÂÖàÂ∫îËØ•ÂéªÁúãÁúã ViewRootImpl ÊòØÂú®Âì™Èáå„ÄÅÂú®‰ªÄ‰πàÊó∂ÂÄôË¢´ÂàõÂª∫ÁöÑ„ÄÇ Â¶ÇÊûú‰Ω†ÂØπ Activity ÁöÑÂêØÂä®ÊµÅÁ®ãÊúâÊâÄ‰∫ÜËß£ÔºåÂ∫îËØ•Áü•ÈÅìÔºåActivity ÁöÑÂêØÂä®‰∏éÁîüÂëΩÂë®ÊúüÈÉΩÊòØÁî± ActivityThread Áõ∏Â∫îÁöÑÊñπÊ≥ïËß¶ÂèëÁöÑ„ÄÇÊàë‰ª¨Áü•ÈÅìÊØè‰∏Ä‰∏™ Activity ÈÉΩÊúâ‰∏Ä‰∏™È°∂Á∫ß View ‚Äî‚ÄîDecorViewÔºåÂΩì Activity ‰∏≠ÁöÑËßÜÂõæÊòæÁ§∫Âá∫Êù•ÁöÑÊó∂ÂÄô DecorView ËÇØÂÆöÂ∑≤ÁªèÂàõÂª∫ÂÆåÊØï‰∫Ü„ÄÇËÄå ViewRootImpl ‰Ωú‰∏∫ DecorView ‰∏é WindowManager ‰πãÈó¥ÁöÑ„ÄåÊ°•Ê¢Å„ÄçÔºåÂ∫îËØ•‰πüÊòØÂú®ËßÜÂõæÂèòÂæóÂèØËßÅ‰πãÂâçË¢´ÂàõÂª∫Âá∫Êù•ÁöÑ„ÄÇËØ¥Âà∞ËßÜÂõæÂèØËßÅ‰∏éÂê¶Ôºå‰∏ÄËà¨ÈÉΩ‰ºöÊÉ≥Ëµ∑ onResumeÔºàÂÆûÈôÖ‰∏ä onResume Ë∞ÉÁî®Êó∂ÔºåActivity ÁöÑËßÜÂõæ‰πü‰∏ç‰∏ÄÂÆöÂèØËßÅÔºâ„ÄÇ ‰ªéActivityThread#handleLaunchActivity ÊñπÊ≥ïÂá∫ÂèëÔºåÊü•ÁúãÂÖ∂Ë∞ÉÁî®ÊµÅÁ®ã 1234567891011ActivityThread#handleLaunchActivity --&gt; performLaunchActivity //ÂàõÂª∫ Activity *--&gt; handleResumeActivity --&gt; performResumeActivity//ÂõûË∞É onResume --&gt; Activity#performResume(); --&gt; Instrumentation#callActivityOnResume --&gt; Activity#onResume();//ÂõûË∞É onResume **--&gt; Activity#makeVisible(); --&gt; WindowManagerGlobal#addView() --&gt; root = new ViewRootImpl(view.getContext(), display);//ÂàõÂª∫ ViewRootImpl --&gt; ViewRootImpl#setView ‰ªé‰∏äËø∞ÊµÅÁ®ãÂèØ‰ª•ÁúãÂá∫ÔºåViewRootImpl ÊòØÂú® WindowManagerGlobal#addView() ÊñπÊ≥ï‰∏≠Ë¢´ÂàõÂª∫Âá∫Êù•ÁöÑ„ÄÇÂπ∂‰∏îÊòØÂú® Activity#onResume ÊñπÊ≥ïË∞ÉÁî®‰πãÂêéÊâçË¢´ÂàõÂª∫„ÄÇÂõ†Ê≠§Êàë‰ª¨Â¶ÇÊûúÂú® onResume ÊñπÊ≥ï‰∏≠ÂàõÂª∫‰∏Ä‰∏™Â≠êÁ∫øÁ®ãÂéª‰øÆÊîπ UIÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ã‰πüÊòØÂèØ‰ª•ÊàêÂäüÁöÑ„ÄÇ ‰∏Ä‰∏™Âú®Â≠êÁ∫øÁ®ãÊõ¥Êñ∞ UI ÁöÑÊ†óÂ≠êÔºöÂàõÂª∫‰∏Ä‰∏™ handlerThreadÂπ∂Ë∞ÉÁî®ÂÆÉÁöÑ start ÊñπÊ≥ïÔºåËé∑ÂèñhandlerThread ‰∏≠ÁöÑ looper ÊûÑÈÄ†‰∏Ä‰∏™ Handler„ÄÇÂú®ËØ• HandlerÁöÑ handleMessageÊñπÊ≥ïÔºàËøêË°åÂú®Â≠êÁ∫øÁ®ãÔºâ ‰∏≠Â∞Ü view Ê∑ªÂä†Âà∞ WindowMangerÈáåÈù¢ÔºåÂπ∂ÊîØÊåÅËøõË°åÊõ¥Êñ∞Êìç‰Ωú„ÄÇ Á§∫‰æã‰ª£Á†ÅÂú∞ÂùÄ ÊÄªÁªìÔºöViewRootImpl ÁöÑÂàõÂª∫Âú® onResume ÊñπÊ≥ïÂõûË∞É‰πãÂêéÔºåËÄåÊàë‰ª¨‰∏ÄÂºÄÁØáÊòØÂú® onCreate ÊñπÊ≥ï‰∏≠ÂàõÂª∫‰∫ÜÂ≠êÁ∫øÁ®ãÂπ∂ËÆøÈóÆ UIÔºåÂú®ÈÇ£‰∏™Êó∂ÂàªÔºåViewRootImpl ËøòÊ≤°ÊúâÂàõÂª∫ÔºåÊàë‰ª¨Âú®Â≠êÁ∫øÁ®ãË∞ÉÁî® ‰∫Ü ImageView#setImageResourceÔºåËôΩÁÑ∂ÂèØËÉΩ‰ºöËß¶Âèë View#requestLayout Âíå View#invalidate() Ôºå‰ΩÜÊòØÁî±‰∫é ViewRootImplËøòÊú™ÂàõÂª∫Âá∫Êù•ÔºåÂõ†Ê≠§ ViewRootImpl#checkThread Ê≤°ÊúâË¢´Ë∞ÉÁî®Âà∞Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÊ£ÄÊµãÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶ÊòØÂàõÂª∫ÁöÑ UI ÈÇ£‰∏™Á∫øÁ®ã ÁöÑÈÄªËæëÊ≤°ÊúâÊâßË°åÂà∞ÔºåÊâÄ‰ª•Á®ãÂ∫èÊ≤°ÊúâÂ¥©Ê∫É‰∏ÄÊ†∑ËÉΩË∑ëËµ∑Êù•„ÄÇËÄå‰πãÂêé‰øÆÊîπ‰∫ÜÁ®ãÂ∫èÔºåËÆ©Á∫øÁ®ã‰ºëÁú†‰∫Ü 300 ÊØ´ÁßíÂêéÔºåÁ®ãÂ∫èÂ∞±Â¥©‰∫Ü„ÄÇÂæàÊòéÊòæ 300 ÊØ´ÁßíÂêé ViewRootImpl Â∑≤ÁªèÂàõÂª∫‰∫ÜÔºåÂèØ‰ª•ÊâßË°å checkThread ÊñπÊ≥ïÊ£ÄÊü•ÂΩìÂâçÁ∫øÁ®ã„ÄÇ ÂºÄÁØáÁöÑ‰æãÂ≠ê‰∏≠Êàë‰ª¨Âú® onCreate ÊñπÊ≥ï‰∏≠ÂàõÂª∫ÁöÑÂ≠êÁ∫øÁ®ãËÆøÈóÆ UI ÊòØ‰∏ÄÁßçÊûÅÁ´ØÁöÑÊÉÖÂÜµ„ÄÇÂÆûÈôÖÂºÄÂèë‰∏≠‰∏ç‰ºöËøô‰πàÂÅö„ÄÇ ‰∏ãÊ¨°Â¶ÇÊûúÊúâ‰∫∫ÈóÆ‰Ω† Android ‰∏≠Â≠êÁ∫øÁ®ãÁúüÁöÑ‰∏çËÉΩÊõ¥Êñ∞ UI ÂêóÔºü ‰Ω†ÂèØ‰ª•Ëøô‰πàÂõûÁ≠îÔºö‰ªª‰ΩïÁ∫øÁ®ãÈÉΩÂèØ‰ª•Êõ¥Êñ∞Ëá™Â∑±ÂàõÂª∫ÁöÑ UI„ÄÇÂè™Ë¶Å‰øùËØÅÊª°Ë∂≥‰∏ãÈù¢Âá†‰∏™Êù°‰ª∂Â∞±Â•Ω‰∫Ü Âú® ViewRootImpl ËøòÊ≤°ÂàõÂª∫Âá∫Êù•‰πãÂâç UI ‰øÆÊîπÁöÑÊìç‰ΩúÊ≤°ÊúâÁ∫øÁ®ãÈôêÂà∂„ÄÇ Âú® ViewRootImpl ÂàõÂª∫ÂÆåÊàê‰πãÂêé ‰øùËØÅ„ÄåÂàõÂª∫ ViewRootImpl ÁöÑÊìç‰Ωú„ÄçÂíå„ÄåÊâßË°å‰øÆÊîπ UI ÁöÑÊìç‰Ωú„ÄçÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ãÂç≥ÂèØ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåË¶ÅÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî® ViewManager#addView Âíå ViewManager#updateViewLayout ÁöÑÊñπÊ≥ï„ÄÇ Ê≥®ÔºöViewManager ÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåWindowManger Êé•Âè£ÁªßÊâø‰∫ÜËøô‰∏™Êé•Âè£ÔºåÊàë‰ª¨ÈÄöÂ∏∏ÈÉΩÊòØÈÄöËøá WindowMangerÔºàÂÖ∑‰ΩìÂÆûÁé∞‰∏∫ WindowMangerImplÔºâ ËøõË°å view ÁöÑ add remove update Êìç‰ΩúÁöÑ„ÄÇ ÂØπÂ∫îÁöÑÁ∫øÁ®ãÈúÄË¶ÅÂàõÂª∫ Looper Âπ∂‰∏îË∞ÉÁî® Looper#loop ÊñπÊ≥ïÔºåÂºÄÂêØÊ∂àÊÅØÂæ™ÁéØ„ÄÇ ÊúâÂêåÂ≠¶ÂèØËÉΩ‰ºöÈóÆÔºå‰øùËØÅ‰∏äËø∞Êù°‰ª∂ 1 ÊàêÁ´ãÔºå‰∏çÂ∞±ÂèØ‰ª•ÈÅøÂÖç checkThread Êó∂ÂÄôÊäõÂá∫ÂºÇÂ∏∏‰∫ÜÂêóÔºü‰∏∫‰ªÄ‰πàËøòÈúÄË¶ÅÂºÄÂêØÊ∂àÊÅØÂæ™ÂùèÔºü Êù°‰ª∂ 1 ÂèØ‰ª•ÈÅøÂÖçÊ£ÄÊü•ÂºÇÂ∏∏Ôºå‰ΩÜÊòØÊó†Ê≥ï‰øùËØÅ UI ÂèØ‰ª•Ë¢´ÁªòÂà∂Âá∫Êù•„ÄÇ Êù°‰ª∂ 2 ÂèØ‰ª•ËÆ©Êõ¥Êñ∞ÁöÑ UI ÊïàÊûúÂëàÁé∞Âá∫Êù• WindowManger#addView ÊúÄÁªà‰ºöË∞ÉÁî® WindowManageGlobal#addView ÊñπÊ≥ïÔºåËøõËÄåËß¶ÂèëViewRootImpl#setView ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂÜÖÈÉ®‰ºöË∞ÉÁî® ViewRootImpl#requestLayout ÊñπÊ≥ï„ÄÇ ‰∫ÜËß£Ëøá UI ÁªòÂà∂ÂéüÁêÜÁöÑÂêåÂ≠¶Â∫îËØ•Áü•ÈÅì ‰∏ã‰∏ÄÊ≠•Â∞±ÊòØ scheduleTraversals ‰∫ÜÔºåËØ•ÊñπÊ≥ï‰ºöÂæÄÊ∂àÊÅØÈòüÂàó‰∏≠ÊèíÂÖ•‰∏ÄÊù°Ê∂àÊÅØÂ±èÈöúÔºåÁÑ∂ÂêéË∞ÉÁî® Choreographer#postCallback ÊñπÊ≥ïÔºåÂæÄ looper ‰∏≠ÊèíÂÖ•‰∏ÄÊù°ÂºÇÊ≠•ÁöÑ MSG_DO_SCHEDULE_CALLBACK Ê∂àÊÅØ„ÄÇÁ≠âÂæÖÂûÇÁõ¥ÂêåÊ≠•‰ø°Âè∑ÂõûÊù•‰πãÂêéÊâßË°å„ÄÇ Ê≥®ÔºöViewRootImpl Êúâ‰∏Ä‰∏™ Choreographer ÊàêÂëòÂèòÈáèÔºåViewRootImpl ÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏≠‰ºöË∞ÉÁî® Choreographer#getInstance(); ÊñπÊ≥ïÔºåËé∑Âèñ‰∏Ä‰∏™ÂΩìÂâçÁ∫øÁ®ãÁöÑ Choreographer Â±ÄÈÉ®ÂÆû‰æã„ÄÇ ‰ΩøÁî®Â≠êÁ∫øÁ®ãÊõ¥Êñ∞ UI ÊúâÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂêóÔºüAndroid ‰∏≠ÁöÑ SurfaceView ÈÄöÂ∏∏‰ºöÈÄöËøá‰∏Ä‰∏™Â≠êÁ∫øÁ®ãÊù•ËøõË°åÈ°µÈù¢ÁöÑÂà∑Êñ∞„ÄÇÂ¶ÇÊûúÊàë‰ª¨ÁöÑËá™ÂÆö‰πâ View ÈúÄË¶ÅÈ¢ëÁπÅÂà∑Êñ∞ÔºåÊàñËÄÖÂà∑Êñ∞Êó∂Êï∞ÊçÆÂ§ÑÁêÜÈáèÊØîËæÉÂ§ßÔºåÈÇ£‰πàÂèØ‰ª•ËÄÉËôë‰ΩøÁî® SurfaceView Êù•Âèñ‰ª£ View„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Android ‰∏≠Â≠êÁ∫øÁ®ãÁúüÁöÑ‰∏çËÉΩÊõ¥Êñ∞ UI ÂêóÔºü Â§öÁ∫øÁ®ãÂ≠¶‰π†‰πã‚ÄìÁúüÁöÑ‰∏çËÉΩÂú®Â≠êÁ∫øÁ®ãÈáåÊõ¥Êñ∞ UI ÂêóÔºü ‰∫íËÅîÁΩëÁ¨îËÆ∞ Android ‰∏≠Â≠êÁ∫øÁ®ãÁúüÁöÑ‰∏çËÉΩÊõ¥Êñ∞ UI ÂêóÔºü Android Âè™Âú® UI ‰∏ªÁ∫øÁ®ã‰øÆÊîπ UIÔºåÊòØ‰∏™Ë∞éË®ÄÂêóÔºü ‰∏∫‰ªÄ‰πàËøôÊÆµ‰ª£Á†ÅËÉΩÂÆåÁæéËøêË°åÔºü 2020/04/18 Âú® 2017/08/16 ÁöÑÂÜÖÂÆπÂü∫Á°Ä‰∏äÊñ∞Â¢û‰∫Ü‰∏Ä‰∏™Á§∫‰æãÔºå‰ª•ÂèäÊÄªÁªì„ÄÇ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫ê„ÄÇË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Êé¢Á©∂</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Êé¢Á©∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RxJava‰∏≠switchMapÂíåflapMap Êúâ‰ΩïÂå∫Âà´Ôºü]]></title>
    <url>%2Fblog%2F2020%2F03%2F20%2FRxJava%E4%B8%ADswitchMap%E5%92%8CflapMap-%E6%9C%89%E4%BD%95%E5%8C%BA%E5%88%AB%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[flapMap Âíå switchMap ÈÉΩÊòØ RxJava ‰∏≠ÁöÑËΩ¨Êç¢Êìç‰ΩúÁ¨¶ÔºåÈÉΩÂèØ‰ª•Â∞Ü‰∏äÊ∏∏ÁöÑËæìÂÖ•ËΩ¨Êç¢‰∏∫‰∏Ä‰∏™Êï∞ÊçÆÊ∫êÔºàÊØîÂ¶Ç ObservableÔºâËæìÂá∫Áªô‰∏ãÊ∏∏„ÄÇ switchMap ÁöÑ‰ΩøÁî®Âú∫ÊôØ switchMap ÁöÑ‰ΩøÁî®Âú∫ÊôØÔºöÁõëÂê¨Áî®Êà∑Âú®ËæìÂÖ•Ê°ÜËæìÂÖ•ÁöÑÂÜÖÂÆπÔºåÂÆöÊó∂Ëß¶ÂèëÊêúÁ¥¢Âπ∂Â±ïÁ§∫ÁªìÊûú ÂàõÂª∫‰∏Ä‰∏™ PublishSubject&lt;String&gt; ËæìÂÖ•Ê°Ü‰∏≠ÁöÑÊñáÂ≠óÂèòÂåñÁöÑÊó∂ÂÄôÔºåË∞ÉÁî® onNext ÊñπÊ≥ïÂèëÂ∏ÉÂèòÊõ¥ ‰ΩøÁî® debounce ÂéªÊäñÂä®ÔºåÈÅøÂÖçÈ¢ëÁπÅËß¶Âèë ‰ΩøÁî® switchMap ÂàáÊç¢Âà∞ÊêúÁ¥¢ÁΩëÁªúËØ∑Ê±Ç subscribe Â§ÑÁêÜÊêúÁ¥¢ÁªìÊûúÔºà‰πüÂèØ‰ª•Âä†‰∏Ä‰∏™ map Êìç‰ΩúÔºâÔºåÂπ∂Êõ¥Êñ∞ UI 1234567891011121314151617181920212223242526272829303132333435363738394041424344mExecSearchDisposable = searchObservable //Èò≤Êäñ .debounce(100, TimeUnit.MILLISECONDS, BearSchedulers.mainThread()) //ÊúâÂèòÂåñÊâçÂæÄ‰∏ãÊ∏∏ÂèëÈÄÅ .distinctUntilChanged() .toFlowable(BackpressureStrategy.LATEST) //ÂØπ‰∏äÊ∏∏ÁöÑËæìÂÖ•ÔºàÁî®Êà∑ËæìÂÖ•ÁöÑÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠óÔºâËøõË°åÊü•ËØ¢ÔºõÂ¶ÇÊûúÊúâÊñ∞ÁöÑËæìÂÖ•ÔºåÊóßÁöÑËæìÂÖ•ËøòÊú™ÊãøÂà∞Êü•ËØ¢ÁªìÊûúÔºåÂàôÊóßÁöÑÊü•ËØ¢ÁªìÊûú‰ºöÁõ¥Êé•‰∏¢ÂºÉ„ÄÇ .switchMap &#123; s -&gt; //Â¶ÇÊûúËæìÂÖ•‰∏∫Á©∫‰∏≤ÔºåÂàôÂ±ïÁ§∫Á©∫È°µÈù¢ if (s.isEmpty()) &#123; Flowable.just(Notification.createOnError(EmptySearchException())) &#125; else &#123; //ÊòæÁ§∫ loading view.loading() //ÊûÑÂª∫ÊêúÁ¥¢ÂèÇÊï∞ val params = buildSearchParams(s) //ÊúâÁΩëÁªúÔºåÊâßË°åÁΩëÁªúÊü•ËØ¢ÔºåÊó†ÁΩëÁªúÔºåÊâßË°åÊú¨Âú∞Êï∞ÊçÆÂ∫ìÊü•ËØ¢ val searchFlowable = if (connectionService.networkState.isConnected) &#123; mSearchDataRepository.searchFromNet(params) &#125; else &#123; mSearchDataRepository.searchFromDb(params) &#125; searchFlowable.observeOn(BearSchedulers.computation()) .map &#123; val resultList = resolveResponse(it) Notification.createOnNext(resultList) &#125; .onErrorReturn &#123; Notification.createOnError(it) &#125; &#125; &#125; .observeOn(BearSchedulers.mainThread()) .subscribe &#123; notification -&gt; if (notification.isOnNext) &#123; //Âà∑Êñ∞ UI view.refreshUi(notification.value, false) &#125; else if (notification.isOnError) &#123; if (notification.error is EmptySearchException) &#123; view.refreshUi(Collections.emptyList(), true) &#125; else &#123; view.onError(notification.error?.message) &#125; &#125; &#125; Â¶ÇÊûú‰ΩøÁî® flatMapÔºåÂàôÊêúÁ¥¢ÁªìÊûúÊúâÂèØËÉΩÊòØËøáÊó∂ÁöÑÔºåÂõ†‰∏∫ÂÆ¢Êà∑Á´ØÊãøÂà∞ÁöÑÊêúÁ¥¢ÁªìÊûú È°∫Â∫èÊúâÂèØËÉΩÊòØ‰π±Â∫èÁöÑ„ÄÇÔºàÁΩëÁªúËØ∑Ê±ÇÁöÑÊó∂Âª∂‰∏çÂèØÊéßÔºâ ‰∏∫‰∫ÜËß£ÂÜ≥ËØ•ÈóÆÈ¢òÔºåÂèØ‰ª•ÈÄöËøá switchMapÔºåÂõ†‰∏∫switchMap ‰øùËØÅÊñ∞ÁöÑ Observable Êèê‰æõÁöÑÊó∂ÂÄôÔºå ÊóßÁöÑ Observable ‰ºöË¢´ÂèñÊ∂àÊéâ„ÄÇ Â§ßÁêÜÁü≥Âõæ switchMap ÔºõÂõ†‰∏∫Âú®ÂèëÂá∫Á¨¨‰∫å‰∏™ÁªøËâ≤ÊñπÂùó‰πãÂâçÔºå‰∏äÊ∏∏ËæìÂÖ•‰∏Ä‰∏™ Ê∑±ËìùËâ≤Áè†Â≠êÔºåÂõ†Ê≠§Á¨¨‰∫å‰∏™ÁªøËâ≤ÊñπÂùó‰πãÂâçË¢´‰∏¢ÂºÉ flatMapÔºåËôΩÁÑ∂Ê∑±ËìùËâ≤ÁöÑÁè†Â≠êÁ¥ßÈöèÁªøËâ≤Áè†Â≠êÔºå‰ΩÜÊòØÔºåÁ¨¨‰∫å‰∏™ÁªøËâ≤ÊñπÂùó‰πüÊ≠£Â∏∏ÂèëÈÄÅ‰∫ÜÂá∫ÂéªÔºåÂè™‰∏çËøáÔºåÈ°∫Â∫è‰π±‰∫ÜÔºàËøôÈáåÁöÑ „Äå‰π±„ÄçÊåáÁöÑÊòØÔºåÁ¨¨‰∫å‰∏™ÁªøËâ≤ÊñπÂùóÊ≤°ÊúâÂú®ËìùËâ≤ÁöÑÁ¨¨‰∏Ä‰∏™ÊñπÂùó‰πãÂâçÂèëÂá∫Ôºâ Â∞èÁªìÔºö flatMap ÈÄÇÁî®‰∫éÂêÑ‰∏™ÁªìÊûúÈÉΩÊúâÁî®Ôºå‰∏çÁÆ°ÂÆÉ‰ª¨ÁöÑÂÖàÂêéÊó∂Èó¥ switchMapÂ∞±ÂÉèflatMapÔºå‰ΩÜÂÆÉ‰ªÖ‰øùÁïôÊúÄÊñ∞ÁöÑËßÇÂØüÂà∞ÁªìÊûú„ÄÇËøáÊó∂ÁöÑ‰∫ã‰ª∂‰ºöË¢´‰∏¢ÂºÉÊéâ„ÄÇ ÊÄé‰πàÊ†∑ÁÆóËøáÊúüÔºü ÂÅáËÆæ Observable1 ‰∫ã‰ª∂ËøòÊ≤°ÂèëÈÄÅÂÆåÔºåÊ≠§Êó∂Êúâ‰∫ÜÊñ∞ÁöÑ Observable2 ÔºåÂàôObservable1 Êú™ÂèëÂ∏ÉÁöÑ/Êú™ËΩ¨Êç¢ÂÆåÁöÑ‰∫ã‰ª∂Â∞±‰∏ç‰ºöÂèëÈÄÅÂá∫Âéª‰∫Ü„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê https://lorentzos.com/improving-ux-with-rxjava-4440a13b157f https://www.jianshu.com/p/33c548bce571 https://stackoverflow.com/questions/28175702/what-is-the-difference-between-flatmap-and-switchmap-in-rxjava Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>RxJava</category>
      </categories>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂÖ≥‰∫éEditTextÂá†‰∏™Â∞èTips]]></title>
    <url>%2Fblog%2F2019%2F10%2F31%2F%E5%85%B3%E4%BA%8EEditText%E5%87%A0%E4%B8%AA%E5%B0%8FTips%2F</url>
    <content type="text"><![CDATA[1.ÊòæÁ§∫Ê∏ÖÈô§ÊåâÈíÆÊúÄÁÆÄ‰æøÁöÑÊñπÂºèÔºöÂà©Áî® kotlin ÊãìÂ±ïÂáΩÊï∞ÔºåÈÄöËøá TextView#setCompoundDrawablesWithIntrinsicBounds ÊñπÊ≥ïÂÆûÁé∞ 12345678910111213141516171819202122fun EditText.setupClearButtonWithAction() &#123; addTextChangedListener(object : TextWatcher &#123; override fun afterTextChanged(editable: Editable?) &#123; val clearIcon = if (editable?.isNotEmpty() == true) R.drawable.ic_clear else 0 setCompoundDrawablesWithIntrinsicBounds(0, 0, clearIcon, 0) &#125; override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) = Unit override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) = Unit &#125;) setOnTouchListener(View.OnTouchListener &#123; _, event -&gt; if (event.action == MotionEvent.ACTION_UP) &#123; if (event.rawX &gt;= (this.right - this.compoundPaddingRight)) &#123; this.setText("") return@OnTouchListener true &#125; &#125; return@OnTouchListener false &#125;)&#125; 2.Á¶ÅÊ≠¢Â§çÂà∂Á≤òË¥¥12345678910111213141516171819fun TextView.disableCopyPaste() &#123; isLongClickable = false setTextIsSelectable(false) customSelectionActionModeCallback = object : ActionMode.Callback &#123; override fun onCreateActionMode(mode: ActionMode?, menu: Menu): Boolean &#123; return false &#125; override fun onPrepareActionMode(mode: ActionMode?, menu: Menu): Boolean &#123; return false &#125; override fun onActionItemClicked(mode: ActionMode?, item: MenuItem): Boolean &#123; return false &#125; override fun onDestroyActionMode(mode: ActionMode?) &#123;&#125; &#125;&#125; 3.‰ªÖÊîØÊåÅËæìÂÖ•ÂèØÊâìÂç∞ÁöÑ ASCII ÂÄºÂèØÊâìÂç∞ÁöÑ ASCII Â≠óÁ¨¶ÔºåÂèØ‰ª•ÈÄöËøáÈÅçÂéÜ 1~128 ÔºåÂ∞ÜÂÖ∂Âº∫ËΩ¨‰∏∫ char Á±ªÂûãÂÆûÁé∞ 123for (int i = 0; i &lt; 128; i++) &#123; System.out.print((char) i); &#125; ËøêË°åÁªìÊûú !‚Äù#$%&amp;‚Äô()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~ Âõ†‰∏∫ ‚Äú „ÄÅÂõûËΩ¶„ÄÅ Á©∫Ê†º„ÄÅ‚Äô„ÄÅ &amp;„ÄÅ&lt; „ÄÅ&gt; ÈúÄË¶ÅËøõË°åËΩ¨‰πâÔºåÊâçËÉΩÂú® android ÁöÑ xml ‰∏≠‰ΩøÁî®„ÄÇÂØπÁÖßÂ¶Ç‰∏ã 1234567&amp;#34; Êàñ &amp;quot; &quot; \n ÂõûËΩ¶&amp;#160; Á©∫Ê†º&amp;#39; Êàñ &amp;apos; &apos;&amp;#38; Êàñ &amp;amp; &amp;&amp;#60; Êàñ &amp;lt; &lt;&amp;#62; Êàñ &amp;gt; &gt; Ëã•Áõ¥Êé•‰ΩøÁî®Â≠óÁ¨¶ÔºåÊØîÂ¶Ç &lt;Ôºå‰ºöÊä•ÈîôÔºö The value of attribute ‚Äúandroid:digits‚Äù associated with an element type ‚ÄúEditText‚Äù must not contain the ‚Äò&lt;‚Äô character. Âõ†Ê≠§ÔºåÂú® xml Êñá‰ª∂‰∏≠Áªô EditText ÊåáÊòé digits Â±ûÊÄß‰∏∫Âç≥ÂèØ 1android:digits="!#$%&amp;amp;'()*+,-./0123456789:;&amp;lt;=&amp;gt;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~&amp;#34;" Âè¶‰∏ÄÁßçÊñπÂºèÔºåÂèØ‰ª•ÊîπÂèòÈîÆÁõòÁöÑÂàùÂßãÁä∂ÊÄÅÔºöimeOptions=‚ÄùflagForceAscii‚Äù ‰πüÂèØ‰ª•Âú®‰ª£Á†Å‰∏≠ÔºåÈÄöËøá setTextFilter Êù•ÂÆûÁé∞„ÄÇ Âà§Êñ≠ÊòØÂê¶‰∏∫ ASCII 123456static boolean isASCII(String s) &#123; for (int i = 0; i &lt; s.length(); i++) if (s.charAt(i) &gt; 127) return false; return true;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËøÅÁßªÂà∞AndroidX]]></title>
    <url>%2Fblog%2F2019%2F10%2F27%2F%E5%BF%AB%E9%80%9F%E8%BF%81%E7%A7%BB%E5%88%B0%20AndroidX%2F</url>
    <content type="text"><![CDATA[Android Studio Êèê‰æõÁöÑ Migrate to AndroidX ÂäüËÉΩ‰∏çÊòØÁâπÂà´ÂÆåÂñÑÔºåÂæàÂ§öÊñá‰ª∂ÁöÑÂåÖÂêçÊõøÊç¢‰∏çÂÆåÊï¥„ÄÇÂèØ‰ª•ÈÄöËøáËá™ÂÆö‰πâËÑöÊú¨Êù•Â§ÑÁêÜËøô‰∏™ÊµÅÁ®ã„ÄÇ ÂåÖÂêçÊò†Â∞ÑÊñá‰ª∂‰∏ãËΩΩÂú∞ÂùÄÔºö https://developer.android.com/topic/libraries/support-library/downloads/androidx-class-mapping.csv ËÑöÊú¨Êñá‰ª∂Ôºö 1234567891011#!/usr/bin/env bashMAPPING_FILE=csvÊñá‰ª∂Ë∑ØÂæÑPROJECT_DIR=È°πÁõÆÁõÆÂΩïreplace=&quot;&quot;while IFS=, read -r from todo replace+=&quot;; s/$from/$to/g&quot;done &lt;&lt;&lt; &quot;$(cat $MAPPING_FILE)&quot;fd . $PROJECT_DIR -e kt -e java -e xml --print0 | xargs -0 gsed -i &quot;$replace&quot; Ê≥®Ôºömac ÈúÄË¶ÅÂÆâË£Ö fd Âíå gnu-sed 12brew install fd # fd ÊòØ find ÂëΩ‰ª§ÁöÑÊõø‰ª£ÂìÅbrew install gnu-sed ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê https://gist.github.com/dlew/5db1b780896bbc6f542e7c00a11db6a0 https://gist.github.com/dudeinthemirror/cb4942e0ee5c3df0fcb678d1798e1d4d ËøÅÁßªÂà∞ AndroidX Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰øùÈô©Âü∫Á°ÄÁü•ËØÜ]]></title>
    <url>%2Fblog%2F2019%2F05%2F26%2F%E4%BF%9D%E9%99%A9%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[1„ÄÅ‰∏∫‰ªÄ‰πàË¶Å‰π∞‰øùÈô©ÔºüË¥≠‰π∞‰øùÈô©ÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÈ¢ÑÊúü‰ª•Â§ñÁöÑ‰∫ã‰ª∂ÂØπË¢´‰øùÈô©‰∫∫ÁöÑË¥¢Âä°Áä∂ÂÜµÈÄ†ÊàêÂÜ≤ÂáªÔºå‰∏∫ÂèóÁõä‰∫∫Êèê‰æõÁªèÊµéË°•ÂÅøÂáèËΩªË¥üÊãÖ„ÄÇÁî®ÁªèÊµéÂ≠¶ÂéüÁêÜÊù•Ëß£ÈáäÂ∞±ÊòØË¢´‰øùÈô©‰∫∫ÈÄöËøáÁº¥Á∫≥‰øùË¥πÊç¢ÂèñÊú™Êù•Ë¥¢Âä°Áä∂ÂÜµÊõ¥Â§ßÁöÑÁ°ÆÂÆöÊÄß„ÄÇ ÂÅáËÆæÊ≤°‰π∞‰øùÈô©ÂâçÔºå‰Ω†Êú™Êù•Ë¥¢ÂØåÁé∞ÂÄºÁöÑËåÉÂõ¥ÊòØ [-50 ‰∏áÂÖÉÔºå200 ‰∏áÂÖÉ]ÔºåÊúâË¥üÂÄºÁöÑÂéüÂõ†ÂèØËÉΩÊòØÂêÑÁßçË¥¢ÂØåÊçüÂ§±ÔºåÊØîÂ¶ÇÂÆ∂ÈáåÂ§ßÁÅ´ÔºåÊØîÂ¶ÇÊ≤ªÁóÖËøáÁ®ã‰∏≠ÊîØ‰ªòÁöÑÈ´òÈ¢ùÂåªÁñóË¥πÁî®ÔºõËÄåÈÄöËøáË¥≠‰π∞‰øùÈô©Ôºå‰Ω†ÁöÑÊú™Êù•Ë¥¢ÂØåÁé∞ÂÄºÁöÑËåÉÂõ¥ÂèØËÉΩÂèòÊàê [80 ‰∏áÔºå190 ‰∏á]ÔºåËôΩÁÑ∂ÊúÄÂ§ßÂÄºÂõ†‰∏∫Ë¶Å‰∫§‰øùË¥πËÄåÂèòÂ∞è‰∫ÜÔºå‰ΩÜÊòØÊ≥¢Âä®ËåÉÂõ¥Êõ¥Âä†Á°ÆÂÆö‰∫ÜÔºàËøô‰∏™‰æãÂ≠ê‰∏≠Ê≥¢Âä®ËåÉÂõ¥‰ªé 250 ‰∏áÁº©Â∞èÂà∞ 110 ‰∏áÔºåÊâÄ‰ª•Êú™Êù•Êõ¥Á°ÆÂÆö‰∫Ü)„ÄÇ 50w ‰øùÈ¢ù 20 Âπ¥ÂêéÂæàÂèØËÉΩÂ∞±‰∏çÂÄºÈí±‰∫ÜÔºå‰π∞‰øùÈô©ËøòÊúâÊÑè‰πâÂêóÔºü ‰π∞‰øùÈô©ÂÖ∂ÂÆû‰π∞ÁöÑÊòØ‰øùÈöú„ÄÇÂÅáËÆæ‰Ω†‰π∞‰∏Ä‰∏™ 50w ‰øùÈ¢ùÁöÑÈáçÁñæÈô©ÔºåÁº¥Ë¥πÊúü‰∏∫ 30 Âπ¥„ÄÇÁÑ∂ÂêéË¥≠‰π∞‰πãÂêéÁº¥‰∫Ü1 Âπ¥Â∞±Âá∫Èô©‰∫ÜÔºå‰Ω†Á´ãÂàªÂ∞±ËÉΩÊãøÂà∞ 50wÔºåËÄå‰∏îÂêéÈù¢ÁöÑ‰øùË¥πÈÉΩ‰ªéÊ≠§‰∏çÁî®Áº¥‰∫Ü„ÄÇÂ¶ÇÊûú‰π∞ÁöÑÊòØÂ§öÊ¨°Ëµî‰ªòÈáçÁñæÔºåÈô§‰∫ÜËøôÊ¨°Âá∫Èô©Ëµî‰ªòÁöÑÁñæÁóÖÂ§ñÔºåÂêéÈù¢Â¶ÇÊûúÂæó‰∫ÜÂÖ∂‰ªñÊª°Ë∂≥Ëµî‰ªòÊù°‰ª∂ÁöÑÂÖ∂‰ªñÁñæÁóÖÔºåËøòËÉΩÂÜçÊ¨°ÂæóÂà∞Ëµî‰ªò„ÄÇ ÂÖ∂ÂÆûÈÄöËÉÄÂØπÊâÄÊúâËµÑ‰∫ßÁ±ªÂûãÈÉΩÊúâÂΩ±Âìç„ÄÇ Êó†ËÆ∫ÊòØÁé∞Èáë„ÄÅÂ≠òÊ¨æ„ÄÅËÇ°Á•®„ÄÅÊàø‰∫ßÔºåÈÉΩÊàñÂ§öÊàñÂ∞ë‰ºöÂèóÂà∞ÈÄöË¥ßËÜ®ËÉÄÁöÑÂΩ±Âìç„ÄÇÈô§Èùû‰Ω†È©¨‰∏ä„ÄÅÁ´ãÂàª„ÄÅÂΩì‰∏ã„ÄÅÂ∞±ÊääËøôÈí±Ëä±‰∫Ü„ÄÇÈÄöË¥ßËÜ®ËÉÄÊâÄÂ∏¶Êù•ÁöÑ‰øùÈ¢ùÁº©Ê∞¥ÔºåÁ°ÆÂÆûÊòØ‰∏Ä‰∏™ÂÆ¢ËßÇÂ≠òÂú®ÁöÑ‰∫ãÂÆûÔºå‰ΩÜÂÆÉÊòØËµÑ‰∫ßÊï¥‰ΩìÁöÑÂèòÂåñÔºåËÄå‰∏çÊòØ‰øùÈô©Êú¨Ë∫´Â∏¶Êù•ÁöÑÈóÆÈ¢ò„ÄÇÁü≠ÊúüÂÜÖÁöÑÈÄöË¥ßËÜ®ËÉÄÂØπÊàë‰ª¨ÁöÑÂΩ±ÂìçÂÖ∂ÂÆûÂæàÂ∞èÔºå‰ΩÜÊòØ‰øùÈô©‰∫§ÂÆåÈ©¨‰∏äÊúâ‰øùÈöúÔºàÁ≠âÂæÖÊúüÁªìÊùü‰πãÂêéÔºâ„ÄÇ Âà´Áî®ÁúãÁêÜË¥¢‰∫ßÂìÅÁöÑÁúºÂÖâÔºåÂéªË¶ÅÊ±Ç‰∏ÄÁßçÈ£éÈô©ÁÆ°ÁêÜÂ∑•ÂÖ∑„ÄÇ ÊúÄÂ•ΩÁöÑÊäóÈÄöËÉÄÂ∑•ÂÖ∑ÔºåÊòØ‰Ω†ÁöÑËµöÈí±ËÉΩÂäõ„ÄÇ Â§öÊï∞‰∫∫ÁöÑÈáçÁñæ‰øùÈöúÊòØ‰∏çË∂≥ÁöÑ„ÄÇ ÂæàÂ§ö‰∫∫Èô§‰∫ÜÂõΩÂÆ∂Âº∫Âà∂Áº¥Á∫≥ÁöÑ‰∫îÈô©‰πãÂ§ñÔºåÊ≤°ÊúâÁªôËá™Â∑±Ë¥≠‰π∞ÂÖ∂‰ªñ‰øùÈô©„ÄÇËÄå‰∫îÈô©Âπ∂Ê≤°Êúâ‰øùÈöúÈáçÁñæ„ÄÇÂèØËÉΩÈÉ®ÂàÜ‰ºÅ‰∏ö‰∏∫ÂëòÂ∑•Êäï‰øù‰∫ÜÂëòÂ∑•‰øùÈô©Á¶èÂà©ËÆ°ÂàíÔºå‰πüÂ∞±ÊòØÂïÜ‰∏öÊÄßÂõ¢‰Ωì‰øùÈô©„ÄÇÂ¶ÇÊûúÂ∞±ËÅåÊâÄÂú®ÂÖ¨Âè∏ÊàñÂçï‰ΩçÂ∑≤‰∏∫ÂëòÂ∑•Ë¥≠‰π∞‰∫ÜÂïÜ‰∏öÂõ¢‰Ωì‰øùÈô©ÔºåÂèØ‰ª•Ëøõ‰∏ÄÊ≠•Áúã‰∏Ä‰∏ã‰øùÈöúËÆ°ÂàíÁªÑÂêàÂÜÖÊòØÂê¶ÊúâÊèê‰æõÁõ∏ÂÖ≥ÁöÑÈáçÁñæ‰øùÈöú„ÄÇ ‰ΩÜÊòØÔºåÂÖ¨Âè∏ÁªôÂëòÂ∑•‰π∞ÁöÑ‰øùÈô©ÔºåÈÄöÂ∏∏ÈÉΩÊòØ‰∏ÄÂπ¥ÊúüÁöÑÁü≠ÊúüÈô©ÔºåÂΩìÂëòÂ∑•Á¶ªËÅå‰πãÂêé‰πüÂ∞±‰∏çÂÜç‰øùÈöú‰∫Ü„ÄÇÊâÄ‰ª•ÔºåÊù°‰ª∂ÂÖÅËÆ∏ÁöÑÊÉÖÂÜµ‰∏ãÔºåËøòÊòØËá™Â∑±Ë¥≠‰π∞‰∏Ä‰ªΩÈïøÊúüÁöÑ‰øùÈô©ÊØîËæÉÁ®≥Â¶•„ÄÇ 2„ÄÅ‰øùÈô©ÁöÑÂàÜÁ±ª ‰∏Ä„ÄÅË¥¢‰∫ß‰øùÈô©Ë¥¢‰∫ß‰øùÈô©ÔºåÂèàÁß∞‰∫ßÁâ©‰øùÈô©ÔºåÊòØ‰ª•ÂêÑÁßçË¥¢‰∫ßÂèäÂÖ∂Áõ∏ÂÖ≥Âà©Áõä‰∏∫‰øùÈô©Ê†áÁöÑÁöÑ‰øùÈô©„ÄÇË¥¢‰∫ß‰øùÈô©ÊòØ‰∏ÄÁßçÁ§æ‰ºöÂåñÁöÑÁªèÊµéË°•ÂÅøÂà∂Â∫¶ÔºåÂÖ∂‰∏ªË¶ÅÁõÆÁöÑÊòØË°•ÂÅøÊäï‰øù‰∫∫ÊàñËÄÖË¢´‰øùÈô©‰∫∫ÁöÑÁªèÊµéÊçüÂ§±„ÄÇ Â§ßÂÆ∂ÊØîËæÉÁÜüÊÇâÁöÑÊú∫Âä®ËΩ¶ËæÜ‰øùÈô©‰πüÁß∞Ê±ΩËΩ¶‰øùÈô©ÊàñËΩ¶Èô©ÔºåÊòØË¥¢‰∫ß‰øùÈô©ÁöÑ‰∏ÄÁßçÔºå ‰ª•ËΩ¶ËæÜÊú¨Ë∫´ÂèäÁ¨¨‰∏âËÄÖË¥£‰ªª‰∏∫‰øùÈô©Ê†áÁöÑ„ÄÇ‰∏ªË¶Å‰øùÈöúÂõ†ËΩ¶Á•∏ÊàñËÄÖËá™ÁÑ∂ÁÅæÂÆ≥ÂØºËá¥ÁöÑÊçüÂ§±„ÄÇÂÖ∂‰øùÈô©Ê†áÁöÑÔºå‰∏ªË¶ÅÊòØËΩ¶ËæÜ„ÄÇ ‰∫å„ÄÅ‰∫∫Ë∫´Èô©‰∫∫Ë∫´Èô©ÔºåÊòØ‰ª•‰∫∫ÁöÑÂØøÂëΩÂíåË∫´‰Ωì‰Ωú‰∏∫Êäï‰øùÊ†áÁöÑ‰øùÈô©„ÄÇÂú®‰∏≠ÂõΩÔºå‰∫∫Ë∫´Èô©ÂèàÂàÜ‰∏∫Á§æ‰ºöÂº∫Âà∂‰øùÈô©ÂíåÂïÜ‰∏ö‰øùÈô©‰∏§Â§ßÁ±ª„ÄÇ Êàë‰ª¨Êó•Â∏∏‰∏≠Â∏∏ËØ¥„Äå‰∫îÈô©‰∏ÄÈáë„ÄçÔºö „Äå‰∫îÈô©„ÄçÂÖ∂ÂÆûÂ∞±ÊòØÊåá„ÄåÁ§æ‰ºö‰øùÈô©„ÄçÔºåÁÆÄÁß∞Á§æ‰øùÔºåÂåÖÊã¨ÂÖªËÄÅ‰øùÈô©„ÄÅÂåªÁñó‰øùÈô©„ÄÅÁîüËÇ≤‰øùÈô©„ÄÅÂ∑•‰º§‰øùÈô©„ÄÅÂ§±‰∏ö‰øùÈô©„ÄÇ „Äå‰∏ÄÈáë„ÄçÊåáÁöÑÊòØ‰ΩèÊàøÂÖ¨ÁßØÈáë„ÄÇ ‰∫∫ÂØø‰øùÈô©„ÄÅÊÑèÂ§ñÈô©„ÄÅÈáçÁñæÈô©ËøôÂá†‰∏™Èô©ÁßçÊòØÁõ∏‰∫íË°•ÂÖÖÁöÑÂÖ≥Á≥ª„ÄÇ ‰π∞‰∫ÜÈáçÁñæÈô©Â∞±‰∏çÁî®‰π∞ÂØøÈô©ÔºüÈùû‰πü„ÄÇÈáçÁñæÈô©ÁöÑË∫´ÊïÖË¥£‰ªªÊòØÂíåÈáçÁñæÂÖ±‰∫´‰øùÈ¢ùÁöÑ„ÄÇÂ∞±ÊòØËØ¥ÔºåÂ¶ÇÊûúÂ∞èÊòéÊÇ£‰∫ÜÈáçÁñæÔºåÁÑ∂Âêé‰øùÈô©ÂÖ¨Âè∏Â∞±ÊääÈí±ËµîÁªô‰ªñÔºåË∫´ÊïÖ‰øùÈöúË¥£‰ªªÂ∞±ÂÆåÂÖ®ÁªàÊ≠¢‰∫Ü„ÄÇÂ¶ÇÊûúÂ∞èÊòéÈáçÁñæ‰∏çÊ≤ªËÄå‰∫°Ôºå‰øùÈô©ÂÖ¨Âè∏Â∞±‰∏ç‰ºöËµî‰ªñË∫´ÊïÖË¥πÁî®„ÄÇËÄå‰∏îÈáçÁñæÈô©ÁöÑÊ≤ªÁñóË¥πÁî®È´òÊòÇÔºåÂ¶ÇÊûú‰Ω†‰π∞‰∫Ü 30/50 ‰∏áÁöÑ‰øùÈ¢ùÔºåÈí±ÂæàÂÆπÊòìÂ∞±Ëä±ÂÖâ‰∫ÜÔºåÂØøÈô©Ë¥£‰ªªÂàôÊòéÊòæ‰∏çË∂≥„ÄÇ ‰π∞‰∫ÜÊÑèÂ§ñÈô©Â∞±‰∏çÁî®‰π∞ÂØøÈô©ÔºüÈùû‰πü„ÄÇ‰∏æ‰∏™Ê†óÂ≠êÔºåÊÑèÂ§ñÈô©‰∏ÄËà¨ÊòØ‰∏ç‰øùÁåùÊ≠ªÈ£éÈô©ÁöÑ„ÄÇÁåùÊ≠ªÁöÑÂÜÖÊ∂µÂèØ‰ª•Ê¶ÇÊã¨‰∏∫ ‚ÄúÂõ†ÁóÖÁ™ÅÁÑ∂Ê≠ª‰∫°‚Äù„ÄÇËÄåÊÑèÂ§ñÈô©ÊòØ‰∏ç‰øùÂõ†ÁóÖËÄå‰º§ÊÆãÂíåÊ≠ª‰∫°ÁöÑ„ÄÇÊâÄ‰ª•Ëøô‰∏™Âè™ËÉΩÂú®ÈáçÁñæÈô©ÂíåÂØøÈô©ÈáåÈù¢Ëµî‰ªò„ÄÇÁõ∏ÂØπËÄåË®ÄÔºåÂØøÈô©ÁöÑËåÉÂõ¥Ë¶ÅÂπøÂæàÂ§ö„ÄÇ ‰π∞‰∫ÜÈáçÁñæÈô©Â∞±‰∏çÁî®‰π∞ÊÑèÂ§ñÈô©ÔºüÈùû‰πü„ÄÇ‰∏æ‰∏™Ê†óÂ≠êÊù•ËØ¥Êòé‰∏Ä‰∏ãÔΩûA ÂÖàÁîüË¥≠‰π∞‰∫Ü‰∏Ä‰ªΩ 100 ‰∏á‰øùÈ¢ùÁöÑÈáçÁñæÈô©ÔºåÊ≤°Ë¥≠‰π∞ÊÑèÂ§ñÈô©„ÄÇÂú®ÊüêÊ¨°È©æËΩ¶ËøáÁ®ã‰∏≠Ôºå‰∏çÂ∞èÂøÉÂèëÁîü‰∫ÜËΩ¶Á•∏ÔºåÈÄ†ÊàêÂ∑¶Êâã‰∏≠ÊåáÂäüËÉΩ‰∏ßÂ§±„ÄÅÊó†ÂêçÊåáÂíåÈ£üÊåáÁº∫Â§±„ÄÇ‰∏çÁ¨¶Âêà‰øùÈô©ÂêàÂêåÁ∫¶ÂÆöÁöÑÁñæÁóÖÂÆö‰πâÔºåÊó†Ê≥ïËé∑ÂæóËµî‰ªò„ÄÇ Â§ßÈÉ®ÂàÜÂïÜ‰∏ö‰øùÈô©‰∏ªË¶Å‰∏∫‰ª•‰∏ã‰∏âÁßçÁ±ªÂûãÔºö Áªô‰ªòÂûãÔºöÂç≥ÂèëÁîü‰øùÈô©‰∫ãÊïÖÊàñÁ¨¶ÂêàÁêÜËµîÊù°‰ª∂Êó∂Ôºå‰øùÈô©ÂÖ¨Âè∏ÊåâÁÖßÂêàÂêåÁ∫¶ÂÆöÁöÑÈáëÈ¢ù‰∏ÄÊ¨°ÊÄßÊàñÂàÜÂõ∫ÂÆöÁöÑÂ§öÊ¨°Â∞Ü‰øùÈ¢ùÊîØ‰ªòÁªôË¢´‰øùÈô©‰∫∫„ÄÇÊØîÂ¶ÇÈáçÁñæÈô©„ÄÇ Êä•ÈîÄÂûã/Ë°•ÂÅøÂûãÔºöÂç≥ÂèëÁîü‰øùÈô©‰∫ãÊïÖÊàñÁ¨¶ÂêàÁêÜËµîÊù°‰ª∂Êó∂Ôºå‰øùÈô©ÂÖ¨Âè∏Â∞ÜË¢´‰øùÈô©‰∫∫Âõ†‰∏∫Âá∫Èô©‰∫ã‰ª∂ÂÆûÈôÖÊîØÂá∫ÊàñÂÆûÈôÖÊçüÂ§±ÔºåÂ∞ÜÂú®‰øùÈ¢ùËåÉÂõ¥ÂÜÖÁöÑÈáëÈ¢ùÊîØ‰ªòÁªôË¢´‰øùÈô©‰∫∫„ÄÇÁ±ª‰ºº‰∫é‰∫åÊ¨°Êä•ÈîÄÁöÑÈò≤ÁôåÈô©„ÄÇÊØîÂ¶Ç‰∫åÊ¨°Êä•ÈîÄÂûãÁöÑÂåªÁñó‰øùÈô©„ÄÇ Ê¥•Ë¥¥ÂûãÔºö‰∏ªË¶ÅÁî®‰∫éÂèëÁîü‰øùÈô©‰∫ãÊïÖÊó∂ÔºåË¢´‰øùÈô©‰∫∫‰∏çËÉΩÂèÇÂä†Â∑•‰ΩúÈÄ†ÊàêÁöÑÊî∂ÂÖ•ÊçüÂ§±Ôºå‰ª•ÂèäÂõ†‰∏∫‰ΩèÈô¢Ê≤ªÁñó‰∫ßÁîüÁöÑÂøÖË¶ÅÈó¥Êé•Ë¥πÁî®Á≠âÁöÑÊçüÂ§±ÁöÑËµî‰ªòÔºå‰∏ÄËà¨ÊòØÊåâ‰øùÈô©ÂêàÂêåÁ∫¶ÂÆöÁöÑÈáëÈ¢ùÊîØ‰ªò„ÄÇ ‰∫∫Ë∫´‰øùÈô©ÁöÑÁ±ªÂûãÊØè‰∏™ÂõΩÂÆ∂ÁöÑ‰øùÈô©ÂàíÂàÜÈÉΩÊòØ‰∏çÂêåÁöÑ„ÄÇÂú®‰∏≠ÂõΩÔºå‰∫∫Ë∫´‰øùÈô©ÊòØÊåá‰ª•‰∫∫ÁöÑÂØøÂëΩÂíåË∫´‰Ωì‰∏∫‰øùÈô©Ê†áÁöÑÁöÑ‰∏ÄÁßç‰øùÈô©ÔºåÂàÜ‰∏∫‰∏âÁßçÔºöÂØøÈô©„ÄÅÂÅ•Â∫∑Èô©ÂíåÊÑèÂ§ñÈô©„ÄÇ Âú®Â∏ÇÈù¢‰∏äÂçïÁã¨ÈîÄÂîÆÁöÑÂØøÈô©ÔºåÊúÄÈïøÂè™‰ºö‰øùÈöúÂà∞ 70 Âë®Â≤Å„ÄÇ ‰∫∫ÂØø‰øùÈô©ÔºöÊòØ‰∏ÄÁßç‰ª•‰∫∫ÁöÑÁîüÊ≠ª‰∏∫‰øùÈô©ÂØπË±°ÁöÑ‰øùÈô©ÔºåÊòØË¢´‰øùÈô©‰∫∫Âú®‰øùÈô©Ë¥£‰ªªÊúüÂÜÖÁîüÂ≠òÊàñÊ≠ª‰∫°ÔºåÁî±‰øùÈô©‰∫∫Ê†πÊçÆÂ•ëÁ∫¶ËßÑÂÆöÁªô‰ªò‰øùÈô©ÈáëÁöÑ‰∏ÄÁßç‰øùÈô©„ÄÇÂú®‰∏≠ÂõΩ‰∫∫ÂØø‰øùÈô©ÁöÑ‰∏öÂä°ËåÉÂõ¥ÂåÖÊã¨ÁîüÂ≠ò‰øùÈô©„ÄÅÊ≠ª‰∫°‰øùÈô©„ÄÅ‰∏§ÂÖ®‰øùÈô©„ÄÇ ÂÅ•Â∫∑‰øùÈô©ÔºöÊòØ‰ª•ÈùûÊÑèÂ§ñ‰º§ÂÆ≥ËÄåÁî±Ë¢´‰øùÈô©‰∫∫Êú¨Ë∫´ÁñæÁóÖÂØºËá¥ÁöÑ‰º§ÊÆã„ÄÅÊ≠ª‰∫°‰∏∫‰øùÈô©Êù°‰ª∂ÁöÑ‰øùÈô©„ÄÇ ÊÑèÂ§ñ‰º§ÂÆ≥‰øùÈô©ÔºöÊòØ‰ª•‰∫∫ÁöÑË∫´‰ΩìÈÅ≠ÂèóÊÑèÂ§ñ‰º§ÂÆ≥‰∏∫‰øùÈô©Êù°‰ª∂ÁöÑ‰øùÈô©„ÄÇ ‰ªÄ‰πàÊòØÈïøÊúüÈô©ÂíåÁü≠ÊúüÈô©Ôºü ÈïøÊúüÈô©Ôºö‰øùÈô©Êúü‰∏∫‰∏ÄÂπ¥‰ª•‰∏äÁöÑ‰øùÈô©ÔºåÂ§öÊï∞ÊòØÂØøÈô©ÔºàÂåÖÊã¨‰∏§ÂÖ®„ÄÅÂÆöÊúüÂØøÈô©ÂíåÁªàË∫´ÂØøÈô©ÔºåÂàÜÁ∫¢ÂûãÊàñÈùûÂàÜÁ∫¢ÂûãÔºâÂíåÂÅ•Â∫∑Èô©‰∏≠ÁöÑÈáçÁñæÈô© Áü≠ÊúüÈô©Ôºö‰øùÈô©Êúü‰∏∫‰∏ÄÂπ¥Âèä‰ª•‰∏ãÁöÑ‰øùÈô©ÔºåÂ§öÊï∞ÊòØÊÑèÂ§ñÈô©ÔºàÂΩìÁÑ∂Áé∞Âú®ÈïøÊúüÊÑèÂ§ñÈô©‰πü‰∏çÂ∞ëËßÅ‰∫ÜÔºâÂíåÂÅ•Â∫∑Èô©‰∏≠ÁöÑÂåªÁñóÈô©ÔºåÂõ†‰∏∫Ëøô‰∫õ‰∫ßÂìÅÁêÜËµîÁªèÈ™åÊ≥¢Âä®ÂæàÂ§ßÔºåÂÅöÊàêÁü≠ÊúüÈô©Êñπ‰æøË∞ÉÊï¥Ë¥πÁéáÊàñÁªàÊ≠¢ÈîÄÂîÆ„ÄÇ ÂØπ‰∫é‰∫∫Ë∫´Èô©ÔºåÂ¶ÇÊûúÊúâÈïøÊúü‰∫ßÂìÅË¥≠‰π∞Â∞±Ë¥≠‰π∞ÈïøÊúüÁöÑÔºå‰∏çÊé®ËçêË¥≠‰π∞Áü≠Êúü‰∫ßÂìÅÔºåÊ≠£ÊòØÂõ†‰∏∫‰∏ÄËà¨‰∏ç‰øùËØÅ‰∏ã‰∏ÄÂπ¥ËÉΩÁª≠‰øùÔºåÈÄöÂ∏∏‰πü‰∏ç‰øùËØÅË¥πÁéáÁöÑÂõ†Á¥†„ÄÇ ÁêÜË¥¢Âûã vs ‰øùÈöúÂûã‰øùÈô© ÁêÜË¥¢Âûã‰øùÈô©ÔºåÈ°æÂêçÊÄù‰πâÔºåÊòØ‰∏ÄÁßçÁêÜË¥¢ÂÖºÈ°æ‰øùÈô©‰ΩúÁî®ÁöÑ‰∫ßÂìÅ„ÄÇ‰øùË¥πÂàÜ‰∏∫‰∏§ÈÉ®ÂàÜÔºå‰∏ÄÈÉ®ÂàÜ‰øùË¥πÁî®Êù•Êèê‰æõ‰øùÈô©‰øùÈöúÔºà‰æãÂ¶ÇË∫´ÊïÖËøîËøòÁ≠âÔºâÔºåËÄåÂè¶‰∏ÄÈÉ®ÂàÜÁî®Êù•ÊäïËµÑ„ÄÇ Á≤æÁÆóÂ∏àËÆ§‰∏∫ÔºåÂØπ‰∫éÁêÜË¥¢Âûã‰øùÈô©ÔºåÂ∫îÊõ¥Â§öÁöÑÂ∞ÜÂÖ∂ËßÜ‰∏∫ÁêÜË¥¢‰∫ßÂìÅËÄåÈùû‰øùÈô©ÔºåÂ¶ÇÊûúÈúÄË¶ÅÁöÑÊòØÈ£éÈô©‰øùÈöúÔºåÈÇ£‰πàËøòÊòØË¥≠‰π∞‰º†Áªü‰øùÈöúÂûã‰∫ßÂìÅÊõ¥ÂêàÈÄÇ„ÄÇ ÈÄöÂ∏∏ÔºåÁêÜË¥¢Âûã‰øùÈô©ÁöÑ‰øùÈöú‰∏çË∂≥ÔºåÁêÜË¥¢ÁöÑÊî∂Áõä‰πü‰∏çÈ´òÔºåÊâÄ‰ª•Ôºå‰∏ÄËà¨Âª∫ËÆÆÂ¶ÇÊûúÈúÄË¶ÅÁöÑÊòØÈ£éÈô©‰øùÈöúÔºåÈÇ£‰πàËøòÊòØË¥≠‰π∞‰º†Áªü‰øùÈöúÂûã‰∫ßÂìÅÊõ¥ÂêàÈÄÇ„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÁêÜË¥¢ÔºåÈÇ£‰πàË¥≠‰π∞‰∏ì‰∏öÁöÑÁêÜË¥¢‰∫ßÂìÅÊî∂ÁõäÁéá‰ºöÊõ¥Âä†ÂèØËßÇ„ÄÇ 3„ÄÅÈáçÁñæ‰ªÄ‰πàÊòØÈáçÁñæ‰øùÈöúÔºü‰øùÈô©‰∫ßÂìÅ‰∏≠ÁöÑÈáçÁñæÂÆö‰πâÊòØÊúâ‰∏•Ê†ºËßÑÂÆöÁöÑ„ÄÇÁÆÄÂçïÊù•ËØ¥Ê†πÊçÆ‰∏≠ÂõΩ‰øùÈô©ÁõëÁù£ÁÆ°ÁêÜÂßîÂëò‰ºöÔºàÁÆÄÁß∞„Äå‰øùÁõë‰ºö„ÄçÔºâ‰∫ßÂìÅÁõëÁÆ°Ë¶ÅÊ±ÇÔºåËÉΩÂÜ†ÂêçÈáçÁñæ‰∫ßÂìÅÁöÑ‰øùÈô©‰∫ßÂìÅÂøÖÈ°ªÊåâ‰∏≠ÂõΩ‰øùÈô©Ë°å‰∏öÂçè‰ºö‰∏é‰∏≠ÂõΩÂåªÂ∏àÂçè‰ºöÁöÑÈáçÁñæÂÆö‰πâÊèê‰æõ‰ª•‰∏ã 6 Áßç‰øùÈöúÔºöÊÅ∂ÊÄßËÇøÁò§„ÄÅÊÄ•ÊÄßÂøÉËÇåÊ¢óÂ°û„ÄÅËÑë‰∏≠È£éÂêéÈÅóÁóá„ÄÅÈáçÂ§ßÂô®ÂÆòÁßªÊ§çÊúØÊàñÈÄ†Ë°ÄÂπ≤ÁªÜËÉûÁßªÊ§çÊúØ„ÄÅÂÜ†Áä∂Âä®ËÑâÊê≠Ê°•ÊúØÂíåÁªàÊú´ÊúüËÇæÁóÖ„ÄÇÂè™Êúâ‰øùÈöú‰∫ÜËøô 6 ÁßçÊ†∏ÂøÉÈáçÁñæÁöÑ‰∫ßÂìÅÊâçËÉΩË¢´ÂëΩÂêç‰∏∫ ‚ÄúXX ÈáçÂ§ßÁñæÁóÖ‰øùÈô©‚ÄùÔºåËøô6ÁßçÈáçÁñæÂ∑≤ÁªèÂç†Âà∞‰∏ÄËà¨‰∫∫Áæ§ÊâÄÊúâÈáçÁñæÂèëÁóÖÁöÑ 80%-85%„ÄÇ ÈáçÁñæÈô©Â±û‰∫éÁªô‰ªòÂûãÁöÑÂÅ•Â∫∑Èô©„ÄÇÁªùÂ§ßÂ§öÊï∞ÈáçÁñæÈô©ÊåâÁªô‰ªòÊñπÂºèÂè™ÂàÜ‰∏∫‰∏§ÁßçÔºö ÊèêÂâçÁªô‰ªòÂûãÔºöÈáçÂ§ßÁñæÁóÖ‰øùÈô©Èáë‰∏é‰∫ßÂìÅÊàñ‰∫ßÂìÅÁªÑÂêàÈáåÂåÖÂê´ÁöÑ‰ªª‰ΩïË∫´ÊïÖ‰øùÈô©ÈáëË¥£‰ªªÂÖ±Áî®‰øùÈ¢ùÔºå‰πüÂ∞±ÊòØË∫´ÊïÖÊàñÈáçÁñæÂì™‰∏™ÂÖàÂèëÁîüÂ∞±ÂÖàËµî‰øùÈ¢ùÔºå‰ΩÜÂè™Ëµî‰ªò‰∏ÄÊ¨°ÔºåËµî‰ªòÂÆå‰πãÂêéÔºå‰øùÂçïÂç≥ÁªàÊ≠¢Â§±ÊïàÔºåÂõ†Ê≠§‰∫ßÂìÅ‰ª∑Ê†ºËæÉÈ¢ùÂ§ñÁªô‰ªòÁöÑ‰∫ßÂìÅ‰æøÂÆú„ÄÇ È¢ùÂ§ñÁªô‰ªòÂûãÔºöÂè™Ë¶ÅÂèëÁîüÈáçÁñæÂ∞±Áªô‰ªòÈáçÂ§ßÁñæÁóÖ‰øùÈô©Èáë‰øùÈ¢ùÔºå‰øùÂçïÁªßÁª≠ÊúâÊïàÔºåÂêéÁª≠Â¶ÇÊûúË∫´ÊïÖÂπ∂‰∏î‰∫ßÂìÅÊàñ‰∫ßÂìÅÁªÑÂêàÈáåÊúâÊèê‰æõË∫´ÊïÖË¥£‰ªªÁöÑÁõ∏ÂÖ≥‰øùÈô©ÔºåÂÜçÁªô‰ªò‰∏ÄÊ¨°Ë∫´ÊïÖ‰øùÈô©ÈáëÔºåÂæàÊòéÊòæÁî±‰∫éÂÆÉÊúâÂèØËÉΩËµî‰ªò‰∏§Ê¨°ÔºàÂÖàÈáçÁñæ‰∏ÄÊ¨°„ÄÅË∫´ÊïÖÂÜçËµî‰∏ÄÊ¨°ÔºâÔºåÊâÄ‰ª•ÂÆÉÁöÑ‰ª∑Ê†ºË¶ÅÊØîÊèêÂâçÁªô‰ªòÂûã‰∫ßÂìÅË¶ÅË¥µ„ÄÇ 3.1 ÈáçÁñæ‰øùÈöúÁöÑÁóÖÁßçÊï∞ÁõÆË∂äÂ§ßË∂äÂ•ΩÂêóÔºü Êà™Ê≠¢ 2016 Âπ¥‰øùÁõë‰ºöÊúÄÊñ∞ÂÆö‰πâÁöÑË°å‰∏öÊ†áÂáÜÈáçÂ§ßÁñæÁóÖÊòØ 25 ÁßçÔºåÊàë‰ª¨ÂèØ‰ª•ÁÆÄÁß∞‰∏∫ ‚ÄúË°åÊ†á 25 ÁßçÔºåÂøÖÂ§á 6 Áßç‚Äù„ÄÇËøô 6+19 Áßç‰∏ÄÂÖ± 25 ÁßçÈáçÁñæÂ∑≤ÁªèÂç†Âà∞‰∫ÜÊâÄÊúâÈáçÁñæÂèëÁîüÊ¶ÇÁéáÁöÑ 95%„ÄÇÁõÆÂâçÊó†ËÆ∫‰øùÈöúËåÉÂõ¥ÊòØ 80 ÁßçÈáçÁñæÔºåËøòÊòØ 100 ÁßçÈáçÁñæÔºåÂâç 6 ÁßçÁóÖÁßçÂêÑÂÆ∂‰øùÈô©ÂÖ¨Âè∏ÂÆö‰πâÈÉΩÊòØÁõ∏ÂêåÁöÑÔºå19 ÁßçÊòØÂ¶ÇÊûúÊúâÔºåÈúÄË¶ÅË∑üÊ†áÂáÜ‰∏≠ËßÑÂÆöÁöÑ‰∏ÄËá¥„ÄÇ ÊâÄ‰ª•ÔºåÁóÖÁßçÊï∞Èáè‰∏ç‰ª£Ë°®‰ªÄ‰πà„ÄÇÂØπ‰∫é 99% ÁöÑÂõΩ‰∫∫Êù•ËØ¥ÔºåÈÅáÂà∞Ë°å‰∏ö 25 ÁßçÈáçÁñæ‰πãÂ§ñÁöÑÂÖ∂‰ªñÈáçÁñæÊ¶ÇÁéáÂÆûÂú®ÊòØÂæÆ‰πéÂÖ∂ÂæÆ„ÄÇ 3.2 ‰ªÄ‰πàÊòØÈáçÁñæÂàÜÁªÑÔºüÔºüÁªèÂ∏∏ÁúãÂà∞ ‚ÄúÈáçÁñæÂàÜÁªÑ‚Äù Ëøô‰∏™ËØçÔºåÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü Ëß£Á≠îÔºöÊüêÈáçÁñæÈô©ÂàÜ ABCD Âõõ‰∏™ÁªÑÔºåÂÅáËÆæÊüê‰∫∫Âæó‰∫Ü B ÁªÑ‰∏≠ÁöÑÁñæÁóÖ B1Ôºå‰øùÈô©ÂÖ¨Âè∏ÁêÜËµîËøá‰∫ÜÔºå‰ª•ÂêéÂè™ÁÆ° ACD ÁªÑÈáåÁöÑÁñæÁóÖÔºåÂÜçÂæó B ÁªÑÈáåÁöÑ‰ªª‰ΩïÁñæÁóÖÈÉΩ‰∏çËµî‰ªòÔºåËøôÊòØÈáçÁñæÂàÜÁªÑÁöÑÊ∂µ‰πâ„ÄÇÂàÜÁªÑÂú®Êú¨Ë¥®‰∏äÊòØ‰øùÈô©ÂÖ¨Âè∏Âú®ÂõûÈÅøËá™Â∑±ÁöÑÈ£éÈô©ÔºåÂõ†‰∏∫ÂàÜÁªÑÂêéÂêå‰∏ÄÁªÑÂà´Âè™Ëµî‰ªò‰∏ÄÊ¨°„ÄÇ ÂØπ‰∫éÂ§öÊ¨°Ëµî‰ªòÁöÑÈáçÁñæÔºåÁõ¥ËßÇÂú∞ÁúãÊòØ‰∏çÂàÜÁªÑËá™ÁÑ∂ÊØîÂàÜÁªÑÁöÑÂ•ΩÔºå‰ΩÜÈáçÁñæÈô©‰∏çÂàÜÁªÑÊÑèÂë≥ÁùÄ‰øùÈô©ÂÖ¨Âè∏Ëµî‰ªòÁöÑÊ¶ÇÁéáÊõ¥Â§ß„ÄÅÈ£éÈô©Êõ¥È´ò„ÄÇÊâÄ‰ª•Â∏ÇÈù¢‰∏äÂ§öÊ¨°Ëµî‰ªòÁöÑÈáçÁñæÈô©Ôºå‰∏çÂàÜÁªÑÁöÑÊØîËæÉÂ∞ëÔºå‰ª∑Ê†º‰πüÂæàÈ´ò„ÄÇ Ë¥≠‰π∞ÈáçÁñæÂàÜÁªÑÁöÑ‰∫ßÂìÅÂ∫îËØ•ÊÄé‰πàÈÄâÔºü ÁôåÁóáÔºàÊÅ∂ÊÄßËÇøÁò§ÔºâÂçïÁã¨ÂàÜÁªÑÁöÑÂ•ΩËøáÁôåÁóá‰∏çÂçïÁã¨ÂàÜÁªÑÔºåÊ≤°ÊúâÂçïÁã¨ÂàÜÁªÑ‰ΩÜÂêåÁªÑÁñæÁóÖÁöÑÊï∞ÈáèÂ∞ëÊàñËÄÖÊ≤°ÊúâÈÇ£‰πàÈ´òÂèë‰πüÊòØÊØîËæÉÂ•ΩÁöÑÊÉÖÂÜµ„ÄÇ ÂàÜÁªÑÂ§ö„ÄÅÈ´òÂèëÁñæÁóÖË∂äÂàÜÊï£Ë∂äÂ•Ω„ÄÇ ÂØπ‰∫éÈáçÁñæÂ§öÊ¨°Ëµî‰ªòÁöÑ‰∫ßÂìÅÔºåÊàë‰ª¨ËÆ§‰∏∫ÁôåÁóáÂ§öÊ¨°Ëµî‰ªò &gt; ÈáçÁñæ‰∏çÂàÜÁªÑ &gt; ÈáçÁñæÂàÜÁªÑÂêàÁêÜ &gt; ÈáçÁñæÂàÜÁªÑ‰∏çÂêàÁêÜÔºåÊúÄÂ•ΩÁöÑÊòØÁôåÁóáÂ§öÊ¨°Ëµî‰ªòÁöÑ„ÄÇ 3.2.1ÂàÜÁªÑË∑ü‰∏çÂàÜÁªÑÁöÑÊúâ‰ªÄ‰πàÂå∫Âà´ÔºüÂÖ∂ÂÆûÈáçÁñæÈô©‰∏≠ÊúÄ‰ºòÁöÑÈÄâÊã©ÊòØÈáçÁñæ‰∏çÂàÜÁªÑ‰∏îËµî‰ªòÂ§öÊ¨°ÁöÑÔºåÊØîÂ¶ÇÈïøÁîüÁ¶è‰ºòÂä†ÔºåÂÆÉÊòØ 100 ÁßçÈáçÁñæ‰∏çÂàÜÁªÑÔºåÊúÄÈ´òËµî‰ªò 2 Ê¨°ÁöÑ„ÄÇÂΩìÁÑ∂‰ª∑Ê†º‰πü‰ºöÊØîËæÉË¥µÔºå‰∏çÂàÜÁªÑÁöÑÂ§öÊ¨°Ëµî‰ªòÈáçÁñæÈô©‰ºöÊØîÂàÜÁªÑÁöÑÂ§öÊ¨°Ëµî‰ªòÈáçÁñæÈô©Ë¥πÁéáË¶ÅË¥µÂæàÂ§öÔºåË¶ÅÊ∏ÖÊ•öËá™Â∑±ÁöÑÈ¢ÑÁÆó„ÄÇ ÈïøÁîüÁ¶è‰ºòÂä† &gt; Â∫∑‰πê‰∏ÄÁîüÂä†ÂÄç‰øù &gt; Â∏∏ÈùíÊ†ëÂä†ÂÄçÁâà &gt; ÂºòÂ∫∑Â§öÂï¶ A ‰øù„ÄÇ 3.2.2ÂàÜÁªÑÁöÑÈÄâÊã©ÂéüÂàô1„ÄÅÊÅ∂ÊÄßËÇøÁò§ÊúÄÂ•ΩÂçïÁã¨ÂàÜÁªÑÔºåËøô‰∏™ÊúÄÈáçË¶Å„ÄÇ2„ÄÅÊÅ∂ÊÄßËÇøÁò§„ÄÅÁªàÊú´ÊúüËÇæÁóÖ„ÄÅÈáçÂ§ßÁñæÂô®ÂÆòÁßªÊ§çÊúØÊàñÈÄ†Ë°ÄÂπ≤ÁªÜËÉûÁßªÊ§çÊúØÔºåËøô‰∏âÁ±ªÈáçÁñæÁöÑÂÜÖÂú®ÂÖ≥ËÅîÊÄßËæÉÂº∫ÔºåÊúÄÂ•ΩÂèØ‰ª•ÊääÂÆÉ‰ª¨ÂàÜÈÖçÂà∞‰∏çÂêåÁªÑÂà´„ÄÇ3„ÄÅÊÄ•ÊÄßÂøÉÊ¢óÂêéË¶ÅÈ©¨‰∏äÂÆûÊñΩÂÜ†Áä∂Âä®ËÑâÊê≠Ê°•ÊâãÊúØÔºåÊó∂Èó¥Èó¥ÈöîÈùûÂ∏∏Áü≠ÔºåÂ¶ÇÊûúÂàÜÁªÑ‰∫ÜÔºåË¶ÅÊ≥®ÊÑèÈó¥ÈöîÊúü„ÄÇ 3.3Ëµî‰ªòÂ§öÂ∞ëÊ¨°ÁöÑÊúÄ‰Ω≥ÔºüÂÖ∂Ê¨°‰π∞ÈáçÁñæÈô©ÔºåËµî‰ªòÊ¨°Êï∞ 2~4 Ê¨°ÊúÄ‰Ω≥ÔºåËôΩÁÑ∂Â∏ÇÈù¢‰∏äÁé∞Âú®Âá∫Áé∞‰∫ÜÂæàÂ§öÂèØËµî‰ªò 5 Ê¨°„ÄÅ6 Ê¨°ÔºåÁîöËá≥ 7 Ê¨°ÁöÑÈáçÁñæÈô©Ôºå‰ΩÜËøôÂÖ∂ÂÆûÊòØ‰øùÈô©ÂÖ¨Âè∏‰∏∫‰∫ÜÈôç‰ΩéËµî‰ªòÁéá‰ªéËÄåÂÅöÂá∫ÁöÑÈÄâÊã©„ÄÇ ÂÖ∂ÂÆûÈáçÁñæËµî‰ªò 2 Ê¨°ÔºåËΩªÁóá 3 Ê¨°Âü∫Êú¨Â∑≤ÁªèË∂≥Â§ü‰∫ÜÔºåÊ¨°Êï∞Â§™Â§öÂπ∂Êó†Â§™Â§ßÁöÑÂÆûË¥®ÊÑè‰πâ„ÄÇÈô§Ê≠§‰πãÂ§ñÔºåËµî‰ªòÈó¥Èöî 90 Â§©ÔΩû180 Â§©ÊúÄ‰Ω≥Ôºå1 Âπ¥Èó¥ÈöîÊúüÂ§™ÈïøÔºå‰∏çÂª∫ËÆÆÈÄâË¥≠„ÄÇ 4„ÄÅ‰∏≠Áóá‰∏≠ÁóáÂ∞±ÊòØÂ§Ñ‰∫éËΩªÁóáÂíåÈáçÁñæÈô©‰πãÈó¥ÁöÑÊÉÖÂÜµÔºåÊØîËΩªÁóá‰∏•Èáç‰∏ÄÁÇπÔºå‰ΩÜÊòØËøòÊ≤°ÊúâËææÂà∞ÈáçÁñæÁöÑ‰∏•ÈáçÁ®ãÂ∫¶Ôºå‰ΩÜÊòØÁêÜËµîÁöÑÈáëÈ¢ù‰πüÊØîËΩªÁóá‰ºöÊõ¥Â§ö‰∏Ä‰∫õ„ÄÇ 5„ÄÅËΩªÁóáËΩªÁóáÂèàÂè´ÂÅöËΩªÂ∫¶ÈáçÁñæÔºå‰πüÂ∞±ÊòØËØ¥Ëøô‰∏™ÁóÖ‰πüÊòØÁóÖÔºå‰ΩÜÊ≤°ÊúâÈáçÁñæ„ÄÅ‰∏≠ÁóáÈÇ£‰πà‰∏•ÈáçÔºå‰∏çËøáÂ¶ÇÊûúÊ≤°ÊúâÂæóÂà∞ÂèäÊó∂ÁöÑÂèëÁé∞ÊàñËÄÖÊ≤ªÁñóÔºå‰ªªÁî±ÂÖ∂ÂèëÂ±ïÔºåÈÇ£‰πàÂæàÂ§ßÊ¶ÇÁéá‰ºöÈÄ†ÊàêÈáçÁñæ„ÄÇÊØîÂ¶ÇËØ¥ÁôåÁóáÁöÑÂâçÊúüË°®Áé∞Â∞±ÊòØÂéü‰ΩçÁôåÔºåËÑëÁÇéÂêéÈÅóÁóáÁöÑÂâçÊúüÂ∞±ÊòØËÑëÁÇéÔºåËÑë‰∏≠È£éÂêéÈÅóÁóáÁöÑÂâçÊúüÊòØËΩªÂæÆËÑë‰∏≠È£éÁ≠âÁ≠â„ÄÇ 6„ÄÅÂ∞è‰øùÈô©ÂÖ¨Âè∏Èù†Ë∞±ÂêóÔºüÊàë‰π∞ÁöÑ‰øùÂçïÂÆâ‰∏çÂÆâÂÖ®ÔºåÊúÄÂêéËÉΩ‰∏çËÉΩËµîÔºüÂú®‰∏≠ÂõΩÂ¶ÇÊûúÊüê‰∏™ÂÖ¨Âè∏Ë¶ÅÁªèËê•‰øùÈô©‰∏öÂä°ÔºåË¶ÅÂçñ‰øùÂçïÁªôËá™ÁÑ∂‰∫∫Êàñ‰ºÅ‰∏öÔºåÊ†πÊçÆ‰øùÈô©Ê≥ïÔºåËøô‰∏™ÂÖ¨Âè∏ÂøÖÈ°ªÊåÅÊúâ‰øùÁõë‰ºöÊâπÂáÜÁöÑ‰øùÈô©‰∏öÂä°ÁªèËê•ËÆ∏ÂèØÁâåÁÖßÔºåÂπ∂Êé•ÂèóÂÅø‰ªòËÉΩÂäõÁõëÁÆ°„ÄÇËÄå‰øùÈô©ÂÖ¨Âè∏ÁâåÁÖßÊòØÁ®ÄÁº∫ËµÑÊ∫ê„ÄÇÊçÆËØ¥ÂêÑÁßçÂú®‰øùÁõë‰ºöÊéíÈòüÁ≠âÊâπÁâåÁÖßÁöÑÂÖ¨Âè∏ÁõÆÂâçË∂ÖËøá‰∫Ü 100 ÂÆ∂„ÄÇ ‰ªéÂØπ‰øùÈô©ÂÖ¨Âè∏ÂÅø‰ªòËÉΩÂäõÁõëÁÆ°Êù•ÁúãÔºå‰∏≠ÂõΩÊòØÁõÆÂâç‰∏ñÁïå‰∏ä‰øùÈô©‰∏öÁõëÁÆ°Ê∞¥Âπ≥ÊúÄÂÖ®Èù¢ÊúÄÂÖàËøõÁöÑÂõΩÂÆ∂‰πã‰∏Ä„ÄÇ ‰∏≠ÂõΩ‰øùÈô©‰∏öÁöÑÂÅø‰ªòËÉΩÂäõ‰∫å‰ª£ÁõëÁÆ°ËßÑÂàôÔºå‰∏öÂÜÖÁÆÄÁß∞ C-ROSSÔºåÊòØ‰ª•È£éÈô©‰∏∫ÂØºÂêëÁöÑÊñ∞‰∏Ä‰ª£ÂÅø‰ªòËÉΩÂäõÁõëÁÆ°ËßÑÂàô„ÄÇÂÖ∑‰ΩìÊÄé‰πàËÆ°ÁÆóÂÆûÂú®Â§™‰∏ì‰∏ö‰∫ÜÔºåËøôÈáåÂ∞±‰∏çÂ±ïÂºÄ‰∫Ü„ÄÇÁÆÄÂçïÊù•ËØ¥ÔºåÊ†πÊçÆÁõëÁÆ°Ë¶ÅÊ±ÇÂíåÊåáÂºïÔºåÂú®ÊØèÂ≠£Êú´„ÄÅÊØèÂπ¥Êú´‰øùÈô©ÂÖ¨Âè∏‰ºöÈÄöËøáÂª∫Á´ãËØ¶Â∞ΩÁöÑÊï∞Â≠¶Ê®°ÂûãÂíåÂéãÂäõÊµãËØïÂêéËÉΩÁ°Æ‰øùËá™Â∑±ÊúâËÉΩÂäõÂú® 99.5% ÁöÑÊ¶ÇÁéá‰∏ãÊó†ËÆ∫ÂèëÁîü‰ªÄ‰πà‰∫ã‰ª∂ÈÉΩ‰∏ç‰ºöÂÄíÈó≠„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÔºåÂú®‰∏≠ÂõΩ‰π∞‰øùÈô©‰∏çÁî®ÁúãÂÖ¨Âè∏Â§ßÂ∞èÔºåÂõ†‰∏∫Èó®ÊßõÈ´òÔºåÁõëÁÆ°‰∏•ÔºåÂç≥‰ΩøÁúüÁ†¥‰∫ß‰∫Ü zf ‰πü‰ºöÂÖúÂ∫ïÔºåÊâÄ‰ª•‰∏ªË¶ÅÁúã‰∫ßÂìÅÁöÑÊÄß‰ª∑ÊØî„ÄÇ ‰∏Ä‰∏™ÊïÖ‰∫ãÔºö 2008Âπ¥ÈáëËûçÂç±Êú∫ÁöÑÊó∂ÂÄôÔºåÂ§ßÂ§öÊï∞‰∫∫Âè™Áü•ÈÅìÈõ∑ÊõºÂÖÑÂºüÁ†¥‰∫ßÔºåÂç¥‰∏çÁü•ÈÅìÂΩìÊó∂ËøòÊúâ‰∏ÄÂÆ∂ËßÑÊ®°Á±ª‰ººÁöÑÂÖ¨Âè∏‰πüÊøí‰∏¥Á†¥‰∫ßÁöÑËæπÁºò„ÄÇÂÆÉÂ∞±ÊòØÂèãÈÇ¶‰øùÈô© AIA ÁöÑÊØçÂÖ¨Âè∏ AIG ‚Äî‚Äî ÁæéÂõΩÂõΩÈôÖÈõÜÂõ¢„ÄÇAIG ‰ªéÂ§ßÂÆ∂ÁÜüÊÇâÁöÑÁæé‰∫öË¥¢Èô©Ëµ∑ÂÆ∂Ôºå1919 Âπ¥ÊàêÁ´ã‰∫é‰∏äÊµ∑ÔºåÂèØ‰ª•ËØ¥Âíå‰∏≠ÂõΩÊúâÁùÄÂæàÊ∑±ÁöÑËÅîÁ≥ª„ÄÇÂà∞Áé∞Âú®ÔºåAIG Êóó‰∏ãÁöÑÂèãÈÇ¶‰øùÈô© AIAÔºå‰ªçÊòØÂõΩÂÜÖÂîØ‰∏Ä‰∏ÄÂÆ∂Áã¨ËµÑÁöÑÂ§ñËµÑ‰øùÈô©ÂÖ¨Âè∏„ÄÇÂú®ÁæéÂõΩÔºåAIG ‰πüÊòØÂ∑•ÂïÜÈì∂Ë°åÊúÄÂ§ßÁöÑÂåÖÈîÄÂïÜ„ÄÇÈáëËûçÂç±Êú∫Âà∞Êù•ÁöÑÊó∂ÂÄôÔºåAIG ‰πüÈù¢‰∏¥‰∫Ü‰∏•ÈáçÁöÑÊµÅÂä®ÊÄßÂç±Êú∫„ÄÇÁæéÂõΩÊîøÂ∫úÂú®ÂØπÂæÖ‰∏§ÂÆ∂ÂÖ¨Âè∏ÁöÑÊÄÅÂ∫¶‰∏äÔºåÂèØ‰ª•ËØ¥ÊòØÂ§©Â£§‰πãÂà´„ÄÇ‰∏ÄËæπÁúºÁùÅÁùÅÁöÑÁúãÁùÄÈõ∑ÊõºÂÖÑÂºüÁ†¥‰∫ßÔºå‰∏ÄËæπÂ∞±Âú®Èõ∑ÊõºÁ†¥‰∫ßÁöÑÁ¨¨‰∫åÂ§©Ôºå‰∏∫ AIG Êèê‰æõ‰∫Ü 850 ‰∫øÁæéÈáëÁöÑË¥∑Ê¨æÔºåÂâçÂâçÂêéÂêé‰∏ÄÂÖ±Ëä±‰∫Ü 1820 ‰∫øÁæéÈáëÊïëÊè¥ AIG ÔºåÂá†‰πéÁõ∏ÂΩì‰∫éÊää AIG ÂõΩÊúâÂåñ‰∫Ü„ÄÇÔºàÂΩìÁÑ∂ÔºåÊàë‰º∞ËÆ°ËøòÊòØÁæéÂõΩÊîøÂ∫úÂ§™Á©∑ÔºåÊ≤°Èí±ÔºåÊïë‰∏çËµ∑‰∏§ÂÆ∂ÂÖ¨Âè∏„ÄÇÂìàÂìàÂìà„ÄÇÔºâËøôÊòØÁæéÂõΩÂéÜÂè≤‰∏äÊúÄÂ§ßËßÑÊ®°ÁöÑ‰∏ÄÊ¨°ÊîøÂ∫úÂØπ‰ºÅ‰∏öËµÑÈáëÊè¥Âä©ÁöÑË°å‰∏∫„ÄÇ ÊµÖÂ±ÇÁöÑÁêÜËß£ÔºåÈõ∑ÊõºÂÖÑÂºüÊòØÂÆ∂ÊäïËµÑÈì∂Ë°åÔºåÊäïËµÑÁöÑÈí±ÂòõÔºåÂü∫Êú¨ÁÆóÊòØÈó≤‰ΩôËµÑÈáëÔºåÊäïËµÑËøô‰ª∂‰∫ãÔºåÊú¨Ë∫´Â∞±ÊòØË¶ÅÊâøÊãÖÈ£éÈô©ÁöÑÔºåËµî‰∫Ü‰πüÂè™ËÉΩËÆ§ÂëΩ„ÄÇAIG ÂÖ¨Âè∏ÈáåË∫∫ÁùÄÁæéÂõΩÊó†Êï∞ËÄÅÁôæÂßìÁöÑÂÖªËÄÅÈáëÔºåËøôË¶ÅÊòØÊâì‰∫ÜÊ∞¥ÊºÇÔºåÁ§æ‰ºöÁ®≥ÂÆöÈÉΩÊàêÈóÆÈ¢ò„ÄÇÊâÄ‰ª•ÁæéÂõΩÊîøÂ∫úËàç„ÄåÈõ∑Êõº„Äç‰øù„ÄåAIG„ÄçÔºåÊòØ‰∏∫‰∫Ü‰øùÊåÅÁ§æ‰ºöÁ®≥ÂÆöÔºåÈôç‰ΩéÂä®Ëç°ÁöÑÂèØËÉΩÊÄß„ÄÇ Êõ¥Ê∑±Â±ÇÊ¨°ÁöÑÂéüÂõ†ÔºåÁªèÊµéÂ≠¶‰∏äÊúâ‰∏Ä‰∏™Ê¶ÇÂøµÔºå„ÄåÂ§ßÂà∞‰∏çËÉΩÂÄí„ÄçÔºàToo Big to FailÔºåÁº©ÂÜô TBTFÔºâÔºåÊåáÂΩì‰∏Ä‰∫õËßÑÊ®°ÊûÅÂ§ßÊàñÂú®‰∫ß‰∏ö‰∏≠ÂÖ∑ÊúâÂÖ≥ÈîÆÊÄßÈáçË¶ÅÂú∞‰ΩçÁöÑ‰ºÅ‰∏öÊøí‰∏¥Á†¥‰∫ßÊó∂ÔºåÊîøÂ∫ú‰∏çËÉΩÁ≠âÈó≤ËßÜ‰πãÔºåÁîöËá≥Ë¶Å‰∏çÊÉúÊäïÂÖ•ÂÖ¨Â∏ëÁõ∏ÊïëÔºå‰ª•ÈÅøÂÖçÈÇ£‰∫õ‰ºÅ‰∏öÂÄíÈó≠ÂêéÊâÄÊéÄËµ∑ÁöÑÂ∑®Â§ßËøûÈîÅÂèçÂ∫îÈÄ†ÊàêÁ§æ‰ºöÊï¥‰ΩìÊõ¥‰∏•ÈáçÁöÑ‰º§ÂÆ≥ÔºåËøôÁßçÊÉÖÂÜµÁß∞‰∏∫ „ÄåÂ§ßÂà∞‰∏çËÉΩÂÄí„Äç„ÄÇ‰∏çÊòØÂè™Â§ßÂ∞±Ë°åÔºåÂøÖÈ°ªÊòØÂÄíÈó≠‰∫Ü‰ºö‰∫ßÁîüÂØπÁ§æ‰ºöÁªèÊµéÊúâÂ∑®Â§ßÂΩ±ÂìçÁöÑÁ≥ªÁªüÊÄßÈ£éÈô©„ÄÇ 7„ÄÅÂ∏ÇÈù¢‰∏äÂá†Ê¨æÈáçÁñæ‰øùÈô©‰∫ßÂìÅÊåâÁÖßËµî‰ªòÊ¨°Êï∞ÂàÜÔºåÈáçÁñæ‰øùÈô©‰∫ßÂìÅÂèØÂàÜ‰∏∫ÂçïÊ¨°ÂíåÂ§öÊ¨°„ÄÇÂ§öÊ¨°Ëµî‰ªòÁöÑ‰∫ßÂìÅ‰∏≠Ê†πÊçÆÂàÜÁªÑ‰∏éÂê¶ÂèàÂàÜ‰∏∫‰∏§Á±ª„ÄÇ‰∏ãÂõæ‰∏≠Âàó‰∏æ‰∫Ü‰∏çÂêåÁ±ªÂûãÁöÑÈáçÁñæÈô©„ÄÇÂÖ∑‰ΩìËØÑÊµãËØ∑Ëá™Ë°å google/baidu :smiley: „ÄÇ 8„ÄÅÂÖ∂‰ªñÂØøÈô©‰øùÈöúÊúüÈôêÈÄâÊã© ‰∏™‰∫∫ÂÄæÂêë‰∫éÈÄâÊã©‰øù 20 Âπ¥ÔºåÊàñËÄÖ‰øùÈöúÂà∞ 70 Â≤Å„ÄÇÂâçËÄÖÊòØÂõ†‰∏∫‰øùÈô©ÊúüÈó¥ÈÄÇ‰∏≠ÔºåÂêéËÄÖÊòØÂõ†‰∏∫Âà∞ 70 Â≤ÅÔºåÂ≠êÂ•≥Â∑Æ‰∏çÂ§öÊàêÂπ¥Âπ∂Â∑•‰Ωú‰∏ÄÊÆµÊó∂Èó¥ÁªèÊµéÂæàÂèØËÉΩÂ∑≤ÁªèÁã¨Á´ãÔºåÈÇ£Êó∂ÂÄô‰∏á‰∏ÄÊúâ‰∫ã‰πü‰∏ç‰ºöÂØπÂ≠êÂ•≥ÈÄ†ÊàêÂ§™Â§ßÂΩ±Âìç Áº¥Ë¥πÊúüÈôêÁöÑÈÄâÊã© Áº¥Ë¥πÊúüÈôêÈÄâÊã©ÔºåÂ§ßÈÉ®ÂàÜ‰∫∫Âª∫ËÆÆÊòØËÉΩÁº¥Â§öÈïøÂ∞±Áº¥Â§öÈïøÔºå‰∏ªË¶ÅÂéüÂõ†‰ªñ‰ª¨ËÆ§‰∏∫ÊòØÊú™Êù•ÂæàÈïø‰∏ÄÊÆµÊó∂Èó¥ÂõΩÂÜÖÂ∞Ü‰ºöÊòØ‰ΩéÂà©ÁéáÊó∂‰ª£ÔºàÁõÆÂâç‰∏ÄÂπ¥ÊúüÂ≠òÊ¨æÂà©Áéá‰ªÖ 1.5%ÔºåÂõΩÂ§ñÁæéÂõΩÊ¨ßÂÖÉÂå∫Êó•Êú¨Ëøô‰∫õÂ∞±Êõ¥‰Ωé‰∫ÜÔºâÔºåËÄå‰øùÈô©‰∫ßÂìÅÁõÆÂâçÂÆö‰ª∑Âà©Áéá‰∏ÄËà¨ÈÉΩÂú® 3.5%ÔºåËøôÊòØ‰∏Ä‰∏™‰∏çÈîôÁöÑ „ÄåÊî∂Áõä„Äç„ÄÇ Á≠âÂæÖÊúüÔºöËÆæÁΩÆÁöÑÂàùË°∑ÊòØ‰∏∫‰∫ÜÈò≤Ê≠¢Êú¨Ë∫´ÊÇ£ÁóÖÁöÑ‰∫∫È™ó‰øùÔºåÂç≥ÊâÄË∞ì ‚ÄúÈÄÜÂêëÈÄâÊã©‚Äù„ÄÇ‰ΩÜÊòØÊôÆÈÄö‰∫∫Â¶ÇÊûú‰∏çÊ≥®ÊÑèËøô‰∏™Êó∂Èó¥ÔºåÂèØËÉΩÂèëÁîüÊÇ£ÁóÖÊó†Ê≥ïÁêÜËµîÁöÑÊÉÖÂÜµ„ÄÇ‰∏ÄËà¨Êù•ËØ¥ÔºåÂ∞ΩÈáèÈÄâÊã©Á≠âÂæÖÊúüÁü≠ÁöÑ‰∫ßÂìÅ„ÄÇÂÖçË¥£ÔºöÂæàÂ§ö‰øùÈô©‰∫ßÂìÅÁöÑ ‚ÄúÈô∑Èò±‚Äù ‰ºöËÆæÁΩÆÂú®ËøôÈáå„ÄÇË±ÅÂÖçÔºö‰∏ªË¶ÅÂÆö‰πâ‰∫Ü‰∏Ä‰∫õÂèØ‰ª•ÂÖç‰∫§ÊàñÂ∞ë‰∫§‰øùË¥πÁöÑÊÉÖÂÜµ„ÄÇ‰∏ÄÊó¶ÊÑèÂ§ñÂèëÁîüÔºåË±ÅÂÖçÊù°Ê¨æÂèØ‰ª•ÂáèËΩªÁªèÊµéË¥üÊãÖ„ÄÇ ‰∏ªÈô©ÂíåÈôÑÂä†Èô©Êúâ‰ªÄ‰πàÂå∫Âà´Ôºü Âú®‰∏™Èô©‰∫ßÂìÅËåÉÁï¥Ôºå‰∏ªÈô©ÈÄöÂ∏∏Âçï‰ª∂‰øùË¥πËæÉÈ´òÔºåËÉΩÊîØÊíë‰∏öÂä°ÂºÄÂ±ïÊàêÊú¨Ôºå‰øùË¥π‰∏≠ÊâÄÂê´ÁöÑË¥πÁî®ÂèØ‰ª•ÊâìÁöÑÊØîËæÉÈ´òÔºåÂèØ‰ª•ÂçïÁã¨ÈîÄÂîÆ„ÄÇÈôÑÂä†Èô©‰øùË¥πÈÄöÂ∏∏ÊØîËæÉ‰ΩéÔºåÂ¶ÇÊûúÂçïÁã¨ÈîÄÂîÆ‰∏çÂ§™ËÉΩÊîØÊíë‰∏öÂä°ÂºÄÂ±ïÊàêÊú¨ÔºåÂõ†Ê≠§ÈÄöÂ∏∏ÈááÁî®‰∏é‰∏ªÈô©Êê≠ÂîÆÁöÑÂΩ¢Âºè„ÄÇ ÊàëÂõΩ‰øùÈô©‰∫ßÂìÅÊòØÊúâÂëΩÂêçËßÑÂàôÁöÑÔºåÂ§ßËá¥‰∏∫Ôºö‰øùÈô©ÂÖ¨Âè∏ÂêçÁß∞ + ÂèØÈÄâÁöÑÂêâÂ∫ÜÂêçÂ≠ó + ÂÖ∑‰Ωì‰øùÈô©Á±ªÂûã„ÄÇ ÊØîÂ¶ÇÂ§çÊòüËÅîÂêà‰ºòÈÄâÈáçÂ§ßÁñæÁóÖ‰øùÈô© B Ê¨æÔºå „ÄåÂ§çÊòü„ÄçÊòØ‰øùÈô©ÂÖ¨Âè∏ÁöÑÁöÑÂêçÁß∞ „ÄåËÅîÂêà‰ºòÈÄâ„ÄçÊòØ‰ª£Ë°®ÂêâÂ∫ÜÂêçÂ≠ó „ÄåÈáçÂ§ßÁñæÁóÖ‰øùÈô© B Ê¨æ„Äç‰ª£Ë°®Ëøô‰∫ßÂìÅ‰∏∫‰∏™‰∫∫ÂØøÈô©‰∏≠ÁöÑÁªàË∫´ÂØøÈô©„ÄÇ ÈÄöÂ∏∏‰øùÈô©‰∫ßÂìÅ‰πü‰ºöÂèñ‰∏Ä‰∏™Áæ§‰ºóÂñúÈóª‰πêËßÅÁöÑÂà´ÂêçÔºåÊØîÂ¶Ç„ÄåÂìÜÂï¶ A ‰øù„Äç„ÄÅ„ÄåÈòøÁ´•Êú®„ÄçÁ≠âÁ≠â„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Â¶Ç‰ΩïÁî®‰øùÈô©‰øùÈöúËá™Â∑±ÁöÑ‰∏ÄÁîüÔºü ÊÄé‰πàË¥≠‰π∞‰∏Ä‰ªΩÂêàÈÄÇÁöÑÈáçÁñæÈô©ÁªÑÂêàÔºü ‰øùÁõë‰ºöÂÆòÊñπËøêËê•ÁöÑÂÖ¨‰ºóÊïôËÇ≤ÂæÆ‰ø°Âè∑Ôºö„Äå‰øùÁõëÂæÆËØæÂ†Ç„Äç ‰∏∫‰ªÄ‰πà‰∫∫Ë∫´‰øùÈô©‰∏ÄËà¨ÂàÜ‰∏∫ÂØøÈô©„ÄÅÂÅ•Â∫∑Èô©„ÄÅÊÑèÂ§ñÈô©Ôºü Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢]]></content>
      <categories>
        <category>ÊäÄÊúØ‰πãÂ§ñ</category>
      </categories>
      <tags>
        <tag>ÊäÄÊúØ‰πãÂ§ñ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖË∞àÈáçÊûÑ]]></title>
    <url>%2Fblog%2F2018%2F11%2F14%2F%E6%B5%85%E8%B0%88%E9%87%8D%E6%9E%84%2F</url>
    <content type="text"><![CDATA[1.‰ΩïË∞ìÈáçÊûÑ„ÄåÈáçÊûÑ„ÄçÊúâ‰∏§Áßç‰∏çÂêåÂê´‰πâÔºö ‰Ωú‰∏∫ÂêçËØçÊó∂ÁöÑÂê´‰πâÔºöËΩØ‰ª∂ÂÜÖÈÉ®ÁªìÊûÑÁöÑ‰∏ÄÁßçË∞ÉÊï¥ÔºåÁõÆÁöÑÊòØÂú®‰∏çÊîπÂèò„ÄåËΩØ‰ª∂ÁöÑÂèØËßÜË°å‰∏∫„ÄçÂâçÊèê‰∏ãÔºåÊèêÈ´òÂÆÉÁöÑÂèØÊãìÂ±ïÊÄßÔºåÈôç‰Ωé‰øÆÊîπÊàêÊú¨„ÄÇ ‰Ωú‰∏∫Âä®ËØçÊó∂ÁöÑÂê´‰πâÔºö‰ΩøÁî®‰∏ÄÁ≥ªÂàóÈáçÊûÑÁöÑÂáÜÂàôÔºåÂú®‰∏çÊîπÂèò„ÄåËΩØ‰ª∂ÁöÑÂèØËßÜË°å‰∏∫„ÄçÂâçÊèê‰∏ãÔºåË∞ÉÊï¥ÂÖ∂ÁªìÊûÑ„ÄÇ Ê≥®Ôºö„ÄåËΩØ‰ª∂ÁöÑÂèØËßÜË°å‰∏∫„ÄçÁöÑÊåáÁöÑÊòØÁ®ãÂ∫èËøêË°åÊó∂Ë°®Áé∞„ÄÇ Âá†‰∏™Â∏∏ËßÅÁöÑÈóÆÈ¢òÔºö„ÄåÈáçÊûÑ„ÄçÂè™ÊòØÊï¥ÁêÜ‰ª£Á†ÅÂêóÔºü‰ªéÊüêÁßçËßíÂ∫¶ËÄåË®ÄÔºåÊòØÁöÑ„ÄÇ ÈáçÊûÑÔºàÂåÖÂê´ÁöÑÂêÑÁßçÂéüÂàôÔºâÊòØÊï¥ÁêÜ‰ª£Á†ÅÁöÑ‰∏ÄÂ•óÊñπÊ≥ïËÆ∫„ÄÇÊéåÊè°‰πãÂêéÔºåÂèØ‰ª•ÂêßÂ∏ÆÂä©Êàë‰ª¨Êõ¥È´òÊïàÂπ∂‰∏îÂèØÊéßÂú∞Êï¥ÁêÜÂ•Ω‰ª£Á†Å„ÄÇ „ÄåÈáçÊûÑ„Äç‰∏é„ÄåÊÄßËÉΩ‰ºòÂåñ„ÄçÁöÑÂå∫Âà´ÂíåÈáçÊûÑ‰∏ÄÊ†∑ÔºåÊÄßËÉΩ‰ºòÂåñÈÄöÂ∏∏‰∏ç‰ºöÊîπÂèòÁªÑ‰ª∂ÁöÑË°å‰∏∫ÔºàÈô§‰∫ÜÊâßË°åÈÄüÂ∫¶ÔºâÔºåÂè™‰ºöÊîπÂèòÂÖ∂ÂÜÖÈÉ®ÁªìÊûÑ„ÄÇ‰ΩÜÊòØ‰∏§ËÄÖÂá∫ÂèëÁÇπ‰∏çÂêåÔºö ÊÄßËÉΩ‰ºòÂåñÂæÄÂæÄ‰Ωø‰ª£Á†ÅËæÉÈöæÁêÜËß£Ôºå‰ΩÜ‰∏∫‰∫ÜÂæóÂà∞ÊâÄÈúÄÁöÑÊÄßËÉΩ‰Ω†‰∏çÂæó‰∏çÈÇ£‰πàÂÅö„ÄÇ ÊàëË¶ÅÂº∫Ë∞ÉÁöÑÁ¨¨‰∫åÁÇπÊòØÔºöÈáçÊûÑ‰∏ç‰ºöÊîπÂèòËΩØ‰ª∂„ÄåÂèØÂèóËßÇÂØü‰πãË°å‰∏∫„Äç‚Äî‚ÄîÈáçÊûÑ‰πãÂêéËΩØ‰ª∂ÂäüËÉΩ‰∏ÄÂ¶Ç‰ª•ÂæÄ„ÄÇ „ÄåÊ∑ªÂä†Êñ∞ÂäüËÉΩ„ÄçÂíå„ÄåÈáçÊûÑ„ÄçÁöÑÂå∫Âà´ Ê∑ªÂä†Êñ∞ÂäüËÉΩÊó∂Ôºå‰Ω†‰∏çÂ∫îËØ•‰øÆÊîπÊó¢Êúâ‰ª£Á†ÅÔºåÂè™ÁÆ°Ê∑ªÂä†Êñ∞ÂäüËÉΩ„ÄÇÈÄöËøáÊµãËØïÔºàÂπ∂ËÆ©ÊµãËØïÊ≠£Â∏∏ËøêË°å„ÄâÔºå‰Ω†ÂèØ‰ª•Ë°°ÈáèËá™Â∑±ÁöÑÂ∑•‰ΩúËøõÂ∫¶„ÄÇ ÈáçÊûÑÊó∂‰Ω†Â∞±‰∏çËÉΩÂÜçÊ∑ªÂä†ÂäüËÉΩÔºåÂè™ÁÆ°ÊîπËøõÁ®ãÂ∫èÁªìÊûÑ„ÄÇÊ≠§Êó∂‰Ω†‰∏çÂ∫îËØ•Ê∑ªÂä†‰ªª‰ΩïÊµãËØïÔºàÈô§ÈùûÂèëÁé∞ÂÖàÂâçÈÅóÊºèÁöÑ‰ªª‰Ωï‰∏úË•øÔºâÔºåÂè™Âú®ÁªùÂØπÂøÖË¶ÅÔºàÁî®‰ª•Â§ÑÁêÜÊé•Âè£ÂèòÂåñ„ÄïÊó∂Êâç‰øÆÊîπÊµãËØï„ÄÇ Êó†ËÆ∫‰ΩïÊó∂ÈÉΩÂ∫îËØ•Ê∏ÖÊ•öËá™Â∑±ÂΩìÂâçÂú®ÂÅö‰ªÄ‰πàÔºåÊòØ„ÄåÊ∑ªÂä†Êñ∞ÂäüËÉΩ„ÄçËøòÊòØÂú®„ÄåÈáçÊûÑ„Äç„ÄÇ 2.‰∏∫‰ΩïÈáçÊûÑ ÊîπËøõËΩØ‰ª∂ËÆæËÆ°„ÄÇÊØîÂ¶ÇÊ∂àÈô§ÈáçÂ§ç‰ª£Á†Å„ÄÇ‰ª£Á†ÅÊï∞ÈáèÂáèÂ∞ëÂ∞Ü‰ΩøÊú™Êù•ÂèØËÉΩÁöÑÁ®ãÂ∫è‰øÆÊîπÂä®‰ΩúÂÆπÊòìÂæóÂ§ö„ÄÇÁ°ÆÂÆö‰ª£Á†ÅÂ∞ÜÊâÄÊúâ‰∫ãÁâ©ÂíåË°å‰∏∫ÈÉΩÂè™Ë°®Ëø∞‰∏ÄÊ¨°„ÄÇ ÊèêÈ´òÂèØËØªÊÄßÔºåÈôç‰ΩéÁª¥Êä§ÊàêÊú¨ Êàë‰ª¨ÂÜô‰∏ãÁöÑÊ∫êÁ†ÅÊúâ‰∏§‰∏™ËØªËÄÖ‚Äî‚ÄîËÆ°ÁÆóÊú∫ Âíå Âè¶‰∏Ä‰∫õÁ®ãÂ∫èÂëò„ÄÇËÆ©ÂêéËÄÖËÉΩÂ§üËØªÊáÇ‰Ω†ÁöÑ‰ª£Á†ÅÊâçÊòØÊúÄÈáçË¶ÅÁöÑ„ÄÇÔºà‰∏öÂä°ÈúÄÊ±ÇÊÄªÊòØÊîπÂèòÁöÑÔºåÂèØËÉΩÂçÅÂ§©ÂêéÂ∞±‰ºöÊúâÊñ∞Âêå‰∫ãÈúÄË¶ÅÂ∞ùËØïËØªÊáÇ‰Ω†ÁöÑ‰ª£Á†ÅÔºåÂπ∂ÂÅö‰∏Ä‰∫õ‰øÆÊîπÔºâ ÂΩì‰Ω†Âä™ÂäõËÆ©Á®ãÂ∫èËøêËΩ¨ÁöÑÊó∂ÂÄôÔºå‰Ω†‰∏ç‰ºöÊÉ≥Âà∞Êú™Êù•Âá∫Áé∞ÁöÑÈÇ£‰∏™ÂºÄÂèëËÄÖ„ÄÇÂÖ∂ÂÆûÂæàÂ§öÊó∂ÂÄôÔºåÈÇ£‰∏™„ÄåÊú™Êù•ÁöÑÂºÄÂèëËÄÖ„ÄçÂ∞±ÊòØ‰Ω†Ëá™Â∑±„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÈáçÊûÑÂèØ‰ª•Â∏ÆÂä©‰Ω†ÂÆåÊàêËøô‰∫õ Âà©Áî®ÈáçÊûÑÊù•ÂçèÂä©ÊàëÁêÜËß£‰∏çÁÜüÊÇâÁöÑ‰ª£Á†Å Â∏ÆÂä©ÊâæÂà∞ bug„ÄÇ ÂØπ‰ª£Á†ÅËøõË°åÈáçÊûÑÔºåÊàëÂ∞±ÂèØ‰ª•Ê∑±ÂÖ•ÁêÜËß£‰ª£Á†ÅÁöÑ‰Ωú‰∏∫ÔºåÂπ∂ÊÅ∞Âà∞Â•ΩÂ§ÑÂú∞ÊääÊñ∞ÁöÑÁêÜËß£ÂèçÈ¶àÂõûÂéª„ÄÇÊêûÊ∏ÖÊ•öÁ®ãÂ∫èÁªìÊûÑÁöÑÂêåÊó∂ÔºåÊàë‰πüÊ∏ÖÊ•ö‰∫ÜËá™Â∑±ÊâÄÂÅöÁöÑ‰∏Ä‰∫õÂÅáËÆæ Â∏ÆÂä©ÊèêÈ´òÁºñÁ®ãÈÄüÂ∫¶„ÄÇÂ¶ÇÊûúËÆæËÆ°‰∏çÂêàÁêÜ„ÄÇÊàñËÆ∏Êüê‰∏ÄÊÆµÊó∂Èó¥ÂÜÖ‰Ω†ÁöÑËøõÂ±ïËøÖÈÄüÔºå‰ΩÜÊÅ∂Âä£ÁöÑËÆæËÆ°ÂæàÂø´Â∞±ËÆ©‰Ω†ÁöÑÈÄüÂ∫¶ÊÖ¢‰∏ãÊù•„ÄÇ‰Ω†‰ºöÊääÊó∂Èó¥Ëä±Âú®Ë∞ÉËØï‰∏äÈù¢ÔºåÊó†Ê≥ïÊ∑ªÂä†Êñ∞ÂäüËÉΩ„ÄÇ‰øÆÊîπÊó∂Èó¥ÊÑàÊù•ÊÑàÈïøÔºåÂõ†‰∏∫‰Ω†ÂøÖÈ°ªËä±ÊÑàÊù•ÊÑàÂ§öÁöÑÊó∂Èó¥ÂéªÁêÜËß£Á≥ªÁªü„ÄÅÂØªÊâæÈáçÂ§ç‰ª£Á†Å„ÄÇ 3.‰ΩïÊó∂ÈáçÊûÑÈáçÊûÑÊú¨Êù•Â∞±‰∏çÊòØ‰∏Ä‰ª∂„ÄåÁâπÂà´Êã®Âá∫Êó∂Èó¥ÂÅö„ÄçÁöÑ‰∫ãÊÉÖÔºåÈáçÊûÑÂ∫îËØ•ÈöèÊó∂ÈöèÂú∞ËøõË°å„ÄÇ‰Ω†‰∏çÂ∫îËØ•‰∏∫ÈáçÊûÑËÄåÈáçÊûÑÔºå‰Ω†‰πãÊâÄ‰ª•ÈáçÊûÑÔºåÊòØÂõ†‰∏∫‰Ω†ÊÉ≥ÂÅöÂà´ÁöÑ‰ªÄ‰πà‰∫ãÔºåËÄåÈáçÊûÑÂèØ‰ª•Â∏ÆÂä©‰Ω†ÊääÈÇ£‰∫õ‰∫ãÂÅöÂ•Ω„ÄÇ Âá†‰∏™ÂÖ∏ÂûãÁöÑÈáçÊûÑÊó∂Êú∫Ôºö Ê∑ªÂä†ÂäüËÉΩÊó∂‰∏ÄÂπ∂ÈáçÊûÑ ‰øÆË°•ÈîôËØØÊó∂‰∏ÄÂπ∂ÈáçÊûÑ code review Êó∂‰∏ÄÂπ∂ÈáçÊûÑ 4.Â∞èÁªìÂùèÂë≥ÈÅìÁöÑ‰ª£Á†ÅÁºñÂÜôËÄåÊàêÁöÑÁ®ãÂ∫èÔºåÊúâ‰ª•‰∏ãÂá†‰∏™ÁâπÂæÅÔºö Èöæ‰ª•ÈòÖËØªÁöÑÁ®ãÂ∫èÔºåÈöæ‰ª•‰øÆÊîπ„ÄÇ ÈÄªËæëÈáçÂ§çÔºàduplicated logicÔºâÁöÑÁ®ãÂ∫èÔºåÈöæ‰ª•‰øÆÊîπ„ÄÇ Ê∑ªÂä†Êñ∞Ë°å‰∏∫Êó∂ÈúÄË¶Å‰øÆÊîπÊó¢Êúâ‰ª£Á†ÅÁöÑÁ®ãÂ∫èÔºåÈöæ‰ª•‰øÆÊîπ„ÄÇ Â∏¶Â§çÊùÇÊù°‰ª∂ÈÄªËæëÔºàcomplex conditional logicÔºâÁöÑÁ®ãÂ∫èÔºåÈöæ‰ª•‰øÆÊîπ„ÄÇ Âõ†Ê≠§ÔºåÊàë‰ª¨Â∏åÊúõÁ®ãÂ∫èÔºö ÂÆπÊòìÁêÜËß£Ôºõ ÊâÄÊúâÈÄªËæëÈÉΩÂè™Âú®ÂîØ‰∏Ä‰∏ÄÂ§ÑÊåáÂÆöÔºõ Êñ∞ÁöÑÊîπÂä®‰∏ç‰ºöÂç±ÂèäÁé∞ÊúâË°å‰∏∫Ôºõ Â∞ΩÂèØËÉΩÁÆÄÂçïË°®ËææÊù°‰ª∂ÈÄªËæëÔºàconditional logicÔºâ„ÄÇ ÈáçÊûÑÊòØËøôÊ†∑‰∏Ä‰∏™ËøáÁ®ãÔºöÂÆÉÂú®‰∏Ä‰∏™ÁõÆÂâçÂèØËøêË°åÁöÑÁ®ãÂ∫è‰∏äËøõË°åÔºå‰ºÅÂõæÂú®„Äå‰∏çÊîπÂèòÁ®ãÂ∫èË°å‰∏∫„ÄçÁöÑÊÉÖÂÜµ‰∏ãËµã‰∫à‰∏äËø∞ÁæéÂ•ΩÊÄßË¥®Ôºå‰ΩøÊàë‰ª¨ËÉΩÂ§üÁªßÁª≠‰øùÊåÅÈ´òÈÄüÂºÄÂèëÔºå‰ªéËÄåÂ¢ûÂä†Á®ãÂ∫èÁöÑ‰ª∑ÂÄº„ÄÇ 5.ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäÈáçÊûÑÔºåÊîπÂñÑÊó¢Êúâ‰ª£Á†ÅÁöÑËÆæËÆ°„Äã Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <tags>
        <tag>‰ª£Á†ÅË¥®Èáè</tag>
        <tag>ÁºñÁ†ÅËßÑËåÉ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Skeleton Â∑•‰ΩúÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2018%2F11%2F07%2FSkeleton-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[1.ÁÆÄ‰ªãSkeleton ScreenÔºàÂä†ËΩΩÂç†‰ΩçÂõæÔºâÊòØËøëÂπ¥ÊµÅË°åÁöÑÂä†ËΩΩÊéß‰ª∂ÔºåÈÄöÂ∏∏Ë°®Áé∞ÂΩ¢ÂºèÊòØÂú®ÁïåÈù¢‰∏äÂæÖÂä†ËΩΩÂå∫ÂüüÂ°´ÂÖÖÁÅ∞Ëâ≤ÁöÑÂç†‰ΩçÂõæÔºå‰∏éÁ∫øÊ°ÜÂõæÁöÑÊïàÊûúÈùûÂ∏∏Áõ∏‰ºº„ÄÇSkeleton Screen Êú¨Ë¥®‰∏äÊòØÁïåÈù¢Âä†ËΩΩËøáÁ®ã‰∏≠ÁöÑËøáÊ∏°ÊïàÊûú„ÄÇ ‰ΩøÁî® Skeleton ÁöÑÊïàÊûúÂõæÂ¶Ç‰∏ãÔºö 2.Â∑•‰ΩúÂéüÁêÜ‰ªé‰∏äÈù¢ÁöÑÊïàÊûúÂõæÔºå‰∏çÈöæÁúãÂá∫Ôºå„ÄåSkeleton„ÄçÊúâ‰∏Ä‰∏™ÊòæÁ§∫ÂíåÈöêËóèÁöÑËøáÁ®ã„ÄÇ‰∏ãÈù¢ÈíàÂØπÊôÆÈÄöÁöÑ view Âíå RecyclerView ÂàÜÂà´ËØ¥ÊòéÂÖ∂‰∏≠ÁöÑÊòæÁ§∫/ÈöêËóèÁöÑËøáÁ®ã„ÄÇ 2.1 ÂØπ‰∫éÊôÆÈÄöÁöÑ View‰ªéÂ∏∏ËßÑÁöÑ‰ΩøÁî®ÊñπÊ≥ïÁúãËµ∑„ÄÇ 123mTvSkeletonScreen = Skeleton.bind(textView) .load(R.layout.share_skeleton_text_view) .show(); È¶ñÂÖàË∞ÉÁî®‰∫Ü Skeleton.bind(); 123public static ViewSkeletonScreen.Builder bind(View view) &#123; return new ViewSkeletonScreen.Builder(view);&#125; bind ÊñπÊ≥ïËøîÂõûÁöÑÊòØ‰∏Ä‰∏™ ViewSkeletonScreen.Builder ‰πüÂ∞±ÊòØ‰∏Ä‰∏™Âª∫ÈÄ†Âô®ÔºåÂÖ∂‰∏≠Êèê‰æõ‰∫ÜÂêÑÁßçÈÖçÁΩÆÊñπÊ≥ï„ÄÇ 12345678910111213141516171819202122public static class Builder &#123; private final View mView;//‰æùÈôÑÁöÑ view private int mSkeletonLayoutResID;//Â§ñÈÉ®Ê≥®ÂÖ•ÁöÑ id private boolean mShimmer = true;//ÊòØÂê¶Èó™ÁÉÅ private int mShimmerColor;//Èó™ÁÉÅÁöÑÈ¢úËâ≤ private int mShimmerDuration = 1000;//Èó™ÁÉÅÊó∂Èó¥ÔºåÈªòËÆ§ÊòØ 1000ms private int mShimmerAngle = 20;//Èó™ÁÉÅÁöÑËßíÂ∫¶ public Builder(View view) &#123; this.mView = view;//‰ªéÂ§ñÈÉ®Ê≥®ÂÖ•ÁöÑÁõÆÊ†á view this.mShimmerColor = ContextCompat.getColor(mView.getContext(), R.color.shimmer_color);//ÈªòËÆ§ÁöÑ shimmer È¢úËâ≤ &#125; //‰ª£Á†ÅÁúÅÁï• public ViewSkeletonScreen show() &#123; ViewSkeletonScreen skeletonScreen = new ViewSkeletonScreen(this); skeletonScreen.show(); return skeletonScreen; &#125;&#125; ËÆæÁΩÆÂ•Ω‰πãÂêéÔºåË∞ÉÁî® showÔºåÂç≥ÂèØÂ∞Ü Skeleton ÊòæÁ§∫ Âá∫Êù• ViewSkeletonScreen.Builder#show 12345public ViewSkeletonScreen show() &#123; ViewSkeletonScreen skeletonScreen = new ViewSkeletonScreen(this);//Ê†πÊçÆÂΩìÂâç builder ÂàõÂª∫‰∏Ä‰∏™ ViewSkeletonScreen skeletonScreen.show();//ÊòæÁ§∫ return skeletonScreen;&#125; Builder#show ÊñπÊ≥ïËøîÂõûÁöÑÊòØ‰∏Ä‰∏™ ViewSkeletonScreen ÂØπË±°„ÄÇ ViewSkeletonScreen ÂÆûÁé∞‰∫Ü SkeletonScreen Êé•Âè£„ÄÇ 123456public interface SkeletonScreen &#123; void show(); void hide();&#125; 2.1.1 ÊòæÁ§∫ViewSkeletonScreen#show()123456public void show() &#123; View skeletonLoadingView = generateSkeletonLoadingView();//ÁîüÊàê loading view if (skeletonLoadingView != null) &#123; mViewReplacer.replace(skeletonLoadingView);//Â∞Ü bind ËøõÊù•ÁöÑ view ÊõøÊç¢‰∏∫ loadingview &#125;&#125; 1.ÁîüÊàê loadingView123456789101112private View generateSkeletonLoadingView() &#123; ViewParent viewParent = mActualView.getParent();//Ëé∑ÂèñÂÆûÈôÖ view ÁöÑ parent if (viewParent == null) &#123;//Â¶ÇÊûúÊ≤°ÊúâÁà∂ view Log.e(TAG, "the source view have not attach to any view"); return null; &#125; ViewGroup parentView = (ViewGroup) viewParent; if (mShimmer) &#123; return generateShimmerContainerLayout(parentView);//ÁîüÊàê shimmer layout„ÄÇÂú®Áé∞ÊúâÁöÑ view ‰∏äÈù¢ÂåÖË£Ö‰∏ÄÂ±ÇÔºåÂΩì view ÂÖ≥ËÅîÂà∞ window ÁöÑÊó∂ÂÄôÔºåÂºÄÂßãÊí≠ÊîæÂä®ÁîªÔºõÂΩì view ‰ªé window ‰∏≠ÂàÜÁ¶ªÁöÑÊó∂ÂÄôÂÅúÊ≠¢Êí≠ÊîæÂä®Áîª„ÄÇ &#125; return LayoutInflater.from(mActualView.getContext()).inflate(mSkeletonResID, parentView, false);//Ê∏≤ÊüìÂá∫ view&#125; 2.ÊòæÁ§∫123456789101112131415public void replace(View targetView) &#123; if (mCurrentView == targetView) &#123; return; &#125; if (targetView.getParent() != null) &#123;//Â¶ÇÊûú loadingview ÁöÑ parent ‰∏ç‰∏∫ nullÔºåÂ∞ÜÂÆÉ‰ªéÁà∂ÂÆπÂô®‰∏≠ÁßªÈô§ ((ViewGroup) targetView.getParent()).removeView(targetView);//ÁßªÈô§ view &#125; if (init()) &#123;//ÂàùÂßãÂåñ mTargetView = targetView; mSourceParentView.removeView(mCurrentView);//ÁßªÈô§ÊéâÊ∫ê view mTargetView.setId(mSourceViewId);//ËÆæÁΩÆ idÔºå mSourceParentView.addView(mTargetView, mSourceViewIndexInParent, mSourceViewLayoutParams);//Ê∑ªÂä†Âà∞Áà∂ view ‰∏≠ mCurrentView = mTargetView; &#125;&#125; Âà§Êñ≠Êù°‰ª∂ 123456789101112131415161718private boolean init() &#123; if (mSourceParentView == null) &#123;// mSourceParentView = (ViewGroup) mSourceView.getParent();//Ëé∑Âèñ bind ËøõÊù•ÁöÑ view ÁöÑÁà∂ÂÆπÂô® if (mSourceParentView == null) &#123;//Â¶ÇÊûúÁà∂ÂÆπÂô®‰∏∫Á©∫ÔºåËØ¥ÊòéÊú™ÂÖ≥ËÅîÂà∞‰ªª‰Ωï viewÔºåÁõ¥Êé•ËøîÂõû Log.e(TAG, "the source view have not attach to any view"); return false; &#125; //ÈÅçÂéÜËé∑ÂèñÂΩìÂâç view Âú®Áà∂ÂÆπÂô®‰∏≠‰∏ãÊ†á int count = mSourceParentView.getChildCount(); for (int index = 0; index &lt; count; index++) &#123; if (mSourceView == mSourceParentView.getChildAt(index)) &#123; mSourceViewIndexInParent = index; break; &#125; &#125; &#125; return true;&#125; 2.1.2 ÈöêËóècom.ethanhua.skeleton.ViewSkeletonScreen#hide 1234567@Overridepublic void hide() &#123; if (mViewReplacer.getTargetView() instanceof ShimmerLayout) &#123; ((ShimmerLayout) mViewReplacer.getTargetView()).stopShimmerAnimation(); &#125; mViewReplacer.restore();&#125; com.ethanhua.skeleton.ViewReplacer#restore ÂÖ∂ÂÆûÂ∞±ÊòØ replace ÊñπÊ≥ïÁöÑÈÄÜÂêë„ÄÇÂ∞Ü „Äåloading view „Äç‰ªéÁà∂ view ‰∏≠ÁßªÈô§ÊéâÔºåÂ∞Ü„ÄåÂéü view„ÄçÔºàbind ËøõÊù•ÁöÑ viewÔºâÔºåÊ∑ªÂä†Âà∞Áà∂ view„ÄÇ 123456789public void restore() &#123; if (mSourceParentView != null) &#123; mSourceParentView.removeView(mCurrentView);//ÁßªÈô§ÊéâÂΩìÂâçÁöÑ view„ÄÇ mSourceParentView.addView(mSourceView, mSourceViewIndexInParent, mSourceViewLayoutParams); mCurrentView = mSourceView; mTargetView = null; mTargetViewResID = -1; &#125;&#125; 2.2 ÂØπ‰∫é RecyclerView123public static RecyclerViewSkeletonScreen.Builder bind(RecyclerView recyclerView) &#123; return new RecyclerViewSkeletonScreen.Builder(recyclerView);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public static class Builder &#123; private RecyclerView.Adapter mActualAdapter;//ÈÄÇÈÖçÂô® private final RecyclerView mRecyclerView; private boolean mShimmer = true;//ÈªòËÆ§ÊîØÊåÅ shimmer private int mItemCount = 10;//ÈªòËÆ§‰∏∫ 10 private int mItemResID = R.layout.layout_default_item_skeleton;//ÈªòËÆ§ÁöÑÂàóË°®È°πÂ∏ÉÂ±Ä private int mShimmerColor;//È¢úËâ≤ private int mShimmerDuration = 1000;// private int mShimmerAngle = 20; private boolean mFrozen = true; public Builder(RecyclerView recyclerView) &#123; this.mRecyclerView = recyclerView; this.mShimmerColor = ContextCompat.getColor(recyclerView.getContext(), R.color.shimmer_color);//ÈªòËÆ§ÁöÑÈó™ÁÉÅÈ¢úËâ≤ &#125; /** * @param adapter the target recyclerView actual adapter */ public Builder adapter(RecyclerView.Adapter adapter) &#123; this.mActualAdapter = adapter; return this; &#125; /** * @param itemCount the child item count in recyclerView */ public Builder count(int itemCount) &#123; this.mItemCount = itemCount; return this; &#125; //‰ª£Á†ÅÁúÅÁï• /** * @param frozen whether frozen recyclerView during skeleton showing * @return */ public Builder frozen(boolean frozen) &#123; this.mFrozen = frozen; return this; &#125; public RecyclerViewSkeletonScreen show() &#123; RecyclerViewSkeletonScreen recyclerViewSkeleton = new RecyclerViewSkeletonScreen(this); recyclerViewSkeleton.show(); return recyclerViewSkeleton; &#125;&#125; ‰∏éÊôÆÈÄö view ‰∏çÂêåÔºå recyclerview ÁöÑ Skeleton Builder Êèê‰æõ‰∫ÜÂ§ö‰∏™ adapter ÊñπÊ≥ïÊù•ËÆæÁΩÆÈÄÇÈÖçÂô®Ôºåcount ÊñπÊ≥ïÁî®‰∫éËÆæÁΩÆ ÂàóË°®È°πÊï∞ÁõÆÔºåfrozen ÊéßÂà∂ Skeleton ÊòæÁ§∫ÊúüÈó¥ÊòØÂê¶ÂÜªÁªì RecyclerView„ÄÇ ‰∏äÈù¢ÁöÑ RecyclerViewSkeletonScreen.Builder#show ÊñπÊ≥ïÔºåÈ¶ñÂÖàÂàõÂª∫‰∫Ü ‰∏Ä‰∏™ RecyclerViewSkeletonScreen ÔºåÁÑ∂ÂêéË∞ÉÁî®ÂÆÉÁöÑ show ÊñπÊ≥ï RecyclerViewSkeletonScreen#RecyclerViewSkeletonScreen 123456789101112private RecyclerViewSkeletonScreen(Builder builder) &#123; mRecyclerView = builder.mRecyclerView; mActualAdapter = builder.mActualAdapter;//ÁúüÊ≠£ÁöÑÈÄÇÈÖçÂô®ÔºåÈöêËóè Skeleton ‰πãÂêéÔºåÊòæÁ§∫ÁúüÂÆûÁöÑ view Êó∂ÈúÄË¶ÅÁî®Âà∞ mSkeletonAdapter = new SkeletonAdapter();//ÂàõÂª∫ adapter mSkeletonAdapter.setItemCount(builder.mItemCount);//ÂàóË°®ÁöÑÊÄªÈ°πÊï∞ mSkeletonAdapter.setLayoutReference(builder.mItemResID);//ÂàóË°®È°πÁöÑ id mSkeletonAdapter.shimmer(builder.mShimmer);//ÊòØÂê¶Èó™ÁÉÅ mSkeletonAdapter.setShimmerColor(builder.mShimmerColor);//Èó™ÁÉÅÁöÑÈ¢úËâ≤ mSkeletonAdapter.setShimmerAngle(builder.mShimmerAngle);//Èó™ÁÉÅÁöÑËßíÂ∫¶ mSkeletonAdapter.setShimmerDuration(builder.mShimmerDuration);//Èó™ÁÉÅÊó∂Èïø mRecyclerViewFrozen = builder.mFrozen;//ÊòØÂê¶ÂÜªÁªì&#125; 2.2.1 ÊòæÁ§∫RecyclerViewSkeletonScreen#show 123456public void show() &#123; mRecyclerView.setAdapter(mSkeletonAdapter); if (!mRecyclerView.isComputingLayout() &amp;&amp; mRecyclerViewFrozen) &#123;//Â¶ÇÊûú‰∏çÊòØÊ≠£Âú®ËÆ°ÁÆóÂ∏ÉÂ±ÄÔºåÂπ∂‰∏îËÆæÁΩÆ‰∫ÜÂÜªÁªìÔºåÂàôÂ∞Ü Recyclerview ÂÜªÁªì mRecyclerView.setLayoutFrozen(true); &#125;&#125; 2.2.2 ÈöêËóèRecyclerViewSkeletonScreen#hide 1234@Overridepublic void hide() &#123; mRecyclerView.setAdapter(mActualAdapter);//Â∞ÜÁúüÂÆûÁöÑ adapter ËÆæÁΩÆÂõûÂéª„ÄÇÂÜÖÈÉ®‰ºöËß¶ÂèëÂà∑Êñ∞ÔºåËøõËÄåÊòæÁ§∫Âá∫&#125; SkeletonAdapter ÁöÑÂÆûÁé∞ 123456789101112131415161718192021222324public class SkeletonAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; &#123; @Override public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; LayoutInflater inflater = LayoutInflater.from(parent.getContext()); if (mShimmer) &#123; return new ShimmerViewHolder(inflater, parent, mLayoutReference); &#125; return new RecyclerView.ViewHolder(inflater.inflate(mLayoutReference, parent, false)) &#123; &#125;; &#125; @Override public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) &#123; if (mShimmer) &#123; ShimmerLayout layout = (ShimmerLayout) holder.itemView; layout.setShimmerAnimationDuration(mShimmerDuration); layout.setShimmerAngle(mShimmerAngle); layout.setShimmerColor(mColor); layout.startShimmerAnimation(); &#125; &#125; //‰ª£Á†ÅÁúÅÁï•&#125; ÂèØ‰ª•ÁúãÂà∞ËøòÊòØË∑üÊôÆÈÄöÁöÑ view ‰∏Ä‰∏™Â•óË∑ØÔºå‰∏çÈó™ÁÉÅÁöÑËØùÔºåÁõ¥Êé•Â∞ÜÂàóË°®È°πÊ∏≤ÊüìÂá∫Êù•Â∞±ÂÆå‰∫ã„ÄÇÂ¶ÇÊûúËÆæÁΩÆ‰∫ÜÈó™ÁÉÅÔºåÂàôÈúÄË¶ÅÂåÖË£ÖÂà∞‰∏Ä‰∏™ ShimmerLayout ‰∏≠ÔºåÂπ∂Ê†πÊçÆÂèÇÊï∞Ëøõ‰∏ÄÊ≠•ËÆæÁΩÆ„ÄÇ 3.ÊÄªÁªìÊôÆÈÄö viewÔºå Ê†∏ÂøÉÊÄùÊÉ≥Â∞±ÊòØÔºåÂà©Áî® ViewGroup#addViewÔºåViewGroup#removeView ÂØπ view ËøõË°åÊõøÊç¢„ÄÇ ÊòæÁ§∫ Skeleton ÁöÑÊó∂ÂÄôÔºåÂ∞ÜÂéüÊù•ÁöÑ view ÊõøÊç¢‰∏∫ loadingView ÈöêËóè Skeleton ÁöÑÊó∂ÂÄôÔºåÂ∞Ü„Äåloadingview„ÄçÊõøÊç¢‰∏∫ sourceView„ÄÇ ÂØπ‰∫é RecyclerViewÔºåÂú®ÊòæÁ§∫ÊúüÈó¥ÔºåÈÄöËøá SkeletonAdapter ÂÅ∑Â§©Êç¢Êó•ÔºåÂ∞Ü loading ÊòæÁ§∫Âá∫Êù•„ÄÇ ÈöêËóèÁöÑÊó∂ÂÄôÔºåÂ∞ÜÁúüÊ≠£ÁöÑ adapter ËÆæÁΩÆÂõûÂéª„ÄÇ 4.ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Ëøô‰∏™Êéß‰ª∂Âè´ÔºöSkeleton Screen/Âä†ËΩΩÂç†‰ΩçÂõæ Skeleton Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê°ÜÊû∂ÂéüÁêÜ</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[RxJava ËÆ¢ÈòÖÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2018%2F06%2F24%2FRxJava-%E8%AE%A2%E9%98%85%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Ê¶ÇËø∞RxJava ÊòØ‰ªÄ‰πàÂë¢ÔºüÊ†πÊçÆRxJavaÂú®GitHub‰∏äÁªôÂá∫ÁöÑÊèèËø∞ RxJava ‚Äì Reactive Extensions for the JVM ‚Äì a library for composing asynchronous and event-based programs using observable sequences for the Java Â§ßËá¥ÊÑèÊÄùÊòØÔºö‰∏Ä‰∏™ÂèØ‰ª•Âú® JVM‰∏ä ‰ΩøÁî®ÁöÑÔºåÊòØÁî±ÂºÇÊ≠•ÁöÑÂü∫‰∫é‰∫ã‰ª∂ÁºñÂÜôÁöÑÈÄöËøá‰ΩøÁî®ÂèØËßÇÂØüÂ∫èÂàóÊûÑÊàêÁöÑ‰∏Ä‰∏™Â∫ì„ÄÇ ÂÖ≥ÈîÆËØçÔºöÂºÇÊ≠•ÔºåÂü∫‰∫é‰∫ã‰ª∂ÔºåÂèØËßÇÂØüÂ∫èÂàó Êú¨Êñá‰∏ªË¶ÅËÆ≤Ëø∞ RxJava ÁöÑËÆ¢ÈòÖÂéüÁêÜ„ÄÇ Á§∫‰æãÔºöHelloRxJava‰∏ÄËà¨Â≠¶‰∏ÄÈó®Êñ∞ÁöÑÁºñÁ®ãËØ≠Ë®ÄÈÉΩÊòØÂÖà‰ªéÊâìÂç∞ÁöÑ„Äåhello word„ÄçÂºÄÂßãÔºåÊàë‰ª¨ÁúãÁúãÂ¶Ç‰ΩïÁî® Rxjava ÊâìÂç∞Âá∫„ÄåHello RxJava„Äç Âπ∂‰ª•‰πã‰Ωú‰∏∫ÂàÜÊûêÁöÑÂÆû‰æã„ÄÇ 1234567891011121314151617181920212223242526272829//ÂàõÂª∫ ObservableObservable&lt;String&gt; observable = Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123; public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123; emitter.onNext("Hello RxJava"); emitter.onComplete(); &#125;&#125;);//ËÆ¢ÈòÖobservable.subscribe(new Observer&lt;String&gt;() &#123; @Override public void onSubscribe(Disposable d) &#123; System.out.println("onSubsribe call"); &#125; @Override public void onNext(String s) &#123; System.out.println(s);//ÊâìÂç∞Êî∂Âà∞ÁöÑÊñáÂ≠óÔºåËøôÈáåÊòØ Hello RxJava &#125; @Override public void onError(Throwable e) &#123; e.printStackTrace(); &#125; @Override public void onComplete() &#123; System.out.println("onComplete call"); &#125;&#125;); Observerable ÊòØÂ¶Ç‰ΩïÂàõÂª∫ÁöÑÔºüÈ¶ñÂÖà new ‰∫Ü‰∏Ä‰∏™ ObservableOnSubscribe ÂØπË±°ÔºåÂπ∂ÂÆûÁé∞ÂÖ∂‰∏≠ÁöÑ subscribe ÊñπÊ≥ï„ÄÇËØ•ÂØπË±°Ë¢´‰º†ÈÄíÁªô‰∫Ü Observable#create ÊñπÊ≥ï‰ª•ÂàõÂª∫ ObservableÔºàÂΩìÁÑ∂‰πüÊúâÂÖ∂‰ªñÊñπÊ≥ïÂèØ‰ª•ÂàõÂª∫ Observable Ôºå‰ΩÜÊòØÂéüÁêÜÂ§ßÂêåÂ∞èÂºÇÔºâ„ÄÇ io.reactivex.Observable#create 123456@CheckReturnValue@SchedulerSupport(SchedulerSupport.NONE)public static &lt;T&gt; Observable&lt;T&gt; create(ObservableOnSubscribe&lt;T&gt; source) &#123; ObjectHelper.requireNonNull(source, "source is null");//‰∏çÂèØ‰∏∫Á©∫ return RxJavaPlugins.onAssembly(new ObservableCreate&lt;T&gt;(source));&#125; create ÊñπÊ≥ï‰º†ÈÄíËøõÊù•ÁöÑ Observable Âèà‰º†ÈÄíÁªô‰∫Ü Observable ÊûÑÈÄ†ÊñπÊ≥ï„ÄÇ 1234final ObservableOnSubscribe&lt;T&gt; source;//‰øùÂ≠òÊàêÂëòÂèòÈáèpublic ObservableCreate(ObservableOnSubscribe&lt;T&gt; source) &#123; this.source = source;&#125; io.reactivex.plugins.RxJavaPlugins#onAssembly(io.reactivex.Observable) 123456789101112131415/** * Calls the associated hook function. * @param &lt;T&gt; the value type * @param source the hook's input value * @return the value returned by the hook */@SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;)@NonNullpublic static &lt;T&gt; Observable&lt;T&gt; onAssembly(@NonNull Observable&lt;T&gt; source) &#123; Function&lt;? super Observable, ? extends Observable&gt; f = onObservableAssembly; if (f != null) &#123; return apply(f, source); &#125; return source;&#125; io.reactivex.plugins.RxJavaPlugins#onAssembly ÊñπÊ≥ï‰∏≠Âè™ÊòØË∞ÉÁî®‰∫ÜÁõ∏ÂÖ≥ÁöÑ hook ÂáΩÊï∞ÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâÔºåÁÑ∂ÂêéËøîÂõûÂéüÂØπË±°„ÄÇ ÂàõÂª∫ÁöÑÁªìÊûúÔºöObservableOnSubsribe Â§ñÈù¢ÂåÖË£Ö‰∫Ü‰∏ÄÂ±Ç„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö ËÆ¢ÈòÖËøáÁ®ãÂÆû‰æã‰ª£Á†Å‰∏≠Âú®ËÆ¢ÈòÖ‰πãÂâçÊàë‰ª¨ÂÖàÂàõÂª∫‰∫Ü‰∏Ä‰∏™ observer ÂØπË±°„ÄÇ ÁÑ∂ÂêéË∞ÉÁî® Observable#subscribe ÊñπÊ≥ïÔºåÂ∞Ü observer ‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíÁªôËØ•ÊñπÊ≥ï„ÄÇ ÁÇπÂºÄÁúãÁúã Observable#subscribe ÊñπÊ≥ïÁöÑÂÆûÁé∞„ÄÇ 12345678910111213141516171819202122@Overridepublic final void subscribe(Observer&lt;? super T&gt; observer) &#123; ObjectHelper.requireNonNull(observer, "observer is null");//ÈùûÁ©∫Ê£ÄÊü• try &#123; observer = RxJavaPlugins.onSubscribe(this, observer); ObjectHelper.requireNonNull(observer, "Plugin returned null Observer");//ÈùûÁ©∫Ê£ÄÊü• subscribeActual(observer);//Ë∞ÉÁî®ÁúüÊ≠£ÁöÑËÆ¢ÈòÖÊñπÊ≥ï„ÄÇ &#125; catch (NullPointerException e) &#123; // NOPMD throw e; &#125; catch (Throwable e) &#123; Exceptions.throwIfFatal(e); // can't call onError because no way to know if a Disposable has been set or not // can't call onSubscribe because the call might have set a Subscription already RxJavaPlugins.onError(e);// NullPointerException npe = new NullPointerException("Actually not, but can't throw other exceptions due to RS"); npe.initCause(e); throw npe; &#125;&#125; ‰∏äÈù¢ try Âùó‰∏≠ÁöÑÁ¨¨‰∏ÄË°å‰ª£Á†ÅË∞ÉÁî®‰∫Ü RxJavaPlugins#onSubscribe „ÄÇÁÇπÂºÄÁúãÁúãÂÆÉÂÖ∑‰ΩìÂÅö‰∫ÜÂï•Ôºü 123456789@SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;)@NonNullpublic static &lt;T&gt; Observer&lt;? super T&gt; onSubscribe(@NonNull Observable&lt;T&gt; source, @NonNull Observer&lt;? super T&gt; observer) &#123; BiFunction&lt;? super Observable, ? super Observer, ? extends Observer&gt; f = onObservableSubscribe; if (f != null) &#123; return apply(f, source, observer);//Ë∞ÉÁî®Áõ∏Â∫îÁöÑ hook ÂáΩÊï∞(Â¶ÇÊûúÊúâÁöÑËØù) &#125; return observer;&#125; Êàë‰ª¨ËÆ¢ÈòÖÁöÑÂÆûÈôÖÂØπË±°ÊòØ ObserverableCreateÔºåÂõ†Ê≠§ÁÇπËøõÂéªÁúãÁúãÂÖ∂‰∏≠ÁöÑ subscribeActual ÊñπÊ≥ïÂÆûÁé∞Ôºö ObservableCreate#subscribeActual 123456789101112@Overrideprotected void subscribeActual(Observer&lt;? super T&gt; observer) &#123; CreateEmitter&lt;T&gt; parent = new CreateEmitter&lt;T&gt;(observer);//‰ª• observer ‰Ωú‰∏∫ÂèÇÊï∞ÊûÑÈÄ†‰∏Ä‰∏™ CreateEmitter observer.onSubscribe(parent);//ÂõûË∞É Observer#onSubsribe ÊñπÊ≥ï try &#123; source.subscribe(parent);//Ë∞ÉÁî®Ê∫êËÆ¢ÈòÖÊñπÊ≥ïÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Ëá™Â∑±ÂÆûÁé∞ÁöÑÂú®ÂÖ∂‰∏≠ÂèëÈÄÅÊï∞ÊçÆÁöÑÊñπÊ≥ï &#125; catch (Throwable ex) &#123; Exceptions.throwIfFatal(ex); parent.onError(ex); &#125;&#125; ËøôÈáåÁöÑsource#subcribe ‰πüÂ∞±ÊòØÔºö 1234public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123; emitter.onNext("hello rxJava");//Ë∞ÉÁî® ÂèëÈÄÅÊï∞ÊçÆ emitter.onComplete();&#125; ËÆ¢ÈòÖÊòØ‰ªé‰∏ãÊ∏∏‰º†ÈÄíÂà∞‰∏äÊ∏∏„ÄÇ‰º†ÈÄíÂà∞Ê∫êÂ§¥‰πãÂêéÔºå‰ºöËß¶ÂèëË∞ÉÁî® Emitter#onXxx ÊñπÊ≥ïÔºåÂ∞ÜÊï∞ÊçÆ‰ªé‰∏äÊ∏∏ÂèëÈÄÅÂà∞‰∏ãÊ∏∏„ÄÇ emitter ÊòØÂ¶Ç‰ΩïÂ∞ÜÊï∞ÊçÆÂèëÂ∞ÑÁªô observer ÁöÑÂë¢ÔºüÊàë‰ª¨ÂÖàÁúãÁúã emitter ÊòØ‰ªÄ‰πàÔºü ‰∏äÈù¢ÁöÑ emitter ÁöÑÂÆûÈôÖÁ±ªÂûãÊòØ CreateEmitter ÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758static final class CreateEmitter&lt;T&gt;extends AtomicReference&lt;Disposable&gt;implements ObservableEmitter&lt;T&gt;, Disposable &#123; private static final long serialVersionUID = -3434801548987643227L; final Observer&lt;? super T&gt; observer; CreateEmitter(Observer&lt;? super T&gt; observer) &#123; this.observer = observer; &#125; @Override public void onNext(T t) &#123; if (t == null) &#123;//Âà§Á©∫ onError(new NullPointerException("onNext called with null. Null values are generally not allowed in 2.x operators and sources.")); return; &#125; if (!isDisposed()) &#123;//Â¶ÇÊûúÂΩìÂâçÁä∂ÊÄÅ‰∏çÊòØ dispose observer.onNext(t);//Ë∞ÉÁî® observer#onNext &#125; &#125; @Override public void onError(Throwable t) &#123; if (!tryOnError(t)) &#123; RxJavaPlugins.onError(t); &#125; &#125; @Override public boolean tryOnError(Throwable t) &#123; if (t == null) &#123; t = new NullPointerException("onError called with null. Null values are generally not allowed in 2.x operators and sources."); &#125; if (!isDisposed()) &#123; try &#123; observer.onError(t); &#125; finally &#123; dispose(); &#125; return true; &#125; return false; &#125; @Override public void onComplete() &#123; if (!isDisposed()) &#123;//‰∏çÊòØÂá∫‰∫é disposed Áä∂ÊÄÅ try &#123; observer.onComplete();//Ë∞ÉÁî® &#125; finally &#123; dispose();//onComplete Âè™ËÉΩË∞ÉÁî®‰∏ÄÊ¨°ÔºåË∞ÉÁî®ÂÆåÊàê‰πãÂêéÔºåÁä∂ÊÄÅÂèò‰∏∫ dispose &#125; &#125; //‰ª£Á†ÅÁúÅÁï•&#125; CreateEmitter ÊòØ ObservableCreateÁöÑ‰∏Ä‰∏™ÂÜÖÈÉ®Á±ªÔºåÁªßÊâøËá™AtomicReference&lt;Disposable&gt;, ÂÆûÁé∞‰∫Ü‰∏§‰∏™Êé•Âè£ ObservableEmitter&lt;T&gt; Âíå Disposable „ÄÇ ÂèØ‰ª•ÁúãÂà∞ CreateEmitter ÂØπ observer ËøõË°å‰∫ÜÂåÖË£ÖÔºàobserver ‰æùËµñÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞ÂèÇÊï∞Ê≥®ÂÖ•Ôºâ„ÄÇÂÆÉÂú®Ë∞ÉÁî® observer ÁöÑÁõ∏Â∫îÊñπÊ≥ïÁöÑÂâçÂêéÂØπÁä∂ÊÄÅËøõË°åÂà§Êñ≠ÂíåÊõ¥Êñ∞„ÄÇ CreateEmitter ÂèàÊòØÂú®‰ªÄ‰πàÊó∂ÂÄôÂàõÂª∫ÁöÑÂë¢ÔºüÂú®ËÆ¢ÈòÖËøáÁ®ã‰∏≠Ë∞ÉÁî®Âà∞ ObservableCreate#subscribeActual ÔºåËØ•ÊñπÊ≥ï‰ºöÂà©Áî® observer ÊûÑÈÄ†‰∏Ä‰∏™ CreateEmmiterÔºå ÁÑ∂ÂêéÊääÂÆÉ‰Ωú‰∏∫ÂèÇÊï∞ÂéªË∞ÉÁî® source#subcribe ÊñπÊ≥ï„ÄÇ source ‰πüÂ∞±ÊòØÊàë‰ª¨ÂàõÂª∫ÁöÑ ObservableOnSubscribe ÂåøÂêçÂÜÖÈÉ®Á±ª„ÄÇCreateEmmiter Â∞±ÊòØÈÄöËøáËøôÊ†∑ÁöÑÊñπÂºè‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíÁªô‰∫ÜÊàë‰ª¨Ëá™Â∑±ÂÆûÁé∞ÁöÑ subscribe ÊñπÊ≥ï„ÄÇ Â∞èÁªìËÆ¢ÈòÖÊòØ‰ªé‰∏ãÊ∏∏‰º†ÈÄíÂà∞‰∏äÊ∏∏„ÄÇ‰º†ÈÄíÂà∞Ê∫êÂ§¥‰πãÂêéÔºå‰ºöËß¶ÂèëË∞ÉÁî® Emitter#onXxx ÊñπÊ≥ïÔºåÂ∞ÜÊï∞ÊçÆ‰ªé‰∏äÊ∏∏ÂèëÈÄÅÂà∞‰∏ãÊ∏∏„ÄÇ ‰∏äÊ∏∏ÂØπÊï∞ÊçÆÊµÅÁöÑÊéßÂà∂ÊòØÈÄöËøá CreateEmitter ÂÆûÁé∞ÁöÑ„ÄÇ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê°ÜÊû∂</category>
      </categories>
      <tags>
        <tag>Ê°ÜÊû∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gradle ‰∏≠ api provided compile implementation ‰πãÈó¥ÁöÑÂå∫Âà´]]></title>
    <url>%2Fblog%2F2018%2F06%2F24%2Fgradle-%E4%B8%ADapi-provided-compile-implementation-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[Ê¶ÇËø∞api„ÄÅprovided„ÄÅcompile„ÄÅimplementation ÈÉΩÊòØ gradle Ê∑ªÂä†‰æùËµñÊó∂ÁöÑÈÄâÈ°πÔºå‰∏çÂêåÁöÑÈÄâÈ°πË°®Á§∫‰∏çÂêåÁöÑ‰æùËµñÂÖ≥Á≥ª„ÄÇ ÂÖ∂‰∏≠ api„ÄÅimplementation ÊòØ Gradle 3.4 ÂºïÂÖ•ÁöÑÊñ∞ÁöÑ‰æùËµñÈÖçÁΩÆÔºåÁî®Êù•‰ª£Êõø compile ‰æùËµñÈÖçÁΩÆ„ÄÇÂÖ∂‰∏≠ api Âíå‰ª•ÂâçÁöÑ compile ‰æùËµñÈÖçÁΩÆÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ‰ΩøÁî® api/compile ÁöÑ‰æùËµñÊñπÂºèÔºå‰ºöÂêëÂ§ñÁïåÊö¥Èú≤Êú¨Ê®°ÂùóÊâÄ‰æùËµñÁöÑÂ∫ìÁöÑÊé•Âè£Ôºå‰ΩøÁî® implementation Âàô‰∏ç‰ºö„ÄÇ Ëß£ÂÜ≥‰∫Ü‰ªÄ‰πàÈóÆÈ¢òÔºü‰∏∫‰ªÄ‰πàË¶ÅÂÅöËøôÊ†∑ÁöÑ‰øÆÊîπÂë¢Ôºü‰ΩøÁî® implementation ‰æùËµñÈÖçÁΩÆÔºåÂèØ‰ª•ÊòæËëóÂáèÂ∞ëÊûÑÂª∫ÁöÑÊó∂Èó¥„ÄÇ ËÄÉËôëËøôÊ†∑ÁöÑÂú∫ÊôØÔºåÊúâÂ¶Ç‰∏ãÂÖ≠‰∏™Ê®°ÂùóÔºö D„ÄÅE„ÄÅF ‰∏â‰∏™Ê®°ÂùóÈÉΩ‰æùËµñ‰∫Ü Lib Â∫ì„ÄÇ ÂÅáËÆæ D„ÄÅE„ÄÅF ‰∏â‰∏™Ê®°ÂùóÈÉΩ‰ª• implementation ÁöÑÊñπÂºèÂºïÁî® Lib Â∫ìÔºåÈÇ£‰πà‰∏äÂ±ÇÁöÑ AÔºåBÔºåC ‰∏â‰∏™Ê®°ÂùóÂú®ÁºñËØëÊúüÈÉΩÊó†Ê≥ïÂºïÁî®Âà∞ Lib Â∫ì‰∏≠ÁöÑÂÜÖÂÆπ„ÄÇÂõ†Ê≠§ÂΩì Lib ÂèëÁîüÂèòÂåñÁöÑÊó∂ÂÄôÔºåÂè™Êúâ D E F Ëøô‰∏â‰∏™Ê®°ÂùóÈúÄË¶ÅÈáçÊñ∞ÁºñËØëÔºåA,B,C Âàô‰∏çÈúÄË¶ÅÔºàÂõ†‰∏∫ DEF ‰∏â‰∏™Ê®°ÂùóÂØπÂ§ñÁöÑÊé•Âè£ÈÉΩÊ≤°ÊúâÊîπÂèòÔºâ„ÄÇ ÂÅáËÆæ D„ÄÅE„ÄÅF ‰∏â‰∏™Ê®°ÂùóÈÉΩ‰ª• compile/api ÁöÑÊñπÂºèÂºïÁî® Lib Â∫ìÔºàÂØπÂ§ñÊö¥Èú≤‰∫ÜËá™Â∑±ÂºïÁî®ÁöÑÂ∫ìÁöÑÊé•Âè£ÔºâÔºåÈÇ£‰πàÊó†ËÆ∫‰∏äÂ±ÇÁöÑ AÔºåBÔºåC ‰∏â‰∏™Ê®°ÂùóÂØπ D„ÄÅE„ÄÅF Ê®°ÂùóÁöÑ‰æùËµñÊòØ compile„ÄÅapi ÊñπÂºèËøòÊòØ implementation ÊñπÂºèÔºåÂÆÉ‰ª¨ÔºàA„ÄÅB„ÄÅCÔºâÈÉΩÂèØ‰ª•ÂºïÁî®Âà∞ Lib Â∫ì‰∏≠ÁöÑÂÜÖÂÆπ„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÂΩì Lib ÂèëÁîüÂèòÂåñÁöÑÊó∂ÂÄôÔºåA B C D E F Ëøô‰∏â‰∏™Ê®°ÂùóÈÉΩÈúÄË¶ÅÈáçÊñ∞ÁºñËØë„ÄÇ Public ÂèØ‰ª• ÂÖ∂ÂÆÉÂèòÂåñÂú®ËØ•ÁâàÊú¨‰∏≠ÔºåÂÆòÊñπÂõ¢Èòü‰πüÊää‰πãÂâçÂëΩÂêçÁöÑ‰∏çËßÑËåÉÁöÑÂú∞Êñπ‰øÆÊîπ‰∫ÜÔºåprovided ÊîπÊàê‰∫Ü compileOnlyÔºåapk Êîπ‰∏∫‰∫Ü runtimeOnly„ÄÇÊîπÂèòÁöÑÂè™ÊòØÂêçÁß∞ÔºåÂäüËÉΩÊ≤°Âèò„ÄÇ compileOnly ÁöÑ‰ΩøÁî®Âú∫ÊôØÂåÖÊã¨‰ΩÜÊòØ‰∏çÈôê‰∫é‰∏ãÈù¢ÁöÑ‰∏§ÁßçÔºö ÁºñËØëÊó∂ÊâÄÈúÄÁöÑ‰æùËµñÊÄßÔºå‰ΩÜÂú®ËøêË°åÊó∂‰ªé‰∏çÈúÄË¶ÅÔºå‰æãÂ¶ÇÁ∫ØÊ∫êÊ≥®ÈáäÊàñÊ≥®ÈáäÂ§ÑÁêÜÂô®; API Âú®ÁºñËØëÊó∂ÈúÄË¶ÅÔºå‰ΩÜÂÖ∂ÂÆûÁé∞Áî±Ê∂àË¥πÂ∫ìÔºåÂ∫îÁî®Á®ãÂ∫èÊàñËøêË°åÊó∂ÁéØÂ¢ÉÊèê‰æõÁöÑ‰æùËµñÈ°π„ÄÇ runtimeOnly ÁöÑ‰ΩøÁî®Âú∫ÊôØ‰æùËµñÈ°π‰ªÖÂú®ËøêË°åÊó∂ÂØπÊ®°ÂùóÂèäÂÖ∂Ê∂àË¥πËÄÖÂèØÁî®„ÄÇ Â∞èÁªì Êñ∞ÈÖçÁΩÆ Â∑≤ÂºÉÁî®ÈÖçÁΩÆ Ë°å‰∏∫ implementation compile ‰æùËµñÈ°πÂú®ÁºñËØëÊó∂ÂØπÊ®°ÂùóÂèØÁî®ÔºåÂπ∂‰∏î‰ªÖÂú®ËøêË°åÊó∂ÂØπÊ®°ÂùóÁöÑÊ∂àË¥πËÄÖÂèØÁî®„ÄÇ ÂØπ‰∫éÂ§ßÂûãÂ§öÈ°πÁõÆÊûÑÂª∫Ôºå‰ΩøÁî® implementation ËÄå‰∏çÊòØ api/compile ÂèØ‰ª•ÊòæËëóÁº©Áü≠ÊûÑÂª∫Êó∂Èó¥ÔºåÂõ†‰∏∫ÂÆÉÂèØ‰ª•ÂáèÂ∞ëÊûÑÂª∫Á≥ªÁªüÈúÄË¶ÅÈáçÊñ∞ÁºñËØëÁöÑÈ°πÁõÆÈáè„ÄÇ Â§ßÂ§öÊï∞Â∫îÁî®ÂíåÊµãËØïÊ®°ÂùóÈÉΩÂ∫î‰ΩøÁî®Ê≠§ÈÖçÁΩÆ„ÄÇ api compile ‰æùËµñÈ°πÂú®ÁºñËØëÊó∂ÂØπÊ®°ÂùóÂèØÁî®ÔºåÂπ∂‰∏îÂú®ÁºñËØëÊó∂ÂíåËøêË°åÊó∂ËøòÂØπÊ®°ÂùóÁöÑÊ∂àË¥πËÄÖÂèØÁî®„ÄÇ Ê≠§ÈÖçÁΩÆÁöÑË°å‰∏∫Á±ª‰ºº‰∫é compileÔºàÁé∞Âú®Â∑≤ÂºÉÁî®ÔºâÔºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºåÊÇ®Â∫îÂΩì‰ªÖÂú®Â∫ìÊ®°Âùó‰∏≠‰ΩøÁî®ÂÆÉ„ÄÇ Â∫îÁî®Ê®°ÂùóÂ∫î‰ΩøÁî® implementationÔºåÈô§ÈùûÊÇ®ÊÉ≥Ë¶ÅÂ∞ÜÂÖ∂ API ÂÖ¨ÂºÄÁªôÂçïÁã¨ÁöÑÊµãËØïÊ®°Âùó„ÄÇ compileOnly provided ‰æùËµñÈ°π‰ªÖÂú®ÁºñËØëÊó∂ÂØπÊ®°ÂùóÂèØÁî®ÔºåÂπ∂‰∏îÂú®ÁºñËØëÊàñËøêË°åÊó∂ÂØπÂÖ∂Ê∂àË¥πËÄÖ‰∏çÂèØÁî®„ÄÇ Ê≠§ÈÖçÁΩÆÁöÑË°å‰∏∫Á±ª‰ºº‰∫é providedÔºàÁé∞Âú®Â∑≤ÂºÉÁî®Ôºâ„ÄÇ runtimeOnly apk ‰æùËµñÈ°π‰ªÖÂú®ËøêË°åÊó∂ÂØπÊ®°ÂùóÂèäÂÖ∂Ê∂àË¥πËÄÖÂèØÁî®„ÄÇ Ê≠§ÈÖçÁΩÆÁöÑË°å‰∏∫Á±ª‰ºº‰∫é apkÔºàÁé∞Âú®Â∑≤ÂºÉÁî®Ôºâ„ÄÇ Ê≥®Ôºöcompile„ÄÅprovided Âíå apk ÁõÆÂâç‰ªçÁÑ∂ÂèØÁî®„ÄÇ ‰∏çËøáÔºåÂÆÉ‰ª¨Â∞ÜÂú®‰∏ã‰∏Ä‰∏™‰∏ªË¶ÅÁâàÊú¨ÁöÑ Android Êèí‰ª∂‰∏≠Ê∂àÂ§±„ÄÇ Êó•Â∏∏ÂºÄÂèë‰∏≠‰∏ÄËà¨ÈÉΩÊòØÁî® implementationÔºåÈÉ®ÂàÜÊÉÖÂÜµ‰∏ã‰ºöÁî®Âà∞ apiÔºåÂÖ∂‰ªñÁöÑ‰æùËµñÊñπÂºè‰∏ÄËà¨‰∏çÊÄé‰πàÁî®Âà∞„ÄÇËÆ∞‰Ωè compile„ÄÅapi ‰æùËµñÊñπÂºèÊòØ„Äå‰º†ÈÄíÊÄßÁöÑ„ÄçÔºåËÄå implementation ‰æùËµñÊñπÂºèÁöÑÊòØ„ÄåÈùû‰º†ÈÄíÊÄß„ÄçÁöÑ„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ËøÅÁßªÂà∞ Android Plugin for Gradle 3.0.0 Implementation vs API dependency Android Studio3.x Êñ∞ÁöÑ‰æùËµñÊñπÂºèÔºàimplementation„ÄÅapi„ÄÅcompileOnlyÔºâ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Gradle</category>
      </categories>
      <tags>
        <tag>Gradle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fragment Note]]></title>
    <url>%2Fblog%2F2018%2F06%2F02%2FFragment%20Note%2F</url>
    <content type="text"><![CDATA[Á¨îËÆ∞Ëá™Áî®ÔºåÈÉ®ÂàÜÂÜÖÂÆπÂæÖÂÆåÂñÑ„ÄÇ Ê¶ÇËø∞ÂΩìÊÇ®Â∞ÜÁâáÊÆµ‰Ωú‰∏∫ Activity Â∏ÉÂ±ÄÁöÑ‰∏ÄÈÉ®ÂàÜÊ∑ªÂä†Êó∂ÔºåÂÆÉÂ≠òÂú®‰∫é Activity ËßÜÂõæÂ±ÇÊ¨°ÁªìÊûÑÁöÑÊüê‰∏™ ViewGroup ÂÜÖÈÉ®ÔºåÂπ∂‰∏îÁâáÊÆµ‰ºöÂÆö‰πâÂÖ∂Ëá™Â∑±ÁöÑËßÜÂõæÂ∏ÉÂ±Ä„ÄÇÊÇ®ÂèØ‰ª•ÈÄöËøáÂú® Activity ÁöÑÂ∏ÉÂ±ÄÊñá‰ª∂‰∏≠Â£∞ÊòéÁâáÊÆµÔºåÂ∞ÜÂÖ∂‰Ωú‰∏∫ &lt;fragment&gt; ÂÖÉÁ¥†ÊèíÂÖ•ÊÇ®ÁöÑ Activity Â∏ÉÂ±Ä‰∏≠ÔºåÊàñËÄÖÈÄöËøáÂ∞ÜÂÖ∂Ê∑ªÂä†Âà∞Êüê‰∏™Áé∞Êúâ ViewGroupÔºåÂà©Áî®Â∫îÁî®‰ª£Á†ÅËøõË°åÊèíÂÖ•„ÄÇ‰∏çËøáÔºåÁâáÊÆµÂπ∂ÈùûÂøÖÈ°ªÊàê‰∏∫ Activity Â∏ÉÂ±ÄÁöÑ‰∏ÄÈÉ®ÂàÜÔºõÊÇ®ËøòÂèØ‰ª•Â∞ÜÊ≤°ÊúâËá™Â∑± UI ÁöÑÁâáÊÆµÁî®‰Ωú Activity ÁöÑ‰∏çÂèØËßÅÂ∑•‰ΩúÁ∫øÁ®ã„ÄÇ Fragment Ëß£ÂÜ≥‰∫Ü‰ªÄ‰πàÈóÆÈ¢òÔºü‰∏çËÉΩÁõ¥Êé•Áî® View Êõø‰ª£ÂêóÔºü Áõ∏ÂØπ‰∫é view ËÄåË®ÄÔºåÂÆÉÁöÑ‰ºòÂäøÂú®Âì™Ôºü Android 3.0ÔºàAPI Á∫ßÂà´ 11Ôºâ‰∏≠ÂºïÂÖ•‰∫ÜÁâáÊÆµÔºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÁªôÂ§ßÂ±èÂπïÔºàÂ¶ÇÂπ≥ÊùøÁîµËÑëÔºâ‰∏äÊõ¥Âä†Âä®ÊÄÅÂíåÁÅµÊ¥ªÁöÑ UI ËÆæËÆ°Êèê‰æõÊîØÊåÅ„ÄÇÁî±‰∫éÂπ≥ÊùøÁîµËÑëÁöÑÂ±èÂπïÊØîÊâãÊú∫Â±èÂπïÂ§ßÂæóÂ§öÔºåÂõ†Ê≠§ÂèØÁî®‰∫éÁªÑÂêàÂíå‰∫§Êç¢ UI ÁªÑ‰ª∂ÁöÑÁ©∫Èó¥Êõ¥Â§ß„ÄÇÂà©Áî®ÁâáÊÆµÂÆûÁé∞Ê≠§Á±ªËÆæËÆ°Êó∂ÔºåÊÇ®Êó†ÈúÄÁÆ°ÁêÜÂØπËßÜÂõæÂ±ÇÊ¨°ÁªìÊûÑÁöÑÂ§çÊùÇÊõ¥Êîπ„ÄÇ ÊÇ®Â∫îËØ•Â∞ÜÊØè‰∏™ÁâáÊÆµÈÉΩËÆæËÆ°‰∏∫ÂèØÈáçÂ§ç‰ΩøÁî®ÁöÑÊ®°ÂùóÂåñ Activity ÁªÑ‰ª∂„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÁî±‰∫éÊØè‰∏™ÁâáÊÆµÈÉΩ‰ºöÈÄöËøáÂêÑËá™ÁöÑÁîüÂëΩÂë®ÊúüÂõûË∞ÉÊù•ÂÆö‰πâÂÖ∂Ëá™Â∑±ÁöÑÂ∏ÉÂ±ÄÂíåË°å‰∏∫ÔºåÊÇ®ÂèØ‰ª•Â∞Ü‰∏Ä‰∏™ÁâáÊÆµÂä†ÂÖ•Â§ö‰∏™ ActivityÔºåÂõ†Ê≠§ÔºåÊÇ®Â∫îËØ•ÈááÁî®ÂèØÂ§çÁî®ÂºèËÆæËÆ°ÔºåÈÅøÂÖçÁõ¥Êé•‰ªéÊüê‰∏™ÁâáÊÆµÁõ¥Êé•ÊìçÁ∫µÂè¶‰∏Ä‰∏™ÁâáÊÆµ„ÄÇ ËøôÁâπÂà´ÈáçË¶ÅÔºåÂõ†‰∏∫Ê®°ÂùóÂåñÁâáÊÆµËÆ©ÊÇ®ÂèØ‰ª•ÈÄöËøáÊõ¥ÊîπÁâáÊÆµÁöÑÁªÑÂêàÊñπÂºèÊù•ÈÄÇÂ∫î‰∏çÂêåÁöÑÂ±èÂπïÂ∞∫ÂØ∏„ÄÇ Âú®ËÆæËÆ°ÂèØÂêåÊó∂ÊîØÊåÅÂπ≥ÊùøÁîµËÑëÂíåÊâãÊú∫ÁöÑÂ∫îÁî®Êó∂ÔºåÊÇ®ÂèØ‰ª•Âú®‰∏çÂêåÁöÑÂ∏ÉÂ±ÄÈÖçÁΩÆ‰∏≠ÈáçÂ§ç‰ΩøÁî®ÊÇ®ÁöÑÁâáÊÆµÔºå‰ª•Ê†πÊçÆÂèØÁî®ÁöÑÂ±èÂπïÁ©∫Èó¥‰ºòÂåñÁî®Êà∑‰ΩìÈ™å„ÄÇ ‰ΩøÁî®ÈÄöÂ∏∏Ëá≥Â∞ëÈúÄË¶ÅÂÆûÁé∞‰ª•‰∏ãÂá†‰∏™ÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÔºö onCreateÔºàÔºâ Âú®Ê≠§ÊñπÊ≥ï‰∏≠ÂàùÂßãÂåñÈÇ£‰∫õ‰Ω†Â∏åÊúõÂú®fragment Â§Ñ‰∫é paused or stopped, then resumedÁä∂ÊÄÅÁöÑÊó∂ÂÄô‰ªçÁÑ∂Ë¢´‰øùÁïôÁöÑÁªÑ‰ª∂ onCreateView() Ëøô‰∏™ÊñπÊ≥ïÂøÖÈ°ªËøîÂõû Ëøô‰∏™fragmentÁöÑÂ∏ÉÂ±ÄÁöÑÊ†πViewÔºå‰πüÂ¶ÇÊûúÊ≠§fragment‰∏çÊèê‰æõ‰∏Ä‰∏™UIÁöÑËØùÔºåÂèØ‰ª•ËøîÂõûÁ©∫ onPause() Ëøô‰∏™ÊñπÊ≥ï‰∏≠‰Ω†Â∫îËØ•Êèê‰∫§‰Ω†ÁöÑfragment‰∏≠ÁöÑÈÇ£‰∫õÈúÄË¶ÅË¢´‰øùÂ≠òÁöÑÊï∞ÊçÆ„ÄÇ ÂèÇÊï∞‰º†ÈÄí‰ΩøÁî® setArgument ÁöÑÊñπÂºèÔºåÈÄöËøáËøôÁßçÊñπÂºè‰º†ÈÄíÂèÇÊï∞ÔºåÂ¶ÇÊûúÈÖçÁΩÆÂèëÁîüÊõ¥ÊîπÔºåÈÄöËøáFragment.setArguments(Bundle bundle)ÊñπÊ≥ïËÆæÁΩÆÁöÑbundle‰ºö‰øùÁïô‰∏ãÊù•„ÄÇ Â¶ÇÊûúÊòØÈÄöËøáÁõ¥Êé•ËµãÂÄºÁöÑÊñπÂºèÔºåÂàôÈúÄË¶ÅÂÆûÁé∞ onSaveInstance Âíå onRestoreIntanceState ÊñπÊ≥ïÔºàÊàñËÄÖ Âú® onCreate ÊñπÊ≥ïËøõË°åÈÖçÁΩÆÔºâÊâçËÉΩÂ∫îÂØπÈÖçÁΩÆÊõ¥Êîπ„ÄÇ Ë¶ÅÊ≥®ÊÑèÁöÑÈóÆÈ¢òÂ∞±ÊòØ setArgument ÊñπÊ≥ïË¶ÅÂú® Fragment ‰∏é Activity ÂÖ≥ËÅî‰πãÂâçË∞ÉÁî®„ÄÇ ÂèØ‰ª•Ë¢´ÁªßÊâøÁöÑFragmentÂü∫Á±ª DialogFragment Displays a floating dialog. Using this class to create a dialog is a good alternative to using the dialog helper methods in the Activity class, because you can incorporate(ÂåÖÂê´) a fragment dialog into the back stack of fragments managed by the activity, allowing the user to return to a dismissed fragment. Áõ∏ÊØî‰∫é Dialog ÁöÑÂ•ΩÂ§ÑÔºö ÁîüÂëΩÂë®Êúü‰æø‰∫éÁÆ°ÁêÜÔºõ ÊØî Dialog Êõ¥Âä†Âú∞Âº∫Â§ß„ÄÇ„ÄåDialogFragment‰πüÂÖÅËÆ∏ÂºÄÂèëËÄÖÊääDialog‰Ωú‰∏∫ÂÜÖÂµåÁöÑÁªÑ‰ª∂ËøõË°åÈáçÁî®„Äç ÈáçÂÜô onCreateView ÊàñËÄÖ onCreateDialog ListFragment Displays a list of items that are managed by an adapter (such as a SimpleCursorAdapter), similar to ListActivity. It provides several methods for managing a list view, such as the onListItemClick() callback to handle click events. Á±ª‰ºº‰∫éListActivity PreferenceFragment Displays a hierarchy of Preference objects as a list, similar to PreferenceActivity. This is useful when creating a ‚Äúsettings‚Äù activity for your application. ÂØπ‰∫é‚ÄúËÆæÁΩÆ‚ÄùÁïåÈù¢ËÄåË®ÄÂæàÊúâÁî® ÁâπÊÆäÁî®ÈÄîË∞ÉÁî® setRetainInstance(true);Ôºå‰ºöÂú®ÈÖçÁΩÆÂèëÁîüÊîπÂèòÁöÑÊó∂ÂÄô‰øùÂ≠òÂΩìÂâçFragment ‰∏≠ÁöÑÊâÄÊúâÂØπË±°„ÄÇ 1234567891011121314151617181920212223/** * Control whether a fragment instance is retained across Activity * re-creation (such as from a configuration change). This can only * be used with fragments not in the back stack. If set, the fragment * lifecycle will be slightly different when an activity is recreated: * &lt;ul&gt; * &lt;li&gt; &#123;@link #onDestroy()&#125; will not be called (but &#123;@link #onDetach()&#125; still * will be, because the fragment is being detached from its current activity). * &lt;li&gt; &#123;@link #onCreate(Bundle)&#125; will not be called since the fragment * is not being re-created. * &lt;li&gt; &#123;@link #onAttach(Activity)&#125; and &#123;@link #onActivityCreated(Bundle)&#125; &lt;b&gt;will&lt;/b&gt; * still be called. * &lt;/ul&gt; */ËØ•ÊñπÊ≥ïÊéßÂà∂ Fragment ÁöÑÂÆû‰æãÊòØÂê¶Âú®ActivityÈáçÊñ∞ÂàõÂª∫ÁöÑÊó∂ÂÄô‰øùÁïô„ÄÇÂÆÉÂè™ËÉΩÁî®‰∫éÈÇ£‰∫õ‰∏çÂ§ÑÂú®ÂõûÈÄÄÊ†à‰∏≠ÁöÑFragment Ë∫´‰∏ä„ÄÇÊ≥®ÊÑèÔºåÂ¶ÇÊûú‰øùÁïôÂÆû‰æãÁöÑËØùÔºåFragment ÁöÑÁîüÂëΩÂë®ÊúüÂ∞Ü‰ºöÊúâ‰∏Ä‰∫õ‰∏çÂêå- onDestory ÊñπÊ≥ï‰∏ç‰ºöË¢´Ë∞ÉÁî®Ôºå‰ΩÜÊòØ onDetach ÊñπÊ≥ï‰ªçÁÑ∂‰ºöË¢´Ë∞ÉÁî®ÔºåÂõ†‰∏∫ Fragment ‰ªéÂΩìÂâç Activity ‰∏≠Ââ•Á¶ª‰∫Ü„ÄÇ- onCreate ÊñπÊ≥ï‰πü‰∏ç‰ºöË¢´Ë∞ÉÁî®ÔºåÂõ†‰∏∫ Fragment Âπ∂Ê≤°ÊúâÈáçÊñ∞ÂàõÂª∫- onAttach Âíå onActivityCreated ÊñπÊ≥ï‰æùÁÑ∂‰ºöË¢´Ë∞ÉÁî®„ÄÇpublic void setRetainInstance(boolean retain) &#123; mRetainInstance = retain;&#125; Áî®‰∫é‰øùÂ≠òÊï∞ÊçÆ„ÄÇ ÂàõÂª∫/Ê∏≤ÊüìÁî®Êà∑ÁïåÈù¢‰∏∫‰∫ÜÊèê‰æõ‰∏Ä‰∏™Â∏ÉÂ±ÄÁªôfragmentÔºå‰Ω†ÂøÖÈ°ªÂÆûÁé∞onCreateView()ÊñπÊ≥ï,Ëøô‰∏™ÊñπÊ≥ï‰ºöÂú®Âà∞Ëøô‰∏™Fragment ÁªòÂá∫ÂÆÉÁöÑÂ∏ÉÂ±ÄÁöÑÊó∂ÂÄô Ë¢´ÂÆâÂçìÁ≥ªÁªüË∞ÉÁî®„ÄÇÊ≠§Â§ñÔºåËøô‰∏™ÊñπÊ≥ï‰∏≠ÂøÖÈ°ª return a View that is the root of your fragment‚Äôs layout Note: If your fragment is a subclass of ListFragment, the default implementation returns a ListView from onCreateView(), so you don‚Äôt need to implement it. inflate() ÊñπÊ≥ïÂ∏¶Êúâ‰∏â‰∏™ÂèÇÊï∞Ôºö ÊÇ®ÊÉ≥Ë¶ÅinflateÁöÑÂ∏ÉÂ±ÄÁöÑËµÑÊ∫ê IDÔºõ Â∞Ü‰Ωú‰∏∫inflateÂ∏ÉÂ±ÄÁà∂È°πÁöÑ ViewGroup„ÄÇ‰º†ÈÄí container ÂØπÁ≥ªÁªüÂêëinflateÂ∏ÉÂ±ÄÁöÑÊ†πËßÜÂõæÔºàÁî±ÂÖ∂ÊâÄÂ±ûÁöÑÁà∂ËßÜÂõæÊåáÂÆöÔºâÂ∫îÁî®Â∏ÉÂ±ÄÂèÇÊï∞ÂÖ∑ÊúâÈáçË¶ÅÊÑè‰πâÔºõ ÊåáÁ§∫ÊòØÂê¶Â∫îËØ•Âú®inflateÊúüÈó¥Â∞ÜinflateÂ∏ÉÂ±ÄÈôÑÂä†Ëá≥ ViewGroupÔºàÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÔºâÁöÑÂ∏ÉÂ∞îÂÄº„ÄÇÔºàÂú®Êú¨‰æã‰∏≠ÔºåÂÖ∂ÂÄº‰∏∫ falseÔºåÂõ†‰∏∫Á≥ªÁªüÂ∑≤ÁªèÂ∞ÜinflateÂ∏ÉÂ±ÄÊèíÂÖ• container ‚Äî ‰º†ÈÄí true ÂÄº‰ºöÂú®ÊúÄÁªàÂ∏ÉÂ±Ä‰∏≠ÂàõÂª∫‰∏Ä‰∏™Â§ö‰ΩôÁöÑËßÜÂõæÁªÑ„ÄÇÔºâ Á≥ªÁªü‰ºöÂ∏ÆÊàë‰ª¨ addViewÔºåÊâÄ‰ª• attachToRoot ‰∏∫ falseÔºõ android.support.v4.app.FragmentManagerImpl#moveToState(android.support.v4.app.Fragment, int, int, int, boolean) 123if(container != null) &#123; container.addView(f.mView);&#125; Êé®ËçêÁî®‰∏ãËæπËøôÁßçÊñπÂºèÔºö 1inflater.inflate(R.layout.item, parent, false); ÊµãÈáèÁöÑÊó∂ÂÄô‰æùËµñ parentÔºå‰ΩÜÊòØÊ∑ªÂä†ÈúÄË¶ÅÊâãÂä®ËøõË°å 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) &#123; synchronized (mConstructorArgs) &#123; Trace.traceBegin(Trace.TRACE_TAG_VIEW, "inflate"); final Context inflaterContext = mContext; final AttributeSet attrs = Xml.asAttributeSet(parser); Context lastContext = (Context) mConstructorArgs[0]; mConstructorArgs[0] = inflaterContext; View result = root; try &#123; // Look for the root node. int type; final String name = parser.getName(); if (TAG_MERGE.equals(name)) &#123; if (root == null || !attachToRoot) &#123; throw new InflateException("&lt;merge /&gt; can be used only with a valid " + "ViewGroup root and attachToRoot=true"); &#125; rInflate(parser, root, inflaterContext, attrs, false); &#125; else &#123; // Temp is the root view that was found in the xml final View temp = createViewFromTag(root, name, inflaterContext, attrs); ViewGroup.LayoutParams params = null; if (root != null) &#123; if (DEBUG) &#123; System.out.println("Creating params from root: " + root); &#125; // Create layout params that match root, if supplied //ÂàõÂª∫ Ê†πÂ∏ÉÂ±ÄÁöÑ layout params params = root.generateLayoutParams(attrs); if (!attachToRoot) &#123; // Set the layout params for temp if we are not // attaching. (If we are, we use addView, below) temp.setLayoutParams(params); &#125; &#125; if (DEBUG) &#123; System.out.println("-----&gt; start inflating children"); &#125; // Inflate all children under temp against its context. rInflateChildren(parser, temp, attrs, true); if (DEBUG) &#123; System.out.println("-----&gt; done inflating children"); &#125; //Ê†πÂ∏ÉÂ±ÄÂ≠òÂú® Âπ∂‰∏î ÂæÖÊ∏≤ÊüìÁöÑÂ∏ÉÂ±ÄÈúÄË¶ÅÂÖ≥ËÅîÂà∞ rootÔºåÈÇ£Â∞±Ë∞ÉÁî® addView ÊñπÊ≥ïÂ∞ÜÂÆÉÊ∑ªÂä†ËøõÂéª if (root != null &amp;&amp; attachToRoot) &#123; root.addView(temp, params); &#125; //Á°ÆÂÆöËøîÂõûÂÄºÊòØ root ËøòÊòØ xml Êñá‰ª∂‰∏≠ÁöÑÊ†πÂ∏ÉÂ±Ä //root ‰∏∫ null ÊàñËÄÖ ‰∏çÂÖ≥ËÅîÂà∞Ê†πÂ∏ÉÂ±ÄÔºåËøîÂõûÁöÑÂ∞±ÊòØ xml Êñá‰ª∂‰∏≠ÁöÑÊ†πÂ∏ÉÂ±Ä if (root == null || !attachToRoot) &#123; result = temp; &#125; &#125; &#125; catch (XmlPullParserException e) &#123; //‚Ä¶‚Ä¶ &#125; return result; &#125;&#125; Â∞Ü Fragment Ê∑ªÂä†Âà∞ Activity ÁöÑ‰∏§ÁßçÊñπÂºè1.Âú® Activity ÁöÑÂ∏ÉÂ±ÄÊñá‰ª∂ÂÜÖÂ£∞ÊòéÁâáÊÆµ ÂΩìÁ≥ªÁªüÂàõÂª∫Ê≠§ Activity Â∏ÉÂ±ÄÊó∂Ôºå‰ºöÂÆû‰æãÂåñÂú®Â∏ÉÂ±Ä‰∏≠ÊåáÂÆöÁöÑÊØè‰∏™ÁâáÊÆµÔºåÂπ∂‰∏∫ÊØè‰∏™ÁâáÊÆµË∞ÉÁî® onCreateView() ÊñπÊ≥ïÔºå‰ª•Ê£ÄÁ¥¢ÊØè‰∏™ÁâáÊÆµÁöÑÂ∏ÉÂ±Ä„ÄÇÁ≥ªÁªü‰ºöÁõ¥Êé•ÊèíÂÖ•ÁâáÊÆµËøîÂõûÁöÑ View Êù•Êõø‰ª£ &lt;fragment&gt; ÂÖÉÁ¥†„ÄÇ &lt;fragment&gt; ÂÖÉÁ¥†‰∏≠ÂèØ‰ª•ÈÄöËøá class = ‚Äú ‚Äù ‰πüÂèØ‰ª•ÈÄöËøá android:name=&quot;&quot; Êù•ÊåáÂÆö Ë¶ÅÂä†ÂÖ•ÁöÑFragment„ÄÇ class ÁöÑÊÄßËÉΩ‰ºöÈ´ò‰∏ÄÁÇπÁÇπ„ÄÇ Âõ†‰∏∫Ôºöandroid.support.v4.app.FragmentManagerImpl#onCreateView(android.view.View, java.lang.String, android.content.Context, android.util.AttributeSet) 123456789101112public View onCreateView(View parent, String name, Context context, AttributeSet attrs) &#123; if (!"fragment".equals(name)) &#123; return null; &#125; //ÈÄöËøá class Ëé∑Âèñ Fragment ÂêçÂ≠ó String fname = attrs.getAttributeValue(null, "class"); TypedArray a = context.obtainStyledAttributes(attrs, FragmentTag.Fragment); if (fname == null) &#123;//Áî® class Êâæ‰∏çÂà∞ÔºåÈÄöËøá android:name ÂéªÊü•Êâæ fname = a.getString(FragmentTag.Fragment_name); &#125; //‚Ä¶‚Ä¶&#125; Ê≥®ÔºöÊØè‰∏™ÁâáÊÆµÈÉΩÈúÄË¶Å‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑÊ†áËØÜÁ¨¶ÔºåÈáçÂêØ Activity Êó∂ÔºåÁ≥ªÁªüÂèØ‰ª•‰ΩøÁî®ËØ•Ê†áËØÜÁ¨¶Êù•ÊÅ¢Â§çÁâáÊÆµÔºàÊÇ®‰πüÂèØ‰ª•‰ΩøÁî®ËØ•Ê†áËØÜÁ¨¶Êù•ÊçïËé∑ÁâáÊÆµ‰ª•ÊâßË°åÊüê‰∫õ‰∫ãÂä°ÔºåÂ¶ÇÂ∞ÜÂÖ∂ÁßªÈô§Ôºâ„ÄÇ ÂèØ‰ª•ÈÄöËøá‰∏âÁßçÊñπÂºè‰∏∫ÁâáÊÆµÊèê‰æõ IDÔºö ‰∏∫ android:id Â±ûÊÄßÊèê‰æõÂîØ‰∏Ä ID„ÄÇ ‰∏∫ android:tag Â±ûÊÄßÊèê‰æõÂîØ‰∏ÄÂ≠óÁ¨¶‰∏≤„ÄÇ Â¶ÇÊûúÊÇ®Êú™Áªô‰ª•‰∏ä‰∏§‰∏™Â±ûÊÄßÊèê‰æõÂÄºÔºåÁ≥ªÁªü‰ºö‰ΩøÁî®ÂÆπÂô®ËßÜÂõæÁöÑ ID„ÄÇ 2.ÈÄöËøájava ‰ª£Á†ÅÂ∞ÜÁâáÊÆµÊ∑ªÂä†Âà∞Êüê‰∏™Áé∞Êúâ ViewGroupÊÇ®ÂèØ‰ª•Âú® Activity ËøêË°åÊúüÈó¥ÈöèÊó∂Â∞ÜÁâáÊÆµÊ∑ªÂä†Âà∞ Activity Â∏ÉÂ±Ä‰∏≠„ÄÇÊÇ®Âè™ÈúÄÊåáÂÆöË¶ÅÂ∞ÜÁâáÊÆµÊîæÂÖ•Âì™‰∏™ ViewGroup„ÄÇ ÊÇ®ÂøÖÈ°ª‰ΩøÁî® FragmentTransaction ‰∏≠ÁöÑ API,ÊâçËÉΩÂú® Activity ‰∏≠ÊâßË°åÁâáÊÆµ‰∫ãÂä°ÔºàÂ¶ÇÊ∑ªÂä†„ÄÅÁßªÈô§ÊàñÊõøÊç¢ÁâáÊÆµÔºâ„ÄÇÊÇ®ÂèØ‰ª•ÂÉè‰∏ãÈù¢ËøôÊ†∑‰ªé Activity Ëé∑Âèñ‰∏Ä‰∏™ FragmentTransaction ÂÆû‰æãÔºö 12FragmentManager fragmentManager = getFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction(); ÁÑ∂ÂêéÔºåÊÇ®ÂèØ‰ª•‰ΩøÁî® add() ÊñπÊ≥ïÊ∑ªÂä†‰∏Ä‰∏™ÁâáÊÆµÔºåÊåáÂÆöË¶ÅÊ∑ªÂä†ÁöÑÁâáÊÆµ‰ª•ÂèäÂ∞ÜÂÖ∂ÊèíÂÖ•Âì™‰∏™ËßÜÂõæ„ÄÇ‰æãÂ¶ÇÔºö 123ExampleFragment fragment = new ExampleFragment();fragmentTransaction.add(R.id.fragment_container, fragment);//Â∞ÜË¶ÅÊ∑ªÂä†ÁöÑÁâáÊÆµfragmentTransaction.commit(); ‰º†ÈÄíÂà∞ add() ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØ ViewGroupÔºåÂç≥Â∫îËØ•ÊîæÁΩÆÁâáÊÆµÁöÑ‰ΩçÁΩÆÔºåÁî±ËµÑÊ∫ê ID ÊåáÂÆöÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØË¶ÅÊ∑ªÂä†ÁöÑÁâáÊÆµ„ÄÇ ‰∏ÄÊó¶ÊÇ®ÈÄöËøá FragmentTransaction ÂÅöÂá∫‰∫ÜÊõ¥ÊîπÔºåÂ∞±ÂøÖÈ°ªË∞ÉÁî® commit() ‰ª•‰ΩøÊõ¥ÊîπÁîüÊïà„ÄÇ Ê∑ªÂä†Ê≤°Êúâ UI ÁöÑÁâáÊÆµÂèØ‰ª•‰ΩøÁî®ÁâáÊÆµ‰∏∫ Activity Êèê‰æõÂêéÂè∞Ë°å‰∏∫ÔºåËÄå‰∏çÊòæÁ§∫È¢ùÂ§ñ UI„ÄÇ Ë¶ÅÊÉ≥Ê∑ªÂä†Ê≤°Êúâ UI ÁöÑÁâáÊÆµÔºåËØ∑‰ΩøÁî® add(Fragment, String) ‰ªé Activity Ê∑ªÂä†ÁâáÊÆµÔºà‰∏∫ÁâáÊÆµÊèê‰æõ‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑÂ≠óÁ¨¶‰∏≤‚ÄúÊ†áËÆ∞‚ÄùÔºåËÄå‰∏çÊòØËßÜÂõæ IDÔºâ„ÄÇ Ëøô‰ºöÊ∑ªÂä†ÁâáÊÆµÔºå‰ΩÜÁî±‰∫éÂÆÉÂπ∂‰∏ç‰∏é Activity Â∏ÉÂ±Ä‰∏≠ÁöÑËßÜÂõæÂÖ≥ËÅîÔºåÂõ†Ê≠§‰∏ç‰ºöÊî∂Âà∞ÂØπonCreateView() ÁöÑË∞ÉÁî®„ÄÇÂõ†Ê≠§ÔºåÊÇ®‰∏çÈúÄË¶ÅÂÆûÁé∞ onCreateView()ÊñπÊ≥ï„ÄÇ Â¶ÇÊûúÁâáÊÆµÊ≤°Êúâ UIÔºåÂàôÂ≠óÁ¨¶‰∏≤Ê†áËÆ∞Â∞ÜÊòØÊ†áËØÜÂÆÉÁöÑÂîØ‰∏ÄÊñπÂºè„ÄÇ ÁÆ°ÁêÜÁâáÊÆµË¶ÅÊÉ≥ÁÆ°ÁêÜÊÇ®ÁöÑ Activity ‰∏≠ÁöÑÁâáÊÆµÔºåÊÇ®ÈúÄË¶Å‰ΩøÁî® FragmentManager„ÄÇË¶ÅÊÉ≥Ëé∑ÂèñÂÆÉÔºåËØ∑‰ªéÊÇ®ÁöÑ Activity Ë∞ÉÁî® getFragmentManager()„ÄÇ ÊÇ®ÂèØ‰ª•‰ΩøÁî® FragmentManager ÊâßË°åÁöÑÊìç‰ΩúÂåÖÊã¨Ôºö ÈÄöËøá findFragmentById()ÔºàÂØπ‰∫éÂú® Activity Â∏ÉÂ±Ä‰∏≠Êèê‰æõ UI ÁöÑÁâáÊÆµÔºâÊàñ findFragmentByTag()ÔºàÂØπ‰∫éÊèê‰æõÊàñ‰∏çÊèê‰æõ UI ÁöÑÁâáÊÆµÔºâËé∑Âèñ Activity ‰∏≠Â≠òÂú®ÁöÑÁâáÊÆµ„ÄÇ ÈÄöËøá popBackStack()ÔºàÊ®°ÊãüÁî®Êà∑ÂèëÂá∫ÁöÑËøîÂõûÂëΩ‰ª§ÔºâÂ∞ÜÁâáÊÆµ‰ªéËøîÂõûÊ†à‰∏≠ÂºπÂá∫„ÄÇ ÈÄöËøá addOnBackStackChangedListener() Ê≥®ÂÜå‰∏Ä‰∏™ÁõëÂê¨ËøîÂõûÊ†àÂèòÂåñÁöÑ‰æ¶Âê¨Âô®„ÄÇ Â¶ÇÈúÄ‰∫ÜËß£ÊúâÂÖ≥Ëøô‰∫õÊñπÊ≥ï‰ª•ÂèäÂÖ∂‰ªñÊñπÊ≥ïÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåËØ∑ÂèÇÈòÖ FragmentManager Á±ªÊñáÊ°£„ÄÇ Â¶Ç‰∏äÊñáÊâÄÁ§∫ÔºåÊÇ®‰πüÂèØ‰ª•‰ΩøÁî® FragmentManager ÊâìÂºÄ‰∏Ä‰∏™ FragmentTransactionÔºåÈÄöËøáÂÆÉÊù•ÊâßË°åÊüê‰∫õ‰∫ãÂä°ÔºåÂ¶ÇÊ∑ªÂä†ÂíåÁßªÈô§ÁâáÊÆµ„ÄÇ ÊâßË°åÁâáÊÆµ‰∫ãÂä°Âú® Activity ‰∏≠‰ΩøÁî®ÁâáÊÆµÁöÑ‰∏ÄÂ§ß‰ºòÁÇπÊòØÔºåÂèØ‰ª•Ê†πÊçÆÁî®Êà∑Ë°å‰∏∫ÈÄöËøáÂÆÉ‰ª¨ÊâßË°åÊ∑ªÂä†„ÄÅÁßªÈô§„ÄÅÊõøÊç¢‰ª•ÂèäÂÖ∂‰ªñÊìç‰Ωú„ÄÇ ÊÇ®Êèê‰∫§Áªô Activity ÁöÑÊØèÁªÑÊõ¥ÊîπÈÉΩÁß∞‰∏∫‰∫ãÂä°ÔºåÊÇ®ÂèØ‰ª•‰ΩøÁî® FragmentTransaction ‰∏≠ÁöÑ API Êù•ÊâßË°å‰∏ÄÈ°π‰∫ãÂä°„ÄÇÊÇ®‰πüÂèØ‰ª•Â∞ÜÊØè‰∏™‰∫ãÂä°‰øùÂ≠òÂà∞Áî± Activity ÁÆ°ÁêÜÁöÑËøîÂõûÊ†àÂÜÖÔºå‰ªéËÄåËÆ©Áî®Êà∑ËÉΩÂ§üÂõûÈÄÄÁâáÊÆµÊõ¥ÊîπÔºàÁ±ª‰ºº‰∫éÂõûÈÄÄ ActivityÔºâ„ÄÇ ÂèØ‰ª•‰ªé FragmentManager Ëé∑Âèñ‰∏Ä‰∏™ FragmentTransaction ÂÆû‰æã„ÄÇ ÊØè‰∏™‰∫ãÂä°Ôºà‰ªéFragmentTransaction# begin Âà∞ commit ‰πãÈó¥ÁöÑ‰∏ÄÁªÑ„ÄåÊ∑ªÂä†ÔºåÂà†Èô§ÔºåÈöêËóèÔºåÊòæÁ§∫„ÄçÊìç‰ΩúÔºâÈÉΩÊòØÊÇ®ÊÉ≥Ë¶ÅÂêåÊó∂ÊâßË°åÁöÑ‰∏ÄÁªÑÊõ¥Êîπ„ÄÇÊÇ®ÂèØ‰ª•‰ΩøÁî® add()„ÄÅremove() Âíå replace() Á≠âÊñπÊ≥ï‰∏∫ÁªôÂÆö‰∫ãÂä°ËÆæÁΩÆÊÇ®ÊÉ≥Ë¶ÅÊâßË°åÁöÑÊâÄÊúâÊõ¥Êîπ„ÄÇÁÑ∂ÂêéÔºåË¶ÅÊÉ≥Â∞Ü‰∫ãÂä°Â∫îÁî®Âà∞ ActivityÔºåÊÇ®ÂøÖÈ°ªË∞ÉÁî® commit()„ÄÇ ‰∏çËøáÔºåÂú®ÊÇ®Ë∞ÉÁî® commit() ‰πãÂâçÔºåÊÇ®ÂèØËÉΩÊÉ≥Ë∞ÉÁî® addToBackStack()Ôºå‰ª•Â∞Ü‰∫ãÂä°Ê∑ªÂä†Âà∞ÁâáÊÆµ‰∫ãÂä°ËøîÂõûÊ†à„ÄÇ ËØ•ËøîÂõûÊ†àÁî± Activity ÁÆ°ÁêÜÔºåÂÖÅËÆ∏Áî®Êà∑ÈÄöËøáÊåâËøîÂõûÊåâÈíÆËøîÂõû‰∏ä‰∏ÄÁâáÊÆµÁä∂ÊÄÅ„ÄÇ ‰æãÂ¶ÇÔºå‰ª•‰∏ãÁ§∫‰æãËØ¥Êòé‰∫ÜÂ¶Ç‰ΩïÂ∞Ü‰∏Ä‰∏™ÁâáÊÆµÊõøÊç¢ÊàêÂè¶‰∏Ä‰∏™ÁâáÊÆµÔºå‰ª•ÂèäÂ¶Ç‰ΩïÂú®ËøîÂõûÊ†à‰∏≠‰øùÁïôÂÖàÂâçÁä∂ÊÄÅÔºö 1234567891011// Create new fragment and transactionFragment newFragment = new ExampleFragment();FragmentTransaction transaction = getFragmentManager().beginTransaction();// Replace whatever is in the fragment_container view with this fragment,// and add the transaction to the back stacktransaction.replace(R.id.fragment_container, newFragment);transaction.addToBackStack(null);// Commit the transactiontransaction.commit(); Âú®‰∏ä‰æã‰∏≠ÔºånewFragment ‰ºöÊõøÊç¢ÁõÆÂâçÂú® R.id.fragment_container ID ÊâÄÊ†áËØÜÁöÑÂ∏ÉÂ±ÄÂÆπÂô®‰∏≠ÁöÑ‰ªª‰ΩïÁâáÊÆµÔºàÂ¶ÇÊúâÔºâ„ÄÇÈÄöËøáË∞ÉÁî® addToBackStack() ÂèØÂ∞ÜÊõøÊç¢‰∫ãÂä°‰øùÂ≠òÂà∞ËøîÂõûÊ†àÔºå‰ª•‰æøÁî®Êà∑ËÉΩÂ§üÈÄöËøáÊåâËøîÂõûÊåâÈíÆÊí§Ê∂à‰∫ãÂä°Âπ∂ÂõûÈÄÄÂà∞‰∏ä‰∏ÄÁâáÊÆµ„ÄÇ ÊõøÊç¢‰∫ãÂä° ÊåáÁöÑÊòØ‰ªÄ‰πàÔºü Â¶ÇÊûúÊÇ®Âêë‰∫ãÂä°Ê∑ªÂä†‰∫ÜÂ§ö‰∏™Êõ¥ÊîπÔºàÂ¶ÇÂèà‰∏Ä‰∏™ add() Êàñ remove()ÔºâÔºåÂπ∂‰∏îË∞ÉÁî®‰∫Ü addToBackStack()ÔºåÂàôÂú®Ë∞ÉÁî® commit() ÂâçÂ∫îÁî®ÁöÑÊâÄÊúâÊõ¥ÊîπÈÉΩÂ∞Ü‰Ωú‰∏∫Âçï‰∏Ä‰∫ãÂä°Ê∑ªÂä†Âà∞ËøîÂõûÊ†àÔºåÂπ∂‰∏îËøîÂõûÊåâÈíÆ‰ºöÂ∞ÜÂÆÉ‰ª¨‰∏ÄÂπ∂Êí§Ê∂à„ÄÇ Âêë FragmentTransaction Ê∑ªÂä†Êõ¥ÊîπÁöÑÈ°∫Â∫èÊó†ÂÖ≥Á¥ßË¶ÅÔºå‰∏çËøáÔºö ÊÇ®ÂøÖÈ°ªÊúÄÂêéË∞ÉÁî® commit() Â¶ÇÊûúÊÇ®Ë¶ÅÂêëÂêå‰∏ÄÂÆπÂô®Ê∑ªÂä†Â§ö‰∏™ÁâáÊÆµÔºåÂàôÊÇ®Ê∑ªÂä†ÁâáÊÆµÁöÑÈ°∫Â∫èÂ∞ÜÂÜ≥ÂÆöÂÆÉ‰ª¨Âú®ËßÜÂõæÂ±ÇÊ¨°ÁªìÊûÑ‰∏≠ÁöÑÂá∫Áé∞È°∫Â∫è Â¶ÇÊûúÊÇ®Ê≤°ÊúâÂú®ÊâßË°åÁßªÈô§ÁâáÊÆµÁöÑ‰∫ãÂä°Êó∂Ë∞ÉÁî® addToBackStack()ÔºåÂàô‰∫ãÂä°Êèê‰∫§Êó∂ËØ•ÁâáÊÆµ‰ºöË¢´ÈîÄÊØÅÔºåÁî®Êà∑Â∞ÜÊó†Ê≥ïÂõûÈÄÄÂà∞ËØ•ÁâáÊÆµ„ÄÇ ‰∏çËøáÔºåÂ¶ÇÊûúÊÇ®Âú®Âà†Èô§ÁâáÊÆµÊó∂Ë∞ÉÁî®‰∫Ü addToBackStack()ÔºåÂàôÁ≥ªÁªü‰ºöÂÅúÊ≠¢ËØ•ÁâáÊÆµÔºåÂπ∂Âú®Áî®Êà∑ÂõûÈÄÄÊó∂Â∞ÜÂÖ∂ÊÅ¢Â§ç„ÄÇ ÊèêÁ§∫ÔºöÂØπ‰∫éÊØè‰∏™ÁâáÊÆµ‰∫ãÂä°ÔºåÊÇ®ÈÉΩÂèØ‰ª•ÈÄöËøáÂú®Êèê‰∫§ÂâçË∞ÉÁî® setTransition() Êù•Â∫îÁî®ËøáÊ∏°Âä®Áîª„ÄÇ Ë∞ÉÁî® commit() ‰∏ç‰ºöÁ´ãÂç≥ÊâßË°å‰∫ãÂä°ÔºåËÄåÊòØÂú® Activity ÁöÑ UI Á∫øÁ®ãÔºà‚Äú‰∏ª‚ÄùÁ∫øÁ®ãÔºâÂèØ‰ª•ÊâßË°åËØ•Êìç‰ΩúÊó∂ÂÜçÂÆâÊéíÂÖ∂Âú®Á∫øÁ®ã‰∏äËøêË°å„ÄÇ‰∏çËøáÔºåÂ¶ÇÊúâÂøÖË¶ÅÔºåÊÇ®‰πüÂèØ‰ª•‰ªé UI Á∫øÁ®ãË∞ÉÁî® executePendingTransactions() ‰ª•Á´ãÂç≥ÊâßË°å commit() Êèê‰∫§ÁöÑ‰∫ãÂä°„ÄÇÈÄöÂ∏∏‰∏çÂøÖËøôÊ†∑ÂÅöÔºåÈô§ÈùûÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠ÁöÑ‰Ωú‰∏ö‰æùËµñËØ•‰∫ãÂä°„ÄÇ Ê≥®ÊÑèÔºöÊÇ®Âè™ËÉΩÂú® Activity ‰øùÂ≠òÂÖ∂Áä∂ÊÄÅÔºàÁî®Êà∑Á¶ªÂºÄ ActivityÔºâ‰πãÂâç‰ΩøÁî® commit() Êèê‰∫§‰∫ãÂä°„ÄÇÂ¶ÇÊûúÊÇ®ËØïÂõæÂú®ËØ•Êó∂Èó¥ÁÇπÂêéÊèê‰∫§ÔºåÂàô‰ºöÂºïÂèëÂºÇÂ∏∏„ÄÇ ËøôÊòØÂõ†‰∏∫Â¶ÇÈúÄÊÅ¢Â§ç ActivityÔºåÂàôÊèê‰∫§ÂêéÁöÑÁä∂ÊÄÅÂèØËÉΩ‰ºö‰∏¢Â§±„ÄÇ ÂØπ‰∫é‰∏¢Â§±Êèê‰∫§Êó†ÂÖ≥Á¥ßË¶ÅÁöÑÊÉÖÂÜµÔºåËØ∑‰ΩøÁî® commitAllowingStateLoss()„ÄÇ FragmentTransaction#commit vs FragmentTransaction#commitAllowingStateLossÂõûÈÄÄÊ†àFragmentTransaction ÊòØÂú®‰∏Ä‰∏™ÈìæË°®‰∏≠Â≠òÂÇ®‰∫Ü‰∏ÄÊ¨°‰∫ãÂä°‰∏≠ÁöÑÊâÄÊúâÈúÄË¶ÅÊâßË°åÁöÑÊìç‰Ωú„ÄÇ 123456789/** * Add this transaction to the back stack. This means that the transaction * will be remembered after it is committed, and will reverse its operation * when later popped off the stack. * * @param name An optional name for this back stack state, or null. *///Ê∑ªÂä†„Äå‰∫ãÂä°„ÄçÊ≥®ÊÑè‰∏çÊòØÊüê‰∏Ä‰∏™ FragmentÂà∞ÂõûÈÄÄÊ†à‰∏≠„ÄÇËøôÊÑèÂë≥ÁùÄËøô‰∏™‰∫ãÂä°‰ºöÂú®Êèê‰∫§ÂêéË¢´„ÄåËÆ∞‰Ωè„Äçpublic abstract FragmentTransaction addToBackStack(@Nullable String name); BackStackRecod Êú¨Ë∫´ËøòÊòØÂÆûÁé∞‰∫Ü Runnabled Êé•Âè£ÔºåÊòØ‰∏Ä‰∏™ÂèØ‰ª•ÊâßË°åÁöÑÂØπË±°„ÄÇÊ∑ªÂä†ÂÆåÊØï‰πãÂêéÔºå‰ºöË∞ÉÁî® FragmentHostCallback ‰∏≠Êèê‰æõÁöÑ getHandler ÊñπÊ≥ïÔºåËé∑ÂèñÂà∞ Handler ÊñπÊ≥ïÔºåÁÑ∂ÂêéÂêë‰∏ªÁ∫øÁ®ãÁöÑ MessageQueue ‰∏≠ÂèëÈÄÅ‰∏Ä‰∏™ mExecCommit ÂèØÊâßË°åÂØπË±° Â§ÑÁêÜÁâáÊÆµÁîüÂëΩÂë®Êúü Activity ÁîüÂëΩÂë®Êúü‰∏éÁâáÊÆµÁîüÂëΩÂë®Êúü‰πãÈó¥ÁöÑÊúÄÊòæËëóÂ∑ÆÂºÇÂú®‰∫éÂÆÉ‰ª¨Âú®ÂÖ∂ÂêÑËá™ËøîÂõûÊ†à‰∏≠ÁöÑÂ≠òÂÇ®ÊñπÂºè„ÄÇ ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåActivity ÂÅúÊ≠¢Êó∂‰ºöË¢´ÊîæÂÖ•Áî±Á≥ªÁªüÁÆ°ÁêÜÁöÑ Activity ËøîÂõûÊ†àÔºà‰ª•‰æøÁî®Êà∑ÈÄöËøáËøîÂõûÊåâÈíÆÂõûÈÄÄÂà∞ ActivityÔºå‰ªªÂä°ÂíåËøîÂõûÊ†àÂØπÊ≠§ÂÅö‰∫ÜÈòêËø∞Ôºâ„ÄÇ‰∏çËøáÔºå‰ªÖÂΩìÂú®ÁßªÈô§ÁâáÊÆµÁöÑ‰∫ãÂä°ÊâßË°åÊúüÈó¥ÈÄöËøáË∞ÉÁî® addToBackStack() ÊòæÂºèËØ∑Ê±Ç‰øùÂ≠òÂÆû‰æãÊó∂ÔºåÁ≥ªÁªüÊâç‰ºöÂ∞ÜÁâáÊÆµÊîæÂÖ•Áî±ÂÆø‰∏ª Activity ÁÆ°ÁêÜÁöÑËøîÂõûÊ†à„ÄÇ Âú®ÂÖ∂‰ªñÊñπÈù¢ÔºåÁÆ°ÁêÜÁâáÊÆµÁîüÂëΩÂë®Êúü‰∏éÁÆ°ÁêÜ Activity ÁîüÂëΩÂë®ÊúüÈùûÂ∏∏Áõ∏‰ºº„ÄÇ Âõ†Ê≠§ÔºåÁÆ°ÁêÜ Activity ÁîüÂëΩÂë®ÊúüÁöÑÂÅöÊ≥ïÂêåÊ†∑ÈÄÇÁî®‰∫éÁâáÊÆµ„ÄÇ Ê≥®ÊÑèÔºöÂ¶ÇÊûúÈúÄË¶Å Context ÁöÑËØùÔºåÂèØ‰ª•Ë∞ÉÁî® getActivity()„ÄÇ‰ΩÜË¶ÅÊ≥®ÊÑèÔºåËØ∑‰ªÖÂú®ÁâáÊÆµÈôÑÂä†Âà∞ Activity Êó∂Ë∞ÉÁî® getActivity()„ÄÇÂ¶ÇÊûúÁâáÊÆµÂ∞öÊú™ÈôÑÂä†ÔºåÊàñÂú®ÂÖ∂ÁîüÂëΩÂë®ÊúüÁªìÊùüÊúüÈó¥ÂàÜÁ¶ªÔºåÂàô getActivity() Â∞ÜËøîÂõû null„ÄÇ ‰∏çËøáÔºåÁâáÊÆµËøòÊúâÂá†‰∏™È¢ùÂ§ñÁöÑÁîüÂëΩÂë®ÊúüÂõûË∞ÉÔºåÁî®‰∫éÂ§ÑÁêÜ‰∏é Activity ÁöÑÂîØ‰∏Ä‰∫§‰∫íÔºå‰ª•ÊâßË°åÊûÑÂª∫ÂíåÈîÄÊØÅÁâáÊÆµ UI Á≠âÊìç‰Ωú„ÄÇ Ëøô‰∫õÈ¢ùÂ§ñÁöÑÂõûË∞ÉÊñπÊ≥ïÊòØÔºö onAttach() Âú®ÁâáÊÆµÂ∑≤‰∏é Activity ÂÖ≥ËÅîÊó∂Ë∞ÉÁî®ÔºàActivity ‰º†ÈÄíÂà∞Ê≠§ÊñπÊ≥ïÂÜÖÔºâ„ÄÇ onCreateView() Ë∞ÉÁî®ÂÆÉÂèØÂàõÂª∫‰∏éÁâáÊÆµÂÖ≥ËÅîÁöÑËßÜÂõæÂ±ÇÊ¨°ÁªìÊûÑ„ÄÇ onActivityCreated() Âú® Activity ÁöÑ onCreate() ÊñπÊ≥ïÂ∑≤ËøîÂõûÊó∂Ë∞ÉÁî®„ÄÇ onDestroyView() Âú®ÁßªÈô§‰∏éÁâáÊÆµÂÖ≥ËÅîÁöÑËßÜÂõæÂ±ÇÊ¨°ÁªìÊûÑÊó∂Ë∞ÉÁî®„ÄÇ onDetach() Âú®ÂèñÊ∂àÁâáÊÆµ‰∏é Activity ÁöÑÂÖ≥ËÅîÊó∂Ë∞ÉÁî®„ÄÇ ‰∏ÄÊó¶ Activity ËææÂà∞ resume Áä∂ÊÄÅÔºåÊÇ®Â∞±ÂèØ‰ª•ÈöèÊÑèÂêë Activity Ê∑ªÂä†ÁâáÊÆµÂíåÁßªÈô§ÂÖ∂‰∏≠ÁöÑÁâáÊÆµ„ÄÇ Âõ†Ê≠§ÔºåÂè™ÊúâÂΩì Activity Â§Ñ‰∫é resume Áä∂ÊÄÅÊó∂ÔºåÁâáÊÆµÁöÑÁîüÂëΩÂë®ÊúüÊâçËÉΩÁã¨Á´ãÂèòÂåñ„ÄÇ Activity Â§Ñ‰∫éresume Áä∂ÊÄÅ‰∏ãÊó∂ÔºåÂàõÂª∫‰∏Ä‰∏™ Fragment ÔºåËøô‰∏™Fragment ÂâçÈù¢ÁöÑÁîüÂëΩÂë®Êúü‰ºöÂø´ÈÄüËµ∞ÂÆåÔºåÁõ¥Âà∞ resume ‰∏çËøáÔºåÂΩì Activity Á¶ªÂºÄ resume Áä∂ÊÄÅÊó∂ÔºåÁâáÊÆµ‰ºöÂú® Activity ÁöÑÊé®Âä®‰∏ãÂÜçÊ¨°ÁªèÂéÜÂÖ∂ÁîüÂëΩÂë®Êúü„ÄÇ ‰∏é Activity ÂØπÊØîÊûÑÈÄ†ÊñπÊ≥ïÊôÆÈÄöÂºÄÂèëËÄÖÊó†ÊùÉ‰ΩøÁî® Activity ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÊâÄ‰ª•Ôºå‰∏çËÉΩÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ï‰ªéÂ§ñÈÉ®Ê≥®ÂÖ•‰æùËµñ„ÄÇ Fragment ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÂèØ‰ª•‰º†ÂèÇËøõÊù• Activity ‰∏ÄËà¨ÊòØÈÄöËøá intent„ÄÇFragment ‰ºöÁî® setArgument ‰º†‰∏Ä‰∏™ Bundle ËøõÊù•„ÄÇ ËÆæÁΩÆÂ∏ÉÂ±Ä&amp;ÂàùÂßãÂåñÊéß‰ª∂ÁöÑÊó∂Êú∫‰∏çÂêåActivity#onCreate Fragment#onCreateView ÂéüÁêÜ Ê≥®: FragmentManagerImpl ÂÆö‰πâÂú® FragmentManagerÁöÑÁ±ªÊñá‰ª∂ÈáåÈù¢ÔºåÁõ¥Êé•ÊêúÂè™ËÉΩÁúãÂà∞ .class,Êâæ‰∏çÂà∞ .java Êñá‰ª∂ Ëµ∑ÂßãÔºöÊü•ÊâæÊüê‰∏Ä‰∏™Á±ªÂè™ÁúãÂà∞ .classÊñá‰ª∂ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ÂÖàÁúãÁúã .class ÔºåÂÆÉÁªßÊâø/ÂÆûÁé∞‰∫ÜÂì™‰∫õÁ±ªÔºåÁÑ∂ÂêéÂà∞Áà∂Á±ªÈÇ£ÈáåÂéªÊâæÔºå‰∏ÄËà¨ÈÉΩÂèØ‰ª•ÊâæÂà∞ Êàë‰ª¨Â∏∏ÁúãÂà∞ËØ¥ Fragment ÁöÑÁîüÂëΩÂë®Êúü‰ºö‰∏éÂÆø‰∏ªActivity ‰øùÊåÅ‰∏ÄËá¥ÔºåÈáåÈù¢Á©∂Á´üÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑÂë¢Ôºü Fragment ÁöÑÁîüÂëΩÂë®Êúü‰ºöÂú® FragmentActivity ÈáåÈù¢ÁöÑÁîüÂëΩÂë®ÊúüËøõË°åÂõûË∞É ÁîüÂëΩÂë®ÊúüÂõ†‰∏∫ Fragment ‰æùÈôÑ‰∫é ActivityÔºàÁîüÂëΩÂë®ÊúüÁä∂ÊÄÅÁî± Activity ÊéßÂà∂ÔºâÔºåÊâÄ‰ª•Fragment ÁöÑÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÊòØÂú® Activity ÁöÑÁîüÂëΩÂë®ÊúüÊñπÊ≥ï‰πãÂêéÊâçË∞ÉÁî®ÁöÑ„ÄÇ android.app.FragmentManagerImpl#onCreateView() 123456789101112131415public View onCreateView(View parent, String name, Context context, AttributeSet attrs) &#123; //‚Ä¶‚Ä¶ // If we haven't finished entering the CREATED state ourselves yet, // push the inflated child fragment along. This will ensureInflatedFragmentView // at the right phase of the lifecycle so that we will have mView populated // for compliant fragments below. if (mCurState &lt; Fragment.CREATED &amp;&amp; fragment.mFromLayout) &#123; moveToState(fragment, Fragment.CREATED, 0, 0, false); &#125; else &#123; moveToState(fragment); &#125; //‚Ä¶‚Ä¶&#125; Êèê‰∫§‰∫ãÂä°add hide show replaceÂΩìÁÑ∂Êàë‰ª¨Ê≥®ÊÑèÂà∞ hide Âíå showÔºåÂÆÉ‰ª¨ÂÜÖÈÉ®ÂÆûÈôÖ‰∏ä‰∏ç‰ºöË∞ÉÁî® moveToState, Âõ†‰∏∫ hideFragment ÂÆûÈôÖ‰∏äÂ∞±ÂÅö‰∫Ü‰∏â‰ª∂‰∫ãËØ∑Ôºå ËÆæÁΩÆ mHidden ‰∏∫ true fragment.mView.setVisibility(View.GONE); ÈöêËóè fragment ÁöÑ view fragment.onHiddenChanged(true); Ë∞ÉÁî® onHiddenChange showFragment ‰πüÊòØÁ±ª‰ººÔºåÂè™‰∏çËøáË°å‰∏∫Ê≠£Â•ΩÁõ∏Âèç„ÄÇ addFragmentaddFragment ‰ºöÂ∞Ü fragment Ê∑ªÂä†Âà∞ mAdded Âíå mActive Ëøô‰∏§‰∏™ÈõÜÂêàÂΩì‰∏≠ÔºåËøô‰∏§‰∏™ÈõÜÂêàÁª¥Êä§‰∫ÜÂΩìÂâç activity ‰∏≠Áª¥Êä§ÁöÑÂ∑≤ÁªèÊ∑ªÂä†ÁöÑ fragment ÂàóË°®ÂíåÂΩìÂâçÂ§Ñ‰∫éÊ¥ªË∑ÉÁä∂ÊÄÅÁöÑ fragment ÂàóË°®ÔºåÂ¶ÇÊûú fragment ‰Ωç‰∫é mActive ‰∏≠ÔºåÈÇ£‰πàÂΩì activity ÁöÑÁä∂ÊÄÅÂèëÁîüÂèòÂåñÊó∂Ôºåfragment ‰πü‰ºöË∑üÈöèÁùÄÂèëÁîüÂèòÂåñ„ÄÇFragmentManger Â¶Ç‰ΩïÂºïÂØº fragment ÁöÑÁä∂ÊÄÅÂèëÁîüÂèòÂåñÂë¢Ôºü Fragment Áä∂ÊÄÅÂèòËøÅÔºömoveToStateFragment Áä∂ÊÄÅÂèòËøÅÂèëÁîüÂú®Áî®Êà∑‰∏ªÂä®ÂèëËµ∑ transactionÔºåÊàñËÄÖ fragment Ë¢´ add Âà∞ activity ‰πãÂêéË∑üÈöè activity ÁöÑÁîüÂëΩÂë®ÊúüÂèòÂåñ‰∏ÄËµ∑ÂèëÁîüÊîπÂèò„ÄÇÊØèÊ¨°Áä∂ÊÄÅÂèòËøÅÊúÄÁªàÈÉΩ‰ºöËµ∞Âà∞ÂáΩÊï∞ moveToStateÔºåÂ≠óÈù¢ÊÑèÊÄùÊòØÂ∞Ü fragment ËøÅÁßªÂà∞Êñ∞ÁöÑÁä∂ÊÄÅ fragment ÁöÑ state ÂèñÂÄºÔºå‰∏∫ÂâçÈù¢ÊèêÂà∞ÁöÑ‰∏ÉÁßçÁä∂ÊÄÅÔºåÂÖ∂‰∏≠ÊúÄ‰ΩéÂÄºÊòØ INITIALIZING Áä∂ÊÄÅÔºå‰ª£Ë°® fragment ÂàöÂàõÂª∫ÔºåËøòÊú™Ë¢´ addÔºå ÊúÄÈ´òÁä∂ÊÄÅÂÄºÊòØ RESUMED, ‰ª£Ë°® fragment Â§Ñ‰∫éÂâçÂè∞„ÄÇ ÊâÄ‰ª• moveToState ÂÜÖÈÉ®ÂàÜ‰∏§Êù°Á∫øÔºåÁä∂ÊÄÅË∑ÉÂçáÔºåÂíåÁä∂ÊÄÅÈôç‰ΩéÔºåÈáåÈù¢ÂêÑÊúâ‰∏Ä‰∏™ switch Âà§Êñ≠ÔºåÊ≥®ÊÑèÂà∞ switch ÈáåÊØè‰∏™ case ÈÉΩÊ≤°Êúâ breakÔºåËøôÊÑèÂë≥ÁùÄÔºåÁä∂ÊÄÅÂèØ‰ª•ÊåÅÁª≠ÂèòËøÅÔºåÊØîÂ¶Ç‰ªé INITIALIZINGÔºå‰∏ÄÁõ¥Ë∑ÉÂçáÂà∞ RESUMEDÔºåÂ∞ÜÊØè‰∏™ case ÈÉΩËµ∞‰∏ÄÈÅçÔºåÊØèÊ¨° case ËØ≠Âè•ÂÜÖÔºåÈÉΩ‰ºöÊîπÂèò state ÁöÑÂÄº„ÄÇ 1mManager.moveToState(mManager.mCurState, transition, transitionStyle, true); Â∞±ÊòØÂ∞Ü fragment ËøÅÁßªÂà∞ FragmentManager ÂΩìÂâçÁöÑÁä∂ÊÄÅÔºåÂõ†‰∏∫Êàë‰ª¨‰∏çÁü•ÈÅìÁî®Êà∑‰ªÄ‰πàÊó∂ÂÄô add fragmentÔºåÂõ†Ê≠§ fragment Ë¢´ add ‰πãÂêéÔºåÂ∞±Â∞ÜÂÖ∂Áä∂ÊÄÅËøÅÁßªÂà∞ FragmentManager ÂΩìÂâçÁöÑÁä∂ÊÄÅÔºåÁÑ∂ÂêéË∑üÈöè FragmentManager ‰∏ÄËµ∑ÂèëÁîüÁä∂ÊÄÅÂèòËøÅÔºåÈô§ÈùûÁî®Êà∑ÊâãÂä® removeFragment Â∞ÜÂÖ∂‰ªé mActive ÂàóË°®‰∏≠ÁßªÈô§„ÄÇ 1234getSupportFragmentManager() .beginTransaction() .add(,) .commit(); 12345678910111213141516171819202122FragmentManagerImpl#beginTransaction //ÂàõÂª∫‰∏Ä‰∏™ BackStackRecord; --&gt; BackStackRecord#add(Fragment, String) --&gt; BackStackRecord#doAddOp --&gt; //ËøõË°åËÆøÈóÆÊéßÂà∂Ê£ÄÊü•ÔºåÂ¶ÇÊûú Fragment ÊòØ‰∏Ä‰∏™ÊàêÂëòÁ±ªÔºåÈÇ£‰πàÂÆÉÂøÖÈ°ªÊòØ public static ÁöÑÔºåËøôÊ†∑ÊâçËÉΩÊ≠£Á°ÆÂú∞‰ªéÂÆû‰æãÁä∂ÊÄÅ‰∏≠ÈáçÊñ∞ÂàõÂª∫Âá∫Êù• Áªô mFragmentManager„ÄÅ mTag „ÄÅmContainerId ËµãÂÄº ÂàõÂª∫ Op ÂØπË±°Âπ∂Ê∑ªÂä†Âà∞ Ops Ôºà‰∏Ä‰∏™ ArrayListÔºâ ‰∏≠ --&gt; BackStackRecord#commit --&gt; BackStackRecord#commitInternal if mAddToBackStack //Ê∑ªÂä†Âà∞ÂõûÈÄÄÊ†à‰∏≠ mIndex = mManager.allocBackStackIndex(this);//ÂàÜÈÖçÂõûÈÄÄÊ†à‰∏ãÊ†á --&gt; ‰∏ªË¶ÅÂØπ‰∏ãÈù¢‰∏§‰∏™ÂàóË°®ËøõË°åÊìç‰Ωú ArrayList&lt;BackStackRecord&gt; mBackStackIndices; ArrayList&lt;Integer&gt; mAvailBackStackIndices; else mIndex = -1; --&gt; FragmentManagerImpl#enqueueAction//Âú®Á≠âÂæÖÊìç‰ΩúÁöÑÈòüÂàó‰∏≠Ê∑ªÂä†‰∏Ä‰∏™Êìç‰Ωú„ÄÇ --&gt; mPendingActions.add(action);//Ê∑ªÂä†Âà∞„ÄåÈòüÂàó‰∏≠„Äç ÔºàÂÆûÈôÖ‰∏äÊòØ‰∏Ä‰∏™ ArrayListÔºâ --&gt; scheduleCommit();//ÂÆâÊéí commit --&gt; ÂÜÖÈÉ®ÈÄöËøá Handler Êù•ÂÆûÁé∞ ÊâßË°åÁöÑÊòØ mExecCommit Ôºà‰∏Ä‰∏™ RunnableÔºâ --&gt; FragmentManagerImpl#execPendingActions FragmentManagerImpl#execPendingActions //Âè™ËÉΩ‰ªé‰∏ªÁ∫øÁ®ãË∞ÉÁî® 12345678910111213141516171819public boolean execPendingActions() &#123; ensureExecReady(true); boolean didSomething = false; while (generateOpsForPendingActions(mTmpRecords, mTmpIsPop)) &#123; mExecutingActions = true; try &#123; optimizeAndExecuteOps(mTmpRecords, mTmpIsPop); &#125; finally &#123; cleanupExec(); &#125; didSomething = true; &#125; doPendingDeferredStart(); burpActive(); return didSomething;&#125; ÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÂõûË∞ÉFragment ÁöÑÂêÑ‰∏™ÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÂõûË∞ÉÈÉΩÊòØÈÄöËøáfragment.app.FragmentManagerImpl#moveToState ÊñπÊ≥ïÂàÜÂèëÂá∫Êù•ÁöÑ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310@SuppressWarnings("ReferenceEquality")void moveToState(Fragment f, int newState, int transit, int transitionStyle, boolean keepActive) &#123; // Fragments that are not currently added will sit in the onCreate() state. if ((!f.mAdded || f.mDetached) &amp;&amp; newState &gt; Fragment.CREATED) &#123; newState = Fragment.CREATED; &#125; if (f.mRemoving &amp;&amp; newState &gt; f.mState) &#123; if (f.mState == Fragment.INITIALIZING &amp;&amp; f.isInBackStack()) &#123; // Allow the fragment to be created so that it can be saved later. newState = Fragment.CREATED; &#125; else &#123; // While removing a fragment, we can't change it to a higher state. newState = f.mState; &#125; &#125; // Defer start if requested; don't allow it to move to STARTED or higher // if it's not already started. if (f.mDeferStart &amp;&amp; f.mState &lt; Fragment.STARTED &amp;&amp; newState &gt; Fragment.ACTIVITY_CREATED) &#123; newState = Fragment.ACTIVITY_CREATED; &#125; if (f.mState &lt;= newState) &#123; // For fragments that are created from a layout, when restoring from // state we don't want to allow them to be created until they are // being reloaded from the layout. if (f.mFromLayout &amp;&amp; !f.mInLayout) &#123; return; &#125; if (f.getAnimatingAway() != null || f.getAnimator() != null) &#123; // The fragment is currently being animated... but! Now we // want to move our state back up. Give up on waiting for the // animation, move to whatever the final state should be once // the animation is done, and then we can proceed from there. f.setAnimatingAway(null); f.setAnimator(null); moveToState(f, f.getStateAfterAnimating(), 0, 0, true); &#125; switch (f.mState) &#123; case Fragment.INITIALIZING: //Êñ∞Áä∂ÊÄÅÂ§ß‰∫é ÂàùÂßãÂåñÁä∂ÊÄÅ if (newState &gt; Fragment.INITIALIZING) &#123; if (DEBUG) Log.v(TAG, "moveto CREATED: " + f); if (f.mSavedFragmentState != null) &#123; f.mSavedFragmentState.setClassLoader(mHost.getContext() .getClassLoader()); f.mSavedViewState = f.mSavedFragmentState.getSparseParcelableArray( FragmentManagerImpl.VIEW_STATE_TAG); f.mTarget = getFragment(f.mSavedFragmentState, FragmentManagerImpl.TARGET_STATE_TAG); if (f.mTarget != null) &#123; f.mTargetRequestCode = f.mSavedFragmentState.getInt( FragmentManagerImpl.TARGET_REQUEST_CODE_STATE_TAG, 0); &#125; if (f.mSavedUserVisibleHint != null) &#123; f.mUserVisibleHint = f.mSavedUserVisibleHint; f.mSavedUserVisibleHint = null; &#125; else &#123; f.mUserVisibleHint = f.mSavedFragmentState.getBoolean( FragmentManagerImpl.USER_VISIBLE_HINT_TAG, true); &#125; if (!f.mUserVisibleHint) &#123; f.mDeferStart = true; if (newState &gt; Fragment.ACTIVITY_CREATED) &#123; newState = Fragment.ACTIVITY_CREATED; &#125; &#125; &#125; f.mHost = mHost; f.mParentFragment = mParent; f.mFragmentManager = mParent != null ? mParent.mChildFragmentManager : mHost.getFragmentManagerImpl(); // If we have a target fragment, push it along to at least CREATED // so that this one can rely on it as an initialized dependency. if (f.mTarget != null) &#123; if (mActive.get(f.mTarget.mIndex) != f.mTarget) &#123; throw new IllegalStateException("Fragment " + f + " declared target fragment " + f.mTarget + " that does not belong to this FragmentManager!"); &#125; if (f.mTarget.mState &lt; Fragment.CREATED) &#123; moveToState(f.mTarget, Fragment.CREATED, 0, 0, true); &#125; &#125; dispatchOnFragmentPreAttached(f, mHost.getContext(), false); f.mCalled = false; //ÂõûË∞É onAttach ÊñπÊ≥ï f.onAttach(mHost.getContext()); if (!f.mCalled) &#123; throw new SuperNotCalledException("Fragment " + f + " did not call through to super.onAttach()"); &#125; if (f.mParentFragment == null) &#123; mHost.onAttachFragment(f); &#125; else &#123; f.mParentFragment.onAttachFragment(f); &#125; // dispatchOnFragmentAttached(f, mHost.getContext(), false); if (!f.mIsCreated) &#123; dispatchOnFragmentPreCreated(f, f.mSavedFragmentState, false); //ÂõûË∞É Fragment#onCreate f.performCreate(f.mSavedFragmentState); dispatchOnFragmentCreated(f, f.mSavedFragmentState, false); &#125; else &#123; //ÊÅ¢Â§çÁä∂ÊÄÅ f.restoreChildFragmentState(f.mSavedFragmentState); f.mState = Fragment.CREATED; &#125; f.mRetaining = false; &#125; // fall through case Fragment.CREATED: // This is outside the if statement below on purpose; we want this to run // even if we do a moveToState from CREATED =&gt; *, CREATED =&gt; CREATED, and // * =&gt; CREATED as part of the case fallthrough above. ensureInflatedFragmentView(f); if (newState &gt; Fragment.CREATED) &#123; if (DEBUG) Log.v(TAG, "moveto ACTIVITY_CREATED: " + f); if (!f.mFromLayout) &#123; ViewGroup container = null; if (f.mContainerId != 0) &#123; if (f.mContainerId == View.NO_ID) &#123; throwException(new IllegalArgumentException( "Cannot create fragment " + f + " for a container view with no id")); &#125; //Êü•Êâæ container ÂÆû‰æã container = (ViewGroup) mContainer.onFindViewById(f.mContainerId); if (container == null &amp;&amp; !f.mRestored) &#123; String resName; try &#123; resName = f.getResources().getResourceName(f.mContainerId); &#125; catch (NotFoundException e) &#123; resName = "unknown"; &#125; throwException(new IllegalArgumentException( "No view found for id 0x" + Integer.toHexString(f.mContainerId) + " (" + resName + ") for fragment " + f)); &#125; &#125; f.mContainer = container; //ÂõûË∞É onCreateViewÔºåÂêåÊó∂‰∏∫ Fragment#mView ÊàêÂëòÂèòÈáèËµãÂÄº f.performCreateView(f.performGetLayoutInflater( f.mSavedFragmentState), container, f.mSavedFragmentState); if (f.mView != null) &#123; f.mInnerView = f.mView; f.mView.setSaveFromParentEnabled(false); if (container != null) &#123; container.addView(f.mView); &#125; if (f.mHidden) &#123; f.mView.setVisibility(View.GONE); &#125; //ÂõûË∞É fragment#onViewCreated f.onViewCreated(f.mView, f.mSavedFragmentState); dispatchOnFragmentViewCreated(f, f.mView, f.mSavedFragmentState, false); // Only animate the view if it is visible. This is done after // dispatchOnFragmentViewCreated in case visibility is changed f.mIsNewlyAdded = (f.mView.getVisibility() == View.VISIBLE) &amp;&amp; f.mContainer != null; &#125; else &#123; f.mInnerView = null; &#125; &#125; f.performActivityCreated(f.mSavedFragmentState); dispatchOnFragmentActivityCreated(f, f.mSavedFragmentState, false); if (f.mView != null) &#123; f.restoreViewState(f.mSavedFragmentState); &#125; f.mSavedFragmentState = null; &#125; // fall through case Fragment.ACTIVITY_CREATED: if (newState &gt; Fragment.ACTIVITY_CREATED) &#123; if (DEBUG) Log.v(TAG, "moveto STARTED: " + f); f.performStart(); dispatchOnFragmentStarted(f, false); &#125; // fall through case Fragment.STARTED: if (newState &gt; Fragment.STARTED) &#123; if (DEBUG) Log.v(TAG, "moveto RESUMED: " + f); f.performResume(); dispatchOnFragmentResumed(f, false); f.mSavedFragmentState = null; f.mSavedViewState = null; &#125; &#125; &#125; else if (f.mState &gt; newState) &#123; switch (f.mState) &#123; case Fragment.RESUMED: if (newState &lt; Fragment.RESUMED) &#123; if (DEBUG) Log.v(TAG, "movefrom RESUMED: " + f); f.performPause(); dispatchOnFragmentPaused(f, false); &#125; // fall through case Fragment.STARTED: if (newState &lt; Fragment.STARTED) &#123; if (DEBUG) Log.v(TAG, "movefrom STARTED: " + f); f.performStop(); dispatchOnFragmentStopped(f, false); &#125; // fall through case Fragment.ACTIVITY_CREATED: if (newState &lt; Fragment.ACTIVITY_CREATED) &#123; if (DEBUG) Log.v(TAG, "movefrom ACTIVITY_CREATED: " + f); if (f.mView != null) &#123; // Need to save the current view state if not // done already. if (mHost.onShouldSaveFragmentState(f) &amp;&amp; f.mSavedViewState == null) &#123; saveFragmentViewState(f); &#125; &#125; f.performDestroyView(); dispatchOnFragmentViewDestroyed(f, false); if (f.mView != null &amp;&amp; f.mContainer != null) &#123; // Stop any current animations: f.mContainer.endViewTransition(f.mView); f.mView.clearAnimation(); AnimationOrAnimator anim = null; if (mCurState &gt; Fragment.INITIALIZING &amp;&amp; !mDestroyed &amp;&amp; f.mView.getVisibility() == View.VISIBLE &amp;&amp; f.mPostponedAlpha &gt;= 0) &#123; anim = loadAnimation(f, transit, false, transitionStyle); &#125; f.mPostponedAlpha = 0; if (anim != null) &#123; animateRemoveFragment(f, anim, newState); &#125; f.mContainer.removeView(f.mView); &#125; f.mContainer = null; f.mView = null; // Set here to ensure that Observers are called after // the Fragment's view is set to null f.mViewLifecycleOwner = null; f.mViewLifecycleOwnerLiveData.setValue(null); f.mInnerView = null; f.mInLayout = false; &#125; // fall through case Fragment.CREATED: if (newState &lt; Fragment.CREATED) &#123; if (mDestroyed) &#123; // The fragment's containing activity is // being destroyed, but this fragment is // currently animating away. Stop the // animation right now -- it is not needed, // and we can't wait any more on destroying // the fragment. if (f.getAnimatingAway() != null) &#123; View v = f.getAnimatingAway(); f.setAnimatingAway(null); v.clearAnimation(); &#125; else if (f.getAnimator() != null) &#123; Animator animator = f.getAnimator(); f.setAnimator(null); animator.cancel(); &#125; &#125; if (f.getAnimatingAway() != null || f.getAnimator() != null) &#123; // We are waiting for the fragment's view to finish // animating away. Just make a note of the state // the fragment now should move to once the animation // is done. f.setStateAfterAnimating(newState); newState = Fragment.CREATED; &#125; else &#123; if (DEBUG) Log.v(TAG, "movefrom CREATED: " + f); if (!f.mRetaining) &#123; f.performDestroy(); dispatchOnFragmentDestroyed(f, false); &#125; else &#123; f.mState = Fragment.INITIALIZING; &#125; f.performDetach(); dispatchOnFragmentDetached(f, false); if (!keepActive) &#123; if (!f.mRetaining) &#123; makeInactive(f); &#125; else &#123; f.mHost = null; f.mParentFragment = null; f.mFragmentManager = null; &#125; &#125; &#125; &#125; &#125; &#125; if (f.mState != newState) &#123; Log.w(TAG, "moveToState: Fragment state for " + f + " not updated inline; " + "expected state " + newState + " found " + f.mState); f.mState = newState; &#125;&#125; getChildFragmentManagermChildFragmentManager ÁöÑÂÆûÈôÖÁ±ªÂûã‰πüÊòØ‰∏Ä‰∏™ FragmentManager Ôºå attachController ÁöÑÊó∂ÂÄôÔºå‰ºöÂ∞Ü ÂΩìÂâç Fragment ‰º†ÈÄíÁªô parent ÂèÇÊï∞ 1234567public void attachController(FragmentHostCallback host, FragmentContainer container, Fragment parent) &#123; if (mHost != null) throw new IllegalStateException(&quot;Already attached&quot;); mHost = host; mContainer = container; mParent = parent;&#125; ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê https://www.jianshu.com/p/180d2cc0feb5 Fragment | Android Developers Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Http Â§¥ÈÉ®Â≠óÊÆµ]]></title>
    <url>%2Fblog%2F2018%2F03%2F02%2FHttp-%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5%2F</url>
    <content type="text"><![CDATA[HTTP Êä•ÊñáÊ†ºÂºè HTTP ËØ∑Ê±ÇÊä•ÊñáÂú®ËØ∑Ê±Ç‰∏≠ÔºåHTTP Êä•ÊñáÁî±ÊñπÊ≥ï„ÄÅURI„ÄÅHTTP ÁâàÊú¨„ÄÅHTTP È¶ñÈÉ®Â≠óÊÆµÁ≠âÈÉ®ÂàÜÊûÑÊàê„ÄÇ ‰ΩøÁî®È¶ñÈÉ®Â≠óÊÆµÊòØ‰∏∫‰∫ÜÁªôÊµèËßàÂô®ÂíåÊúçÂä°Âô®Êèê‰æõÊä•Êñá‰∏ª‰ΩìÂ§ßÂ∞è„ÄÅÊâÄ‰ΩøÁî®ÁöÑËØ≠Ë®Ä„ÄÅËÆ§ËØÅ‰ø°ÊÅØÁ≠âÂÜÖÂÆπ„ÄÇ HTTP ÂìçÂ∫îÊä•ÊñáÂú®ÂìçÂ∫î‰∏≠ÔºåHTTP Êä•ÊñáÁî± HTTP ÁâàÊú¨„ÄÅÁä∂ÊÄÅÁ†ÅÔºàÊï∞Â≠óÂíåÂéüÂõ†Áü≠ËØ≠Ôºâ„ÄÅHTTP È¶ñÈÉ®Â≠óÊÆµ 3 ÈÉ®ÂàÜÊûÑÊàê„ÄÇ HTTP È¶ñÈÉ®Â≠óÊÆµÈ¶ñÈÉ®ÂíåÊñπÊ≥ïÈÖçÂêàÂ∑•‰ΩúÔºåÂÖ±ÂêåÂÜ≥ÂÆö‰∫ÜÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®ËÉΩÂÅö‰ªÄ‰πà‰∫ãÊÉÖ„ÄÇ Âú®ËØ∑Ê±ÇÂíåÂìçÂ∫îÊä•Êñá‰∏≠ÈÉΩÂèØ‰ª•Áî®È¶ñÈÉ®Êù•Êèê‰æõ‰ø°ÊÅØÔºåÊúâ‰∫õÈ¶ñÈÉ®ÊòØÊüêÁßçÊä•Êñá‰∏ìÁî®ÁöÑÔºåÊúâ‰∫õÈ¶ñÈÉ®ÂàôÊõ¥ÈÄöÁî®‰∏Ä‰∫õ„ÄÇÂèØ‰ª•Â∞ÜÈ¶ñÈÉ®ÂàÜ‰∏∫‰∫î‰∏™‰∏ªË¶ÅÁöÑÁ±ªÂûã„ÄÇ ÈÄöÁî®È¶ñÈÉ®Â≠óÊÆµÈÄöÁî®È¶ñÈÉ®Â≠óÊÆµÊòØÊåáÔºåËØ∑Ê±ÇÊä•ÊñáÂíåÂìçÂ∫îÊä•ÊñáÂèåÊñπÈÉΩ‰ºö‰ΩøÁî®ÁöÑÈ¶ñÈÉ®„ÄÇ È¶ñÈÉ®Â≠óÊÆµÂêç ËØ¥Êòé Cache-Control ÊéßÂà∂ÁºìÂ≠òÁöÑË°å‰∏∫ Connection ÈÄêË∑≥È¶ñÈÉ®„ÄÅËøûÊé•ÁöÑÁÆ°ÁêÜ Date ÂàõÂª∫Êä•ÊñáÁöÑÊó•ÊúüÊó∂Èó¥ Pragma Êä•ÊñáÊåá‰ª§ Trailer Êä•ÊñáÊú´Á´ØÁöÑÈ¶ñÈÉ®‰∏ÄËßà Transfer-Encoding ÊåáÂÆöÊä•Êñá‰∏ª‰ΩìÁöÑ‰º†ËæìÁºñÁ†ÅÊñπÂºè Upgrade ÂçáÁ∫ß‰∏∫ÂÖ∂‰ªñÂçèËÆÆ Via ‰ª£ÁêÜÊúçÂä°Âô®ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ Warning ÈîôËØØÈÄöÁü• Cache-ControlÈÄöËøáÊåáÂÆöÈ¶ñÈÉ®Â≠óÊÆµ Cache-Control ÁöÑÊåá‰ª§ÔºåÂ∞±ËÉΩÊìç‰ΩúÁºìÂ≠òÁöÑÂ∑•‰ΩúÊú∫Âà∂„ÄÇ Cache-Control: private, max-age=0, no-cache Êåá‰ª§ÁöÑÂèÇÊï∞ÊòØÂèØÈÄâÁöÑÔºåÂ§ö‰∏™Êåá‰ª§‰πãÈó¥ÈÄöËøá‚Äú,‚ÄùÂàÜÈöî„ÄÇÈ¶ñÈÉ®Â≠óÊÆµ CacheControl ÁöÑÊåá‰ª§ÂèØÁî®‰∫éËØ∑Ê±ÇÂèäÂìçÂ∫îÊó∂„ÄÇ ÁºìÂ≠òËØ∑Ê±ÇÊåá‰ª§ Êåá‰ª§ ÂèÇÊï∞ ËØ¥Êòé no-cache Êó† Âº∫Âà∂ÂêëÊ∫êÊúçÂä°Âô®ÂÜçÊ¨°È™åËØÅ no-store Êó† ‰∏çÁºìÂ≠òËØ∑Ê±ÇÊàñÂìçÂ∫îÁöÑ‰ªª‰ΩïÂÜÖÂÆπ max-age = [ Áßí] ÂøÖÈúÄ ÂìçÂ∫îÁöÑÊúÄÂ§ßAgeÂÄº max-stale( = [ Áßí]) ÂèØÁúÅÁï• Êé•Êî∂Â∑≤ËøáÊúüÁöÑÂìçÂ∫î min-fresh = [ Áßí] ÂøÖÈúÄ ÊúüÊúõÂú®ÊåáÂÆöÊó∂Èó¥ÂÜÖÁöÑÂìçÂ∫î‰ªçÊúâÊïà no-transform Êó† ‰ª£ÁêÜ‰∏çÂèØÊõ¥ÊîπÂ™í‰ΩìÁ±ªÂûã only-if-cached Êó† ‰ªéÁºìÂ≠òËé∑ÂèñËµÑÊ∫ê cache-extension - Êñ∞Êåá‰ª§Ê†áËÆ∞ÔºàtokenÔºâ Êç¢Ë®Ä‰πãÔºåÊó†ÂèÇÊï∞ÂÄºÁöÑÈ¶ñÈÉ®Â≠óÊÆµÂèØ‰ª•‰ΩøÁî®ÁºìÂ≠ò„ÄÇ ‰ªéÂ≠óÈù¢ÊÑèÊÄù‰∏äÂæàÂÆπÊòìÊää no-cache ËØØËß£Êàê‰∏∫‰∏çÁºìÂ≠òÔºå‰ΩÜ‰∫ãÂÆû‰∏ä no-cache ‰ª£Ë°®‰∏çÁºìÂ≠òËøáÊúüÁöÑËµÑÊ∫êÔºåÁºìÂ≠ò‰ºöÂêëÊ∫êÊúçÂä°Âô®ËøõË°åÊúâÊïàÊúüÁ°ÆËÆ§ÂêéÂ§ÑÁêÜËµÑÊ∫êÔºå‰πüËÆ∏Áß∞‰∏∫ do-notserve-from-cache-without-revalidationÊõ¥ÂêàÈÄÇ„ÄÇno-storeÊâçÊòØÁúüÊ≠£Âú∞‰∏çËøõË°åÁºìÂ≠òÔºå max-age‰ΩøÁî® HTTP/1.1 ÁâàÊú¨ÁöÑÁºìÂ≠òÊúçÂä°Âô®ÈÅáÂà∞ÂêåÊó∂Â≠òÂú® Expires È¶ñÈÉ®Â≠óÊÆµÁöÑÊÉÖÂÜµÊó∂Ôºå‰ºö‰ºòÂÖàÂ§ÑÁêÜ max-age Êåá‰ª§ÔºåËÄåÂøΩÁï•Êéâ Expires È¶ñÈÉ®Â≠óÊÆµ„ÄÇËÄåHTTP/1.0 ÁâàÊú¨ÁöÑÁºìÂ≠òÊúçÂä°Âô®ÁöÑÊÉÖÂÜµÂç¥Áõ∏ÂèçÔºåmax-age Êåá‰ª§‰ºöË¢´ÂøΩÁï•Êéâ only-if-cached Êåá‰ª§Cache-Control: only-if-cached‰ΩøÁî® only-if-cached Êåá‰ª§Ë°®Á§∫ÂÆ¢Êà∑Á´Ø‰ªÖÂú®ÁºìÂ≠òÊúçÂä°Âô®Êú¨Âú∞ÁºìÂ≠òÁõÆÊ†áËµÑÊ∫êÁöÑÊÉÖÂÜµ‰∏ãÊâç‰ºöË¶ÅÊ±ÇÂÖ∂ËøîÂõû„ÄÇÊç¢Ë®Ä‰πãÔºåËØ•Êåá‰ª§Ë¶ÅÊ±ÇÁºìÂ≠òÊúçÂä°Âô®‰∏çÈáçÊñ∞Âä†ËΩΩÂìçÂ∫îÔºå‰πü‰∏ç‰ºöÂÜçÊ¨°Á°ÆËÆ§ËµÑÊ∫êÊúâÊïàÊÄß„ÄÇËã•ÂèëÁîüËØ∑Ê±ÇÁºìÂ≠òÊúçÂä°Âô®ÁöÑÊú¨Âú∞ÁºìÂ≠òÊó†ÂìçÂ∫îÔºåÂàôËøîÂõûÁä∂ÊÄÅÁ†Å 504 Gateway Timeout„ÄÇ 123This field&apos;s name &quot;only-if-cached&quot; is misleading. It actually means &quot;do not use the network&quot;. It is set by a client who only wants to make a request if it can be fully satisfied by the cache. Cached responses that would require validation (ie. conditional gets) are not permitted if this header is set.ËØ•Â≠óÊÆµÂêçÊúâËØØÂØºÊÄß„ÄÇÂÆûÈôÖÊÑè‰πâÊòØ„Äå‰∏çË¶Å‰ΩøÁî®ÁΩëÁªú„Äç„ÄÇÂÆÉÁî±‰∏Ä‰∏™Âè™ÊúâÂú®ÁºìÂ≠òËÉΩÂ§üÂÆåÂÖ®Êª°Ë∂≥ÈúÄÊ±ÇÁöÑÊÉÖÂÜµ‰∏ãÊâçÊÉ≥ÂèëÂá∫ËØ∑Ê±ÇÁöÑÂÆ¢Êà∑Á´Ø„ÄÇÂ¶ÇÊûúËÆæÁΩÆ‰∫ÜËØ• headerÔºåÂàô‰∏çÂÖÅËÆ∏‰ΩøÁî®ÈúÄË¶ÅÈ™åËØÅÁöÑÁºìÂ≠òÂìçÂ∫îÔºà ÊØîÂ¶Ç„ÄÇÊù°‰ª∂ get ËØ∑Ê±ÇÔºâ„ÄÇ ËØ∑Ê±ÇÈ¶ñÈÉ®Â≠óÊÆµ È¶ñÈÉ®Â≠óÊÆµÂêç ËØ¥Êòé Accept Áî®Êà∑‰ª£ÁêÜÂèØÂ§ÑÁêÜÁöÑÂ™í‰ΩìÁ±ªÂûã Accept-Charset ‰ºòÂÖàÁöÑÂ≠óÁ¨¶ÈõÜ Accept-Encoding ‰ºòÂÖàÁöÑÂÜÖÂÆπÁºñÁ†Å Accept-Language ‰ºòÂÖàÁöÑËØ≠Ë®ÄÔºàËá™ÁÑ∂ËØ≠Ë®ÄÔºâ Authorization WebËÆ§ËØÅ‰ø°ÊÅØ Expect ÊúüÂæÖÊúçÂä°Âô®ÁöÑÁâπÂÆöË°å‰∏∫ From Áî®Êà∑ÁöÑÁîµÂ≠êÈÇÆÁÆ±Âú∞ÂùÄ Host ËØ∑Ê±ÇËµÑÊ∫êÊâÄÂú®ÊúçÂä°Âô® If-Match ÊØîËæÉÂÆû‰ΩìÊ†áËÆ∞ÔºàETagÔºâ If-Modified-Since ÊØîËæÉËµÑÊ∫êÁöÑÊõ¥Êñ∞Êó∂Èó¥ If-None-Match ÊØîËæÉÂÆû‰ΩìÊ†áËÆ∞Ôºà‰∏é If-Match Áõ∏ÂèçÔºâ If-Range ËµÑÊ∫êÊú™Êõ¥Êñ∞Êó∂ÂèëÈÄÅÂÆû‰Ωì Byte ÁöÑËåÉÂõ¥ËØ∑Ê±Ç If-Unmodified-Since ÊØîËæÉËµÑÊ∫êÁöÑÊõ¥Êñ∞Êó∂Èó¥Ôºà‰∏éIf-Modified-SinceÁõ∏ÂèçÔºâ Max-Forwards ÊúÄÂ§ß‰º†ËæìÈÄêË∑≥Êï∞ Proxy-Authorization ‰ª£ÁêÜÊúçÂä°Âô®Ë¶ÅÊ±ÇÂÆ¢Êà∑Á´ØÁöÑËÆ§ËØÅ‰ø°ÊÅØ Range ÂÆû‰ΩìÁöÑÂ≠óËäÇËåÉÂõ¥ËØ∑Ê±Ç Referer ÂØπËØ∑Ê±Ç‰∏≠ URI ÁöÑÂéüÂßãËé∑ÂèñÊñπ TE ‰º†ËæìÁºñÁ†ÅÁöÑ‰ºòÂÖàÁ∫ß User-Agent HTTP ÂÆ¢Êà∑Á´ØÁ®ãÂ∫èÁöÑ‰ø°ÊÅØ ÂìçÂ∫îÈ¶ñÈÉ®Â≠óÊÆµ È¶ñÈÉ®Â≠óÊÆµÂêç ËØ¥Êòé Accept-Ranges ÊòØÂê¶Êé•ÂèóÂ≠óËäÇËåÉÂõ¥ËØ∑Ê±Ç Age Êé®ÁÆóËµÑÊ∫êÂàõÂª∫ÁªèËøáÊó∂Èó¥ ETag ËµÑÊ∫êÁöÑÂåπÈÖç‰ø°ÊÅØ Location ‰ª§ÂÆ¢Êà∑Á´ØÈáçÂÆöÂêëËá≥ÊåáÂÆöURI Proxy-Authenticate ‰ª£ÁêÜÊúçÂä°Âô®ÂØπÂÆ¢Êà∑Á´ØÁöÑËÆ§ËØÅ‰ø°ÊÅØ Retry-After ÂØπÂÜçÊ¨°ÂèëËµ∑ËØ∑Ê±ÇÁöÑÊó∂Êú∫Ë¶ÅÊ±Ç Server HTTPÊúçÂä°Âô®ÁöÑÂÆâË£Ö‰ø°ÊÅØ Vary ‰ª£ÁêÜÊúçÂä°Âô®ÁºìÂ≠òÁöÑÁÆ°ÁêÜ‰ø°ÊÅØ WWW-Authenticate ÊúçÂä°Âô®ÂØπÂÆ¢Êà∑Á´ØÁöÑËÆ§ËØÅ‰ø°ÊÅØ vary È¶ñÈÉ®Â≠óÊÆµ Vary ÂèØÂØπÁºìÂ≠òËøõË°åÊéßÂà∂„ÄÇÊ∫êÊúçÂä°Âô®‰ºöÂêë‰ª£ÁêÜÊúçÂä°Âô®‰º†ËææÂÖ≥‰∫éÊú¨Âú∞ÁºìÂ≠ò‰ΩøÁî®ÊñπÊ≥ïÁöÑÂëΩ‰ª§„ÄÇ ‰ªé‰ª£ÁêÜÊúçÂä°Âô®Êé•Êî∂Âà∞Ê∫êÊúçÂä°Âô®ËøîÂõûÂåÖÂê´ Vary ÊåáÂÆöÈ°πÁöÑÂìçÂ∫î‰πãÂêéÔºåËã•ÂÜçË¶ÅËøõË°åÁºìÂ≠òÔºå‰ªÖÂØπËØ∑Ê±Ç‰∏≠Âê´ÊúâÁõ∏Âêå Vary ÊåáÂÆöÈ¶ñÈÉ®Â≠óÊÆµÁöÑËØ∑Ê±ÇËøîÂõûÁºìÂ≠ò„ÄÇÂç≥‰ΩøÂØπÁõ∏ÂêåËµÑÊ∫êÂèëËµ∑ËØ∑Ê±ÇÔºå‰ΩÜÁî±‰∫é Vary ÊåáÂÆöÁöÑÈ¶ñÈÉ®Â≠óÊÆµ‰∏çÁõ∏ÂêåÔºåÂõ†Ê≠§ÂøÖÈ°ªË¶Å‰ªéÊ∫êÊúçÂä°Âô®ÈáçÊñ∞Ëé∑ÂèñËµÑÊ∫ê„ÄÇ ÂÆû‰ΩìÈ¶ñÈÉ®Â≠óÊÆµÂÆû‰ΩìÈ¶ñÈÉ®Â≠óÊÆµÊòØÂåÖÂê´Âú®ËØ∑Ê±ÇÊä•ÊñáÂíåÂìçÂ∫îÊä•Êñá‰∏≠ÁöÑÂÆû‰ΩìÈÉ®ÂàÜÊâÄ‰ΩøÁî®ÁöÑÈ¶ñÈÉ®ÔºåÁî®‰∫éË°•ÂÖÖÂÜÖÂÆπÁöÑÊõ¥Êñ∞Êó∂Èó¥Á≠â‰∏éÂÆû‰ΩìÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØ„ÄÇ ÊúâÂæàÂ§öÈ¶ñÈÉ®ÂèØ‰ª•Áî®Êù•ÊèèËø∞ HTTP Êä•ÊñáÁöÑË¥üËç∑„ÄÇ ÂÆû‰ΩìÈ¶ñÈÉ®Êèê‰æõ‰∫ÜÊúâÂÖ≥ÂÆû‰ΩìÂèäÂÖ∂ÂÜÖÂÆπÁöÑÂ§ßÈáè‰ø°ÊÅØÔºå‰ªéÊúâÂÖ≥ÂØπË±°Á±ªÂûãÁöÑ‰ø°ÊÅØÔºåÂà∞ËÉΩÂ§üÂØπËµÑÊ∫ê‰ΩøÁî®ÁöÑÂêÑÁßçÊúâÊïàÁöÑËØ∑Ê±ÇÊñπÊ≥ï„ÄÇÊÄª‰πãÔºåÂÆû‰ΩìÈ¶ñÈÉ®ÂèØ‰ª•ÂëäÁü•Êä•ÊñáÁöÑÊé•Êî∂ËÄÖÂÆÉÂú®ÂØπ‰ªÄ‰πàËøõË°åÂ§ÑÁêÜ„ÄÇ‰∏ãË°®‰∏≠ ÂàóÂá∫‰∫ÜÂÆû‰ΩìÁöÑ‰ø°ÊÅØÊÄßÈ¶ñÈÉ®„ÄÇ È¶ñÈÉ®Â≠óÊÆµÂêç ËØ¥Êòé Allow ËµÑÊ∫êÂèØÊîØÊåÅÁöÑHTTPÊñπÊ≥ï Content-Encoding ÂÆû‰Ωì‰∏ª‰ΩìÈÄÇÁî®ÁöÑÁºñÁ†ÅÊñπÂºè Content-Language ÂÆû‰Ωì‰∏ª‰ΩìÁöÑËá™ÁÑ∂ËØ≠Ë®Ä Content-Length ÂÆû‰Ωì‰∏ª‰ΩìÁöÑÂ§ßÂ∞èÔºàÂçï‰ΩçÔºöÂ≠óËäÇÔºâ Content-Location Êõø‰ª£ÂØπÂ∫îËµÑÊ∫êÁöÑURI Content-MD5 ÂÆû‰Ωì‰∏ª‰ΩìÁöÑÊä•ÊñáÊëòË¶Å Content-Range ÂÆû‰Ωì‰∏ª‰ΩìÁöÑ‰ΩçÁΩÆËåÉÂõ¥ Content-Type ÂÆû‰Ωì‰∏ª‰ΩìÁöÑÂ™í‰ΩìÁ±ªÂûã Expires ÂÆû‰Ωì‰∏ª‰ΩìËøáÊúüÁöÑÊó•ÊúüÊó∂Èó¥ Last-Modified ËµÑÊ∫êÁöÑÊúÄÂêé‰øÆÊîπÊó•ÊúüÊó∂Èó¥ Êâ©Â±ïÈ¶ñÈÉ®Êâ©Â±ïÈ¶ñÈÉ®ÊòØÈùûÊ†áÂáÜÁöÑÈ¶ñÈÉ®ÔºåÁî±Â∫îÁî®Á®ãÂ∫èÂºÄÂèëËÄÖÂàõÂª∫Ôºå‰ΩÜËøòÊú™Ê∑ªÂä†Âà∞Â∑≤ÊâπÂáÜÁöÑ HTTP ËßÑËåÉ‰∏≠Âéª„ÄÇÂç≥‰Ωø‰∏çÁü•ÈÅìËøô‰∫õÊâ©Â±ïÈ¶ñÈÉ®ÁöÑÂê´‰πâÔºåHTTP Á®ãÂ∫è‰πüË¶ÅÊé•ÂèóÂÆÉ‰ª¨Âπ∂ÂØπÂÖ∂ËøõË°åËΩ¨Âèë„ÄÇ ÂèÇËÄÉËµÑÊñô „ÄäÂõæËß£ HTTP„Äã „ÄäHTTP ÊùÉÂ®ÅÊåáÂçó„Äã Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ËÆ°ÁÆóÊú∫ÁΩëÁªú</category>
      </categories>
      <tags>
        <tag>ËÆ°ÁÆóÊú∫ÁΩëÁªú</tag>
        <tag>Http</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊãÜËΩÆÂ≠êÁ≥ªÂàó‚Äî‚ÄîLeakCanaryÂ∑•‰ΩúÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F12%2F15%2F%E6%8B%86%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94LeakCanary%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[‰∏Ä„ÄÅÊ¶ÇËø∞LeakCanary ÊòØ‰∏Ä‰∏™ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑËá™Âä®ÂåñÁõëÊµãÂ∑•ÂÖ∑„ÄÇ 1.1‰ªÄ‰πàÊòØÂÜÖÂ≠òÊ≥ÑÊºèÔºüÂÜÖÂ≠òÊ≥ÑÊºèÊåáÁöÑÊòØÂ∫îËØ•Ë¢´ÈáäÊîæÁöÑÂÜÖÂ≠òÁöÑÊ≤°ÊúâË¢´ÈáäÊîæ„ÄÇÂéüÂõ†ÔºüÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÊåÅÊúâÁü≠ÁîüÂëΩÂë®ÊúüÂØπË±°ÁöÑÂºïÁî®„ÄÇ 1.2Âì™‰∫õÂØπË±°Â∫îËØ•Ë¢´ÂõûÊî∂ÔºüÈ¶ñÂÖàË¶ÅÊâæÂá∫Âì™‰∫õÂØπË±°ÊòØÂ∫îËØ•Ë¢´ÂõûÊî∂ÁöÑÔºüAndroid ‰∏≠‰ΩøÁî®ÊúÄÈ¢ëÁπÅÁöÑÊòØ Activity Âíå Fragment ‰∫Ü„ÄÇ‰ªñ‰ª¨ÈÉΩÊúâ onDestory ÊñπÊ≥ïÔºåÂΩìÂÆÉ‰ª¨ÁöÑ onDestroy ÊâßË°åÁöÑÊó∂ÂÄôÔºåÂ∞±ÂèØ‰ª•ÊääÂÆÉ‰ª¨Âàó‰∏∫ „ÄåÂ∫îËØ•Ë¢´ÂõûÊî∂ÁöÑÂØπË±°„ÄçÔºåÂèØÂú® onDestory ÊñπÊ≥ï‰∏≠Âª∫Á´ãÊ£ÄÊµãÁÇπ„ÄÇ Ê≥®Ôºö Application#dispatchActivityDestroyed ÊòØÂú® Activity#onDestroy ÊñπÊ≥ïÊâßË°åÂêéÂõûË∞ÉÁöÑ„ÄÇ 1.3Â¶Ç‰ΩïÁü•ÈÅìÂØπË±°ÊòØÂê¶Ë¢´ÂõûÊî∂‰∫ÜÔºüÊâãÂä® GC +ReferenceQueue + WeakReference WeakReference ÂàõÂª∫Êó∂Ôºå‰º†ÂÖ•‰∏Ä‰∏™ ReferenceQueue ÂØπË±°„ÄÇÂΩìË¢´ WeakReference ÂºïÁî®ÁöÑÂØπË±°ÁöÑÁîüÂëΩÂë®ÊúüÁªìÊùüÔºå‰∏ÄÊó¶Ë¢´ GC Ê£ÄÊü•Âà∞ÔºåGC Â∞Ü‰ºöÊääËØ•ÂØπË±°Ê∑ªÂä†Âà∞ ReferenceQueue ‰∏≠ÔºåÂæÖ ReferenceQueue Â§ÑÁêÜ„ÄÇÂΩì GC ËøáÂêéÂØπË±°‰∏ÄÁõ¥‰∏çË¢´Âä†ÂÖ• ReferenceQueueÔºåËØ¥ÊòéÂÆÉÂèØËÉΩÂ≠òÂú®ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ ËøôÈáåÂÖ∂ÂÆûÊúâ‰∏Ä‰∏™ÈªòËÆ§ÁöÑÂâçÊèêÂ∞±ÊòØÔºåÂΩì‰∏Ä‰∏™ÂØπË±°Â≠òÂú®Âº∫ÂºïÁî®ÁöÑÊó∂ÂÄôÔºåËøô‰∏™ÂØπË±°ÊòØ‰∏ç‰ºöË¢´ÂõûÊî∂ÁöÑÔºåÊâÄ‰ª• GC ÂâçÂêéÔºåÂèØËææÊÄßÂπ∂‰∏ç‰ºöÂèëÁîüÂèòÂåñÔºå‰πüÂ∞±‰∏ç‰ºöË¢´Âä†ÂÖ•Âà∞ referenceQueue ‰∏≠„ÄÇËÄåÂ¶ÇÊûú‰∏Ä‰∏™ÂØπË±°Âè™Âê´ÊúâÂº±ÂºïÁî®ÁöÑÊó∂ÂÄôÔºåGC ÂâçÂêéÂèØËææÊÄß‰ºöÂèëÁîüÊîπÂèò‚Äî‚ÄîGC ‰πãÂâçÂº±ÂèØËææÔºåGC ‰πãÂêéÂèò‰∏çÂèØËææ„ÄÇ ‰ªÄ‰πàÊ†∑ÁöÑÂØπË±°‰ºöËøõÂÖ•ReferenceQueueÔºü ÂàõÂª∫ Reference ÁöÑÊó∂ÂÄôÊåáÂÆö‰∫Ü ReferenceQueueÔºåÂπ∂‰∏îÂØπË±°ÁöÑÂèØËææÊÄßÂèëÁîü‰∫ÜÂèòÂåñ„ÄÇ ÂÖ∑‰ΩìÂä†ÂÖ•ÁöÑÊó∂Èó¥ÊòØÂú® GCÂâçËøòÊòØ GCÂêé Âπ∂‰∏çÊòØÂæàÈáçË¶ÅÔºåÈáçË¶ÅÁöÑÊòØÔºå‰∏ÄÊó¶Ë¢´Ê∑ªÂä†Âà∞ ReferenceQueue ‰∏≠ÔºåÂØπÂ∫îÁöÑÂØπË±°‰∏ÄÂÆö‰ºöË¢´ÂõûÊî∂ (ÂèäÊó∂Ë¢´ÂõûÊî∂‰∫ÜËá™ÁÑ∂‰πüÂ∞±Ê≤°ÊúâÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò‰∫ÜÔºåÊâÄ‰ª• LeakCanary ÊääÂä†ÂÖ• ReferenceQueue ‰Ωú‰∏∫ÂÜÖÂ≠òÊ≥ÑÊºèÊ£ÄÊµãÁöÑÂàùÊ≠•Âà§Êñ≠Ê†áÂáÜ) ÂÅáËÆæÊ≤°ÊúâÂèëÁîüÂÜÖÂ≠òÊ≥ÑÊºèÔºåÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÔºåActivity ‰ªÖË¢´Êàë‰ª¨ÂàõÂª∫ÁöÑ KeyedWeakReference Âº±ÂºïÁî®‰∫Ü„ÄÇÊàë‰ª¨Á¨¨‰∏ÄÊ¨°ÊâãÂä® GC ÁöÑÊó∂ÂÄôÔºåÂÆÉÂ∞±‰ºöËøõÂÖ•ÂºïÁî®ÈòüÂàó„ÄÇËøô‰∏™Êó∂ÂÄôÂèØ‰ª•Â∞ÜÂÆÉ‰ªé retainkeys ‰∏≠ÁßªÈô§„ÄÇ ÂØπË±°‰∏ÄÊó¶Âè™Â≠òÂú®Âº±ÂºïÁî®Ôºå‰ºö ReferenceHandler Á∫øÁ®ãÁõëÂê¨Âà∞ÔºåËØ•Á∫øÁ®ã‰ºöÂ∞ÜËØ•ÂØπË±°ÁöÑÂºïÁî®Âä†ÂÖ• ReferenceQueue ‰∏≠ÔºåËøôÂèëÁîüÂú® finalization ÊàñËÄÖ gc ‰πãÂâç„ÄÇ LeakCanary Âà§Êñ≠ÊòØÂê¶ÂèëÁîüÂÜÖÂ≠òÁöÑÊ≥ÑÊºèÁöÑÊ†áÂáÜÔºöÂØπË±°ÁöÑÂºïÁî®ÊòØÂê¶Âú®Set&lt;String&gt; retainedKeys ‰∏≠„ÄÇ ÂàõÂª∫‰∏Ä‰∏™Ë∑üË∏™ÂØπË±°ÔºåÂ∞ÜÂÆÉÁöÑ key Â≠òÂÇ®Âú®‰∏Ä‰∏™ retainedKeys ‰∏≠„ÄÇÂΩìÂØπË±°Âá∫Áé∞Âú®ÂºïÁî®ÈòüÂàóÈáåÈù¢ÁöÑÊó∂ÂÄôÔºåÂ∞ÜÂÆÉ‰ªé set ‰∏≠ÁßªÈô§ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÂØπË±°ÁöÑÂºïÁî®‰∏çÂú®retainKeys ‰∏≠ÔºåËØ¥ÊòéÊ≤°ÊúâÂèëÁîüÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇÂ¶ÇÊûúÂú®ÔºåÂàôËØ¥ÊòéÂèØËÉΩÂèëÁîü‰∫ÜÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ 1.4Êú™Ë¢´ÂõûÊî∂==ÂÜÖÂ≠òÊ≥ÑÊºèÔºüÊ≤°Ë¢´ÂõûÊî∂ÁöÑÂéüÂõ†ÔºöË¢´ÊåÅÊúâÂº∫ÂºïÁî®‰∫ÜÂêóÔºüÊú™Ë¢´ÂõûÊî∂ÁöÑÂØπË±°ÔºåÊòØÂê¶Ë¢´ÂÖ∂‰ªñÂØπË±°ÂºïÁî®ÔºüÊâæÂá∫ÂÖ∂ÊúÄÁü≠ÂºïÁî®Èìæ„ÄÇVMDebug + HAHA ÂÆåÊàêÈúÄÊ±Ç„ÄÇ VMDebug„ÄÅHAHA„ÄÇ VM ‰ºöÊúâÂ†ÜÂÜÖÂêÑ‰∏™ÂØπË±°ÁöÑÂºïÁî®ÊÉÖÂÜµÔºåÂπ∂ËÉΩ‰ª•hprofÊñá‰ª∂ÂØºÂá∫„ÄÇHAHA ÊòØ‰∏Ä‰∏™Áî± square ÂºÄÊ∫êÁöÑ Android Â†ÜÂàÜÊûêÂ∫ìÔºåÂàÜÊûê hprof Êñá‰ª∂ÁîüÊàêSnapshotÂØπË±°„ÄÇSnapshotÁî®‰ª•Êü•ËØ¢ÂØπË±°ÁöÑÊúÄÁü≠ÂºïÁî®Èìæ„ÄÇ ÊâæÂà∞ÊúÄÁü≠ÂºïÁî®ÈìæÂêéÔºåÂÆö‰ΩçÈóÆÈ¢òÔºåÊéíÊü•‰ª£Á†ÅÂ∞Ü‰ºö‰∫ãÂçäÂäüÂÄç„ÄÇ ‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÊÄª‰ΩìÊµÅÁ®ãÂõæÔºöÔºàÊµÅÁ®ãÂõæÂèÇËÄÉËá™ËøôÁØáÊñáÁ´†Ôºâ Â¶ÇÊûúËØªËÄÖËøòÊ≤°ÁúãËøá LeakCanary ÁöÑÊ∫êÁ†ÅÔºåÂª∫ËÆÆÁÖßÁùÄ‰∏äÈù¢ÁöÑË∞ÉÁî®ÊµÅÁ®ãÂõæËøá‰∏ÄÈÅçÔºåËøôÊ†∑ÊïàÊûú‰ºöÂ•ΩÂæàÂ§ö„ÄÇwhyÔºü‰∏∫‰ªÄ‰πàÊ∫êÁ†ÅÂàÜÊûêÂë≥ÂêåÂöºËú°ÔºüÊµÖÊûêÊäÄÊúØÂÜô‰Ωú‰∏≠ÁöÑÊÄùÁª¥ËØØÂå∫ ‰∫å„ÄÅÂÖ∑‰ΩìÊµÅÁ®ãÂâçÈù¢ËÆ≤‰∫ÜÂ§ß‰ΩìÊµÅÁ®ãÔºåÊé•‰∏ãÊù•Êàë‰ª¨ÁúãÁúãÂÜÖÈÉ®ÁöÑÂÆûÁé∞„ÄÇ ÈÄöÂ∏∏‰ºöÂú® Applcation#onCreate ‰∏≠ÂØπ LeakCanary ËøõË°åÂàùÂßãÂåñ,‰πüÂ∞±ÊòØË∞ÉÁî®‰∏ãÈù¢ÁöÑ setupLeakCanary ÊñπÊ≥ï„ÄÇ 123456protected RefWatcher setupLeakCanary() &#123; if (LeakCanary.isInAnalyzerProcess(this)) &#123; return RefWatcher.DISABLED; &#125; return LeakCanary.install(this);&#125; 2.1LeakCanary#install Ë∞ÉÁî®ÊµÅÁ®ã12345678910111213141516--&gt; ‚ë† LeakCanary#install --&gt; ‚ë° refWatcher --&gt; ‚ë¢ AndroidRefWatcherBuilder#listenerServiceClass //ÁõëÂê¨ÊúçÂä°Á±ª --&gt; ‚ë£ AndroidExcludedRefs#createAppDefaults//ÂàõÂª∫ÈªòËÆ§ÁöÑÂøΩÁï•ÂàóË°® --&gt; ‚ë§ ExcludedRefs.Builder#build --&gt; ‚ë• RefWatcherBuilder#excludedRefs//ÊéíÈô§‰∏Ä‰∫õÂºïÁî® --&gt; ‚ë¶ AndroidRefWatcherBuilder#buildAndInstall//ÊûÑÈÄ†‰∏Ä‰∏™ RefWatcher --&gt; ‚ëß RefWatcherBuilder#build --&gt; ‚ë® ActivityRefWatcher#install --&gt; ‚ë© new ActivityRefWatcher --&gt; ‚ë™ ActivityRefWatcher#watchActivities --&gt; ‚ë´ stopWatchingActivities();//Èò≤Ê≠¢Ë£ÖËΩΩ‰∏§Ê¨°Ôºå --&gt; ‚ë¨ Application.unregisterActivityLifecycleCallbacks(lifecycleCallbacks);//Ëß£Ê≥®ÂÜå --&gt; ‚ë≠ Application#registerActivityLifecycleCallbacks(lifecycleCallbacks);//Ê≥®ÂÜåÁîüÂëΩÂë®ÊúüÂõûË∞É --&gt; ‚ëÆ1mActivityLifecycleCallbacks.add(callback);//Ê∑ªÂä†Âà∞ÁõëÂê¨ËÄÖÂàóË°®‰∏≠ Ê≥®ÔºöÁõëÂê¨ÂõûË∞ÉËøõË°å‰ªÖ‰ªÖÂÆûÁé∞‰∫Ü 123@Override public void onActivityDestroyed(Activity activity) &#123; ActivityRefWatcher.this.onActivityDestroyed(activity);&#125; ‰ªé‰∏äÈù¢ÂèØ‰ª•ÁúãÂá∫Âú®ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÂè™ÁõëÂê¨ Activity ÁöÑ onDestory ÊñπÊ≥ïÔºå‰πüÂ∞±ÊòØËØ¥Âè™ÊòØÊ£ÄÊµã Activity ÊòØÂê¶Â≠òÂú®ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ Â¶ÇÊûúË¶ÅÊ£ÄÊµã Fragment ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÔºåÂ∫îËØ•Â¶Ç‰ΩïÂÆûÁé∞ÔºüÂõ†‰∏∫ Android ‰∏≠Âè™Êèê‰æõ‰∫Ü Activity ÁöÑÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÁöÑÂõûË∞ÉÔºåËÄåÊ≤°ÊúâÊèê‰æõ Fragment ÁîüÂëΩÂë®ÊúüÂõûË∞ÉÁöÑÁõëÂê¨„ÄÇ Â¶ÇÊûúË¶ÅÂØπ Fragment ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèËøõË°åÊ£ÄÊµãÔºåÈÇ£‰πàÈúÄË¶ÅËá™Â∑±Âú® Fragment#onDestroy ÊñπÊ≥ï‰∏≠ÊâãÂä®ÂàõÂª∫‰∏Ä‰∏™ RefWatcher ÔºåÁÑ∂ÂêéË∞ÉÁî® refWatcher#watch(this)ÔºåÊúÄÂ•ΩÊòØÂÆö‰πâ‰∏Ä‰∏™ Fragment Âü∫Á±ªÔºåÂú®ÂÖ∂‰∏≠ÁöÑ onDestroy ÊñπÊ≥ï‰∏≠ÂÆö‰πâÁõ∏Â∫îÁöÑÊìç‰Ωú„ÄÇ 12345678public abstract class BaseFragment extends Fragment &#123; @Override public void onDestroy() &#123; super.onDestroy(); RefWatcher refWatcher = ExampleApplication.getRefWatcher(getActivity()); refWatcher.watch(this); &#125;&#125; 2.2ÂΩìÁõëÂê¨‰∫ã‰ª∂ÂèëÁîüÊó∂ÔºåÂàáÊç¢Âà∞ÂêéÂè∞ÊâßË°å123456789101112131415161718192021--&gt; ‚ë† ActivityLifecycleCallbacks#onActivityDestroyed --&gt;‚ë° ActivityRefWatcher#onActivityDestroyed --&gt;‚ë¢ RefWatcher#watch(Object) --&gt;‚ë£ RefWatcher#watch(Object, String) ÂÜÖÈÉ®Êúâ‰∏Ä‰∏™ ReferenceQueue&lt;Object&gt; queue; --&gt;‚ë§ new KeyedWeakReference(watchedReference, key, referenceName, queue)//ÂàõÂª∫ KeyedWeakReference //‰∏§‰∏™ Handler,mainHandler „ÄÅbackgroundHandler --&gt;‚ë• RefWatcher#ensureGoneAsync --&gt;‚ë¶ WatchExecutor#execute if ÂΩìÂâçÁ∫øÁ®ã‰∏∫‰∏ªÁ∫øÁ®ã ==&gt; ‚ëßAndroidWatchExecutor#waitForIdle// Á≠âÂæÖ MainLooper Á©∫Èó≤Êó∂ÂèëÈÄÅ --&gt; ‚ë®MessageQueue#addIdleHandler//ÂΩì Looper Âç≥Â∞ÜÈó≤ÁΩÆÊó∂ÂèëÈÄÅ --&gt; ‚ë©AndroidWatchExecutor#postToBackgroundWithDelay --&gt; ‚ë™backgroundHandler#postDelayed//Â∑•‰ΩúÁ∫øÁ®ã Handler Âª∂ËøüÂèëÈÄÅ --&gt; ‚ë´Retryable --&gt; if (result == RETRY) ‚ë¨postWaitForIdle(retryable, failedAttempts + 1); else ‚ëßÂΩìÂâçÁ∫øÁ®ãÊòØÂ∑•‰ΩúÁ∫øÁ®ãÔºåÈúÄË¶ÅÂÖàÂàáÊç¢Âà∞‰∏ªÁ∫øÁ®ãÔºåÂÜç‰ªé‰∏ªÁ∫øÁ®ãÂàáÊç¢Âà∞ HandlerThread Á∫øÁ®ã --&gt; ‚ë®AndroidWatchExecutor#postWaitForIdle --&gt; ‚ë©mainHandler#post//ÈÄöËøá‰∏ªÁ∫øÁ®ã Handler ÂàáÊç¢Âà∞‰∏ªÁ∫øÁ®ãÊâßË°å ==&gt; ‚ë™AndroidWatchExecutor#waitForIdle//Á≠âÂæÖÁ©∫Èó≤Êó∂ÂèëÈÄÅ ÂèØ‰ª•ÁúãÂà∞ Retryable#run Âú®Â∑•‰ΩúÁ∫øÁ®ãÊâßË°å„ÄÇAndroidWatchExecutor ÂÜÖÂàõÂª∫‰∫Ü‰∏Ä‰∏™ HandlerThread ÔºåÈÄöËøáÂÆÉÂàõÂª∫‰∫Ü‰∏Ä‰∏™ Handler„ÄÇÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÊòØ‰∏ªÁ∫øÁ®ãÔºåÁõ¥Êé•Ë∞ÉÁî®‰∏ªÁ∫øÁ®ãÁöÑ Message#addIdleHandler ËøõË°åÂ§ÑÁêÜÔºåÁªôÂ∑•‰ΩúÁ∫øÁ®ãÂèëÈÄÅÂª∂Êó∂‰ªªÂä°„ÄÇÂê¶ÂàôÔºåÈúÄË¶ÅÂÖàË∞ÉÁî® mainHandler#post ÊñπÊ≥ïÔºå ÂàáÊç¢Âà∞‰∏ªÁ∫øÁ®ãÔºåÁÑ∂ÂêéÂÜçË∞ÉÁî® AndroidWatchExecutor#waitForIdle„ÄÇ‰πãÊâÄ‰ª•Ë¶ÅÂàáÊç¢Âà∞‰∏ªÁ∫øÁ®ãÔºå‰∏ªË¶ÅÊòØ‰∏∫‰∫Ü‰ΩøÁî®‰∏ªÁ∫øÁ®ãÁöÑ MessageQueue#addIdleHandler 123HandlerThread handlerThread = new HandlerThread(LEAK_CANARY_THREAD_NAME);handlerThread.start();backgroundHandler = new Handler(handlerThread.getLooper()); ÂâçÈù¢ÊâÄË∞àÈÉΩÊòØÊâßË°åÁ∫øÁ®ãÁöÑÂàáÊç¢Ôºå‰∏ãÈù¢ÂºÄÂßãÂÜÖÂ≠òÂàÜÊûê‰ªªÂä°ÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïËøõË°åÁöÑ„ÄÇ 2.3ÂÜÖÂ≠òÊ≥ÑÊºèÂàÜÊûê2.3.1Â∑•‰ΩúÊú∫Âà∂ Âú®ÂêéÂè∞Á∫øÁ®ãÊ£ÄÊü•ÂºïÁî®ÊòØÂê¶Ë¢´Ê∏ÖÈô§ÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåË∞ÉÁî® GC„ÄÇ Â¶ÇÊûúÂºïÁî®ËøòÊòØÊú™Ë¢´Ê∏ÖÈô§ÔºåÊää heap ÂÜÖÂ≠ò dump Âà∞ APP ÂØπÂ∫îÁöÑÊñá‰ª∂Á≥ªÁªü‰∏≠ÁöÑ‰∏Ä‰∏™ .hprof Êñá‰ª∂‰∏≠„ÄÇ Âú®Âè¶Â§ñ‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÁöÑ HeapAnalyzerService Êúâ‰∏Ä‰∏™ HeapAnalyzer ‰ΩøÁî®HAHA Ëß£ÊûêËøô‰∏™Êñá‰ª∂„ÄÇ ÂæóÁõä‰∫éÂîØ‰∏ÄÁöÑ reference key, HeapAnalyzer ÊâæÂà∞ KeyedWeakReferenceÔºåÂÆö‰ΩçÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ HeapAnalyzer ËÆ°ÁÆó Âà∞ GC roots ÁöÑÊúÄÁü≠Âº∫ÂºïÁî®Ë∑ØÂæÑÔºåÂπ∂Á°ÆÂÆöÊòØÂê¶ÊòØÊ≥ÑÊºè„ÄÇÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂª∫Á´ãÂØºËá¥Ê≥ÑÊºèÁöÑÂºïÁî®Èìæ„ÄÇ ÂºïÁî®Èìæ‰º†ÈÄíÂà∞ APP ËøõÁ®ã‰∏≠ÁöÑ DisplayLeakServiceÔºå Âπ∂‰ª•ÈÄöÁü•ÁöÑÂΩ¢ÂºèÂ±ïÁ§∫Âá∫Êù•„ÄÇ 2.3.2RefWatcher#ensureGoneÂú®ÂâçÈù¢ÁöÑÁ∫øÁ®ãÂàáÊç¢Âà∞ÁõÆÊ†áÂ∑•‰ΩúÁ∫øÁ®ã‰πãÂêéÂ∞±Ë∞ÉÁî®ËØ•ÊñπÊ≥ï„ÄÇ 12345678910111213141516RefWatcher#ensureGone --&gt; ‚ë† RefWatcher#removeWeaklyReachableReferences//ÁßªÈô§ÊâÄÊúâ„ÄåÂº±ÂèØËææÂºïÁî®„Äç if (debuggerControl.isDebuggerAttached()) --&gt; return RETRY;//Ë∞ÉËØïÊ®°ÂºèÊéßÂà∂ if (gone(reference)) //Âà§Êñ≠Á±ªÂêçÊòØÂê¶‰∏çÂú® Set&lt;String&gt; retainedKeys ‰∏≠ÔºåËã•‰∏çÂú®ÔºåËØ¥ÊòéÂÜÖÂ≠òÂàÜÊûêÂÆåÊØï return DONE; --&gt; gcTrigger.runGc();//Ëß¶Âèë gcÔºåË∞ÉÁî®ÁöÑÊòØ Runtime.getRuntime().gc(); --&gt; ‚ë° RefWatcher#removeWeaklyReachableReferences//ÂÜçÊ¨°ÁßªÈô§ÊâÄÊúâ„ÄåÂº±ÂèØËææÂºïÁî®„Äç if !gone(reference)//Â¶ÇÊûúËØ•ÂºïÁî®ÂØπÂ∫îÁöÑÈîÆ‰ªçÁÑ∂Âú® retainKeys ‰∏≠ÔºåËØ¥ÊòéÂèØËÉΩÂ≠òÂú®ÂÜÖÂ≠òÊ≥ÑÊºèÔºåËøõË°å dump ÁÑ∂ÂêéÂàÜÊûê --&gt; File heapDumpFile = heapDumper.dumpHeap();// dump Â†ÜÂÜÖÂ≠òÔºå‰ºöËß¶Âèë stop the world if heapDumpFile == RETRY_LATER //Áé∞Âú®Êó†Ê≥ïËß¶Âèë gc ÔºåÂÖàËøîÂõû„ÄÇÁ®çÂÄôÈáçËØï --&gt; return RETRY; --&gt; new HeapDump --&gt; ServiceHeapDumpListener#analyze --&gt; HeapAnalyzerService#runAnalysis --&gt; startService //ÂºÄÂêØ HeapAnalyzerService ÊúçÂä°ÔºåÈúÄË¶Å HeapDump ‰ª•ÂèäÊé•Êî∂ÂàÜÊûêÁªìÊûúÁöÑÂõûË∞ÉÁ±ªÁöÑÁ±ªÂêç 2.3.3RefWatcher#removeWeaklyReachableReferencesÁßªÈô§Âú® retainedKeys ‰∏≠ÁöÑÊâÄÊúâÂº±ÂèØËææÁöÑÂØπË±°ÂØπÂ∫îÁöÑ key„ÄÇ 123456789private final Set&lt;String&gt; retainedKeys;ReferenceQueue&lt;Object&gt; queue;private void removeWeaklyReachableReferences() &#123; // ÂØπË±°‰∏ÄÊó¶Âè™Â≠òÂú®Âº±ÂºïÁî®ÔºåÈ©¨‰∏äÂ∞±‰ºöË¢´Âä†ÂÖ• ReferenceQueue ‰∏≠ÔºåËøôÂèëÁîüÂú® finalization ÊàñËÄÖ gc ‰πãÂâç KeyedWeakReference ref; while ((ref = (KeyedWeakReference) queue.poll()) != null) &#123; retainedKeys.remove(ref.key);//ÁßªÈô§Âº±ÂºïÁî®ÂØπÂ∫îÁöÑ key &#125;&#125; 2.3.4KeyedWeakReference‰∏äÈù¢‰ΩøÁî®Âà∞‰∫Ü‰∏Ä‰∏™ KeyedWeakReference Á±ªÂûãÁöÑÂØπË±°ÔºåKeyedWeakReference ÊÑè‰∏∫„ÄåÂ∏¶ÈîÆÁöÑÂº±ÂºïÁî®„Äç„ÄÇÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö 1234567891011final class KeyedWeakReference extends WeakReference&lt;Object&gt; &#123; public final String key; public final String name; KeyedWeakReference(Object referent, String key, String name, ReferenceQueue&lt;Object&gt; referenceQueue) &#123; super(checkNotNull(referent, "referent"), checkNotNull(referenceQueue, "referenceQueue")); this.key = checkNotNull(key, "key"); this.name = checkNotNull(name, "name"); &#125;&#125; ÂîØ‰∏ÄÂàõÂª∫‰∫Ü KeyedReference ÁöÑÂú∞ÊñπÔºö RefWatcher#watch(Object, String) 1234567891011121314public void watch(Object watchedReference, String referenceName) &#123; if (this == DISABLED) &#123; return; &#125; checkNotNull(watchedReference, "watchedReference"); checkNotNull(referenceName, "referenceName"); final long watchStartNanoTime = System.nanoTime(); String key = UUID.randomUUID().toString();//ÂàõÂª∫‰∏Ä‰∏™Áã¨‰∏ÄÊó†‰∫å key retainedKeys.add(key);//Ê∑ªÂä†Âà∞ retainedKeys ‰∏≠ final KeyedWeakReference reference = new KeyedWeakReference(watchedReference, key, referenceName, queue);//ÂàõÂª∫‰∏Ä‰∏™ „ÄåÂ∏¶ÈîÆÁöÑÂº±ÂºïÁî®„Äç ensureGoneAsync(watchStartNanoTime, reference);&#125; 2.3.5retainedKeysretainedKeys Á±ªÂûã‰∏∫‰∏Ä‰∏™ Set&lt;String&gt;Ôºå‰∏ªË¶ÅÁî®‰∫éÂà§Êñ≠ÂØπË±°ÊòØÂê¶Ë¢´ÂõûÊî∂„ÄÇ retainedKeys ÁöÑÊ∑ªÂä†‰∏éÂà†Èô§ Ê∑ªÂä†Ôºö‰∏Ä‰∏™Â∏¶ÈîÆÁöÑÂº±ÂºïÁî®ÔºàKeyedWeakReferenceÔºâË¢´ÂàõÂª∫ÁöÑÊó∂ÂÄôÔºåÂÖ∂‰∏≠ÁöÑÈîÆ‰ºöË¢´Âä†ÂÖ• retainedKeys ‰∏≠„ÄÇ Âà†Èô§ÔºöÈÄöËøá RefWatcher#removeWeaklyReachableReferences ÊñπÊ≥ï ÂèØ‰ª•Âà†Èô§ retainedKeys ‰∏≠ÈÇ£‰∫õ‰ªÖÂê´ÊúâÂº±ÂºïÁî®ÁöÑ KeyedWeakReference ÂØπÂ∫îÁöÑ key„ÄÇ Â¶ÇÊûú‰∏çÂú® retainedKeys ‰∏≠ËØ¥ÊòéËØ•ÂØπË±°Â∑≤ÁªèË¢´ÂõûÊî∂‰∫Ü„ÄÇ 2.3.6HeapAnalyzerServiceHeapAnalyzerService ÊòØ‰∏Ä‰∏™ IntentServiceÔºåÂÆÉ‰ºöÂú® onHandleIntent ÊñπÊ≥ï‰∏≠ÂØπÂ†ÜËøõË°åÂàÜÊûê„ÄÇ HeapAnalyzerService#onHandleIntent 12345678910111213@Override protected void onHandleIntent(Intent intent) &#123; if (intent == null) &#123;// intent ‰∏∫Á©∫Áõ¥Êé•ËøîÂõû CanaryLog.d("HeapAnalyzerService received a null intent, ignoring."); return; &#125; String listenerClassName = intent.getStringExtra(LISTENER_CLASS_EXTRA);//Ëé∑ÂèñÂõûË∞ÉÁ±ªÁöÑÁ±ªÂêç HeapDump heapDump = (HeapDump) intent.getSerializableExtra(HEAPDUMP_EXTRA);//Ëé∑Âèñ HeapDump HeapAnalyzer heapAnalyzer = new HeapAnalyzer(heapDump.excludedRefs);//ÂàõÂª∫ HeapAnalyzer AnalysisResult result = heapAnalyzer.checkForLeak(heapDump.heapDumpFile, heapDump.referenceKey);//Ê£ÄÊü•Ê≥ÑÊºèÔºàÈÄöËøá HAHA Êù•ÂÆåÊàêÔºâÔºåÂπ∂Ëé∑ÂèñÁªìÊûú AbstractAnalysisResultService.sendResultToListener(this, listenerClassName, heapDump, result);//Â∞ÜÂàÜÊûêÁªìÊûúÂèëÈÄÅÁªôÁõëÂê¨Âô®&#125; ÂèØ‰ª•ÁúãÂà∞ÔºåonHandleIntent ÊñπÊ≥ï‰∏≠Ôºå‰ºö‰ªé Intent ‰∏≠Ëé∑Âèñ HeapDump ‰ª•Âèä listenerClassNameÔºàÁõëÂê¨Âô®Á±ªÂêçÔºâÔºåÁÑ∂ÂêéÂ∞ÜÁõ∏Â∫îÁöÑÊï∞ÊçÆ‰∫§Áªô HAHA Â∫ì‰∏≠ÁöÑ HeapAnalyzer ËøõË°åÂàÜÊûêÔºåÊúÄÂêéÂ∞ÜÁªìÊûúÂèëÂõûÁªôÁõëÂê¨Âô® Ê≥®ÔºöÂú®ÂàõÂª∫ÂØπÂàÜÊûêÂô®ÁöÑÊó∂ÂÄô ‰ºö‰ΩøÁî®Âà∞ heapDump.excludedRefsÔºåexcludedRefs ÂÆûÈôÖÁ±ªÂûã‰∏∫ AndroidExcludedRefs ÔºåÂÆÉÊòØ‰∏Ä‰∏™Êûö‰∏æÁ±ªÔºåÂÖ∂‰∏≠ËÆæÁΩÆ‰∫Ü‰∏Ä‰∫õÁî±‰∫éÁâπÂÆöÂà∂ÈÄ†ÂïÜÁöÑÂÆûÁé∞ÂºïËµ∑ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÁ±ª„ÄÇÂ¶ÇÊûúÂÜÖÂ≠òÊ≥ÑÊºèÊòØÁî±ËØ•Êûö‰∏æÁ±ªÂê´ÊúâÁöÑÁ±ªÈîÅÂºïËµ∑ÔºåÈÇ£‰πàÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò‰ºöË¢´ÂøΩÁï•„ÄÇ ÂØπ‰∫éÂ§ßÈÉ®ÂàÜÂ∫îÁî®ÂºÄÂèëËÄÖËÄåË®ÄÈÉΩÂ∫îËØ•‰ΩøÁî® createAppDefaults ÊñπÊ≥ïÔºå‰∏çËøá‰πüÂèØ‰ª•Ëá™Â∑±ÂàõÂª∫‰∏Ä‰∏™ EnumSet ÔºåÂú®ÂÖ∂‰∏≠ÊåáÂÆöËá™Â∑±Ë¶ÅÂøΩÁï•ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÁ±ªÔºåÂπ∂ÈÄöËøá AndroidExcludedRefs#createBuilder(EnumSet)ÊñπÊ≥ïËøõË°åËÆæÁΩÆ„ÄÇ 2.3.7HeapAnalyzer#checkForLeak Ê£ÄÊµãÂÜÖÂ≠òÊ≥ÑÊºèÈôê‰∫éÁØáÂπÖÔºå‰ªÖÂØπ HAHA ËøõË°åÁÆÄÂçï‰ªãÁªç HAHA ÊòØ‰∏Ä‰∏™ Java Â∫ìÔºåÂèØ‰ª•Ëá™Âä®ÂÆåÊàêÂØπ Android Â†ÜËΩ¨ÂÇ®Êñá‰ª∂ÁöÑÂàÜÊûê„ÄÇ Ëøô‰∏™È°πÁõÆÂÆûÈôÖ‰∏äÊòØÂØπÂÖ∂‰ªñ‰∫∫ÁöÑÂ∑•‰ΩúÁöÑÈáçÊñ∞ÊâìÂåÖÔºå‰ª•‰ΩøÂÖ∂Êàê‰∏∫‰∏Ä‰∏™Â∞èÂûãÁöÑ Maven ‰æùËµñÈ°π„ÄÇ HAHA ÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ï 1234567891011121314151617181920212223242526public AnalysisResult checkForLeak(File heapDumpFile, String referenceKey) &#123; long analysisStartNanoTime = System.nanoTime(); if (!heapDumpFile.exists()) &#123; Exception exception = new IllegalArgumentException("File does not exist: " + heapDumpFile); return failure(exception, since(analysisStartNanoTime)); &#125; try &#123; HprofBuffer buffer = new MemoryMappedFileBuffer(heapDumpFile);//ÈÄöËøáÂ†ÜËΩ¨ÂÇ®Êñá‰ª∂ÊûÑÈÄ†‰∏Ä‰∏™ MemoryMappedFileBuffer HprofParser parser = new HprofParser(buffer);//ÂàõÂª∫‰∏Ä‰∏™ Hprof Êñá‰ª∂Ëß£ÊûêÂô® Snapshot snapshot = parser.parse();//Ëß£ÊûêÔºåÂ∞ÜÁªìÊûúËµãÁªô Snapshot deduplicateGcRoots(snapshot);//Âà†Èô§ÈáçÂ§çÁöÑ GC Root Instance leakingRef = findLeakingReference(referenceKey, snapshot);//Âà©Áî® referenceKey Âíå snapshot ÂØªÊâæÂèëÁîüÊ≥ÑÊºèÁöÑÂºïÁî® // False alarm, weak reference was cleared in between key check and heap dump. if (leakingRef == null) &#123; return noLeak(since(analysisStartNanoTime));//Ê≤°ÊúâÂèëÁîüÂÜÖÂ≠òÊ≥ÑÊºè &#125; return findLeakTrace(analysisStartNanoTime, snapshot, leakingRef);//ÂèëÁé∞ÂÜÖÂ≠òÊ≥ÑÊºè &#125; catch (Throwable e) &#123; return failure(e, since(analysisStartNanoTime));// &#125;&#125; ÂæóÁõä‰∫éÂîØ‰∏ÄÁöÑ reference key, HeapAnalyzer ÊâæÂà∞ KeyedWeakReferenceÔºåÂÆö‰ΩçÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ HeapAnalyzer ËÆ°ÁÆó Âà∞ GC roots ÁöÑÊúÄÁü≠Âº∫ÂºïÁî®Ë∑ØÂæÑÔºåÂπ∂Á°ÆÂÆöÊòØÂê¶ÊòØÊ≥ÑÊºè„ÄÇÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂª∫Á´ãÂØºËá¥Ê≥ÑÊºèÁöÑÂºïÁî®Èìæ„ÄÇ ‰∏â„ÄÅÊÄªÁªìÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÊú¨Ë¥®ÊòØÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÊåÅÊúâÁü≠ÁîüÂëΩÂë®ÊúüÂØπË±°ÁöÑÂº∫ÂºïÁî®ÔºåÂØºËá¥Áü≠ÁîüÂëΩÂë®ÊúüÂØπË±°‰ΩøÁî®ÂÆå‰∫Ü‰πãÂêéÊó†Ê≥ïË¢´ÂõûÊî∂„ÄÇ‰πüÂ∞±ÊòØÂ∫îËØ•Ë¢´ÂõûÊî∂ÁöÑÂØπË±°Ê≤°ÊúâË¢´ÂõûÊî∂„ÄÇÈÇ£‰πàÈóÆÈ¢òÂ∞±ÂèòÊàê‰∫Ü‰ªÄ‰πàÂØπË±°ÊòØÂ∫îËØ•Ë¢´ÂõûÊî∂ÁöÑÂØπË±°Âë¢ÔºüÂØπ‰∫é Activity ËÄåË®ÄÔºåÊâßË°åÂÆå onDestroy ÊñπÊ≥ï‰πãÂêéÔºåÂ∞±ÊòØÂ∫îËØ•Ë¢´ÂõûÊî∂‰∫Ü„ÄÇÂõ†Ê≠§ÂèØ‰ª•Â∞Ü Activity#ondestroy ÊñπÊ≥ï‰Ωú‰∏∫‰∏Ä‰∏™Ê£ÄÊµãÁÇπ„ÄÇApplication ‰∏≠Êèê‰æõ‰∫ÜÂêÑ‰∏™ Activity ÁöÑÁîüÂëΩÂë®ÊúüÂõûË∞ÉÊñπÊ≥ïÁöÑÁõëÂê¨ÔºåLeakCanary Â∞±ÊòØÈÄöËøáÊ≥®ÂÜå ActivityLifecycleCallbacks ÔºåÁõëÂê¨ÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÁöÑÂõûË∞ÉÔºå‰Ωú‰∏∫Êï¥‰∏™ÂÜÖÂ≠òÊ≥ÑÊºèÂàÜÊûêÁöÑÂÖ•Âè£„ÄÇ ÊØèÊ¨° onActivityDestroyed(Activity activity) ÊñπÊ≥ïË¢´ÂõûË∞É‰πãÂêé,ÈÉΩ‰ºöÂàõÂª∫‰∏Ä‰∏™ KeyedWeakReference ÂØπÁõ∏Â∫î Activity ÁöÑÁä∂ÊÄÅËøõË°åË∑üË∏™ÔºåÊâãÂä®Ë∞ÉÁî® gcÔºåÂêéÂè∞Á∫øÁ®ãÔºàHandlerThread ÔºâÊ£ÄÊü•ÂºïÁî®ÊòØÂê¶Ë¢´Ê∏ÖÈô§ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ∞±ÊâãÂä®Ë∞ÉÁî®‰∏ÄÊ¨° gcÔºåÂ¶ÇÊûúËøôÊó∂ËøòÊòØÊ≤°ÊúâË¢´Ê∏ÖÈô§ÔºåÊää heap ÂÜÖÂ≠ò dump Âà∞ APP ÂØπÂ∫îÁöÑÊñá‰ª∂Á≥ªÁªü‰∏≠ÁöÑ‰∏Ä‰∏™ .hprof Êñá‰ª∂‰∏≠„ÄÇÂú®Âè¶‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÁöÑ HeapAnalyzerService ‰∏≠Ôºå HeapAnalyzer ‰ºöÈÄöËøá haha ÂºÄÊ∫êÂ∫ìÂØπÊñá‰ª∂ËøõË°åÂàÜÊûê„ÄÇ ÂæóÁõä‰∫éÂîØ‰∏ÄÁöÑ reference key, HeapAnalyzer ÊâæÂà∞ KeyedWeakReferenceÔºåÂÆö‰ΩçÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇHeapAnalyzer ËÆ°ÁÆó Âà∞ GC roots ÁöÑÊúÄÁü≠Âº∫ÂºïÁî®Ë∑ØÂæÑÔºåÂπ∂Á°ÆÂÆöÊòØÂê¶ÊòØÊ≥ÑÊºè„ÄÇÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂª∫Á´ãÂØºËá¥Ê≥ÑÊºèÁöÑÂºïÁî®Èìæ„ÄÇÂºïÁî®Èìæ‰º†ÈÄíÂà∞ APP ËøõÁ®ã‰∏≠ÁöÑ DisplayLeakServiceÔºå Âπ∂‰ª•ÈÄöÁü•ÁöÑÂΩ¢ÂºèÂ±ïÁ§∫Âá∫Êù•„ÄÇ ËøõÈò∂‰ΩøÁî®Ôºö‰∫ÜËß£ LeakCanary ÁöÑÂéüÁêÜ‰πãÂêéÔºåÂèëÁé∞ÂÖ∂ÂÆûÂÆÉÂ∞±ÊòØÂú®ÂØπË±°‰∏çÂèØÁî®ÁöÑÊó∂ÂÄôÂéªÂà§Êñ≠ÂØπË±°ÊòØÂê¶Ë¢´ÂõûÊî∂‰∫ÜÔºå‰ΩÜ LeakCanary Âè™Ê£ÄÊü•‰∫Ü ActivityÔºåÊàë‰ª¨ÊòØÂê¶ÂèØ‰ª•Ê£ÄÊü•ÂÖ∂‰ªñÂØπË±°Âë¢ÔºåÊØïÁ´ü Activity Ê≥ÑÊºèÂè™ÊòØÂÜÖÂ≠òÊ≥ÑÊºèÁöÑ‰∏ÄÁßçÔºåÁ≠îÊ°àÂΩìÁÑ∂ÊòØÂèØ‰ª•ÁöÑÔºåÊàë‰ª¨Âè™Ë¶ÅÈúÄË¶ÅËøõË°åÂ¶Ç‰∏ãÊìç‰Ωú: 1LeakCanary.install(app).watch(object) ‰ΩÜÊàë‰ª¨Âú®Ë∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïÁöÑÊó∂ÂÄôÈúÄË¶ÅÁ°ÆÂÆöËøô‰∏™ object Â∑≤Áªè‰∏çÈúÄË¶Å‰∫ÜÔºåÂèØ‰ª•Ë¢´ÂõûÊî∂‰∫Ü„ÄÇÈÄöËøáËøôÁßçÊñπÂºèÊàë‰ª¨Â∞±ÂèØ‰ª•ÂØπ‰ªª‰ΩïÂØπË±°ÈÉΩËøõË°åÊ£ÄÊµã‰∫Ü„ÄÇ Âõõ„ÄÅÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê LeakCanary ÂéüÁêÜÊµÖÊûê LeakCanary ‰∏≠Êñá‰ΩøÁî®ËØ¥Êòé ËØùËØ¥ ReferenceQueue Reference „ÄÅReferenceQueue ËØ¶Ëß£ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫ê„ÄÇË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê∫êÁ†ÅÂàÜÊûê</category>
        <category>Ê°ÜÊû∂ÂéüÁêÜ</category>
      </categories>
      <tags>
        <tag>Ê∫êÁ†ÅÂàÜÊûê</tag>
        <tag>Ê°ÜÊû∂ÂéüÁêÜ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊãÜËΩÆÂ≠êÁ≥ªÂàó‚Äî‚ÄîLitePal ÂéüÁêÜËß£Êûê]]></title>
    <url>%2Fblog%2F2017%2F12%2F03%2F%E6%8B%86%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94litepal-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[LitePal Ëß£ÂÜ≥‰∫Ü‰ªÄ‰πàÈóÆÈ¢òÔºü LitePal ÈááÂèñÁöÑÊòØÂØπË±°ÂÖ≥Á≥ªÊò†Â∞Ñ(ORM)ÁöÑÊ®°ÂºèÔºåÈÇ£‰πà‰ªÄ‰πàÊòØÂØπË±°ÂÖ≥Á≥ªÊò†Â∞ÑÂë¢ÔºüÁÆÄÂçïÁÇπËØ¥ÔºåÊàë‰ª¨‰ΩøÁî®ÁöÑÁºñÁ®ãËØ≠Ë®ÄÊòØÈù¢ÂêëÂØπË±°ËØ≠Ë®ÄÔºåËÄåÊàë‰ª¨‰ΩøÁî®ÁöÑÊï∞ÊçÆÂ∫ìÂàôÊòØÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ìÔºåÈÇ£‰πàÂ∞ÜÈù¢ÂêëÂØπË±°ÁöÑËØ≠Ë®ÄÂíåÈù¢ÂêëÂÖ≥Á≥ªÁöÑÊï∞ÊçÆÂ∫ì‰πãÈó¥Âª∫Á´ã‰∏ÄÁßçÊò†Â∞ÑÂÖ≥Á≥ªÔºåËøôÂ∞±ÊòØÂØπË±°ÂÖ≥Á≥ªÊò†Â∞Ñ‰∫Ü„ÄÇ ‰ΩÜÊòØÊàë‰ª¨‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®ÂØπË±°ÂÖ≥Á≥ªÊò†Â∞ÑÊ®°ÂºèÂë¢ÔºüËøô‰∏ªË¶ÅÊòØÂõ†‰∏∫Â§ßÂ§öÊï∞ÁöÑÁ®ãÂ∫èÂëòÈÉΩÂæàÊìÖÈïøÈù¢ÂêëÂØπË±°ÁºñÁ®ãÔºå‰ΩÜÂÖ∂‰∏≠Âè™ÊúâÂ∞ëÈÉ®ÂàÜÁöÑ‰∫∫ÊâçÊØîËæÉÁ≤æÈÄöÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ì„ÄÇËÄå‰∏îÊï∞ÊçÆÂ∫ìÁöÑ SQL ËØ≠Ë®ÄÊô¶Ê∂©ÈöæÊáÇÔºåÂ∞±ÁÆó‰Ω†ÂæàÁ≤æÈÄöÂÆÉÔºåÊÅêÊÄï‰πü‰∏çÂñúÊ¨¢ÁªèÂ∏∏Âú®‰ª£Á†Å‰∏≠ÂéªÂÜôÂÆÉÂêßÔºüËÄåÂØπË±°ÂÖ≥Á≥ªÊò†Â∞ÑÊ®°ÂºèÂàôÂæàÂ•ΩÂú∞Ëß£ÂÜ≥‰∫ÜËøô‰∏™ÈóÆÈ¢òÔºåÂÆÉÂÖÅËÆ∏Êàë‰ª¨‰ΩøÁî®Èù¢ÂêëÂØπË±°ÁöÑÊñπÂºèÊù•Êìç‰ΩúÊï∞ÊçÆÂ∫ìÔºå‰ªéËÄåÂèØ‰ª•‰ªéÊô¶Ê∂©ÈöæÊáÇÁöÑ SQL ËØ≠Ë®Ä‰∏≠Ëß£ËÑ±Âá∫Êù•„ÄÇ Android Â∑≤Áªè‰∏∫Êàë‰ª¨Êèê‰æõ‰∫Ü SQLiteOpenHelper ‰ª•Â∏ÆÂä©Êàë‰ª¨ÂÆåÊàêÊï∞ÊçÆÂ∫ìÁöÑÂàõÂª∫„ÄÅË°®ÁöÑÂàõÂª∫„ÄÅ‰ª•ÂèäÊï∞ÊçÆÁöÑ CRUD Êìç‰Ωú„ÄÇ‰ΩÜÊòØ‰ΩøÁî®Ëµ∑Êù•ËøòÊòØ‰∏çÂ§üÊñπ‰æø„ÄÇÂª∫Á´ãÊï∞ÊçÆÂ∫ìÈúÄË¶ÅÁªßÊâø SQLiteOpenHelper ÈáçÂÜôÁõ∏Â∫îÁöÑÊñπÊ≥ïÔºåÂêåÊó∂‰∏∫‰∫ÜÊñπ‰æøÂêéÁª≠ÁöÑÊìç‰ΩúÔºåÊàë‰ª¨ÊØèÂàõÂª∫‰∏ÄÂº†Ë°®ÔºåÈÉΩË¶Å‰∏Ä‰∏™Áõ∏Â∫îÁöÑ DAO Á±ªÔºåÂÆåÊàêÁõ∏Â∫îË°®ÁöÑ CRUD Êìç‰Ωú„ÄÇÂä†Âú®‰∏ÄËµ∑Â∑•‰ΩúÈáèÁúüÁöÑ‰∏çÂ∞è„ÄÇ Â¶ÇÊûú‰ΩøÁî® LitePalÔºåÂè™ÈúÄË¶ÅÂª∫Á´ã‰∏Ä‰∏™ xml ÈÖçÁΩÆÊñá‰ª∂ÔºåÂú®ÂÖ∂‰∏≠ÊåáÂÆöÊï∞ÊçÆÂ∫ìÂêçÁß∞„ÄÅÁâàÊú¨Âè∑Ôºå‰ª•ÂèäÈúÄË¶ÅËøõË°åÊò†Â∞ÑÁöÑÁ±ªÂêçÔºåÁÑ∂ÂêéËÆ© App ÁöÑ Application Á±ªÁªßÊâø LitePalApplication ËøõË°åÂàùÂßãÂåñÔºåÂ∞±ÂèØ‰ª•ÂÆåÊàêÊï∞ÊçÆÂ∫ì„ÄÅË°®ÁöÑÂàõÂª∫Â∑•‰Ωú„ÄÇÂêåÊó∂ÔºåÊï∞ÊçÆÁöÑ CRUD Êìç‰ΩúÂè™ÈúÄË¶ÅÈÄöËøá DataSupport ÁöÑÁõ∏Â∫îÊñπÊ≥ïÂ∞±ËÉΩÂÆåÊàê„ÄÇËøôÊ†∑Â∑•‰ΩúÈáèÊòØ‰∏çÊòØÂ∞ë‰∫ÜÂæàÂ§ö„ÄÇ ÂàùÂßãÂåñÊñáÊ°£‰∏≠Âª∫ËÆÆÈÄöËøáÂ∞ÜÂú® Manifest Êñá‰ª∂‰∏≠ÊåáÂÆö application ‰∏∫ LitePalApplication ÊàñËÄÖÈÄöËøáÁªßÊâø LitePalApplication Êù•ÂÆûÁé∞ÂàùÂßãÂåñ„ÄÇÂàùÂßãÂåñÁöÑÁõÆÁöÑ‰∏∫‰∫ÜÊñπ‰æøËé∑Âèñ Context ÂØπË±° 12345678public class LitePalApplication extends Application &#123; static Context sContext; public LitePalApplication() &#123;//ÈªòËÆ§ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÂàùÂßãÂåñ Context ÈùôÊÄÅÂèòÈáè sContext = this; &#125;&#125; Êï∞ÊçÆÂ∫ìÁöÑÂàõÂª∫Êü•ÁúãÊñáÊ°£ËØ¥ÊòéÔºåÊàë‰ª¨ÂèëÁé∞ table ÁöÑÂàõÂª∫Âíå‰øÆÊîπÈÉΩÊòØËá™Âä®ÂÆûÁé∞ÁöÑ„ÄÇÂØπÂ§ñÂÖ¨ÂºÄÁöÑ‰∏ªË¶ÅÊòØÂØπÊï∞ÊçÆÁöÑÊìç‰ΩúÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±È°∫ÁùÄÂØπÊï∞ÊçÆÁöÑÊìç‰ΩúÊù•ÂàÜÊûê„ÄÇËÄåËøõË°åÊìç‰ΩúÁöÑÂâçÊèêÊòØË°®‰∏≠ÊúâÊï∞ÊçÆÔºåÊàë‰ª¨Â∞±‰ªéÊèíÂÖ•Êìç‰ΩúÔºàÂØπÂ∫î save ÊñπÊ≥ïÔºâÁúãËµ∑„ÄÇ DataSupport#save() 12345public synchronized boolean save() &#123; //‰ª£Á†ÅÁúÅÁï• saveThrows(); //‰ª£Á†ÅÁúÅÁï•&#125; save ‰ºöË∞ÉÁî® saveThrows ÊñπÊ≥ïÔºå DataSupport#saveThrows 1234public synchronized void saveThrows() &#123; SQLiteDatabase db = Connector.getDatabase();//Ëé∑ÂèñÊï∞ÊçÆÂ∫ì//‰ª£Á†ÅÁúÅÁï•&#125; saveThrows ÊñπÊ≥ï‰∏≠È¶ñÂÖàË∞ÉÁî®‰∫Ü Connector.getDatabase() Ëé∑ÂèñÊï∞ÊçÆÂ∫ì„ÄÇ Connector#getDatabase()Connector#getDatabase‰∏ªË¶ÅË∞ÉÁî®ÊµÅÁ®ãÂ¶Ç‰∏ã 123456789101112Connector#getDatabase --&gt; getWritableDatabase --&gt; buildConnection //Ëé∑Âèñ LitePalOpenHelper ÔºàÂÆûÈôÖ‰∏äÊòØ‰∏Ä‰∏™ SQLiteOpenHelperÔºâ --&gt; LitePalAttr.getInstance();//Ëé∑ÂèñÂçï‰æãÂØπË±° --&gt; LitePalAttr = new LitePalAttr();//ÂàõÂª∫ LitePalAttr --&gt; loadLitePalXMLConfiguration();//Âä†ËΩΩ liepal.xml ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ --&gt; LitePalParser.parseLitePalConfiguration() //È¶ñÂÖàËøõË°åËß£Êûê --&gt; //Â∞ÜËß£ÊûêÂà∞ÁöÑÊï∞ÊçÆÔºà Êï∞ÊçÆÂ∫ìÂêç„ÄÅÊï∞ÊçÆÂ∫ìÁâàÊú¨Âè∑„ÄÅÈúÄË¶ÅÊò†Â∞Ñ‰∏∫Ë°®ÁöÑÁ±ªÂêç„ÄÅÊòØÂê¶Â§ßÂ∞èÂÜôÊïèÊÑü„ÄÅÂ≠òÂÇ®Ë∑ØÂæÑ ÔºâËµãÂÄºÁªô LitePalAttr ‰∏≠ÁöÑÂ≠óÊÆµ --&gt; LitePalAttr.checkSelfValid();//ÂèÇÊï∞ÂêàÊ≥ïÊÄßÊ£ÄÊü• --&gt; //ÊûÑÈÄ†Â≠òÂÇ®Ë∑ØÂæÑ --&gt; //ÂàõÂª∫ LitePalOpenHelper --&gt; SQLiteOpenHelper#getWritableDatabase ËôΩÁÑ∂ LitePal Âè∑Áß∞Èõ∂ÈÖçÁΩÆÔºå‰ΩÜÊòØÂü∫Á°ÄÁöÑÂáÜÂ§áÂ∑•‰ΩúËøòÊòØÈúÄË¶ÅÂÅöÁöÑ„ÄÇÊåâÁÖßÂÆòÊñπÊïôÁ®ãÔºåÂú®‰ΩøÁî® LitePal ‰πãÂâçÔºåÈúÄË¶ÅÂú® res ÁõÆÂΩï‰∏ãÈù¢ÂàõÂª∫‰∏Ä‰∏™ xml ÁõÆÂΩïÔºåÁÑ∂ÂêéÂú®ËØ•ÁõÆÂΩï‰∏≠ÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ LitePal ÁöÑ xml Êñá‰ª∂„ÄÇ‰∏æ‰∏™Ê†óÂ≠êÔºö 12345678910111213&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LitePal&gt; &lt;!--Êï∞ÊçÆÂ∫ìÂêç--&gt; &lt;dbname value="library"/&gt; &lt;!--ÁâàÊú¨Âè∑--&gt; &lt;version value="1"/&gt; &lt;!--Êò†Â∞ÑË°®--&gt; &lt;list&gt; &lt;mapping class="com.android.rdc.librarysystem.bean.Book"/&gt; &lt;mapping class="com.android.rdc.librarysystem.bean.BookType"/&gt; &lt;mapping class="com.android.rdc.librarysystem.bean.Borrow"/&gt; &lt;/list&gt;&lt;/LitePal&gt; ÂÖ∂‰∏≠ÁöÑ dbname Ê†áÁ≠æÂ∞±ÊòØÁî®‰∫éÊåáÂÆöÊï∞ÊçÆÂ∫ìÂêçÁöÑ„ÄÇ Connector#buildConnection 123456789101112private static LitePalOpenHelper buildConnection() &#123; LitePalAttr LitePalAttr = LitePalAttr.getInstance(); //Ëé∑ÂèñÂçï‰æãÂØπË±°‚Äî‚ÄîLitePalAttr LitePalAttr.checkSelfValid();//ÂèÇÊï∞ÂêàÊ≥ïÊÄßÊ£ÄÊü• if (mLitePalHelper == null) &#123; String dbName = LitePalAttr.getDbName();// //‚Ä¶‚Ä¶ÁúÅÁï•Ë∑ØÂæÑÂ§ÑÁêÜ‰ª£Á†Å dbName = dbPath + "/" + dbName; mLitePalHelper = new LitePalOpenHelper(dbName, LitePalAttr.getVersion());// &#125; return mLitePalHelper;&#125; È¶ñÊ¨°ËøûÊé•Êï∞ÊçÆÂ∫ìÊó∂ÔºåLitePal ‰ºöÈÄöËøá LitePalParser#parseLitePalConfiguration();ÊñπÊ≥ïÂØπ xml ÈÖçÁΩÆÊñá‰ª∂ËøõË°åËß£Êûê„ÄÇÂ§ß‰ΩìÊµÅÁ®ãÂ∞±ÊòØ‰ΩøÁî® XmlPullParser ÂØπ xml Êñá‰ª∂ÁöÑËß£ÊûêÔºåËß£ÊûêÂÆåÊàê‰πãÂêéÔºåÂ∞±Â∞ÜÁªìÊûú‰øùÂ≠òÂú® LitePalConfigÁ±ª‰∏≠„ÄÇ LitePalConfig Á±ªÂ≠óÊÆµÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö 12345678public class LitePalConfig &#123; private int version;//Êï∞ÊçÆÂ∫ìÁâàÊú¨Âè∑ private String dbName;//Êï∞ÊçÆÂ∫ìÂêç private String cases;//Êï∞ÊçÆÂ∫ìÂ§ßÂ∞èÂÜôÊïèÊÑüÊÄß private String storage;//Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÁöÑÂ≠òÂÇ®Ë∑ØÂæÑÔºåÂèØÈÄâÊã©ÂÜÖÈÉ®Â≠òÂÇ®ÊàñËÄÖÂ§ñÈÉ®Â≠òÂÇ® private List&lt;String&gt; classNames;//ÈúÄË¶ÅËøõË°åÊò†Â∞ÑÁöÑÊ®°ÂûãÁ±ªÔºåÊØè‰∏Ä‰∏™Á±ªÂêçÈÉΩÈúÄË¶ÅÁªôÂÖ®ÂêçÔºàÂåÖÊã¨ÂåÖÂêçÔºâ //‰ª£Á†ÅÁúÅÁï•&#125; Ê≥®ÔºöÂ§ßÂ∞èÂÜôÊïèÊÑüSQLite ÊòØÂ§ßÂ∞èÂÜôÊïèÊÑüÁöÑÔºåÂÖ∑‰ΩìÔºö ÂàõÂª∫Ë°®„ÄÅÂàóÁöÑÊó∂ÂÄôÔºåSQL ËØ≠Âè•ÈáåÊòØ‰ªÄ‰πàÂ§ßÂ∞èÂÜôÔºåË°®Âêç„ÄÅÂàóÂêçÂ∞±ÊòØ‰ªÄ‰πàÂ§ßÂ∞èÂÜôÔºõ SQL ËØ≠Âè•ÊâßË°åÁöÑÊó∂ÂÄôÔºö==Ë°®Âêç„ÄÅÂàóÂêçÂ§ßÂ∞èÂÜô‰∏çÊïèÊÑüÔºåÈÉΩËÉΩËØÜÂà´==Ôºõ SQL ËØ≠Âè•ÈáåÈù¢Ôºå‚Äú=‚ÄùËøòÊòØ LIKE ÈÉΩÊòØÂ§ßÂ∞èÂÜôÊïèÊÑüÔºõ buildConnectionbuildConnection ÊñπÊ≥ïÈ¶ñÂÖà‰ºöÂéªËé∑Âèñ LitePalAttr Âçï‰æãÂØπË±°ÔºàÈ¶ñÊ¨°Ë∞ÉÁî®‰ºöËß¶ÂèëËß£Êûê LitePal.xml Êñá‰ª∂ÔºâÔºåÁÑ∂ÂêéÊ£ÄÊü•ÂèÇÊï∞ÂêàÊ≥ïÊÄßÔºåÂπ∂Ê†πÊçÆËß£ÊûêÂæóÂà∞ÁöÑ LitePalAttr ‰∏≠ÁöÑÂ≠óÊÆµÂàõÂª∫‰∏Ä‰∏™ LitePalOpenHelper„ÄÇ Âà∞ËøôÈáåÔºåÊï∞ÊçÆÂ∫ìÂ∑≤ÁªèÂàõÂª∫ÂÆåÊàê‰∫Ü„ÄÇÈÇ£‰πàÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑË°®ÊòØ‰ªÄ‰πàÊó∂ÂÄôÂàõÂª∫ÁöÑÂë¢ÔºüÂõûÂà∞ÂâçÈù¢ÁöÑ saveThrows ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂú®Ëé∑ÂèñÊï∞ÊçÆÂ∫ì‰πãÂêéÂ∞±ÂºÄÂßãÂÅö‰øùÂ≠òÂ∑•‰Ωú‰∫ÜÔºàË°®ÂàõÂª∫Â∑•‰Ωú‰∏çÂ∫îËØ•ÊîæÂú® ‰øùÂ≠òÂ∑•‰ΩúËøáÁ®ã‰∏≠ÔºåÂõ†‰∏∫ËøôÊ†∑‰∏çÂêàÁêÜÔºâ„ÄÇÂõ†Ê≠§ÔºåË°®ÂæàÂèØËÉΩÂ∞±ÊòØÂú®Êï∞ÊçÆÂ∫ìÂàõÂª∫ËøáÁ®ã‰∏≠È°∫‰æøÂàõÂª∫ÁöÑ„ÄÇÂÆûÈôÖ‰∏ä‰πüÁ°ÆÂÆûÂ¶ÇÊ≠§„ÄÇ LitePalOpenHelper#onCreate Ë∞ÉÁî®Èìæ‰∏ªË¶ÅÊµÅÁ®ãÂ¶Ç‰∏ãÔºö 1234567891011LitePalOpenHelper#onCreate//Êï∞ÊçÆÂ∫ì onCreate ÂõûË∞ÉÊñπÊ≥ï --&gt; Generator#create() --&gt; create(db, true); --&gt; new Creator(); --&gt; creator.createOrUpgradeTable(db, force); --&gt; Ëø≠‰ª£Ë∞ÉÁî® createOrUpgradeTable(tableModel, db, force); --&gt; getCreateTableSQLs(tableModel, db, force) //ÊãºÊé•Âª∫Ë°® sql ËØ≠Âè•ÔºåÂ≠òÂÇ®Âú® ArrayList ‰∏≠ --&gt; execute(); --&gt; Ëø≠‰ª£Ë∞ÉÁî® db.execSQL() ÊâßË°å SQL ËØ≠Âè• --&gt; AssociationCreator#giveTableSchemaACopy --&gt; addAssociation(db, true); ‰∏äËø∞ËøáÁ®ã‰∏≠ÔºåÊàë‰ª¨Áúã‰∏ã getCreateTableSQLs ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ï‰ºöÂÖàÁîüÊàêÂà†Èô§Ë°®ÁöÑËØ≠Âè• sqlÔºåÁÑ∂ÂêéÂÜçÁîüÊàêÂàõÂª∫Ë°®ÁöÑËØ≠Âè•ÔºåÂπ∂Â∞ÜÂÆÉ‰ª¨ÊåâÂ∫èÂ≠òÂú® ArrayList ‰∏≠„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÊØèÊ¨°Âª∫Ë°®‰πãÂâçÂÖàÂ∞ùËØïÂà†Èô§ÂêåÂêçÁöÑË°®ÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâ„ÄÇ 1234567891011121314protected List&lt;String&gt; getCreateTableSQLs(TableModel tableModel, SQLiteDatabase db, boolean force) &#123; List&lt;String&gt; sqls = new ArrayList&lt;String&gt;(); if (force) &#123; sqls.add(generateDropTableSQL(tableModel)); sqls.add(generateCreateTableSQL(tableModel)); &#125; else &#123; if (DBUtility.isTableExists(tableModel.getTableName(), db)) &#123; return null; &#125; else &#123; sqls.add(generateCreateTableSQL(tableModel)); &#125; &#125; return sqls;&#125; Ëá≥Ê≠§Êï∞ÊçÆÂ∫ìÂíåË°®ÂàõÂª∫ÂÆåÊØï„ÄÇ dataSupport#save() ÁöÑËÉåÂêéÂÖàÁúã‰∏ãÊï¥‰ΩìÁöÑË∞ÉÁî®ÊµÅÁ®ã 1234567891011121314151617datasupport#save --&gt; saveThrows --&gt; ÂàõÂª∫ SaveHanlder --&gt; Ë∞ÉÁî® SaveHanlder#onSave --&gt; getSupportedFields//Ëé∑ÂèñÊîØÊåÅÂüü --&gt; getSupportedGenericFields//Ëé∑ÂèñÊîØÊåÅÁöÑÊ≥õÂûãÂüü --&gt; getAssociationInfo//Ëé∑ÂèñÂÖ≥ËÅîÂÖ≥Á≥ª --&gt; if(baseObjId &gt; 0) doUpdateAction//ÊâßË°åÊõ¥Êñ∞Êìç‰Ωú --&gt; else doSaveAction --&gt; values.clear();//Ê∏ÖÁ©∫ ContentValue --&gt; beforeSave();//Â≠òÊîæÂÄºÔºàÂØπË±°Êú¨Ë∫´ÁöÑÂÄº‰∏éÂ§ñÈîÆÔºâ --&gt; long id = saving(); --&gt; SQLiteDatabase#insert()// Â∞ÜËÆ∞ÂΩïÊèíÂÖ•Êï∞ÊçÆÂ∫ì --&gt; SQLiteDatabase#insertWithOnConflict()//ÊãºÊé• sql ËØ≠Âè• --&gt; afterSave() --&gt; clearAssociatedData();//Ê∏ÖÈô§ÊâÄÊúâÁöÑÂÖ≥ËÅîÊï∞ÊçÆ --&gt; SQLiteDatabase#setTransactionSuccessful();//ËÆæÁΩÆ‰∫ãÂä°ÊàêÂäü 123456789public synchronized boolean save() &#123; try &#123; saveThrows(); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125;&#125; LitePal ÊñáÊ°£‰∏≠ÂØπ save ÊñπÊ≥ïÁöÑËØ¥ÊòéÂ¶Ç‰∏ã: Â¶ÇÊûúÊòØ‰∏ÄÊù°Êñ∞ËÆ∞ÂΩïÔºåÂàôÊèíÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑË°å„ÄÇÂ¶ÇÊûú‰øùÂ≠òËøáÁ®ã‰∏≠Âá∫ÈîôÔºåÊï¥‰∏™Êìç‰ΩúÂèñÊ∂àÔºåÁõ∏Â∫îÁöÑ‰øÆÊîπ‰ºöÂõûÊªö„ÄÇÂ¶ÇÊûúÊï∞ÊçÆÁ±ª‰∏≠Âê´ÊúâÂêç‰∏∫ id ÊàñËÄÖ _id Âπ∂‰∏îÁ±ªÂûã‰∏∫ int / long ÁöÑÂ≠óÊÆµÔºåÈÇ£‰πàÂú®ËØ•ÂØπË±°Ë¢´‰øùÂ≠ò‰πãÂêéÂÆÉ‰ª¨‰ºöË¢´Ëµã‰∫àÁõ∏Â∫îÁöÑ id ÂÄº„ÄÇÔºà‰∏é DataSupport Á±ª‰∏≠ÁöÑ baseObjId Áõ∏ÂêåÔºâ ‰ªé synchronized ÂèØ‰ª•ÁúãÂá∫ save ÊòØ‰∏Ä‰∏™ÂêåÊ≠•ÊñπÊ≥ïÔºå‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®„ÄÇÂÆÉÂú®ÂÜÖÈÉ®Ë∞ÉÁî®‰∫Ü saveThrows ÊñπÊ≥ï„ÄÇÂ¶ÇÊûúÊçïËé∑Âà∞ÂºÇÂ∏∏Â∞± return falseÔºõÂê¶Âàô return true Ë°®Á§∫‰øùÂ≠òÊàêÂäü„ÄÇ saveThrowsDataSupport#saveThrows 1234567891011121314public synchronized void saveThrows() &#123; SQLiteDatabase db = Connector.getDatabase();//Ëé∑ÂèñÊï∞ÊçÆÂ∫ì db.beginTransaction();//ÂºÄÂßã‰∫ãÂä° try &#123; SaveHandler saveHandler = new SaveHandler(db);//ÂàõÂª∫ SaveHandlerÔºåÊûÑÈÄ†ÊñπÊ≥ï‰ºöÂàõÂª∫‰∏Ä‰∏™ ContentValues saveHandler.onSave(this);//‰øùÂ≠ò clearAssociatedData();//Ê∏ÖÈô§ÂÖ≥ËÅîÊï∞ÊçÆ db.setTransactionSuccessful();//‰∫ãÂä°ÊàêÂäü &#125; catch (Exception e) &#123; throw new DataSupportException(e.getMessage(), e); &#125; finally &#123; db.endTransaction();//ÁªìÊùü‰∫ãÂä° &#125;&#125; saveThrows ÊñπÊ≥ï‰∏≠‰ΩøÁî®‰∫Ü‰∫ãÂä°‰øùËØÅ‰∫ÜÊï∞ÊçÆÁöÑÂéüÂ≠êÊÄß„ÄÇ‰∏çËøáÂÆÉÊ≤°ÊúâÂÅöÂÖ∑‰ΩìÁöÑ‰øùÂ≠òÂ∑•‰ΩúÔºåËÄåÊòØÂàõÂª∫‰∏Ä‰∏™ SaveHandler ÁÑ∂ÂêéÂ∞ÜËá™Ë∫´ÁöÑÂºïÁî®‰º†ÈÄíÁªô onSave ÊñπÊ≥ï„ÄÇ SaveHandlerÁªßÊâøÁªìÊûÑÂ¶Ç‰∏ãÔºö DataHandler ÊòØ CRUD ÁªÑ‰ª∂ÁöÑÂü∫Á±ª„ÄÇÈáåÈù¢ÂÆö‰πâ‰∫Ü‰∏Ä‰∫õ CRUD Êìç‰ΩúÊâÄÈúÄË¶ÅÈÄöÁî®ÊñπÊ≥ï„ÄÇDataHandler ‰∏≠ÂèàÁªßÊâøËá™LitePalBase„ÄÇLitePalBase ÊòØÊâÄÊúâ ÁöÑ LitePal ÁªÑ‰ª∂ÁöÑÂü∫Á±ª„ÄÇ‰∏ªË¶ÅÊòØÁªôÊúâÂ¶Ç‰∏ãÈúÄÊ±ÇÁöÑÁªÑ‰ª∂Êèê‰æõËß£ÂÜ≥ÊñπÊ°àÔºö‚ë†ÈúÄË¶Å‰∏éÂÖ∂‰ªñÁªÑ‰ª∂ËøõË°å‰∫§‰∫íÁöÑÁªÑ‰ª∂‚ë°ÊúâÈÄöÁî®ÁöÑÈÄªËæë‰ª£Á†ÅÁöÑÁªÑ‰ª∂„ÄÇ SaveHandler ÁªßÊâøËá™ DataHandler„ÄÇ‰ªéÁªßÊâøÂÖ≥Á≥ªÂõæ‰∏≠ÂèØ‰ª•ÁúãÂà∞ÊâÄÊúâÁöÑ CRUD Êìç‰ΩúÈÉΩÊúâÁõ∏Â∫îÁöÑ Handler „ÄÇËÄå‰∏î‰ªñ‰ª¨ÈÉΩÁªßÊâøËá™ DataHandler„ÄÇÊòØ DataSupport ‰∏ãÈù¢ÁöÑ‰∏Ä‰∏™ÁªÑ‰ª∂„ÄÇSaveHandler Â§ÑÁêÜ‰øùÂ≠òÁöÑÂ∑•‰Ωú„ÄÇÊâÄÊúâÁöÑÂÆûÁé∞Âü∫‰∫éÊâÄÊúâÁöÑÂÆûÁé∞ÈÉΩÂü∫‰∫é java ÂèçÂ∞Ñ API Âíå Android SQLiteDatabase API„ÄÇÂÆÉÂ¶ÇÊûúÂÖ≥ËÅîÊ®°ÂûãÂ∑≤ÁªèÂ≠òÂÇ®‰∫ÜÔºåÂÆÉ‰ºöËá™Âä®Âú®ÂΩìÂâçÊ®°Âûã‰∏éÂÖ≥ËÅîÊ®°Âûã‰πãÈó¥Âª∫Á´ãÂÖ≥Á≥ª„ÄÇ SaveHandler#onSave 123456789101112131415161718192021void onSave(DataSupport baseObj) throws SecurityException, IllegalArgumentException, NoSuchMethodException, IllegalAccessException, InvocationTargetException &#123; String className = baseObj.getClassName();//Ëé∑ÂèñË¶Å‰øùÂ≠òÂØπË±°ÁöÑÁ±ªÂêç List&lt;Field&gt; supportedFields = getSupportedFields(className);//Ëé∑ÂèñÊîØÊåÅÁöÑÂ≠óÊÆµ List&lt;Field&gt; supportedGenericFields = getSupportedGenericFields(className);//Ëé∑ÂèñÊîØÊåÅÁöÑÊ≥õÂûã‰ø°ÊÅØ Collection&lt;AssociationsInfo&gt; associationInfos = getAssociationInfo(className);//Ëé∑ÂèñÂÖ≥ËÅî‰ø°ÊÅØ if (!baseObj.isSaved()) &#123; if (!ignoreAssociations) &#123; analyzeAssociatedModels(baseObj, associationInfos); &#125; doSaveAction(baseObj, supportedFields, supportedGenericFields);//ÂØπ id ÂÄº&lt;=0 ÂØπË±°ÊâßË°å‰øùÂ≠òÊìç‰Ωú if (!ignoreAssociations) &#123; analyzeAssociatedModels(baseObj, associationInfos); &#125; &#125; else &#123; if (!ignoreAssociations) &#123; analyzeAssociatedModels(baseObj, associationInfos); &#125; doUpdateAction(baseObj, supportedFields, supportedGenericFields);//ÂØπË±°Êú¨Ë∫´Â≠òÂú®Êï∞ÊçÆÂ∫ì‰∏≠ÔºåÊâßË°åÊõ¥Êñ∞Êìç‰Ωú &#125;&#125; onSave ÊñπÊ≥ï‰ºöÂÖàÂéªÊî∂ÈõÜ LitePal ÊîØÊåÅÁöÑÁ±ªÂûãÂíåÂü∫Á°ÄÁ±ªÂûãÁöÑ Filed Âπ∂Â∞ÜÂÆÉ‰ª¨ÂàÜÂà´Â≠òÂú®‰∏§‰∏™ List ‰∏≠ÔºåÂêåÊó∂‰πü‰ºöËé∑ÂèñÂÖ≥ËÅî‰ø°ÊÅØ„ÄÇÁÑ∂ÂêéÈÄöËøáÂà§Êñ≠ÂØπË±°ÁöÑ baseObjid &gt; 0 ÊòØÂê¶ÊàêÁ´ãÔºå‰∏çÊàêÁ´ãÔºåËØ¥ÊòéÂØπË±°ÊòØ‰∏Ä‰∏™Êú™‰øùÂ≠òÁöÑÂØπË±°ÔºåÊâßË°å doSaveAction ÊñπÊ≥ïÔºõÂê¶ÂàôË∞ÉÁî® doUpdateAction ÊñπÊ≥ï„ÄÇ LitePalBase#getSupportedFields 12345678910111213141516protected List&lt;Field&gt; getSupportedFields(String className) &#123; List&lt;Field&gt; fieldList = classFieldsMap.get(className);//Â∞ùËØï‰ªéÁºìÂ≠ò‰∏≠Ëé∑Âèñ if (fieldList == null) &#123;// List&lt;Field&gt; supportedFields = new ArrayList&lt;Field&gt;(); Class&lt;?&gt; clazz; try &#123; clazz = Class.forName(className);//Ëé∑ÂèñÁ±ªÂêç &#125; catch (ClassNotFoundException e) &#123; throw new DatabaseGenerateException(DatabaseGenerateException.CLASS_NOT_FOUND + className); &#125; recursiveSupportedFields(clazz, supportedFields);//ÈÄíÂΩíÁ±ªÂûã classFieldsMap.put(className, supportedFields);//ÁºìÂ≠òÂà∞ hashMap ‰∏≠ return supportedFields;//ËøîÂõû &#125; return fieldList;//ÁºìÂ≠òÂëΩ‰∏≠&#125; 1234567891011121314151617181920212223private void recursiveSupportedFields(Class&lt;?&gt; clazz, List&lt;Field&gt; supportedFields) &#123; if (clazz == DataSupport.class || clazz == Object.class) &#123; return; &#125; Field[] fields = clazz.getDeclaredFields(); if (fields != null &amp;&amp; fields.length &gt; 0) &#123; for (Field field : fields) &#123; Column annotation = field.getAnnotation(Column.class); if (annotation != null &amp;&amp; annotation.ignore()) &#123;//ÊúâÊ≥®Ëß£Ôºå‰ΩÜÊòØÊ≥®Ëß£ËÆæÁΩÆ‰∏∫ÂøΩÁï• continue; &#125; int modifiers = field.getModifiers();//Ëé∑Âèñ‰øÆÈ•∞Á¨¶ if (!Modifier.isStatic(modifiers)) &#123;//‰∏çÊòØÈùôÊÄÅÁöÑ Class&lt;?&gt; fieldTypeClass = field.getType();//Ëé∑ÂèñÂ≠óÊÆµÂüüÁ±ªÂûã String fieldType = fieldTypeClass.getName();//Â≠óÊÆµÁ±ªÂûãÁöÑÂêçÁß∞ if (BaseUtility.isFieldTypeSupported(fieldType)) &#123; supportedFields.add(field);//ÈùûÈùôÊÄÅ„ÄÅÂπ∂‰∏îÂèóÊîØÊåÅÁöÑÂ≠óÊÆµÊ∑ªÂä†Âà∞ List&lt;Filed&gt; ‰∏≠ &#125; &#125; &#125; &#125; recursiveSupportedFields(clazz.getSuperclass(), supportedFields);&#125; ÈÄíÂΩíË∞ÉÁî®ÔºåÁõ¥Âà∞ÊòØ DataSupport ÊàñËÄÖ Object ‰∏∫Ê≠¢ÔºåÈÄöËøáÂèçÂ∞ÑÂèñÂæóÊâÄÊúâÁöÑ fieldsÔºåÂΩì‰∏çÈúÄË¶ÅÂøΩÁï•Êó∂Ôºå‰∏çÊòØÈùôÊÄÅÔºå‰∏Ä‰∫õÂü∫Êú¨ÊîØÊåÅÁöÑÊï∞ÊçÆÁ±ªÂûãÊó∂‰ºöÁõ¥Êé•Âä†ÂÖ•Âà∞Ëøô‰∏™ fieldList ÈáåËæπ„ÄÇ getSupportedGenericFields() ÊñπÊ≥ï‰∏é‰∏äÈù¢ÁöÑÁ±ª‰ººÔºåÂè™‰∏çËøáÂ§ÑÁêÜÁöÑÊòØÊ≥õÂûã„ÄÇ LitePalBase#getAssociationInfo12345678910private Collection&lt;AssociationsInfo&gt; mAssociationInfos;protected Collection&lt;AssociationsInfo&gt; getAssociationInfo(String className) &#123; if (mAssociationInfos == null) &#123; mAssociationInfos = new HashSet&lt;AssociationsInfo&gt;(); &#125; mAssociationInfos.clear();//Ê∏ÖÁêÜÂÖ≥Á≥ªÈõÜ analyzeClassFields(className, GET_ASSOCIATION_INFO_ACTION);//ÂàÜÊûêÁ±ªÁöÑÂ≠óÊÆµÂüü return mAssociationInfos;&#125; ÂàÜÊûêÁ±ªÂ≠óÊÆµ‰ª•ÊâæÂá∫ÂÖ≥ËÅîÂÖ≥Á≥ª 123456789101112131415161718private void analyzeClassFields(String className, int action) &#123; try &#123; Class&lt;?&gt; dynamicClass = Class.forName(className);//Âä†ËΩΩÁ±ª Field[] fields = dynamicClass.getDeclaredFields();// for (Field field : fields) &#123; if (isNonPrimitive(field)) &#123;//‰∏çÊòØÂéüÁîüÁ±ªÂûã Column annotation = field.getAnnotation(Column.class);//Ëé∑ÂèñÊ≥®Ëß£ if (annotation != null &amp;&amp; annotation.ignore()) &#123; continue; &#125; oneToAnyConditions(className, field, action);//‰∏ÄÂØπÔºüÂÖ≥Á≥ª manyToAnyConditions(className, field, action);//Â§öÂØπÔºüÂÖ≥Á≥ª &#125; &#125; &#125; catch (ClassNotFoundException ex) &#123; //‰ª£Á†ÅÁúÅÁï• &#125;&#125; LitePalBase#oneToAnyConditionsÈ¶ñÂÖàÊàë‰ª¨Ë¶ÅÊòéÁ°ÆÔºåoneToAnyConditions ÊòØÂú®ÈÅçÂéÜÂ§ÑÁêÜÁ±ªÁöÑÊâÄÊúâÂ≠óÊÆµÁöÑËøáÁ®ã‰∏≠Ë∞ÉÁî®ÁöÑ„ÄÇÂπ∂‰∏îÂè™ÊúâÂΩìÂ≠óÊÆµÁ±ªÂûãÊòØÈùûÂéüÁîüÁ±ªÂûãÊó∂Êâç‰ºöËøõÂÖ•ËØ•ÊñπÊ≥ï„ÄÇ ËÆæÊúâ A Âíå B ‰∏§‰∏™Á±ª„ÄÇÁé∞Âú®ÂØπ A ‰∏≠Â≠òÂú®Á±ªÂûã‰∏∫ B ÁöÑÂ≠óÊÆµ„ÄÇÈ¶ñÂÖàÂà§Êñ≠ B ÊòØÂê¶Âú®ÈÖçÁΩÆÊñá‰ª∂ÈáåËæπÈÖçÁΩÆÁöÑ„ÄÇÂ¶ÇÊûúÊòØÔºåÂ∞±ÊâæÂà∞Ëøô‰∏™Á±ªÁöÑÊâÄÊúâÂ≠óÊÆµ„ÄÇÊâæÂà∞‰∏Ä‰∏™Âíå A Áõ∏ÂêåÁöÑÂ≠óÊÆµÔºåËøô‰ª£Ë°® A ÈáåËæπÊúâ‰∏Ä‰∏™ BÔºåB ÈáåËæπÊúâ‰∏Ä‰∏™ AÔºåÊòØ‰∏ÄÂØπ‰∏ÄÂÖ≥Á≥ªÔºõÂ¶ÇÊûú B ÊâæÂà∞ÁöÑÂíå A Áõ∏ÂêåÁöÑÂ≠óÊÆµÊòØ‰∏Ä‰∏™ÈõÜÂêàÔºå‰ª£Ë°® A ÈáåËæπÊúâ‰∏Ä‰∏™ BÔºåB ÈáåËæπÊúâÂ§ö‰∏™ AÔºåÊòØÂ§öÂØπ‰∏ÄÂÖ≥Á≥ª„ÄÇ ÊúÄÂêéÁªü‰∏ÄÊääÂÖ≥Á≥ªÂä†ÂÖ•Âà∞‰∏Ä‰∏™ÈõÜÂêàÈáåËæπÊù•ÁÆ°ÁêÜ„ÄÇ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private void oneToAnyConditions(String className, Field field, int action) throws ClassNotFoundException &#123; Class&lt;?&gt; fieldTypeClass = field.getType();//Ëé∑ÂèñÂ≠óÊÆµÁöÑÁ±ªÂûã //Â≠óÊÆµÁöÑÁ±ªÂûãÂåÖÂê´Âú® LitePal ÈÖçÁΩÆÊñá‰ª∂Êò†Â∞ÑÁöÑÂàóË°®‰∏≠ if (LitePalAttr.getInstance().getClassNames().contains(fieldTypeClass.getName())) &#123; Class&lt;?&gt; reverseDynamicClass = Class.forName(fieldTypeClass.getName());//ÈÄöËøáÁ±ªÂêçÂä†ËΩΩÂ≠óÊÆµÁöÑÁ±ªÔºàÁÆÄÁß∞‰∏∫ BÔºâ Field[] reverseFields = reverseDynamicClass.getDeclaredFields(); boolean reverseAssociations = false; // ÂºÄÂßãÊ£ÄÊü•Á±ª B ‰∏≠ÁöÑÂ±ûÊÄß for (int i = 0; i &lt; reverseFields.length; i++) &#123; Field reverseField = reverseFields[i];// if (!Modifier.isStatic(reverseField.getModifiers())) &#123; Class&lt;?&gt; reverseFieldTypeClass = reverseField.getType(); // B ‰∏≠‰πüÊúâ A ÁöÑÂºïÁî®„ÄÇÂõ†Ê≠§ÊòØ‰∏ÄÂØπ‰∏ÄÁöÑÂèåÂêëÂÖ≥Á≥ª if (className.equals(reverseFieldTypeClass.getName())) &#123; if (action == GET_ASSOCIATIONS_ACTION) &#123; addIntoAssociationModelCollection(className, fieldTypeClass.getName(), fieldTypeClass.getName(), Const.Model.ONE_TO_ONE); &#125; else if (action == GET_ASSOCIATION_INFO_ACTION) &#123; addIntoAssociationInfoCollection(className, fieldTypeClass.getName(), fieldTypeClass.getName(), field, reverseField, Const.Model.ONE_TO_ONE); &#125; reverseAssociations = true; &#125; // B Á±ª‰∏≠ÊúâÂ≠óÊÆµÔºö List&lt;A&gt; ËØ¥ÊòéÊòØÂ§öÂØπ‰∏ÄÂÖ≥Á≥ª else if (isCollection(reverseFieldTypeClass)) &#123; String genericTypeName = getGenericTypeName(reverseField); if (className.equals(genericTypeName)) &#123; if (action == GET_ASSOCIATIONS_ACTION) &#123; addIntoAssociationModelCollection(className, fieldTypeClass.getName(), className, Const.Model.MANY_TO_ONE); &#125; else if (action == GET_ASSOCIATION_INFO_ACTION) &#123; addIntoAssociationInfoCollection(className, fieldTypeClass.getName(), className, field, reverseField, Const.Model.MANY_TO_ONE); &#125; reverseAssociations = true; &#125; &#125; &#125; &#125; // B ‰∏≠Ê≤°Êúâ A ÁöÑÂºïÁî®ÔºåAB ÊòØÂçïÂêëÁöÑ‰∏ÄÂØπ‰∏ÄÂÖ≥Á≥ª if (!reverseAssociations) &#123; if (action == GET_ASSOCIATIONS_ACTION) &#123; addIntoAssociationModelCollection(className, fieldTypeClass.getName(), fieldTypeClass.getName(), Const.Model.ONE_TO_ONE); &#125; else if (action == GET_ASSOCIATION_INFO_ACTION) &#123; addIntoAssociationInfoCollection(className, fieldTypeClass.getName(), fieldTypeClass.getName(), field, null, Const.Model.ONE_TO_ONE); &#125; &#125; &#125;&#125; manyToAnyConditions ‰πüÊòØÈÄöËøáÁ±ª‰ººÁöÑÈÄªËæëËøõË°åÂàÜÊûêÂ§ÑÁêÜ„ÄÇ ÂõûÂà∞ saveThrows ÊñπÊ≥ïÔºåÂèØ‰ª•ÁúãÂà∞ÂêéÁª≠‰ºöË∞ÉÁî® doSaveAction„ÄÇ doSaveAction12345678private void doSaveAction(DataSupport baseObj, List&lt;Field&gt; supportedFields, List&lt;Field&gt; supportedGenericFields) throws SecurityException, IllegalArgumentException, NoSuchMethodException, IllegalAccessException, InvocationTargetException &#123; values.clear();//ÂÖàÊ∏ÖÈô§ contentValue ‰∏≠ÁöÑÂÄº beforeSave(baseObj, supportedFields, values); long id = saving(baseObj, values);//‰øùÂ≠ò afterSave(baseObj, supportedFields, supportedGenericFields, id);&#125; doSaveAction ÊñπÊ≥ï‰∏≠‰æùÊ¨°Ë∞ÉÁî®‰∫Ü beforeSave saving afterSave ‰∏â‰∏™ÊñπÊ≥ï„ÄÇ beforeSave ÊñπÊ≥ï‰ºöÂ∞ÜÁõ∏Â∫îÁöÑÂ≠óÊÆµÂàó‰∏éÂÄº‰ª•ÈîÆÂÄºÂØπÁöÑÂΩ¢ÂºèÂ≠òÊîæÂà∞ values ‰∏≠Ôºå values Â∞Ü‰Ωú‰∏∫ÂêéÈù¢ saving ÊñπÊ≥ïÁöÑÂèÇÊï∞„ÄÇ saving ÊñπÊ≥ïÂÜÖÈÉ®‰ºöË∞ÉÁî® Ë∞ÉÁî® SQLiteDatabase#insert ÊñπÊ≥ïÂØπÊï∞ÊçÆËøõË°å‰øùÂ≠ò„ÄÇ afterSave ÊâÄÂÅöÁöÑÂ∑•‰ΩúÊòØËé∑ÂèñÂàöÂàö‰øùÂ≠òÁöÑÈÇ£Êù°ËÆ∞ÂΩïÁöÑ id ÔºåÁÑ∂Âêé‰ª•ÂèçÂ∞ÑÁöÑÂΩ¢ÂºèÂ∞ÜÂÆÉËµãÁªôÂØπË±°ÁöÑ baseObjId Â≠óÊÆµÔºåÂêåÊó∂Ëøò‰ºöÊõ¥Êñ∞ÂÖ≥ËÅîË°®ÁöÑÊï∞ÊçÆ 123456private long saving(DataSupport baseObj, ContentValues values) &#123; if (values.size() == 0) &#123;//Â¶ÇÊûú contentValue ‰∏≠ÁöÑÂ§ßÂ∞è‰∏∫ 0ÔºåÈÇ£Â∞±Â≠òÂÇ®‰∏Ä‰∏™‰ªÖÊúâ id ÁöÑÁ©∫Ë°å values.putNull("id"); &#125; return mDatabase.insert(baseObj.getTableName(), null, values);//Áªà‰∫éÁúãÂà∞‰∫Ü SqlLite ÁöÑ‰øùÂ≠òÊìç‰Ωú&#125; SQLiteDatabase#insertinsert ÊñπÊ≥ïÂÜÖÈÉ®‰ºöË∞ÉÁî® SQLiteDatabase#insertWithOnConflict ÊñπÊ≥ï„ÄÇ ÂèØ‰ª•ÁúãÂà∞ËØ•ÊñπÊ≥ïÁöÑÂÆûÁé∞ÊòØÂ∞ÜÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªìÊûÑÊãºÊé•‰∏∫‰∏Ä‰∏™ SQL ÊèíÂÖ•ËØ≠Âè• 123456789101112131415161718192021222324252627282930313233343536373839404142434445private static final String[] CONFLICT_VALUES = new String[] &#123;"", " OR ROLLBACK ", " OR ABORT ", " OR FAIL ", " OR IGNORE ", " OR REPLACE "&#125;;public long insertWithOnConflict(String table, String nullColumnHack, ContentValues initialValues, int conflictAlgorithm) &#123; acquireReference(); try &#123; StringBuilder sql = new StringBuilder(); sql.append("INSERT"); sql.append(CONFLICT_VALUES[conflictAlgorithm]); sql.append(" INTO "); sql.append(table);//Ë°®Âêç sql.append('('); Object[] bindArgs = null; int size = (initialValues != null &amp;&amp; !initialValues.isEmpty()) ? initialValues.size() : 0; if (size &gt; 0) &#123; bindArgs = new Object[size]; int i = 0; for (String colName : initialValues.keySet()) &#123; sql.append((i &gt; 0) ? "," : ""); sql.append(colName);//Ê∑ªÂä†ÂêçÁß∞ bindArgs[i++] = initialValues.get(colName);//ÂàóÂêçÂØπÂ∫îÁöÑÂÄºÔºåÂ∞ÜÂÖ∂Â≠òÂú®Êï∞ÁªÑ‰∏≠ &#125; sql.append(')'); sql.append(" VALUES ("); for (i = 0; i &lt; size; i++) &#123; sql.append((i &gt; 0) ? ",?" : "?"); &#125; &#125; else &#123; sql.append(nullColumnHack + ") VALUES (NULL");//Á©∫Ë°å &#125; sql.append(')'); SQLiteStatement statement = new SQLiteStatement(this, sql.toString(), bindArgs);// Âà©Áî®Ë°®ÂêçÔºå‰ª•ÂèäÈúÄË¶ÅÊõ¥Êñ∞ÁöÑÂàóÂêçÔºåËøòÊúâÁõ∏Â∫îÁöÑÂàóÂèÇÊï∞„ÄåbindArgs„Äç ÂàõÂª∫‰∏Ä‰∏™ SQLiteStatement try &#123; return statement.executeInsert();//ÊâßË°åÊèíÂÖ•Êìç‰Ωú &#125; finally &#123; statement.close(); &#125; &#125; finally &#123; releaseReference();//ÈáäÊîæÂºïÁî® &#125;&#125; Ëá≥Ê≠§Ôºåsave ËøáÁ®ãÂàÜÊûêÂÆåÊàê„ÄÇ find ËøáÁ®ãÊµÖÊûêDataSupport#find Â§ß‰ΩìÊµÅÁ®ãÔºö 123456789101112find() --&gt; find(modelClass, id, false); --&gt; ÂàõÂª∫ QueryHandler --&gt; queryHandler#onFind --&gt; query //Ëé∑ÂèñÁ¨¶ÂêàÊù°‰ª∂ÁöÑ list --&gt; DataHandler#query --&gt; getSupportedFields //Ëé∑ÂèñÊîØÊåÅÁöÑÂ≠óÊÆµ --&gt; //Ë∞ÉÁî®Áõ∏ÂÖ≥ÊñπÊ≥ï„ÄÇÂÅö‰∏Ä‰∫õÈì∫Âû´Â∑•‰Ωú --&gt; SQLiteDatabase#query //Ë∞ÉÁî® SQLiteDataBase#query ÔºàËØ•ÊñπÊ≥ïÊúÄÁªà‰ºöË∞ÉÁî® buildQueryString ÊãºÊé•Âá∫Â≠óÁ¨¶‰∏≤Ôºâ„ÄÇÁÑ∂ÂêéÈÄöËøá cursor ÈÄêË°åÂèñÂá∫Êï∞ÊçÆ --&gt; //ÁúÅÁï•‰∏Ä‰∫õËΩ¨ÂèëÊñπÊ≥ï --&gt; SQLiteDatabase#queryWithFactory --&gt; SQLiteQueryBuilder#buildQueryString//ÊãºÊé• sql ËØ≠Âè• SQLiteQueryBuilder#buildQueryString1234567891011121314151617181920212223242526272829303132public static String buildQueryString( boolean distinct, String tables, String[] columns, String where, String groupBy, String having, String orderBy, String limit) &#123; if (TextUtils.isEmpty(groupBy) &amp;&amp; !TextUtils.isEmpty(having)) &#123; throw new IllegalArgumentException( "HAVING clauses are only permitted when using a groupBy clause"); &#125; if (!TextUtils.isEmpty(limit) &amp;&amp; !sLimitPattern.matcher(limit).matches()) &#123; throw new IllegalArgumentException("invalid LIMIT clauses:" + limit); &#125; StringBuilder query = new StringBuilder(120); query.append("SELECT "); if (distinct) &#123; query.append("DISTINCT "); &#125; if (columns != null &amp;&amp; columns.length != 0) &#123; appendColumns(query, columns); &#125; else &#123; query.append("* "); &#125; query.append("FROM "); query.append(tables); appendClause(query, " WHERE ", where); appendClause(query, " GROUP BY ", groupBy); appendClause(query, " HAVING ", having); appendClause(query, " ORDER BY ", orderBy); appendClause(query, " LIMIT ", limit); return query.toString();&#125; Â∞èÁªìÔºöfind Â∞±ÊòØÈÄöËøáÁõ∏Â∫îÁöÑÊü•ËØ¢Êù°‰ª∂ÊãºÊé•‰∏∫ SQL Êü•ËØ¢ËØ≠Âè•ÔºåÁÑ∂ÂêéÂ∞ÜÊü•ËØ¢ÁªìÊûúËøîÂõû„ÄÇ ÈóÆÈ¢òÔºöÂêåÊ≠•/ÂºÇÊ≠•ÂØπ‰∫éÊØè‰∏Ä‰∏™ CRUD Êìç‰ΩúÔºåLitePal ÈÉΩÊúâÂêåÊ≠•‰ª•ÂèäÁõ∏ÂØπÂ∫îÁöÑÂºÇÊ≠•ÊñπÊ≥ï„ÄÇ ‰ª•ÂºÇÊ≠• save ‰∏∫‰æãÂºÇÊ≠•Êõ¥Êñ∞Âè™ÊòØÊñ∞ÂºÄ‰∏ÄÊù°Á∫øÁ®ãÊù•ÊâßË°å save ÊñπÊ≥ïÔºåÂπ∂Âú®‰∏ªÁ∫øÁ®ãËøõË°åÁªìÊûúÂõûË∞É 123456789101112131415161718192021public SaveExecutor saveAsync() &#123; final SaveExecutor executor = new SaveExecutor();//ÂèÇÂä†‰∏Ä‰∏™ SaveExecutor Runnable runnable = new Runnable() &#123;//ÂàõÂª∫‰∏Ä‰∏™ Runnable ÂåøÂêçÂÜÖÈÉ®Â≠êÁ±ªÔºå @Override public void run() &#123; synchronized (DataSupport.class) &#123; final boolean success = save();//Ë∞ÉÁî®‰øùÂ≠òÊñπÊ≥ï if (executor.getListener() != null) &#123; LitePal.getHandler().post(new Runnable() &#123;//ÂàáÊç¢Âà∞‰∏ªÁ∫øÁ®ã‰∏≠ÂõûË∞É @Override public void run() &#123; executor.getListener().onFinish(success);//ÂõûË∞É &#125; &#125;); &#125; &#125; &#125; &#125;; executor.submit(runnable); return executor;&#125; 1234567891011121314151617public class SaveExecutor extends AsyncExecutor &#123; private SaveCallback cb;//ÂõûË∞ÉÊé•Âè£ /** * Ê≥®ÂÜåÂõûË∞ÉÊé•Âè£‰πãÂêéÔºåÈ©¨‰∏äÊâßË°åÂºÇÊ≠•‰ªªÂä° */ public void listen(SaveCallback callback) &#123;//Ê≥®ÂÜåÂõûË∞É cb = callback; execute();//ÊâßË°åÂºÇÊ≠•‰ªªÂä° &#125; public SaveCallback getListener() &#123; return cb; &#125;&#125; SaveExecutor ÁªßÊâøËá™ AsyncExecutor„ÄÇÁâπÂà´‰πãÂ§ÑÂú®‰∫éÂÆÉÊòØÈÄöËøá listen ÊñπÊ≥ïÊù•Ëß¶ÂèëÂºÇÊ≠•‰ªªÂä°ÊâßË°åÁöÑ„ÄÇ 123456789101112131415161718192021public abstract class AsyncExecutor &#123; private Runnable pendingTask;//Âª∂Êó∂‰ªªÂä° /** * Êèê‰∫§‰ªªÂä° */ public void submit(Runnable task) &#123; pendingTask = task; &#125; /** * ÂêéÂè∞ÊâßË°åÂª∂Êó∂‰ªªÂä° */ void execute() &#123; if (pendingTask != null) &#123; new Thread(pendingTask).start();//Êñ∞Âª∫Á∫øÁ®ãÊâßË°å‰ªªÂä° &#125; &#125;&#125; AsyncExecutor ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂºÇÊ≠•ÊâßË°åÂô®ÔºåÂú®ÂêéÂè∞Á∫øÁ®ã‰∏≠ËøêË°å‰ªªÂä°„ÄÇÂÆÉÊòØÊâÄÊúâÁöÑÂºÇÊ≠•Êìç‰ΩúÊâßË°åÂô®ÁöÑÂü∫Á±ª„ÄÇ ÊÄªÁªìLitePal ÈúÄË¶ÅÂú® Application ‰∏≠ËøõË°åÂàùÂßãÂåñ„ÄÇÈ¶ñÊ¨°Ëé∑ÂèñÊï∞ÊçÆÂ∫ìÁöÑÊó∂‰ºöËß¶ÂèëÊï∞ÊçÆÂ∫ì‰ª•ÂèäË°®ÁöÑÂàõÂª∫„ÄÇÂêéÁª≠ÁöÑ CRUD Êìç‰ΩúÈÉΩÊòØÈÄöËøáÂèçÂ∞ÑÊú∫Âà∂Âíå Android SQLite API Êù•ÂÆûÁé∞ÁöÑ„ÄÇÂÆÉ‰ºöËá™Âä®ÂàÜÊûêË°®‰∏éË°®‰πãÈó¥ÁöÑÂÖ≥ËÅîÂÖ≥Á≥ªÔºåÂπ∂Â∏ÆÂä©ÂàõÂª∫Ë°®„ÄÅËá™Âä®ÁÆ°ÁêÜË°®„ÄÇ ‰ºòÁÇπÔºöÈÖçÁΩÆÁÆÄÂçïÔºåÊìç‰ΩúÊñπ‰æøÔºå‰∏öÂä°ÂØπË±°Ê∏ÖÊô∞ÔºåLitePal Âæà„ÄåËΩª„ÄçÔºåjar ÂåÖÂè™Êúâ 100k ‰∏çÂà∞„ÄÇ Áº∫ÁÇπ ÂèçÂ∞ÑÂΩ±ÂìçÊÄßËÉΩ„ÄÇ Êó†Ê≥ïÁõ¥Êé•ËøõË°åÂÖ≥ËÅîÊü•ËØ¢„ÄÇ ‰∏éÂêåÁ±ªÊ°ÜÊû∂ÔºàGreenDAOÔºâÂØπÊØîÔºöGreetDao ‰∏ÄÂºÄÂßãÂ∞±‰∫∫Â∑•ÁîüÊàê‰∏öÂä°ÈúÄË¶ÅÁöÑ Model Âíå DAO Êñá‰ª∂Ôºå‰∏öÂä°‰∏≠ÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®Áõ∏Â∫îÁöÑ DAO Êñá‰ª∂ËøõË°åÊï∞ÊçÆÂ∫ìÁöÑÂ¢ûÂà†ÊîπÊü•Êìç‰ΩúÔºå‰ªéËÄåÈÅøÂÖç‰∫ÜÂõ†ÂèçÂ∞ÑÂ∏¶Êù•ÁöÑÊÄßËÉΩÊçüËÄóÂíåÊïàÁéá‰Ωé„ÄÇÂõ†Ê≠§Â§ßÊâπÈáèÁöÑÊèíÂÖ•„ÄÅÊõ¥Êñ∞„ÄÅÊü•ËØ¢Á≠âÊìç‰ΩúÔºågreenDAO Áî®Êó∂Áü≠ÔºåÊâßË°åÂø´Êõ¥ÈÄÇÂêà„ÄÇ‰ΩÜÊòØ greenDAO ‰ΩøÁî®‰∏çÊñπ‰æøÔºåÂ≠¶‰π†ÊàêÊú¨ËæÉÈ´ò„ÄÇ Â¶ÇÊûúÂ∫îÁî®ÂØπÊÄßËÉΩË¶ÅÊ±Ç‰∏çÊòØÁâπÂà´ËãõÂàªÂπ∂‰∏îÊï∞ÊçÆÈáè‰πü‰∏çÂ§ßÁöÑÊÉÖÂÜµ‰∏ãÔºåËΩªÈáèÁ∫ßÁöÑ LitePalÔºåÂü∫Êú¨ËÉΩÊª°Ë∂≥Êàë‰ª¨ÁöÑÈúÄÊ±Ç‰∫Ü„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Êï∞ÊçÆÂ∫ì ORM ‰πã LitePal Android Êï∞ÊçÆÂ∫ìÈ´òÊâãÁßòÁ±ç Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫êÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê∫êÁ†ÅÂàÜÊûê</category>
        <category>Ê°ÜÊû∂ÂéüÁêÜ</category>
      </categories>
      <tags>
        <tag>Ê∫êÁ†ÅÂàÜÊûê</tag>
        <tag>Ê°ÜÊû∂ÂéüÁêÜ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊãÜËΩÆÂ≠êÁ≥ªÂàó‚Äî‚ÄîEventBus Ê∫êÁ†ÅËß£Êûê]]></title>
    <url>%2Fblog%2F2017%2F10%2F14%2F%E6%8B%86%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94EventBus%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[È°πÁõÆÂú∞ÂùÄÔºöEventBusÔºåÊú¨ÊñáÂàÜÊûêÁâàÊú¨: 3.1.1 ‰∏Ä„ÄÅÊ¶ÇËø∞EventBus ÊòØ‰∏Ä‰∏™ Android ‰∫ã‰ª∂ÂèëÂ∏É/ËÆ¢ÈòÖÊ°ÜÊû∂ÔºåÈÄöËøáËß£ËÄ¶ÂèëÂ∏ÉËÄÖÂíåËÆ¢ÈòÖËÄÖÁÆÄÂåñ Android ‰∫ã‰ª∂‰º†ÈÄíÔºåËøôÈáåÁöÑ‰∫ã‰ª∂ÂèØ‰ª•ÁêÜËß£‰∏∫Ê∂àÊÅØÔºåÊú¨Êñá‰∏≠Áªü‰∏ÄÁß∞‰∏∫‰∫ã‰ª∂„ÄÇ‰∫ã‰ª∂‰º†ÈÄíÊó¢ÂèØÁî®‰∫é Android ÂõõÂ§ßÁªÑ‰ª∂Èó¥ÈÄöËÆØÔºå‰πüÂèØ‰ª•Áî®Êà∑ÂºÇÊ≠•Á∫øÁ®ãÂíå‰∏ªÁ∫øÁ®ãÈó¥ÈÄöËÆØÁ≠âÁ≠â„ÄÇ‰º†ÁªüÁöÑ‰∫ã‰ª∂‰º†ÈÄíÊñπÂºèÂåÖÊã¨ÔºöHandler„ÄÅBroadCastReceiver„ÄÅInterface ÂõûË∞ÉÔºåÁõ∏ÊØî‰πã‰∏ã EventBus ÁöÑ‰ºòÁÇπÊòØ‰ª£Á†ÅÁÆÄÊ¥ÅÔºå‰ΩøÁî®ÁÆÄÂçïÔºåÂπ∂Â∞Ü‰∫ã‰ª∂ÂèëÂ∏ÉÂíåËÆ¢ÈòÖÂÖÖÂàÜËß£ËÄ¶„ÄÇ ‰∫ã‰ª∂(Event)ÔºöÂèàÂèØÁß∞‰∏∫Ê∂àÊÅØÔºåÊú¨Êñá‰∏≠Áªü‰∏ÄÁî®‰∫ã‰ª∂Ë°®Á§∫„ÄÇÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™ÂØπË±°ÔºåÂèØ‰ª•ÊòØÁΩëÁªúËØ∑Ê±ÇËøîÂõûÁöÑÂ≠óÁ¨¶‰∏≤Ôºå‰πüÂèØ‰ª•ÊòØÊüê‰∏™ÂºÄÂÖ≥Áä∂ÊÄÅÁ≠âÁ≠â„ÄÇ‰∫ã‰ª∂Á±ªÂûã(EventType)Êåá‰∫ã‰ª∂ÊâÄÂ±ûÁöÑ Class„ÄÇ ‰∫ã‰ª∂ÂàÜ‰∏∫‰∏ÄËà¨‰∫ã‰ª∂Âíå Sticky ‰∫ã‰ª∂ÔºåÁõ∏ÂØπ‰∫é‰∏ÄËà¨‰∫ã‰ª∂ÔºåSticky ‰∫ã‰ª∂‰∏çÂêå‰πãÂ§ÑÂú®‰∫éÔºåÂΩì‰∫ã‰ª∂ÂèëÂ∏ÉÂêéÔºåÂÜçÊúâËÆ¢ÈòÖËÄÖÂºÄÂßãËÆ¢ÈòÖËØ•Á±ªÂûã‰∫ã‰ª∂Ôºå‰æùÁÑ∂ËÉΩÊî∂Âà∞ËØ•Á±ªÂûã‰∫ã‰ª∂ÊúÄËøë‰∏Ä‰∏™ Sticky ‰∫ã‰ª∂ÔºàÊâÄË∞ì„ÄåÊúÄËøë‰∏Ä‰∏™„ÄçÊåáÁöÑÂ∞±ÊòØËØ•Á±ªÂûã‰∫ã‰ª∂„ÄåÊúÄÂêé‰∏ÄÊ¨°ÂèëÂá∫„ÄçÔºâ„ÄÇ ËÆ¢ÈòÖËÄÖ(Subscriber)ÔºöËÆ¢ÈòÖÊüêÁßç‰∫ã‰ª∂Á±ªÂûãÁöÑÂØπË±°„ÄÇÂΩìÊúâÂèëÂ∏ÉËÄÖÂèëÂ∏ÉËøôÁ±ª‰∫ã‰ª∂ÂêéÔºåEventBus ‰ºöÊâßË°åËÆ¢ÈòÖËÄÖÁöÑ onEvent ÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞Âè´‰∫ã‰ª∂ÂìçÂ∫îÂáΩÊï∞„ÄÇËÆ¢ÈòÖËÄÖÈÄöËøá register Êé•Âè£ËÆ¢ÈòÖÊüê‰∏™‰∫ã‰ª∂Á±ªÂûãÔºåunregister Êé•Âè£ÈÄÄËÆ¢„ÄÇËÆ¢ÈòÖËÄÖÂ≠òÂú®‰ºòÂÖàÁ∫ßÔºå‰ºòÂÖàÁ∫ßÈ´òÁöÑËÆ¢ÈòÖËÄÖÂèØ‰ª•ÂèñÊ∂à‰∫ã‰ª∂ÁªßÁª≠Âêë‰ºòÂÖàÁ∫ß‰ΩéÁöÑËÆ¢ÈòÖËÄÖÂàÜÂèëÔºåÈªòËÆ§ÊâÄÊúâËÆ¢ÈòÖËÄÖ‰ºòÂÖàÁ∫ßÈÉΩ‰∏∫ 0„ÄÇ ÂèëÂ∏ÉËÄÖ(Publisher)ÔºöÂèëÂ∏ÉÊüê‰∫ã‰ª∂ÁöÑÂØπË±°ÔºåÈÄöËøá post Êé•Âè£ÂèëÂ∏É‰∫ã‰ª∂„ÄÇ ‰∫å„ÄÅÂ¶Ç‰Ωï‰ΩøÁî®2.1 Ê∑ªÂä†‰æùËµñÊñπÂºè‰∏ÄÔºåËøêË°åÊúüÂ§ÑÁêÜÊ≥®Ëß£Âú®app ÁöÑ build.gradle Êñá‰ª∂‰∏≠Ê∑ªÂä†‰æùËµñ 123dependencies &#123; implementation 'org.greenrobot:eventbus:3.1.1'&#125; ÊñπÂºè‰∫åÔºåÁºñËØëÊúüÈ¢ÑÂ§ÑÁêÜÊ≥®Ëß£Android Studio 3.0 Âèä‰ª•‰∏ä Âú® app ÁöÑ build.gradle Êñá‰ª∂‰∏≠Ê∑ªÂä† 12345678910111213141516android &#123; //‚Ä¶‚Ä¶ defaultConfig &#123; //‚Ä¶‚Ä¶ javaCompileOptions &#123; annotationProcessorOptions &#123; arguments = [eventBusIndex: 'org.greenrobot.eventbusperf.MyEventBusIndex'] &#125; &#125; &#125;&#125;dependencies &#123; implementation 'org.greenrobot:eventbus:3.1.1' annotationProcessor 'org.greenrobot:eventbus-annotation-processor:3.0.1'&#125; build ‰πãÂêéÔºå‰ºöÁîüÊàê‰∏Ä‰∏™ MyEventBusIndex.javaÁ±ª„ÄÇ ÁÑ∂ÂêéÂú®‰ΩøÁî® EventBus ÂÆû‰æã‰πãÂâçÔºåÂèàÊúâ‰∏§ÁßçÊñπÂºèÂèØ‰ª•Â∞ÜÈÖçÁΩÆMyEventBusIndex.javaÈÖçÁΩÆÂà∞Á±ª‰∏≠ÊòØÂìüÁªè„ÄÇ ÊñπÂºè‰∏Ä Âú®ÊûÑÈÄ† EventBus Êó∂‰º†ÂÖ•Êàë‰ª¨Ëá™ÂÆö‰πâÁöÑ EventBusIndexÔºå1EventBus mEventBus = EventBus.builder().addIndex(new MyEventBusIndex()).build(); ÊñπÂºè‰∫å Â∞ÜÁ¥¢ÂºïÂ∫îÁî®Âà∞ÈªòËÆ§ÁöÑÂçï‰æã‰∏≠‰ΩøÁî® EventBus ‰πãÂâçÔºåÂÖàË∞ÉÁî®‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÂàùÂßãÂåñ EventBus„ÄÇ 1EventBus.builder().addIndex(new MyEventBusIndex()).installDefaultEventBus(); 2.2 ÂÆö‰πâ‰∫ã‰ª∂Á±ª1234567891011121314public class CustomEvent &#123; private String mEventName; public CustomEvent() &#123; &#125; public String getEventName() &#123; return mEventName; &#125; public void setEventName(String eventName) &#123; mEventName = eventName; &#125;&#125; 2.3 Ê≥®ÂÜå‰∏∫ÁõëÂê¨ËÄÖÂú®ÂêàÈÄÇÁöÑÂú∞ÊñπÔºàÊØîÂ¶Ç Activity#onCreate„ÄÅFragment#onCreateViewÔºâÈÄöËøá‰∏ãÊñπ‰ª£Á†ÅËøõË°åÊ≥®ÂÜå EventBus.getDefault().register(this); 2.4 ÁºñÂÜôÂìçÂ∫î‰∫ã‰ª∂ÁöÑËÆ¢ÈòÖÊñπÊ≥ï1234@Subscribe(threadMode = ThreadMode.BACKGROUND, sticky = true, priority = 100)public void onMessage(CustomEvent event) &#123; Log.d(TAG, "onMessage: " + event.getEventName());&#125; ‰ΩøÁî®ÁºñËØëÊúüÊ≥®Ëß£Â§ÑÁêÜÁöÑÊÉÖÂÜµ‰∏ãÔºåËÆ¢ÈòÖÊñπÊ≥ïÁöÑËÆøÈóÆÊéßÂà∂ÊùÉÈôêÂøÖÈ°ªÊòØ Èùû private Âπ∂‰∏îÈùû static ÁöÑ ‰ΩøÁî®ËøêË°åÊúüÂèçÂ∞ÑÂ§ÑÁêÜÁöÑÊÉÖÂÜµ‰∏ãÔºåËÆ¢ÈòÖÊñπÊ≥ïÁöÑËÆøÈóÆÊéßÂà∂ÊùÉÈôêÂøÖÈ°ªÊòØ public ÁöÑ ÈÄöËøá ThreadMode ÂèØ‰ª•ÊåáÂÆöËÆ¢ÈòÖÊñπÊ≥ïÂú®Âì™‰∏™Á∫øÁ®ãÊâßË°åÔºåÊúâÂõõÁßçÈÄâÊã© ThreadMode.MAIN ‰∫ã‰ª∂ËÆ¢ÈòÖÊñπÊ≥ï‰ºöÂú® UI Á∫øÁ®ã‰∏≠ÊâßË°å ‰ΩøÁî®Ê≠§Ê®°ÂºèÁöÑ‰∫ã‰ª∂ËÆ¢ÈòÖÊñπÊ≥ïÂøÖÈ°ªÂø´ÈÄüËøîÂõû‰ª•ÈÅøÂÖçÈòªÂ°û‰∏ªÁ∫øÁ®ã„ÄÇ ThreadMode.POSTING ÔºàÈªòËÆ§ÁöÑÊ®°ÂºèÔºâË°®Á§∫‰∫ã‰ª∂Âú®Âì™‰∏™Á∫øÁ®ã‰∏≠ÂèëÂ∏ÉÂá∫Êù•ÁöÑÔºå‰∫ã‰ª∂ËÆ¢ÈòÖÊñπÊ≥ïÂ∞±‰ºöÂú®Ëøô‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÔºõ ËØ•Ê®°ÂºèÈÅøÂÖç‰∫ÜÁ∫øÁ®ãÂàáÊç¢ÔºåÈÄÇÁî®‰∫éÈÇ£‰∫õÂú®ÂæàÁü≠ÁöÑÊó∂Èó¥ÂÜÖÂÆåÊàêÁöÑÁÆÄÂçï‰ªªÂä°ÔºåÊó†ÈúÄ‰∏ªÁ∫øÁ®ã„ÄÇ‰ΩøÁî®ËøôÁßçÊ®°ÂºèÁöÑ‰∫ã‰ª∂ËÆ¢ÈòÖÊñπÊ≥ïÂøÖÈ°ªÂø´ÈÄüËøîÂõû‰ª•ÈÅøÂÖçÈòªÂ°ûÂèëÂ∏ÉÁ∫øÁ®ãÔºàÂèëÂ∏ÉÁ∫øÁ®ãÂèØËÉΩÊòØ‰∏ªÁ∫øÁ®ãÔºâ„ÄÇ ThreadMode.MAIN_ORDERED Âú® Android ‰∏äÔºåËÆ¢ÈòÖÊñπÊ≥ïÂ∞ÜÂú® Android ÁöÑ‰∏ªÁ∫øÁ®ã‰∏≠Ë¢´Ë∞ÉÁî®„ÄÇ‰∫ã‰ª∂Â∞Ü‰ºöÊéíÈòüÁ≠âÂæÖ‰∫§‰ªòÔºåËøôÁ°Æ‰øù‰∫Ü post Ë∞ÉÁî®ÊòØÈùûÈòªÂ°ûÁöÑ„ÄÇ ThreadMode.BACKGROUND Â≠êÁ∫øÁ®ãÊâßË°åÔºåÂ¶ÇÊûúÊú¨Êù•Â∞±Âú®Â≠êÁ∫øÁ®ãÔºåÁõ¥Êé•Âú®ËØ•Â≠êÁ∫øÁ®ãÊâßË°å EventBus ‰ΩøÁî®‰∏Ä‰∏™ÂêéÂè∞Á∫øÁ®ãÔºåÂ∞ÜÊåâÈ°∫Â∫èÂèëÈÄÅÊâÄÊúâ‰∫ã‰ª∂„ÄÇ‰ΩøÁî®ËøôÁßçÊ®°ÂºèÁöÑËÆ¢ÈòÖÊñπÊ≥ïÂ∫îËØ•Â∞ΩÂø´ËøîÂõû‰ª•ÈÅøÂÖçÈòªÂ°ûÂêéÂè∞Á∫øÁ®ã„ÄÇ Ê≥®ÊÑèÔºö„Äå‰∏Ä‰∏™ÂêéÂè∞Á∫øÁ®ã„ÄçÊâÄÊåáÁöÑÂπ∂‰∏çÊòØ Executors.newSingleThreadPool()ÔºåËÄåÊòØ‰ΩøÁî® EventBus Âú®ÂÆû‰æãÂåñÊó∂ÂàõÂª∫ÁöÑ cacheThreadPool ‰∏≠ÁöÑÊüê‰∏Ä‰∏™Á∫øÁ®ã„ÄÇ ThreadMode.ASYNC Êñ∞Âª∫Â≠êÁ∫øÁ®ãÊâßË°å„ÄÇÈÄÇÁî®‰∫éËÄóÊó∂Êìç‰Ωú ÂèëÂ∏É‰∫ã‰ª∂Ê∞∏Ëøú‰∏ç‰ºöÁ≠âÂæÖ‰ΩøÁî®Ê≠§Ê®°ÂºèÁöÑËÆ¢ÈòÖÊñπÊ≥ï„ÄÇÈÄÇÁî®‰∫éÊØîËæÉËÄóÊó∂ÁöÑËÆ¢ÈòÖÊñπÊ≥ïÔºåÊØîÂ¶ÇÁî®‰∫éÁΩëÁªúËØ∑Ê±Ç„ÄÇ‰ΩøÁî®Êó∂Â∫îËØ•ÈÅøÂÖçÂêåÊó∂Ëß¶ÂèëÂ§ßÈáèÈïøÊó∂Èó¥ËøêË°åÁöÑÂºÇÊ≠•ËÆ¢ÈòÖÊñπÊ≥ïÊù•ÈôêÂà∂Âπ∂ÂèëÁ∫øÁ®ãÁöÑÊï∞Èáè„ÄÇ EventBus ‰ΩøÁî®Á∫øÁ®ãÊ±†ÊúâÊïàÂú∞ÈáçÁî®Â∑≤ÂÆåÊàêÁöÑÂºÇÊ≠•Áî®Êà∑ÈÄöÁü•‰∏≠ÁöÑÁ∫øÁ®ã„ÄÇ ÈÄöËøá sticky ÊåáÂÆöÊòØÂê¶Êé•Êî∂Á≤òÊÄß‰∫ã‰ª∂ÔºåÈªòËÆ§‰∏∫ false ÈÄöËøá priority ËÆæÁΩÆÊé•Êî∂ËÆ¢ÈòÖÊñπÊ≥ïÁöÑ‰ºòÂÖàÁ∫ßÔºåÁõ∏ÂêåÁöÑ‰∫ã‰ª∂Ôºå‰ºòÂÖàÁ∫ßË∂äÈ´òÁöÑËÆ¢ÈòÖÊñπÊ≥ï Ë∂äÊó©Êî∂Âà∞‰∫ã‰ª∂ 2.5 ÂèëÈÄÅ‰∫ã‰ª∂ÈÄöËøáEventBusÁöÑpost()ÊñπÊ≥ïÊù•ÂèëÈÄÅ‰∫ã‰ª∂, ÂèëÈÄÅ‰πãÂêéÂ∞±‰ºöÊâßË°åÊ≥®ÂÜåËøáËøô‰∏™‰∫ã‰ª∂ÁöÑÂØπÂ∫îÁ±ªÁöÑÊñπÊ≥ï. ÊàñËÄÖÈÄöËøápostSticky()Êù•ÂèëÈÄÅ‰∏Ä‰∏™Á≤òÊÄß‰∫ã‰ª∂„ÄÇ 2.6 Ëß£Èô§Ê≥®ÂÜåÂú®ÂêàÈÄÇÁöÑÂú∞ÊñπÔºàÊØîÂ¶Ç Activity#onDestroyÔºâ‰ΩøÁî®‰∏ãÈù¢ÁöÑ‰ª£Á†ÅËøõË°åËß£Èô§Ê≥®ÂÜå EventBus.getDefault().unregister(this); 2.7 Â∞èÁªìË¶ÅÂÆûÁé∞ËÆ¢ÈòÖÔºåÈúÄË¶ÅËøõË°åÊ≥®ÂÜåÔºå‰ª•ÂèäËß£Ê≥®ÂÜåÔºåËÆ¢ÈòÖÊñπÊ≥ï‰ª•„ÄåÁõÆÊ†á‰∫ã‰ª∂„Äç‰Ωú‰∏∫ÊñπÊ≥ïÁöÑÂèÇÊï∞Ôºå ‰ΩøÁî® Subscribe Ê≥®Ëß£ÔºåÂèØ‰ª•ÊåáÂÆöËÆ¢ÈòÖÊñπÊ≥ïÊâßË°åÁöÑÁ∫øÁ®ã„ÄÅÊòØÂê¶Êé•Êî∂ sticky ‰∫ã‰ª∂„ÄÅËÆ¢ÈòÖÊñπÊ≥ïÁöÑ‰ºòÂÖàÁ∫ß„ÄÇ Ëá≥‰∫éÂèëÈÄÅÊñπÔºåÂè™ÈúÄË¶ÅÂàõÂª∫Áõ∏Â∫îÁöÑ ‰∫ã‰ª∂ÂÆû‰æãÔºåÁÑ∂ÂêéË∞ÉÁî® post ÊàñËÄÖ postSticky Â∞Ü‰∫ã‰ª∂ÂèëÈÄÅÂá∫ÂéªÂç≥ÂèØ„ÄÇ ‰∏â„ÄÅÂÆûÁé∞3.1 ÂàùÂßãÂåñ EventBusÂºÄÂèëËÄÖÈÄöÂ∏∏ÊòØË∞ÉÁî® EventBus#getDefault ÊñπÊ≥ïËé∑Âèñ EventBus ÂÆû‰æã„ÄÇ 12345678910public static EventBus getDefault() &#123; if (defaultInstance == null) &#123; synchronized (EventBus.class) &#123; if (defaultInstance == null) &#123; defaultInstance = new EventBus(); &#125; &#125; &#125; return defaultInstance;&#125; getDefault ÈÄöËøáÂèåÈáçÊ†°È™åÈîÅÁöÑÊñπÂºèÊù•ÂÆûÁé∞Âçï‰æã ÊûÑÈÄ†ÊñπÊ≥ï12345private static final EventBusBuilder DEFAULT_BUILDER = new EventBusBuilder();public EventBus() &#123; this(DEFAULT_BUILDER);&#125; ÈÄöËøá getDefault Ëé∑ÂèñÁöÑ EventBus ÂØπË±°ÊòØÈÄöËøáÈªòËÆ§ÁöÑ EventBusBuilder ÊûÑÈÄ†ËÄåÊàêÁöÑ„ÄÇ 1234567891011121314151617181920212223private final static ExecutorService DEFAULT_EXECUTOR_SERVICE = Executors.newCachedThreadPool();//ÈªòËÆ§‰∏∫ CachedThreadPoolÔºå‰∏çÈôêÂà∂Á∫øÁ®ãÊï∞boolean logSubscriberExceptions = true;boolean logNoSubscriberMessages = true;boolean sendSubscriberExceptionEvent = true;boolean sendNoSubscriberEvent = true;boolean throwSubscriberException;boolean strictMethodVerification;//ExecutorService executorService = DEFAULT_EXECUTOR_SERVICE;//ÈªòËÆ§ÁöÑÁ∫øÁ®ãÊ±†List&lt;Class&lt;?&gt;&gt; skipMethodVerificationForClasses;List&lt;SubscriberInfoIndex&gt; subscriberInfoIndexes;MainThreadSupport mainThreadSupport;EventBus(EventBusBuilder builder) &#123; //‚Ä¶‚Ä¶ subscriptionsByEventType = new HashMap&lt;&gt;(); typesBySubscriber = new HashMap&lt;&gt;(); stickyEvents = new ConcurrentHashMap&lt;&gt;(); //‚Ä¶‚Ä¶ eventInheritance = builder.eventInheritance; executorService = builder.executorService;&#125; ‰∏ªË¶ÅÁúã‰ª•‰∏ãÂá†‰∏™Âçï‰æãÁöÑÂÆûÁé∞„ÄÇ 12345678910boolean eventInheritance = true;//ÊòØÂê¶ÂÖÅËÆ∏‰∫ã‰ª∂ÁªßÊâøboolean ignoreGeneratedIndex;//ÊòØÂê¶ÂøΩÁï• ÁîüÊàêÁöÑ indexÔºåÈªòËÆ§‰∏∫ falseÔºå‰πüÂ∞±ÊòØ‰ºöÂÖàÂ∞ùËØïÂØªÊâæÁºñËØëÊúüÊ≥®Ëß£ÁîüÊàêÁöÑËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØÔºåÊâæ‰∏çÂà∞ÂÜç‰ΩøÁî®ÂèçÂ∞ÑÂéªËé∑Âèñ„ÄÇprivate final Map&lt;Class&lt;?&gt;, CopyOnWriteArrayList&lt;Subscription&gt;&gt; subscriptionsByEventType;private final Map&lt;Object, List&lt;Class&lt;?&gt;&gt;&gt; typesBySubscriber;private final Map&lt;Class&lt;?&gt;, Object&gt; stickyEvents;private final HandlerPoster mainThreadPoster;private final BackgroundPoster backgroundPoster;private final AsyncPoster asyncPoster; subscriptionsByEventType Ôºåkey ÊòØ‰∫ã‰ª∂Á±ªÂûãÔºåvalue ‰∏∫ ËÆ¢ÈòÖ‰∫ÜËØ•‰∫ã‰ª∂ÁöÑÊñπÊ≥ïÂàóË°® typesBySubscriberÔºåkey ‰∏∫ËÆ¢ÈòÖËÄÖÔºåvalue Êüê‰∏™ËÆ¢ÈòÖËÄÖËÆ¢ÈòÖÁöÑ‰∫ã‰ª∂ÂàóË°® stickyEventsÔºåkey ‰∏∫‰∫ã‰ª∂Á±ªÂûãÔºåvalue ‰∏∫ÂÖ∑‰ΩìÁöÑ‰∫ã‰ª∂ÂÆû‰æã mainThreadPoster ‰∏ªÁ∫øÁ®ãÂàÜÂèë backgroundPoster ÂêéÂè∞Á∫øÁ®ãÂàÜÂèë asyncPoster ÂºÇÊ≠•Á∫øÁ®ãÂàÜÂèë 3.2 Ê≥®ÂÜåËÆ¢ÈòÖorg.greenrobot.eventbus.EventBus#register 12345678910public void register(Object subscriber) &#123; Class&lt;?&gt; subscriberClass = subscriber.getClass();//Ëé∑ÂèñËÆ¢ÈòÖËÄÖÁöÑ class ÂØπË±° List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriberClass);//Êü•ÊâæËÆ¢ÈòÖËÄÖ‰∏≠ÊâÄÊúâÁöÑËÆ¢ÈòÖÊñπÊ≥ï synchronized (this) &#123; //Ëø≠‰ª£ÈÅçÂéÜËÆ¢ÈòÖËÄÖ‰∏≠ÊâÄÊúâÁöÑËÆ¢ÈòÖÊñπÊ≥ï for (SubscriberMethod subscriberMethod : subscriberMethods) &#123; subscribe(subscriber, subscriberMethod); &#125; &#125;&#125; EventBus#findSubscriberMethods ÊâæÂá∫ÁªôÂÆö class ‰∏≠ÊâÄÊúâÁöÑËÆ¢ÈòÖÊñπÊ≥ï 12345678910111213141516171819202122private static final Map&lt;Class&lt;?&gt;, List&lt;SubscriberMethod&gt;&gt; METHOD_CACHE = new ConcurrentHashMap();//‰ª• class ‰∏∫ keyÔºåÊñπÊ≥ïÂàóË°®‰∏∫ value ÁöÑÔºåMap ‰Ωú‰∏∫ÁºìÂ≠òList&lt;SubscriberMethod&gt; findSubscriberMethods(Class&lt;?&gt; subscriberClass) &#123; List subscriberMethods = (List)METHOD_CACHE.get(subscriberClass);//ÁºìÂ≠ò‰∏≠Ëé∑Âèñ if(subscriberMethods != null) &#123; return subscriberMethods;//ÁºìÂ≠òÂëΩ‰∏≠ÔºåÁõ¥Êé•ËøîÂõû &#125; else &#123; if(this.ignoreGeneratedIndex) &#123;//ÂøΩÁï•ÁºñËØëÊúüÁîüÊàêÁöÑ ËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ subscriberMethods = this.findUsingReflection(subscriberClass);//ÈÄöËøáÂèçÂ∞ÑËé∑ÂèñËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ &#125; else &#123; //Ëé∑ÂèñÁºñËØëÊúüÁîüÊàêÁöÑ ËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ subscriberMethods = this.findUsingInfo(subscriberClass);// &#125; if(subscriberMethods.isEmpty()) &#123; throw new EventBusException("Subscriber " + subscriberClass + " and its super classes have no public methods with the @Subscribe annotation"); &#125; else &#123; METHOD_CACHE.put(subscriberClass, subscriberMethods);//Ê∑ªÂä†Âà∞ÁºìÂ≠ò‰∏≠ return subscriberMethods;//ËøîÂõû &#125; &#125;&#125; EventBus#subscribe() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//ÂøÖÈ°ª‰ªéÂêåÊ≠•Âùó‰∏≠Ë∞ÉÁî®private void subscribe(Object subscriber, SubscriberMethod subscriberMethod) &#123; Class&lt;?&gt; eventType = subscriberMethod.eventType;//‰∫ã‰ª∂Á±ªÂûã Subscription newSubscription = new Subscription(subscriber, subscriberMethod);//Êñ∞Âª∫‰∏Ä‰∏™ SubscriptionÔºåÂ≠òÂÇ®ËÆ¢ÈòÖÁöÑÂØπË±°‰ª•Âèä ÂìçÂ∫îÁöÑÊñπÊ≥ï CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);//Map&lt;Class&lt;?&gt;, CopyOnWriteArrayList&lt;Subscription&gt;&gt; ‰ªé map ‰∏≠Ëé∑ÂèñÁõ∏Â∫îËÆ¢ÈòÖÁ±ªÂûãÁöÑ ÂàóË°® if (subscriptions == null) &#123;//Â¶ÇÊûúÊ≤°ÊúâÂàôÊñ∞Âª∫‰∏Ä‰∏™ subscriptions = new CopyOnWriteArrayList&lt;&gt;(); subscriptionsByEventType.put(eventType, subscriptions); &#125; else &#123; if (subscriptions.contains(newSubscription)) &#123; throw new EventBusException("Subscriber " + subscriber.getClass() + " already registered to event " + eventType);//Ê≤°ÊúâÂàôÊäõÂá∫ÂºÇÂ∏∏„ÄÇ &#125; &#125; int size = subscriptions.size(); //ÈÅçÂéÜÁõëÂê¨ÂàóË°®ÔºåÂ∞ÜÊñ∞ÁöÑ subscription ÊèíÂÖ•Âà∞Ê≠£Á°Æ‰ΩçÁΩÆ„ÄÇÂàóË°®ÊåâÁÖß‰ºòÂÖàÁ∫ßÈÄíÂáèÁöÑÈ°∫Â∫èÊéíÂ∫è for (int i = 0; i &lt;= size; i++) &#123; if (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) &#123; subscriptions.add(i, newSubscription); break; &#125; &#125; List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber); if (subscribedEvents == null) &#123; subscribedEvents = new ArrayList&lt;&gt;(); typesBySubscriber.put(subscriber, subscribedEvents); &#125; subscribedEvents.add(eventType); //Â¶ÇÊûúËß¶ÂèëÁöÑÊñπÊ≥ï Ë¶ÅÊé•Êî∂„ÄåÁ≤òÊÄß‰∫ã‰ª∂„ÄçÔºåËé∑ÂèñÁõ∏Â∫îÁ±ªÂûãÁöÑ Event Âπ∂Ëß¶ÂèëÁõ∏Â∫îÁöÑÊñπÊ≥ï if (subscriberMethod.sticky) &#123; if (eventInheritance) &#123; // Existing sticky events of all subclasses of eventType have to be considered. // Note: Iterating over all events may be inefficient with lots of sticky events, // thus data structure should be changed to allow a more efficient lookup // (e.g. an additional map storing sub classes of super classes: Class -&gt; List&lt;Class&gt;). Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet(); for (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) &#123; Class&lt;?&gt; candidateEventType = entry.getKey(); if (eventType.isAssignableFrom(candidateEventType)) &#123; Object stickyEvent = entry.getValue(); checkPostStickyEventToSubscription(newSubscription, stickyEvent); &#125; &#125; &#125; else &#123; Object stickyEvent = stickyEvents.get(eventType); checkPostStickyEventToSubscription(newSubscription, stickyEvent); &#125; &#125;&#125; ËØ•ÊñπÊ≥ï‰ºöÂ∞ÜÁõ∏Â∫îÁöÑ‰∫ã‰ª∂ÊèíÂÖ•ÂØπÂ∫î‰∫ã‰ª∂ÁöÑÂàóË°®‰∏≠„ÄÇÂ¶ÇÊûúÂú®ÊñπÊ≥ïÊ≥®Ëß£‰∏≠Â£∞Êòé‰∫Ü stickyÔºåËøò‰ºöÈ©¨‰∏äË∞ÉÁî®ËØ•ÊñπÊ≥ï„ÄÇ Ê£ÄÊµã stick ‰∫ã‰ª∂ÔºåÂ¶ÇÊûúÁõ∏Â∫îÁöÑ‰∫ã‰ª∂ÂÆö‰πâÊúâÂ≠êÁ±ªÁöÑËØùÔºå‰ºöÈÅçÂéÜ‰∫ã‰ª∂ÁöÑ‰∫ã‰ª∂Â≠êÁ±ªÈÄê‰∏ÄÈÄöÁü•ËØ•ÊñπÊ≥ï„ÄÇ 3.2.1 ÈÄöËøáÂèçÂ∞ÑÂ§ÑÁêÜÊ≥®Ëß£SubscriberMethodFinder#findUsingReflection 123456789private List&lt;SubscriberMethod&gt; findUsingReflection(Class&lt;?&gt; subscriberClass) &#123; FindState findState = prepareFindState(); findState.initForSubscriber(subscriberClass); while (findState.clazz != null) &#123; findUsingReflectionInSingleClass(findState); findState.moveToSuperclass(); &#125; return getMethodsAndRelease(findState);&#125; SubscriberMethodFinder#findUsingReflectionInSingleClass 12345678910111213141516171819202122232425262728293031323334353637private void findUsingReflectionInSingleClass(FindState findState) &#123; Method[] methods; try &#123; // This is faster than getMethods, especially when subscribers are fat classes like Activities methods = findState.clazz.getDeclaredMethods();//Ëé∑ÂèñÁöÑÊòØÁ±ªÁöÑÊâÄÊúâÂÖ¨ÊúâÊñπÊ≥ïÔºåËøôÂ∞±ÂåÖÊã¨Ëá™Ë∫´ Âíå‰ªéÂü∫Á±ªÁªßÊâøÁöÑ„ÄÅ‰ªéÊé•Âè£ÂÆûÁé∞ÁöÑÊâÄÊúâ public ÊñπÊ≥ï„ÄÇ //getDeclareMethods ËøîÂõûÁöÑÊòØËØ•Á±ª‰∏≠ÂÆö‰πâÁöÑ„ÄåÊâÄÊúâÊñπÊ≥ï„ÄçÔºå‰ΩÜÊòØ‰∏çÂåÖÊã¨‰ªéÁà∂Á±ªÁªßÊâøËÄåÊù•ÁöÑÊñπÊ≥ï &#125; catch (Throwable th) &#123; methods = findState.clazz.getMethods(); findState.skipSuperClasses = true; &#125; for (Method method : methods) &#123;//ÈÅçÂéÜÊñπÊ≥ï int modifiers = method.getModifiers(); if ((modifiers &amp; Modifier.PUBLIC) != 0 &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == 0) &#123; Class&lt;?&gt;[] parameterTypes = method.getParameterTypes(); if (parameterTypes.length == 1) &#123;//ÂèÇÊï∞ÂàóË°®ÈïøÂ∫¶‰∏∫ 0 Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class); if (subscribeAnnotation != null) &#123; Class&lt;?&gt; eventType = parameterTypes[0]; if (findState.checkAdd(method, eventType)) &#123; ThreadMode threadMode = subscribeAnnotation.threadMode(); //Â∞ÜËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØÊ∑ªÂä†Âà∞ findState ‰∏≠ findState.subscriberMethods.add(new SubscriberMethod(method, eventType, threadMode, subscribeAnnotation.priority(), subscribeAnnotation.sticky())); &#125; &#125; &#125; else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123; String methodName = method.getDeclaringClass().getName() + "." + method.getName(); throw new EventBusException("@Subscribe method " + methodName + "must have exactly 1 parameter but has " + parameterTypes.length); &#125; &#125; else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123; String methodName = method.getDeclaringClass().getName() + "." + method.getName(); throw new EventBusException(methodName + " is a illegal @Subscribe method: must be public, non-static, and non-abstract"); &#125; &#125; &#125; ignoreGeneratedIndex ÊòØ‰ªÄ‰πà?Áî±‰∫éÂèçÂ∞ÑÊàêÊú¨È´ò,ËÄå‰∏î EventBus 3.0 ÂºïÂÖ•‰∫Ü EventBusAnnotationProcessor,ÊïÖÈªòËÆ§ ignoreGeneratedIndex ‰∏∫ false,ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ,Â¶ÇÊûúËÆæÁΩÆ ignoreGeneratedIndex ‰∏∫ true,ÂàôÂâçÈù¢‰ΩøÁî®ÁöÑ MyEventBusIndex Êó†Êïà,ËøòÊòØ‰ºöËµ∞ÂèçÂ∞ÑËß£ÊûêÁöÑÂàÜÊîØ„ÄÇ 3.2.2 ‰ΩøÁî®ÁºñËØëÊúüÁîüÊàêÁöÑËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØÁΩë‰∏äÊúâÂæàÂ§ö‰ªãÁªç EventBus ÁöÑÊñáÁ´†,‰ΩÜÊòØÂá†‰πéÊ≤°ÊúâÊèêÂà∞ EventBusAnnotationProcessor ÁöÑ„ÄÇÂú® 3.0 ÁâàÊú¨ÂºÄÂßãÔºåEventBusÊèê‰æõ‰∫Ü‰∏Ä‰∏™EventBusAnnotationProcessorÊ≥®Ëß£Â§ÑÁêÜÂô®Êù•Âú®ÁºñËØëÊúüÈÄöËøáËØªÂèñ@Subscribe()Ê≥®Ëß£Âπ∂Ëß£Êûê,Â§ÑÁêÜÂÖ∂‰∏≠ÊâÄÂåÖÂê´ÁöÑ‰ø°ÊÅØ,ÁÑ∂ÂêéÁîüÊàêjavaÁ±ªÊù•‰øùÂ≠òÊâÄÊúâËÆ¢ÈòÖËÄÖÂÖ≥‰∫éËÆ¢ÈòÖÁöÑ‰ø°ÊÅØ,ËøôÊ†∑Â∞±ÊØîÂú®ËøêË°åÊó∂‰ΩøÁî®ÂèçÂ∞ÑÊù•Ëé∑ÂæóËøô‰∫õËÆ¢ÈòÖËÄÖÁöÑ‰ø°ÊÅØÈÄüÂ∫¶Ë¶ÅÂø´.Êàë‰ª¨ÂèØ‰ª•ÂèÇËÄÉEventBusÈ°πÁõÆÈáåÁöÑEventBusPerformanceËøô‰∏™‰æãÂ≠ê,ÁºñËØëÂêéÊàë‰ª¨ÂèØ‰ª•Âú®buildÊñá‰ª∂Â§πÈáåÊâæÂà∞Ëøô‰∏™Á±ª,MyEventBusIndex Á±ª,ÂΩìÁÑ∂Á±ªÂêçÊòØÂèØ‰ª•Ëá™ÂÆö‰πâÁöÑ.Êàë‰ª¨Â§ßËá¥Áúã‰∏Ä‰∏ãÁîüÊàêÁöÑMyEventBusIndexÁ±ªÊòØ‰ªÄ‰πàÊ†∑ÁöÑ: ËÆ¢ÈòÖËÄÖ‰∏≠ÁöÑ ËÆ¢ÈòÖÊñπÊ≥ï 1234567891011121314public class ReceiveEventFragment extends Fragment &#123; //‚Ä¶‚Ä¶ @Subscribe(threadMode = ThreadMode.MAIN, priority = 0) public void onReceive(MsgEvent event) &#123; Log.d(TAG, "onReceive: " + event); mTvMsg.setText(String.format("msgId:%d\nmsg:%s", event.msgId, event.msg)); &#125; @Subscribe(threadMode = ThreadMode.MAIN, priority = 10000) public void ShowToast(MsgEvent event) &#123; Toast.makeText(getActivity(), String.format("msgId:%d\nmsg:%s", event.msgId, event.msg), Toast.LENGTH_SHORT).show(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132/** This class is generated by EventBus, do not edit. */public class MyEventBusIndex implements SubscriberInfoIndex &#123; private static final Map&lt;Class&lt;?&gt;, SubscriberInfo&gt; SUBSCRIBER_INDEX; static &#123; SUBSCRIBER_INDEX = new HashMap&lt;Class&lt;?&gt;, SubscriberInfo&gt;();//‰ª•ËÆ¢ÈòÖËÄÖ‰∏∫ keyÔºå‰ª•ËÆ¢ÈòÖËÄÖ‰∏≠ÁöÑ ËÆ¢ÈòÖÊñπÊ≥ïÂàóË°®‰∏∫ value ÁöÑ map //Â∞Ü ReceiveEventFragment ÁöÑËÆ¢ÈòÖ‰ø°ÊÅØÂ≠òÂÇ®Âà∞ map ‰∏≠ putIndex(new SimpleSubscriberInfo(com.test.commentdemo.eventbusdemo.ReceiveEventFragment.class, true, new SubscriberMethodInfo[] &#123; new SubscriberMethodInfo("onReceive", com.test.commentdemo.eventbusdemo.MsgEvent.class, ThreadMode.MAIN), new SubscriberMethodInfo("ShowToast", com.test.commentdemo.eventbusdemo.MsgEvent.class, ThreadMode.MAIN, 10000, false), &#125;));//ËÆ¢ÈòÖËÄÖ‰∏≠ÊâÄÊúâÁöÑËÆ¢ÈòÖÊñπÊ≥ï //‚Ä¶‚Ä¶‰ª£Á†ÅÁúÅÁï•ÔºàÂ≠òÂÇ®ÂÖ∂‰ªñËÆ¢ÈòÖËÄÖÁöÑËÆ¢ÈòÖ‰ø°ÊÅØÂà∞ map ‰∏≠Ôºâ &#125; private static void putIndex(SubscriberInfo info) &#123; SUBSCRIBER_INDEX.put(info.getSubscriberClass(), info); &#125; @Override public SubscriberInfo getSubscriberInfo(Class&lt;?&gt; subscriberClass) &#123; SubscriberInfo info = SUBSCRIBER_INDEX.get(subscriberClass);//Ê†πÊçÆÁ±ªÂûã‰ªé Map Ëé∑ÂèñËÆ¢ÈòÖËÄÖÁöÑËÆ¢ÈòÖ‰ø°ÊÅØ if (info != null) &#123; return info; &#125; else &#123; return null; &#125; &#125;&#125; ÁªßÁª≠ÂâçÈù¢ ignoreGeneratedIndex ‰∏∫ false Êó∂Ôºå‰ºöÊâßË°å‰ª•‰∏ãÂàÜÊîØ„ÄÇ 12345678910111213141516171819private List&lt;SubscriberMethod&gt; findUsingInfo(Class&lt;?&gt; subscriberClass) &#123; FindState findState = prepareFindState(); findState.initForSubscriber(subscriberClass); while (findState.clazz != null) &#123; findState.subscriberInfo = getSubscriberInfo(findState); if (findState.subscriberInfo != null) &#123; SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();//Ëé∑ÂèñËÆ¢ÈòÖÁöÑÊñπÊ≥ï‰ø°ÊÅØ for (SubscriberMethod subscriberMethod : array) &#123; if (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) &#123; findState.subscriberMethods.add(subscriberMethod); &#125; &#125; &#125; else &#123; findUsingReflectionInSingleClass(findState);//Â¶ÇÊûúÊâæ‰∏çÂà∞Áõ∏Â∫îÁöÑËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØÔºàÂèØËÉΩ‰ΩøÁî® EventBus ÂÆû‰æã‰πãÂâçÔºåÊ≤°ÊúâÂ∞ÜMyEventBusIndex ÔºâÔºåÈúÄË¶ÅÈÄöËøáÂèçÂ∞ÑËé∑ÂèñËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ &#125; findState.moveToSuperclass(); &#125; return getMethodsAndRelease(findState);&#125; findUsingInfo()ÊñπÊ≥ï,ÂÖ∂Êó†ÈùûÂ∞±ÊòØÈÄöËøáÊü•ÊâæÊàë‰ª¨ÂâçÈù¢ÊâÄËØ¥ÁöÑMyEventBusIndexÁ±ª‰∏≠ÁöÑ‰ø°ÊÅØ,Êù•ËΩ¨Êç¢ÊàêList&lt;SubscriberMethod&gt;‰ªéËÄåËé∑ÂæóËÆ¢ÈòÖÁ±ªÁöÑÁõ∏ÂÖ≥ËÆ¢ÈòÖÂáΩÊï∞ÁöÑÂêÑÁßç‰ø°ÊÅØ SubscriberMethodFinder#getSubscriberInfo 123456789101112131415161718192021private SubscriberInfo getSubscriberInfo(SubscriberMethodFinder.FindState findState) &#123; if(findState.subscriberInfo != null &amp;&amp; findState.subscriberInfo.getSuperSubscriberInfo() != null) SubscriberInfo superclassInfo = findState.subscriberInfo.getSuperSubscriberInfo();//Ëé∑ÂèñÁà∂Á±ªÁöÑËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ if(findState.clazz == superclassInfo.getSubscriberClass()) &#123;// return superclassInfo; &#125; &#125; if(this.subscriberInfoIndexes != null) &#123; Iterator superclassInfo1 = this.subscriberInfoIndexes.iterator(); //ÈÅçÂéÜÔºå‰ªé index ‰∏≠Ëé∑Âèñ ËÆ¢ÈòÖ‰ø°ÊÅØ while(superclassInfo1.hasNext()) &#123; SubscriberInfoIndex index = (SubscriberInfoIndex)superclassInfo1.next(); SubscriberInfo info = index.getSubscriberInfo(findState.clazz);//‰ªéËá™Âä®ÁîüÊàêÁöÑ MyEventBusIndex Á±ª‰∏≠ÁöÑ SUBSCRIBER_INDEX ÈáåÈù¢Ëé∑ÂèñËÆ¢ÈòÖÊñπÊ≥ï‰ø°ÊÅØ if(info != null) &#123; return info; &#125; &#125; &#125; return null;&#125; 3.3 Ëß£Ê≥®ÂÜå123456789101112/** Unregisters the given subscriber from all event classes. */public synchronized void unregister(Object subscriber) &#123; List&lt;Class&lt;?&gt;&gt; subscribedTypes = typesBySubscriber.get(subscriber);//Ëé∑ÂèñËÆ¢ÈòÖËÄÖËÆ¢ÈòÖÁöÑ‰∫ã‰ª∂ÂàóË°® if (subscribedTypes != null) &#123; for (Class&lt;?&gt; eventType : subscribedTypes) &#123;//ÈÅçÂéÜËÆ¢ÈòÖËÄÖÊâÄËÆ¢ÈòÖÁöÑ‰∫ã‰ª∂ //‰ªé‰∫ã‰ª∂ÂØπÂ∫îÁöÑËÆ¢ÈòÖÂàóË°®‰∏≠ ËÆ¢ÈòÖËÄÖÁöÑËÆ¢ÈòÖ‰ø°ÊÅØ unsubscribeByEventType(subscriber, eventType); typesBySubscriber.remove(subscriber);//ÁßªÈô§ËÆ¢ÈòÖËÄÖ &#125; else &#123; logger.log(Level.WARNING, "Subscriber to unregister was not registered before: " + subscriber.getClass()); &#125;&#125; 1234567891011121314151617/** Only updates subscriptionsByEventType, not typesBySubscriber! Caller must update typesBySubscriber. */private void unsubscribeByEventType(Object subscriber, Class&lt;?&gt; eventType) &#123; List&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType); //‰ªé‰∫ã‰ª∂ÂØπÂ∫îÁöÑËÆ¢ÈòÖÂàóË°®‰∏≠ ËÆ¢ÈòÖËÄÖÁöÑËÆ¢ÈòÖ‰ø°ÊÅØ if (subscriptions != null) &#123; int size = subscriptions.size(); for (int i = 0; i &lt; size; i++) &#123; Subscription subscription = subscriptions.get(i); if (subscription.subscriber == subscriber) &#123; subscription.active = false; subscriptions.remove(i); i--; size--; &#125; &#125; &#125;&#125; 3.4 ÂèëÈÄÅ‰∫ã‰ª∂EventBus#post 1. Ëé∑ÂèñËÆ¢ÈòÖÂàóË°®1234567891011121314151617181920212223242526272829303132333435363738public class EventBus &#123; private final ThreadLocal&lt;EventBus.PostingThreadState&gt; currentPostingThreadState;//Á∫øÁ®ãÁßÅÊúâÂèòÈáè‚Äî‚ÄîÂΩìÂâçÂèëÂ∏ÉÁ∫øÁ®ãÁä∂ÊÄÅ public void post(Object event) &#123; EventBus.PostingThreadState postingState = (EventBus.PostingThreadState)this.currentPostingThreadState.get();//ËÆ∞ÂΩïÂèëÂ∏ÉÁ∫øÁ®ãÁöÑÁä∂ÊÄÅÔºàÊØîÂ¶ÇÊòØÂê¶ÊòØ‰∏ªÁ∫øÁ®ãÔºâ List eventQueue = postingState.eventQueue;//‰ªéÂèëÂ∏ÉÁä∂ÊÄÅ‰∏≠Ëé∑Âèñ‰∫ã‰ª∂ÈòüÂàó eventQueue.add(event);//Ê∑ªÂä†Ëøõ‰∫ã‰ª∂ÈòüÂàóÁöÑÈòüÂ∞æ if(!postingState.isPosting) &#123;//ÂΩìÂâç‰∏çÊòØÂ§Ñ‰∫éÂàÜÂèëÁä∂ÊÄÅ postingState.isMainThread = this.isMainThread();//ÊòØÂê¶Âú®‰∏ªÁ∫øÁ®ã postingState.isPosting = true;//Â∞ÜÁä∂ÊÄÅÊîπ‰∏∫ÂèëÂ∏É‰∏≠ if(postingState.canceled) &#123;//ÂèñÊ∂àÂèëÂ∏É throw new EventBusException("Internal error. Abort state was not reset &#125; try &#123; while(!eventQueue.isEmpty()) &#123;//Âè™Ë¶Å‰∫ã‰ª∂ÈòüÂàóÈùûÁ©∫ÔºåÂ∞±‰∏ÄÁõ¥ÂæÄÂ§ñÂèñÂá∫‰∫ã‰ª∂Âπ∂ÂèëÂ∏É this.postSingleEvent(eventQueue.remove(0), postingState); &#125; &#125; finally &#123; postingState.isPosting = false; postingState.isMainThread = false; &#125; &#125; &#125; static final class PostingThreadState &#123; final List&lt;Object&gt; eventQueue = new ArrayList();//‰∫ã‰ª∂ÈòüÂàó boolean isPosting; boolean isMainThread; Subscription subscription; Object event; boolean canceled; PostingThreadState() &#123; &#125; &#125; &#125; 12345678910111213141516171819202122232425262728293031323334353637383940final static class PostingThreadState &#123; final List&lt;Object&gt; eventQueue = new ArrayList&lt;&gt;();//‰∫ã‰ª∂ÈòüÂàó boolean isPosting;//ÊòØÂê¶Ê≠£Âú®ÂàÜÂèë‰∏≠ boolean isMainThread;//ÊòØÂê¶Âú®‰∏ªÁ∫øÁ®ã Subscription subscription; Object event;//‰∫ã‰ª∂ boolean canceled;//ÂèñÊ∂à&#125;private final ThreadLocal&lt;PostingThreadState&gt; currentPostingThreadState = new ThreadLocal&lt;PostingThreadState&gt;() &#123; @Override protected PostingThreadState initialValue() &#123; return new PostingThreadState(); &#125;&#125;;//currentPostingThreadState ÊòØ‰∏Ä‰∏™Á∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáè/** Posts the given event to the event bus. */public void post(Object event) &#123; PostingThreadState postingState = currentPostingThreadState.get();//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã‰∫ã‰ª∂ÂàÜÂèëÁä∂ÊÄÅ List&lt;Object&gt; eventQueue = postingState.eventQueue; eventQueue.add(event);//Ê∑ªÂä†Âà∞‰∫ãÂä°ÈòüÂàó‰∏≠ if (!postingState.isPosting) &#123;//Â¶ÇÊûúÂΩìÂâç‰∏çÊòØÂú®ÂàÜÂèëÁä∂ÊÄÅ,ÂàôËøõÂÖ•ÂàÜÂèëÁä∂ÊÄÅ postingState.isMainThread = isMainThread(); postingState.isPosting = true; if (postingState.canceled) &#123; throw new EventBusException("Internal error. Abort state was not reset"); &#125; try &#123; //ÁºñËØë‰∫ã‰ª∂ÈòüÂàóÔºåÈÄê‰∏ÄËøõË°åÂàÜÂèë while (!eventQueue.isEmpty()) &#123; postSingleEvent(eventQueue.remove(0), postingState); &#125; &#125; finally &#123; postingState.isPosting = false; postingState.isMainThread = false; &#125; &#125;&#125; EventBus#postSingleEvent 1234567891011121314151617181920212223private void postSingleEvent(Object event, PostingThreadState postingState) throws Error &#123; Class&lt;?&gt; eventClass = event.getClass(); boolean subscriptionFound = false; if (eventInheritance) &#123;//Â¶ÇÊûú‰∫ã‰ª∂ÊîØÊåÅÂ≠êÁ±ªÂûãÔºåÊü•ÊâæËØ•‰∫ã‰ª∂ÁöÑÊâÄÊúâÂ≠êÁ±ªÂûã List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass); int countTypes = eventTypes.size(); for (int h = 0; h &lt; countTypes; h++) &#123; Class&lt;?&gt; clazz = eventTypes.get(h); subscriptionFound |= postSingleEventForEventType(event, postingState, clazz); &#125; &#125; else &#123; subscriptionFound = postSingleEventForEventType(event, postingState, eventClass); &#125; if (!subscriptionFound) &#123; if (logNoSubscriberMessages) &#123; logger.log(Level.FINE, "No subscribers registered for event " + eventClass); &#125; if (sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp; eventClass != SubscriberExceptionEvent.class) &#123; post(new NoSubscriberEvent(this, event)); &#125; &#125;&#125; EventBus#postSingleEventForEventTypeÔºå 123456789101112131415161718192021222324252627 //Êü•Êâæ ‰∫ã‰ª∂ÊâÄÂØπÂ∫îÁöÑËÆ¢ÈòÖËÄÖÂàóË°®ÔºåÁÑ∂ÂêéËø≠‰ª£ÂàóË°®ÔºåÂàáÊç¢Âà∞ÁõÆÊ†áÁ∫øÁ®ãÊâßË°åprivate boolean postSingleEventForEventType(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass) &#123; CopyOnWriteArrayList&lt;Subscription&gt; subscriptions; synchronized (this) &#123; subscriptions = subscriptionsByEventType.get(eventClass);//Êü•Êâæ ‰∫ã‰ª∂ÊâÄÂØπÂ∫îÁöÑËÆ¢ÈòÖËÄÖÂàóË°® &#125; if (subscriptions != null &amp;&amp; !subscriptions.isEmpty()) &#123; for (Subscription subscription : subscriptions) &#123; postingState.event = event; postingState.subscription = subscription; boolean aborted = false; try &#123; postToSubscription(subscription, event, postingState.isMainThread); aborted = postingState.canceled; &#125; finally &#123; postingState.event = null; postingState.subscription = null; postingState.canceled = false; &#125; if (aborted) &#123;//‰∫ã‰ª∂ÂèñÊ∂à‰∫Ü break; &#125; &#125; return true; &#125; return false;&#125; 2.ÂàáÊç¢Âà∞ÊåáÂÆöÁ∫øÁ®ã12345678910111213141516171819202122232425262728293031323334private void postToSubscription(Subscription subscription, Object event, boolean isMainThread) &#123; switch (subscription.subscriberMethod.threadMode) &#123; case POSTING:// invokeSubscriber(subscription, event); break; case MAIN: if (isMainThread) &#123; invokeSubscriber(subscription, event); &#125; else &#123; mainThreadPoster.enqueue(subscription, event); &#125; break; case MAIN_ORDERED: if (mainThreadPoster != null) &#123; mainThreadPoster.enqueue(subscription, event); &#125; else &#123; // temporary: technically not correct as poster not decoupled from subscriber invokeSubscriber(subscription, event); &#125; break; case BACKGROUND://ÂêéÂè∞Á∫øÁ®ã if (isMainThread) &#123; backgroundPoster.enqueue(subscription, event); &#125; else &#123; invokeSubscriber(subscription, event); &#125; break; case ASYNC://Êñ∞Âª∫‰∏Ä‰∏™Â≠êÁ∫øÁ®ãÂ§ÑÁêÜ asyncPoster.enqueue(subscription, event); break; default: throw new IllegalStateException("Unknown thread mode: " + subscription.subscriberMethod.threadMode); &#125;&#125; BACKGROUND123456789101112131415161718192021222324252627282930313233343536373839public void enqueue(Subscription subscription, Object event) &#123; PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event);//ÂåÖË£Ö‰∏∫‰∏Ä‰∏™ PendingPost synchronized (this) &#123;//Âä†ÈîÅÔºåËøõÂÖ•ÂêåÊ≠•Âùó queue.enqueue(pendingPost);//Ê∑ªÂä†Âà∞ÈòüÂàó‰∏≠ if (!executorRunning) &#123;//Â¶ÇÊûúÁé∞Âú®Ê≤°ÊúâÂú®ÊâßË°å ÂêéÂè∞‰ªªÂä°ÔºåÂàôËé∑Âèñ‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÊâßË°å‰ªªÂä° executorRunning = true; eventBus.getExecutorService().execute(this); &#125; &#125;&#125;@Overridepublic void run() &#123; try &#123; try &#123; while (true) &#123;//Âæ™ÁéØÔºåÁõ¥Âà∞ÈòüÂàó‰∏∫Á©∫ PendingPost pendingPost = queue.poll(1000);//Ëé∑Âèñ PendingPostÔºåÊúÄÂ§öÁ≠âÂà∞ 1 Áßí if (pendingPost == null) &#123; //ÂâçÈù¢Âèñ‰∏çÂà∞ PendingPostÔºå‰∏ãÈù¢ËøõË°åÂèåÈáçÊ†°È™åÊ£ÄÊü• synchronized (this) &#123; // Check again, this time in synchronized pendingPost = queue.poll();// if (pendingPost == null) &#123; //ÈòüÂàóÁ°ÆÂÆû‰∏∫Á©∫ÔºåÂÅúÊ≠¢ËøêË°å executorRunning = false; return; &#125; &#125; &#125; eventBus.invokeSubscriber(pendingPost);//ÈÄöËøáÂèçÂ∞ÑË∞ÉÁî®Áõ∏Â∫îÁöÑÊñπÊ≥ï &#125; &#125; catch (InterruptedException e) &#123; eventBus.getLogger().log(Level.WARNING, Thread.currentThread().getName() + " was interruppted", e); &#125; &#125; finally &#123; executorRunning = false; &#125;&#125; MAIN1mainThreadPoster.enqueue(subscription, event); HandlerPoster#enqueue 123456789101112public void enqueue(Subscription subscription, Object event) &#123; PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event); synchronized (this) &#123;//Âä†ÈîÅ queue.enqueue(pendingPost);//Âä†ÂÖ• pendingQueue ‰∏≠„ÄÇËØ•ÈòüÂàó‰ºöÂú® handleMessage ÊñπÊ≥ï‰∏≠Ë∞ÉÁî® if (!handlerActive) &#123;//Â¶ÇÊûúÂΩìÂâç handler ‰∏çÊòØÂ§Ñ‰∫éÊ¥ªË∑ÉÁä∂ÊÄÅÔºåÂàôÈÄÄÂá∫ handlerActive = true; if (!sendMessage(obtainMessage())) &#123;//ÂèëÈÄÅ‰ø°ÊÅØÔºåÊèêÁ§∫ throw new EventBusException("Could not send handler message"); &#125; &#125; &#125;&#125; org.greenrobot.eventbus.HandlerPoster#handleMessage 12345678910111213141516171819202122232425262728293031@Overridepublic void handleMessage(Message msg) &#123; boolean rescheduled = false; try &#123; long started = SystemClock.uptimeMillis(); while (true) &#123; PendingPost pendingPost = queue.poll(); if (pendingPost == null) &#123; synchronized (this) &#123; // Check again, this time in synchronized pendingPost = queue.poll(); if (pendingPost == null) &#123; handlerActive = false; return; &#125; &#125; &#125; eventBus.invokeSubscriber(pendingPost); long timeInMethod = SystemClock.uptimeMillis() - started; if (timeInMethod &gt;= maxMillisInsideHandleMessage) &#123; if (!sendMessage(obtainMessage())) &#123; throw new EventBusException("Could not send handler message"); &#125; rescheduled = true; return; &#125; &#125; &#125; finally &#123; handlerActive = rescheduled; &#125;&#125; Âú® handleMessage ÊñπÊ≥ïÂÜÖÈÉ®ÂÅúÁïôÊó∂Èó¥‰∏çËÉΩÂ§ß‰∫é 10 ÊØ´ÁßíÔºå‰ªé MAIN_ORDEREDÊñ∞Â¢ûÂä†ÁöÑÊ®°ÂºèÔºå‰ΩÜÊòØÂΩìÂâçÁâàÊú¨ÁöÑÂÆûÁé∞Ëøò‰∏çÂÆåÂñÑ„ÄÇ ASYNÂ∞Ü‰∫ã‰ª∂Ê∑ªÂä† cachedThreadPool ‰∏≠ÊâßË°å(Â¶ÇÊûúÂΩìÂâçÊúâÁ©∫Èó≤Á∫øÁ®ãÔºåÂàôÂ§çÁî®Á©∫Èó≤Á∫øÁ®ãÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ∞±ÂàõÂª∫Êñ∞Á∫øÁ®ã) 1234567891011121314public void enqueue(Subscription subscription, Object event) &#123; PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event); queue.enqueue(pendingPost); eventBus.getExecutorService().execute(this);//ÊîæÂà∞ÈªòËÆ§ÁöÑ cachedThreaPool ‰∏≠ÊâßË°å&#125;@Overridepublic void run() &#123; PendingPost pendingPost = queue.poll(); if(pendingPost == null) &#123; throw new IllegalStateException("No pending post available"); &#125; eventBus.invokeSubscriber(pendingPost);&#125; 3.ÂèçÂ∞ÑË∞ÉÁî®ËÆ¢ÈòÖÊñπÊ≥ïorg.greenrobot.eventbus.EventBus#invokeSubscriber(org.greenrobot.eventbus.PendingPost) 12345678void invokeSubscriber(PendingPost pendingPost) &#123; Object event = pendingPost.event; Subscription subscription = pendingPost.subscription; PendingPost.releasePendingPost(pendingPost); if (subscription.active) &#123; invokeSubscriber(subscription, event); &#125;&#125; 123456789void invokeSubscriber(Subscription subscription, Object event) &#123; try &#123; subscription.subscriberMethod.method.invoke(subscription.subscriber, event); &#125; catch (InvocationTargetException e) &#123; handleSubscriberException(subscription, event, e.getCause()); &#125; catch (IllegalAccessException e) &#123; throw new IllegalStateException("Unexpected exception", e); &#125;&#125; ÂàáÊç¢Âà∞ÊåáÂÆöÁ∫øÁ®ã‰πãÂêéÔºåÈÄöËøáÂèçÂ∞ÑÁöÑÊñπÊ≥ïÔºåË∞ÉÁî®ËÆ¢ÈòÖÊñπÊ≥ï„ÄÇ Âõõ„ÄÅÊÄªÁªìEventBus ÁöÑÂÆûÁé∞ÂéüÁêÜÂèØ‰ª•ÂΩíÁªì‰∏∫‰ª•‰∏ã‰∏âÁÇπ Ê≥®ÂÜå‚Äî&gt;Êâ´ÊèèËÆ¢ÈòÖÊñπÊ≥ïÔºåÊ∑ªÂä†Âà∞ËÆ¢ÈòÖÊñπÊ≥ïÂàóË°®‰∏≠ ÂèëÈÄÅ‰∫ã‰ª∂‚Äî&gt;Ê†πÊçÆ‰∫ã‰ª∂ÁöÑÁ±ªÂûãÔºåÈÅçÂéÜÊñπÊ≥ïÂàóË°®ÔºåÂèçÂ∞ÑË∞ÉÁî®ËÆ¢ÈòÖÊñπÊ≥ï Ëß£Ê≥®ÂÜå‚Äî&gt;‰ªéËÆ¢ÈòÖÊñπÊ≥ïÂàóË°®‰∏≠ÁßªÈô§Áõ∏Â∫îÁöÑËÆ¢ÈòÖÊñπÊ≥ï EventBus ËôΩÁÑ∂‰∏çÊòØÊ†áÂáÜÁöÑËßÇÂØüËÄÖÊ®°ÂºèÁöÑÂÆûÁé∞, ‰ΩÜÊòØÂÆÉÁöÑÊï¥‰ΩìÂ∞±ÊòØ‰∏Ä‰∏™ÂèëÂ∏É / ËÆ¢ÈòÖÊ°ÜÊû∂, ‰πüÊã•ÊúâËßÇÂØüËÄÖÊ®°ÂºèÁöÑ‰ºòÁÇπ, ÊØîÂ¶Ç: ÂèëÂ∏ÉËÄÖÂíåËÆ¢ÈòÖËÄÖÁöÑËß£ËÄ¶„ÄÇ ‰∫î„ÄÅÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê EventBus Ê∫êÁ†ÅËß£Êûê EventBus È´òÊïà‰ΩøÁî®ÂèäÊ∫êÁ†ÅËß£Êûê-Áü•‰πé‰∏ìÊ†è EventBus 3.0 Ê∫êÁ†ÅÂàÜÊûê EventBus 3.0 Ê∫êÁ†ÅÂàÜÊûêÔºà‰∫åÔºâÊ≥®Ëß£Â§ÑÁêÜÂô®ÁöÑ‰ΩøÁî® Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàë„ÄÇË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê∫êÁ†ÅÂàÜÊûê</category>
        <category>Ê°ÜÊû∂ÂéüÁêÜ</category>
      </categories>
      <tags>
        <tag>Ê∫êÁ†ÅÂàÜÊûê</tag>
        <tag>Ê°ÜÊû∂ÂéüÁêÜ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊãÜËΩÆÂ≠êÁ≥ªÂàó‚Äî‚ÄîButterKnifeÂ∑•‰ΩúÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F10%2F07%2F%E6%8B%86%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94ButterKnife%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Ê¶ÇË¶ÅÊú¨ÁØáÂçöÂÆ¢‰∏ªË¶ÅÂåÖÊã¨‰ª•‰∏ã‰∏â‰∏™ÈÉ®ÂàÜ Êó•Â∏∏‰ΩøÁî® ButterKnife ÁöÑÊñπÂºè‰ª•Âèä ButterKnife ÁöÑ bind ÊñπÊ≥ï Xxx_ViewBinding Á±ªÊòØÂ¶Ç‰ΩïÁîüÊàêÁöÑÔºü Ê≥®Ëß£Â§ÑÁêÜÂô®ÊòØÊÄé‰πàÊ≥®ÂÜåÁöÑÔºü ÂÖ∂‰∏≠ÁöÑ‰ª£Á†ÅÂü∫‰∫é ButterKnife 8.6.0 Êú¨ÊñáÂÅáËÆæ‰Ω†Â∑≤ÁªèÂØπÊ≥®Ëß£ÊúâÊâÄ‰∫ÜËß£„ÄÇ‰∏ç‰∫ÜËß£Ê≥®Ëß£ÁöÑÂêåÂ≠¶ÂèØ‰ª•ÂÖàÁúãÁúãËøôÁØáÊñáÁ´† ÔºåÊàë‰ª¨‰∏ªË¶ÅÂÖ≥Ê≥®ÁºñËØëÊúüÊ≥®Ëß£„ÄÇ ËøêË°åÊúü ButterKnife#bindÊàë‰ª¨ÈÄöÂ∏∏ÈÉΩÊòØÈÄöËøá‰ª•‰∏ãÊñπÂºè‰ΩøÁî® ButterKnife ÁöÑ„ÄÇÂ∞ÜË¶ÅÁªëÂÆöÁöÑÊéß‰ª∂Âä†‰∏ä @BindView Ê≥®Ëß£ÔºåÂú® onCreate ÊñπÊ≥ï ÂÆåÊàê setContentView(R.layout.activity_main); ‰πãÂêé„ÄÇË∞ÉÁî® ButterKnife.bind(this); ÂØπÁõ∏Â∫îÁöÑ View ËøõË°åÂàùÂßãÂåñ„ÄÇ 123456789101112131415public class MainActivity extends AppCompatActivity &#123; private static final String TAG = "MainActivity"; @BindView(R.id.btn) Button mBtn; @BindView(R.id.radar_view) RadarView mRadarView; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ButterKnife.bind(this);//ButterKnife ÁöÑÂÖ•Âè£ &#125;&#125; public static Unbinder bind(@NonNull Activity target) ÔºåÂú® Activity ‰∏≠‰ª•ËØ•ÊñπÊ≥ï‰Ωú‰∏∫ÂÖ•Âè£ÔºåÈ¶ñÂÖàËé∑Âèñ ‰∏é Activity Áõ∏ÂÖ≥ËÅîÁöÑ windowÔºåÁÑ∂ÂêéÂÜçÈÄöËøá window Ëé∑Âèñ DecorView„ÄÇÊúÄÂêéÈÄöËøá createBinding ÊñπÊ≥ïÂàõÂª∫Áõ∏ÂÖ≥ÁªëÂÆö„ÄÇ 1234public static Unbinder bind(@NonNull Activity target) &#123; View sourceView = target.getWindow().getDecorView(); return createBinding(target, sourceView);&#125; 1234567891011121314private static Unbinder createBinding(@NonNull Object target, @NonNull View source) &#123; Class&lt;?&gt; targetClass = target.getClass(); if (debug) Log.d(TAG, "Looking up binding for " + targetClass.getName()); Constructor&lt;? extends Unbinder&gt; constructor = findBindingConstructorForClass(targetClass);//Êü•ÊâæÁõÆÊ†áÁ±ªÁöÑÊûÑÈÄ†Âô® if (constructor == null) &#123; return Unbinder.EMPTY; &#125; try &#123; return constructor.newInstance(target, source);//Âà©Áî®ÂèçÂ∞ÑÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æãÔºåËøôÈáåÂÆûÈôÖ‰∏äË∞ÉÁî®‰∫Ü Xxx_ViewBinding ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºàÁî±Ê≠§ÂèØ‰ª•ÁúãÂà∞ÔºåButterknife ‰πüÊòØÊúâÁî®Âà∞‰∏ÄÁÇπÂèçÂ∞ÑÁöÑÔºâ &#125; //‰ª£Á†ÅÁúÅÁï•&#125; 12345678910111213141516171819202122232425static final Map&lt;Class&lt;?&gt;, Constructor&lt;? extends Unbinder&gt;&gt; BINDINGS = new LinkedHashMap&lt;&gt;();//LinkedHashMap ‰Ωú‰∏∫ÁºìÂ≠òÂÆπÂô®@Nullable @CheckResult @UiThreadprivate static Constructor&lt;? extends Unbinder&gt; findBindingConstructorForClass(Class&lt;?&gt; cls) &#123; Constructor&lt;? extends Unbinder&gt; bindingCtor = BINDINGS.get(cls);//ÂÖà‰ªéÁºìÂ≠ò‰∏≠Êü•Êâæ if (bindingCtor != null) &#123; return bindingCtor;//ÁºìÂ≠òÂëΩ‰∏≠Áõ¥Êé•ËøîÂõû &#125; String clsName = cls.getName();//Ëé∑ÂèñÁ±ªÂûã //Â¶ÇÊûúÊòØ Framework Â±ÇÁöÑÁ±ªÔºåÂàôÁõ¥Êé•ËøîÂõû null if (clsName.startsWith("android.") || clsName.startsWith("java.")) &#123; return null; &#125; try &#123; Class&lt;?&gt; bindingClass = cls.getClassLoader().loadClass(clsName + "_ViewBinding");//Âä†ËΩΩÁ±ª //noinspection unchecked bindingCtor = (Constructor&lt;? extends Unbinder&gt;) bindingClass.getConstructor(cls, View.class);//Ëé∑ÂèñÊûÑÈÄ†Âô® &#125; catch (ClassNotFoundException e) &#123; bindingCtor = findBindingConstructorForClass(cls.getSuperclass());//ÈÄíÂΩíÊü•ÊâæÁà∂Á±ªÁöÑÊûÑÈÄ†Âô® &#125; catch (NoSuchMethodException e) &#123; throw new RuntimeException("Unable to find binding constructor for " + clsName, e); &#125; BINDINGS.put(cls, bindingCtor);//Âä†ÂÖ•Âà∞ÁºìÂ≠ò‰∏≠ return bindingCtor;//ËøîÂõûÊûÑÈÄ†Âô®&#125; ‰ª•‰∏ã‰∏∫ÁºñËØëÂô®ÁîüÊàêÁöÑ MainActivity_ViewBinding Á±ªÔºåËØ•Á±ªÂú®ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂØπÈÇ£‰∫õÂú® MainActivity ‰∏≠Êâì‰∫ÜÊ≥®Ëß£Ôºà‰æãÂ¶ÇÔºö@BindViewÔºâÁöÑ View ËøõË°å‰∫ÜÂàùÂßãÂåñ„ÄÇ 12345678910111213141516171819202122232425262728293031public class MainActivity_ViewBinding implements Unbinder &#123; private MainActivity target;//ÁõÆÊ†áÁ±ª private View view2131427444; private View view2131427442; private View view2131427443; @UiThread public MainActivity_ViewBinding(MainActivity target) &#123; this(target, target.getWindow().getDecorView()); &#125; @UiThread public MainActivity_ViewBinding(final MainActivity target, View source) &#123; this.target = target; View view; view = Utils.findRequiredView(source, R.id.btn, "field 'mBtn' and method 'onViewClicked'");//findViewbyId target.mBtn = Utils.castView(view, R.id.btn, "field 'mBtn'", Button.class);//Âº∫Âà∂Á±ªÂûãËΩ¨Êç¢ view2131427444 = view; view.setOnClickListener(new DebouncingOnClickListener() &#123;//Ê≥®ÂÜåÁõëÂê¨Âô® @Override public void doClick(View p0) &#123; target.onViewClicked(p0); &#125; &#125;); target.mRadarView = Utils.findRequiredViewAsType(source, R.id.radar_view, "field 'mRadarView'", RadarView.class);//findViewbyId &#125; ËøôÈáåÊèí‰∏Ä‰∏™Â∞èËØùÈ¢òÔºöÈÄöÂ∏∏Êàë‰ª¨ÈÉΩ‰ºöÊää‰∏çÈúÄË¶ÅË¢´Â§ñÈÉ®‰ΩøÁî®Âà∞ÁöÑÊàêÂëòÂèòÈáèÂ£∞Êòé‰∏∫ private ÁöÑÔºå‰ΩÜÊòØÂõûÂ§¥ÁúãÁúãÊàë‰ª¨‰ΩøÁî® @BindViewÁöÑ View ËÆøÈóÆÊùÉÈôêÂùá‰∏∫ defalut „ÄÇ‰∏∫‰ªÄ‰πàÂë¢Ôºü‰ªé MainActivity_ViewBinding ÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂèØ‰ª•ÁúãÂà∞ÂØπ View ËøõË°åËµãÂÄºÊó∂Áõ¥Êé•‰ΩøÁî®‰∫Ü target.mBtn„ÄÅ target.mRadarViewÔºåÂ¶ÇÊûúÂ£∞Êòé‰∏∫ private ÔºåÈÇ£Â∞±ÈúÄË¶ÅÈÄöËøáÂèçÂ∞ÑÊâçËÉΩËÆøÈóÆÂà∞ÂØπÂ∫îÁöÑ ViewÔºåËøôÊ†∑‰ºöÊúâÊÄßËÉΩ‰∏äÁöÑÊçüÂ§±„ÄÇ Â∞èÁªìÂú®ËøêË°åÊó∂‰ª• ButterKnife#bind ÊñπÊ≥ï‰Ωú‰∏∫ÂÖ•Âè£ÔºåÈ¶ñÂÖà‰ª•ÁõÆÊ†á class ‰∏∫ key Âà∞ÁºìÂ≠òÔºà‰∏Ä‰∏™ LinkedHashMapÔºâ‰∏≠Êü•ÊâæÁõ∏Â∫îÁöÑ binding classÔºåÂ¶ÇÊûúÂëΩ‰∏≠Áõ¥Êé•ËøîÂõû„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÁºìÂ≠òÔºåÂàôÈÄöËøáÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩÂØπÂ∫îÁöÑ Xxx_ViewBinding Á±ªÔºåÂπ∂Â∞ÜÂÖ∂Âä†ÂÖ•Âà∞ÁºìÂ≠ò‰∏≠ÔºåÁÑ∂ÂêéËøîÂõû„ÄÇÊúÄÂêéË∞ÉÁî® Xxx_ViewBinding Á±ªÁöÑÊûÑÈÄ†Âô®ÔºàÈÄöËøáÂèçÂ∞ÑÔºâÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æã„ÄÇXxx_ViewBinding Á±ªÁöÑÊûÑÈÄ†Âô®‰∏≠ÂÆåÊàê‰∫ÜÂØπ View ÁöÑÁªëÂÆö„ÄÇÊØîÂ¶Ç findViewByIdÔºåsetOnClickListener ÁºñËØëÊúüÁîüÊàê‰ª£Á†ÅQÔºöÂâçÈù¢ÊèêÂà∞ÁöÑ MainActivity_ViewBinding Á±ªÊòØÂ¶Ç‰ΩïÁîüÊàêÁöÑÂë¢Ôºü Answer: Âú®ÁºñËØëÊó∂ÂØπÁ±ª‰∏≠ÁöÑ Annotation ËøõË°åËß£ÊûêÔºåÈÄöËøá JavaPoet ÁîüÊàêÁõ∏Â∫îÁöÑ‰ª£Á†Å„ÄÇ ÁºñËØëÊó∂ Annotation Êåá @Retention ‰∏∫ CLASS ÁöÑ AnnotationÔºåÁî±ÁºñËØëÂô®Ëá™Âä®Ëß£Êûê„ÄÇÂºÄÂèë‰∫∫ÂëòÈúÄË¶ÅÂÅöÁöÑa. Ëá™ÂÆö‰πâÁ±ªÁªßÊâøËá™ AbstractProcessorb. ÈáçÂÜôÂÖ∂‰∏≠ÁöÑ process ÂáΩÊï∞c. Ê≥®ÂÜåÊ≥®Ëß£Â§ÑÁêÜÂô®„ÄÇÊ≥®ÂÜåÂÆåÊàêÂêéÔºåÁºñËØëÂô®Âú®ÁºñËØëÊó∂Ëá™Âä®Êü•ÊâæÊâÄÊúâÁªßÊâøËá™ AbstractProcessor ÁöÑÁ±ªÔºåÁÑ∂ÂêéË∞ÉÁî®‰ªñ‰ª¨ÁöÑ process ÊñπÊ≥ïÂéªÂ§ÑÁêÜ Ëá™ÂÆö‰πâ Annotation Áî®‰∫éÂ≠òÂÇ®ÂÖÉÊï∞ÊçÆ‰ª• BindView Ê≥®Ëß£‰∏∫‰æã 12345@Retention(CLASS) @Target(FIELD)public @interface BindView &#123; /** View ID to which the field will be bound. */ @IdRes int value();&#125; @Retention(CLASS) ÔºöË°®Á§∫‰øùÁïôÂà∞ÁºñËØëÊúü @Target(FIELD)ÔºöË°®Á§∫‰ΩúÁî®Âüü‰∏∫ÊàêÂëòÂèòÈáè Ê≥®Ëß£Â§ÑÁêÜÂô® ButterKnifeProcessorButterKnifeProcessor ÁªßÊâøËá™ AbstractProcessor ÔºåAbstractProcessor ÁöÑ‰∏ªË¶ÅÊ∫êÁ†ÅÂ¶Ç‰∏ãÔºåÊàë‰ª¨‰∏ªË¶ÅÂÖ≥Ê≥®Âõõ‰∏™ÊñπÊ≥ï 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public abstract class AbstractProcessor implements Processor &#123; protected ProcessingEnvironment processingEnv; private boolean initialized = false; protected AbstractProcessor() &#123;//ÈªòËÆ§ÊûÑÈÄ†Âô® &#125; //Ëé∑ÂèñÊîØÊåÅÁöÑÊ≥®Ëß£Á±ªÂûã public Set&lt;String&gt; getSupportedAnnotationTypes() &#123; SupportedAnnotationTypes var1 = (SupportedAnnotationTypes)this.getClass().getAnnotation(SupportedAnnotationTypes.class);//Ëé∑ÂèñÊîØÊåÅÁöÑÊ≥®Ëß£Á±ªÂûã if(var1 == null) &#123; if(this.isInitialized()) &#123;//Â¶ÇÊûúÂ∑≤ÁªèÂàùÂßãÂåñ‰∫ÜÔºåÊâìÂç∞ÊèêÈÜí this.processingEnv.getMessager().printMessage(Kind.WARNING, "No SupportedAnnotationTypes annotation found on " + this.getClass().getName() + ", returning an empty set."); &#125; return Collections.emptySet();//ËøîÂõûÁ©∫ÈõÜ &#125; else &#123; return arrayToSet(var1.value());//ËøîÂõûÊîØÊåÅÁöÑÊ≥®Ëß£ÈõÜÂêà &#125; &#125; public SourceVersion getSupportedSourceVersion() &#123;//Ëé∑ÂèñÊîØÊåÅÁöÑÊ∫êÁ†ÅÁâàÊú¨ SupportedSourceVersion var1 = (SupportedSourceVersion)this.getClass().getAnnotation(SupportedSourceVersion.class);//ÊîØÊåÅÁöÑÊ∫êÁ†ÅÁâàÊú¨ SourceVersion var2 = null; if(var1 == null) &#123; var2 = SourceVersion.RELEASE_6; if(this.isInitialized()) &#123; this.processingEnv.getMessager().printMessage(Kind.WARNING, "No SupportedSourceVersion annotation found on " + this.getClass().getName() + ", returning " + var2 + "."); &#125; &#125; else &#123; var2 = var1.value(); &#125; return var2; &#125; public synchronized void init(ProcessingEnvironment var1) &#123; if(this.initialized) &#123; throw new IllegalStateException("Cannot call init more than once."); &#125; else &#123; Objects.requireNonNull(var1, "Tool provided null ProcessingEnvironment"); this.processingEnv = var1; this.initialized = true; &#125; &#125; public abstract boolean process(Set&lt;? extends TypeElement&gt; var1, RoundEnvironment var2);&#125; init(ProcessingEnvironment env)ÔºöÊØè‰∏™Ê≥®Ëß£Â§ÑÁêÜÂô®ÈÉΩÂøÖÈ°ªÊúâ‰∏™Á©∫ÁöÑÊûÑÈÄ†ÊñπÊ≥ï„ÄÇ‰∏çËøáÔºåÊúâ‰∏Ä‰∏™ÁâπÊÆäÁöÑ init ÊñπÊ≥ïÔºåÂÆÉ‰ºöË¢´Ê≥®Ëß£Â§ÑÁêÜÂô®Â∑•ÂÖ∑‰º†ÂÖ•‰∏Ä‰∏™ ProcessingEnvironment ‰Ωú‰∏∫ÂèÇÊï∞Êù•Ë∞ÉÁî®„ÄÇProcessingEnvironment Êèê‰æõ‰∫Ü‰∏Ä‰∫õÊúâÁî®ÁöÑÂ∑•ÂÖ∑Á±ªÔºåÂ¶Ç ElementsÔºåTypes Âíå Filter„ÄÇÊàë‰ª¨ÂêéÈù¢‰ºöÁî®Âà∞ÂÆÉ‰ª¨„ÄÇ process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)ÔºöËøô‰∏™ÊñπÊ≥ïÂèØ‰ª•ÁúãÂÅöÊØè‰∏™Â§ÑÁêÜÂô®ÁöÑ main ÊñπÊ≥ï„ÄÇ‰Ω†Ë¶ÅÂú®ËøôÈáåÂÜô‰∏ã‰Ω†ÁöÑÊâ´ÊèèÔºåÂà§Êñ≠ÂíåÂ§ÑÁêÜÊ≥®Ëß£ÁöÑ‰ª£Á†ÅÔºåÂπ∂ÁîüÊàê java Êñá‰ª∂„ÄÇÈÄöËøá‰º†ÂÖ•ÁöÑ RoundEnvironment ÂèÇÊï∞Ôºå‰Ω†ÂèØ‰ª•Êü•ËØ¢‰ΩøÁî®‰∫ÜÊüê‰∏™ÁâπÂÆöÊ≥®Ëß£ÁöÑÊâÄÊúâÂÖÉÁ¥†ÔºåÊàë‰ª¨Á®çÂêé‰ºöÁúãÂà∞„ÄÇ getSupportedAnnotationTypes( )ÔºöËøôÈáå‰Ω†ÈúÄË¶ÅËØ¥ÊòéËøô‰∏™Â§ÑÁêÜÂô®ÈúÄË¶ÅÈíàÂØπÂì™‰∫õÊ≥®Ëß£Êù•Ê≥®ÂÜå„ÄÇÊ≥®ÊÑèËøîÂõûÁ±ªÂûãÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÁöÑ SetÔºåÂåÖÂê´‰∫Ü‰Ω†Ë¶ÅÁî®Ëøô‰∏™Â§ÑÁêÜÂô®Â§ÑÁêÜÁöÑÊ≥®Ëß£Á±ªÂûãÁöÑÂÖ®Âêç getSupportedSourceVersion( )ÔºöÁî®‰∫éÊåáÂÆö‰Ω†‰ΩøÁî®ÁöÑ java ÁâàÊú¨„ÄÇÈÄöÂ∏∏‰ºöÈÄâÊã©ËøîÂõûSourceVersion.latestSupported( )„ÄÇÂΩìÁÑ∂Ôºå‰Ω†‰πüÂèØ‰ª•ÊåáÂÆöÂÖ∑‰Ωì java ÁâàÊú¨ÔºöÊØîÂ¶Çreturn SourceVersion.RELEASE_7; ButterKnife ÁöÑËß£ÊûêÂ∑•‰ΩúÂ∞±ÊòØÈÄöËøá ButterKnife#process ÊñπÊ≥ïÂÆûÁé∞ÁöÑ„ÄÇ 123456789101112131415161718192021private Filer filer;//ÊàêÂëòÂèòÈáè@Overridepublic boolean process(Set&lt;? extends TypeElement&gt; elements, RoundEnvironment env) &#123; Map&lt;TypeElement, BindingSet&gt; bindingMap = findAndParseTargets(env);//Êâ´ÊèèÂπ∂Ëß£ÊûêÁõÆÊ†áÁ±ªÔºåËé∑Âèñ Â≠òÂÇ®ÁªëÂÆö‰ø°ÊÅØÁöÑ bindingMap„ÄÇ //ÈÅçÂéÜËé∑ÂèñÂà∞ÁöÑÊ≥®Ëß£ for (Map.Entry&lt;TypeElement, BindingSet&gt; entry : bindingMap.entrySet()) &#123; TypeElement typeElement = entry.getKey(); BindingSet binding = entry.getValue(); JavaFile javaFile = binding.brewJava(sdk);//‰ΩøÁî® javaPoet ÁîüÊàê java Êñá‰ª∂ try &#123; javaFile.writeTo(filer);//Ë∞ÉÁî® javaPoet ÁöÑÊñπÊ≥ïÔºåÂ∞ÜÂÜÖÂÆπÂÜôÂÖ•Êñá‰ª∂ &#125; catch (IOException e) &#123; error(typeElement, "Unable to write binding for type %s: %s", typeElement, e.getMessage()); &#125; &#125; return false; &#125;&#125; process ÊñπÊ≥ïÈ¶ñÂÖàË∞ÉÁî® findAndParseTargets ÊñπÊ≥ïËé∑ÂèñËß£ÊûêÁöÑÁõÆÊ†áÁ±ª 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061private Map&lt;TypeElement, BindingSet&gt; findAndParseTargets(RoundEnvironment env) &#123; Map&lt;TypeElement, BindingSet.Builder&gt; builderMap = new LinkedHashMap&lt;&gt;(); Set&lt;TypeElement&gt; erasedTargetNames = new LinkedHashSet&lt;&gt;(); scanForRClasses(env); // Â§ÑÁêÜ @BindArray ÂÖÉÁ¥†. for (Element element : env.getElementsAnnotatedWith(BindArray.class)) &#123; if (!SuperficialValidation.validateElement(element)) continue; try &#123; parseResourceArray(element, builderMap, erasedTargetNames); &#125; catch (Exception e) &#123; logParsingError(element, BindArray.class, e); &#125; &#125;//‰ª£Á†ÅÁúÅÁï• // ÈÅçÂéÜÂ§ÑÁêÜÊØè‰∏Ä‰∏™Êâì‰∫Ü @BindView Ê≥®Ëß£ÁöÑÂÖÉÁ¥† for (Element element : env.getElementsAnnotatedWith(BindView.class)) &#123; // Ëß£Êûê BindView Ê≥®Ëß£ try &#123; parseBindView(element, builderMap, erasedTargetNames); &#125; catch (Exception e) &#123; logParsingError(element, BindView.class, e); &#125; &#125; // Â§ÑÁêÜÊØè‰∏Ä‰∏™ÂÖ≥ËÅîÊúâÁõëÂê¨Âô®ÁöÑÊ≥®Ëß£ for (Class&lt;? extends Annotation&gt; listener : LISTENERS) &#123; findAndParseListener(env, listener, builderMap, erasedTargetNames); &#125; // Associate superclass binders with their subclass binders. This is a queue-based tree walk // which starts at the roots (superclasses) and walks to the leafs (subclasses). Deque&lt;Map.Entry&lt;TypeElement, BindingSet.Builder&gt;&gt; entries = new ArrayDeque&lt;&gt;(builderMap.entrySet()); Map&lt;TypeElement, BindingSet&gt; bindingMap = new LinkedHashMap&lt;&gt;(); while (!entries.isEmpty()) &#123; Map.Entry&lt;TypeElement, BindingSet.Builder&gt; entry = entries.removeFirst(); TypeElement type = entry.getKey(); BindingSet.Builder builder = entry.getValue(); TypeElement parentType = findParentType(type, erasedTargetNames); if (parentType == null) &#123; bindingMap.put(type, builder.build()); &#125; else &#123; BindingSet parentBinding = bindingMap.get(parentType); if (parentBinding != null) &#123; builder.setParent(parentBinding); bindingMap.put(type, builder.build()); &#125; else &#123; // Has a superclass binding but we haven't built it yet. Re-enqueue for later. entries.addLast(entry); &#125; &#125; &#125; return bindingMap;//ËøîÂõû bindingMapÔºåÁî®‰∫éÂêéÁª≠ javapoet ÁîüÊàê‰ª£Á†Å &#125; ‰∏äÈù¢ÁöÑÊñπÊ≥ïÊòØ‰ª•Ê≥®Ëß£‰∏∫Âçï‰ΩçÔºåÂ§ÑÁêÜÂêÑ‰∏™‰ΩøÁî®‰∫ÜÊ≥®Ëß£ÁöÑÂ±ûÊÄßÔºåÁÑ∂ÂêéÂ∞ÜÂÆÉ‰ª¨Â≠òÊîæÂà∞‰∏Ä‰∏™ Map ‰∏≠„ÄÇÔºàËØ• Map ‰ª•Â±ûÊÄßÊâÄÂú®Á±ª‰∏∫ keyÔºå‰ª•Â±ûÊÄßÈõÜ BindingSet.Builder ‰∏∫ valueÔºâ„ÄÇÈÇ£‰πàÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïËß£ÊûêÁöÑÂë¢Ôºü ÂØπ‰∫é ButterKnife Êàë‰ª¨ÊúÄÂ∏∏Áî®ÁöÑÊòØ @BindViewÔºåÈíàÂØπ BindView Êàë‰ª¨‰∏ªË¶ÅÁúã parseBindView ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂ∞Ü‰ΩøÁî®‰∫Ü@BindView ÁöÑÂ±ûÊÄßÁöÑÁªëÂÆö‰ø°ÊÅØÔºåÂ≠òÊîæÂà∞‰ª•ËØ•Â±ûÊÄßÊâÄÂú®Á±ª‰∏∫ key ÔºåÂÄº‰∏∫ BindingSet.Builder ÁöÑMap ‰∏≠Ôºå‰æõÂêéÁª≠ javaPoet ÁîüÊàê‰ª£Á†Å‰ΩøÁî®„ÄÇ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950private void parseBindView(Element element, Map&lt;TypeElement, BindingSet.Builder&gt; builderMap, Set&lt;TypeElement&gt; erasedTargetNames) &#123; TypeElement enclosingElement = (TypeElement) element.getEnclosingElement();//Ëé∑ÂèñËØ•ÂÖÉÁ¥†ÊâÄÂú®ÁöÑÁ±ªÂØπÂ∫îÁöÑÂÖÉÁ¥†„ÄÇ // Ê£ÄÊü•Â∏∏ËßÅÁöÑ‰ª£Á†ÅÁîüÊàêÈôêÂà∂ boolean hasError = isInaccessibleViaGeneratedCode(BindView.class, "fields", element) || isBindingInWrongPackage(BindView.class, element); // Ê£ÄÊü•ÁõÆÊ†áÁ±ªÂûãÊòØÂê¶ÁªßÊâøËá™ View TypeMirror elementType = element.asType(); if (elementType.getKind() == TypeKind.TYPEVAR) &#123; TypeVariable typeVariable = (TypeVariable) elementType; elementType = typeVariable.getUpperBound(); &#125; Name qualifiedName = enclosingElement.getQualifiedName();//Ëé∑ÂèñÂÖ®Áß∞ Name simpleName = element.getSimpleName();//Ëé∑ÂèñÁÆÄÂçïÂêç//‰ª£Á†ÅÁúÅÁï•‚Ä¶‚Ä¶//Â¶ÇÊûú‰∏çÊòØÊé•Âè£ËÄå‰∏î‰∏çÊòØ View ÁöÑÂ≠êÁ±ªÔºåÂàôÊâìÂç∞ÈîôËØØ‰ø°ÊÅØÔºåÂ∞Ü hasError ÁΩÆ‰∏∫true if (hasError) &#123; return; &#125; // ‰∏ãÈù¢ÂºÄÂßãÊãºÊé•Ë¶ÅÁªëÂÆöÁöÑÂ±ûÊÄßÁöÑ‰ø°ÊÅØ int id = element.getAnnotation(BindView.class).value();//Ëé∑Âèñ R.id.xx BindingSet.Builder builder = builderMap.get(enclosingElement);//Ëé∑ÂèñËØ•Â±ûÊÄßÊâÄÂú®ÁöÑÁ±ªÁöÑ builder QualifiedId qualifiedId = elementToQualifiedId(element, id);//‰ªéÁªëÂÆöËÆ∞ÂΩï‰∏≠Ëé∑ÂèñÔºåÂ¶ÇÊûúÁõ∏Â∫îÁöÑ id Â∑≤ÁªèË¢´ÁªëÂÆöËøá‰∫ÜÔºåÂàôÊä•ÈîôÔºåÂπ∂ÊâìÂç∞Áõ∏Â∫îÁöÑÈîôËØØ‰ø°ÊÅØ if (builder != null) &#123; String existingBindingName = builder.findExistingBindingName(getId(qualifiedId)); if (existingBindingName != null) &#123; error(element, "Attempt to use @%s for an already bound ID %d on '%s'. (%s.%s)", BindView.class.getSimpleName(), id, existingBindingName, enclosingElement.getQualifiedName(), element.getSimpleName()); return; &#125; &#125; else &#123; //ÂàõÂª∫‰∏Ä‰∏™ BindingBuilder builder = getOrCreateBindingBuilder(builderMap, enclosingElement); &#125; String name = simpleName.toString();//ÁÆÄÂçïÁ±ªÂêç TypeName type = TypeName.get(elementType);//Ëé∑ÂèñËØ•Â±ûÊÄßÊâÄÂú®Á±ªÁöÑÁ±ªÂêç boolean required = isFieldRequired(element); builder.addField(getId(qualifiedId), new FieldViewBinding(name, type, required));//ÂàõÂª∫ Field Âπ∂Ê∑ªÂä†Âà∞ BindingSet.Builder ÁöÑ field ‰∏≠ // Add the type-erased version to the valid binding targets set. erasedTargetNames.add(enclosingElement); &#125; ÂÅáËÆæÊàë‰ª¨Âú®Êüê‰∏Ä‰∏™Á±ª‰∏≠ÈáçÂ§çÁªëÂÆö‰∫ÜÁõ∏ÂêåÁöÑ idÔºåÊØîÂ¶Ç‰∏ãÈù¢Ëøô‰∏™‰æãÂ≠êÂØπ R.id.app_bar_layout ËøõË°å‰∫Ü‰∏§Ê¨°ÁªëÂÆöÔºö 1234@BindView(R.id.app_bar_layout)AppBarLayout mAppBarLayout;@BindView(R.id.app_bar_layout)//ÁªëÂÆö‰∫ÜÁõ∏ÂêåÁöÑ idÔºå‰ºöÊä•ÈîôAppBarLayout mAppBarLayout2; Âú®ÁºñËØëÊúü‰ºöÊä•Â¶Ç‰∏ãÈîôËØØÔºö Error:(36, 18) ÈîôËØØ: Attempt to use @BindView for an already bound ID 2131230757 on &#39;mAppBarLayout&#39;. (com.android.rdc.librarysystem.MainActivity.mAppBarLayout2) Â∞èÁªìButterKnife ÊòØ‰ª•ËøôÊ†∑ÁöÑÊñπÂºèÊù•Â§ÑÁêÜÊ≥®Ëß£ÁöÑÔºöButterKnife ÊîØÊåÅÂ§öÁßçÊ≥®Ëß£ÔºàÊØîÂ¶Ç @BindView „ÄÅ@BindColorÔºâÔºåËøô‰∫õÊ≥®Ëß£Ë¢´ÊåâÁÖß‰∏ÄÂÆöÁöÑÈ°∫Â∫èÂ§ÑÁêÜ„ÄÇËé∑Âèñ‰ΩøÁî®‰∫ÜÊüê‰∏™Ê≥®Ëß£ÁöÑÊâÄÊúâ ElementÔºåÂØπËØ• Element ÁöÑËøõË°åÂ§ÑÁêÜÔºåÁîüÊàêÁõ∏Â∫îÁöÑ FieldXxxBinding ÁÑ∂ÂêéÂ∞ÜÂÆÉÊ∑ªÂä†Âà∞ËØ• Element ÊâÄÂú®Á±ªÁöÑ BindingSet.Builder ‰∏≠„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÔºåButterKnife ÊòØ‰ª•Ê≥®Ëß£‰∏∫Âçï‰ΩçËøõË°åËß£ÊûêÔºåÂ§ÑÁêÜÂÆå‰∫ÜÔºåÂ∞±ÊääÂÆÉÊîæÂà∞Áõ∏Â∫îÂ±ûÊÄßÊâÄÂú®Á±ªÂØπÂ∫îÁöÑ Set ÈáåÈù¢ÔºàËÄå‰∏çÊòØ‰∏ÄÊ¨°Êâ´Êèè‰∏Ä‰∏™Á±ªÔºåÁÑ∂ÂêéÂØπËØ•Á±ª‰∏≠Â±ûÊÄß‰ΩøÁî®Âà∞ÁöÑÊ≥®Ëß£ËøõË°åÂ§ÑÁêÜÔºå‰∏ÄÊ¨°ÊÄßÁîüÊàêÊüê‰∏™Á±ªÁöÑÊâÄÂØπÂ∫îÁöÑ BindingSet.Builder Ôºâ„ÄÇ ÈÄöËøá JavaPoet ÁîüÊàê java Êñá‰ª∂Ê≠£Â¶ÇÂÖ∂ÂêçÔºåpoet ÊåáËØó‰∫∫Ôºå‰πüÂ∞±ÊòØ‰ΩúËØóÁöÑ‰∫∫„ÄÇjava poet ÊåáÁöÑÊòØËÉΩÂ§üËá™Âä®ÂÜô java Ê∫ê‰ª£Á†ÅÁöÑÂ∫ì„ÄÇ javapoet ÈáåÈù¢Â∏∏Áî®ÁöÑÂá†‰∏™Á±ªÔºö TypeName Java Á≥ªÁªüÁöÑÊâÄÊúâÁ±ªÂûãÔºåÂä†‰∏ä void Á±ªÂûã MethodSpec ‰ª£Ë°®‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞ÊàñÊñπÊ≥ïÂ£∞Êòé„ÄÇ TypeSpec ‰ª£Ë°®‰∏Ä‰∏™Á±ªÔºåÊé•Âè£ÔºåÊàñËÄÖÊûö‰∏æÂ£∞Êòé„ÄÇ FieldSpec ‰ª£Ë°®‰∏Ä‰∏™ÊàêÂëòÂèòÈáèÔºå‰∏Ä‰∏™Â≠óÊÆµÂ£∞Êòé„ÄÇ JavaFileÂåÖÂê´‰∏Ä‰∏™È°∂Á∫ßÁ±ªÁöÑ Java Êñá‰ª∂„ÄÇ ÂõûÂà∞ÂâçÈù¢ÁöÑ process ÊñπÊ≥ïÔºåÂèØ‰ª•ÁúãÂà∞ JavaFile javaFile = binding.brewJava(sdk); javaFile.writeTo(filer); BindingSet#brewJava „ÄÇËØ•ÊñπÊ≥ïÈÄöËøá Javapoet ÁîüÊàê‰∏Ä‰∏™ java Êñá‰ª∂ 12345JavaFile brewJava(int sdk) &#123; return JavaFile.builder(bindingClassName.packageName(), createType(sdk)) .addFileComment("Generated code from Butter Knife. Do not modify!")//Ê∑ªÂä†Êñá‰ª∂Ê≥®Èáä .build();&#125; ÂÖ≥‰∫é javapoet ÁöÑ‰ªãÁªçËØ¶ËßÅËøôÁØáÊñáÁ´† Ê≥®Ëß£Â§ÑÁêÜÂô®ÁöÑÊ≥®ÂÜåÊñπÊ≥ï 1Ôºö‰ΩøÁî® google Êèê‰æõÁöÑÊ≥®ÂÜåÂ§ÑÁêÜÂô®Â∫ìÊúÄÁÆÄÂçïÁöÑÊñπÂºèÊòØ‰ΩøÁî® google Êèê‰æõÁöÑ‰∏Ä‰∏™Ê≥®ÂÜåÂ§ÑÁêÜÂô®ÁöÑÂ∫ì„ÄÇ compile &#39;com.google.auto.service:auto-service:1.0-rc2&#39; ÁÑ∂Âêé@AutoService(Processor.class):Âêë javac Ê≥®ÂÜåÊàë‰ª¨Ëøô‰∏™Ëá™ÂÆö‰πâÁöÑÊ≥®Ëß£Â§ÑÁêÜÂô®ÔºåËøôÊ†∑ÔºåÂú® javac ÁºñËØëÊó∂ÔºåÊâç‰ºöË∞ÉÁî®Âà∞Êàë‰ª¨Ëøô‰∏™Ëá™ÂÆö‰πâÁöÑÊ≥®Ëß£Â§ÑÁêÜÂô®ÊñπÊ≥ï„ÄÇ AutoService ËøôÈáå‰∏ªË¶ÅÊòØÁî®Êù•ÁîüÊàêMETA-INF/services/javax.annotation.processing.ProcessorÊñá‰ª∂ÁöÑ„ÄÇ ÊñπÊ≥ï 2ÔºöÊâãÂä®Ê≥®ÂÜåÂ¶ÇÊûú‰∏ç‰ΩøÁî®‰∏äËø∞Â§ÑÁêÜÂ∫ìÔºåÈÇ£‰πàÔºå‰Ω†ÈúÄË¶ÅËá™Â∑±ËøõË°åÊâãÂä®ÈÖçÁΩÆËøõË°åÊ≥®ÂÜåÔºåÂÖ∑‰ΩìÊâãÂä®Ê≥®ÂÜåÊñπÊ≥ïÂ¶Ç‰∏ãÔºö1.ÂàõÂª∫‰∏Ä‰∏™META-INF/services/javax.annotation.processing.Processor Êñá‰ª∂ÔºåÂÖ∂ÂÜÖÂÆπÊòØ‰∏ÄÁ≥ªÂàóÁöÑËá™ÂÆö‰πâÊ≥®Ëß£Â§ÑÁêÜÂô®ÂÆåÊï¥ÊúâÊïàÁ±ªÂêçÈõÜÂêàÔºå‰ª•Êç¢Ë°åÂàáÂâ≤Ôºö 123com.example.MyProcessorcom.foo.OtherProcessornet.blabla.SpecialProcessor 2.Â∞ÜËá™ÂÆö‰πâÊ≥®Ëß£Â§ÑÁêÜÂô®ÂíåMETA-INF/services/javax.annotation.processing.Processor ÊâìÂåÖÊàê‰∏Ä‰∏™.jar Êñá‰ª∂„ÄÇÊâÄ‰ª•ÂÖ∂ÁõÆÂΩïÁªìÊûÑÂ§ßÊ¶ÇÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö 12345678MyProcessor.jar - com - example - MyProcessor.class - META-INF - services - javax.annotation.processing.Processor ButterKnife ‰ΩøÁî®ÁöÑÊòØÁ¨¨‰∏ÄÁßçÊñπÂºè„ÄÇ 1234@AutoService(Processor.class)public final class ButterKnifeProcessor extends AbstractProcessor &#123; //...&#125; ÊÄªÁªìButterKnife Âú®ÁºñËØëÁöÑÊó∂ÂÄôÂ∏ÆÊàë‰ª¨Ëá™Âä®ÁîüÊàê‰∫ÜÁªëÂÆöÁöÑ‰ª£Á†ÅÔºåÁÑ∂ÂêéÂú®ËøêË°åÁöÑÊó∂ÂÄôË∞ÉÁî®Â∞±Ë°å‰∫Ü„ÄÇ È¶ñÂÖàÊàë‰ª¨Âú®ÈúÄË¶ÅÁªëÂÆö View ÁöÑ Âú∞Êñπ‰ΩøÁî® @BindView ÊàñËÄÖ ButterKnife Êèê‰æõÁöÑÂÖ∂‰ªñÊ≥®Ëß£ÔºåÊØîÂ¶Ç @BindColor Âú®ÁºñËØëÊúü ButterKnifeProcessor ÁöÑ process ÂáΩÊï∞‰ºöË¢´Ë∞ÉÁî®ÔºåÂú®ÂÖ∂‰∏≠Ëé∑Âèñ‰ΩøÁî®‰∫ÜÁõ∏Â∫îÊ≥®Ëß£ÁöÑÁõ∏ÂÖ≥ÊñπÊ≥ï/ÊàêÂëòÂèòÈáè‰ø°ÊÅØÔºåÈÄöËøá javapoet ÁîüÊàê Xx_ViewBinder Âíå Xx_ViewBinding Á±ª„ÄÇ ËøêË°åÊó∂ÔºåonCreate ÊñπÊ≥ï‰∏≠ÈÄöÂ∏∏ÈúÄË¶Å ButterKnife.Bind()ÊñπÊ≥ïÔºå‰ªéÊ≠§Â§ÑËøõÂÖ•ÔºåÈÄöËøá ÂèçÂ∞ÑË∞ÉÁî® Xx_ViewBinding ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÂØπ View ËøõË°åÂàùÂßãÂåñ„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ÂÖ¨ÂÖ±ÊäÄÊúØÁÇπ‰πã Java Ê≥®Ëß£ Annotation ButterKnife Ê∫êÁ†ÅÂàÜÊûê Ê∑±ÂÖ•ÁêÜËß£ ButterKnifeÔºåËÆ©‰Ω†ÁöÑÁ®ãÂ∫èÂ≠¶‰ºöÂÜô‰ª£Á†Å javapoet‚Äî‚ÄîËÆ©‰Ω†‰ªéÈáçÂ§çÊó†ËÅäÁöÑ‰ª£Á†Å‰∏≠Ëß£ÊîæÂá∫Êù• Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫ê„ÄÇË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Ê∫êÁ†ÅÂàÜÊûê</category>
        <category>Ê°ÜÊû∂ÂéüÁêÜ</category>
      </categories>
      <tags>
        <tag>Ê∫êÁ†ÅÂàÜÊûê</tag>
        <tag>Ê°ÜÊû∂ÂéüÁêÜ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[String StringBuilder‰∏éStringBufferÁöÑÂå∫Âà´]]></title>
    <url>%2Fblog%2F2017%2F09%2F21%2FString-StringBuilder%E4%B8%8EStringBuffer%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[Ê¶ÇËø∞ CharSequence Â∞±ÊòØÂ≠óÁ¨¶Â∫èÂàóÔºåString, StringBuilder Âíå StringBuffer Êú¨Ë¥®‰∏äÈÉΩÊòØÈÄöËøáÂ≠óÁ¨¶Êï∞ÁªÑÂÆûÁé∞ÁöÑ„ÄÇ String Â≠óÁ¨¶‰∏≤Â∏∏ÈáèÔºà‰∏çÂèØÂèòÔºâ StringBuffer Â≠óÁ¨¶‰∏≤ÂèòÈáèÔºàÁ∫øÁ®ãÂÆâÂÖ®Ôºâ StringBuilder Â≠óÁ¨¶‰∏≤ÂèòÈáèÔºàÈùûÁ∫øÁ®ãÂÆâÂÖ®Ôºâ String Á±ªÂûãÂíå StringBuilder Á±ªÂûãÁöÑ‰∏ªË¶ÅÊÄßËÉΩÂå∫Âà´ String ÊòØ‰∏çÂèØÂèòÁöÑÂØπË±°,Âõ†Ê≠§Âú®ÊØèÊ¨°ÂØπ String Á±ªÂûãËøõË°åÊîπÂèòÁöÑÊó∂ÂÄôÂÖ∂ÂÆûÈÉΩÁ≠âÂêå‰∫éÁîüÊàê‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑ String ÂØπË±°ÔºåÁÑ∂ÂêéÂ∞ÜÊåáÈíàÊåáÂêëÊñ∞ÁöÑ String ÂØπË±°ÔºåÊâÄ‰ª•ÁªèÂ∏∏ÊîπÂèòÂÜÖÂÆπÁöÑÂ≠óÁ¨¶‰∏≤ÊúÄÂ•Ω‰∏çË¶ÅÁî® String ÔºåÂõ†‰∏∫ÊØèÊ¨°ÁîüÊàêÂØπË±°ÈÉΩ‰ºöÂØπÁ≥ªÁªüÊÄßËÉΩ‰∫ßÁîüÂΩ±ÂìçÔºåÁâπÂà´ÂΩìÂÜÖÂ≠ò‰∏≠Êó†ÂºïÁî®ÂØπË±°Â§ö‰∫Ü‰ª•ÂêéÔºå JVM ÁöÑ GC Â∞±‰ºöÂºÄÂßãÂ∑•‰ΩúÔºå‰ºöËøõ‰∏ÄÊ≠•Ê∂àËÄóÊÄßËÉΩ„ÄÇ StringBuilder ÊòØÂèØÂèòÁöÑÔºå ÂèØ‰ª•ÂØπ StringBuilder ÂØπË±°Êú¨Ë∫´ËøõË°åÊìç‰ΩúÔºåËÄå‰∏çÊòØÁîüÊàêÊñ∞ÁöÑÂØπË±°ÔºåÂÜçÊîπÂèòÂØπË±°ÂºïÁî®„ÄÇÊâÄ‰ª•Âú®‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÊàë‰ª¨Êé®Ëçê‰ΩøÁî® StringBuilder ÔºåÁâπÂà´ÊòØÂ≠óÁ¨¶‰∏≤ÂØπË±°ÁªèÂ∏∏ÊîπÂèòÁöÑÊÉÖÂÜµ‰∏ã„ÄÇ ÈÄöÂ∏∏ String ÂØπË±°ÁöÑÂ≠óÁ¨¶‰∏≤ÊãºÊé•ÂÖ∂ÂÆûÊòØË¢´ JVM Ëß£ÈáäÊàê‰∫Ü StringBuilder ÂØπË±°ÁöÑÊãºÊé•ÔºåÊâÄ‰ª•Ëøô‰∫õÊó∂ÂÄô String ÂØπË±°ÁöÑÈÄüÂ∫¶Âπ∂‰∏ç‰ºöÊØî StringBuilder ÂØπË±°ÊÖ¢„ÄÇ ÁâπÂà´ÊòØ‰ª•‰∏ãÁöÑÂ≠óÁ¨¶‰∏≤ÂØπË±°ÁîüÊàê‰∏≠ÔºåString ÊïàÁéáÊòØËøúË¶ÅÊØî StringBuffer È´òÁöÑÔºö 12String S1 = ‚ÄúThis is only a‚Äù + ‚Äú simple‚Äù + ‚Äú test‚Äù;//Áõ¥Êé•ÊãºÊé•Áé∞ÊúâÂ≠óÁ¨¶‰∏≤StringBuffer Sb = new StringBuilder(‚ÄúThis is only a‚Äù).append(‚Äú simple‚Äù).append(‚Äú test‚Äù); ËøôÂÖ∂ÂÆûÊ∂âÂèäÂà∞‰∫ÜÁºñËØëÂô®ÁöÑ‰ºòÂåñ„ÄÇÂú®ÁºñËØëÊúüÔºåÁºñËØëÂô®‰ºöÊääÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÁõ∏Âä†ÁöÑÊÉÖÂÜµÁõ¥Êé•Âèò‰∏∫ÊãºÊé•‰∏∫ÁõÆÊ†áÂ≠óÁ¨¶‰∏≤„ÄÇ‰πüÂ∞±ÊòØËØ¥ÁºñËØë‰πãÂêéÂ∞±Ëé∑Âæó‰∫ÜÁõÆÊ†áÂ≠óÁ¨¶‰∏≤„ÄÇ 123String S1 = ‚ÄúThis is only a‚Äù + ‚Äú simple‚Äù + ‚Äútest‚Äù; //ÂÖ∂ÂÆûÂ∞±ÊòØÔºöString S1 = ‚ÄúThis is only a simple test‚Äù; ÊâÄ‰ª•ÂΩìÁÑ∂‰∏çÈúÄË¶ÅÂ§™Â§öÁöÑÊó∂Èó¥‰∫Ü„ÄÇË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûú‰Ω†ÁöÑÂ≠óÁ¨¶‰∏≤ÊòØÊù•Ëá™Âè¶Â§ñÁöÑ String ÂØπË±°ÁöÑËØùÔºàÊØîÂ¶Ç‰∏ãÈù¢ÊâÄÂàó‰∏æÁöÑËøô‰∏™‰æãÂ≠êÔºâÔºåÁõ¥Êé•Â∞Ü String Áõ∏Âä†ÔºåÊÄßËÉΩ‰∏ä‰∏ç‰ºöÊúâ‰ªÄ‰πàÊèêÂçá„ÄÇ 1234String S2 = ‚ÄúThis is only a‚Äù;String S3 = ‚Äú simple‚Äù;String S4 = ‚Äú test‚Äù;String S1 = S2 + S3 + S4; ËøôÊó∂ÂÄô JVM ‰ºöËßÑËßÑÁü©Áü©ÁöÑÊåâÁÖßÂéüÊù•ÁöÑÊñπÂºèÂéªÂÅö‚Äî‚ÄîÂÖàÂàõÂª∫‰∏Ä‰∏™ StringBuilder ÂØπË±°ÔºåÁÑ∂ÂêéÂÜçËøõË°åË∞ÉÁî®ÂÆÉÁöÑ append ÊñπÊ≥ïÂØπ Â≠óÁ¨¶‰∏≤ËøõË°åÊãºÊé•„ÄÇ StringBufferStringBuffer ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂèØÂèòÂ≠óÁ¨¶Â∫èÂàó„ÄÇ‰∏Ä‰∏™Á±ª‰ºº‰∫é String ÁöÑÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫Ôºå‰ΩÜ‰∏çËÉΩ‰øÆÊîπ„ÄÇËôΩÁÑ∂Âú®‰ªªÊÑèÊó∂Èó¥ÁÇπ‰∏äÂÆÉÈÉΩÂåÖÂê´ÊüêÁßçÁâπÂÆöÁöÑÂ≠óÁ¨¶Â∫èÂàóÔºå‰ΩÜÈÄöËøáÊüê‰∫õÊñπÊ≥ïË∞ÉÁî®ÂèØ‰ª•ÊîπÂèòËØ•Â∫èÂàóÁöÑÈïøÂ∫¶ÂíåÂÜÖÂÆπ„ÄÇ ÂèØÂ∞ÜÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫ÂÆâÂÖ®Âú∞Áî®‰∫éÂ§ö‰∏™Á∫øÁ®ã„ÄÇÂèØ‰ª•Âú®ÂøÖË¶ÅÊó∂ÂØπËøô‰∫õÊñπÊ≥ïËøõË°åÂêåÊ≠•ÔºåÂõ†Ê≠§‰ªªÊÑèÁâπÂÆöÂÆû‰æã‰∏äÁöÑÊâÄÊúâÊìç‰ΩúÂ∞±Â•ΩÂÉèÊòØ‰ª•‰∏≤Ë°åÈ°∫Â∫èÂèëÁîüÁöÑÔºåËØ•È°∫Â∫è‰∏éÊâÄÊ∂âÂèäÁöÑÊØè‰∏™Á∫øÁ®ãËøõË°åÁöÑÊñπÊ≥ïË∞ÉÁî®È°∫Â∫è‰∏ÄËá¥„ÄÇ ‰∏ªË¶ÅÊìç‰Ωú:append Âíå insert ÊñπÊ≥ïÔºåÂèØÈáçËΩΩËøô‰∫õÊñπÊ≥ïÔºå‰ª•Êé•Âèó‰ªªÊÑèÁ±ªÂûãÁöÑÊï∞ÊçÆ„ÄÇ append ÊñπÊ≥ïÂßãÁªàÂ∞ÜËøô‰∫õÂ≠óÁ¨¶Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫ÁöÑÊú´Á´Ø„ÄÇ insert ÊñπÊ≥ïÂàôÂú®ÊåáÂÆöÁöÑÁÇπÊ∑ªÂä†Â≠óÁ¨¶„ÄÇ ‰æãÂ¶Ç:z ÂºïÁî®‰∏Ä‰∏™ÂΩìÂâçÂÜÖÂÆπÊòØ‚Äústart‚ÄùÁöÑÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫ÂØπË±°ÔºåÁî® z.append(‚Äúle‚Äù) ‰ºö‰ΩøÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫ÂåÖÂê´‚Äústartle‚ÄùÔºåËÄå z.insert(4, ‚Äúle‚Äù) Â∞ÜÊõ¥ÊîπÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫Ôºå‰Ωø‰πãÂåÖÂê´‚Äústarlet‚Äù„ÄÇ StringBuilderStringBuilder ÊòØ Java5 Êñ∞Â¢ûÁöÑ‰∏Ä‰∏™ÈùûÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂèØÂèòÁöÑÂ≠óÁ¨¶Â∫èÂàó„ÄÇÂèØ‰ª•ÊääÂÆÉÁêÜËß£‰∏∫ StringBuffer ÁöÑÈùûÁ∫øÁ®ãÂÆâÂÖ®ÁâàÊú¨ÔºåÂõ†‰∏∫ÂÆûÈôÖÂ∫îÁî®‰∏≠ÂæàÂ∞ëÊúâÈúÄË¶ÅÂØπÂ≠óÁ¨¶‰∏≤ËøõË°åÂêåÊ≠•ÁöÑÊÉÖÂÜµÔºåÊâÄ‰ª•ÈááÁî® StringBuilder ÁöÑÊÄßËÉΩÊõ¥Âä†„ÄÇÂú®‰∏çÈúÄË¶ÅÂêåÊ≠•Ôºå‰ºòÂÖàÈááÁî® StringBuilder„ÄÇ ÂàùÂßãÈïøÂ∫¶ÂàÜ‰∏∫‰∏âÁßçÊÉÖÂÜµ: Â¶ÇÊûúÊòØË∞ÉÁî®ÁöÑÊòØÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞ÔºåÂàôÈªòËÆ§ÂÆπÈáè‰∏∫ 16 Â¶ÇÊûúÊåáÂÆö‰∫Ü‰∏Ä‰∏™Â§ß‰∫é 0 ÁöÑ capacityÔºåÂàôÂàùÂßãÂÆπÈáè‰∏∫ ÊåáÂÆöÁöÑ capacity Â¶ÇÊûú‰ΩøÁî®‰∫ÜÂèÇÊï∞Á±ªÂûã‰∏∫ CharSequence/String ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÔºåÂàôÂàùÂßãÂÆπÈáè‰∏∫CharSequenceÁöÑÈïøÂ∫¶ + 16„ÄÇ Êâ©ÂÆπÊØèÊ¨° append ÁöÑÊó∂ÂÄôÈÉΩ‰ºöË∞ÉÁî® ensureCapacityInternal ÔºåÂΩìÂâçÈïøÂ∫¶ + append ÂÜÖÂÆπÊÄªÈïøÂ∫¶‰Ωú‰∏∫ minimumCapacityÔºåÂ¶ÇÊûú minimumCapacity Ë∂ÖËøá‰∫Ü value Êï∞ÁªÑÁöÑÈïøÂ∫¶ÔºåÂ∞±Â∞Üvalue Êï∞ÁªÑÂ§çÂà∂Âà∞ÈïøÂ∫¶‰∏∫ newCapacity ÁöÑÊñ∞Êï∞ÁªÑÔºå ‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã newCapacity Â§ß‰∫é minimumCapacity 1234567891011121314/** * For positive values of &#123;@code minimumCapacity&#125;, this method * behaves like &#123;@code ensureCapacity&#125;, however it is never * synchronized. * If &#123;@code minimumCapacity&#125; is non positive due to numeric * overflow, this method throws &#123;@code OutOfMemoryError&#125;. */private void ensureCapacityInternal(int minimumCapacity) &#123; // overflow-conscious code if (minimumCapacity - value.length &gt; 0) &#123; value = Arrays.copyOf(value, newCapacity(minimumCapacity)); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839/** * The maximum size of array to allocate (unless necessary). * Some VMs reserve some header words in an array. * Attempts to allocate larger arrays may result in * OutOfMemoryError: Requested array size exceeds VM limit */private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;/** * Returns a capacity at least as large as the given minimum capacity. * Returns the current capacity increased by the same amount + 2 if * that suffices. * Will not return a capacity greater than &#123;@code MAX_ARRAY_SIZE&#125; * unless the given minimum capacity is greater than that. * * @param minCapacity the desired minimum capacity * @throws OutOfMemoryError if minCapacity is less than zero or * greater than Integer.MAX_VALUE * ËøîÂõû‰∏Ä‰∏™Ëá≥Â∞ëË∑ü minCapacity ‰∏ÄÊ†∑Â§ßÁöÑÂÄº„ÄÇÂ¶ÇÊûúÁ©∫Èó¥Ë∂≥Â§üÁöÑËØùÔºåÂΩìÂâçÁöÑÂÆπÈáè‰ºöÂ¢ûÈïø‰∏ÄÂÄç +2 „ÄÇ * Èô§ÈùûÁªôÂÆöÁöÑÂÄºË∂ÖËøáMAX_ARRAY_SIZE„ÄÇÂê¶ÂàôËøîÂõûÁöÑÂÆπÈáè‰∏ç‰ºöË∂ÖËøá MAX_ARRAY_SIZE„ÄÇ */private int newCapacity(int minCapacity) &#123; // overflow-conscious code„ÄÇÈò≤Ê≠¢Ê∫¢Âá∫ int newCapacity = (value.length &lt;&lt; 1) + 2;//ÂΩìÂâçÊï∞ÁªÑÈïøÂ∫¶ * 2 + 2 if (newCapacity - minCapacity &lt; 0) &#123;//Â¶ÇÊûúÊñ∞ÈïøÂ∫¶ &lt; minCapacityÔºåÂ∞ÜÊñ∞ÈïøÂ∫¶ËµãÂÄº‰∏∫ minCapacity newCapacity = minCapacity; &#125; return (newCapacity &lt;= 0 || MAX_ARRAY_SIZE - newCapacity &lt; 0) ? hugeCapacity(minCapacity)//Ê£ÄÊü•Ê∫¢Âá∫„ÄÇÂ¶ÇÊûúÊ∫¢Âá∫‰∫ÜÔºåÊäõÂá∫ÈîôËØØ„ÄÇÂê¶ÂàôÁΩÆ‰∏∫ MAX_ARRAY_SIZE : newCapacity;//ÈïøÂ∫¶Âú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÁõ¥Êé•‰ΩøÁî®ËØ•ÈïøÂ∫¶&#125;private int hugeCapacity(int minCapacity) &#123; if (Integer.MAX_VALUE - minCapacity &lt; 0) &#123; // overflow throw new OutOfMemoryError(); &#125; return (minCapacity &gt; MAX_ARRAY_SIZE) ? minCapacity : MAX_ARRAY_SIZE;&#125; ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Class StringBuilder Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>java Âü∫Á°Ä</category>
      </categories>
      <tags>
        <tag>java Âü∫Á°Ä</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËôöÊãüÊú∫Á±ªÂä†ËΩΩÊú∫Âà∂]]></title>
    <url>%2Fblog%2F2017%2F09%2F19%2FJVM%20%E4%B9%8B%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[Ê¶ÇËø∞ËôöÊãüÊú∫ÁöÑÁ±ªÂä†ËΩΩÊú∫Âà∂ÔºöËôöÊãüÊú∫ÊääÊèèËø∞Á±ªÁöÑÊï∞ÊçÆ‰ªé Class Êñá‰ª∂Âä†ËΩΩÂà∞ÂÜÖÂ≠òÔºåÂπ∂ÂØπÊï∞ÊçÆËøõË°åÊ†°È™å„ÄÅËΩ¨Êç¢Ëß£ÊûêÂíåÂàùÂßãÂåñÔºåÊúÄÁªàÂΩ¢ÊàêÂèØ‰ª•Ë¢´ËôöÊãüÊú∫Áõ¥Êé•‰ΩøÁî®ÁöÑ Java Á±ªÂûã„ÄÇ ‰∏éÈÇ£‰∫õÂú®ÁºñËØëÊó∂ÈúÄË¶ÅËøõË°åËøûÊé•Â∑•‰ΩúÁöÑËØ≠Ë®Ä‰∏çÂêåÔºåÂú® Java ËØ≠Ë®ÄÈáåÈù¢ÔºåÁ±ªÂûãÁöÑÂä†ËΩΩ„ÄÅËøûÊé•ÂíåÂàùÂßãÂåñËøáÁ®ãÈÉΩÊòØÂú®Á®ãÂ∫èËøêË°åÊúüÈó¥ÂÆåÊàêÁöÑÔºå Áº∫ÁÇπÔºöËøôÁßçÁ≠ñÁï•‰ºö‰ª§Á±ªÂä†ËΩΩÊó∂Á®çÂæÆÂ¢ûÂä†‰∏Ä‰∫õÊÄßËÉΩÂºÄÈîÄ ‰ºòÁÇπÔºö‰∏∫ Java Â∫îÁî®Á®ãÂ∫èÊèê‰æõÈ´òÂ∫¶ÁöÑÁÅµÊ¥ªÊÄßÔºåJava ÈáåÂ§©ÁîüÂèØ‰ª•Âä®ÊÄÅÊâ©Â±ïÁöÑËØ≠Ë®ÄÁâπÊÄßÂ∞±ÊòØ‰æùËµñËøêË°åÊúüÂä®ÊÄÅÂä†ËΩΩÂíåÂä®ÊÄÅËøûÊé•Ëøô‰∏™ÁâπÁÇπÂÆûÁé∞ÁöÑ„ÄÇ ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÁºñÂÜô‰∏Ä‰∏™Èù¢ÂêëÊé•Âè£ÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÂèØ‰ª•Á≠âÂà∞ËøêË°åÊó∂ÂÜçÊåáÂÆöÂÖ∂ÂÆûÈôÖÁöÑÂÆûÁé∞Á±ªÔºõ Á∫¶ÂÆöÔºö Á¨¨‰∏ÄÔºåÂú®ÂÆûÈôÖÊÉÖÂÜµ‰∏≠ÔºåÂêéÊñá‰∏≠Áõ¥Êé•ÂØπ„ÄåÁ±ª„ÄçÁöÑÊèèËø∞ÈÉΩÂåÖÊã¨‰∫ÜÁ±ªÂíåÊé•Âè£ÁöÑÂèØËÉΩÊÄßÔºåËÄåÂØπ‰∫éÁ±ªÂíåÊé•Âè£ÈúÄË¶ÅÂàÜÂºÄÊèèËø∞ÁöÑÂú∫ÊôØ‰ºöÁâπÂà´ÊåáÊòéÔºõ Á¨¨‰∫åÔºå„ÄåClass Êñá‰ª∂„ÄçÂπ∂ÈùûÁâπÊåáÊüê‰∏™Â≠òÂú®‰∫éÂÖ∑‰ΩìÁ£ÅÁõò‰∏≠ÁöÑÊñá‰ª∂ÔºåËøôÈáåÊâÄËØ¥ÁöÑ„ÄåClass Êñá‰ª∂„ÄçÂ∫îÂΩìÊòØ‰∏Ä‰∏≤‰∫åËøõÂà∂ÁöÑÂ≠óËäÇÊµÅÔºåÊó†ËÆ∫‰ª•‰ΩïÁßçÂΩ¢ÂºèÂ≠òÂú®ÈÉΩÂèØ‰ª•„ÄÇ Á±ªÂä†ËΩΩÁöÑÊó∂Êú∫‰∏É‰∏™Èò∂ÊÆµÔºöÂ¶Ç‰∏ãÊâÄÁ§∫ ‰∏äÂõæ‰∏≠ÔºåÂä†ËΩΩ„ÄÅÈ™åËØÅ„ÄÅÂáÜÂ§á„ÄÅÂàùÂßãÂåñÂíåÂç∏ËΩΩËøô 5 ‰∏™Èò∂ÊÆµÁöÑÈ°∫Â∫èÊòØÁ°ÆÂÆöÁöÑÔºåÁ±ªÁöÑÂä†ËΩΩËøáÁ®ãÂøÖÈ°ªÊåâÁÖßËøôÁßçÈ°∫Â∫èÊåâÈÉ®Â∞±Áè≠Âú∞ÂºÄÂßãÔºåËÄå==Ëß£ÊûêÈò∂ÊÆµÂàô‰∏ç‰∏ÄÂÆö==ÔºöÂÆÉÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÂèØ‰ª•Âú®ÂàùÂßãÂåñÈò∂ÊÆµ‰πãÂêéÂÜçÂºÄÂßãÔºåËøôÊòØ‰∏∫‰∫ÜÊîØÊåÅ Java ËØ≠Ë®ÄÁöÑËøêË°åÊó∂ÁªëÂÆöÔºà‰πüÁß∞‰∏∫Âä®ÊÄÅÁªëÂÆöÊàñÊôöÊúüÁªëÂÆöÔºâ„ÄÇÊ≥®ÊÑèÔºåËøôÈáåËØ¥ÁöÑÊòØÊåâÈÉ®Â∞±Áè≠Âú∞„ÄåÂºÄÂßã„ÄçÔºåËøô‰∫õÈò∂ÊÆµÈÄöÂ∏∏ÈÉΩÊòØ‰∫íÁõ∏‰∫§ÂèâÂú∞Ê∑∑ÂêàÂºèËøõË°åÁöÑÔºåÈÄöÂ∏∏‰ºöÂú®‰∏Ä‰∏™Èò∂ÊÆµÊâßË°åÁöÑËøáÁ®ã‰∏≠Ë∞ÉÁî®„ÄÅÊøÄÊ¥ªÂè¶Â§ñ‰∏Ä‰∏™Èò∂ÊÆµ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÂèØËÉΩÊúâ‰∫õÈò∂ÊÆµÊú™ÂÆåÊàêÔºå‰∏ã‰∏Ä‰∏™Èò∂ÊÆµÂ∞±ÂºÄÂßã‰∫Ü„ÄÇ ‰ªÄ‰πàÊÉÖÂÜµ‰∏ãÈúÄË¶Å‰ºöÂºÄÂßãÂä†ËΩΩ‰∏Ä‰∏™Á±ªÔºüJava ËôöÊãüÊú∫ËßÑËåÉ‰∏≠Âπ∂Ê≤°ÊúâËøõË°åÂº∫Âà∂Á∫¶Êùü„ÄÇ‰ΩÜÊòØÂØπ‰∫éÂàùÂßãÂåñÈò∂ÊÆµÔºåËôöÊãüÊú∫ËßÑËåÉ‰∏•Ê†ºËßÑÂÆö‰∫ÜÊúâ‰∏îÂè™Êúâ 5 ÁßçÊÉÖÂÜµÂøÖÈ°ªÁ´ãÂç≥ÂØπÁ±ªËøõË°å„ÄåÂàùÂßãÂåñ„ÄçÔºàËÄåÂä†ËΩΩ„ÄÅÈ™åËØÅ„ÄÅÂáÜÂ§áËá™ÁÑ∂ÈúÄË¶ÅÂú®Ê≠§‰πãÂâçÂºÄÂßãÔºâÔºö ÈÅáÂà∞ new„ÄÅgetstatic„ÄÅputstatic Êàñ invokestatic Ëøô 4 Êù°Â≠óËäÇÁ†ÅÊåá‰ª§Êó∂ÔºåÂ¶ÇÊûúÁ±ªÊ≤°ÊúâËøõË°åËøáÂàùÂßãÂåñÔºåÂàôÈúÄË¶ÅÂÖàËß¶ÂèëÂÖ∂ÂàùÂßãÂåñ„ÄÇ ÁîüÊàêËøô 4 Êù°Êåá‰ª§ÁöÑÊúÄÂ∏∏ËßÅÁöÑ Java ‰ª£Á†ÅÂú∫ÊôØÊòØÔºö ‰ΩøÁî® new ÂÖ≥ÈîÆÂ≠óÂÆû‰æãÂåñÂØπË±°ÁöÑÊó∂ÂÄô„ÄÅ ËØªÂèñÊàñËÆæÁΩÆ‰∏Ä‰∏™Á±ªÁöÑÈùôÊÄÅÂ≠óÊÆµÔºàË¢´ final ‰øÆÈ•∞„ÄÅÂ∑≤Âú®ÁºñËØëÊúüÊääÁªìÊûúÊîæÂÖ•Â∏∏ÈáèÊ±†ÁöÑÈùôÊÄÅÂ≠óÊÆµÈô§Â§ñÔºâÁöÑÊó∂ÂÄôÔºå ‰ª•ÂèäË∞ÉÁî®‰∏Ä‰∏™Á±ªÁöÑÈùôÊÄÅÊñπÊ≥ïÁöÑÊó∂ÂÄô„ÄÇ ‰ΩøÁî® java.lang.reflect ÂåÖÁöÑÊñπÊ≥ïÂØπÁ±ªËøõË°åÂèçÂ∞ÑË∞ÉÁî®ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÁ±ªÊ≤°ÊúâËøõË°åËøáÂàùÂßãÂåñÔºåÂàôÈúÄË¶ÅÂÖàËß¶ÂèëÂÖ∂ÂàùÂßãÂåñ„ÄÇ ÂΩìÂàùÂßãÂåñ‰∏Ä‰∏™Á±ªÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÂèëÁé∞ÂÖ∂Áà∂Á±ªËøòÊ≤°ÊúâËøõË°åËøáÂàùÂßãÂåñÔºåÂàôÈúÄË¶ÅÂÖàËß¶ÂèëÂÖ∂Áà∂Á±ªÁöÑÂàùÂßãÂåñ„ÄÇ ÂΩìËôöÊãüÊú∫ÂêØÂä®Êó∂ÔºåÁî®Êà∑ÈúÄË¶ÅÊåáÂÆö‰∏Ä‰∏™Ë¶ÅÊâßË°åÁöÑ‰∏ªÁ±ªÔºàÂåÖÂê´ main()ÊñπÊ≥ïÁöÑÈÇ£‰∏™Á±ªÔºâÔºåËôöÊãüÊú∫‰ºöÂÖàÂàùÂßãÂåñËøô‰∏™‰∏ªÁ±ª„ÄÇ ÂΩì‰ΩøÁî® JDK 1.7 ÁöÑÂä®ÊÄÅËØ≠Ë®ÄÊîØÊåÅÊó∂ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ java.lang.invoke.MethodHandle ÂÆû‰æãÊúÄÂêéÁöÑËß£ÊûêÁªìÊûú REF_getStatic„ÄÅREF_putStatic„ÄÅREF_invokeStatic ÁöÑÊñπÊ≥ïÂè•ÊüÑÔºåÂπ∂‰∏îËøô‰∏™ÊñπÊ≥ïÂè•ÊüÑÊâÄÂØπÂ∫îÁöÑÁ±ªÊ≤°ÊúâËøõË°åËøáÂàùÂßãÂåñÔºåÂàôÈúÄË¶ÅÂÖàËß¶ÂèëÂÖ∂ÂàùÂßãÂåñ„ÄÇ ‰∏ªÂä®ÂºïÁî®Ôºö‰ª•‰∏ä 5 ÁßçÂú∫ÊôØ‰∏≠ÁöÑË°å‰∏∫Áß∞‰∏∫ÂØπ‰∏Ä‰∏™Á±ªËøõË°å‰∏ªÂä®ÂºïÁî®„ÄÇ Ë¢´Âä®ÂºïÁî®ÔºöÈô§‰∫Ü‰ª•‰∏ä 5 ÁßçÂú∫ÊôØ‰∏≠ÁöÑË°å‰∏∫‰ª•Â§ñÁöÑÂØπ‰∏Ä‰∏™ËøõË°åÂºïÁî®ÁöÑË°å‰∏∫„ÄÇ ÂØπ‰∫éÈùôÊÄÅÂ≠óÊÆµÔºåÂè™ÊúâÁõ¥Êé•ÂÆö‰πâËøô‰∏™Â≠óÊÆµÁöÑÁ±ªÊâç‰ºöË¢´ÂàùÂßãÂåñÔºåÊâÄ‰ª•ÈÄöËøá‰∏Ä‰∏™Á±ªÁöÑÂ≠êÁ±ªÊù•ÂºïÁî®Áà∂Á±ª‰∏≠ÂÆö‰πâÁöÑÈùôÊÄÅÂèòÈáèÔºåÂè™‰ºöËß¶ÂèëÁà∂Á±ªÁöÑÂàùÂßãÂåñÔºåËÄå‰∏ç‰ºöËß¶ÂèëÂ≠êÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ ÈÄöËøáÊï∞ÁªÑÂÆö‰πâÊù•ÂºïÁî®Á±ªÔºå‰∏ç‰ºöËß¶ÂèëÊ≠§Á±ªÁöÑÂàùÂßãÂåñ„ÄÇ Â∏∏ÈáèÂÆö‰πâÂú®ÁºñËØëÈò∂ÊÆµ‰ºöÂ≠òÂÖ•Ë∞ÉÁî®Á±ªÁöÑÂ∏∏ÈáèÊ±†‰∏≠ÔºåÊú¨Ë¥®‰∏äÂπ∂Ê≤°ÊúâÁõ¥Êé•ÂºïÁî®Âà∞ÂÆö‰πâÂ∏∏ÈáèÁöÑÁ±ªÔºåÂõ†Ê≠§‰∏ç‰ºöËß¶ÂèëÂÆö‰πâÂ∏∏ÈáèÁöÑÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ Âú®ÁºñËØëÈò∂ÊÆµÈÄöËøáÂ∏∏Èáè‰º†Êí≠‰ºòÂåñÂÆûÁé∞ Êé•Âè£ÁöÑÂä†ËΩΩËøáÁ®ã‰∏éÁ±ªÂä†ËΩΩËøáÁ®ãÁ®çÊúâ‰∏Ä‰∫õ‰∏çÂêåÔºåÊé•Âè£‰πüÊúâÂàùÂßãÂåñËøáÁ®ãÔºåËøôÁÇπ‰∏éÁ±ªÊòØ‰∏ÄËá¥ÁöÑÔºåËôΩÁÑ∂Êé•Âè£‰∏≠‰∏çËÉΩ‰ΩøÁî® static{}ËØ≠Âè•ÂùóÔºå‰ΩÜÁºñËØëÂô®‰ªçÁÑ∂‰ºö‰∏∫Êé•Âè£ÁîüÊàê &lt;clinit&gt;()Á±ªÊûÑÈÄ†Âô®ÔºåÁî®‰∫éÂàùÂßãÂåñÊé•Âè£‰∏≠ÊâÄÂÆö‰πâÁöÑÊàêÂëòÂèòÈáè„ÄÇ Êé•Âè£‰∏éÁ±ªÁúüÊ≠£ÊúâÊâÄÂå∫Âà´ÁöÑÊòØÂâçÈù¢ËÆ≤Ëø∞ÁöÑ 5 Áßç„ÄåÊúâ‰∏î‰ªÖÊúâ„ÄçÈúÄË¶ÅÂºÄÂßãÂàùÂßãÂåñÂú∫ÊôØ‰∏≠ÁöÑÁ¨¨ 3 ÁßçÔºö ÂΩì‰∏Ä‰∏™Á±ªÂú®ÂàùÂßãÂåñÊó∂ÔºåË¶ÅÊ±ÇÂÖ∂Áà∂Á±ªÂÖ®ÈÉ®ÈÉΩÂ∑≤ÁªèÂàùÂßãÂåñËøá‰∫ÜÔºå‰ΩÜÊòØ‰∏Ä‰∏™Êé•Âè£Âú®ÂàùÂßãÂåñÊó∂ÔºåÂπ∂‰∏çË¶ÅÊ±ÇÂÖ∂Áà∂Êé•Âè£ÂÖ®ÈÉ®ÈÉΩÂÆåÊàê‰∫ÜÂàùÂßãÂåñÔºåÂè™ÊúâÂú®ÁúüÊ≠£‰ΩøÁî®Âà∞Áà∂Êé•Âè£ÁöÑÊó∂ÂÄôÔºàÂ¶ÇÂºïÁî®Êé•Âè£‰∏≠ÂÆö‰πâÁöÑÂ∏∏ÈáèÔºâÊâç‰ºöÂàùÂßãÂåñ„ÄÇ Á±ªÂä†ËΩΩÁöÑËøáÁ®ãÂä†ËΩΩ„ÄåÂä†ËΩΩ„ÄçÊòØ„ÄåÁ±ªÂä†ËΩΩ„ÄçÔºàClass LoadingÔºâËøáÁ®ãÁöÑ‰∏Ä‰∏™Èò∂ÊÆµ„ÄÇÂú®Âä†ËΩΩÈò∂ÊÆµÔºåËôöÊãüÊú∫ÈúÄË¶ÅÂÆåÊàê‰ª•‰∏ã 3 ‰ª∂‰∫ãÊÉÖÔºö ÈÄöËøá‰∏Ä‰∏™Á±ªÁöÑÂÖ®ÈôêÂÆöÂêçÊù•Ëé∑ÂèñÂÆö‰πâÊ≠§Á±ªÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅ„ÄÇ Â∞ÜËøô‰∏™Â≠óËäÇÊµÅÊâÄ‰ª£Ë°®ÁöÑÈùôÊÄÅÂ≠òÂÇ®ÁªìÊûÑËΩ¨Âåñ‰∏∫ÊñπÊ≥ïÂå∫ÁöÑËøêË°åÊó∂Êï∞ÊçÆÁªìÊûÑ„ÄÇ Âú®ÂÜÖÂ≠ò‰∏≠ÁîüÊàê‰∏Ä‰∏™‰ª£Ë°®Ëøô‰∏™Á±ªÁöÑ java.lang.Class ÂØπË±°Ôºå‰Ωú‰∏∫ÊñπÊ≥ïÂå∫Ëøô‰∏™Á±ªÁöÑÂêÑÁßçÊï∞ÊçÆÁöÑËÆøÈóÆÂÖ•Âè£„ÄÇ ËôöÊãüÊú∫ËßÑËåÉÁöÑËøô 3 ÁÇπË¶ÅÊ±ÇÂÖ∂ÂÆûÂπ∂‰∏çÁÆóÂÖ∑‰ΩìÔºåÂõ†Ê≠§ËôöÊãüÊú∫ÂÆûÁé∞‰∏éÂÖ∑‰ΩìÂ∫îÁî®ÁöÑÁÅµÊ¥ªÂ∫¶ÈÉΩÊòØÁõ∏ÂΩìÂ§ßÁöÑ„ÄÇ ‰∏Ä‰∏™ÈùûÊï∞ÁªÑÁ±ªÁöÑÂä†ËΩΩÈò∂ÊÆµÔºàÂáÜÁ°ÆÂú∞ËØ¥ÔºåÊòØÂä†ËΩΩÈò∂ÊÆµ‰∏≠Ëé∑ÂèñÁ±ªÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅÁöÑÂä®‰ΩúÔºâÊòØÂºÄÂèë‰∫∫ÂëòÂèØÊéßÊÄßÊúÄÂº∫ÁöÑÔºåÂõ†‰∏∫Âä†ËΩΩÈò∂ÊÆµÊó¢ÂèØ‰ª•‰ΩøÁî®Á≥ªÁªüÊèê‰æõÁöÑÂºïÂØºÁ±ªÂä†ËΩΩÂô®Êù•ÂÆåÊàêÔºå‰πüÂèØ‰ª•Áî±Áî®Êà∑Ëá™ÂÆö‰πâÁöÑÁ±ªÂä†ËΩΩÂô®ÂéªÂÆåÊàêÔºåÂºÄÂèë‰∫∫ÂëòÂèØ‰ª•ÈÄöËøáÂÆö‰πâËá™Â∑±ÁöÑÁ±ªÂä†ËΩΩÂô®ÂéªÊéßÂà∂Â≠óËäÇÊµÅÁöÑËé∑ÂèñÊñπÂºèÔºàÂç≥ÈáçÂÜô‰∏Ä‰∏™Á±ªÂä†ËΩΩÂô®ÁöÑ loadClass()ÊñπÊ≥ïÔºâ„ÄÇ ÂØπ‰∫éÊï∞ÁªÑÁ±ªËÄåË®ÄÔºåÊÉÖÂÜµÂ∞±ÊúâÊâÄ‰∏çÂêåÔºåÊï∞ÁªÑÁ±ªÊú¨Ë∫´‰∏çÈÄöËøáÁ±ªÂä†ËΩΩÂô®ÂàõÂª∫ÔºåÂÆÉÊòØ==Áî± Java ËôöÊãüÊú∫Áõ¥Êé•ÂàõÂª∫==ÁöÑ„ÄÇ ‰∏Ä‰∏™Êï∞ÁªÑÁ±ªÔºà‰∏ãÈù¢ÁÆÄÁß∞‰∏∫ CÔºâÂàõÂª∫ËøáÁ®ãÂ∞±ÈÅµÂæ™‰ª•‰∏ãËßÑÂàôÔºö Â¶ÇÊûúÊï∞ÁªÑÁöÑÁªÑ‰ª∂Á±ªÂûãÔºàComponent TypeÔºåÊåáÁöÑÊòØÊï∞ÁªÑÂéªÊéâ‰∏Ä‰∏™Áª¥Â∫¶ÁöÑÁ±ªÂûãÔºâÊòØÂºïÁî®Á±ªÂûãÔºåÈÇ£Â∞±ÈÄíÂΩíÈááÁî®Êú¨ËäÇ‰∏≠ÂÆö‰πâÁöÑÂä†ËΩΩËøáÁ®ãÂéªÂä†ËΩΩËøô‰∏™ÁªÑ‰ª∂Á±ªÂûãÔºåÊï∞ÁªÑ C Â∞ÜÂú®Âä†ËΩΩËØ•ÁªÑ‰ª∂Á±ªÂûãÁöÑÁ±ªÂä†ËΩΩÂô®ÁöÑÁ±ªÂêçÁß∞Á©∫Èó¥‰∏äË¢´Ê†áËØÜÔºà‰∏Ä‰∏™Á±ªÂøÖÈ°ª‰∏éÁ±ªÂä†ËΩΩÂô®‰∏ÄËµ∑Á°ÆÂÆöÂîØ‰∏ÄÊÄßÔºâ„ÄÇ Â¶ÇÊûúÊï∞ÁªÑÁöÑÁªÑ‰ª∂Á±ªÂûã‰∏çÊòØÂºïÁî®Á±ªÂûãÔºà‰æãÂ¶Ç int[] Êï∞ÁªÑÔºâÔºåJava ËôöÊãüÊú∫Â∞Ü‰ºöÊääÊï∞ÁªÑ C Ê†áËÆ∞‰∏∫‰∏éÂºïÂØºÁ±ªÂä†ËΩΩÂô®ÂÖ≥ËÅî„ÄÇÊï∞ÁªÑÁ±ªÁöÑÂèØËßÅÊÄß‰∏éÂÆÉÁöÑÁªÑ‰ª∂Á±ªÂûãÁöÑÂèØËßÅÊÄß‰∏ÄËá¥Ôºå Â¶ÇÊûúÁªÑ‰ª∂Á±ªÂûã‰∏çÊòØÂºïÁî®Á±ªÂûãÔºåÈÇ£Êï∞ÁªÑÁ±ªÁöÑÂèØËßÅÊÄßÂ∞ÜÈªòËÆ§‰∏∫ public„ÄÇ Âä†ËΩΩÈò∂ÊÆµÂÆåÊàêÂêéÔºåËôöÊãüÊú∫Â§ñÈÉ®ÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅÂ∞±ÊåâÁÖßËôöÊãüÊú∫ÊâÄÈúÄÁöÑÊ†ºÂºèÂ≠òÂÇ®Âú®ÊñπÊ≥ïÂå∫‰πã‰∏≠ÔºåÊñπÊ≥ïÂå∫‰∏≠ÁöÑÊï∞ÊçÆÂ≠òÂÇ®Ê†ºÂºèÁî±ËôöÊãüÊú∫ÂÆûÁé∞Ëá™Ë°åÂÆö‰πâÔºåËôöÊãüÊú∫ËßÑËåÉÊú™ËßÑÂÆöÊ≠§Âå∫ÂüüÁöÑÂÖ∑‰ΩìÊï∞ÊçÆÁªìÊûÑ„ÄÇÁÑ∂ÂêéÂú®ÂÜÖÂ≠ò‰∏≠ÂÆû‰æãÂåñ‰∏Ä‰∏™ java.lang.Class Á±ªÁöÑÂØπË±°ÔºàÂπ∂Ê≤°ÊúâÊòéÁ°ÆËßÑÂÆöÊòØÂú® Java Â†Ü‰∏≠ÔºåÂØπ‰∫é HotSpot ËôöÊãüÊú∫ËÄåË®ÄÔºåClass ÂØπË±°ÊØîËæÉÁâπÊÆäÔºåÂÆÉËôΩÁÑ∂ÊòØÂØπË±°Ôºå‰ΩÜÊòØÂ≠òÊîæÂú®ÊñπÊ≥ïÂå∫ÈáåÈù¢ÔºâÔºåËøô‰∏™ÂØπË±°Â∞Ü‰Ωú‰∏∫Á®ãÂ∫èËÆøÈóÆÊñπÊ≥ïÂå∫‰∏≠ÁöÑËøô‰∫õÁ±ªÂûãÊï∞ÊçÆÁöÑÂ§ñÈÉ®Êé•Âè£„ÄÇ Âä†ËΩΩÈò∂ÊÆµ‰∏éËøûÊé•Èò∂ÊÆµÁöÑÈÉ®ÂàÜÂÜÖÂÆπÔºàÂ¶Ç‰∏ÄÈÉ®ÂàÜÂ≠óËäÇÁ†ÅÊñá‰ª∂Ê†ºÂºèÈ™åËØÅÂä®‰ΩúÔºâÊòØ‰∫§ÂèâËøõË°åÁöÑÔºåÂä†ËΩΩÈò∂ÊÆµÂ∞öÊú™ÂÆåÊàêÔºåËøûÊé•Èò∂ÊÆµÂèØËÉΩÂ∑≤ÁªèÂºÄÂßãÔºå‰ΩÜËøô‰∫õÂ§πÂú®Âä†ËΩΩÈò∂ÊÆµ‰πã‰∏≠ËøõË°åÁöÑÂä®‰ΩúÔºå‰ªçÁÑ∂Â±û‰∫éËøûÊé•Èò∂ÊÆµÁöÑÂÜÖÂÆπÔºåËøô‰∏§‰∏™Èò∂ÊÆµÁöÑÂºÄÂßãÊó∂Èó¥‰ªçÁÑ∂‰øùÊåÅÁùÄÂõ∫ÂÆöÁöÑÂÖàÂêéÈ°∫Â∫è„ÄÇ È™åËØÅ‰∏∫‰ªÄ‰πàÈúÄË¶ÅÈ™åËØÅÔºü ËôΩÁÑ∂Âú®ÁºñËØëÊó∂ÔºåÁºñËØëÂô®‰πü‰ºöÂØπ java Ê∫êÁ†Å‰ºöÂØπ‰ª£Á†ÅËøõË°åÊ£ÄÊü•„ÄÇ‰ΩÜÊòØ .class Êñá‰ª∂Âπ∂‰∏ÄÂÆö‰∏çË¶ÅÊ±ÇÁî® java Ê∫êÁ†ÅÁºñËØëÊù•ÁöÑÔºåÂÆÉÂèØ‰ª•‰ΩøÁî®‰ªª‰ΩïÈÄîÂæÑÁîüÊàêÔºåÁîöËá≥ÂèØ‰ª•Áî®ÂçÅÂÖ≠ËøõÂà∂ÁºñËæëÂô®Áõ¥Êé•ÁºñÂÜô class Êñá‰ª∂„ÄÇËôöÊãüÊú∫Â¶ÇÊûú‰∏çÊ£ÄÊü•ËæìÂÖ•ÁöÑÂ≠óËäÇÊµÅÔºåÂØπÂÖ∂ÂÆåÂÖ®‰ø°‰ªªÁöÑËØùÔºåÂæàÂèØËÉΩ‰ºöÂõ†‰∏∫ËΩΩÂÖ•‰∫ÜÊúâÂÆ≥ÁöÑÂ≠óËäÇÊµÅËÄåÂØºËá¥Á≥ªÁªüÂ¥©Ê∫É„ÄÇÊâÄ‰ª•È™åËØÅÊòØËôöÊãüÊú∫ÂØπËá™Ë∫´‰øùÊä§ÁöÑ‰∏ÄÈ°πÈáçË¶ÅÂ∑•‰Ωú„ÄÇ È™åËØÅ‰ªÄ‰πàÔºü Êñá‰ª∂Ê†ºÂºèÈ™åËØÅ ÂÖÉÊï∞ÊçÆÈ™åËØÅ Â≠óËäÇÁ†ÅÈ™åËØÅ Á¨¶Âè∑ÂºïÁî®È™åËØÅ Êñá‰ª∂Ê†ºÂºèÈ™åËØÅ ÊòØÂê¶‰ª•È≠îÊï∞ 0xCAFEBABE ÂºÄÂ§¥„ÄÇ ‰∏ª„ÄÅÊ¨°ÁâàÊú¨Âè∑ÊòØÂê¶Âú®ÂΩìÂâçËôöÊãüÊú∫Â§ÑÁêÜËåÉÂõ¥‰πãÂÜÖ„ÄÇ Â∏∏ÈáèÊ±†ÁöÑÂ∏∏Èáè‰∏≠ÊòØÂê¶Êúâ‰∏çË¢´ÊîØÊåÅÁöÑÂ∏∏ÈáèÁ±ªÂûãÔºàÊ£ÄÊü•Â∏∏Èáè tag Ê†áÂøóÔºâ„ÄÇ ÊåáÂêëÂ∏∏ÈáèÁöÑÂêÑÁßçÁ¥¢ÂºïÂÄº‰∏≠ÊòØÂê¶ÊúâÊåáÂêë‰∏çÂ≠òÂú®ÁöÑÂ∏∏ÈáèÊàñ‰∏çÁ¨¶ÂêàÁ±ªÂûãÁöÑÂ∏∏Èáè„ÄÇ ‚Ä¶‚Ä¶ ËØ•È™åËØÅÈò∂ÊÆµÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰øùËØÅËæìÂÖ•ÁöÑÂ≠óËäÇÊµÅËÉΩÊ≠£Á°ÆÂú∞Ëß£ÊûêÂπ∂Â≠òÂÇ®‰∫éÊñπÊ≥ïÂå∫‰πãÂÜÖÔºåÊ†ºÂºè‰∏äÁ¨¶ÂêàÊèèËø∞‰∏Ä‰∏™ Java Á±ªÂûã‰ø°ÊÅØÁöÑË¶ÅÊ±Ç„ÄÇËøôÈò∂ÊÆµÁöÑÈ™åËØÅÊòØÂü∫‰∫é‰∫åËøõÂà∂Â≠óËäÇÊµÅËøõË°åÁöÑÔºåÂè™ÊúâÈÄöËøá‰∫ÜËøô‰∏™Èò∂ÊÆµÁöÑÈ™åËØÅÂêéÔºåÂ≠óËäÇÊµÅÊâç‰ºöËøõÂÖ•ÂÜÖÂ≠òÁöÑÊñπÊ≥ïÂå∫‰∏≠ËøõË°åÂ≠òÂÇ®ÔºåÂêéÈù¢ÁöÑ 3 ‰∏™È™åËØÅÈò∂ÊÆµÂÖ®ÈÉ®ÊòØÂü∫‰∫éÊñπÊ≥ïÂå∫ÁöÑÂ≠òÂÇ®ÁªìÊûÑËøõË°åÁöÑÔºå‰∏ç‰ºöÂÜçÁõ¥Êé•Êìç‰ΩúÂ≠óËäÇÊµÅ„ÄÇ ÂÖÉÊï∞ÊçÆÈ™åËØÅÁ¨¨‰∫åÈò∂ÊÆµÊòØÂØπÂ≠óËäÇÁ†ÅÊèèËø∞ÁöÑ‰ø°ÊÅØËøõË°åËØ≠‰πâÂàÜÊûêÔºå‰ª•‰øùËØÅÂÖ∂ÊèèËø∞ÁöÑ‰ø°ÊÅØÁ¨¶Âêà Java ËØ≠Ë®ÄËßÑËåÉÁöÑË¶ÅÊ±Ç Ëøô‰∏™Á±ªÊòØÂê¶ÊúâÁà∂Á±ªÔºàÈô§‰∫Ü java.lang.Object ‰πãÂ§ñÔºåÊâÄÊúâÁöÑÁ±ªÈÉΩÂ∫îÂΩìÊúâÁà∂Á±ªÔºâ„ÄÇ Ëøô‰∏™Á±ªÁöÑÁà∂Á±ªÊòØÂê¶ÁªßÊâø‰∫Ü‰∏çÂÖÅËÆ∏Ë¢´ÁªßÊâøÁöÑÁ±ªÔºàË¢´ final ‰øÆÈ•∞ÁöÑÁ±ªÔºâ„ÄÇ Â¶ÇÊûúËøô‰∏™Á±ª‰∏çÊòØÊäΩË±°Á±ªÔºåÊòØÂê¶ÂÆûÁé∞‰∫ÜÂÖ∂Áà∂Á±ªÊàñÊé•Âè£‰πã‰∏≠Ë¶ÅÊ±ÇÂÆûÁé∞ÁöÑÊâÄÊúâÊñπÊ≥ï„ÄÇÂç≥ÔºåÈùûÊäΩË±°Á±ªÊòØÂê¶ÂÆûÁé∞‰∫ÜÊâÄÊúâÂ∫îËØ•ÂÆûÁé∞ÁöÑÊñπÊ≥ïÔºü Á±ª‰∏≠ÁöÑÂ≠óÊÆµ„ÄÅÊñπÊ≥ïÊòØÂê¶‰∏éÁà∂Á±ª‰∫ßÁîüÁüõÁõæÔºà‰æãÂ¶ÇË¶ÜÁõñ‰∫ÜÁà∂Á±ªÁöÑ final Â≠óÊÆµÔºåÊàñËÄÖÂá∫Áé∞‰∏çÁ¨¶ÂêàËßÑÂàôÁöÑÊñπÊ≥ïÈáçËΩΩÔºå‰æãÂ¶ÇÊñπÊ≥ïÂèÇÊï∞ÈÉΩ‰∏ÄËá¥Ôºå‰ΩÜËøîÂõûÂÄºÁ±ªÂûãÂç¥‰∏çÂêåÁ≠âÔºâ„ÄÇ ÁªßÊâøÂÖ≥Á≥ªÔºåÊñπÊ≥ïË¶ÜÁõñ Â≠óËäÇÁ†ÅÈ™åËØÅÁ¨¨‰∏âÈò∂ÊÆµÊòØÊï¥‰∏™È™åËØÅËøáÁ®ã‰∏≠ÊúÄÂ§çÊùÇÁöÑ‰∏Ä‰∏™Èò∂ÊÆµÔºå‰∏ªË¶ÅÁõÆÁöÑÊòØÈÄöËøáÊï∞ÊçÆÊµÅÂíåÊéßÂà∂ÊµÅÂàÜÊûêÔºåÁ°ÆÂÆöÁ®ãÂ∫èËØ≠‰πâÊòØÂêàÊ≥ïÁöÑ„ÄÅÁ¨¶ÂêàÈÄªËæëÁöÑ„ÄÇËøô‰∏™Èò∂ÊÆµÂ∞ÜÂØπÁ±ªÁöÑÊñπÊ≥ï‰ΩìËøõË°åÊ†°È™åÂàÜÊûêÔºå‰øùËØÅË¢´Ê†°È™åÁ±ªÁöÑÊñπÊ≥ïÂú®ËøêË°åÊó∂‰∏ç‰ºöÂÅöÂá∫Âç±ÂÆ≥ËôöÊãüÊú∫ÂÆâÂÖ®ÁöÑ‰∫ã‰ª∂„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™Á±ªÊñπÊ≥ï‰ΩìÁöÑÂ≠óËäÇÁ†ÅÊ≤°ÊúâÈÄöËøáÂ≠óËäÇÁ†ÅÈ™åËØÅÔºåÈÇ£ËÇØÂÆöÊòØÊúâÈóÆÈ¢òÁöÑÔºõ ‰ΩÜÂ¶ÇÊûú‰∏Ä‰∏™ÊñπÊ≥ï‰ΩìÈÄöËøá‰∫ÜÂ≠óËäÇÁ†ÅÈ™åËØÅÔºå‰πü‰∏çËÉΩËØ¥ÊòéÂÖ∂‰∏ÄÂÆöÂ∞±ÊòØÂÆâÂÖ®ÁöÑ„ÄÇ Á¶ªÊï£Êï∞Â≠¶‰∏≠‰∏Ä‰∏™ÂæàËëóÂêçÁöÑÈóÆÈ¢ò„ÄåHalting Problem„ÄçÔºàÂÅúÊú∫ÈóÆÈ¢òÔºâ ÔºöÈÄöËøáÁ®ãÂ∫èÂéªÊ†°È™åÁ®ãÂ∫èÈÄªËæëÊòØÊó†Ê≥ïÂÅöÂà∞ÁªùÂØπÂáÜÁ°ÆÁöÑ‚Äî‚Äî‰∏çËÉΩÈÄöËøáÁ®ãÂ∫èÂáÜÁ°ÆÂú∞Ê£ÄÊü•Âá∫Á®ãÂ∫èÊòØÂê¶ËÉΩÂú®ÊúâÈôêÁöÑÊó∂Èó¥‰πãÂÜÖÁªìÊùüËøêË°å„ÄÇ Á¨¶Âè∑ÂºïÁî®È™åËØÅÂèëÁîüÂú®ËôöÊãüÊú∫Â∞ÜÁ¨¶Âè∑ÂºïÁî®ËΩ¨Âåñ‰∏∫Áõ¥Êé•ÂºïÁî®ÁöÑÊó∂ÂÄôÔºåËøô‰∏™ËΩ¨ÂåñÂä®‰ΩúÂ∞ÜÂú®ËøûÊé•ÁöÑÁ¨¨‰∏âÈò∂ÊÆµ‚Äî‚ÄîËß£ÊûêÈò∂ÊÆµ‰∏≠ÂèëÁîü„ÄÇ Á¨¶Âè∑ÂºïÁî®È™åËØÅÂèØ‰ª•ÁúãÂÅöÊòØÂØπÁ±ªËá™Ë∫´‰ª•Â§ñÔºàÂ∏∏ÈáèÊ±†‰∏≠ÁöÑÂêÑÁßçÁ¨¶Âè∑ÂºïÁî®ÔºâÁöÑ‰ø°ÊÅØËøõË°åÂåπÈÖçÊÄßÊ†°È™åÔºåÈÄöÂ∏∏ÈúÄË¶ÅÊ†°È™å‰∏ãÂàóÂÜÖÂÆπÔºö Á¨¶Âè∑ÂºïÁî®‰∏≠ÈÄöËøáÂ≠óÁ¨¶‰∏≤ÊèèËø∞ÁöÑÂÖ®ÈôêÂÆöÂêçÊòØÂê¶ËÉΩÊâæÂà∞ÂØπÂ∫îÁöÑÁ±ª„ÄÇ Âú®ÊåáÂÆöÁ±ª‰∏≠ÊòØÂê¶Â≠òÂú®Á¨¶ÂêàÊñπÊ≥ïÁöÑÂ≠óÊÆµÊèèËø∞Á¨¶‰ª•ÂèäÁÆÄÂçïÂêçÁß∞ÊâÄÊèèËø∞ÁöÑ*ÊñπÊ≥ïÂíåÂ≠óÊÆµ„ÄÇ Á¨¶Âè∑ÂºïÁî®‰∏≠ÁöÑÁ±ª„ÄÅÂ≠óÊÆµ„ÄÅÊñπÊ≥ïÁöÑËÆøÈóÆÊÄßÔºàprivate„ÄÅprotected„ÄÅpublic„ÄÅdefaultÔºâÊòØÂê¶ÂèØË¢´ÂΩìÂâçÁ±ªËÆøÈóÆ„ÄÇ ÂáÜÂ§áÂáÜÂ§áÈò∂ÊÆµÊòØÊ≠£Âºè‰∏∫Á±ªÂèòÈáèÂàÜÈÖçÂÜÖÂ≠òÂπ∂ËÆæÁΩÆ==Á±ªÂèòÈáè==ÂàùÂßãÂÄºÁöÑÈò∂ÊÆµÔºåËøô‰∫õÂèòÈáèÊâÄ‰ΩøÁî®ÁöÑÂÜÖÂ≠òÈÉΩÂ∞ÜÂú®ÊñπÊ≥ïÂå∫‰∏≠ËøõË°åÂàÜÈÖç„ÄÇ È¶ñÂÖàÔºåËøôÊó∂ÂÄôËøõË°åÂÜÖÂ≠òÂàÜÈÖçÁöÑ‰ªÖÂåÖÊã¨Á±ªÂèòÈáèÔºàË¢´ static ‰øÆÈ•∞ÁöÑÂèòÈáèÔºâÔºåËÄå‰∏çÂåÖÊã¨ÂÆû‰æãÂèòÈáèÔºåÂÆû‰æãÂèòÈáèÂ∞Ü‰ºöÂú®ÂØπË±°ÂÆû‰æãÂåñÊó∂ÈöèÁùÄÂØπË±°‰∏ÄËµ∑ÂàÜÈÖçÂú® Java Â†Ü‰∏≠„ÄÇ ÂÖ∂Ê¨°ÔºåËøôÈáåÊâÄËØ¥ÁöÑÂàùÂßãÂÄº„ÄåÈÄöÂ∏∏ÊÉÖÂÜµ„Äç‰∏ãÊòØÊï∞ÊçÆÁ±ªÂûãÁöÑÈõ∂ÂÄº ËøôÊó∂ÂÄôÂ∞öÊú™ÂºÄÂßãÊâßË°å‰ªª‰Ωï Java ÊñπÊ≥ï„ÄÇ „Äå==ÁâπÊÆäÊÉÖÂÜµ==„ÄçÔºöÂ¶ÇÊûúÁ±ªÂ≠óÊÆµÁöÑÂ≠óÊÆµÂ±ûÊÄßË°®‰∏≠Â≠òÂú® ConstantValue Â±ûÊÄßÔºåÈÇ£Âú®ÂáÜÂ§áÈò∂ÊÆµÂèòÈáè value Â∞±‰ºöË¢´ÂàùÂßãÂåñ‰∏∫ ConstantValue Â±ûÊÄßÊâÄÊåáÂÆöÁöÑÂÄº„ÄÇ ÂÅáËÆæ‰∏äÈù¢Á±ªÂèòÈáè value ÁöÑÂÆö‰πâÂèò‰∏∫Ôºöpublic static final int value=123Ôºõ ÈÇ£‰πàÂú®ÂáÜÂ§áÈò∂ÊÆµËôöÊãüÊú∫Â∞±‰ºöÊ†πÊçÆ ConstantValue ÁöÑËÆæÁΩÆÂ∞Ü value ËµãÂÄº‰∏∫ 123„ÄÇ Ëß£ÊûêËß£ÊûêÈò∂ÊÆµÊòØËôöÊãüÊú∫Â∞ÜÂ∏∏ÈáèÊ±†ÂÜÖÁöÑÁ¨¶Âè∑ÂºïÁî®ÊõøÊç¢‰∏∫Áõ¥Êé•ÂºïÁî®ÁöÑËøáÁ®ãÔºåÂú® Class Êñá‰ª∂‰∏≠ Á¨¶Âè∑ÂºïÁî® ‰ª• CONSTANT_Class_info„ÄÅCONSTANT_Fieldref_info„ÄÅCONSTANT_Methodref_info Á≠âÁ±ªÂûãÁöÑÂ∏∏ÈáèÂá∫Áé∞ Á¨¶Âè∑ÂºïÁî®ÔºàSymbolic ReferencesÔºâÔºöÁ¨¶Âè∑ÂºïÁî®‰ª•‰∏ÄÁªÑÁ¨¶Âè∑Êù•ÊèèËø∞ÊâÄÂºïÁî®ÁöÑÁõÆÊ†áÔºåÁ¨¶Âè∑ÂèØ‰ª•ÊòØ‰ªª‰ΩïÂΩ¢ÂºèÁöÑÂ≠óÈù¢ÈáèÔºåÂè™Ë¶Å‰ΩøÁî®Êó∂ËÉΩÊó†Ê≠ß‰πâÂú∞ÂÆö‰ΩçÂà∞ÁõÆÊ†áÂç≥ÂèØ„ÄÇÂêÑÁßçËôöÊãüÊú∫ÂÆûÁé∞ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÂèØ‰ª•ÂêÑ‰∏çÁõ∏ÂêåÔºå‰ΩÜÊòØÂÆÉ‰ª¨ËÉΩÊé•ÂèóÁöÑÁ¨¶Âè∑ÂºïÁî®ÂøÖÈ°ªÈÉΩÊòØ‰∏ÄËá¥ÁöÑÔºåÂõ†‰∏∫Á¨¶Âè∑ÂºïÁî®ÁöÑÂ≠óÈù¢ÈáèÂΩ¢ÂºèÊòéÁ°ÆÂÆö‰πâÂú® Java ËôöÊãüÊú∫ËßÑËåÉÁöÑ Class Êñá‰ª∂Ê†ºÂºè‰∏≠„ÄÇ Áõ¥Êé•ÂºïÁî®ÔºàDirect ReferencesÔºâÔºöÁõ¥Êé•ÂºïÁî®ÂèØ‰ª•ÊòØÁõ¥Êé•ÊåáÂêëÁõÆÊ†áÁöÑÊåáÈíà„ÄÅÁõ∏ÂØπÂÅèÁßªÈáèÊàñÊòØ‰∏Ä‰∏™ËÉΩÈó¥Êé•ÂÆö‰ΩçÂà∞ÁõÆÊ†áÁöÑÂè•ÊüÑ„ÄÇ Áõ¥Êé•ÂºïÁî®ÊòØÂíåËôöÊãüÊú∫ÂÆûÁé∞ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÁõ∏ÂÖ≥ÁöÑÔºåÂêå‰∏Ä‰∏™Á¨¶Âè∑ÂºïÁî®Âú®‰∏çÂêåËôöÊãüÊú∫ÂÆû‰æã‰∏äÁøªËØëÂá∫Êù•ÁöÑÁõ¥Êé•ÂºïÁî®‰∏ÄËà¨‰∏ç‰ºöÁõ∏Âêå„ÄÇ Â¶ÇÊûúÊúâ‰∫ÜÁõ¥Êé•ÂºïÁî®ÔºåÈÇ£ÂºïÁî®ÁöÑÁõÆÊ†áÂøÖÂÆöÂ∑≤ÁªèÂú®ÂÜÖÂ≠ò‰∏≠Â≠òÂú®„ÄÇ ËôöÊãüÊú∫ÂÆûÁé∞ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÊù•Âà§Êñ≠Âà∞Â∫ïÊòØÂú®Á±ªË¢´Âä†ËΩΩÂô®Âä†ËΩΩÊó∂Â∞±ÂØπÂ∏∏ÈáèÊ±†‰∏≠ÁöÑÁ¨¶Âè∑ÂºïÁî®ËøõË°åËß£ÊûêÔºåËøòÊòØÁ≠âÂà∞‰∏Ä‰∏™Á¨¶Âè∑ÂºïÁî®Â∞ÜË¶ÅË¢´‰ΩøÁî®ÂâçÊâçÂéªËß£ÊûêÂÆÉ„ÄÇ invokedynamic Êåá‰ª§ÁöÑÁõÆÁöÑÊú¨Êù•Â∞±ÊòØÁî®‰∫éÂä®ÊÄÅËØ≠Ë®ÄÊîØÊåÅÔºàÁõÆÂâç‰ªÖ‰ΩøÁî® Java ËØ≠Ë®Ä‰∏ç‰ºöÁîüÊàêËøôÊù°Â≠óËäÇÁ†ÅÊåá‰ª§ÔºâÔºåÂÆÉÊâÄÂØπÂ∫îÁöÑÂºïÁî®Áß∞‰∏∫„ÄåÂä®ÊÄÅË∞ÉÁî®ÁÇπÈôêÂÆöÁ¨¶„ÄçÔºàDynamic Call Site SpecifierÔºâÔºåËøôÈáå„ÄåÂä®ÊÄÅ„ÄçÁöÑÂê´‰πâÂ∞±ÊòØÂøÖÈ°ªÁ≠âÂà∞Á®ãÂ∫èÂÆûÈôÖËøêË°åÂà∞ËøôÊù°Êåá‰ª§ÁöÑÊó∂ÂÄôÔºåËß£ÊûêÂä®‰ΩúÊâçËÉΩËøõË°å„ÄÇ Áõ∏ÂØπÁöÑÔºåÂÖ∂‰ΩôÂèØËß¶ÂèëËß£ÊûêÁöÑÊåá‰ª§ÈÉΩÊòØ„ÄåÈùôÊÄÅ„ÄçÁöÑÔºåÂèØ‰ª•Âú®ÂàöÂàöÂÆåÊàêÂä†ËΩΩÈò∂ÊÆµÔºåËøòÊ≤°ÊúâÂºÄÂßãÊâßË°å‰ª£Á†ÅÊó∂Â∞±ËøõË°åËß£Êûê„ÄÇ 1. Á±ªÊàñÊé•Âè£ÁöÑËß£ÊûêÂÅáËÆæÂΩìÂâç‰ª£Á†ÅÊâÄÂ§ÑÁöÑÁ±ª‰∏∫ DÔºåÂ¶ÇÊûúË¶ÅÊää‰∏Ä‰∏™‰ªéÊú™Ëß£ÊûêËøáÁöÑÁ¨¶Âè∑ÂºïÁî® N Ëß£Êûê‰∏∫‰∏Ä‰∏™Á±ªÊàñÊé•Âè£ C ÁöÑÁõ¥Êé•ÂºïÁî®ÔºåÈÇ£ËôöÊãüÊú∫ÂÆåÊàêÊï¥‰∏™Ëß£ÊûêÁöÑËøáÁ®ãÈúÄË¶Å‰ª•‰∏ã 3 ‰∏™Ê≠•È™§Ôºö Â¶ÇÊûú C ‰∏çÊòØ‰∏Ä‰∏™Êï∞ÁªÑÁ±ªÂûãÔºåÈÇ£ËôöÊãüÊú∫Â∞Ü‰ºöÊää‰ª£Ë°® N ÁöÑÂÖ®ÈôêÂÆöÂêç‰º†ÈÄíÁªô D ÁöÑÁ±ªÂä†ËΩΩÂô®ÂéªÂä†ËΩΩËøô‰∏™Á±ª C„ÄÇÂú®Âä†ËΩΩËøáÁ®ã‰∏≠ÔºåÁî±‰∫éÂÖÉÊï∞ÊçÆÈ™åËØÅ„ÄÅÂ≠óËäÇÁ†ÅÈ™åËØÅÁöÑÈúÄË¶ÅÔºåÂèàÂèØËÉΩËß¶ÂèëÂÖ∂‰ªñÁõ∏ÂÖ≥Á±ªÁöÑÂä†ËΩΩÂä®‰ΩúÔºå‰æãÂ¶ÇÂä†ËΩΩËøô‰∏™Á±ªÁöÑÁà∂Á±ªÊàñÂÆûÁé∞ÁöÑÊé•Âè£„ÄÇ‰∏ÄÊó¶Ëøô‰∏™Âä†ËΩΩËøáÁ®ãÂá∫Áé∞‰∫Ü‰ªª‰ΩïÂºÇÂ∏∏ÔºåËß£ÊûêËøáÁ®ãÂ∞±ÂÆ£ÂëäÂ§±Ë¥•„ÄÇ Â¶ÇÊûú C ÊòØ‰∏Ä‰∏™Êï∞ÁªÑÁ±ªÂûãÔºåÂπ∂‰∏îÊï∞ÁªÑÁöÑÂÖÉÁ¥†Á±ªÂûã‰∏∫ÂØπË±°Ôºå‰πüÂ∞±ÊòØ N ÁöÑÊèèËø∞Á¨¶‰ºöÊòØÁ±ª‰ºº„Äå[Ljava/lang/Integer„ÄçÁöÑÂΩ¢ÂºèÔºåÈÇ£Â∞Ü‰ºöÊåâÁÖßÁ¨¨ 1 ÁÇπÁöÑËßÑÂàôÂä†ËΩΩÊï∞ÁªÑÂÖÉÁ¥†Á±ªÂûã„ÄÇÂ¶ÇÊûú N ÁöÑÊèèËø∞Á¨¶Â¶ÇÂâçÈù¢ÊâÄÂÅáËÆæÁöÑÂΩ¢ÂºèÔºåÈúÄË¶ÅÂä†ËΩΩÁöÑÂÖÉÁ¥†Á±ªÂûãÂ∞±ÊòØ„Äåjava.lang.Integer„ÄçÔºåÊé•ÁùÄÁî±ËôöÊãüÊú∫ÁîüÊàê‰∏Ä‰∏™‰ª£Ë°®Ê≠§Êï∞ÁªÑÁª¥Â∫¶ÂíåÂÖÉÁ¥†ÁöÑÊï∞ÁªÑÂØπË±°„ÄÇ Â¶ÇÊûú‰∏äÈù¢ÁöÑÊ≠•È™§Ê≤°ÊúâÂá∫Áé∞‰ªª‰ΩïÂºÇÂ∏∏ÔºåÈÇ£‰πà C Âú®ËôöÊãüÊú∫‰∏≠ÂÆûÈôÖ‰∏äÂ∑≤ÁªèÊàê‰∏∫‰∏Ä‰∏™ÊúâÊïàÁöÑÁ±ªÊàñÊé•Âè£‰∫ÜÔºå‰ΩÜÂú®Ëß£ÊûêÂÆåÊàê‰πãÂâçËøòË¶ÅËøõË°åÁ¨¶Âè∑ÂºïÁî®È™åËØÅÔºåÊ£ÄÊü•ËÆøÈóÆÊùÉÈôê„ÄÇÂ¶ÇÊûúÂèëÁé∞‰∏çÂÖ∑Â§áËÆøÈóÆÊùÉÈôêÔºåÂ∞ÜÊäõÂá∫ java.lang.IllegalAccessError ÂºÇÂ∏∏„ÄÇ Â≠óÊÆµËß£ÊûêÁ±ªÊñπÊ≥ïËß£ÊûêÊé•Âè£ÊñπÊ≥ïËß£ÊûêÊé•Âè£ÁöÑÊñπÊ≥ï„ÄÅÂ∏∏ÈáèÈÉΩÊòØ public ÁöÑÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅËøõË°åÊùÉÈôêÈ™åËØÅ ÂàùÂßãÂåñÁ±ªÂàùÂßãÂåñÈò∂ÊÆµÊòØÁ±ªÂä†ËΩΩËøáÁ®ãÁöÑÊúÄÂêé‰∏ÄÊ≠•ÔºåÂâçÈù¢ÁöÑÁ±ªÂä†ËΩΩËøáÁ®ã‰∏≠ÔºåÈô§‰∫ÜÂú®Âä†ËΩΩÈò∂ÊÆµÁî®Êà∑Â∫îÁî®Á®ãÂ∫èÂèØ‰ª•ÈÄöËøáËá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®ÂèÇ‰∏é‰πãÂ§ñÔºåÂÖ∂‰ΩôÂä®‰ΩúÂÆåÂÖ®Áî±ËôöÊãüÊú∫‰∏ªÂØºÂíåÊéßÂà∂„ÄÇÂà∞‰∫ÜÂàùÂßãÂåñÈò∂ÊÆµÔºåÊâçÁúüÊ≠£ÂºÄÂßãÊâßË°åÁ±ª‰∏≠ÂÆö‰πâÁöÑ Java Á®ãÂ∫è‰ª£Á†ÅÔºàÊàñËÄÖËØ¥ÊòØÂ≠óËäÇÁ†ÅÔºâ„ÄÇ Âú®ÂáÜÂ§áÈò∂ÊÆµÔºåÂèòÈáèÂ∑≤ÁªèËµãËøá‰∏ÄÊ¨°Á≥ªÁªüË¶ÅÊ±ÇÁöÑÂàùÂßãÂÄº Âú®ÂàùÂßãÂåñÈò∂ÊÆµÔºåÊ†πÊçÆÈ°πÁõÆÈúÄË¶ÅÂØπÁ±ªÂèòÈáèËøõË°åÁõ∏Â∫îÁöÑÂàùÂßãÂåñÔºåÊàñËÄÖÂèØ‰ª•‰ªéÂè¶Â§ñ‰∏Ä‰∏™ËßíÂ∫¶Êù•Ë°®ËææÔºöÂàùÂßãÂåñÈò∂ÊÆµÊòØÊâßË°åÁ±ªÊûÑÈÄ†Âô® () ÊñπÊ≥ïÁöÑËøáÁ®ã„ÄÇ ()ÊñπÊ≥ïÊòØÁî±ÁºñËØëÂô®Ëá™Âä®Êî∂ÈõÜÁ±ª‰∏≠ÁöÑÊâÄÊúâÁ±ªÂèòÈáèÁöÑ==ËµãÂÄºÂä®‰Ωú==ÂíåÈùôÊÄÅËØ≠Âè•ÂùóÔºàstatic{}ÂùóÔºâ‰∏≠ÁöÑËØ≠Âè•ÂêàÂπ∂‰∫ßÁîüÁöÑÔºå ÁºñËØëÂô®Êî∂ÈõÜÁöÑÈ°∫Â∫èÊòØÁî±ËØ≠Âè•Âú®Ê∫êÊñá‰ª∂‰∏≠Âá∫Áé∞ÁöÑÈ°∫Â∫èÊâÄÂÜ≥ÂÆöÁöÑÔºå ÈùôÊÄÅËØ≠Âè•Âùó‰∏≠Âè™ËÉΩËÆøÈóÆÂà∞ÂÆö‰πâÂú®ÈùôÊÄÅËØ≠Âè•Âùó‰πãÂâçÁöÑÂèòÈáèÔºåÂÆö‰πâÂú®ÂÆÉ‰πãÂêéÁöÑÂèòÈáèÔºåÂú®ÂâçÈù¢ÁöÑÈùôÊÄÅËØ≠Âè•ÂùóÂèØ‰ª•ËµãÂÄºÔºå‰ΩÜÊòØ‰∏çËÉΩËÆøÈóÆ„ÄÇ Â¶ÇÊûúÊ≤°ÊúâÈùôÊÄÅËØ≠Âè•Âùó‰πüÊ≤°ÊúâÂèòÈáèÂàùÂßãÂåñËµãÂÄºÔºåÂ∞±‰∏ç‰ºö‰∫ßÁîü ÊñπÊ≥ï ()ÊñπÊ≥ï‰∏çÈúÄË¶ÅÊòæÂºèÂú∞Ë∞ÉÁî®Áà∂Á±ªÊûÑÈÄ†Âô®ÔºåËôöÊãüÊú∫‰ºö‰øùËØÅÂú®Â≠êÁ±ªÁöÑ ()ÊñπÊ≥ïÊâßË°å‰πãÂâçÔºåÁà∂Á±ªÁöÑ()ÊñπÊ≥ïÂ∑≤ÁªèÊâßË°åÂÆåÊØï„ÄÇÂõ†Ê≠§Âú®ËôöÊãüÊú∫‰∏≠Á¨¨‰∏Ä‰∏™Ë¢´ÊâßË°åÁöÑ ()ÊñπÊ≥ïÁöÑÁ±ªËÇØÂÆöÊòØ java.lang.Object„ÄÇ Êé•Âè£‰∏éÁ±ª‰∏ÄÊ†∑ÈÉΩ‰ºöÁîüÊàê ()ÊñπÊ≥ï„ÄÇ‰ΩÜÊé•Âè£‰∏éÁ±ª‰∏çÂêåÁöÑÊòØÔºå ÊâßË°åÊé•Âè£ÁöÑ ()ÊñπÊ≥ï‰∏çÈúÄË¶ÅÂÖàÊâßË°åÁà∂Êé•Âè£ÁöÑ ()ÊñπÊ≥ï„ÄÇÂè™ÊúâÂΩìÁà∂Êé•Âè£‰∏≠ÂÆö‰πâÁöÑÂèòÈáè‰ΩøÁî®Êó∂ÔºåÁà∂Êé•Âè£Êâç‰ºöÂàùÂßãÂåñ„ÄÇ Âè¶Â§ñÔºåÊé•Âè£ÁöÑÂÆûÁé∞Á±ªÂú®ÂàùÂßãÂåñÊó∂‰πü‰∏ÄÊ†∑‰∏ç‰ºöÊâßË°åÊé•Âè£ÁöÑ ()ÊñπÊ≥ï„ÄÇ ËôöÊãüÊú∫‰ºö‰øùËØÅ‰∏Ä‰∏™Á±ªÁöÑ ÊñπÊ≥ïÂú®Â§öÁ∫øÁ®ãÁéØÂ¢É‰∏≠Ë¢´Ê≠£Á°ÆÂú∞Âä†ÈîÅ„ÄÅÂêåÊ≠•ÔºåÂ¶ÇÊûúÂ§ö‰∏™Á∫øÁ®ãÂêåÊó∂ÂéªÂàùÂßãÂåñ‰∏Ä‰∏™Á±ªÔºåÈÇ£‰πàÂè™‰ºöÊúâ‰∏Ä‰∏™Á∫øÁ®ãÂéªÊâßË°åËøô‰∏™Á±ªÁöÑ()ÊñπÊ≥ïÔºåÂÖ∂‰ªñÁ∫øÁ®ãÈÉΩÈúÄË¶ÅÈòªÂ°ûÁ≠âÂæÖÔºåÁõ¥Âà∞Ê¥ªÂä®Á∫øÁ®ãÊâßË°å()ÊñπÊ≥ïÂÆåÊØï„ÄÇÂ¶ÇÊûúÂú®‰∏Ä‰∏™Á±ªÁöÑ ()ÊñπÊ≥ï‰∏≠ÊúâËÄóÊó∂ÂæàÈïøÁöÑÊìç‰ΩúÔºåÂ∞±ÂèØËÉΩÈÄ†ÊàêÂ§ö‰∏™ËøõÁ®ãÈòªÂ°û„ÄÇÂú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ËøôÁßçÈòªÂ°ûÂæÄÂæÄÊòØÂæàÈöêËîΩÁöÑ Á±ªÂä†ËΩΩÂô®Á±ª‰∏éÁ±ªÂä†ËΩΩÂô®ÂØπ‰∫é‰ªªÊÑè‰∏Ä‰∏™Á±ªÔºåÈÉΩÈúÄË¶ÅÁî±Âä†ËΩΩÂÆÉÁöÑÁ±ªÂä†ËΩΩÂô®ÂíåËøô‰∏™Á±ªÊú¨Ë∫´‰∏ÄÂêåÁ°ÆÁ´ãÂÖ∂Âú® Java ËôöÊãüÊú∫‰∏≠ÁöÑÂîØ‰∏ÄÊÄßÔºåÊØè‰∏Ä‰∏™Á±ªÂä†ËΩΩÂô®ÈÉΩÊã•Êúâ‰∏Ä‰∏™Áã¨Á´ãÁöÑÂëΩÂêçÁ©∫Èó¥„ÄÇ Âèå‰∫≤ÂßîÊ¥æÊ®°Âûã‰ªé Java ËôöÊãüÊú∫ÁöÑËßíÂ∫¶Êù•ËÆ≤ÔºåÂè™Â≠òÂú®‰∏§Áßç‰∏çÂêåÁöÑÁ±ªÂä†ËΩΩÂô®Ôºö ‰∏ÄÁßçÊòØÂêØÂä®Á±ªÂä†ËΩΩÂô®ÔºàBootstrap ClassLoaderÔºâÔºåËøô‰∏™Á±ªÂä†ËΩΩÂô®‰ΩøÁî® C++ ËØ≠Ë®ÄÂÆûÁé∞ ÔºåÊòØËôöÊãüÊú∫Ëá™Ë∫´ÁöÑ‰∏ÄÈÉ®ÂàÜÔºõ Âè¶‰∏ÄÁßçÂ∞±ÊòØÊâÄÊúâÂÖ∂‰ªñÁöÑÁ±ªÂä†ËΩΩÂô®ÔºåËøô‰∫õÁ±ªÂä†ËΩΩÂô®ÈÉΩÁî± Java ËØ≠Ë®ÄÂÆûÁé∞ÔºåÁã¨Á´ã‰∫éËôöÊãüÊú∫Â§ñÈÉ®ÔºåÂπ∂‰∏îÂÖ®ÈÉΩÁªßÊâøËá™ÊäΩË±°Á±ª java.lang.ClassLoader„ÄÇ ‰ªé Java ÂºÄÂèë‰∫∫ÂëòÁöÑËßíÂ∫¶Êù•ÁúãÔºåÁªùÂ§ßÈÉ®ÂàÜ Java Á®ãÂ∫èÈÉΩ‰ºö‰ΩøÁî®Âà∞‰ª•‰∏ã 3 ÁßçÁ≥ªÁªüÊèê‰æõÁöÑÁ±ªÂä†ËΩΩÂô®„ÄÇ ÂêØÂä®Á±ªÂä†ËΩΩÂô®ÔºàBootstrap ClassLoaderÔºâÔºöËøô‰∏™Á±ªÂ∞ÜÂô®Ë¥üË¥£Â∞ÜÂ≠òÊîæÂú®ÔºúJAVA_HOMEÔºû\lib ÁõÆÂΩï‰∏≠ÁöÑÔºåÊàñËÄÖË¢´-Xbootclasspath ÂèÇÊï∞ÊâÄÊåáÂÆöÁöÑË∑ØÂæÑ‰∏≠ÁöÑÔºåÂπ∂‰∏îÊòØËôöÊãüÊú∫ËØÜÂà´ÁöÑÔºà‰ªÖÊåâÁÖßÊñá‰ª∂ÂêçËØÜÂà´ÔºåÂ¶Ç rt.jarÔºåÂêçÂ≠ó‰∏çÁ¨¶ÂêàÁöÑÁ±ªÂ∫ìÂç≥‰ΩøÊîæÂú® lib ÁõÆÂΩï‰∏≠‰πü‰∏ç‰ºöË¢´Âä†ËΩΩÔºâÁ±ªÂ∫ìÂä†ËΩΩÂà∞ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠„ÄÇ Êó†Ê≥ïÁõ¥Êé•Ë¢´Áî®Êà∑‰ΩøÁî®ÔºåÂè™ËÉΩÈÄöËøáÂ≠êÁ±ªËøîÂõû null Êù•Èó¥Êé•Ë∞ÉÁî®„ÄÇ Êâ©Â±ïÁ±ªÂä†ËΩΩÂô®ÔºöExtension ClassLoaderÔºåË¥üË¥£Âä†ËΩΩÔºúJAVA_HOMEÔºû\lib\ext (Êâ©Â±ïÂ∫ì)ÁõÆÂΩï‰∏≠ÁöÑÔºåÊàñËÄÖË¢´ java.ext.dirs Á≥ªÁªüÂèòÈáèÊâÄÊåáÂÆöÁöÑË∑ØÂæÑ‰∏≠ÁöÑÊâÄÊúâÁ±ªÂ∫ìÔºåÂºÄÂèëËÄÖÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Êâ©Â±ïÁ±ªÂä†ËΩΩÂô®„ÄÇ Â∫îÁî®Á®ãÂ∫èÁ±ªÂä†ËΩΩÂô®ÔºöÂõ†‰∏∫ÂèØ‰ª•ÈÄöËøá ClassLoader.getSystemClassLoader() Ëé∑ÂèñÔºåÂõ†Ê≠§‰∏ÄËà¨‰πüÁß∞‰∏∫Á≥ªÁªüÁ±ªÂä†ËΩΩÂô®ÔºåË¥üË¥£Âä†ËΩΩÁî®Êà∑Ë∑ØÂæÑ‰∏äÊâÄÊåáÂÆöÁ±ªÂ∫ìÔºåÂèØ‰ª•Áõ¥Êé•Ë¢´ÂºÄÂèëËÄÖ‰ΩøÁî®„ÄÇ ‰∏äÂõæ‰∏≠Â±ïÁ§∫ÁöÑÂ±ÇÊ¨°ÂÖ≥Á≥ªÔºåÁß∞‰∏∫Á±ªÂä†ËΩΩÂô®ÁöÑÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã„ÄÇ ËØ•Ê®°ÂûãË¶ÅÊ±ÇÈô§‰∫ÜÈ°∂Â±ÇÁöÑÂêØÂä®Á±ªÂä†ËΩΩÂô®Â§ñÔºåÂÖ∂‰ΩôÁöÑÁ±ªÂä†ËΩΩÂô®ÈÉΩÂ∫îËØ•ÊúâËá™Â∑±ÁöÑÁà∂Á±ªÂä†ËΩΩÂô®„ÄÇ Ê≠§Â§ÑÁöÑÁà∂Â≠êÂÖ≥Á≥ªÈÄöÂ∏∏‰∏ç‰ºöÈÄöËøáÁªßÊâøÂÖ≥Á≥ªÊù•ÂÆûÁé∞ÔºåËÄåÊòØÈÄâÊã©ÁªÑÂêàÂÖ≥Á≥ªÊù•Â§çÁî®Áà∂Âä†ËΩΩÂô®ÁöÑ‰ª£Á†Å Â∑•‰ΩúËøáÁ®ãÔºöÂΩì‰∏Ä‰∏™Á±ªÂä†ËΩΩÂô®Êî∂Âà∞‰∫ÜÁ±ªÂä†ËΩΩÁöÑËØ∑Ê±ÇÊó∂ÔºåÂÆÉ‰∏çÊòØËá™Â∑±Âä†ËΩΩÔºåËÄåÊòØÂ∞ÜËøô‰∏™ËØ∑Ê±ÇÂßîÊ¥æÁªôÁà∂Á±ªÂä†ËΩΩÂô®ÂéªÂÆåÊàêÔºåÊØè‰∏ÄÂ±ÇÁöÑÁ±ªÂä†ËΩΩÂô®ÈÉΩÊòØÂ¶ÇÊ≠§ÔºåÂõ†Ê≠§ÊâÄÊúâÁöÑÂä†ËΩΩËØ∑Ê±ÇÊúÄÁªàÈÉΩÂ∫îËØ•‰º†ÈÄÅÂà∞È°∂Â±ÇÁöÑÂêØÂä®Á±ªÂä†ËΩΩÂô®‰∏≠ÔºåÂè™ÊúâÂΩìÁà∂Âä†ËΩΩÂô®ÂèçÈ¶àËá™Â∑±Êó†Ê≥ïÂÆåÊàêËØ•ËØ∑Ê±ÇÊó∂ÔºåÂ≠êÂä†ËΩΩÂô®Êâç‰ºöÂ∞ùËØïËá™Â∑±ÂéªÂä†ËΩΩ„ÄÇ Â•ΩÂ§ÑÔºö Java Á±ªÈöèÁùÄÂÆÉÁöÑÁ±ªÂä†ËΩΩÂô®‰∏ÄËµ∑ÂÖ∑Â§á‰∫Ü‰∏ÄÁßçÂ∏¶Êúâ‰ºòÂÖàÁ∫ßÁöÑÂ±ÇÊ¨°ÂÖ≥Á≥ª„ÄÇ ‰øùËØÅ java Ê†∏ÂøÉÂ∫ìÁöÑÂÆâÂÖ®ÊÄßÔºà‰æãÂ¶ÇÔºöÂ¶ÇÊûúÁî®Êà∑Ëá™Â∑±ÂÜô‰∫Ü‰∏Ä‰∏™ java.lang.String Á±ªÂ∞±‰ºöÂõ†‰∏∫Âèå‰∫≤ÂßîÊ¥æÊú∫Âà∂‰∏çËÉΩË¢´Âä†ËΩΩÔºå‰∏ç‰ºöÁ†¥ÂùèÂéüÁîüÁöÑ String Á±ªÁöÑÂä†ËΩΩÔºâ Ê†óÂ≠êÔºö Object Á±ªÔºåÊó†ËÆ∫Âì™‰∏Ä‰∏™Á±ªË¶ÅÂä†ËΩΩËØ•Á±ªÔºåÊúÄÁªàÈÉΩÊòØÂßîÊ¥æÁªôÂ§Ñ‰∫éÊ®°ÂûãÊúÄÈ°∂Á´ØÁöÑÂêØÂä®Á±ªÂä†ËΩΩÂô®ËøõË°åÂä†ËΩΩÔºåÂõ†Ê≠§ Object Á±ªÂú®Á®ãÂ∫èÁöÑÂêÑÁßçÁ±ªÂä†ËΩΩÂô®ÁéØÂ¢É‰∏≠ÈÉΩÊòØÂêå‰∏Ä‰∏™Á±ª„ÄÇ ÂÆûÁé∞ÔºöÂú® ClassLoader ÁöÑ loadClass ÊñπÊ≥ï‰∏≠„ÄÇ ÂØπÊØîÔºö‰ª£ÁêÜÊ®°ÂºèÔºö ‰∏éÂèå‰∫≤ÂßîÊ¥æÊú∫Âà∂Áõ∏ÂèçÔºå‰ª£ÁêÜÊ®°ÂºèÊòØÂÖàËá™Â∑±Â∞ùËØïÂä†ËΩΩÔºåÂ¶ÇÊûúÊó†Ê≥ïÂä†ËΩΩÂàôÂêë‰∏ä‰º†ÈÄí„ÄÇtomcat Â∞±ÊòØ‰ª£ÁêÜÊ®°Âºè„ÄÇ „ÄåÁ†¥Âùè„ÄçÂèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÂèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÂπ∂‰∏çÊòØ‰∏Ä‰∏™Âº∫Âà∂ÊÄßÁöÑÁ∫¶ÊùüÊ®°Âûã„ÄÇ Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÁ¨¨‰∏ÄÊ¨°„ÄåË¢´Á†¥Âùè„ÄçÂÖ∂ÂÆûÂèëÁîüÂú®Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÂá∫Áé∞‰πãÂâç‚Äî‚ÄîÂç≥ JDK 1.2 ÂèëÂ∏É‰πãÂâç„ÄÇ Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÁ¨¨‰∫åÊ¨°„ÄåË¢´Á†¥Âùè„ÄçÊòØÁî±Ëøô‰∏™Ê®°ÂûãËá™Ë∫´ÁöÑÁº∫Èô∑ÊâÄÂØºËá¥ÁöÑÔºåÂèå‰∫≤ÂßîÊ¥æÂæàÂ•ΩÂú∞Ëß£ÂÜ≥‰∫ÜÂêÑ‰∏™Á±ªÂä†ËΩΩÂô®ÁöÑÂü∫Á°ÄÁ±ªÁöÑÁªü‰∏ÄÈóÆÈ¢òÔºàË∂äÂü∫Á°ÄÁöÑÁ±ªÁî±Ë∂ä‰∏äÂ±ÇÁöÑÂä†ËΩΩÂô®ËøõË°åÂä†ËΩΩÔºâ Âü∫Á°ÄÁ±ª‰πãÊâÄ‰ª•Áß∞‰∏∫„ÄåÂü∫Á°Ä„ÄçÔºåÊòØÂõ†‰∏∫ÂÆÉ‰ª¨ÊÄªÊòØ‰Ωú‰∏∫Ë¢´Áî®Êà∑‰ª£Á†ÅË∞ÉÁî®ÁöÑ APIÔºå‰ΩÜÊòØÂü∫Á°ÄÁ±ªË∞ÉÁî®ÂõûÁî®Êà∑ÁöÑ‰ª£Á†Å‰∏çÂÆπÊòìÔºàÁî®ÂõûË∞É‰∏çË°åÔºüÔºüÔºâ ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ‰æãÂ≠ê‰æøÊòØ JNDI ÊúçÂä° Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÁ¨¨‰∏âÊ¨°„ÄåË¢´Á†¥Âùè„ÄçÊòØÁî±‰∫éÁî®Êà∑ÂØπÁ®ãÂ∫èÂä®ÊÄÅÊÄßÁöÑËøΩÊ±ÇËÄåÂØºËá¥ÁöÑÔºåËøôÈáåÊâÄËØ¥ÁöÑ„ÄåÂä®ÊÄÅÊÄß„ÄçÊåáÁöÑÊòØÂΩìÂâç‰∏Ä‰∫õÈùûÂ∏∏„ÄåÁÉ≠Èó®„ÄçÁöÑÂêçËØçÔºö‰ª£Á†ÅÁÉ≠ÊõøÊç¢ÔºàHotSwapÔºâ„ÄÅÊ®°ÂùóÁÉ≠ÈÉ®ÁΩ≤ÔºàHotDeploymentÔºâÁ≠âÔºåËØ¥ÁôΩ‰∫ÜÂ∞±ÊòØÂ∏åÊúõÂ∫îÁî®Á®ãÂ∫èËÉΩÂÉèÊàë‰ª¨ÁöÑËÆ°ÁÆóÊú∫Â§ñËÆæÈÇ£Ê†∑ÔºåÊé•‰∏äÈº†Ê†á„ÄÅU ÁõòÔºå‰∏çÁî®ÈáçÂêØÊú∫Âô®Â∞±ËÉΩÁ´ãÂç≥‰ΩøÁî®„ÄÇÁÉ≠ÊèíÊãîÔºü Âú® OSGi ÁéØÂ¢É‰∏ãÔºåÁ±ªÂä†ËΩΩÂô®‰∏çÂÜçÊòØÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã‰∏≠ÁöÑÊ†ëÁä∂ÁªìÊûÑÔºåËÄåÊòØËøõ‰∏ÄÊ≠•ÂèëÂ±ï‰∏∫Êõ¥Âä†Â§çÊùÇÁöÑÁΩëÁä∂ÁªìÊûÑÔºåÂΩìÊî∂Âà∞Á±ªÂä†ËΩΩËØ∑Ê±ÇÊó∂ÔºåOSGi Â∞ÜÊåâÁÖß‰∏ãÈù¢ÁöÑÈ°∫Â∫èËøõË°åÁ±ªÊêúÁ¥¢Ôºö Â∞Ü‰ª• java.*ÂºÄÂ§¥ÁöÑÁ±ªÂßîÊ¥æÁªôÁà∂Á±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÂ∞ÜÂßîÊ¥æÂàóË°®ÂêçÂçïÂÜÖÁöÑÁ±ªÂßîÊ¥æÁªôÁà∂Á±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÂ∞Ü Import ÂàóË°®‰∏≠ÁöÑÁ±ªÂßîÊ¥æÁªô Export Ëøô‰∏™Á±ªÁöÑ Bundle ÁöÑÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÊü•ÊâæÂΩìÂâç Bundle ÁöÑ ClassPathÔºå‰ΩøÁî®Ëá™Â∑±ÁöÑÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÊü•ÊâæÁ±ªÊòØÂê¶Âú®Ëá™Â∑±ÁöÑ Fragment Bundle ‰∏≠ÔºåÂ¶ÇÊûúÂú®ÔºåÂàôÂßîÊ¥æÁªô Fragment Bundle ÁöÑÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÊü•Êâæ Dynamic Import ÂàóË°®ÁöÑ BundleÔºåÂßîÊ¥æÁªôÂØπÂ∫î Bundle ÁöÑÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩ„ÄÇ Âê¶ÂàôÔºåÁ±ªÊü•ÊâæÂ§±Ë¥•„ÄÇ ‰∏Ä‰∏™ÈóÆÈ¢òÂÜôÂá∫‰∏ãÈù¢‰ª£Á†Å‰∏≠ÁöÑËæìÂá∫ÁªìÊûú 12345678910111213141516171819202122class SingleTon &#123; private static SingleTon singleTon = new SingleTon(); public static int count1; public static int count2 = 0; private SingleTon() &#123; count1++; count2++; &#125; public static SingleTon getInstance() &#123; return singleTon; &#125;&#125; public class Test &#123; public static void main(String[] args) &#123; SingleTon singleTon = SingleTon.getInstance(); System.out.println("count1=" + singleTon.count1); System.out.println("count2=" + singleTon.count2); &#125;&#125; ÂàÜÊûê: ‰ªé main ÂáΩÊï∞ÁúãËµ∑ÔºåSingleTon singleTon = SingleTon.getInstance();Ë∞ÉÁî®‰∫ÜSingleTonÁ±ªÁöÑÈùôÊÄÅÊñπÊ≥ïÔºåËß¶ÂèëÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ Á±ªÂä†ËΩΩÁöÑÊó∂ÂÄôÂú®ÂáÜÂ§áËøáÁ®ã‰∏≠‰∏∫Á±ªÁöÑÈùôÊÄÅÂèòÈáèÂàÜÈÖçÂÜÖÂ≠òÂπ∂ÂàùÂßãÂåñÈªòËÆ§ÂÄºsingleton=null count1=0,count2=0 Á±ªÂàùÂßãÂåñÔºå‰∏∫Á±ªÁöÑÈùôÊÄÅÂèòÈáèËµãÂÄºÂíåÊâßË°åÈùôÊÄÅ‰ª£Á†ÅÂùó„ÄÇsingletonËµãÂÄº‰∏∫new SingleTon()„ÄÇË∞ÉÁî®Á±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ï Ë∞ÉÁî®Á±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ïÂêé count=1;count2=1 ÁªßÁª≠‰∏∫count1‰∏écount2ËµãÂÄº,Ê≠§Êó∂count1Ê≤°ÊúâËµãÂÄºÊìç‰Ωú,ÊâÄÊúâcount1‰∏∫1,‰ΩÜÊòØcount2ÊâßË°åËµãÂÄºÊìç‰ΩúÂ∞±Âèò‰∏∫0 Â∞èÁªìÂä†ËΩΩÂä†ËΩΩÊòØÁ±ªÂä†ËΩΩËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∏™Èò∂ÊÆµÔºåËøô‰∏™Èò∂ÊÆµ‰ºöÂú®ÂÜÖÂ≠ò‰∏≠ÁîüÊàê‰∏Ä‰∏™‰ª£Ë°®Ëøô‰∏™Á±ªÁöÑjava.lang.ClassÂØπË±°Ôºå‰Ωú‰∏∫ÊñπÊ≥ïÂå∫Ëøô‰∏™Á±ªÁöÑÂêÑÁßçÊï∞ÊçÆÁöÑÂÖ•Âè£„ÄÇÊ≥®ÊÑèËøôÈáå‰∏ç‰∏ÄÂÆöÈùûÂæóË¶Å‰ªé‰∏Ä‰∏™ Class Êñá‰ª∂Ëé∑ÂèñÔºåËøôÈáåÊó¢ÂèØ‰ª•‰ªé ZIP ÂåÖ‰∏≠ËØªÂèñÔºàÊØîÂ¶Ç‰ªé jar ÂåÖÂíå war ÂåÖ‰∏≠ËØªÂèñÔºâÔºå‰πüÂèØ‰ª•Âú®ËøêË°åÊó∂ËÆ°ÁÆóÁîüÊàêÔºàÂä®ÊÄÅ‰ª£ÁêÜÔºâÔºå‰πüÂèØ‰ª•Áî±ÂÖ∂ÂÆÉÊñá‰ª∂ÁîüÊàêÔºàÊØîÂ¶ÇÂ∞Ü JSP Êñá‰ª∂ËΩ¨Êç¢ÊàêÂØπÂ∫îÁöÑ Class Á±ªÔºâ„ÄÇ È™åËØÅËøô‰∏ÄÈò∂ÊÆµÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰∏∫‰∫ÜÁ°Æ‰øù Class Êñá‰ª∂ÁöÑÂ≠óËäÇÊµÅ‰∏≠ÂåÖÂê´ÁöÑ‰ø°ÊÅØÊòØÂê¶Á¨¶ÂêàÂΩìÂâçËôöÊãüÊú∫ÁöÑË¶ÅÊ±ÇÔºåÂπ∂‰∏î‰∏ç‰ºöÂç±ÂÆ≥ËôöÊãüÊú∫Ëá™Ë∫´ÁöÑÂÆâÂÖ®„ÄÇ ÂáÜÂ§áÂáÜÂ§áÈò∂ÊÆµÊòØÊ≠£Âºè‰∏∫Á±ªÂèòÈáèÂàÜÈÖçÂÜÖÂ≠òÂπ∂ËÆæÁΩÆÁ±ªÂèòÈáèÁöÑÂàùÂßãÂÄºÈò∂ÊÆµÔºåÂç≥Âú®ÊñπÊ≥ïÂå∫‰∏≠ÂàÜÈÖçËøô‰∫õÂèòÈáèÊâÄ‰ΩøÁî®ÁöÑÂÜÖÂ≠òÁ©∫Èó¥„ÄÇÊ≥®ÊÑèËøôÈáåÊâÄËØ¥ÁöÑÂàùÂßãÂÄºÊ¶ÇÂøµÔºåÊØîÂ¶Ç‰∏Ä‰∏™Á±ªÂèòÈáèÂÆö‰πâ‰∏∫Ôºö 1public static int v = 8080; ÂÆûÈôÖ‰∏äÂèòÈáè v Âú®ÂáÜÂ§áÈò∂ÊÆµËøáÂêéÁöÑÂàùÂßãÂÄº‰∏∫ 0 ËÄå‰∏çÊòØ 8080ÔºåÂ∞Ü v ËµãÂÄº‰∏∫ 8080 ÁöÑputstaticÊåá‰ª§ÊòØÁ®ãÂ∫èË¢´ÁºñËØëÂêéÔºåÂ≠òÊîæ‰∫éÁ±ªÊûÑÈÄ†Âô®&lt;client&gt;ÊñπÊ≥ï‰πã‰∏≠ÔºåËøôÈáåÊàë‰ª¨ÂêéÈù¢‰ºöËß£Èáä„ÄÇ ‰ΩÜÊòØÊ≥®ÊÑèÂ¶ÇÊûúÂ£∞Êòé‰∏∫Ôºö 1public static final int v = 8080; Âú®ÁºñËØëÈò∂ÊÆµ‰ºö‰∏∫ v ÁîüÊàêConstantValueÂ±ûÊÄßÔºåÂú®ÂáÜÂ§áÈò∂ÊÆµËôöÊãüÊú∫‰ºöÊ†πÊçÆ ConstantValue Â±ûÊÄßÂ∞Ü v ËµãÂÄº‰∏∫ 8080„ÄÇ Ëß£ÊûêËß£ÊûêÈò∂ÊÆµÊòØÊåáËôöÊãüÊú∫Â∞ÜÂ∏∏ÈáèÊ±†‰∏≠ÁöÑÁ¨¶Âè∑ÂºïÁî®ÊõøÊç¢‰∏∫Áõ¥Êé•ÂºïÁî®ÁöÑËøáÁ®ã„ÄÇÁ¨¶Âè∑ÂºïÁî®Â∞±ÊòØ class Êñá‰ª∂‰∏≠ÁöÑÔºö CONSTANT_Class_info CONSTANT_Field_info CONSTANT_Method_info Á≠âÁ±ªÂûãÁöÑÂ∏∏Èáè„ÄÇ ‰∏ãÈù¢Êàë‰ª¨Ëß£Èáä‰∏Ä‰∏ãÁ¨¶Âè∑ÂºïÁî®ÂíåÁõ¥Êé•ÂºïÁî®ÁöÑÊ¶ÇÂøµÔºö Á¨¶Âè∑ÂºïÁî®‰∏éËôöÊãüÊú∫ÂÆûÁé∞ÁöÑÂ∏ÉÂ±ÄÊó†ÂÖ≥ÔºåÂºïÁî®ÁöÑÁõÆÊ†áÂπ∂‰∏ç‰∏ÄÂÆöË¶ÅÂ∑≤ÁªèÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠„ÄÇÂêÑÁßçËôöÊãüÊú∫ÂÆûÁé∞ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÂèØ‰ª•ÂêÑ‰∏çÁõ∏ÂêåÔºå‰ΩÜÊòØÂÆÉ‰ª¨ËÉΩÊé•ÂèóÁöÑÁ¨¶Âè∑ÂºïÁî®ÂøÖÈ°ªÊòØ‰∏ÄËá¥ÁöÑÔºåÂõ†‰∏∫Á¨¶Âè∑ÂºïÁî®ÁöÑÂ≠óÈù¢ÈáèÂΩ¢ÂºèÊòéÁ°ÆÂÆö‰πâÂú® Java ËôöÊãüÊú∫ËßÑËåÉÁöÑ Class Êñá‰ª∂Ê†ºÂºè‰∏≠„ÄÇ Áõ¥Êé•ÂºïÁî®ÂèØ‰ª•ÊòØÊåáÂêëÁõÆÊ†áÁöÑÊåáÈíàÔºåÁõ∏ÂØπÂÅèÁßªÈáèÊàñÊòØ‰∏Ä‰∏™ËÉΩÈó¥Êé•ÂÆö‰ΩçÂà∞ÁõÆÊ†áÁöÑÂè•ÊüÑ„ÄÇÂ¶ÇÊûúÊúâ‰∫ÜÁõ¥Êé•ÂºïÁî®ÔºåÈÇ£ÂºïÁî®ÁöÑÁõÆÊ†áÂøÖÂÆöÂ∑≤ÁªèÂú®ÂÜÖÂ≠ò‰∏≠Â≠òÂú®„ÄÇ ÂàùÂßãÂåñÂàùÂßãÂåñÈò∂ÊÆµÊòØÁ±ªÂä†ËΩΩÊúÄÂêé‰∏Ä‰∏™Èò∂ÊÆµÔºåÂâçÈù¢ÁöÑÁ±ªÂä†ËΩΩÈò∂ÊÆµ‰πãÂêéÔºåÈô§‰∫ÜÂú®Âä†ËΩΩÈò∂ÊÆµÂèØ‰ª•Ëá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®‰ª•Â§ñÔºåÂÖ∂ÂÆÉÊìç‰ΩúÈÉΩÁî± JVM ‰∏ªÂØº„ÄÇÂà∞‰∫ÜÂàùÂßãÈò∂ÊÆµÔºåÊâçÂºÄÂßãÁúüÊ≠£ÊâßË°åÁ±ª‰∏≠ÂÆö‰πâÁöÑ Java Á®ãÂ∫è‰ª£Á†Å„ÄÇ ÂàùÂßãÂåñÈò∂ÊÆµÊòØÊâßË°åÁ±ªÊûÑÈÄ†Âô®&lt;clint&gt;ÊñπÊ≥ïÁöÑËøáÁ®ã„ÄÇ&lt;clint&gt;ÊñπÊ≥ïÊòØÁî±ÁºñËØëÂô®Ëá™Âä®Êî∂ÈõÜÁ±ª‰∏≠ÁöÑÁ±ªÂèòÈáèÁöÑËµãÂÄºÊìç‰ΩúÂíåÈùôÊÄÅËØ≠Âè•Âùó‰∏≠ÁöÑËØ≠Âè•ÂêàÂπ∂ËÄåÊàêÁöÑ„ÄÇËôöÊãüÊú∫‰ºö‰øùËØÅ&lt;clint&gt;ÊñπÊ≥ïÊâßË°å‰πãÂâçÔºåÁà∂Á±ªÁöÑ&lt;clint&gt;ÊñπÊ≥ïÂ∑≤ÁªèÊâßË°åÂÆåÊØï„ÄÇp.s: Â¶ÇÊûú‰∏Ä‰∏™Á±ª‰∏≠Ê≤°ÊúâÂØπÈùôÊÄÅÂèòÈáèËµãÂÄº‰πüÊ≤°ÊúâÈùôÊÄÅËØ≠Âè•ÂùóÔºåÈÇ£‰πàÁºñËØëÂô®ÂèØ‰ª•‰∏ç‰∏∫Ëøô‰∏™Á±ªÁîüÊàê&lt;clint&gt;()ÊñπÊ≥ï„ÄÇ Ê≥®ÊÑè‰ª•‰∏ãÂá†ÁßçÊÉÖÂÜµ‰∏ç‰ºöÊâßË°åÁ±ªÂàùÂßãÂåñÔºö ÈÄöËøáÂ≠êÁ±ªÂºïÁî®Áà∂Á±ªÁöÑÈùôÊÄÅÂ≠óÊÆµÔºåÂè™‰ºöËß¶ÂèëÁà∂Á±ªÁöÑÂàùÂßãÂåñÔºåËÄå‰∏ç‰ºöËß¶ÂèëÂ≠êÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ ÂÆö‰πâÂØπË±°Êï∞ÁªÑÔºå‰∏ç‰ºöËß¶ÂèëËØ•Á±ªÁöÑÂàùÂßãÂåñ„ÄÇ Xxx[] ary = new Xxx[]; Â∏∏ÈáèÂú®ÁºñËØëÊúüÈó¥‰ºöÂ≠òÂÖ•Ë∞ÉÁî®Á±ªÁöÑÂ∏∏ÈáèÊ±†‰∏≠ÔºåÊú¨Ë¥®‰∏äÂπ∂Ê≤°ÊúâÁõ¥Êé•ÂºïÁî®ÂÆö‰πâÂ∏∏ÈáèÁöÑÁ±ªÔºå‰∏ç‰ºöËß¶ÂèëÂÆö‰πâÂ∏∏ÈáèÊâÄÂú®ÁöÑÁ±ª„ÄÇ ÈÄöËøáÁ±ªÂêçËé∑Âèñ Class ÂØπË±°Ôºå‰∏ç‰ºöËß¶ÂèëÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ ÈÄöËøá Class.forName Âä†ËΩΩÊåáÂÆöÁ±ªÊó∂ÔºåÂ¶ÇÊûúÊåáÂÆöÂèÇÊï∞ initialize ‰∏∫ false Êó∂Ôºå‰πü‰∏ç‰ºöËß¶ÂèëÁ±ªÂàùÂßãÂåñÔºåÂÖ∂ÂÆûËøô‰∏™ÂèÇÊï∞ÊòØÂëäËØâËôöÊãüÊú∫ÔºåÊòØÂê¶Ë¶ÅÂØπÁ±ªËøõË°åÂàùÂßãÂåñ„ÄÇ ÈÄöËøá ClassLoader ÈªòËÆ§ÁöÑ loadClass ÊñπÊ≥ïÔºå‰πü‰∏ç‰ºöËß¶ÂèëÂàùÂßãÂåñÂä®‰Ωú„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã JVM Á±ªÂä†ËΩΩÊú∫Âà∂ËØ¶Ëß£ Êú¨ÊñáÂÜÖÂÆπ‰∏ªË¶ÅÂèÇËÄÉËá™„ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„ÄãÔºåÂΩìÁÑ∂‰πüÊúâ‰∏Ä‰∫õ‰∏™‰∫∫ÁêÜËß£ÔºåËã•Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ÈõÜÂêàÊ°ÜÊû∂‰πã LinkedHashMap Â∑•‰ΩúÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F09%2F17%2FJava-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E4%B9%8B-LinkedHashMap-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[‰∏Ä„ÄÅ‰∏çÂêåÁ±ªÂûã Map ÁöÑÈÄÇÁî®Âú∫ÊôØ Â¶ÇÊûú‰∏çÂÖ≥ÂøÉ Map ‰∏≠ÁöÑ key È°∫Â∫èÔºåÂè™ÊòØÂ∏åÊúõËÉΩÂ§ü‰ª• O(1) ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÊâßË°åÊèíÂÖ•ÂíåÊü•ÊâæÊìç‰Ωú„ÄÇÈÇ£‰πàÂèØ‰ª•ÈÄâÊã©HashMapÔºõ Â¶ÇÊûúË¶ÅÊ±Ç key ÊúâÂ∫èÔºåÂàôÈÄâÊã©TreeMap„ÄÇ ‰ΩÜÊòØÈÄâÊã© TreeMap Â∞±‰ºöÊúâÊÄßËÉΩÈóÆÈ¢òÔºåÂõ†‰∏∫ TreeMap ÁöÑ get Êìç‰ΩúÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÊòØO(log(n))ÁöÑÔºåÁõ∏ÊØî‰∫é HashMap ÁöÑO(1)ËøòÊòØÂ∑Æ‰∏çÂ∞ëÁöÑÔºå LinkedHashMapÁöÑÂá∫Áé∞Â∞±ÊòØ‰∏∫‰∫ÜÂπ≥Ë°°Ëøô‰∫õÂõ†Á¥†Ôºå‰ΩøÂæó ËÉΩÂ§ü‰ª•O(1)Êó∂Èó¥Â§çÊùÇÂ∫¶Â¢ûÂä†Êü•ÊâæÂÖÉÁ¥†ÔºåÂèàËÉΩÂ§ü‰øùËØÅ key ÁöÑÊúâÂ∫èÊÄß Ê≠§Â§ñÔºåLinkedHashMap Êèê‰æõ‰∫Ü‰∏§Áßç key ÁöÑÈ°∫Â∫èÔºö ÊåâÁÖßËÆøÈóÆÈ°∫Â∫èÊéíÂ∫èÔºàaccess orderÔºâ„ÄÇÂèØ‰ª•‰ΩøÁî®ËøôÁßçÈ°∫Â∫èÂÆûÁé∞LRUÔºàLeast Recently UsedÔºâÁºìÂ≠ò Âõ†‰∏∫ÊØèÊ¨°ËÆøÈóÆÂêéÁöÑÂÖÉÁ¥†‰ºöË¢´ÁßªÂà∞ÈìæË°®Â∞æÈÉ®ÔºåÂÆûÁé∞ LRU Âè™ÈúÄË¶ÅÁßªÈô§ ÈìæÈ¶ñÂÖÉÁ¥† Âç≥ÂèØ „Äå‰∏ÄÊ¨°ËÆøÈóÆ„ÄçÁöÑÂÆö‰πâÊòØ‰ªÄ‰πàÔºü putÔºåputIfAbsentÔºågetÔºågetOrDefaultÔºåcomputeÔºåcomputeIfAbsentÔºåcomputeIfPresent Êàñ merge ÊñπÊ≥ï‰ºöÂØºËá¥ËÆøÈóÆÁõ∏Â∫îÁöÑÊù°ÁõÆÔºàÂÅáËÆæÂÆÉÂú®Ë∞ÉÁî®ÂÆåÊàêÂêéÂ≠òÂú®Ôºâ„ÄÇÂ¶ÇÊûúÂÄºË¢´ÊõøÊç¢ÔºåÊõøÊç¢ÊñπÊ≥ïÂè™‰ºöÂØºËá¥Êù°ÁõÆÁöÑËÆøÈóÆ ÊåâÁÖßÊèíÂÖ•È°∫Â∫èÊéíÂ∫èÔºàinsertion ordeÔºâ„ÄÇÊ≥®ÔºöÂêå‰∏Ä key ÁöÑÂ§öÊ¨°ÊèíÂÖ•ÔºåÂπ∂‰∏ç‰ºöÂΩ±ÂìçÂÖ∂È°∫Â∫è„ÄÇÊ≥®ÔºöWeakHashMap ‰πüÂèØ‰ª•Áî®‰∫éÂÆûÁé∞ÁºìÂ≠òÔºå‰∫åËÄÖÁöÑ‰ΩøÁî®Âú∫ÊôØ‰∏çÂêå„ÄÇWeakHashMap Êó†Ê≥ïÂÉè LinkedHashMap ÈÇ£Ê†∑Ëá™ÂÆö‰πâÊ∑òÊ±∞ËßÑÂàôÔºåÂÆÉÁöÑÂÖÉÁ¥†‰ºöÂú® gc ÁöÑÂèëÁîüÁöÑÊó∂ÂÄôË¢´Ê∏ÖÈô§„ÄÇ ÁâπÂà´Âú∞ÔºåÂØπ collection-view ÁöÑÊìç‰Ωú‰∏ç‰ºöÂΩ±ÂìçÂêéÂè∞Êò†Â∞ÑÁöÑËø≠‰ª£È°∫Â∫è„ÄÇ collection-view ÊòØÂê¶Á±ª‰ºº‰∫éÊï∞ÊçÆÂ∫ìÁöÑËßÜÂõæÔºü ‰∫å„ÄÅÊÄßËÉΩLinkedHashMap Êèê‰æõ‰∫ÜÊâÄÊúâÂèØÈÄâÁöÑ Map Êìç‰ΩúÔºåÂπ∂ÂÖÅËÆ∏‰ΩøÁî® null ÂÖÉÁ¥†„ÄÇ‰∏é HashMap ‰∏ÄÊ†∑ÔºåÂÅáËÆæÊï£ÂàóÂáΩÊï∞ËÉΩÂ§üÊ≠£Á°ÆÂú∞Âú®Ê°∂‰πãÈó¥ÂàÜÊï£ÂÖÉÁ¥†ÔºåÂÆÉ‰∏∫Âü∫Êú¨Êìç‰ΩúÔºàÊ∑ªÂä†ÔºåÂåÖÂê´ÂíåÂà†Èô§ÔºâÊèê‰æõ‰∫ÜÊÅíÂÆöÁöÑÊÄßËÉΩ„ÄÇÊÄßËÉΩÂèØËÉΩÁï•‰Ωé‰∫é HashMap ÁöÑÊÄßËÉΩÔºåËøôÊòØÂõ†‰∏∫Áª¥Êä§ÈìæÊé•ÂàóË°®ÁöÑÊàêÊú¨Â¢ûÂä†‰∫ÜÔºå‰ΩÜÊúâ‰∏Ä‰∏™‰æãÂ§ñÔºöÂØπ LinkedHashMap ÁöÑ collection-view ÁöÑËø≠‰ª£ÈúÄË¶ÅÊó∂Èó¥‰∏é map ÁöÑ size ÊàêÊØîÔºåËÄå‰∏çÂÖ≥ÂÖ∂ capacity„ÄÇËø≠‰ª£ HashMap ÂèØËÉΩ‰ºöÊõ¥Âä†ÊòÇË¥µÔºåÈúÄË¶ÅÁöÑÊó∂Èó¥‰∏éÂÖ∂ capacity ÊàêÊ≠£ÊØî„ÄÇ LinkedHashMap Êúâ‰∏§‰∏™ÂΩ±ÂìçÂÖ∂ÊÄßËÉΩÁöÑÂèÇÊï∞ÔºöÂàùÂßãÂÆπÈáèÂíåË¥üËΩΩÂõ†Â≠ê„ÄÇÂÆÉ‰ª¨ÁöÑÂÆö‰πâ‰∏é HashMap ÂÆåÂÖ®Áõ∏Âêå„ÄÇ‰ΩÜËØ∑Ê≥®ÊÑèÔºåÂØπ‰∫éÊ≠§Á±ªÔºåÂàùÂßãÂÆπÈáèÈÄâÊã©ËøáÈ´òÂÄºÂØπÊÄßËÉΩÁöÑÂΩ±Âìç‰∏ç‰ºöÂÉè HashMap ÈÇ£‰πà‰∏•ÈáçÔºåÂõ†‰∏∫Ê≠§Á±ªÁöÑËø≠‰ª£Êó∂Èó¥‰∏çÂèóÂÆπÈáèÂΩ±ÂìçÔºåËø≠‰ª£Âè™ÂèóÂà∞ size ÁöÑÂΩ±Âìç„ÄÇ ‰∏â„ÄÅÂπ∂ÂèëÈóÆÈ¢òÔºàfail-fastÔºâÂπ∂ÂèëÊñπÂºèÔºöÊé®Ëçê‰ΩøÁî® Map m = Collections.synchronizedMap(new LinkedHashMap(...));ËøõË°åÂåÖË£Ö„ÄÇÂÜÖÈÉ®ÊòØ‰ΩøÁî®‰∏Ä‰∏™ÂÜÖÁΩÆÈîÅÔºåÂêÑ‰∏™ÊñπÊ≥ïÁöÑÂÆûÁé∞Âè™ÊòØÂä†ÈîÅÁÑ∂Âêé Ë∞ÉÁî®ÂéüÊù•ÁöÑÁ±ª„ÄÇËøôÊúÄÂ•ΩÂú®ÂàõÂª∫Êó∂Â∞±ÂÆåÊàê„ÄåÂåÖË£ÖÊìç‰Ωú„ÄçÔºå‰ª•Èò≤Ê≠¢ÊÑèÂ§ñÁöÑ‰∏çÂêåÊ≠•ËÆøÈóÆ Map„ÄÇ ÁªìÊûÑÊÄß‰øÆÊîπÔºàA structural modification Ôºâ ÊòØÊåá Ê∑ªÂä†ÊàñÂà†Èô§‰∏Ä‰∏™ÊàñÂ§ö‰∏™Êò†Â∞ÑÁöÑÊìç‰ΩúÔºå Âú®ËÆøÈóÆÊúâÂ∫èÁöÑ LinkedHashMap ÁöÑÊÉÖÂÜµ‰∏ã‰ºöÂΩ±ÂìçËø≠‰ª£È°∫Â∫è„ÄÇ Âú®ÊèíÂÖ•ÊúâÂ∫èÁöÑ LinkedHashMap ‰∏≠Ôºå‰ªÖÊõ¥Êîπ‰∏éÂ∑≤ÂåÖÂê´Âú®Êò†Â∞Ñ‰∏≠ÁöÑÈîÆÁõ∏ÂÖ≥ÁöÑÂÄº‰∏çÊòØÁªìÊûÑ‰øÆÊîπ„ÄÇ Âú® access-ordered Ê®°Âºè‰∏ãÁöÑ LinkedHashMap ‰∏≠Ôºå‰ªÖÈÄöËøá get Êü•ËØ¢ map Â∞±ÊòØ‰∏ÄÁßçÁªìÊûÑ‰øÆÊîπ„ÄÇ Ëø≠‰ª£ÈÅçÂéÜËøáÁ®ã‰∏≠Â¶ÇÊûúÂèëÁé∞ÁªìÊûÑÊÄß‰øÆÊîπÈóÆÈ¢òÔºà‰ΩøÁî® iterater#remove ÊñπÊ≥ï‰∫ßÁîüÁöÑÁªìÊûÑÊÄß‰øÆÊîπÈóÆÈ¢òÈô§Â§ñ ÔºâÔºåÈ©¨‰∏äÊäõÂá∫ ConcurrentModificationExceptionÔºå‰ª•ÂÖçÈÄ†ÊàêÊõ¥Â§ßÁöÑÊçüÂ§±„ÄÇ „ÄåÂø´ÈÄüÂ§±Ë¥•„ÄçÂÖ∑‰ΩìÂÆûÁé∞ÊòØÊÄé‰πàÊ†∑ÁöÑÂë¢ÔºüÊØèË∂üÈÅçÂéÜÂÆåÊàê‰πãÂêéÈÉΩ‰ºöË∞ÉÁî® checkForComodification ÊñπÊ≥ïËøõË°åÊ£ÄÊü• java.util.ArrayList.Itr#checkForComodification 1234final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException();&#125; Âõõ„ÄÅÂÆûÁé∞ËäÇÁÇπÊï∞ÊçÆÁªìÊûÑ‰∏ªË¶ÅÂü∫‰∫é HashMap ÁöÑËäÇÁÇπÊï∞ÊçÆÁªìÊûÑÂÆûÁé∞„ÄÇ 1234567static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; //ÊØè‰∏™ËäÇÁÇπÂåÖÂê´‰∏§‰∏™ÊåáÈíàÔºåÊåáÂêëÂâçÁªßËäÇÁÇπ‰∏éÂêéÁªßËäÇÁÇπ Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; ÂèåÂêëÈìæË°®ÂÆûÁé∞ÁöÑ LinkedHshMapÔºåÊâÄ‰ª•ÊØè‰∏™ËäÇÁÇπÈ°ªÂú® HashMap ÁöÑÂü∫Á°Ä‰∏äÊ∑ªÂä†ÊåáÂêëÂâçÁªßËäÇÁÇπ‰∏éÂêéÁªßËäÇÁÇπÊåáÈíàÔºöbeforeÔºåafter„ÄÇ Ê†∏ÂøÉÊñπÊ≥ïHashMap ‰∏≠ÂÆö‰πâ‰∫Ü‰∏â‰∏™ÂõûË∞ÉÊñπÊ≥ï‰æõ LinkedHashMap ÈáçÂÜô„ÄÇ 1234// Callbacks to allow LinkedHashMap post-actionsvoid afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;void afterNodeInsertion(boolean evict) &#123; &#125;void afterNodeRemoval(Node&lt;K,V&gt; p) &#123; &#125; LinkedHashMap ÁªßÊâø‰∫é HashMapÔºåÈáçÊñ∞ÂÆûÁé∞‰∫ÜËøô 3 ‰∏™ÂáΩÊï∞ÔºåÈ°æÂêçÊÄù‰πâËøô‰∏â‰∏™ÂáΩÊï∞ÁöÑ‰ΩúÁî®ÂàÜÂà´ÊòØÔºöËäÇÁÇπËÆøÈóÆÂêé„ÄÅËäÇÁÇπÊèíÂÖ•Âêé„ÄÅËäÇÁÇπÁßªÈô§ÂêéÂÅö‰∏Ä‰∫õ‰∫ãÊÉÖ„ÄÇ 1.afterNodeRemovalÂèåÂêëÈìæË°®Âà†Èô§ËäÇÁÇπÂèØ‰ª•ÂèÇËÄÉËøôÊ†∑ÊÄùË∑Ø„ÄÇ ÂÅáËÆæ before ‚Äî&gt; p ‚Äî&gt; after Ë¶ÅÂà†Èô§ p 1.ÂÖàÂ§ÑÁêÜ after ÊñπÂêëif p ‰∏∫Á¨¨‰∏Ä‰∏™ËäÇÁÇπ before == null head = after else before.after = after 2.ÂÜçÂ§ÑÁêÜ before ÊñπÂêëif p ‰∏∫ÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπ after == null tail = beforeelse after.before = before; 12345678910111213void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.before = p.after = null; if (b == null) head = a; else b.after = a; if (a == null) tail = b; else a.before = b;&#125; 2.afterNodeInsertion evict ÂèÇÊï∞Êúâ‰ªÄ‰πàÁî®Ôºü if false, the table is in creation mode. Creation mode ÊòØ‰ªÄ‰πàÔºüÂàöÂàöÂàõÂª∫Êó∂ÁöÑÊ®°ÂºèÔºü HashMap#ÁöÑ put ÊñπÊ≥ïÔºåË∞ÉÁî® putVal ÊñπÊ≥ïÊó∂Ôºå‰º†ÂÖ•ÁöÑ evit ‰∏∫ true„ÄÇ 123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; Ë∞ÉÁî®Â§Ñ‰º†ÈÄí evict ÂÖ®ÈÉ®‰∏∫ true„ÄÇ 1234567void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125;&#125; 3.afterNodeAccess‰∏éÊ®°ÂºèÁõ∏ÂÖ≥ final boolean accessOrder Âè™ËÉΩÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÊåáÂÆöÔºåÈªòËÆ§‰∏∫ falseÔºå true Ë°®Á§∫ÊåâËÆøÈóÆÈ°∫Â∫èÊéíÂ∫è false Ë°®Á§∫ÊåâÊèíÂÖ•È°∫Â∫èÊéíÂ∫è ÊääËäÇÁÇπÁßªÂà∞ÈìæË°®Êú´Â∞æ„ÄÇ 123456789101112131415161718192021222324void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last; if (accessOrder &amp;&amp; (last = tail) != e) &#123;//Â¶ÇÊûúÊòØÊåâÁÖßËÆøÈóÆÈ°∫Â∫èÔºåÂπ∂‰∏î ‰∏çÊòØÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥† LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.after = null; if (b == null) head = a; else b.after = a; if (a != null) a.before = b; else last = b; if (last == null) head = p; else &#123; p.before = last; last.after = p; &#125; tail = p; ++modCount; &#125;&#125; 4.putput putÂáΩÊï∞Âú®LinkedHashMap‰∏≠Êú™ÈáçÊñ∞ÂÆûÁé∞ÔºåÂè™ÊòØÂÆûÁé∞‰∫ÜafterNodeAccessÂíåafterNodeInsertion‰∏§‰∏™ÂõûË∞ÉÂáΩÊï∞„ÄÇ 5.get12345678public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; if (accessOrder) afterNodeAccess(e); return e.value;&#125; getÂáΩÊï∞ÈáçÊñ∞ÂÆûÁé∞Âπ∂Âä†ÂÖ•‰∫ÜafterNodeAccessÊù•‰øùËØÅËÆøÈóÆÈ°∫Â∫è ‰∫î„ÄÅÂ∞èÁªì ÊÄéÊ†∑‰øùËØÅÊèíÂÖ•È°∫Â∫èÔºü ‰ΩøÁî®ÂâçÈ©±ÂíåÂêéÁªßÊåáÈíàÔºå‰ΩøÂæóÂéüÊù•ÁöÑ HashMap ÊúâÂ∫èÔºåÂú®LinkedHashMap‰∏≠Ë¶ÜÁõñHashMap‰∏≠newNode ÊñπÊ≥ïÔºå‰ΩøÂæóÊØèÊ¨° put Êï∞ÊçÆÊó∂ÔºåÊñ∞Âª∫ÁöÑËäÇÁÇπÈÉΩÊòØLinkedHashMap.Entry&lt;K,v&gt; Á±ªÂûãÁöÑÔºåÊØîÊôÆÈÄöÁöÑHsahMap.Entry Â§ö‰∏Ä‰∏™ÂâçÈ©±ÁªìÁÇπÂíå‰∏Ä‰∏™ÂêéÁªßËäÇÁÇπÔºå‰ΩøÁî®ÂâçÈ©±ÂíåÂêéÁªß‰øùËØÅÊèíÂÖ•ÊúâÂ∫è„ÄÇ ÊÄé‰πàÊ†∑‰øùËØÅËÆøÈóÆÈ°∫Â∫èÔºü Ë¶ÜÁõñÁà∂Á±ªHashMapÁöÑafterNodeAccess ÊñπÊ≥ïÔºå‰ΩøÂæóÊØèÊ¨°ËÆøÈóÆÂêéÔºåÈÉΩÊîπÂèòÈìæË°®È°∫Â∫è„ÄÇ‰ΩøÂæóÂéüÈìæË°®ÊåâËÆøÈóÆÊéíÂ∫è„ÄÇÂ∞ÜÊúÄÊñ∞‰∏ÄÊ¨°ËÆøÈóÆÁöÑËäÇÁÇπÊîæÂà∞ÈìæË°®ÁöÑÊúÄÂêé„ÄÇ ÂÖ≠„ÄÅÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ÈáçËØÜ java-LinkedHashMap ÂÆòÊñπÊñáÊ°£ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÈõÜÂêàÊ°ÜÊû∂</category>
      </categories>
      <tags>
        <tag>ÈõÜÂêàÊ°ÜÊû∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ÂÜÖÂ≠òÊ®°Âûã‰∏éÁ∫øÁ®ãÊµÖÊûê]]></title>
    <url>%2Fblog%2F2017%2F09%2F14%2FJava-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B5%85%E6%9E%90%2F</url>
    <content type="text"><![CDATA[Á°¨‰ª∂ÁöÑÊïàÁéá‰∏é‰∏ÄËá¥ÊÄßÂ§öÁ∫ßÁºìÂ≠òÁöÑ‰ΩúÁî®ÔºöÁî±‰∫éËÆ°ÁÆóÊú∫ÁöÑÂ≠òÂÇ®ËÆæÂ§á‰∏éÂ§ÑÁêÜÂô®ÁöÑËøêÁÆóÈÄüÂ∫¶ÊúâÂá†‰∏™Êï∞ÈáèÁ∫ßÁöÑÂ∑ÆË∑ùÔºåÊâÄ‰ª•‰∏∫‰∫ÜÊèêÈ´òÂ§ÑÁêÜÂô®ÁöÑÂà©Áî®ÁéáÔºåÁé∞‰ª£ËÆ°ÁÆóÊú∫Á≥ªÁªüÈÉΩ‰∏çÂæó‰∏çÂä†ÂÖ•‰∏ÄÂ±ÇËØªÂÜôÈÄüÂ∫¶Â∞ΩÂèØËÉΩÊé•ËøëÂ§ÑÁêÜÂô®ËøêÁÆóÈÄüÂ∫¶ÁöÑÈ´òÈÄüÁºìÂ≠ò(Cache)Êù•‰Ωú‰∏∫ÂÜÖÂ≠ò‰∏éÂ§ÑÁêÜÂô®‰πãÈó¥ÁöÑÁºìÂÜ≤ÔºöÂ∞ÜËøêÁÆóÈúÄË¶Å‰ΩøÁî®Âà∞ÁöÑÊï∞ÊçÆÂ§çÂà∂Âà∞ÁºìÂ≠ò‰∏≠ÔºåËÆ©ËøêÁÆóËÉΩÂø´ÈÄüËøõË°åÔºåÂΩìËøêÁÆóÁªìÊùüÂêéÂÜç‰ªéÁºìÂ≠òÂêåÊ≠•ÂõûÂÜÖÂ≠ò‰πã‰∏≠ÔºåËøôÊ†∑Â§ÑÁêÜÂô®Â∞±Êó†È°ªÁ≠âÂæÖÁºìÊÖ¢ÁöÑÂÜÖÂ≠òËØªÂÜô‰∫Ü„ÄÇ ÁºìÂ≠òËôΩÁÑ∂Ëß£ÂÜ≥‰∫ÜÈÄüÂ∫¶Â∑ÆÔºå‰ΩÜÊòØ‰πüÂºïÂÖ•‰∫ÜÊñ∞ÈóÆÈ¢ò‚Äî‚ÄîÁºìÂ≠ò‰∏é‰∏ªÂÜÖÂ≠òÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß(Cache Coherence) Êú¨Êñá‰∏≠„ÄåÂÜÖÂ≠òÊ®°Âûã„Äç‰∏ÄËØçÔºåÂèØ‰ª•ÁêÜËß£‰∏∫Âú®ÁâπÂÆöÁöÑÊìç‰ΩúÂçèËÆÆ‰∏ãÔºåÂØπÁâπÂÆöÁöÑÂÜÖÂ≠òÊàñÈ´òÈÄüÁºìÂ≠òËøõË°åËØªÂÜôËÆøÈóÆÁöÑËøáÁ®ãÊäΩË±°„ÄÇ Èô§‰∫ÜÂ¢ûÂä†È´òÈÄüÁºìÂ≠ò‰πãÂ§ñÔºå‰∏∫‰∫Ü‰ΩøÂæóÂ§ÑÁêÜÂô®ÂÜÖÈÉ®ÁöÑËøêÁÆóÂçïÂÖÉËÉΩÂ∞ΩÈáèË¢´ÂÖÖÂàÜÂà©Áî®ÔºåÂ§ÑÁêÜÂô®ÂèØËÉΩ‰ºöÂØπËæìÂÖ•‰ª£Á†ÅËøõË°å‰π±Â∫èÊâßË°å(Out-Of-Order Execution)‰ºòÂåñÔºàÂç≥ Êåá‰ª§ÈáçÊéíÂ∫èÔºâÔºåÂ§ÑÁêÜÂô®‰ºöÂú®ËÆ°ÁÆó‰πãÂêéÂ∞Ü‰π±Â∫èÊâßË°åÁöÑÁªìÊûúÈáçÁªÑÔºå‰øùËØÅËØ•ÁªìÊûú‰∏éÈ°∫Â∫èÊâßË°åÁöÑÁªìÊûúÊòØ‰∏ÄËá¥„ÄÇ Java ËØ≠Ë®ÄËßÑËåÉË¶ÅÊ±Ç JVM Âú®Á∫øÁ®ã‰∏≠Áª¥Êä§‰∏ÄÁßçÁ±ª‰ºº‰∏≤Ë°åÁöÑËØ≠‰πâÔºöÂè™Ë¶ÅÁ®ãÂ∫èÁöÑÊúÄÁªàÁªìÊûú‰∏éÂú®‰∏•Ê†º‰∏≤Ë°åÁéØÂ¢É‰∏≠ÊâßË°åÁöÑÁªìÊûúÁõ∏ÂêåÔºåÈÇ£‰πà‰∏äËø∞Êìç‰ΩúÔºàÊåá‰ª§ÈáçÊéíÂ∫è„ÄÅÂ¢ûÂä†È´òÈÄüÁºìÂ≠òÔºâÈÉΩÊòØÂÖÅËÆ∏ÁöÑ„ÄÇ Java ÂÜÖÂ≠òÊ®°Âûã‰∏ªÂÜÖÂ≠ò‰∏éÂ∑•‰ΩúÂÜÖÂ≠ò‰ª•‰∏ãÊâÄË∞àÁöÑÂèòÈáè(Variables)‰∏é Java ÁºñÁ®ã‰∏≠ÊâÄËØ¥ÁöÑÂèòÈáèÊúâÊâÄÂå∫Âà´ÔºåÂÆÉÂåÖÊã¨‰∫ÜÂÆû‰æãÂ≠óÊÆµ„ÄÅÈùôÊÄÅÂ≠óÊÆµÂíåÊûÑÊàêÊï∞ÁªÑÂØπË±°ÁöÑÂÖÉÁ¥†Ôºå‰ΩÜ‰∏çÂåÖÊã¨Â±ÄÈÉ®ÂèòÈáè‰∏éÊñπÊ≥ïÂèÇÊï∞ÔºåÂõ†‰∏∫ÂêéËÄÖÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºå‰∏ç‰ºöË¢´ÂÖ±‰∫´ÔºåËá™ÁÑ∂Â∞±‰∏ç‰ºöÂ≠òÂú®Á´û‰∫âÈóÆÈ¢ò„ÄÇ ~Ê≥®~ÔºöÂ¶ÇÊûúÂ±ÄÈÉ®ÂèòÈáèÊòØ‰∏Ä‰∏™ reference Á±ªÂûãÔºåÂÆÉÂºïÁî®ÁöÑÂØπË±°Âú® Java Â†Ü‰∏≠ÂèØË¢´ÂêÑ‰∏™Á∫øÁ®ãÂÖ±‰∫´Ôºå‰ΩÜÊòØ reference Êú¨Ë∫´Âú® Java Ê†àÁöÑÂ±ÄÈÉ®ÂèòÈáèË°®‰∏≠ÔºåÂÆÉÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑ„ÄÇ Java ÂÜÖÂ≠òÊ®°ÂûãËßÑÂÆö‰∫ÜÊâÄÊúâÁöÑÂèòÈáèÈÉΩÂ≠òÂÇ®Âú®‰∏ªÂÜÖÂ≠ò(Main Memory)‰∏≠(Ê≠§Â§ÑÁöÑ‰∏ªÂÜÖÂ≠ò‰∏é‰ªãÁªçÁâ©ÁêÜÁ°¨‰ª∂Êó∂ÁöÑ‰∏ªÂÜÖÂ≠òÂêçÂ≠ó‰∏ÄÊ†∑Ôºå‰∏§ËÄÖ‰πüÂèØ‰ª•‰∫íÁõ∏Á±ªÊØîÔºå‰ΩÜÊ≠§Â§Ñ‰ªÖÊòØËôöÊãüÊú∫ÂÜÖÂ≠òÁöÑ‰∏ÄÈÉ®ÂàÜ)„ÄÇ ÊØèÊù°Á∫øÁ®ãËøòÊúâËá™Â∑±ÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò(Working MemoryÔºåÂèØ‰∏éÂâçÈù¢ËÆ≤ÁöÑÂ§ÑÁêÜÂô®È´òÈÄüÁºìÂ≠òÁ±ªÊØî)ÔºåÁ∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠‰øùÂ≠ò‰∫ÜË¢´ËØ•Á∫øÁ®ã‰ΩøÁî®Âà∞ÁöÑÂèòÈáèÁöÑ‰∏ªÂÜÖÂ≠òÂâØÊú¨Êã∑Ë¥ù [4] Á∫øÁ®ãÂØπÂèòÈáèÁöÑÊâÄÊúâÊìç‰Ωú(ËØªÂèñ„ÄÅËµãÂÄºÁ≠â)ÈÉΩÂøÖÈ°ªÂú®==Â∑•‰Ωú==ÂÜÖÂ≠ò‰∏≠ËøõË°åÔºåËÄå‰∏çËÉΩÁõ¥Êé•ËØªÂÜô‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑÂèòÈáè„ÄÇ Âπ≤Ê¥ªË¶ÅÂú®Êìç‰ΩúÁ∫øÁ®ã‰∏≠Âπ≤„ÄÇ Ëøô‰∏™ÂØπË±°ÁöÑÂºïÁî®„ÄÅÂØπË±°‰∏≠Êüê‰∏™Âú®Á∫øÁ®ãËÆøÈóÆÂà∞ÁöÑÂ≠óÊÆµÊòØÊúâÂèØËÉΩÂ≠òÂú®Êã∑Ë¥ùÁöÑÔºå‰ΩÜ‰∏ç‰ºöÊúâËôöÊãüÊú∫ÂÆûÁé∞ÊàêÊääÊï¥‰∏™ÂØπË±°Êã∑Ë¥ù A ‰∏ÄÊ¨°„ÄÇ ‰∏çÂêåÁöÑÁ∫øÁ®ã‰πãÈó¥‰πüÊó†Ê≥ïÁõ¥Êé•ËÆøÈóÆÂØπÊñπÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÂèòÈáèÔºåÁ∫øÁ®ãÈó¥ÂèòÈáèÂÄºÁöÑ‰º†ÈÄíÂùáÈúÄË¶ÅÈÄöËøá‰∏ªÂÜÖÂ≠òÊù•ÂÆåÊàê„ÄÇ ÂÜÖÂ≠òÈó¥‰∫§‰∫íÊìç‰ΩúJava ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÂÆö‰πâ‰∫Ü‰ª•‰∏ã 8 ÁßçÊìç‰ΩúÊù•ÂÆåÊàêÔºåËôöÊãüÊú∫ÂÆûÁé∞Êó∂ÂøÖÈ°ª‰øùËØÅ‰∏ãÈù¢ÊèêÂèäÁöÑÊØè‰∏ÄÁßçÊìç‰ΩúÈÉΩÊòØÂéüÂ≠êÁöÑ„ÄÅ‰∏çÂèØÂÜçÂàÜÁöÑ(ÂØπ‰∫é double Âíå long Á±ªÂûãÁöÑÂèòÈáèÊù•ËØ¥Ôºåload„ÄÅstore„ÄÅread Âíå write Êìç‰ΩúÂú®Êüê‰∫õÂπ≥Âè∞‰∏äÂÖÅËÆ∏Êúâ‰æãÂ§ñ„ÄÇ lock„ÄÅunlock read ‰ªé‰∏ªÂ≠òËØªÂèñ load Âä†ËΩΩ use ‰ΩøÁî® assign ÂàÜÈÖç store Â≠òÂÇ® write ÂÜôÂõû‰∏ªÂ≠ò Â¶ÇÊûúË¶ÅÊää‰∏Ä‰∏™ÂèòÈáè‰ªé‰∏ªÂÜÖÂ≠òÂ§çÂà∂Âà∞Â∑•‰ΩúÂÜÖÂ≠òÔºåÈÇ£Â∞±Ë¶ÅÈ°∫Â∫èÂú∞ÊâßË°å read Âíå load Êìç‰ΩúÔºå Â¶ÇÊûúË¶ÅÊääÂèòÈáè‰ªéÂ∑•‰ΩúÂÜÖÂ≠òÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠òÔºåÂ∞±Ë¶ÅÈ°∫Â∫èÂú∞ÊâßË°å store Âíå write Êìç‰Ωú„ÄÇ Ê≥®ÊÑèÔºåJava ÂÜÖÂ≠òÊ®°ÂûãÂè™Ë¶ÅÊ±Ç‰∏äËø∞‰∏§‰∏™Êìç‰ΩúÂøÖÈ°ªÊåâÈ°∫Â∫èÊâßË°åÔºåËÄåÊ≤°Êúâ‰øùËØÅÊòØ==ËøûÁª≠==ÊâßË°å„ÄÇ Java ÂÜÖÂ≠òÊ®°ÂûãËøòËßÑÂÆö‰∫ÜÂú®ÊâßË°å‰∏äËø∞ 8 ÁßçÂü∫Êú¨Êìç‰ΩúÊó∂ÂøÖÈ°ªÊª°Ë∂≥Â¶Ç‰∏ãËßÑÂàôÔºö ‰∏çÂÖÅËÆ∏ read Âíå load„ÄÅstore Âíå write Êìç‰Ωú‰πã‰∏ÄÂçïÁã¨Âá∫Áé∞ÔºåÂç≥‰∏çÂÖÅËÆ∏‰∏Ä‰∏™ÂèòÈáè‰ªé‰∏ªÂÜÖÂ≠òËØªÂèñ‰∫Ü‰ΩÜÂ∑•‰ΩúÂÜÖÂ≠ò‰∏çÊé•ÂèóÔºåÊàñËÄÖ‰ªéÂ∑•‰ΩúÂÜÖÂ≠òÂèëËµ∑ÂõûÂÜô‰∫Ü‰ΩÜ‰∏ªÂÜÖÂ≠ò‰∏çÊé•ÂèóÁöÑÊÉÖÂÜµÂá∫Áé∞„ÄÇ read Âíå load„ÄÅstore Âíå write „ÄÇÂ∑•‰ΩúÂÜÖÂ≠ò‰∏é‰∏ªÂÜÖÂ≠ò‰πãÈó¥ÊúâÊ±ÇÂøÖÂ∫î„ÄÇ ‰∏çÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ã‰∏¢ÂºÉÂÆÉÁöÑÊúÄËøëÁöÑ assign Êìç‰ΩúÔºåÂç≥ÂèòÈáèÂú®Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÊîπÂèò‰∫Ü‰πãÂêéÂøÖÈ°ªÊääËØ•ÂèòÂåñÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò„ÄÇ Êîπ‰∫Ü‰∏ÄÂÆöË¶ÅËÆ©‰∏ªÂÜÖÂ≠òÁü•ÈÅì„ÄÇ ‰∏çÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ãÊó†ÂéüÂõ†Âú∞(Ê≤°ÊúâÂèëÁîüËøá‰ªª‰Ωï assign Êìç‰Ωú)ÊääÊï∞ÊçÆ‰ªéÁ∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠òÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò‰∏≠„ÄÇ Ê≤°ÊîπÂ∞±Âà´ÁûéÊäòËÖæ„ÄÇ ‰∏Ä‰∏™Êñ∞ÁöÑÂèòÈáèÂè™ËÉΩÂú®‰∏ªÂÜÖÂ≠ò‰∏≠„ÄåËØûÁîü„ÄçÔºå‰∏çÂÖÅËÆ∏Âú®Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠Áõ¥Êé•‰ΩøÁî®‰∏Ä‰∏™Êú™Ë¢´ÂàùÂßãÂåñ(load Êàñ assign)ÁöÑÂèòÈáèÔºåÊç¢Âè•ËØùËØ¥ÔºåÂ∞±ÊòØÂØπ‰∏Ä‰∏™ÂèòÈáèÂÆûÊñΩ use„ÄÅstore Êìç‰Ωú‰πãÂâçÔºåÂøÖÈ°ªÂÖàÊâßË°åËøá‰∫Ü assign Âíå load Êìç‰Ωú„ÄÇ ‚Äã ‰∏Ä‰∏™ÂèòÈáèÂú®Âêå‰∏Ä‰∏™Êó∂ÂàªÂè™ÂÖÅËÆ∏‰∏ÄÊù°Á∫øÁ®ãÂØπÂÖ∂ËøõË°å lock Êìç‰ΩúÔºå‰ΩÜ lock Êìç‰ΩúÂèØ‰ª•Ë¢´Âêå‰∏ÄÊù°Á∫øÁ®ãÈáçÂ§çÊâßË°åÂ§öÊ¨°ÔºåÂ§öÊ¨°ÊâßË°å lock ÂêéÔºåÂè™ÊúâÊâßË°åÁõ∏ÂêåÊ¨°Êï∞ÁöÑ unlock Êìç‰ΩúÔºåÂèòÈáèÊâç‰ºöË¢´Ëß£ÈîÅ„ÄÇ ÈîÅ‰∫ÜÂ§öÂ∞ëÊ¨°ÔºåÂºÄÂ§öÂ∞ëÊ¨°„ÄÇ Â¶ÇÊûúÂØπ‰∏Ä‰∏™ÂèòÈáèÊâßË°å lock Êìç‰ΩúÔºåÈÇ£Â∞Ü‰ºöÊ∏ÖÁ©∫Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠Ê≠§ÂèòÈáèÁöÑÂÄºÔºåÂú®ÊâßË°åÂºïÊìé‰ΩøÁî®Ëøô‰∏™ÂèòÈáèÂâçÔºåÈúÄË¶ÅÈáçÊñ∞ÊâßË°å load Êàñ assign Êìç‰ΩúÂàùÂßãÂåñÂèòÈáèÁöÑÂÄº„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™ÂèòÈáè‰∫ãÂÖàÊ≤°ÊúâË¢´ lock Êìç‰ΩúÈîÅÂÆöÔºåÈÇ£Â∞±‰∏çÂÖÅËÆ∏ÂØπÂÆÉÊâßË°å unlock Êìç‰ΩúÔºå‰πü‰∏çÂÖÅËÆ∏Âéª unlock ‰∏Ä‰∏™Ë¢´ÂÖ∂‰ªñÁ∫øÁ®ãÈîÅÂÆö‰ΩèÁöÑÂèòÈáè„ÄÇ Ê≤°ÊúâÈîÅ‰∏çË¶Å‰π±ÂºÄÈîÅ ÂØπ‰∏Ä‰∏™ÂèòÈáèÊâßË°å unlock Êìç‰Ωú‰πãÂâçÔºåÂøÖÈ°ªÂÖàÊääÊ≠§ÂèòÈáèÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò‰∏≠(ÊâßË°å store„ÄÅwrite Êìç‰Ωú)„ÄÇ ÂÅöÂ•ΩÊâãÂ∞æÔºåÂÜçÂºÄÈîÅ„ÄÇ Ëøô 8 ÁßçÂÜÖÂ≠òËÆøÈóÆÊìç‰Ωú‰ª•Âèä‰∏äËø∞ËßÑÂàôÈôêÂÆöÔºåÂÜçÂä†‰∏äÁ®çÂêé‰ªãÁªçÁöÑÂØπ volatile ÁöÑ‰∏Ä‰∫õÁâπÊÆäËßÑÂÆöÔºåÂ∞±Â∑≤ÁªèÂÆåÂÖ®Á°ÆÂÆö‰∫Ü Java Á®ãÂ∫è‰∏≠Âì™‰∫õÂÜÖÂ≠òËÆøÈóÆÊìç‰ΩúÂú®Âπ∂Âèë‰∏ãÊòØÂÆâÂÖ®ÁöÑ„ÄÇ ÂØπ‰∫é volatile ÂûãÂèòÈáèÁöÑÁâπÊÆäËßÑÂàôÂΩì‰∏Ä‰∏™ÂèòÈáèÂÆö‰πâ‰∏∫ volatile ‰πãÂêéÔºåÂÆÉÂ∞ÜÂÖ∑Â§á‰∏§ÁßçÁâπÊÄßÔºå Á¨¨‰∏ÄÊòØ‰øùËØÅÊ≠§ÂèòÈáèÂØπÊâÄÊúâÁ∫øÁ®ãÁöÑÂèØËßÅÊÄßÔºåËøôÈáåÁöÑ„ÄåÂèØËßÅÊÄß„ÄçÊòØÊåáÂΩì‰∏ÄÊù°Á∫øÁ®ã‰øÆÊîπ‰∫ÜËøô‰∏™ÂèòÈáèÁöÑÂÄºÔºåÊñ∞ÂÄºÂØπ‰∫éÂÖ∂‰ªñÁ∫øÁ®ãÊù•ËØ¥ÊòØÂèØ‰ª•Á´ãÂç≥ÂæóÁü•ÁöÑ„ÄÇ ËÄåÊôÆÈÄöÂèòÈáè‰∏çËÉΩÂÅöÂà∞Ëøô‰∏ÄÁÇπÔºåÊôÆÈÄöÂèòÈáèÁöÑÂÄºÂú®Á∫øÁ®ãÈó¥‰º†ÈÄíÂùáÈúÄË¶ÅÈÄöËøá‰∏ªÂÜÖÂ≠òÊù•ÂÆåÊàêÔºå‰æãÂ¶ÇÔºåÁ∫øÁ®ã A ‰øÆÊîπ‰∏Ä‰∏™ÊôÆÈÄöÂèòÈáèÁöÑÂÄºÔºåÁÑ∂ÂêéÂêë‰∏ªÂÜÖÂ≠òËøõË°åÂõûÂÜôÔºåÂè¶Â§ñ‰∏ÄÊù°Á∫øÁ®ã B Âú®Á∫øÁ®ã A ÂõûÂÜôÂÆåÊàê‰∫Ü‰πãÂêéÂÜç‰ªé‰∏ªÂÜÖÂ≠òËøõË°åËØªÂèñÊìç‰ΩúÔºåÊñ∞ÂèòÈáèÂÄºÊâç‰ºöÂØπÁ∫øÁ®ã B ÂèØËßÅ„ÄÇ Á¨¨‰∫å‰∏™ËØ≠‰πâÊòØÁ¶ÅÊ≠¢Êåá‰ª§ÈáçÊéíÂ∫è„ÄÇ ÂèØËßÅÊÄß != Á∫øÁ®ãÂÆâÂÖ® volatile ÂèòÈáèÂú®ÂêÑ‰∏™Á∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠‰∏çÂ≠òÂú®‰∏ÄËá¥ÊÄßÈóÆÈ¢ò(Âú®ÂêÑ‰∏™Á∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠Ôºåvolatile ÂèòÈáè‰πüÂèØ‰ª•Â≠òÂú®‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºå‰ΩÜÁî±‰∫éÊØèÊ¨°‰ΩøÁî®‰πãÂâçÈÉΩË¶ÅÂÖàÂà∑Êñ∞ÔºåÊâßË°åÂºïÊìéÁúã‰∏çÂà∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºåÂõ†Ê≠§ÂèØ‰ª•ËÆ§‰∏∫‰∏çÂ≠òÂú®‰∏ÄËá¥ÊÄßÈóÆÈ¢ò)Ôºå‰ΩÜÊòØ Java ÈáåÈù¢ÁöÑ==ËøêÁÆóÂπ∂ÈùûÂéüÂ≠êÊìç‰Ωú==ÔºåÂØºËá¥ volatile ÂèòÈáèÁöÑËøêÁÆóÂú®Âπ∂Âèë‰∏ã‰∏ÄÊ†∑ÊòØ‰∏çÂÆâÂÖ®ÁöÑÔºå ÈùûÂéüÂ≠êÊìç‰Ωú‰ºöÂØºËá¥ËØªÂèñÊï∞ÊçÆÂêéÔºåÂ§ö‰∏™Á∫øÁ®ãÂπ∂Ë°åÊâÄËøõË°åÊìç‰ΩúÁöÑÈÉΩÊòØÊóßÂÄº„ÄÇÈÇ£‰πàÂä†ËΩΩÂà∞‰∏ªÂÜÖÂ≠òÁöÑÂÄº‰πüÂ∞±‰∏çÊòØÊúÄÊñ∞ÁöÑ‰∫Ü„ÄÇ ÈùûÂéüÂ≠êÊìç‰Ωú ÊâßË°åËøáÁ®ã‰∏≠ÊòØÂèØ‰ª•ÊöÇÂÅúÁöÑÔºåÊöÇÂÅúÁöÑÈÇ£‰∏ÄÊÆµÊó∂Èó¥ÈáåÂÖ∂‰ªñÁ∫øÁ®ãÂèØËÉΩ‰øÆÊîπ‰∫ÜËøô‰∏™ÂèòÈáèÁöÑÂÄº„ÄÇ Áî±‰∫é volatile ÂèòÈáèÂè™ËÉΩ‰øùËØÅÂèØËßÅÊÄßÔºåÂú®‰∏çÁ¨¶Âêà‰ª•‰∏ã‰∏§Êù°ËßÑÂàôÁöÑËøêÁÆóÂú∫ÊôØ‰∏≠ÔºåÊàë‰ª¨‰ªçÁÑ∂Ë¶ÅÈÄöËøáÂä†ÈîÅ(‰ΩøÁî® synchronized Êàñ java.util.concurrent ‰∏≠ÁöÑÂéüÂ≠êÁ±ª)Êù•‰øùËØÅÂéüÂ≠êÊÄß„ÄÇ ËøêÁÆóÁªìÊûúÂπ∂‰∏ç‰æùËµñÂèòÈáèÁöÑÂΩìÂâçÂÄºÔºåÊàñËÄÖËÉΩÂ§üÁ°Æ‰øùÂè™ÊúâÂçï‰∏ÄÁöÑÁ∫øÁ®ã‰øÆÊîπÂèòÈáèÁöÑÂÄº„ÄÇ ÂèòÈáè‰∏çÈúÄË¶Å‰∏éÂÖ∂‰ªñÁöÑÁä∂ÊÄÅÂèòÈáèÂÖ±ÂêåÂèÇ‰∏é‰∏çÂèòÁ∫¶Êùü volatile ÊÄßËÉΩÊüê‰∫õÊÉÖÂÜµ‰∏ãÔºåvolatile ÁöÑÂêåÊ≠•Êú∫Âà∂ÁöÑÊÄßËÉΩÁ°ÆÂÆûË¶Å‰ºò‰∫éÈîÅ(‰ΩøÁî® synchronized ÂÖ≥ÈîÆÂ≠óÊàñ java.util.concurrent ÂåÖÈáåÈù¢ÁöÑÈîÅ)Ôºå‰ΩÜÊòØÁî±‰∫éËôöÊãüÊú∫ÂØπÈîÅÂÆûË°åÁöÑËÆ∏Â§öÊ∂àÈô§Âíå‰ºòÂåñÔºå‰ΩøÂæóÊàë‰ª¨ÂæàÈöæÈáèÂåñÂú∞ËÆ§‰∏∫ volatile Â∞±‰ºöÊØî synchronized Âø´Â§öÂ∞ë„ÄÇ volatile ÂèòÈáèËØªÊìç‰ΩúÁöÑÊÄßËÉΩÊ∂àËÄó‰∏éÊôÆÈÄöÂèòÈáèÂá†‰πéÊ≤°Êúâ‰ªÄ‰πàÂ∑ÆÂà´Ôºå‰ΩÜÊòØÂÜôÊìç‰ΩúÂàôÂèØËÉΩ‰ºöÊÖ¢‰∏Ä‰∫õÔºåÂõ†‰∏∫ÂÆÉÈúÄË¶ÅÂú®Êú¨Âú∞‰ª£Á†Å‰∏≠ÊèíÂÖ•ËÆ∏Â§öÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§Êù•‰øùËØÅÂ§ÑÁêÜÂô®‰∏çÂèëÁîü‰π±Â∫èÊâßË°å„ÄÇ Â§ßÂ§öÊï∞Âú∫ÊôØ‰∏ã volatile ÁöÑÊÄªÂºÄÈîÄ‰ªçÁÑ∂Ë¶ÅÊØîÈîÅ‰ΩéÔºåÊàë‰ª¨Âú® volatile ‰∏éÈîÅ‰πã‰∏≠ÈÄâÊã©ÁöÑÂîØ‰∏Ä‰æùÊçÆ‰ªÖ‰ªÖÊòØ volatile ÁöÑËØ≠‰πâËÉΩÂê¶Êª°Ë∂≥‰ΩøÁî®Âú∫ÊôØÁöÑÈúÄÊ±Ç„ÄÇ ÂÜÖÂ≠òÂ±èÈöúÂÜÖÂ≠òÂ±èÈöúÔºàMemory BarrierÔºåÊàñÊúâÊó∂Âè´ÂÅöÂÜÖÂ≠òÊ†ÖÊ†èÔºåMemory FenceÔºâÊòØ‰∏ÄÁßç CPU Êåá‰ª§ÔºåÁî®‰∫éÊéßÂà∂ÁâπÂÆöÊù°‰ª∂‰∏ãÁöÑÈáçÊéíÂ∫èÂíåÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇJava ÁºñËØëÂô®‰πü‰ºöÊ†πÊçÆÂÜÖÂ≠òÂ±èÈöúÁöÑËßÑÂàôÁ¶ÅÊ≠¢ÈáçÊéíÂ∫è„ÄÇÂÜÖÂ≠òÂ±èÈöúÂèØ‰ª•Ë¢´ÂàÜ‰∏∫‰ª•‰∏ã 4 ÁßçÁ±ªÂûã LoadLoad Â±èÈöúÔºöÂØπ‰∫éËøôÊ†∑ÁöÑËØ≠Âè• Load1; LoadLoad Â±èÈöú; Load2ÔºåÂú® Load2 ÂèäÂêéÁª≠ËØªÂèñÊìç‰ΩúË¶ÅËØªÂèñÁöÑÊï∞ÊçÆË¢´ËÆøÈóÆÂâçÔºå‰øùËØÅ Load1 Ë¶ÅËØªÂèñÁöÑÊï∞ÊçÆË¢´ËØªÂèñÂÆåÊØï„ÄÇ StoreStore Â±èÈöúÔºöÂØπ‰∫éËøôÊ†∑ÁöÑËØ≠Âè• Store1; StoreStore Â±èÈöú; Store2ÔºåÂú® Store2 ÂèäÂêéÁª≠ÂÜôÂÖ•Êìç‰ΩúÊâßË°åÂâçÔºå‰øùËØÅ Store1 ÁöÑÂÜôÂÖ•Êìç‰ΩúÂØπÂÖ∂ÂÆÉÂ§ÑÁêÜÂô®ÂèØËßÅ„ÄÇ LoadStore Â±èÈöúÔºöÂØπ‰∫éËøôÊ†∑ÁöÑËØ≠Âè• Load1; LoadStore Â±èÈöú; Store2ÔºåÂú® Store2 ÂèäÂêéÁª≠ÂÜôÂÖ•Êìç‰ΩúË¢´Âà∑Âá∫ÂâçÔºå‰øùËØÅ Load1 Ë¶ÅËØªÂèñÁöÑÊï∞ÊçÆË¢´ËØªÂèñÂÆåÊØï„ÄÇ StoreLoad Â±èÈöúÔºöÂØπ‰∫éËøôÊ†∑ÁöÑËØ≠Âè• Store1; StoreLoad Â±èÈöú; Load2ÔºåÂú® Load2 ÂèäÂêéÁª≠ÊâÄÊúâËØªÂèñÊìç‰ΩúÊâßË°åÂâçÔºå‰øùËØÅ Store1 ÁöÑÂÜôÂÖ•ÂØπÊâÄÊúâÂ§ÑÁêÜÂô®ÂèØËßÅ„ÄÇÂÆÉÁöÑÂºÄÈîÄÊòØÂõõÁßçÂ±èÈöú‰∏≠ÊúÄÂ§ßÁöÑ„ÄÇÂú®Â§ßÂ§öÊï∞Â§ÑÁêÜÂô®ÁöÑÂÆûÁé∞‰∏≠ÔºåËøô‰∏™Â±èÈöúÊòØ‰∏™‰∏áËÉΩÂ±èÈöúÔºåÂÖºÂÖ∑ÂÖ∂ÂÆÉ‰∏âÁßçÂÜÖÂ≠òÂ±èÈöúÁöÑÂäüËÉΩ„ÄÇ ÊúâÁöÑÂ§ÑÁêÜÂô®ÁöÑÈáçÊéíÂ∫èËßÑÂàôËæÉ‰∏•ÔºåÊó†ÈúÄÂÜÖÂ≠òÂ±èÈöú‰πüËÉΩÂæàÂ•ΩÁöÑÂ∑•‰ΩúÔºåJava ÁºñËØëÂô®‰ºöÂú®ËøôÁßçÊÉÖÂÜµ‰∏ã‰∏çÊîæÁΩÆÂÜÖÂ≠òÂ±èÈöú„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞ JSR-133 ÁöÑËßÑÂÆöÔºåJava ÁºñËØëÂô®‰ºöËøôÊ†∑‰ΩøÁî®ÂÜÖÂ≠òÂ±èÈöúÔºö ÂØπ‰∫é long Âíå double ÂûãÂèòÈáèÁöÑÁâπÊÆäËßÑÂàôÂÖÅËÆ∏ËôöÊãüÊú∫ÂÆûÁé∞ÈÄâÊã©ÂèØ‰ª•‰∏ç‰øùËØÅ 64 ‰ΩçÊï∞ÊçÆÁ±ªÂûãÁöÑ load„ÄÅstore„ÄÅread Âíå write Ëøô 4 ‰∏™Êìç‰ΩúÁöÑÂéüÂ≠êÊÄßÔºåËøôÁÇπÂ∞±ÊòØÊâÄË∞ìÁöÑ long Âíå double ÁöÑÈùûÂéüÂ≠êÊÄßÂçèÂÆö(Nonatomic Treatment ofdouble and long Variables)„ÄÇ Java ÂÜÖÂ≠òÊ®°Âûã„ÄåÂº∫ÁÉàÂª∫ËÆÆ„ÄçËôöÊãüÊú∫ÊääËøô‰∫õÊìç‰ΩúÂÆûÁé∞‰∏∫ÂÖ∑ÊúâÂéüÂ≠êÊÄßÁöÑÊìç‰Ωú„ÄÇÁõÆÂâçÂêÑÁßçÂïÜÁî®ËôöÊãüÊú∫‰πüÈÉΩÊòØÂ∞ÜÂÆÉ‰ª¨ÂÆûÁé∞‰∏∫ÂéüÂ≠êÊìç‰ΩúÔºåÂõ†Ê≠§Êàë‰ª¨Âú®ÁºñÂÜô‰ª£Á†ÅÊó∂==‰∏ÄËà¨‰∏çÈúÄË¶Å==ÊääÁî®Âà∞ÁöÑ long Âíå double ÂèòÈáè‰∏ìÈó®Â£∞Êòé‰∏∫ volatile„ÄÇ ÂéüÂ≠êÊÄß„ÄÅÂèØËßÅÊÄß‰∏éÊúâÂ∫èÊÄßÂéüÂ≠êÊÄßÂéüÂ≠êÊÄßÊòØÊåá‰∏Ä‰∏™Êìç‰ΩúÊòØ‰∏çÂèØ‰∏≠Êñ≠ÁöÑ„ÄÇÂç≥‰ΩøÊòØÂú®Â§ö‰∏™Á∫øÁ®ã‰∏ÄËµ∑ÊâßË°åÁöÑÊó∂ÂÄôÔºå‰∏Ä‰∏™Êìç‰Ωú‰∏ÄÊó¶ÂºÄÂßãÔºåÂ∞±‰∏ç‰ºöË¢´ÂÖ∂ÂÆÉÁ∫øÁ®ãÂπ≤Êâ∞„ÄÇ Áî± Java ÂÜÖÂ≠òÊ®°ÂûãÁõ¥Êé•‰øùËØÅÁöÑÂéüÂ≠êÊÄßÂèòÈáèÊìç‰ΩúÂåÖÊã¨ read„ÄÅload„ÄÅassign„ÄÅuse„ÄÅstore Âíå writeÔºåÊàë‰ª¨Â§ßËá¥ÂèØ‰ª•ËÆ§‰∏∫Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÁöÑËÆøÈóÆËØªÂÜôÊòØÂÖ∑Â§áÂéüÂ≠êÊÄßÁöÑ(‰æãÂ§ñÂ∞±ÊòØ long Âíå double ÁöÑÈùûÂéüÂ≠êÊÄßÂçèÂÆö)„ÄÇ Â∞ΩÁÆ°ËôöÊãüÊú∫Êú™Êää lock Âíå unlock Êìç‰ΩúÁõ¥Êé•ÂºÄÊîæÁªôÁî®Êà∑‰ΩøÁî®Ôºå‰ΩÜÊòØÂç¥Êèê‰æõ‰∫ÜÊõ¥È´òÂ±ÇÊ¨°ÁöÑÂ≠óËäÇÁ†ÅÊåá‰ª§monitorenter Âíå monitorexit Êù•ÈöêÂºèÂú∞‰ΩøÁî®Ëøô‰∏§‰∏™Êìç‰ΩúÔºåËøô‰∏§‰∏™Â≠óËäÇÁ†ÅÊåá‰ª§ÂèçÊò†Âà∞ Java ‰ª£Á†Å‰∏≠Â∞±ÊòØÂêåÊ≠•Âùó‚Äî‚Äîsynchronized ÂÖ≥ÈîÆÂ≠óÔºåÂõ†Ê≠§Âú® synchronized Âùó‰πãÈó¥ÁöÑÊìç‰Ωú‰πüÂÖ∑Â§áÂéüÂ≠êÊÄß„ÄÇ ÂèØËßÅÊÄßÂèØËßÅÊÄß(Visibility)ÔºöÂèØËßÅÊÄßÊòØÊåáÂΩì‰∏Ä‰∏™Á∫øÁ®ã‰øÆÊîπ‰∫ÜÂÖ±‰∫´ÂèòÈáèÁöÑÂÄºÔºåÂÖ∂‰ªñÁ∫øÁ®ãËÉΩÂ§üÁ´ãÂç≥ÂæóÁü•Ëøô‰∏™‰øÆÊîπ„ÄÇ Èô§‰∫Ü volatile ‰ª•Â§ñÔºåJava ËøòÊúâ‰∏§‰∏™ÂÖ≥ÈîÆÂ≠óËÉΩÂÆûÁé∞ÂèØËßÅÊÄßÔºåÂç≥ synchronized Âíå final„ÄÇ ÂêåÊ≠•ÂùóÁöÑÂèØËßÅÊÄßÊòØÁî±„ÄåÂØπ‰∏Ä‰∏™ÂèòÈáèÊâßË°å unlock Êìç‰Ωú‰πãÂâçÔºåÂøÖÈ°ªÂÖàÊääÊ≠§ÂèòÈáèÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò‰∏≠(ÊâßË°å store„ÄÅwrite Êìç‰Ωú)„ÄçËøôÊù°ËßÑÂàôËé∑ÂæóÁöÑÔºå final ÂÖ≥ÈîÆÂ≠óÁöÑÂèØËßÅÊÄßÊòØÊåáÔºö‰øùËØÅ‰∏Ä‰∏™ÂØπË±°ÁöÑÊûÑÂª∫ÊñπÊ≥ïÁªìÊùüÂâçÔºåÊâÄÊúâ final ÊàêÂëòÂèòÈáèÈÉΩÂøÖÈ°ªÂÆåÊàêÂàùÂßãÂåñÔºàÂâçÊèêÊòØÊ≤°Êúâ this ÂºïÁî®Ê∫¢Âá∫Ôºâ„ÄÇÂú®ÊûÑÈÄ†Âô®‰∏≠‰∏ÄÊó¶ÂàùÂßãÂåñÂÆåÊàêÔºåÂπ∂‰∏îÊûÑÈÄ†Âô®Ê≤°ÊúâÊää„Äåthis„ÄçÁöÑÂºïÁî®‰º†ÈÄíÂá∫ÂéªÔºåÈÇ£Âú®ÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠Â∞±ËÉΩÁúãËßÅ final Â≠óÊÆµÁöÑÂÄº„ÄÇ this ÂºïÁî®ÈÄÉÈÄ∏ ÊòØÊåáÂú®ÊûÑÈÄ†ÂáΩÊï∞ËøîÂõû‰πãÂâçÂÖ∂‰ªñÁ∫øÁ®ãÂ∞±ÊåÅÊúâËØ•ÂØπË±°ÁöÑÂºïÁî®„ÄÇË∞ÉÁî®Â∞öÊú™ÊûÑÈÄ†ÂÆåÂÖ®ÁöÑÂØπË±°ÁöÑÊñπÊ≥ïÂèØËÉΩÂºïÂèë‰ª§‰∫∫ÁñëÊÉëÁöÑÈîôËØØ, Âõ†Ê≠§Â∫îËØ•ÈÅøÂÖç this ÈÄÉÈÄ∏ÁöÑÂèëÁîü„ÄÇ ‰æãÂ≠êÔºöÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÂêØÂä®Á∫øÁ®ã / Ê≥®ÂÜåÁõëÂê¨Âô®/ ÂàõÂª∫ÂåøÂêçÂÜÖÈÉ®Á±ª„ÄÇ ÊúâÂ∫èÊÄßÂ¶ÇÊûúÂú®Êú¨Á∫øÁ®ãÂÜÖËßÇÂØüÔºåÊâÄÊúâÁöÑÊìç‰ΩúÈÉΩÊòØÊúâÂ∫èÁöÑÔºõÂ¶ÇÊûúÂú®‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ËßÇÂØüÂè¶‰∏Ä‰∏™Á∫øÁ®ãÔºåÊâÄÊúâÁöÑÊìç‰ΩúÈÉΩÊòØÊó†Â∫èÁöÑ„ÄÇÂâçÂçäÂè•ÊòØÊåá„ÄåÁ∫øÁ®ãÂÜÖË°®Áé∞‰∏∫‰∏≤Ë°åÁöÑËØ≠‰πâ„Äç(Within-Thread As-If-Serial Semantics)ÔºåÂêéÂçäÂè•ÊòØÊåá„ÄåÊåá‰ª§ÈáçÊéíÂ∫è„ÄçÁé∞Ë±°Âíå„ÄåÂ∑•‰ΩúÂÜÖÂ≠ò‰∏é‰∏ªÂÜÖÂ≠òÂêåÊ≠•Âª∂Ëøü„ÄçÁé∞Ë±°„ÄÇ ÂÖàË°åÂèëÁîüÂéüÂàôÂÖàË°åÂèëÁîüÂéüÂàôÊòØÂà§Êñ≠Êï∞ÊçÆÊòØÂê¶Â≠òÂú®Á´û‰∫â„ÄÅÁ∫øÁ®ãÊòØÂê¶ÂÆâÂÖ®ÁöÑ‰∏ªË¶Å‰æùÊçÆ„ÄÇ ÂÖàË°åÂèëÁîüÊòØ Java ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÂÆö‰πâÁöÑ‰∏§È°πÊìç‰Ωú‰πãÈó¥ÁöÑÂÅèÂ∫èÂÖ≥Á≥ª„ÄÇÊâÄË∞ìÂÅèÂ∫èÂÖ≥Á≥ªÂèØ‰ª•ËøôÊ†∑ÁêÜËß£ÔºöÂØπ‰∫é‰∏§‰∏™Êìç‰ΩúAÂíåBÔºåËøô‰∏§‰∏™Êìç‰ΩúÂèØ‰ª•Âú®‰∏çÂêåÁöÑÁ∫øÁ®ã‰∏≠ÊâßË°å„ÄÇÂ¶ÇÊûúA Happens-Before BÔºåÈÇ£‰πàÂèØ‰ª•‰øùËØÅÔºåÂΩìAÊìç‰ΩúÊâßË°åÂÆåÂêéÔºåAÊìç‰ΩúÁöÑÊâßË°åÁªìÊûúÂØπBÊìç‰ΩúÊòØÂèØËßÅÁöÑ„ÄÇ 123456//‰ª•‰∏ãÊìç‰ΩúÂú®Á∫øÁ®ã A ‰∏≠ÊâßË°åi=1Ôºõ//‰ª•‰∏ãÊìç‰ΩúÂú®Á∫øÁ®ã B ‰∏≠ÊâßË°åj=iÔºõ//‰ª•‰∏ãÊìç‰ΩúÂú®Á∫øÁ®ã C ‰∏≠ÊâßË°åi=2Ôºõ ÂÅáËÆæ A B C ‰πãÈó¥Êª°Ë∂≥ Happens-Before Êù°‰ª∂Ôºå‰∏î A Happens-Before B Happens-Before CÔºåÈÇ£‰πàÊâßË°åÁªìÊûúÂ∞±ÊòØ j = 1; i = 2; Ëøô‰∫õÂÖàË°åÂèëÁîüÂÖ≥Á≥ªÊó†È°ª‰ªª‰ΩïÂêåÊ≠•Âô®ÂçèÂä©Â∞±Â∑≤ÁªèÂ≠òÂú®ÔºåÂèØ‰ª•Âú®ÁºñÁ†Å‰∏≠Áõ¥Êé•‰ΩøÁî®„ÄÇÂ¶ÇÊûú‰∏§‰∏™Êìç‰Ωú‰πãÈó¥ÁöÑÂÖ≥Á≥ª‰∏çÂú®Ê≠§ÂàóÔºåÂπ∂‰∏îÊó†Ê≥ï‰ªé‰∏ãÂàóËßÑÂàôÊé®ÂØºÂá∫Êù•ÁöÑËØùÔºåÂÆÉ‰ª¨Â∞±Ê≤°ÊúâÈ°∫Â∫èÊÄß‰øùÈöúÔºåËôöÊãüÊú∫ÂèØ‰ª•ÂØπÂÆÉ‰ª¨ÈöèÊÑèÂú∞ËøõË°åÈáçÊéíÂ∫è„ÄÇ Á®ãÂ∫èÊ¨°Â∫èËßÑÂàô(Program Order Rule)ÔºöÂú®‰∏Ä‰∏™Á∫øÁ®ãÂÜÖÔºåÊåâÁÖßÁ®ãÂ∫è‰ª£Á†ÅÈ°∫Â∫èÔºå‰π¶ÂÜôÂú®ÂâçÈù¢ÁöÑÊìç‰ΩúÂÖàË°åÂèëÁîü‰∫é‰π¶ÂÜôÂú®ÂêéÈù¢ÁöÑÊìç‰Ωú„ÄÇÂáÜÁ°ÆÂú∞ËØ¥ÔºåÂ∫îËØ•ÊòØÊéßÂà∂ÊµÅÈ°∫Â∫èËÄå‰∏çÊòØÁ®ãÂ∫è‰ª£Á†ÅÈ°∫Â∫èÔºåÂõ†‰∏∫Ë¶ÅËÄÉËôëÂàÜÊîØ„ÄÅÂæ™ÁéØÁ≠âÁªìÊûÑ„ÄÇ ÁÆ°Á®ãÈîÅÂÆöËßÑÂàô(Monitor Lock Rule)Ôºö‰∏Ä‰∏™ unlock Êìç‰ΩúÂÖàË°åÂèëÁîü‰∫éÂêéÈù¢ÂØπÂêå‰∏Ä‰∏™ÈîÅÁöÑ lockÊìç‰Ωú„ÄÇËøôÈáåÂøÖÈ°ªÂº∫Ë∞ÉÁöÑÊòØÂêå‰∏Ä‰∏™ÈîÅÔºåËÄå„ÄåÂêéÈù¢„ÄçÊòØÊåáÊó∂Èó¥‰∏äÁöÑÂÖàÂêéÈ°∫Â∫è„ÄÇ volatile ÂèòÈáèËßÑÂàô(Volatile Variable Rule)ÔºöÂØπ‰∏Ä‰∏™ volatile ÂèòÈáèÁöÑÂÜôÊìç‰ΩúÂÖàË°åÂèëÁîü‰∫éÂêéÈù¢ÂØπËøô‰∏™ÂèòÈáèÁöÑËØªÊìç‰ΩúÔºåËøôÈáåÁöÑ„ÄåÂêéÈù¢„ÄçÂêåÊ†∑ÊòØÊåáÊó∂Èó¥‰∏äÁöÑÂÖàÂêéÈ°∫Â∫è„ÄÇ Á∫øÁ®ãÂêØÂä®ËßÑÂàô(Thread Start Rule)ÔºöThread ÂØπË±°ÁöÑ start()ÊñπÊ≥ïÂÖàË°åÂèëÁîü‰∫éÊ≠§Á∫øÁ®ãÁöÑÊØè‰∏Ä‰∏™Âä®‰Ωú„ÄÇ Á∫øÁ®ãÁªàÊ≠¢ËßÑÂàô(Thread Termination Rule)ÔºöÁ∫øÁ®ã‰∏≠ÁöÑÊâÄÊúâÊìç‰ΩúÂøÖÈ°ªÂú®ÂÖ∂‰ªñÁ∫øÁ®ãÊ£ÄÊµãÂà∞ËØ•Á∫øÁ®ãÂ∑≤ÁªèÁªìÊùü‰πãÂâçÂÆåÊàêÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá Thread.join()ÊñπÊ≥ïÁªìÊùü„ÄÅThread.isAlive()ÁöÑËøîÂõûÂÄºÁ≠âÊâãÊÆµÊ£ÄÊµãÂà∞Á∫øÁ®ãÂ∑≤ÁªèÁªàÊ≠¢ÊâßË°å„ÄÇ Á∫øÁ®ã‰∏≠Êñ≠ËßÑÂàô(Thread Interruption Rule)ÔºöÂØπÁ∫øÁ®ã interrupt()ÊñπÊ≥ïÁöÑË∞ÉÁî®ÂÖàË°åÂèëÁîü‰∫éË¢´‰∏≠Êñ≠Á∫øÁ®ãÁöÑ‰ª£Á†ÅÊ£ÄÊµãÂà∞‰∏≠Êñ≠‰∫ã‰ª∂ÁöÑÂèëÁîüÔºåÂèØ‰ª•ÈÄöËøá Thread.interrupted()ÊñπÊ≥ïÊ£ÄÊµãÂà∞ÊòØÂê¶Êúâ‰∏≠Êñ≠ÂèëÁîü„ÄÇ ÂØπË±°ÁªàÁªìËßÑÂàô(Finalizer Rule)Ôºö‰∏Ä‰∏™ÂØπË±°ÁöÑÂàùÂßãÂåñÂÆåÊàê(ÊûÑÈÄ†ÂáΩÊï∞ÊâßË°åÁªìÊùü)ÂÖàË°åÂèëÁîü‰∫éÂÆÉÁöÑ finalize()ÊñπÊ≥ïÁöÑÂºÄÂßã„ÄÇ ‰º†ÈÄíÊÄß(Transitivity)ÔºöÂ¶ÇÊûúÊìç‰Ωú A ÂÖàË°åÂèëÁîü‰∫éÊìç‰Ωú BÔºåÊìç‰Ωú B ÂÖàË°åÂèëÁîü‰∫éÊìç‰Ωú CÔºåÈÇ£Â∞±ÂèØ‰ª•ÂæóÂá∫Êìç‰Ωú A ÂÖàË°åÂèëÁîü‰∫éÊìç‰Ωú C ÁöÑÁªìËÆ∫„ÄÇ Java Êó†ÈúÄ‰ªª‰ΩïÂêåÊ≠•ÊâãÊÆµÂ∞±ËÉΩÊàêÁ´ãÁöÑÂÖàË°åÂèëÁîüËßÑÂàôÂ∞±‰ª•‰∏ä 8 ÁÇπ„ÄÇÁúã‰∏äÂéªÊúâ‰∫õÊäΩË±°ÔºåÊÉ≥Ë¶ÅËøõ‰∏ÄÊ≠•‰∫ÜËß£ÁöÑÂêåÂ≠¶ÂèØ‰ª•ÂèÇËÄÉ‰∏ãËøôÁØáÊñáÁ´† ‰ªéJavaÂ§öÁ∫øÁ®ãÂèØËßÅÊÄßË∞àHappens-BeforeÂéüÂàô ==Êó∂Èó¥ÂÖàÂêéÈ°∫Â∫è‰∏éÂÖàË°åÂèëÁîüÂéüÂàô‰πãÈó¥Âü∫Êú¨Ê≤°ÊúâÂ§™Â§ßÁöÑÂÖ≥Á≥ª==ÔºåÊâÄ‰ª•Êàë‰ª¨Ë°°ÈáèÂπ∂ÂèëÂÆâÂÖ®ÈóÆÈ¢òÁöÑÊó∂ÂÄô==‰∏çË¶ÅÂèóÂà∞Êó∂Èó¥È°∫Â∫èÁöÑÂπ≤Êâ∞Ôºå‰∏ÄÂàáÂøÖÈ°ª‰ª•ÂÖàË°åÂèëÁîüÂéüÂàô‰∏∫ÂáÜ==„ÄÇ ËøôÂè•ËØùÂ∫îËØ•Â¶Ç‰ΩïÁêÜËß£Âë¢Ôºü ËÄÉËôëËøôÊ†∑‰∏Ä‰∏™Âú∫ÊôØÔºö 123456789private int value = 0;//Á∫øÁ®ã A ÂÖàÔºàÊó∂Èó¥‰∏äÔºâË∞ÉÁî®‰∫Ü getValue ÊñπÊ≥ïpublic int getValue() &#123; return value;&#125;//‰πãÂêéÔºàÊó∂Èó¥‰∏äÔºâÁ∫øÁ®ã B Ë∞ÉÁî®‰∫Ü setValue(2) ÊñπÊ≥ïpublic void setValue(int value) &#123; this.value = value;&#125; ‰ΩÜÊòØÁ∫øÁ®ã A ÁöÑ getValue Ëé∑ÂèñÁöÑÁªìÊûúÊòØ‰ªÄ‰πàÂë¢ÔºüÂèØËÉΩÊòØ 0 Ôºå‰πüÂèØËÉΩÊòØ 2„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÊ≤°ÊúâËøõË°åÂêåÊ≠•Â§ÑÁêÜÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏çÂêåÁ∫øÁ®ãÂØπÂú®Êó∂Èó¥‰∏äÂÖàÂêéÂØπË∞ÉÁî®ÂØπÊüê‰∏™ÂÖ±‰∫´ÂèòÈáèÁöÑÊìç‰ΩúÔºåÂπ∂‰∏çËÉΩ‰øùËØÅÂÆÉ‰ª¨ÁöÑÁªìÊûúÊòØÊ†πÊçÆÂÆÉ‰ª¨Âú®Êó∂Èó¥‰∏äË∞ÉÁî®È°∫Â∫èÁ°ÆÂÆöÁöÑ„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂú®‰∏çÂêåÁ∫øÁ®ã‰πãÈó¥Ôºå„ÄåÊó∂Èó¥‰∏äÁöÑÂÖàË∞ÉÁî®„ÄçÂπ∂‰∏ç‰ª£Ë°®„ÄåÂÖàË°åÂèëÁîü„Äç„ÄÇË¶ÅËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÂèØ‰ª•Áªô getValue Âíå setValue ÊñπÊ≥ïÈÉΩÂÆö‰πâ‰∏∫ synchronized ÁöÑÔºåÂõ†‰∏∫ËøôÊ†∑Â∞±ÂèØ‰ª•Â•óÁî®„ÄåÁÆ°Á®ãÈîÅÂÆöÂéüÂàô„Äç‰∫Ü„ÄÇÊàñËÄÖÂ∞Ü value ÂÆö‰πâ‰∫Ü volatile ÂèòÈáèÔºåÂõ†‰∏∫ setValue ÊñπÊ≥ïÂØπ value ÁöÑ‰øÆÊîπ‰∏ç‰æùËµñ value ÁöÑÂéüÂÄºÔºåÊª°Ë∂≥ volatile ÂÖ≥ÈîÆÂ≠ó‰ΩøÁî®Âú∫ÊôØÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Â•óÁî® volatile ÂèòÈáèËßÑÂàôÊù•ÂÆûÁé∞ÂÖàË°åÂèëÁîüËßÑÂàô‰∫Ü„ÄÇ ÈÄöËøá‰∏äÈù¢ÁöÑËÆ®ËÆ∫ÔºåÊàë‰ª¨ÂèØ‰ª•ÂæóÂá∫ÁªìËÆ∫Ôºö‰∏Ä‰∏™Êìç‰Ωú„ÄåÊó∂Èó¥‰∏äÁöÑÂÖàÂèëÁîü„Äç‰∏ç‰ª£Ë°®Ëøô‰∏™Êìç‰Ωú‰ºö‰ºöÊòØ„ÄåÂÖàË°åÂèëÁîü„Äç„ÄÇÈÇ£‰πà‰∏Ä‰∏™Êìç‰Ωú„ÄåÂÖàË°åÂèëÁîü„ÄçÊòØÂê¶ËÉΩÊé®ÂØºÂá∫Ëøô‰∏™Êìç‰ΩúÂøÖÂÆöÊòØ„ÄåÊó∂Èó¥‰∏äÂÖàÂèëÁîü„ÄçÂë¢ÔºüËøô‰∏™Êé®ËÆ∫‰πüÊòØ‰∏çÊàêÁ´ãÁöÑÔºå‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑÊ†óÂ≠êÂ∞±ÊòØ„ÄåÊåá‰ª§ÈáçÊéíÂ∫è„Äç 12int i = 2;int j = 1; ÊåâÁÖßÁ®ãÂ∫èÊ¨°Â∫èËßÑÂàôÔºåint i = 2; ÁöÑÊìç‰ΩúÂÖàË°åÂèëÁîü‰∏é int j = 1;,‰ΩÜÊòØ int j = 1; ÂÆåÂÖ®ÂèØËÉΩÂÖàÊâßË°åÔºåËøôÂπ∂‰∏çÂΩ±ÂìçÂÖàË°åÂèëÁîüÂéüÂàôÁöÑÊ≠£Á°ÆÊÄßÔºåÂõ†‰∏∫Âú®Âêå‰∏ÄÊù°Á∫øÁ®ã‰∏≠Êó†Ê≥ïÊÑüÁü•Âà∞ËøôÁÇπ„ÄÇ ÂÖàË°åÂèëÁîüÂéüÂàôÁöÑÁúüÊ≠£ÊÑè‰πâËØ•ÊÆµÂÜÖÂÆπÂèÇËÄÉËá™‰ªéJavaÂ§öÁ∫øÁ®ãÂèØËßÅÊÄßË∞àHappens-BeforeÂéüÂàô ‰ªé‰∏äÈù¢ÁöÑÂàÜÊûê‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåHappens-BeforeÂéüÂàôËá¥Âäõ‰∫éËß£ÂÜ≥ÂèòÈáèÈó¥ÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØÂÆÉÊòØÂ¶Ç‰ΩïËß£ÂÜ≥ÁöÑÂë¢Ôºü ÂØºËá¥Â§öÁ∫øÁ®ãÈó¥ÂèòÈáèÈó¥ÂèØËßÅÊÄßÈóÆÈ¢òÁöÑÊ†πÊ∫êÂú®‰∫é CPU ÁºìÂ≠ò‰ª•ÂèäÊåá‰ª§ÈáçÊéíÂ∫è„ÄÇÈÇ£‰πàÔºåË¶ÅËß£ÂÜ≥Ëøô‰∏™ÂèØËßÅÊÄßÈóÆÈ¢òÔºå‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁ≤óÊö¥ÁöÑÊñπÊ≥ïÂ∞±ÊòØÁ¶ÅÊ≠¢ÊâÄÊúâÁöÑÈáçÊéíÂ∫èÂíå CPU ÁºìÂ≠ò„ÄÇÂç≥ÂÖ≥Èó≠ÊâÄÊúâÁöÑÁºñËØëÂô®„ÄÅÊìç‰ΩúÁ≥ªÁªüÂíåÂ§ÑÁêÜÂô®ÁöÑ‰ºòÂåñÔºåËøôÊ†∑ÊâÄÊúâÁöÑÊåá‰ª§È°∫Â∫èÂÖ®ÈÉ®ÊåâÁÖßÁ®ãÂ∫è‰ª£Á†Å‰π¶ÂÜôÁöÑÈ°∫Â∫èÊâßË°å„ÄÇÂéªÊéâ CPU È´òÈÄüÁºìÂ≠òÔºåËÆ© CPU ÊØèÊ¨°ËØªÂÜôÊìç‰ΩúÈÉΩÁõ¥Êé•‰∏é‰∏ªÂ≠ò‰∫§‰∫í„ÄÇ ‰ΩÜÊòØÔºåÂ¶ÇÊ≠§Á≤óÊö¥ÁöÑËß£ÂÜ≥ÊñπÊ°àÊòØ‰∏çÂèØÂèñÁöÑÔºåÂõ†‰∏∫Ëøô‰ºöÊûÅÂ§ßÂΩ±ÂìçÂ§ÑÁêÜÂô®ÁöÑËÆ°ÁÆóÊÄßËÉΩÔºåÂπ∂‰∏îÂØπ‰∫éÈÇ£‰∫õÈùûÂ§öÁ∫øÁ®ãÂÖ±‰∫´ÁöÑ ÂèòÈáèÊòØÊûÅ‰∏çÂÖ¨Âπ≥ÁöÑ„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈááÁî®‰∏ÄÁßçÊäò‰∏≠ÁöÑÊñπÊ°àÊù•Ëß£ÂÜ≥ CPU È´òÈÄüÁºìÂ≠ò‰∏éÊåá‰ª§ÈáçÊéíÂ∏¶Êù•ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÈóÆÈ¢ò„ÄÇ‰ΩøÁî®ÂàÜÂâ≤Á∫øÊääÊï¥‰∏™Á®ãÂ∫èÂàíÂàÜ‰∏∫Âá†‰∏™Á®ãÂ∫èÂùóÔºåÂú®ÊØè‰∏™Á®ãÂ∫èÂùóÂÜÖÈÉ®ÁöÑÊåá‰ª§ÊòØÂèØÈáçÊéíÂ∫èÁöÑÔºå‰ΩÜÊòØÂàÜÂâ≤Á∫ø‰∏äÁöÑÊåá‰ª§‰∏éÁ®ãÂ∫èÂùóÂÖ∂‰ªñÊåá‰ª§‰πãÈó¥ÊòØ‰∏çÂèØ‰ª•ÈáçÊéíÂ∫èÁöÑ„ÄÇÂú®‰∏Ä‰∏™Á®ãÂ∫èÂùóÂÜÖÈÉ®ÔºåCPU ‰∏çÁî®ÊØèÊ¨°ÈÉΩ‰∏é‰∏ªÂÜÖÂ≠òËøõË°å‰∫§‰∫íÔºåÂè™ÈúÄË¶ÅÂú® CPU ÁºìÂ≠ò‰∏≠ÊâßË°åËØªÂÜôÊìç‰ΩúÂç≥ÂèØÔºå‰ΩÜÊòØÂΩìÁ®ãÂ∫èÊâßË°åÂà∞ÂàÜÂâ≤Á∫øÂá∫ÔºåCPU ÂøÖÈ°ªÂ∞ÜÊâßË°åÁªìÊûúÂêåÊ≠•Âà∞‰∏ªÂÜÖÂ≠òÊàñËÄÖ‰ªé‰∏ªÂÜÖÂ≠òËØªÂèñÊúÄÊñ∞ÁöÑÂèòÈáèÂÄºÔºåÈÇ£‰πà Happen-before ËßÑÂàôÂ∞±ÊòØÂÆö‰πâ‰∫ÜËøô‰∫õÁ®ãÂ∫èÂùóÁöÑÂàÜÂâ≤Á∫ø„ÄÇ Â¶ÇÂõæÊâÄÁ§∫ÔºåËøôÈáåÁöÑunlock MÂíålock MÂ∞±ÊòØÂàíÂàÜÁ®ãÂ∫èÁöÑÂàÜÂâ≤Á∫ø„ÄÇÂú®ËøôÈáåÔºåÁ∫¢Ëâ≤Âå∫ÂüüÂíåÁªøËâ≤Âå∫ÂüüÁöÑ‰ª£Á†ÅÂÜÖÈÉ®ÊòØÂèØ‰ª•ËøõË°åÈáçÊéíÂ∫èÁöÑÔºå‰ΩÜÊòØ unlock Âíå lock Êìç‰ΩúÊòØ‰∏çËÉΩ‰∏éÂÆÉ‰ª¨ËøõË°åÈáçÊéíÂ∫èÁöÑ„ÄÇÂç≥Á¨¨‰∏Ä‰∏™Âõæ‰∏≠ÁöÑÁ∫¢Ëâ≤ÈÉ®ÂàÜÂøÖÈ°ªË¶ÅÂú®unlock MÊåá‰ª§‰πãÂâçÂÖ®ÈÉ®ÊâßË°åÂÆåÔºåÁ¨¨‰∫å‰∏™Âõæ‰∏≠ÁöÑÁªøËâ≤ÈÉ®ÂàÜÂøÖÈ°ªÂÖ®ÈÉ®Âú®lock MÊåá‰ª§‰πãÂêéÊâßË°å„ÄÇÂπ∂‰∏îÂú®Á¨¨‰∏Ä‰∏™Âõæ‰∏≠ÁöÑunlock MÊåá‰ª§Â§ÑÔºåÁ∫¢Ëâ≤ÈÉ®ÂàÜÁöÑÊâßË°åÁªìÊûúË¶ÅÂÖ®ÈÉ®Âà∑Êñ∞Âà∞‰∏ªÂ≠ò‰∏≠ÔºåÂú®Á¨¨‰∫å‰∏™Âõæ‰∏≠ÁöÑlock MÊåá‰ª§Â§ÑÔºåÁªøËâ≤ÈÉ®ÂàÜÁî®Âà∞ÁöÑÂèòÈáèÈÉΩË¶Å‰ªé‰∏ªÂ≠ò‰∏≠ÈáçÊñ∞ËØªÂèñ„ÄÇ Âú®Á®ãÂ∫è‰∏≠Âä†ÂÖ•ÂàÜÂâ≤Á∫øÂ∞ÜÂÖ∂ÂàíÂàÜÊàêÂ§ö‰∏™Á®ãÂ∫èÂùóÔºåËôΩÁÑ∂Âú®Á®ãÂ∫èÂùóÂÜÖÈÉ®‰ª£Á†Å‰ªçÁÑ∂ÂèØËÉΩË¢´ÈáçÊéíÂ∫èÔºå‰ΩÜÊòØ‰øùËØÅ‰∫ÜÁ®ãÂ∫è‰ª£Á†ÅÂú®ÂÆèËßÇ‰∏äÊòØÊúâÂ∫èÁöÑ„ÄÇÂπ∂‰∏îÂèØ‰ª•Á°Æ‰øùÂú®ÂàÜÂâ≤Á∫øÂ§ÑÔºåCPU‰∏ÄÂÆö‰ºöÂíå‰∏ªÂÜÖÂ≠òËøõË°å‰∫§‰∫í„ÄÇHappens-BeforeÂéüÂàôÂ∞±ÊòØÂÆö‰πâ‰∫ÜÁ®ãÂ∫è‰∏≠‰ªÄ‰πàÊ†∑ÁöÑ‰ª£Á†ÅÂèØ‰ª•‰Ωú‰∏∫ÂàÜÂâ≤Á∫ø„ÄÇÂπ∂‰∏îÊó†ËÆ∫ÊòØÂì™Êù°Happens-BeforeÂéüÂàôÔºåÂÆÉ‰ª¨ÊâÄ‰∫ßÁîüÂàÜÂâ≤Á∫øÁöÑ‰ΩúÁî®ÈÉΩÊòØÁõ∏ÂêåÁöÑ„ÄÇ Java ‰∏éÁ∫øÁ®ãÁ∫øÁ®ãÁöÑÂÆûÁé∞(Âπø‰πâ)ÂÆûÁé∞Á∫øÁ®ã‰∏ªË¶ÅÊúâ 3 ÁßçÊñπÂºèÔºö‰ΩøÁî®ÂÜÖÊ†∏Á∫øÁ®ãÂÆûÁé∞„ÄÅ‰ΩøÁî®Áî®Êà∑Á∫øÁ®ãÂÆûÁé∞Âíå‰ΩøÁî®Áî®Êà∑Á∫øÁ®ãÂä†ËΩªÈáèÁ∫ßËøõÁ®ãÊ∑∑ÂêàÂÆûÁé∞„ÄÇ Thread Á±ª‰∏éÂ§ßÈÉ®ÂàÜÁöÑ Java API ÊúâÊòæËëóÁöÑÂ∑ÆÂà´ÔºåÂÆÉÁöÑÊâÄÊúâÂÖ≥ÈîÆÊñπÊ≥ïÈÉΩÊòØÂ£∞Êòé‰∏∫ Native ÁöÑ„ÄÇÂú® Java API ‰∏≠Ôºå‰∏Ä‰∏™ Native ÊñπÊ≥ïÂæÄÂæÄÊÑèÂë≥ÁùÄËøô‰∏™ÊñπÊ≥ïÊ≤°Êúâ‰ΩøÁî®ÊàñÊó†Ê≥ï‰ΩøÁî®Âπ≥Âè∞Êó†ÂÖ≥ÁöÑÊâãÊÆµÊù•ÂÆûÁé∞(ÂΩìÁÑ∂‰πüÂèØËÉΩÊòØ‰∏∫‰∫ÜÊâßË°åÊïàÁéáËÄå‰ΩøÁî® Native ÊñπÊ≥ïÔºå‰∏çËøáÔºåÈÄöÂ∏∏ÊúÄÈ´òÊïàÁéáÁöÑÊâãÊÆµ‰πüÂ∞±ÊòØÂπ≥Âè∞Áõ∏ÂÖ≥ÁöÑÊâãÊÆµ)„ÄÇ 1.ÂÜÖÊ†∏Á∫øÁ®ãÂÆûÁé∞ÂÜÖÊ†∏Á∫øÁ®ã(Kernel-Level Thread,KLT)Â∞±ÊòØÁõ¥Êé•Áî±Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏(KernelÔºå‰∏ãÁß∞ÂÜÖÊ†∏)ÊîØÊåÅÁöÑÁ∫øÁ®ãÔºåËøôÁßçÁ∫øÁ®ãÁî±ÂÜÖÊ†∏Êù•ÂÆåÊàêÁ∫øÁ®ãÂàáÊç¢ÔºåÂÜÖÊ†∏ÈÄöËøáÊìçÁ∫µË∞ÉÂ∫¶Âô®(Scheduler)ÂØπÁ∫øÁ®ãËøõË°åË∞ÉÂ∫¶ÔºåÂπ∂Ë¥üË¥£Â∞ÜÁ∫øÁ®ãÁöÑ‰ªªÂä°Êò†Â∞ÑÂà∞ÂêÑ‰∏™Â§ÑÁêÜÂô®‰∏ä„ÄÇ Á®ãÂ∫è‰∏ÄËà¨‰∏ç‰ºöÁõ¥Êé•Âéª‰ΩøÁî®ÂÜÖÊ†∏Á∫øÁ®ãÔºåËÄåÊòØÂéª‰ΩøÁî®ÂÜÖÊ†∏Á∫øÁ®ãÁöÑ‰∏ÄÁßçÈ´òÁ∫ßÊé•Âè£‚Äî‚ÄîËΩªÈáèÁ∫ßËøõÁ®ã(Light Weight Process,LWP)ÔºåËΩªÈáèÁ∫ßËøõÁ®ãÂ∞±ÊòØÊàë‰ª¨ÈÄöÂ∏∏ÊÑè‰πâ‰∏äÊâÄËÆ≤ÁöÑÁ∫øÁ®ãÔºåÁî±‰∫éÊØè‰∏™ËΩªÈáèÁ∫ßËøõÁ®ãÈÉΩÁî±‰∏Ä‰∏™ÂÜÖÊ†∏Á∫øÁ®ãÊîØÊåÅÔºåÂõ†Ê≠§Âè™ÊúâÂÖàÊîØÊåÅÂÜÖÊ†∏Á∫øÁ®ãÔºåÊâçËÉΩÊúâËΩªÈáèÁ∫ßËøõÁ®ã„ÄÇ Á≥ªÁªüË∞ÉÁî®ÁöÑ‰ª£‰ª∑Áõ∏ÂØπËæÉÈ´òÔºåÈúÄË¶ÅÂú®Áî®Êà∑ÊÄÅ(User Mode)ÂíåÂÜÖÊ†∏ÊÄÅ(Kernel Mode)‰∏≠Êù•ÂõûÂàáÊç¢„ÄÇÂÖ∂Ê¨°ÔºåÊØè‰∏™ËΩªÈáèÁ∫ßËøõÁ®ãÈÉΩÈúÄË¶ÅÊúâ‰∏Ä‰∏™ÂÜÖÊ†∏Á∫øÁ®ãÁöÑÊîØÊåÅÔºåÂõ†Ê≠§ËΩªÈáèÁ∫ßËøõÁ®ãË¶ÅÊ∂àËÄó‰∏ÄÂÆöÁöÑÂÜÖÊ†∏ËµÑÊ∫ê(Â¶ÇÂÜÖÊ†∏Á∫øÁ®ãÁöÑÊ†àÁ©∫Èó¥)ÔºåÂõ†Ê≠§‰∏Ä‰∏™Á≥ªÁªüÊîØÊåÅËΩªÈáèÁ∫ßËøõÁ®ãÁöÑÊï∞ÈáèÊòØÊúâÈôêÁöÑ„ÄÇ 1:1 2.‰ΩøÁî®Áî®Êà∑Á∫øÁ®ãÂÆûÁé∞‰ªéÂπø‰πâ‰∏äÊù•ËÆ≤Ôºå‰∏Ä‰∏™Á∫øÁ®ãÂè™Ë¶Å‰∏çÊòØÂÜÖÊ†∏Á∫øÁ®ãÔºåÂ∞±ÂèØ‰ª•ËÆ§‰∏∫ÊòØÁî®Êà∑Á∫øÁ®ã(User Thread,UT)ÔºåÂõ†Ê≠§Ôºå‰ªéËøô‰∏™ÂÆö‰πâ‰∏äÊù•ËÆ≤ÔºåËΩªÈáèÁ∫ßËøõÁ®ã‰πüÂ±û‰∫éÁî®Êà∑Á∫øÁ®ãÔºå‰ΩÜËΩªÈáèÁ∫ßËøõÁ®ãÁöÑÂÆûÁé∞ÂßãÁªàÊòØÂª∫Á´ãÂú®ÂÜÖÊ†∏‰πã‰∏äÁöÑÔºåËÆ∏Â§öÊìç‰ΩúÈÉΩË¶ÅËøõË°åÁ≥ªÁªüË∞ÉÁî®ÔºåÊïàÁéá‰ºöÂèóÂà∞ÈôêÂà∂„ÄÇÁã≠‰πâ‰∏äÁöÑÁî®Êà∑Á∫øÁ®ãÊåáÁöÑÊòØÂÆåÂÖ®Âª∫Á´ãÂú®Áî®Êà∑Á©∫Èó¥ÁöÑÁ∫øÁ®ãÂ∫ì‰∏äÔºåÁ≥ªÁªüÂÜÖÊ†∏‰∏çËÉΩÊÑüÁü•Áî®Êà∑Á∫øÁ®ãÂ≠òÂú®ÁöÑÂÆûÁé∞„ÄÇ Áé∞Âú®‰ΩøÁî®Áî®Êà∑Á∫øÁ®ãÁöÑÁ®ãÂ∫èË∂äÊù•Ë∂äÂ∞ë‰∫ÜÔºåJava„ÄÅRuby Á≠âËØ≠Ë®ÄÈÉΩÊõæÁªè‰ΩøÁî®ËøáÁî®Êà∑Á∫øÁ®ãÔºåÊúÄÁªàÂèàÈÉΩÊîæÂºÉ‰ΩøÁî®ÂÆÉ„ÄÇ 3.‰ΩøÁî®Áî®Êà∑Á∫øÁ®ãÂä†ËΩªÈáèÁ∫ßËøõÁ®ãÊ∑∑ÂêàÂÆûÁé∞Á∫øÁ®ãÈô§‰∫Ü‰æùËµñÂÜÖÊ†∏Á∫øÁ®ãÂÆûÁé∞ÂíåÂÆåÂÖ®Áî±Áî®Êà∑Á®ãÂ∫èËá™Â∑±ÂÆûÁé∞‰πãÂ§ñÔºåËøòÊúâ‰∏ÄÁßçÂ∞ÜÂÜÖÊ†∏Á∫øÁ®ã‰∏éÁî®Êà∑Á∫øÁ®ã‰∏ÄËµ∑‰ΩøÁî®ÁöÑÂÆûÁé∞ÊñπÂºè„ÄÇÂú®ËøôÁßçÊ∑∑ÂêàÂÆûÁé∞‰∏ãÔºåÊó¢Â≠òÂú®Áî®Êà∑Á∫øÁ®ãÔºå‰πüÂ≠òÂú®ËΩªÈáèÁ∫ßËøõÁ®ã„ÄÇÁî®Êà∑Á∫øÁ®ãËøòÊòØÂÆåÂÖ®Âª∫Á´ãÂú®Áî®Êà∑Á©∫Èó¥‰∏≠Âú®ËøôÁßçÊ∑∑ÂêàÊ®°Âºè‰∏≠ÔºåÁî®Êà∑Á∫øÁ®ã‰∏éËΩªÈáèÁ∫ßËøõÁ®ãÁöÑÊï∞ÈáèÊØîÊòØ‰∏çÂÆöÁöÑÔºåÂç≥‰∏∫ NÔºöM ÁöÑÂÖ≥Á≥ª Á∫øÁ®ãË∞ÉÂ∫¶‰∏ªË¶ÅË∞ÉÂ∫¶ÊñπÂºèÊúâ‰∏§ÁßçÔºåÂàÜÂà´ÊòØÂçèÂêåÂºèÁ∫øÁ®ãË∞ÉÂ∫¶(Cooperative Threads-Scheduling)ÂíåÊä¢Âç†ÂºèÁ∫øÁ®ãË∞ÉÂ∫¶(Preemptive Threads-Scheduling)„ÄÇ Â¶ÇÊûú‰ΩøÁî®ÂçèÂêåÂºèË∞ÉÂ∫¶ÁöÑÂ§öÁ∫øÁ®ãÁ≥ªÁªüÔºåÁ∫øÁ®ãÁöÑÊâßË°åÊó∂Èó¥Áî±Á∫øÁ®ãÊú¨Ë∫´Êù•ÊéßÂà∂ÔºåÁ∫øÁ®ãÊääËá™Â∑±ÁöÑÂ∑•‰ΩúÊâßË°åÂÆå‰∫Ü‰πãÂêéÔºåË¶Å‰∏ªÂä®ÈÄöÁü•Á≥ªÁªüÂàáÊç¢Âà∞Âè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ã‰∏ä„ÄÇ ‰ºòÁÇπÔºöÂÆûÁé∞ÁÆÄÂçïÔºå‰∏çÁî®ËÄÉËôëÂêåÊ≠•ÈóÆÈ¢ò„ÄÇ Áº∫ÁÇπÔºö‰∏çÁ®≥ÂÆöÔºåÂâçÈù¢‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÂá∫Áé∞ÈóÆÈ¢òÔºåÈÇ£‰πàÂêéÈù¢ÁöÑÁ∫øÁ®ãÈÉΩ‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇ Â¶ÇÊûú‰ΩøÁî®Êä¢Âç†ÂºèË∞ÉÂ∫¶ÁöÑÂ§öÁ∫øÁ®ãÁ≥ªÁªüÔºåÈÇ£‰πàÊØè‰∏™Á∫øÁ®ãÂ∞ÜÁî±Á≥ªÁªüÊù•ÂàÜÈÖçÊâßË°åÊó∂Èó¥ÔºåÁ∫øÁ®ãÁöÑÂàáÊç¢‰∏çÁî±Á∫øÁ®ãÊú¨Ë∫´Êù•ÂÜ≥ÂÆö„ÄÇ ‰ºòÁÇπÔºöÁõ∏ÂØπ‰∫éÂçèÂêåÂºèË∞ÉÂ∫¶ËÄåË®ÄÔºåËæÉ‰∏∫Á®≥ÂÆö„ÄÇ Áº∫ÁÇπÔºöÂèØÊéßÊÄß‰∏çÊòØÂæàÈ´òÔºåÂõ†‰∏∫Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß‰∏çÊòØÂæàÈù†Ë∞±ÔºõËôΩÁÑ∂ Thread.yield()ÂèØ‰ª•ËÆ©Âá∫ÊâßË°åÊó∂Èó¥Ôºå‰ΩÜÊòØË¶ÅËé∑ÂèñÊâßË°åÊó∂Èó¥ÁöÑËØùÔºåÁ∫øÁ®ãÊú¨Ë∫´ÊòØÊ≤°Êúâ‰ªÄ‰πàÂäûÊ≥ï„ÄÇ ÁõÆÂâç Java ‰ΩøÁî®ÁöÑÁ∫øÁ®ãË∞ÉÂ∫¶ÊñπÂºèÂ∞±ÊòØÊä¢Âç†ÂºèË∞ÉÂ∫¶„ÄÇJDK ÂêéÁª≠ÁâàÊú¨‰∏≠ÊúâÂèØËÉΩ‰ºöÊèê‰æõÂçèÁ®ã(Coroutines)ÊñπÂºèÊù•ËøõË°åÂ§ö‰ªªÂä°Â§ÑÁêÜ ‰∏∫‰ªÄ‰πàËØ¥Á∫øÁ®ã‰ºòÂÖàÁ∫ßÂπ∂‰∏çÊòØÂ§™Èù†Ë∞±ÔºüÂõ†‰∏∫ Java ÁöÑÁ∫øÁ®ãÊòØÈÄöËøáÊò†Â∞ÑÂà∞Á≥ªÁªüÁöÑÂéüÁîüÁ∫øÁ®ã‰∏äÊù•ÂÆûÁé∞ÁöÑÔºåÊâÄ‰ª•Á∫øÁ®ãË∞ÉÂ∫¶ÊúÄÁªàËøòÊòØÂèñÂÜ≥‰∫éÊìç‰ΩúÁ≥ªÁªüÔºåËôΩÁÑ∂Áé∞Âú®ÂæàÂ§öÊìç‰ΩúÁ≥ªÁªüÈÉΩÊèê‰æõÁ∫øÁ®ã‰ºòÂÖàÁ∫ßÁöÑÊ¶ÇÂøµÔºå‰ΩÜÊòØÂπ∂‰∏çËßÅÂæóËÉΩ‰∏é Java Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß‰∏Ä‰∏ÄÂØπÂ∫î„ÄÇ Á∫øÁ®ãÁöÑÁä∂ÊÄÅËΩ¨Êç¢ÂõæÁâáÂèÇËÄÉËá™ËøôÁØáÊñáÁ´† ÂàõÂª∫ (New) ËøêË°åÔºå‰∏§ÁßçÂ≠êÁä∂ÊÄÅ Running Ê≠£Âú®ÊâßË°å Ready Á≠âÂæÖÁùÄ CPU ÁªôÂÆÉÂàÜÈÖçÊâßË°åÊó∂Èó¥„ÄÇ Á≠âÂæÖ (Waiting) Êó†ÈôêÊúüÁ≠âÂæÖ Ê≤°ÊúâËÆæÁΩÆ Timeout ÂèÇÊï∞ÁöÑ Object.wait()ÊñπÊ≥ï„ÄÇ Ê≤°ÊúâËÆæÁΩÆ Timeout ÂèÇÊï∞ÁöÑ Thread.join()ÊñπÊ≥ï„ÄÇ LockSupport.park()ÊñπÊ≥ï„ÄÇ ÊúâÈôêÊúüÁ≠âÂæÖ (Timed Waiting) Thread.sleep()ÊñπÊ≥ï„ÄÇ ËÆæÁΩÆ‰∫Ü Timeout ÂèÇÊï∞ÁöÑ Object.wait()ÊñπÊ≥ï„ÄÇ ËÆæÁΩÆ‰∫Ü Timeout ÂèÇÊï∞ÁöÑ Thread.join()ÊñπÊ≥ï„ÄÇ LockSupport.parkNanos()ÊñπÊ≥ï„ÄÇ LockSupport.parkUntil()ÊñπÊ≥ï„ÄÇ ÈòªÂ°û (Blocked) „ÄåÈòªÂ°ûÁä∂ÊÄÅ„Äç‰∏é„ÄåÁ≠âÂæÖÁä∂ÊÄÅ„ÄçÁöÑÂå∫Âà´ÊòØÔºö„ÄåÈòªÂ°ûÁä∂ÊÄÅ„ÄçÂú®Á≠âÂæÖÁùÄËé∑ÂèñÂà∞‰∏Ä‰∏™‰∫íÊñ•ÈîÅ(ÊéíÂÆÉÈîÅ)ÔºåËøô‰∏™‰∫ã‰ª∂Â∞ÜÂú®Âè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ãÊîæÂºÉËøô‰∏™ÈîÅÁöÑÊó∂ÂÄôÂèëÁîüÔºõËÄå„ÄåÁ≠âÂæÖÁä∂ÊÄÅ„ÄçÂàôÊòØÂú®Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥ÔºåÊàñËÄÖÂî§ÈÜíÂä®‰ΩúÁöÑÂèëÁîü„ÄÇÂú®Á®ãÂ∫èÁ≠âÂæÖËøõÂÖ•ÂêåÊ≠•Âå∫ÂüüÁöÑÊó∂ÂÄôÔºåÁ∫øÁ®ãÂ∞ÜËøõÂÖ•ËøôÁßçÁä∂ÊÄÅ„ÄÇ ÁªìÊùü (Terminated) Áõ∏ÂÖ≥ÊñπÊ≥ï‰ªãÁªçË∞ÉÁî® sleep„ÄÅjoin Êó∂Ôºå‰∏ç‰ºöÈáäÊîæÊâÄÂç†Áî®ÁöÑËµÑÊ∫êÔºå‰ºöËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÔºõË∞ÉÁî® wait Êó∂Ôºå‰ºöÈáäÊîæÊâÄÂç†Áî®ÁöÑËµÑÊ∫êÔºå‰ºöËøõÂÖ•Á≠âÂæÖÈòüÂàó„ÄÇ sleep ÊñπÊ≥ïÁ∫øÁ®ãÁù°Áú†Âà∞ÊúüËá™Âä®ËãèÈÜíÔºåÂπ∂ËøîÂõûÂà∞ÂèØËøêË°åÁä∂ÊÄÅÔºå‰∏çÊòØËøêË°åÁä∂ÊÄÅ „ÄÇsleep() ‰∏≠ÊåáÂÆöÁöÑÊó∂Èó¥ÊòØÁ∫øÁ®ã‰∏ç‰ºöËøêË°åÁöÑÊúÄÁü≠Êó∂Èó¥„ÄÇÂõ†Ê≠§Ôºåsleep() ÊñπÊ≥ï‰∏çËÉΩ‰øùËØÅËØ•Á∫øÁ®ãÁù°Áú†Âà∞ÊúüÂêéÂ∞±ÂºÄÂßãÊâßË°å„ÄÇ sleep()ÊòØÈùôÊÄÅÊñπÊ≥ïÔºåÂè™ËÉΩÊéßÂà∂ÂΩìÂâçÊ≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ã„ÄÇ wait ÊñπÊ≥ïÂõ†‰∏∫ wait() ÊñπÊ≥ï‰ºöÈáäÊîæÈîÅÔºåÊâÄ‰ª•ÂøÖÈ°ªË¶ÅÂú® synchronized Âùó‰∏≠Ë∞ÉÁî®Ôºà‰πüÂ∞±ÊòØË¶ÅÂÖàÊãøÂà∞ÈîÅÔºå‰∏çÁÑ∂Â∞±Ê≤°ÊúâÈîÅÂèØ‰ª•ÊòØÈáäÊîæ‰∫ÜÔºâ„ÄÇ join ÊñπÊ≥ïjoin() ÂØºËá¥Á∫øÁ®ãÊ†àÂèëÁîü‰∫ÜÂèòÂåñÔºåÂΩìÁÑ∂Ëøô‰∫õÂèòÂåñÈÉΩÊòØÁû¨Êó∂ÁöÑ„ÄÇ join() ÊñπÊ≥ïÊúâÂ∏¶Ë∂ÖÊó∂ÈôêÂà∂ÁöÑÈáçËΩΩÁâàÊú¨„ÄÇ ‰æãÂ¶Ç t.join(5000);ÂàôËÆ©Á∫øÁ®ãÁ≠âÂæÖ 5000 ÊØ´ÁßíÔºåÂ¶ÇÊûúË∂ÖËøáËøô‰∏™Êó∂Èó¥ÔºåÂàôÂÅúÊ≠¢Á≠âÂæÖÔºåÂèò‰∏∫ÂèØËøêË°åÁä∂ÊÄÅ„ÄÇ yield ÊñπÊ≥ïyield() ÊñπÊ≥ï‰ºöÂÅúÊ≠¢ÂΩìÂâçÁ∫øÁ®ãÔºà‰Ωø‰πãËøõÂÖ•ÂèØËøêË°åÁä∂ÊÄÅÔºâÔºåËÆ©ÂêåÁ≠â‰ºòÂÖàÊùÉÁöÑÁ∫øÁ®ãËøêË°å„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÂêåÁ≠â‰ºòÂÖàÊùÉÁöÑÁ∫øÁ®ãÔºåÈÇ£‰πà yield() ÊñπÊ≥ïÂ∞Ü‰∏ç‰ºöËµ∑‰ΩúÁî®„ÄÇ ÂÆûÈôÖ‰∏≠Êó†Ê≥ï‰øùËØÅ yield() ËææÂà∞ËÆ©Ê≠•ÁõÆÁöÑÔºåÂõ†‰∏∫ËÆ©Ê≠•ÁöÑÁ∫øÁ®ã(ÂõûÂà∞ÂèØÊâßË°åÁä∂ÊÄÅ)ËøòÊúâÂèØËÉΩË¢´Á∫øÁ®ãË∞ÉÂ∫¶Á®ãÂ∫èÂÜçÊ¨°ÈÄâ‰∏≠„ÄÇ ÁÆÄËÆ∞ÔºöÁ°¨‰ª∂ÊïàÁéá‰∏é‰∏ÄËá¥ÊÄßÂõ†‰∏∫Â§ÑÁêÜÂô®ÈúÄË¶ÅËØªÂèñÂíåËøîÂõûÊï∞ÊçÆÔºåÊâÄ‰ª•ÈúÄË¶ÅÂ≠òÂÇ®Âô®„ÄÇËÄåÂ≠òÂÇ®Âô®ÁöÑÈÄüÂ∫¶‰∏éÂ§ÑÁêÜÂô®ÁöÑËøêÁÆóÈÄüÂ∫¶Áõ∏Â∑ÆÂá†‰∏™Êï∞ÈáèÁ∫ß„ÄÇÊâÄ‰ª•ÂºïÂÖ•‰∫ÜÁºìÂ≠òÔºåÂºïÂÖ•ÁºìÂ≠òÁöÑÂêåÊó∂‰πüÂºïÂÖ•‰∫Ü‰∏ªÂ≠ò‰∏éÁºìÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÈóÆÈ¢ò„ÄÇ ‰∏∫‰∫ÜÂÖÖÂàÜÂà©Áî®Â§ÑÁêÜÂô®ÁöÑËøêÁÆóËÉΩÂäõÔºåÈô§‰∫ÜÂºïÂÖ•ÁºìÂ≠ò‰ª•Â§ñÔºåÂ§ÑÁêÜÂô®ÂèØËÉΩËøò‰ºöÂØπËæìÂÖ•ÁöÑ‰ª£Á†ÅËøõË°åÊù•‰π±Â∫èÊâßË°å(‰∏çÂΩ±ÂìçÁªìÊûú)„ÄÇJVM ÁöÑÂç≥Êó∂ÁºñËØëÂô®‰∏≠‰πüÊúâÁ±ª‰ºº‰∫éÊåá‰ª§ÈáçÊéíÁöÑ‰ºòÂåñ„ÄÇ Â∑•‰ΩúÂÜÖÂ≠ò‰∏é‰∏ªÂÜÖÂ≠òÊØèÊù°Á∫øÁ®ãÊúâËá™Â∑±ÁöÑÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂ∑•‰ΩúÂÜÖÂ≠òÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºåÂ¶ÇÊûúË¶Å‰∫§Êç¢ÂøÖÈ°ªÈÄöËøá‰∏ªÂÜÖÂ≠ò„ÄÇËã•Ë¶ÅÊää‰∫åËÄÖ‰∏é Java ‰∏≠ÁöÑÂÜÖÂ≠òÂå∫ÂüüÂØπÂ∫îËµ∑Êù•ÔºåÂàôÂ∑•‰ΩúÂÜÖÂ≠òÂÉèÂØπÂ∫îËôöÊãüÊú∫Ê†à‰∏≠ÁöÑÈÉ®ÂàÜÂå∫ÂüüÔºå‰∏ªÂÜÖÂ≠òÂØπÂ∫î‰∫éÂ†Ü‰∏≠ÁöÑÂØπË±°ÂÆû‰æãÊï∞ÊçÆÈÉ®ÂàÜ„ÄÇ ËôöÊãüÊú∫ÂèØËÉΩ‰ºöËÆ©Â∑•‰ΩúÂÜÖÂ≠ò‰ºòÂÖàÂ≠òÂÇ®Âú®ÂØÑÂ≠òÂô®ÊàñËÄÖÈ´òÈÄüÁºìÂ≠ò‰∏≠ÔºåÂõ†‰∏∫Á®ãÂ∫èËøêË°åÊó∂‰∏ªË¶ÅËÆøÈóÆËØªÂÜôÁöÑÊòØÂ∑•‰ΩúÂÜÖÂ≠ò „ÄÇ ÂÜÖÂ≠òÈó¥ÁöÑ‰∫§‰∫íÊìç‰Ωú(lock)read load use assign store write(unlock) ‰∏Ä‰∏™ÂèòÈáèÂú®Âêå‰∏ÄÊó∂ÂàªÂè™ËÉΩË¢´Êüê‰∏Ä‰∏™Á∫øÁ®ã lock„ÄÇ‰ΩÜÊòØËØ•Á∫øÁ®ãÂèØ‰ª•ÂØπËøô‰∏™ÂèòÈáè lock Â§öÊ¨°„ÄÇ Êüê‰∫õÊìç‰ΩúÂøÖÈ°ªÊàêÂØπÂá∫Áé∞ÔºåÊØîÂ¶Ç read ‰∏é load „ÄÅstore ‰∏é write„ÄÇ ÂØπÊüê‰∏™ÂèòÈáèÊâßË°å‰∫Ü assign Êìç‰ΩúÔºåÂøÖÈ°ªÊääÂÆÉÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò„ÄÇ volatile ÂÖ≥ÈîÆÂ≠ó‰øùËØÅÂèØËßÅÊÄß„ÄÅÁ¶ÅÊ≠¢Êåá‰ª§ÈáçÊéí„ÄÇ Êó†Ê≥ï‰øùËØÅ‰∏ÄËá¥ÊÄß„ÄÇ‰ª•Â§öÁ∫øÁ®ã‰øÆÊîπÂèòÈáèËá™Â¢û‰∏∫‰æãÔºåÂΩìÁ∫øÁ®ã A ËØªÂèñ‰∫ÜËØ•ÂèòÈáè(Ê≠§Êó∂ÂèòÈáèÁöÑÂÄºÊòØÊ≠£Á°ÆÁöÑ)‰ΩÜÊòØËøòÊú™ËøõË°å +1 Êìç‰ΩúÔºåÊ≠§ÂèòÈáèÁöÑÂÄºË¢´Á∫øÁ®ã B ÊâßË°å‰∫Ü +1 Êìç‰Ωú(Êõ¥Êñ∞Âêé‰ºöÈÄöÁü•ÊâÄÊúâÁ∫øÁ®ãÔºå‰ΩÜÊòØÁî±‰∫é Á∫øÁ®ã A Â∑≤ÁªèËØªÂèñËøáËØ•ÂÄº‰∫Ü‰ΩÜÊòØÁî±ËøòÊ≤°ÊúâËøõË°åËµãÂÄºÊìç‰ΩúÔºåÊâÄ‰ª•‰∏ç‰ºöÂæóÂà∞ÊúÄÊñ∞ÁöÑÂÄº)Ôºå‰ΩÜÊòØ‰πãÂêéÁ∫øÁ®ã A ‰ºöÂØπÊóßÂÄºËøõË°åËá™Â¢ûÊìç‰ΩúÔºåÂØºËá¥ÁªìÊûúÈîôËØØ„ÄÇ Ê≥®Ôºöi++ Áî± 4 Êù°Â≠óËäÇÁ†ÅÊåá‰ª§ÊûÑÊàê„ÄÇ‰ªéÂ≠óËäÇÁ†ÅÂ±ÇÈù¢Ëß£ÈáäÔºöÂΩì getStatic Êåá‰ª§Êää race ÁöÑÂÄº(ËøõË°åËá™Â¢ûÊìç‰ΩúÁöÑÂèòÈáè)ËØªÂèñÂà∞Êìç‰ΩúÊ†àÈ°∂Êó∂Ôºåvolatile ‰øùËØÅ race ÁöÑÂÄºÂú®Ê≠§Êó∂ÊòØÊ≠£Á°ÆÁöÑÔºå‰ΩÜÊòØÂú®ÊâßË°å iconst_1„ÄÅadd Ëøô‰∫õÊåá‰ª§Êó∂ÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂèØËÉΩÂ∑≤ÁªèÊää race ÁöÑÂÄºÂä†Â§ß‰∫ÜÔºåËÄåÂú®Êìç‰ΩúÊ†àÈ°∂ÁöÑÂÄºÂ∞±ÂèòÊàê‰∫ÜËøáÊúüÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª• putStatic Êåá‰ª§ÊâßË°åÂêéÂ∞±ÂèØËÉΩÊääËæÉÂ∞èÁöÑ race ÂÄºÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò‰∏≠„ÄÇ Âú®‰∏çÁ¨¶Âêà‰ª•‰∏ã‰∏§Êù°ËßÑÂàôÁöÑËøêÁÆóÂú∫ÊôØ‰∏≠Ôºå‰ªçÁÑ∂Ë¶ÅÈÄöËøáÂä†ÈîÅÊù•‰øùËØÅÂéüÂ≠êÊÄß„ÄÇ ËøêÁÆóÁªìÊûú‰∏ç‰æùËµñÂèòÈáèÂΩìÂâçÁöÑÂÄº or Âè™Ë¶ÅÂçï‰∏ÄÁöÑÁ∫øÁ®ã‰øÆÊîπÂèòÈáèÁöÑÂÄº ÂèòÈáè‰∏çÈúÄË¶Å‰∏éÂÖ∂‰ªñÁöÑÁä∂ÊÄÅÂèòÈáèÂÖ±ÂêåÂèÇ‰∏é‰∏çÂèòÁ∫¶Êùü„ÄÇ ÊôÆÈÄöÂèòÈáèÂè™‰øùËØÅ„ÄåÁªìÊûúÊ≠£Á°Æ„ÄçÔºåvolitale ÂèòÈáèËøò‰øùËØÅ„ÄåÁ®ãÂ∫èÊ≠£Á°Æ„Äç „ÄåÁ®ãÂ∫èÊ≠£Á°Æ„ÄçÊåáÁöÑÊòØÊåâÁÖßÈ°∫Â∫èÊâßË°å ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã Java ÂÜÖÂ≠òËÆøÈóÆÈáçÊéíÂ∫èÁöÑÁ†îÁ©∂ Á∫øÁ®ãÁä∂ÊÄÅÁöÑËΩ¨Êç¢ ‰ªéJavaÂ§öÁ∫øÁ®ãÂèØËßÅÊÄßË∞àHappens-BeforeÂéüÂàô Ëã•Êú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>jvm</category>
        <category>Âπ∂Âèë</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java Á∫øÁ®ãÂÆâÂÖ®‰∏éÈîÅ‰ºòÂåñ]]></title>
    <url>%2Fblog%2F2017%2F09%2F11%2FJava%20%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[1.Á∫øÁ®ãÂÆâÂÖ®ÂΩìÊàë‰ª¨Ë∞àÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨Ë∞à‰∫õ‰ªÄ‰πàÔºü ÂÖàÁúãÁúã„ÄåÁ∫øÁ®ãÂÆâÂÖ®„ÄçÁöÑÂÆö‰πâÔºö ÂΩìÂ§ö‰∏™Á∫øÁ®ãËÆøÈóÆ‰∏Ä‰∏™ÂØπË±°Êó∂ÔºåÂ¶ÇÊûú‰∏çÁî®ËÄÉËôëËøô‰∫õÁ∫øÁ®ãÂú®ËøêË°åÊó∂ÁéØÂ¢É‰∏ãÁöÑË∞ÉÂ∫¶Âíå‰∫§ÊõøÊâßË°åÔºå‰πü‰∏çÈúÄË¶ÅËøõË°åÈ¢ùÂ§ñÁöÑÂêåÊ≠•ÔºåÊàñËÄÖÂú®Ë∞ÉÁî®ÊñπËøõË°å‰ªª‰ΩïÂÖ∂‰ªñÁöÑÂçèË∞ÉÊìç‰ΩúÔºåË∞ÉÁî®Ëøô‰∏™ÂØπË±°ÁöÑË°å‰∏∫ÈÉΩÂèØ‰ª•Ëé∑ÂæóÊ≠£Á°ÆÁöÑÁªìÊûúÔºåÈÇ£‰πàËøô‰∏™ÂØπË±°ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ 1.1 Java ËØ≠Ë®Ä‰∏≠ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂèØÂ∞Ü Java ËØ≠Ë®Ä‰∏≠ÁöÑÂêÑÁßçÊìç‰ΩúÂÖ±‰∫´ÁöÑÊï∞ÊçÆÂàÜ‰∏∫‰ª•‰∏ã 5 Á±ªÔºö‰∏çÂèØÂèò„ÄÅÁªùÂØπÁ∫øÁ®ãÂÆâÂÖ®„ÄÅÁõ∏ÂØπÁ∫øÁ®ãÂÆâÂÖ®„ÄÅÁ∫øÁ®ãÂÖºÂÆπÂíåÁ∫øÁ®ãÂØπÁ´ã„ÄÇ 1. ‰∏çÂèØÂèòÂè™Ë¶Å‰∏Ä‰∏™‰∏çÂèØÂèòÂØπË±°Ë¢´Ê≠£Á°ÆÂú∞ÊûÑÂª∫Âá∫Êù•ÔºàÊ≤°Êúâ this ÂºïÁî®ÈÄÉÈÄ∏ÁöÑÊÉÖÂÜµÔºâÔºåÈÇ£‰πàÂÖ∂Â§ñÈÉ®ÁöÑÂèØËßÅÁä∂ÊÄÅÊ∞∏Ëøú‰πü‰∏ç‰ºöÊîπÂèò„ÄÇ final + Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÔºåÂàôËØ•ÂèòÈáè‰∏∫‰∏çÂèØÂèòÂèòÈáèfinal + ÂØπË±°ÔºåÊó†Ê≥ï‰øùËØÅÂØπË±°ÊòØ‰∏çÂèØÂèòÁöÑ Â¶Ç‰Ωï‰øùËØÅÂØπË±°ÁöÑË°å‰∏∫‰∏ç‰ºöÂØπÂÖ∂Áä∂ÊÄÅ‰∫ßÁîü‰ªª‰ΩïÂΩ±ÂìçÔºüÊúÄÁÆÄÂçïÁöÑÂ∞±ÊòØÂ∞ÜÂØπË±°‰∏≠Â∏¶ÊúâÁä∂ÊÄÅÁöÑÂèòÈáèÈÉΩÂ£∞Êòé‰∏∫ final„ÄÇ Java API ‰∏≠Â±û‰∫é‰∏çÂèØÂèòÁöÑÁ±ªÊúâ‰ª•‰∏ãÂá†ÁßçÔºö String Âü∫Á°ÄÊï∞ÊçÆÁ±ªÂûãÂåÖË£ÖÁ±ª BigInteger BigDecimal Ê≥®ÊÑèÔºöÂêå‰∏∫ Number ÁöÑÂéüÂ≠êÁ±ª AtomicInteger Âíå AtomicLong ÂàôÂπ∂Èùû‰∏çÂèØÂèòÁöÑ„ÄÇÂõ†‰∏∫ÂÆÉ‰ª¨ÈÉΩÊúâ set ÊñπÊ≥ïÔºåÂèØ‰ª•ÊîπÂèòÂØπË±°ÁöÑÁä∂ÊÄÅ„ÄÇ 2. ÁªùÂØπÁ∫øÁ®ãÂÆâÂÖ®ÁªùÂØπÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂÆö‰πâÊòØÂæà‰∏•Ê†ºÁöÑ„ÄÇJava API ‰∏≠Ê†áÊ≥®Ëá™Â∑±ÁöÑÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÁ±ªÔºåÂ§ßÂ§öÊï∞ÈÉΩ‰∏çÊòØÁªùÂØπÁöÑÁ∫øÁ®ãÂÆâÂÖ®„ÄÇ Ê†óÂ≠êÔºöVector 123456789101112131415161718192021222324252627282930313233package jvm.ch13;import java.util.Vector;public class VectorTest &#123; private static Vector&lt;Integer&gt; sIntegerVector = new Vector&lt;&gt;(); public static void main(String[] args) &#123; while (true) &#123; for (int i = 0; i &lt; 10; i++) &#123; sIntegerVector.add(i); &#125; Thread removeThread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; sIntegerVector.size(); i++) &#123; sIntegerVector.remove(i); &#125; &#125;); Thread printThread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; sIntegerVector.size(); i++) &#123; System.out.println(sIntegerVector.get(i)); &#125; &#125;); removeThread.start(); printThread.start(); while (Thread.activeCount() &gt; 20) &#123; &#125; &#125; &#125;&#125; ‰ª•‰∏ä‰ª£Á†ÅÂèØËÉΩ‰ºöÊä• ArrayIndexOutOfBoundException Âõ†‰∏∫ÂèØËÉΩÂá∫Áé∞‰∏Ä‰∏™Á∫øÁ®ãÊÅ∞Â•ΩÂú®‰∏Ä‰∏™ÈîôËØØÁöÑÊó∂Èó¥Âà†Èô§‰∫Ü‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂØºËá¥ i ÂÖÉÁ¥†Â∑≤Áªè‰∏çÂÜçÂèØÁî®ÔºåÂè¶‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆ‰∫Ü i ÂÖÉÁ¥†„ÄÇÔºàÊØîÂ¶ÇÔºöget(i) ËøõÂÖ•Á≠âÂæÖÈîÅÊúüÈó¥Ôºåremove(i) ÂàöÂ•ΩÊâßË°åÂÆå‰∫ÜÔºâ„ÄÇ Ëß£ÂÜ≥ÔºöÊìç‰ΩúÊó∂Âä†‰∏äÈîÅÔºå‰ΩøÂæóÂ§çÂêàÊìç‰ΩúÂèò‰∏∫ÂéüÂ≠êÊìç‰Ωú„ÄÇ ÂéüÂ≠êÊìç‰Ωú‰∏éÂ§çÂêàÊìç‰ΩúÁÆÄ‰ªãÔºö ÂéüÂ≠êÊìç‰ΩúÔºö‰∏çÂèØÂàÜÂâ≤ÁöÑÊìç‰ΩúÔºåË¶Å‰πàÊàêÂäüË¶Å‰πàÂ§±Ë¥•„ÄÇ Â§çÂêàÊìç‰ΩúÔºöÂèØÂàÜÂâ≤ÁöÑÊìç‰ΩúÔºåÂèØËÉΩÂá∫Áé∞Êï∞ÊçÆÂ§±ÊïàÁöÑÈóÆÈ¢ò„ÄÇ 1234567891011121314Thread removeThread = new Thread(() -&gt; &#123; synchronized (sIntegerVector) &#123;//Âä†‰∏äÈîÅ‰Ωø‰πãÊàê‰∏∫ÂéüÂ≠êÊìç‰Ωú for (int i = 0; i &lt; sIntegerVector.size(); i++) &#123; sIntegerVector.remove(i); &#125; &#125;&#125;);Thread printThread = new Thread(() -&gt; &#123; synchronized (sIntegerVector) &#123; for (int i = 0; i &lt; sIntegerVector.size(); i++) &#123; System.out.println(sIntegerVector.get(i)); &#125; &#125;&#125;); ‰∏∫‰ªÄ‰πàÊòØ‰ΩøÁî® Vector ÂØπË±°‰Ωú‰∏∫ÈîÅÔºüÂõ†‰∏∫ Vector ÂÜÖÈÉ®ÊòØ‰ΩøÁî®Ëá™Â∏¶ÁöÑÈîÅÊù•ÂÆûÁé∞ÁöÑ„ÄÇ 3. Áõ∏ÂØπÁ∫øÁ®ãÂÆâÂÖ®Âç≥ÈÄöÂ∏∏ÊÑè‰πâ‰∏äÊâÄËÆ≤ÁöÑÁ∫øÁ®ãÂÆâÂÖ®„ÄÇÂÆÉÈúÄË¶Å‰øùËØÅÂØπËøô‰∏™ÂØπË±°ÂçïÁã¨Êìç‰ΩúÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåË∞ÉÁî®Êó∂Â∞±‰∏çÈúÄË¶ÅÂÅöÈ¢ùÂ§ñÁöÑ‰øùÈöúÊé™ÊñΩ„ÄÇ ÂØπ‰∫é‰∏Ä‰∫õÁâπÂÆöÈ°∫Â∫èÁöÑËøûÁª≠Ë∞ÉÁî®ÔºåÂ∞±ÂèØËÉΩÈúÄË¶ÅÂú®Ë∞ÉÁî®Á´Ø‰ΩøÁî®È¢ùÂ§ñÁöÑÂêåÊ≠•ÊâãÊÆµÊù•‰øùËØÅË∞ÉÁî®ÁöÑÊ≠£Á°ÆÊÄß„ÄÇ Java API ‰∏≠Â§ßÈÉ®ÂàÜÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÁ±ªÈÉΩÂ±û‰∫éËøôÁßçÁ±ªÂûãÔºö VectorÔºåHashTableÔºåCollections.sychronizedCollection() 4. Á∫øÁ®ãÂÖºÂÆπ‰πüÂ∞±ÊòØÂπ≥Â∏∏ÊâÄËØ¥ÁöÑÁ∫øÁ®ã‰∏çÂÆâÂÖ®Á±ª„ÄÇÂØπË±°Êú¨Ë∫´Âπ∂‰∏çÂÆâÂÖ®Ôºå‰ΩÜÊòØÂèØ‰ª•ÈÄöËøáÂú®Ë∞ÉÁî®Á´ØÊ≠£Á°ÆÂú∞‰ΩøÁî®ÂêåÊ≠•ÊâãÊÆµÊù•‰øùËØÅÂØπË±°Â≠êÂïäÂπ∂ÂèëÁéØÂ¢É‰∏≠ÂèØ‰ª•ÂÆâÂÖ®Âú∞‰ΩøÁî®„ÄÇ ÊØîÂ¶ÇÔºöArrayList„ÄÅHashKMap 5. Á∫øÁ®ãÂØπÁ´ãÂú®Ë∞ÉÁî®Á´ØÊòØÂê¶‰ΩøÁî®ÂêåÊ≠•ÊâãÊÆµÈÉΩÊó†Ê≥ïÂÜçÂ§öÁ∫øÁ®ãÁéØÂ¢É‰∏ã‰ΩøÁî®„ÄÇ ËøôÁßçÊéíÊñ•Â§öÁ∫øÁ®ã‰ª£Á†ÅÂæàÂ∞ëÂá∫Áé∞„ÄÇ Á∫øÁ®ãÂÆâÂÖ®ÁöÑÂÆûÁé∞ÊñπÊ≥ïÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂÆûÁé∞ÊñπÊ≥ï‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†ÁßçÔºö‰∫íÊñ•ÂêåÊ≠•„ÄÅÈùûÈòªÂ°ûÂêåÊ≠•„ÄÅÊó†ÂêåÊ≠•ÊñπÊ°à„ÄÇ 1. ‰∫íÊñ•ÂêåÊ≠•„Äå‰∫íÊñ•ÂêåÊ≠•„ÄçÁöÑÊÑèÊÄùÊòØÈÄöËøá‰∫íÊñ•Êù•ÂÆûÁé∞ÂêåÊ≠•„ÄÇÂêåÊ≠•ÊòØÊåáÂú®Â§ö‰∏™Á∫øÁ®ãÂπ∂ÂèëËÆøÈóÆÂÖ±‰∫´Êï∞ÊçÆÁöÑÊó∂ÂÄôÔºå‰øùËØÅÂÖ±‰∫´Êï∞ÊçÆÂú®Âêå‰∏ÄÊó∂ÂàªÂè™ËÉΩÊúâ‰∏Ä‰∏™ÔºàÊàñËÄÖ‰∏Ä‰∫õÔºå‰ΩøÁî®‰ø°Âè∑ÈáèÁöÑÊó∂ÂÄôÔºâÁ∫øÁ®ã‰ΩøÁî®„ÄÇ‰∏¥ÁïåÂå∫„ÄÅ‰∫íÊñ•Èáè„ÄÅ‰ø°Âè∑ÈáèÈÉΩÊòØ‰∏ªË¶ÅÁöÑ‰∫íÊñ•ÂÆûÁé∞ÊñπÂºè„ÄÇ ÊúÄÂü∫Êú¨ÁöÑ‰∫íÊñ•ÂêåÊ≠•ÂÆûÁé∞ÊñπÊ≥ïÂ∞±ÊòØ‰ΩøÁî® synchronized ÂÖ≥ÈîÆÂ≠ó„ÄÇsynchronized ÂÖ≥ÈîÆÂ≠óÁªèËøáÁºñËØë‰πãÂêéÔºå‰ºöÂú®ÂêåÊ≠•ÂùóÁöÑÂâçÂêéÂàÜÂà´ÂΩ¢Êàê monitorenter„ÄÅmonitorexit ‰∏§Êù°Êåá‰ª§„ÄÇÊ†πÊçÆËôöÊãüÊú∫ËßÑËåÉÁöÑË¶ÅÊ±ÇÔºå Âú®ÊâßË°å monitorenter Êåá‰ª§Êó∂ÔºåÈ¶ñÂÖàË¶ÅÂ∞ùËØïËé∑ÂèñÂØπË±°ÁöÑÈîÅ„ÄÇÂ¶ÇÊûúËøô‰∏™ÂØπË±°Ê≤°Ë¢´ÈîÅÂÆöÔºåÊàñËÄÖÂΩìÂâçÁ∫øÁ®ãÂ∑≤ÁªèÊã•Êúâ‰∫ÜÈÇ£‰∏™ÂØπË±°ÁöÑÈîÅÔºåÊääÈîÅÁöÑËÆ°Êï∞Âô®Âä† 1Ôºå Âú®ÊâßË°å monitorexit Êåá‰ª§Êó∂‰ºöÂ∞ÜÈîÅËÆ°Êï∞Âô®Âáè 1ÔºåÂΩìËÆ°Êï∞Âô®‰∏∫ 0 Êó∂ÔºåÈîÅÂ∞±Ë¢´ÈáäÊîæ„ÄÇÂ¶ÇÊûúËé∑ÂèñÂØπË±°ÈîÅÂ§±Ë¥•ÔºåÈÇ£ÂΩìÂâçÁ∫øÁ®ãÂ∞±Ë¶ÅÈòªÂ°ûÁ≠âÂæÖÔºåÁõ¥Âà∞ÂØπË±°ÈîÅË¢´Âè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ãÈáäÊîæ‰∏∫Ê≠¢„ÄÇ ‰∏äËø∞ÊèèËø∞‰∏≠Êúâ‰∏§ÁÇπÊòØÈúÄË¶ÅÁâπÂà´Ê≥®ÊÑèÁöÑ„ÄÇ È¶ñÂÖàÔºåsynchronized ÂêåÊ≠•ÂùóÂØπÂêå‰∏ÄÊù°Á∫øÁ®ãÊù•ËØ¥ÊòØÂèØÈáçÂÖ•ÁöÑÔºå‰∏ç‰ºöÂá∫Áé∞Ëá™Â∑±ÊääËá™Â∑±ÈîÅÊ≠ªÁöÑÈóÆÈ¢ò„ÄÇ ÂÖ∂Ê¨°ÔºåÂêåÊ≠•ÂùóÂú®Â∑≤ËøõÂÖ•ÁöÑÁ∫øÁ®ãÊâßË°åÂÆå‰πãÂâçÔºå‰ºöÈòªÂ°ûÂêéÈù¢ÂÖ∂‰ªñÁ∫øÁ®ãÁöÑËøõÂÖ•„ÄÇ Java ÁöÑÁ∫øÁ®ãÊòØÊò†Â∞ÑÂà∞Êìç‰ΩúÁ≥ªÁªüÁöÑÂéüÁîüÁ∫øÁ®ã‰πã‰∏äÁöÑÔºåÂ¶ÇÊûúË¶ÅÈòªÂ°ûÊàñÂî§ÈÜí‰∏Ä‰∏™Á∫øÁ®ãÔºåÈÉΩÈúÄË¶ÅÊìç‰ΩúÁ≥ªÁªüÊù•Â∏ÆÂøôÂÆåÊàêÔºåËøôÂ∞±ÈúÄË¶Å‰ªéÁî®Êà∑ÊÄÅËΩ¨Êç¢Âà∞Ê†∏ÂøÉÊÄÅ‰∏≠ÔºåÂõ†Ê≠§Áä∂ÊÄÅËΩ¨Êç¢ÈúÄË¶ÅËÄóË¥πÂæàÂ§öÁöÑÂ§ÑÁêÜÂô®Êó∂Èó¥„ÄÇ Èô§‰∫Ü synchronized ‰πãÂ§ñÔºåÊàë‰ª¨ËøòÂèØ‰ª•‰ΩøÁî® java.util.concurrentÔºàÁÆÄÁß∞ J.U.CÔºâÂåÖ‰∏≠ÁöÑÈáçÂÖ•ÈîÅÔºàReentrantLockÔºâÊù•ÂÆûÁé∞ÂêåÊ≠•ÔºåÂú®Âü∫Êú¨Áî®Ê≥ï‰∏äÔºåReentrantLock ‰∏é synchronized ÂæàÁõ∏‰ººÔºå‰ªñ‰ª¨ÈÉΩÂÖ∑Â§á‰∏ÄÊ†∑ÁöÑÁ∫øÁ®ãÈáçÂÖ•ÁâπÊÄßÔºå‰∏çÂêåÁÇπË°®Áé∞Âú®‰ª£Á†ÅÂÜôÊ≥ï‰∏ä ‰∏Ä‰∏™Ë°®Áé∞‰∏∫ API Â±ÇÈù¢ÁöÑ‰∫íÊñ•ÈîÅÔºàlock() Âíå unlock() ÊñπÊ≥ïÈÖçÂêà try/finally ËØ≠Âè•ÂùóÊù•ÂÆåÊàêÔºâÔºå Âè¶‰∏Ä‰∏™Ë°®Áé∞‰∏∫ÂéüÁîüËØ≠Ê≥ïÂ±ÇÈù¢ÁöÑ‰∫íÊñ•ÈîÅ„ÄÇ Áõ∏ÊØî synchronized,ReentrantLock Â¢ûÂä†‰∫Ü‰∏Ä‰∫õÈ´òÁ∫ßÂäüËÉΩÔºå‰∏ªË¶ÅÊúâ‰ª•‰∏ã 3 È°πÔºö Á≠âÂæÖÂèØ‰∏≠Êñ≠,Â¶ÇÊûúÊåÅÊúâÈîÅÁöÑÁ∫øÁ®ãÈïøÊó∂Èó¥‰∏çÈáäÊîæÈîÅÔºåÊ≠£Âú®Á≠âÂæÖÁöÑÁ∫øÁ®ãÂèØ‰ª•ÈÄâÊã©ÊîæÂºÉÁ≠âÂæÖÔºåÊîπ‰∏∫Â§ÑÁêÜÂÖ∂‰ªñ‰∫ãÊÉÖ„ÄÇ ÂÖ¨Âπ≥ÈîÅ Â§ö‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖÂêå‰∏Ä‰∏™ÈîÅÊó∂ÔºåÂøÖÈ°ªÊåâÁÖßÁî≥ËØ∑ÈîÅÁöÑÊó∂Èó¥È°∫Â∫èÊù•‰æùÊ¨°Ëé∑ÂæóÈîÅ; ÈùûÂÖ¨Âπ≥ÈîÅÂàô‰∏ç‰øùËØÅËøô‰∏ÄÁÇπÔºåÂú®ÈîÅË¢´ÈáäÊîæÊó∂Ôºå‰ªª‰Ωï‰∏Ä‰∏™Á≠âÂæÖÈîÅÁöÑÁ∫øÁ®ãÈÉΩÊúâÊú∫‰ºöËé∑ÂæóÈîÅ„ÄÇ synchronized ‰∏≠ÁöÑÈîÅÊòØÈùûÂÖ¨Âπ≥ÁöÑÔºå ReentrantLock ÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰πüÊòØÈùûÂÖ¨Âπ≥ÁöÑÔºå‰ΩÜÂèØ‰ª•ÈÄöËøáÂ∏¶Â∏ÉÂ∞îÂÄºÁöÑÊûÑÈÄ†ÂáΩÊï∞Ë¶ÅÊ±Ç‰ΩøÁî®ÂÖ¨Âπ≥ÈîÅ„ÄÇ ÈîÅÂèØ‰ª•ÁªëÂÆöÂ§ö‰∏™Êù°‰ª∂ ‰∏Ä‰∏™ ReentrantLock ÂØπË±°ÂèØ‰ª•ÂêåÊó∂ÁªëÂÆöÂ§ö‰∏™ Condition ÂØπË±° ËÄåÂú® synchronized ‰∏≠ÔºåÈîÅÂØπË±°ÁöÑ wait() Âíå notify() Êàñ notifyAll() ÊñπÊ≥ïÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ÈöêÂê´ÁöÑÊù°‰ª∂ÔºåÂ¶ÇÊûúË¶ÅÂíåÂ§ö‰∫é‰∏Ä‰∏™ÁöÑÊù°‰ª∂ÂÖ≥ËÅîÁöÑÊó∂ÂÄôÔºåÂ∞±‰∏çÂæó‰∏çÈ¢ùÂ§ñÂú∞Ê∑ªÂä†‰∏Ä‰∏™ÈîÅ„ÄÇ ReentrantLock ËøòÊòØ synchronizedÔºüÂÖ≥‰∫éÊÄßËÉΩÔºöJava 1.6 ÂèëÂ∏É‰πãÂêéÔºåsynchronized ‰∏é ReentrantLock ÁöÑÊÄßËÉΩÂü∫Êú¨‰∏äÊòØÂÆåÂÖ®ÊåÅÂπ≥‰∫Ü„ÄÇÂõ†Ê≠§ÔºåJava 1.6 Êàñ‰ª•‰∏äÔºåÊÄßËÉΩÂõ†Á¥†Â∞±‰∏çÂÜçÊòØÈÄâÊã© ReentrantLock ÁöÑÁêÜÁî±‰∫ÜÔºåËôöÊãüÊú∫Âú®Êú™Êù•ÁöÑÊÄßËÉΩÊîπËøõ‰∏≠ËÇØÂÆö‰πü‰ºöÊõ¥Âä†ÂÅèÂêë‰∫éÂéüÁîüÁöÑ synchronized„ÄÇ Âõ†Ê≠§Âú®‰∏çÈúÄË¶ÅÁî®Âà∞ ReentrantLock ‰∏â‰∏™ÁâπÊÄßÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ºòÂÖàËÄÉËôë‰ΩøÁî® synchronized Êù•ËøõË°åÂêåÊ≠•„ÄÇ 2. ÈùûÈòªÂ°ûÂêåÊ≠•‰∫íÊñ•ÂêåÊ≠•ÊúÄ‰∏ªË¶ÅÁöÑÈóÆÈ¢òÂ∞±ÊòØËøõË°åÁ∫øÁ®ãÈòªÂ°ûÂíåÂî§ÈÜíÊâÄÂ∏¶Êù•ÁöÑÊÄßËÉΩÈóÆÈ¢òÔºåÂõ†Ê≠§ËøôÁßçÂêåÊ≠•‰πüÁß∞‰∏∫ÈòªÂ°ûÂêåÊ≠•ÔºàBlocking SynchronizationÔºâ„ÄÇ‰ªéÂ§ÑÁêÜÈóÆÈ¢òÁöÑÊñπÂºè‰∏äËØ¥Ôºå‰∫íÊñ•ÂêåÊ≠•Â±û‰∫é‰∏ÄÁßçÊÇ≤ËßÇÁöÑÂπ∂ÂèëÁ≠ñÁï•ÔºåÊÄªÊòØËÆ§‰∏∫Âè™Ë¶Å‰∏çÂéªÂÅöÊ≠£Á°ÆÁöÑÂêåÊ≠•Êé™ÊñΩÔºà‰æãÂ¶ÇÂä†ÈîÅÔºâÔºåÈÇ£Â∞±ËÇØÂÆö‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ Âü∫‰∫éÂÜ≤Á™ÅÊ£ÄÊµãÁöÑ‰πêËßÇÂπ∂ÂèëÁ≠ñÁï•ÔºåÈÄö‰øóÂú∞ËØ¥ÔºåÂ∞±ÊòØÂÖàËøõË°åÊìç‰ΩúÔºå Â¶ÇÊûúÊ≤°ÊúâÂÖ∂‰ªñÁ∫øÁ®ã‰∫âÁî®ÂÖ±‰∫´Êï∞ÊçÆÔºåÈÇ£Êìç‰ΩúÂ∞±ÊàêÂäü‰∫ÜÔºõ Â¶ÇÊûúÂÖ±‰∫´Êï∞ÊçÆÊúâ‰∫âÁî®Ôºå‰∫ßÁîü‰∫ÜÂÜ≤Á™ÅÔºåÈÇ£Â∞±ÂÜçÈááÂèñÂÖ∂‰ªñÁöÑË°•ÂÅøÊé™ÊñΩÔºàÊúÄÂ∏∏ËßÅÁöÑË°•ÂÅøÊé™ÊñΩÂ∞±ÊòØ‰∏çÊñ≠Âú∞ÈáçËØïÔºåÁõ¥Âà∞ÊàêÂäü‰∏∫Ê≠¢ÔºâÔºåËøôÁßç‰πêËßÇÁöÑÂπ∂ÂèëÁ≠ñÁï•ÁöÑËÆ∏Â§öÂÆûÁé∞ÈÉΩ‰∏çÈúÄË¶ÅÊääÁ∫øÁ®ãÊåÇËµ∑ÔºåÂõ†Ê≠§ËøôÁßçÂêåÊ≠•Êìç‰ΩúÁß∞‰∏∫ÈùûÈòªÂ°ûÂêåÊ≠•ÔºàNon-Blocking SynchronizationÔºâ„ÄÇ ‰∏∫‰ªÄ‰πàËØ¥‰ΩøÁî®‰πêËßÇÂπ∂ÂèëÁ≠ñÁï•ÈúÄË¶Å ‚ÄúÁ°¨‰ª∂Êåá‰ª§ÈõÜÁöÑÂèëÂ±ï‚Äù ÊâçËÉΩËøõË°åÂë¢Ôºü Âõ†‰∏∫Êàë‰ª¨ÈúÄË¶ÅÊìç‰ΩúÂíåÂÜ≤Á™ÅÊ£ÄÊµãËøô‰∏§‰∏™Ê≠•È™§ÂÖ∑Â§áÂéüÂ≠êÊÄßÔºåÈù†‰ªÄ‰πàÊù•‰øùËØÅÂë¢ÔºüÂ¶ÇÊûúËøôÈáåÂÜç‰ΩøÁî®‰∫íÊñ•ÂêåÊ≠•Êù•‰øùËØÅÂ∞±Â§±ÂéªÊÑè‰πâ‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨Âè™ËÉΩÈù†Á°¨‰ª∂Êù•ÂÆåÊàêËøô‰ª∂‰∫ãÊÉÖÔºåÁ°¨‰ª∂‰øùËØÅ‰∏Ä‰∏™‰ªéËØ≠‰πâ‰∏äÁúãËµ∑Êù•ÈúÄË¶ÅÂ§öÊ¨°Êìç‰ΩúÁöÑË°å‰∏∫Âè™ÈÄöËøá‰∏ÄÊù°Â§ÑÁêÜÂô®Êåá‰ª§Â∞±ËÉΩÂÆåÊàê„ÄÇ ËøôÁ±ªÊåá‰ª§Â∏∏Áî®ÁöÑÊúâÔºö ÊµãËØïÂπ∂ËÆæÁΩÆÔºàTest-and-SetÔºâ„ÄÇ Ëé∑ÂèñÂπ∂Â¢ûÂä†ÔºàFetch-and-IncrementÔºâ„ÄÇ ‰∫§Êç¢ÔºàSwapÔºâ„ÄÇ ==ÊØîËæÉÂπ∂‰∫§Êç¢ÔºàCompare-and-SwapÔºå‰∏ãÊñáÁß∞ CAS==Ôºâ„ÄÇ Âä†ËΩΩÈìæÊé•/Êù°‰ª∂Â≠òÂÇ®ÔºàLoad-Linked/Store-ConditionalÔºå‰∏ãÊñáÁß∞ LL/SCÔºâ„ÄÇ Java 1.5 ‰πãÂêéÔºåJava Á®ãÂ∫è‰∏≠ÊâçÂèØ‰ª•‰ΩøÁî® CAS Êìç‰ΩúÔºåËØ•Êìç‰ΩúÁî± sun.misc.Unsafe Á±ªÈáåÈù¢ÁöÑ compareAndSwapInt()Âíå compareAndSwapLong() Á≠âÂá†‰∏™ÊñπÊ≥ïÂåÖË£ÖÊèê‰æõÔºåËôöÊãüÊú∫Âú®ÂÜÖÈÉ®ÂØπËøô‰∫õÊñπÊ≥ïÂÅö‰∫ÜÁâπÊÆäÂ§ÑÁêÜÔºåÂç≥Êó∂ÁºñËØëÂá∫Êù•ÁöÑÁªìÊûúÂ∞±ÊòØ‰∏ÄÊù°Âπ≥Âè∞Áõ∏ÂÖ≥ÁöÑÂ§ÑÁêÜÂô® CAS Êåá‰ª§„ÄÇ CAS Êåá‰ª§ÈúÄË¶ÅÊúâ 3 ‰∏™Êìç‰ΩúÊï∞ÔºåÂàÜÂà´ÊòØÂÜÖÂ≠ò‰ΩçÁΩÆÔºàÂú® Java ‰∏≠ÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫ÂèòÈáèÁöÑÂÜÖÂ≠òÂú∞ÂùÄÔºåÁî® V Ë°®Á§∫Ôºâ„ÄÅÊóßÁöÑÈ¢ÑÊúüÂÄºÔºàÁî® A Ë°®Á§∫ÔºâÂíåÊñ∞ÂÄºÔºàÁî® B Ë°®Á§∫Ôºâ„ÄÇCAS Êåá‰ª§ÊâßË°åÊó∂ÔºåÂΩì‰∏î‰ªÖÂΩì V Á¨¶ÂêàÊóßÈ¢ÑÊúüÂÄº A Êó∂ÔºåÂ§ÑÁêÜÂô®Áî®Êñ∞ÂÄº B Êõ¥Êñ∞ V ÁöÑÂÄºÔºåÂê¶ÂàôÂÆÉÂ∞±‰∏çÊâßË°åÊõ¥Êñ∞Ôºå‰ΩÜÊòØÊó†ËÆ∫ÊòØÂê¶Êõ¥Êñ∞‰∫Ü V ÁöÑÂÄºÔºåÈÉΩ‰ºöËøîÂõû V ÁöÑÊóßÂÄºÔºå‰∏äËø∞ÁöÑÂ§ÑÁêÜËøáÁ®ãÊòØ‰∏Ä‰∏™ÂéüÂ≠êÊìç‰Ωú„ÄÇ Unsafe Á±ª‰∏çÊòØÊèê‰æõÁªôÁî®Êà∑Á®ãÂ∫èË∞ÉÁî®ÁöÑÁ±ªÔºàUnsafe.getUnsafe()ÁöÑ‰ª£Á†Å‰∏≠ÈôêÂà∂‰∫ÜÂè™ÊúâÂêØÂä®Á±ªÂä†ËΩΩÂô®ÔºàBootstrap ClassLoaderÔºâÂä†ËΩΩÁöÑ Class ÊâçËÉΩËÆøÈóÆÂÆÉÔºâÔºåÂõ†Ê≠§ÔºåÂ¶ÇÊûú‰∏çÈááÁî®ÂèçÂ∞ÑÊâãÊÆµÔºåÊàë‰ª¨Âè™ËÉΩÈÄöËøáÂÖ∂‰ªñÁöÑ Java API Êù•Èó¥Êé•‰ΩøÁî®ÂÆÉ„ÄÇ Â¶Ç J.U.CÔºàjava.util.concurrentÔºâ ÂåÖÈáåÈù¢ÁöÑÊï¥Êï∞ÂéüÂ≠êÁ±ªÔºåÂÖ∂‰∏≠ÁöÑ compareAndSet()Âíå getAndIncrement()Á≠âÊñπÊ≥ïÈÉΩ‰ΩøÁî®‰∫Ü Unsafe Á±ªÁöÑ CAS Êìç‰Ωú„ÄÇ 12345678public final int incrementAndGet()&#123; forÔºà;;Ôºâ&#123; int current = get()Ôºõ int next = current+1Ôºõ ifÔºàcompareAndSetÔºàcurrent,nextÔºâÔºâ return nextÔºõ &#125;&#125; CAS Â≠òÂú®ÁöÑÈóÆÈ¢òÔºö Êó†Ê≥ïÊ∂µÁõñ‰∫íÊñ•ÂêåÊ≠•ÁöÑÊâÄÊúâ‰ΩøÁî®Âú∫ÊôØ Â≠òÂú®==ABA ÈóÆÈ¢ò==ÔºåÂÄºÊîπ‰∫Ü‰ΩÜÊòØËá™Â∑±Âç¥‰∏çÁü•ÈÅì„ÄÇ ÊÄé‰πàËß£ÂÜ≥Ôºü Âä†ÂÖ•ÂºïÁî®ËÆ°Êï∞„ÄÇ Âä†ÂÖ•‰øÆÊîπËÆ∞ÂΩï ÂèØÈáçÂÖ•‰ª£Á†ÅÔºàReentrant CodeÔºâÔºöËøôÁßç‰ª£Á†Å‰πüÂè´ÂÅöÁ∫Ø‰ª£Á†ÅÔºàPure CodeÔºâÔºåÂèØ‰ª•Âú®‰ª£Á†ÅÊâßË°åÁöÑ‰ªª‰ΩïÊó∂Âàª‰∏≠Êñ≠ÂÆÉÔºåËΩ¨ËÄåÂéªÊâßË°åÂè¶Â§ñ‰∏ÄÊÆµ‰ª£Á†ÅÔºàÂåÖÊã¨ÈÄíÂΩíË∞ÉÁî®ÂÆÉÊú¨Ë∫´ÔºâÔºåËÄåÂú®ÊéßÂà∂ÊùÉËøîÂõûÂêéÔºåÂéüÊù•ÁöÑÁ®ãÂ∫è‰∏ç‰ºöÂá∫Áé∞‰ªª‰ΩïÈîôËØØ„ÄÇ ÂèØÈáçÂÖ•‰ª£Á†ÅÁöÑ‰∏Ä‰∫õÂÖ±ÂêåÁöÑÁâπÂæÅÔºö ‰∏ç‰æùËµñÂ≠òÂÇ®Âú®Â†Ü‰∏äÁöÑÊï∞ÊçÆÂíåÂÖ¨Áî®ÁöÑÁ≥ªÁªüËµÑÊ∫ê„ÄÅ Áî®Âà∞ÁöÑÁä∂ÊÄÅÈáèÈÉΩÁî±ÂèÇÊï∞‰∏≠‰º†ÂÖ•„ÄÅ ‰∏çË∞ÉÁî®ÈùûÂèØÈáçÂÖ•ÁöÑÊñπÊ≥ïÁ≠â„ÄÇ Âà§Êñ≠‰ª£Á†ÅÊòØÂê¶ÂÖ∑Â§áÂèØÈáçÂÖ•ÊÄßÔºöÂ¶ÇÊûú‰∏Ä‰∏™ÊñπÊ≥ïÔºåÂÆÉÁöÑËøîÂõûÁªìÊûúÊòØÂèØ‰ª•È¢ÑÊµãÁöÑÔºå‰πüÂ∞±ÊòØËØ¥Âè™Ë¶ÅËæìÂÖ•‰∫ÜÁõ∏ÂêåÁöÑÊï∞ÊçÆÔºåÂ∞±ÈÉΩËÉΩËøîÂõûÁõ∏ÂêåÁöÑÁªìÊûúÔºåÈÇ£ÂÆÉÂ∞±Êª°Ë∂≥ÂèØÈáçÂÖ•ÊÄßÁöÑË¶ÅÊ±ÇÔºåÂΩìÁÑ∂‰πüÂ∞±ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ 3. Êó†ÂêåÊ≠•ÊñπÊ°à‰∏Ä‰∏™Êï∞ÊçÆÁöÑÂèØËßÅËåÉÂõ¥Â±ÄÈôêÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰πãÂÜÖÔºå ‰∏ç‰ºöÂ≠òÂú®Â§öÁ∫øÁ®ãÁ´û‰∫âÈóÆÈ¢òÔºå‰πüÂ∞±‰∏çÈúÄË¶ÅËøõË°åÂêåÊ≠•‰∫Ü„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™ÂèòÈáèË¶ÅË¢´Êüê‰∏™Á∫øÁ®ãÁã¨‰∫´ÔºåJava ‰∏≠ÂèØ‰ª•ÈÄöËøá java.lang.ThreadLocal Á±ªÊù•ÂÆûÁé∞Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®ÁöÑÂäüËÉΩ„ÄÇÊØè‰∏Ä‰∏™Á∫øÁ®ãÁöÑ Thread ÂØπË±°‰∏≠ÈÉΩÊúâ‰∏Ä‰∏™ ThreadLocalMap ÂØπË±°ÔºåËøô‰∏™ÂØπË±°Â≠òÂÇ®‰∫Ü‰∏ÄÁªÑ‰ª• ThreadLocal.threadLocalHashCode ‰∏∫ÈîÆÔºå‰ª•Êú¨Âú∞Á∫øÁ®ãÂèòÈáè‰∏∫ÂÄºÁöÑ K-V ÂÄºÂØπÔºåThreadLocal ÂØπË±°Â∞±ÊòØÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÁöÑËÆøÈóÆÂÖ•Âè£ÔºåÊØè‰∏Ä‰∏™ ThreadLocal ÂØπË±°ÈÉΩÂåÖÂê´‰∫Ü‰∏Ä‰∏™Áã¨‰∏ÄÊó†‰∫åÁöÑ threadLocalHashCode ÂÄºÔºå‰ΩøÁî®Ëøô‰∏™ÂÄºÂ∞±ÂèØ‰ª•Âú®Á∫øÁ®ã K-V ÂÄºÂØπ‰∏≠ÊâæÂõûÂØπÂ∫îÁöÑÊú¨Âú∞Á∫øÁ®ãÂèòÈáè„ÄÇ 2. Java ‰∏≠ÈîÅÁöÑÂàÜÁ±ª‰∏é‰ºòÂåñÂèØÈáçÂÖ•ÈîÅÂèàÁß∞‰∏∫„ÄåÈÄíÂΩíÈîÅ„ÄçÔºåÊåáÁöÑÊòØÂΩìÂêå‰∏Ä‰∏™Á∫øÁ®ãÁöÑÂ§ñÂ±ÇÊñπÊ≥ïËé∑ÂèñÈîÅÊó∂ÔºåËøõÂÖ•ÂÜÖÂ±ÇÊñπÊ≥ï‰ºöËá™Âä®Ëé∑ÂèñÈîÅ„ÄÇ ÂèØÈáçÂÖ•ÈîÅÁöÑ‰∏Ä‰∏™Â•ΩÂ§ÑÂ∞±ÊòØÂèØ‰ª•Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÈÅøÂÖçÊ≠ªÈîÅ„ÄÇ 123456synchronized void setA() throws Exception &#123; Thread.sleep(1000); synchronized(this) &#123; Thread.sleep(1000); &#125;&#125; Áã¨‰∫´(Âç†)ÈîÅ/ÂÖ±‰∫´ÈîÅÊ†πÊçÆËÉΩÂ§üÂêåÊó∂Ë¢´Â§öÂ∞ëÁ∫øÁ®ãÊåÅÊúâÊù•Âå∫ÂàÜ„ÄÇ Áã¨‰∫´ÈîÅÂ∞±ÊòØÊåáËØ•ÈîÅ‰∏ÄÊ¨°‰ªÖËÉΩË¢´‰∏Ä‰∏™Á∫øÁ®ãÊâÄÊåÅÊúâ„ÄÇ ÂÖ±‰∫´ÈîÅÂèØ‰ª•ÂêåÊó∂Ë¢´Â§ö‰∏™Á∫øÁ®ãÊåÅÊúâ„ÄÇ ‰∫íÊñ•ÈîÅ/ËØªÂÜôÈîÅ‰∏äÈù¢ËÆ≤ÁöÑÁã¨‰∫´ÈîÅ/ÂÖ±‰∫´ÈîÅÂ∞±ÊòØ‰∏ÄÁßçÂπø‰πâÁöÑËØ¥Ê≥ïÔºå‰∫íÊñ•ÈîÅ/ËØªÂÜôÈîÅÂ∞±ÊòØÂÖ∑‰ΩìÁöÑÂÆûÁé∞„ÄÇ ‰∫íÊñ•ÈîÅÔºöÂú® Java ‰∏≠ÁöÑÂÖ∑‰ΩìÂ∞±ÊòØ ReentrantLock ËØªÂÜôÈîÅÔºöÂú® Java ‰∏≠ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Â∞±ÊòØ ReadWriteLock„ÄÇÂÖ∂ËØªÈîÅÊòØÂÖ±‰∫´ÈîÅÔºåÂÖ∂ÂÜôÈîÅÊòØÁã¨‰∫´ÈîÅ„ÄÇ ËØªÈîÅÁöÑÂÖ±‰∫´ÂèØ‰øùËØÅÈ´òÊïàÂπ∂Âèë„ÄÇ ËØªÂÜô„ÄÅÂÜôËØª„ÄÅÂÜôÂÜôÁöÑËøáÁ®ãÊòØ‰∫íÊñ•ÁöÑ Áã¨‰∫´ÈîÅ‰∏éÂÖ±‰∫´ÈîÅ‰πüÊòØ‰ΩøÁî® AQS Êù•ÂÆûÁé∞ÁöÑ„ÄÇÈÄöËøáÂÆûÁé∞‰∏çÂêåÁöÑÊñπÊ≥ïÊù•ÂÆûÁé∞Áã¨‰∫´ÊàñËÄÖÂÖ±‰∫´„ÄÇ ‰πêËßÇÈîÅ/ÊÇ≤ËßÇÈîÅÂπ∂‰∏çÊòØÊåáÂÖ∑‰ΩìÁ±ªÂûãÁöÑÈîÅÔºåËÄåÊòØÊåáÁúãÂæÖÂπ∂ÂèëÂêåÊ≠•ÁöÑÊÄÅÂ∫¶„ÄÇ ÊÇ≤ËßÇÈîÅÈááÁî®‰∏ÄÁßçÊÇ≤ËßÇÁöÑÂπ∂ÂèëÁ≠ñÁï•ÔºåÊÄªÊòØËÆ§‰∏∫Âè™Ë¶Å‰∏çÂéªÂÅöÊ≠£Á°ÆÁöÑÂêåÊ≠•Êé™ÊñΩÔºà‰æãÂ¶ÇÂä†ÈîÅÔºâÔºåÈÇ£Â∞±ËÇØÂÆö‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇÊâÄË∞ì‰πêËßÇÈîÅÂ∞±ÊòØÔºåÊØèÊ¨°‰∏çÂä†ÈîÅËÄåÊòØÂÅáËÆæÊ≤°ÊúâÂÜ≤Á™ÅËÄåÂéªÂÆåÊàêÊüêÈ°πÊìç‰ΩúÔºåÂ¶ÇÊûúÂõ†‰∏∫ÂÜ≤Á™ÅÂ§±Ë¥•Â∞±ÈáçËØïÔºåÁõ¥Âà∞ÊàêÂäü‰∏∫Ê≠¢„ÄÇ‰πêËßÇÈîÅ‰∏çËÉΩËß£ÂÜ≥ËÑèËØªÁöÑÈóÆÈ¢ò„ÄÇ ‰∫åËÄÖ‰πãÈó¥Â¶Ç‰ΩïÈÄâÊã©ÈÄâÊã©ÔºüÈ¶ñÂÖàË¶ÅÂºÑÊ∏ÖÊ•öÔºå‰∫ãÂÆûÊòØÊÇ≤ËßÇÁöÑËøòÊòØ‰πêËßÇÁöÑÔºü ÂÅáÂ¶Ç‰Ω†ÁöÑËµÑÊ∫êÁ´û‰∫âÂæàÊøÄÁÉàÔºåÂπ∂‰∏îÊó†Ê≥ïÂÖ±‰∫´ÁöÑËØùÔºå‰πêËßÇÈîÅ‰∏çËøáÊòØËÆ©Â§ßÈáèËØ∑Ê±ÇÁöÑÂ∏åÊúõËêΩÁ©∫ÁΩ¢‰∫Ü„ÄÇ‚Äî‚ÄîÂ¶ÇÊûú‰∫ãÂÆûÊòØÊÇ≤ËßÇÁöÑÔºå‰ΩÜÊòØÈááÁî®‰∫Ü‰πêËßÇÈîÅÔºåÈÇ£Â∞±Âè™‰ºöÂØºËá¥Â§ßÈáèËØ∑Ê±ÇËêΩÁ©∫ÁΩ¢‰∫Ü„ÄÇ ÂÅáÂ¶Ç‰Ω†ÁöÑËµÑÊ∫êÊ≤°‰ªÄ‰πàÁ´û‰∫âÔºàËøô‰∏™ÂíåÂπ∂ÂèëÈ´ò‰ΩéÊ≤°ÂøÖÁÑ∂ÁöÑÂÖ≥ËÅîÔºå‰∏öÂä°ÁöÑÂΩ±ÂìçÊõ¥Â§ßÔºâÔºåÈÇ£ÊÇ≤ËßÇÈîÅÊÑèÂë≥ÁùÄ‰∏çÂøÖË¶ÅÂú∞Âä†ÈîÅ„ÄÇÂ¶ÇÊûúÂéüÊú¨ÊòØÂèØÂÖ±‰∫´ÁöÑËµÑÊ∫êÔºàÊØîÂ¶ÇËµÑÊ∫êÊîØÊåÅÂ§ö‰∏™Âè™ËØªÊñπÔºâÔºåÈÇ£‰πàÊÇ≤ËßÇÈîÅÊÑèÂë≥ÁùÄÂ§±ÂéªÂéüÊú¨ÁöÑÂèØ‰ª•‰ΩøÁî®ÁöÑÊó∂Èó¥„ÄÇ‚Äî‚ÄîÂ¶ÇÊûú‰∫ãÂÆûÊòØ‰πêËßÇÁöÑÔºå‰ΩÜÊòØ‰ΩøÁî®‰∫ÜÊÇ≤ËßÇÈîÅÔºåÈÇ£‰πàÂ∞±ÊçüÂ§±‰∏Ä‰∫õÊú¨Êù•ÂèØ‰ª•‰ΩøÁî®ÁöÑÊó∂Èó¥„ÄÇ ÂÜçËØ¶ÁªÜÁÇπÂèØ‰ª•‰ªé‰ª•‰∏ãÂá†‰∏™ÊñπÈù¢Êù•Âà§Êñ≠Ôºö ÂìçÂ∫îÈÄüÂ∫¶ÔºöÂ¶ÇÊûúÈúÄË¶ÅÈùûÂ∏∏È´òÁöÑÂìçÂ∫îÈÄüÂ∫¶ÔºåÂª∫ËÆÆÈááÁî®‰πêËßÇÈîÅÊñπÊ°àÔºåÊàêÂäüÂ∞±ÊâßË°åÔºå‰∏çÊàêÂäüÂ∞±Â§±Ë¥•Ôºå‰∏çÈúÄË¶ÅÁ≠âÂæÖÂÖ∂‰ªñÂπ∂ÂèëÂéªÈáäÊîæÈîÅ„ÄÇ ÂÜ≤Á™ÅÈ¢ëÁéáÔºöÂ¶ÇÊûúÂÜ≤Á™ÅÈ¢ëÁéáÈùûÂ∏∏È´òÔºåÂª∫ËÆÆÈááÁî®ÊÇ≤ËßÇÈîÅÔºå‰øùËØÅÊàêÂäüÁéáÔºåÂ¶ÇÊûúÂÜ≤Á™ÅÈ¢ëÁéáÂ§ßÔºå‰πêËßÇÈîÅ‰ºöÈúÄË¶ÅÂ§öÊ¨°ÈáçËØïÊâçËÉΩÊàêÂäüÔºå‰ª£‰ª∑ÊØîËæÉÂ§ß„ÄÇ ÈáçËØï‰ª£‰ª∑ÔºöÂ¶ÇÊûúÈáçËØï‰ª£‰ª∑Â§ßÔºåÂª∫ËÆÆÈááÁî®ÊÇ≤ËßÇÈîÅ„ÄÇ ‰ª•‰∏äÂÜÖÂÆπÂèÇËÄÉËá™È´òÂπ∂Âèë‰∏ãÊÇ≤ËßÇÈîÅ‰∏é‰πêËßÇÈîÅÁöÑÈÄâÊã©ÈóÆÈ¢ò ÂàÜÊÆµÈîÅÂàÜÊÆµÈîÅÂÖ∂ÂÆûÊòØ‰∏ÄÁßçÈîÅÁöÑËÆæËÆ°ÔºåÂπ∂‰∏çÊòØÂÖ∑‰ΩìÁöÑ‰∏ÄÁßçÈîÅ„ÄÇ Êàë‰ª¨‰ª•ConcurrentHashMapÊù•ËØ¥‰∏Ä‰∏ãÂàÜÊÆµÈîÅÁöÑÂê´‰πâ‰ª•ÂèäËÆæËÆ°ÊÄùÊÉ≥ÔºåConcurrentHashMap‰∏≠ÁöÑÂàÜÊÆµÈîÅÁß∞‰∏∫ SegmentÔºåÂÆÉÂç≥Á±ª‰ºº‰∫é HashMapÔºàJava7 ‰∏é Java8 ‰∏≠ HashMap ÁöÑÂÆûÁé∞ÔºâÁöÑÁªìÊûÑÔºåÂç≥ÂÜÖÈÉ®Êã•Êúâ‰∏Ä‰∏™ Entry Êï∞ÁªÑÔºåÊï∞ÁªÑ‰∏≠ÁöÑÊØè‰∏™ÂÖÉÁ¥†ÂèàÊòØ‰∏Ä‰∏™ÈìæË°®ÔºõÂêåÊó∂ÂèàÊòØ‰∏Ä‰∏™ ReentrantLockÔºàSegment ÁªßÊâø‰∫Ü ReentrantLock)„ÄÇÂΩìÈúÄË¶Å put ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏çÊòØÂØπÊï¥‰∏™ hashmap ËøõË°åÂä†ÈîÅÔºåËÄåÊòØÂÖàÈÄöËøá hashcode Êù•Áü•ÈÅì‰ªñË¶ÅÊîæÂú®ÈÇ£‰∏Ä‰∏™ÂàÜÊÆµ‰∏≠ÔºåÁÑ∂ÂêéÂØπËøô‰∏™ÂàÜÊÆµËøõË°åÂä†ÈîÅÔºåÊâÄ‰ª•ÂΩìÂ§öÁ∫øÁ®ã put ÁöÑÊó∂ÂÄôÔºåÂè™Ë¶Å‰∏çÊòØÊîæÂú®‰∏Ä‰∏™ÂàÜÊÆµ‰∏≠ÔºåÂ∞±ÂÆûÁé∞‰∫ÜÁúüÊ≠£ÁöÑÂπ∂Ë°åÁöÑÊèíÂÖ•„ÄÇ ‰ΩÜÊòØÔºåÂú®ÁªüËÆ° size ÁöÑÊó∂ÂÄôÔºåÂèØÂ∞±ÊòØËé∑Âèñ hashmap ÂÖ®Â±Ä‰ø°ÊÅØÁöÑÊó∂ÂÄôÔºåÂ∞±ÈúÄË¶ÅËé∑ÂèñÊâÄÊúâÁöÑÂàÜÊÆµÈîÅÊâçËÉΩÁªüËÆ°„ÄÇÂàÜÊÆµÈîÅÁöÑËÆæËÆ°ÁõÆÁöÑÊòØÁªÜÂåñÈîÅÁöÑÁ≤íÂ∫¶ÔºåÂΩìÊìç‰Ωú‰∏çÈúÄË¶ÅÊõ¥Êñ∞Êï¥‰∏™Êï∞ÁªÑÁöÑÊó∂ÂÄôÔºåÂ∞±‰ªÖ‰ªÖÈíàÂØπÊï∞ÁªÑ‰∏≠ÁöÑ‰∏ÄÈ°πËøõË°åÂä†ÈîÅÊìç‰Ωú„ÄÇ ÂÅèÂêëÈîÅ/ËΩªÈáèÁ∫ßÈîÅ/ÈáçÈáèÁ∫ßÈîÅËøô‰∏âÁßçÈîÅÊòØÊåáÈîÅÁöÑÁä∂ÊÄÅÔºåÂπ∂‰∏îÊòØÈíàÂØπSynchronized ÁöÑ„ÄÇÂú® Java1.5 ÈÄöËøáÂºïÂÖ•ÈîÅÂçáÁ∫ßÁöÑÊú∫Âà∂Êù•ÂÆûÁé∞È´òÊïàÁöÑSynchronized„ÄÇËøô‰∏âÁßçÈîÅÁöÑÁä∂ÊÄÅÊòØÈÄöËøáÂØπË±°ÁõëËßÜÂô®Âú®ÂØπË±°Â§¥‰∏≠ÁöÑÂ≠óÊÆµÊù•Ë°®ÊòéÁöÑ„ÄÇ ÂÅèÂêëÈîÅÔºöÂΩì‰∏ÄÊÆµÂêåÊ≠•‰ª£Á†ÅÊÄªÊòØË¢´‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆÁöÑÊó∂ÂÄôÔºå ÈÇ£‰πàËØ•Á∫øÁ®ãÂ∞±‰ºöËá™Âä®Ëé∑ÂèñÈîÅÔºåÈôç‰ΩéËé∑ÂèñÈîÅÁöÑ‰ª£‰ª∑„ÄÇÂ¶ÇÊûúËØ¥ËΩªÈáèÁ∫ßÈîÅÊòØÂú®Êó†Á´û‰∫âÁöÑÊÉÖÂÜµ‰∏ã‰ΩøÁî® CAS Êìç‰ΩúÂéªÊ∂àÈô§ÂêåÊ≠•‰ΩøÁî®ÁöÑ‰∫íÊñ•ÈáèÔºåÈÇ£ÂÅèÂêëÈîÅÂ∞±ÊòØÂú®Êó†Á´û‰∫âÁöÑÊÉÖÂÜµ‰∏ãÊääÊï¥‰∏™ÂêåÊ≠•ÈÉΩÊ∂àÈô§ÊéâÔºåËøû CAS Êìç‰ΩúÈÉΩ‰∏çÂÅö‰∫Ü„ÄÇÂÅèÂêëÈîÅÁöÑ‚ÄúÂÅè‚ÄùÔºåÊÑèÊÄùÊòØËøô‰∏™ÈîÅ‰ºöÂÅèÂêë‰∫éÁ¨¨‰∏Ä‰∏™Ëé∑ÂæóÂÆÉÁöÑÁ∫øÁ®ãÔºåÂ¶ÇÊûúÂú®Êé•‰∏ãÊù•ÁöÑÊâßË°åËøáÁ®ã‰∏≠ÔºåËØ•ÈîÅÊ≤°ÊúâË¢´ÂÖ∂‰ªñÁöÑÁ∫øÁ®ãËé∑ÂèñÔºåÂàôÊåÅÊúâÂÅèÂêëÈîÅÁöÑÁ∫øÁ®ãÂ∞ÜÊ∞∏Ëøú‰∏çÈúÄË¶ÅÂÜçËøõË°åÂêåÊ≠•„ÄÇ ËΩªÈáèÁ∫ßÈîÅÔºöÂΩìÈîÅÊòØÂÅèÂêëÈîÅÊó∂ÔºàÂõ†‰∏∫ÁªèÂ∏∏Ë¢´‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆÔºâÔºåÂΩìÂè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ãÈúÄË¶ÅËÆøÈóÆÁõ∏Â∫îÁöÑÂêåÊ≠•‰ª£Á†ÅÊÆµÊó∂ÔºåÂÅèÂêëÈîÅ‰ºöÂçáÁ∫ß‰∏∫ËΩªÈáèÁ∫ßÈîÅÔºåÂÖ∂‰ªñÁ∫øÁ®ã‰ºöÈÄöËøáËá™ÊóãÁöÑÊñπÂºèÂ∞ùËØïÂéªËé∑ÂèñÈîÅÔºåËΩªÈáèÁ∫ßÈîÅÂπ∂‰∏çÊòØÁî®Êù•‰ª£ÊõøÈáçÈáèÁ∫ßÈîÅÁöÑÔºåÂÆÉÁöÑÊú¨ÊÑèÊòØÂú®Ê≤°ÊúâÂ§öÁ∫øÁ®ãÁ´û‰∫âÁöÑÂâçÊèê‰∏ãÔºåÂáèÂ∞ë‰º†ÁªüÁöÑÈáçÈáèÁ∫ßÈîÅ‰ΩøÁî®Êìç‰ΩúÁ≥ªÁªü‰∫íÊñ•Èáè‰∫ßÁîüÁöÑÊÄßËÉΩÊ∂àËÄó„ÄÇ ÈáçÈáèÁ∫ßÈîÅÔºöËá™ÊóãËææÂà∞‰∏ÄÂÆöÊ¨°Êï∞‰πãÂêéÔºåÂ∞±‰ºöËÜ®ËÉÄ‰∏∫ÈáçÈáèÁ∫ßÈîÅ„ÄÇÈáçÈáèÁ∫ßÈîÅ‰ºö‰ΩøÂÖ∂‰ªñÁî≥ËØ∑Á∫øÁ®ãËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ ÈîôËØØËßÇÁÇπÔºöÈîÅÂèØ‰ª•ÂçáÁ∫ß‰ΩÜ‰∏çËÉΩÈôçÁ∫ßÔºåÊÑèÂë≥ÁùÄÂÅèÂêëÈîÅÂçáÁ∫ßÊàêËΩªÈáèÁ∫ßÈîÅÂêé‰∏çËÉΩÈôçÁ∫ßÊàêÂÅèÂêëÈîÅ„ÄÇÂÖ∑‰ΩìÂèØ‰ª•ÂèÇËÄÉ‰∏ãËøôÁØáÊñáÁ´† ÈîÅÁöÑÂçáÁ∫ßÔºö ÂÅèÂêëÈîÅÁöÑÂÆûÁé∞ÂÅáËÆæÂΩìÂâçËôöÊãüÊú∫ÂêØÁî®‰∫ÜÂÅèÂêëÈîÅÔºåÈÇ£‰πàÔºåÂΩìÈîÅÂØπË±°Á¨¨‰∏ÄÊ¨°Ë¢´Á∫øÁ®ãËé∑ÂèñÁöÑÊó∂ÂÄôÔºåËôöÊãüÊú∫Â∞Ü‰ºöÊääÂØπË±°Â§¥‰∏≠ÁöÑÊ†áÂøó‰ΩçËÆæ‰∏∫‚Äú01‚ÄùÔºåÂç≥ÂÅèÂêëÊ®°Âºè„ÄÇÂêåÊó∂‰ΩøÁî® CAS Êìç‰ΩúÊääËé∑ÂèñÂà∞Ëøô‰∏™ÈîÅÁöÑÁ∫øÁ®ãÁöÑ ID ËÆ∞ÂΩïÂú®ÂØπË±°ÁöÑ Mark Word ‰πã‰∏≠Ôºå Â¶ÇÊûú CAS Êìç‰ΩúÊàêÂäüÔºåÊåÅÊúâÂÅèÂêëÈîÅÁöÑÁ∫øÁ®ã‰ª•ÂêéÊØèÊ¨°ËøõÂÖ•Ëøô‰∏™ÈîÅÁõ∏ÂÖ≥ÁöÑÂêåÊ≠•ÂùóÊó∂ÔºåËôöÊãüÊú∫ÈÉΩÂèØ‰ª•‰∏çÂÜçËøõË°å‰ªª‰ΩïÂêåÊ≠•Êìç‰ΩúÔºà‰æãÂ¶Ç Locking„ÄÅUnlocking ÂèäÂØπ Mark Word ÁöÑ Update Á≠âÔºâ„ÄÇ ÂΩìÊúâÂè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ãÂéªÂ∞ùËØïËé∑ÂèñËøô‰∏™ÈîÅÊó∂ÔºåÂÅèÂêëÊ®°ÂºèÂ∞±ÂÆ£ÂëäÁªìÊùü„ÄÇ Ê†πÊçÆÈîÅÂØπË±°ÁõÆÂâçÊòØÂê¶Â§Ñ‰∫éË¢´ÈîÅÂÆöÁöÑÁä∂ÊÄÅÔºåÊí§ÈîÄÂÅèÂêëÔºàRevoke BiasÔºâÂêéÊÅ¢Â§çÂà∞Êú™ÈîÅÂÆöÔºàÊ†áÂøó‰Ωç‰∏∫‚Äú01‚ÄùÔºâÊàñËΩªÈáèÁ∫ßÈîÅÂÆöÔºàÊ†áÂøó‰Ωç‰∏∫‚Äú00‚ÄùÔºâÁöÑÁä∂ÊÄÅÔºå ÂêéÁª≠ÁöÑÂêåÊ≠•Êìç‰ΩúÂ∞±Â¶Ç‰∏äÈù¢‰ªãÁªçÁöÑËΩªÈáèÁ∫ßÈîÅÈÇ£Ê†∑ÊâßË°å„ÄÇ ÂõæÁâáÂèÇËÄÉËá™ËÅäËÅäÂπ∂ÂèëÔºà‰∫åÔºâ‚Äî‚ÄîJava SE1.6‰∏≠ÁöÑSynchronized ËΩªÈáèÁ∫ßÈîÅËΩªÈáèÁ∫ßÈîÅÁöÑÂä†ÈîÅËøáÁ®ãÂú®‰ª£Á†ÅËøõÂÖ•ÂêåÊ≠•ÂùóÁöÑÊó∂ÂÄôÔºå Â¶ÇÊûúÊ≠§ÂêåÊ≠•ÂØπË±°Ê≤°ÊúâË¢´ÈîÅÂÆöÔºàÈîÅÊ†áÂøó‰Ωç‰∏∫‚Äú01‚ÄùÁä∂ÊÄÅÔºâÔºåËôöÊãüÊú∫È¶ñÂÖàÂ∞ÜÂú®ÂΩìÂâçÁ∫øÁ®ãÁöÑÊ†àÂ∏ß‰∏≠Âª∫Á´ã‰∏Ä‰∏™Âêç‰∏∫ÈîÅËÆ∞ÂΩïÔºàLock RecordÔºâÁöÑÁ©∫Èó¥ÔºåÁî®‰∫éÂ≠òÂÇ®ÈîÅÂØπË±°ÁõÆÂâçÁöÑ Mark Word ÁöÑÊã∑Ë¥ùÔºàÂÆòÊñπÊääËøô‰ªΩÊã∑Ë¥ùÂä†‰∫Ü‰∏Ä‰∏™ Displaced ÂâçÁºÄÔºåÂç≥ Displaced Mark WordÔºâÔºåËøôÊó∂ÂÄôÁ∫øÁ®ãÂ†ÜÊ†à‰∏éÂØπË±°Â§¥ÁöÑÁä∂ÊÄÅÂ¶ÇÂõæ 13-3 ÊâÄÁ§∫„ÄÇ ÁÑ∂ÂêéÔºåËôöÊãüÊú∫Â∞Ü‰ΩøÁî® CAS Êìç‰ΩúÂ∞ùËØïÂ∞ÜÂØπË±°ÁöÑ Mark Word Êõ¥Êñ∞‰∏∫ÊåáÂêë Lock Record ÁöÑÊåáÈíà„ÄÇ Â¶ÇÊûúËøô‰∏™Êõ¥Êñ∞Âä®‰ΩúÊàêÂäü‰∫ÜÔºåÈÇ£‰πàËøô‰∏™Á∫øÁ®ãÂ∞±Êã•Êúâ‰∫ÜËØ•ÂØπË±°ÁöÑÈîÅÔºåÂπ∂‰∏îÂØπË±° Mark Word ÁöÑÈîÅÊ†áÂøó‰ΩçÔºàMark Word ÁöÑÊúÄÂêé 2bitÔºâÂ∞ÜËΩ¨Âèò‰∏∫‚Äú00‚ÄùÔºåÂç≥Ë°®Á§∫Ê≠§ÂØπË±°Â§Ñ‰∫éËΩªÈáèÁ∫ßÈîÅÂÆöÁä∂ÊÄÅÔºåËøôÊó∂ÂÄôÁ∫øÁ®ãÂ†ÜÊ†à‰∏éÂØπË±°Â§¥ÁöÑÁä∂ÊÄÅÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ Â¶ÇÊûúËøô‰∏™Êõ¥Êñ∞Êìç‰ΩúÂ§±Ë¥•‰∫ÜÔºåËôöÊãüÊú∫È¶ñÂÖà‰ºöÊ£ÄÊü•ÂØπË±°ÁöÑ Mark Word ÊòØÂê¶ÊåáÂêëÂΩìÂâçÁ∫øÁ®ãÁöÑÊ†àÂ∏ßÔºå Â¶ÇÊûúÂè™ËØ¥ÊòéÂΩìÂâçÁ∫øÁ®ãÂ∑≤ÁªèÊã•Êúâ‰∫ÜËøô‰∏™ÂØπË±°ÁöÑÈîÅÔºåÈÇ£Â∞±ÂèØ‰ª•Áõ¥Êé•ËøõÂÖ•ÂêåÊ≠•ÂùóÁªßÁª≠ÊâßË°åÔºå Âê¶ÂàôËØ¥ÊòéËøô‰∏™ÈîÅÂØπË±°Â∑≤ÁªèË¢´ÂÖ∂‰ªñÁ∫øÁ®ãÊä¢Âç†‰∫Ü„ÄÇ Â¶ÇÊûúÊúâ‰∏§Êù°‰ª•‰∏äÁöÑÁ∫øÁ®ã‰∫âÁî®Âêå‰∏Ä‰∏™ÈîÅÔºåÈÇ£ËΩªÈáèÁ∫ßÈîÅÂ∞±‰∏çÂÜçÊúâÊïàÔºåË¶ÅËÜ®ËÉÄ‰∏∫ÈáçÈáèÁ∫ßÈîÅÔºåÈîÅÊ†áÂøóÁöÑÁä∂ÊÄÅÂÄºÂèò‰∏∫‚Äú10‚ÄùÔºåMark Word ‰∏≠Â≠òÂÇ®ÁöÑÂ∞±ÊòØÊåáÂêëÈáçÈáèÁ∫ßÈîÅÔºà‰∫íÊñ•ÈáèÔºâÁöÑÊåáÈíàÔºåÂêéÈù¢Á≠âÂæÖÈîÅÁöÑÁ∫øÁ®ã‰πüË¶ÅËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ ÂõæÁâáÂèÇËÄÉËá™ËÅäËÅäÂπ∂ÂèëÔºà‰∫åÔºâ‚Äî‚ÄîJava SE1.6‰∏≠ÁöÑSynchronized ËΩªÈáèÁ∫ßÈîÅÁöÑËß£ÈîÅËøáÁ®ãËß£ÈîÅËøáÁ®ã‰πüÊòØÈÄöËøá CAS Êìç‰ΩúÊù•ËøõË°åÁöÑ Â¶ÇÊûúÂØπË±°ÁöÑ Mark Word ‰ªçÁÑ∂ÊåáÂêëÁùÄÁ∫øÁ®ãÁöÑÈîÅËÆ∞ÂΩïÔºåÈÇ£Â∞±Áî® CAS Êìç‰ΩúÊääÂØπË±°ÂΩìÂâçÁöÑ Mark Word ÂíåÁ∫øÁ®ã‰∏≠Â§çÂà∂ÁöÑ Displaced Mark Word ÊõøÊç¢ÂõûÊù•Ôºå Â¶ÇÊûúÊõøÊç¢ÊàêÂäüÔºåÊï¥‰∏™ÂêåÊ≠•ËøáÁ®ãÂ∞±ÂÆåÊàê‰∫Ü„ÄÇ Â¶ÇÊûúÊõøÊç¢Â§±Ë¥•ÔºåËØ¥ÊòéÊúâÂÖ∂‰ªñÁ∫øÁ®ãÂ∞ùËØïËøáËé∑ÂèñËØ•ÈîÅÔºåÈÇ£Â∞±Ë¶ÅÂú®ÈáäÊîæÈîÅÁöÑÂêåÊó∂ÔºåÂî§ÈÜíË¢´ÊåÇËµ∑ÁöÑÁ∫øÁ®ã„ÄÇÔºàÂ¶Ç‰ΩïÂî§ÈÜíÔºü notify() Ôºâ ËΩªÈáèÁ∫ßÈîÅËÉΩÊèêÂçáÁ®ãÂ∫èÂêåÊ≠•ÊÄßËÉΩÁöÑ‰æùÊçÆÊòØ‚ÄúÂØπ‰∫éÁªùÂ§ßÈÉ®ÂàÜÁöÑÈîÅÔºåÂú®Êï¥‰∏™ÂêåÊ≠•Âë®ÊúüÂÜÖÈÉΩÊòØ‰∏çÂ≠òÂú®Á´û‰∫âÁöÑ‚ÄùÔºåËøôÊòØ‰∏Ä‰∏™ÁªèÈ™åÊï∞ÊçÆ„ÄÇ Â¶ÇÊûúÊ≤°ÊúâÁ´û‰∫âÔºåËΩªÈáèÁ∫ßÈîÅ‰ΩøÁî® CAS Êìç‰ΩúÈÅøÂÖç‰∫Ü‰ΩøÁî®‰∫íÊñ•ÈáèÁöÑÂºÄÈîÄÔºå Â¶ÇÊûúÂ≠òÂú®ÈîÅÁ´û‰∫âÔºåÈô§‰∫Ü‰∫íÊñ•ÈáèÁöÑÂºÄÈîÄÂ§ñÔºåËøòÈ¢ùÂ§ñÂèëÁîü‰∫Ü CAS Êìç‰ΩúÔºåÂõ†Ê≠§Âú®==ÊúâÁ´û‰∫âÁöÑÊÉÖÂÜµ‰∏ãÔºåËΩªÈáèÁ∫ßÈîÅ‰ºöÊØî‰º†ÁªüÁöÑÈáçÈáèÁ∫ßÈîÅÊõ¥ÊÖ¢==„ÄÇ ÈîÅÁöÑ‰ºòÁº∫ÁÇπÂØπÊØî ÈîÅ ‰ºòÁÇπ Áº∫ÁÇπ ÈÄÇÁî®Âú∫ÊôØ ÂÅèÂêëÈîÅ Âä†ÈîÅÂíåËß£ÈîÅ‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÊ∂àËÄóÔºåÂíåÊâßË°åÈùûÂêåÊ≠•ÊñπÊ≥ïÊØî‰ªÖÂ≠òÂú®Á∫≥ÁßíÁ∫ßÁöÑÂ∑ÆË∑ù Â¶ÇÊûúÁ∫øÁ®ãÈó¥Â≠òÂú®ÈîÅÁ´û‰∫âÔºå‰ºöÂ∏¶Êù•È¢ùÂ§ñÁöÑÈîÅÊí§ÈîÄÁöÑÊ∂àËÄó ÈÄÇÁî®‰∫éÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆÂêåÊ≠•ÂùóÂú∫ÊôØ ËΩªÈáèÁ∫ßÈîÅ Á´û‰∫âÁöÑÁ∫øÁ®ã‰∏ç‰ºöÈòªÂ°ûÔºåÊèêÈ´ò‰∫ÜÁ®ãÂ∫èÁöÑÂìçÂ∫îÈÄüÂ∫¶ Â¶ÇÊûúÂßãÁªàÂæó‰∏çÂà∞ÈîÅÁ´û‰∫âÁöÑÁ∫øÁ®ã‰ΩøÁî®Ëá™Êóã‰ºöÊ∂àËÄó CPU ËøΩÊ±ÇÂìçÂ∫îÊó∂Èó¥,ÈîÅÂç†Áî®Êó∂Èó¥ÂæàÁü≠ ÈáçÈáèÁ∫ßÈîÅ Á∫øÁ®ãÁ´û‰∫â‰∏ç‰ΩøÁî®Ëá™ÊóãÔºå‰∏ç‰ºöÊ∂àËÄó CPU Á∫øÁ®ãÈòªÂ°ûÔºåÂìçÂ∫îÊó∂Èó¥ÁºìÊÖ¢ ËøΩÊ±ÇÂêûÂêêÈáè,ÈîÅÂç†Áî®Êó∂Èó¥ËæÉÈïø Ëá™ÊóãÈîÅÂú® Java ‰∏≠ÔºåËá™ÊóãÈîÅÊòØÊåáÂ∞ùËØïËé∑ÂèñÈîÅÁöÑÁ∫øÁ®ã‰∏ç‰ºöÁ´ãÂç≥ÈòªÂ°ûÔºåËÄåÊòØÈááÁî®Âæ™ÁéØÁöÑÊñπÂºèÂéªÂ∞ùËØïËé∑ÂèñÈîÅÔºåËøôÊ†∑ÁöÑÂ•ΩÂ§ÑÊòØÂáèÂ∞ëÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢ÁöÑÊ∂àËÄóÔºåÁº∫ÁÇπÊòØÂæ™ÁéØ‰ºöÊ∂àËÄó CPU„ÄÇÂÖ∏ÂûãÁöÑËá™ÊóãÈîÅÂÆûÁé∞ÁöÑ‰æãÂ≠êÔºåÂèØ‰ª•ÂèÇËÄÉËá™ÊóãÈîÅÁöÑÂÆûÁé∞ Â¶ÇÊûúÁ∫øÁ®ãÁ´û‰∫â‰∏çÊøÄÁÉàÔºåÂπ∂‰∏î‰øùÊåÅÈîÅÁöÑÊó∂Èó¥ÊÆµ„ÄÇÈÄÇÂêà‰ΩøÁî®Ëá™ÊóãÈîÅ„ÄÇËøôÊ†∑ÂèØ‰ª•ÈÅøÂÖçÁ∫øÁ®ãÊåÇËµ∑ÂíåÊÅ¢Â§ç(ÊåÇËµ∑Á∫øÁ®ãÂíåÊÅ¢Â§çÁ∫øÁ®ãÁöÑÊìç‰ΩúÈÉΩÈúÄË¶ÅËΩ¨ÂÖ•ÂÜÖÊ†∏ÊÄÅ‰∏≠ÂÆåÊàêÔºåËøô‰∫õÊìç‰ΩúÁªôÁ≥ªÁªüÁöÑÂπ∂ÂèëÊÄßËÉΩÂ∏¶Êù•‰∫ÜÂæàÂ§ßÁöÑÂéãÂäõ)Ôºå‰ªéËÄåÈôç‰ΩéÊÄßËÉΩÂºÄÈîÄ„ÄÇ Ëá™ÊóãÊ¨°Êï∞ÁöÑÈªòËÆ§ÂÄºÊòØ 10 Ê¨°ÔºåÁî®Êà∑ÂèØ‰ª•‰ΩøÁî®ÂèÇÊï∞-XXÔºöPreBlockSpin Êù•Êõ¥Êîπ„ÄÇ Âú® Java 1.6 ‰∏≠ÂºïÂÖ•‰∫ÜËá™ÈÄÇÂ∫îÁöÑËá™ÊóãÈîÅ„ÄÇËá™ÈÄÇÂ∫îÊÑèÂë≥ÁùÄËá™ÊóãÁöÑÊó∂Èó¥‰∏çÂÜçÂõ∫ÂÆö‰∫ÜÔºåËÄåÊòØÁî±Ââç‰∏ÄÊ¨°Âú®Âêå‰∏Ä‰∏™ÈîÅ‰∏äÁöÑËá™ÊóãÊó∂Èó¥ÂèäÈîÅÁöÑÊã•ÊúâËÄÖÁöÑÁä∂ÊÄÅÊù•ÂÜ≥ÂÆö„ÄÇ ÈîÅÊ∂àÈô§ÈîÅÊ∂àÈô§ÊòØÊåáËôöÊãüÊú∫Âç≥Êó∂ÁºñËØëÂô®Âú®ËøêË°åÊó∂ÔºåÂØπ‰∏Ä‰∫õ‰ª£Á†Å‰∏äË¶ÅÊ±ÇÂêåÊ≠•Ôºå‰ΩÜÊòØË¢´Ê£ÄÊµãÂà∞‰∏çÂèØËÉΩÂ≠òÂú®ÂÖ±‰∫´Êï∞ÊçÆÁ´û‰∫âÁöÑÈîÅËøõË°åÊ∂àÈô§„ÄÇ ÈîÅÊ∂àÈô§ÁöÑ‰∏ªË¶ÅÂà§ÂÆö‰æùÊçÆÊù•Ê∫ê‰∫éÈÄÉÈÄ∏ÂàÜÊûêÁöÑÊï∞ÊçÆÊîØÊåÅÔºàÁ¨¨ 11 Á´†Â∑≤ÁªèËÆ≤Ëß£ËøáÈÄÉÈÄ∏ÂàÜÊûêÊäÄÊúØÔºâÔºåÂ¶ÇÊûúÂà§Êñ≠Âú®‰∏ÄÊÆµ‰ª£Á†Å‰∏≠ÔºåÂ†Ü‰∏äÁöÑÊâÄÊúâÊï∞ÊçÆÈÉΩ‰∏ç‰ºöÈÄÉÈÄ∏Âá∫Âéª‰ªéËÄåË¢´ÂÖ∂‰ªñÁ∫øÁ®ãËÆøÈóÆÂà∞ÔºåÈÇ£Â∞±ÂèØ‰ª•ÊääÂÆÉ‰ª¨ÂΩìÂÅöÊ†à‰∏äÊï∞ÊçÆÂØπÂæÖÔºåËÆ§‰∏∫ÂÆÉ‰ª¨ÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºåÂêåÊ≠•Âä†ÈîÅËá™ÁÑ∂Â∞±Êó†È°ªËøõË°å„ÄÇ ‰∏æ‰∏™Ê†óÂ≠êÔºö 1234567public String concatStringÔºàString s1ÔºåString s2ÔºåString s3Ôºâ&#123; StringBuffer sb = new StringBuffer()Ôºõ sb.appendÔºàs1Ôºâ; sb.appendÔºàs2Ôºâ; sb.appendÔºàs3Ôºâ; return sb.toString()Ôºõ&#125; ÊØè‰∏™ StringBuffer.append()ÊñπÊ≥ï‰∏≠ÈÉΩÊúâ‰∏Ä‰∏™ÂêåÊ≠•ÂùóÔºåÈîÅÂ∞±ÊòØ sb ÂØπË±°„ÄÇËôöÊãüÊú∫ËßÇÂØüÂèòÈáè sbÔºåÂæàÂø´Â∞±‰ºöÂèëÁé∞ÂÆÉÁöÑÂä®ÊÄÅ‰ΩúÁî®ÂüüË¢´ÈôêÂà∂Âú® concatString()ÊñπÊ≥ïÂÜÖÈÉ®„ÄÇsb ÁöÑÊâÄÊúâÂºïÁî®Ê∞∏Ëøú‰∏ç‰ºö‚ÄúÈÄÉÈÄ∏‚ÄùÂà∞ concatString()ÊñπÊ≥ï‰πãÂ§ñÔºåÂÖ∂‰ªñÁ∫øÁ®ãÊó†Ê≥ïËÆøÈóÆÂà∞ÂÆÉÔºåÂõ†Ê≠§ÔºåËôΩÁÑ∂ËøôÈáåÊúâÈîÅÔºå‰ΩÜÊòØÂèØ‰ª•Ë¢´ÂÆâÂÖ®Âú∞Ê∂àÈô§ÊéâÔºåÂú®Âç≥Êó∂ÁºñËØë‰πãÂêéÔºåËøôÊÆµ‰ª£Á†ÅÂ∞±‰ºöÂøΩÁï•ÊéâÊâÄÊúâÁöÑÂêåÊ≠•ËÄåÁõ¥Êé•ÊâßË°å‰∫Ü„ÄÇ ÈîÅÁ≤óÂåñÂéüÂàô‰∏äÔºåÊàë‰ª¨Âú®ÁºñÂÜô‰ª£Á†ÅÁöÑÊó∂ÂÄôÔºåÊÄªÊòØÊé®ËçêÂ∞ÜÂêåÊ≠•ÂùóÁöÑ‰ΩúÁî®ËåÉÂõ¥ÈôêÂà∂ÂæóÂ∞ΩÈáèÂ∞è‚Äî‚ÄîÂè™Âú®ÂÖ±‰∫´Êï∞ÊçÆÁöÑÂÆûÈôÖ‰ΩúÁî®Âüü‰∏≠ÊâçËøõË°åÂêåÊ≠•ÔºåËøôÊ†∑ÊòØ‰∏∫‰ΩøÂæóÈúÄË¶ÅÂêåÊ≠•ÁöÑÊìç‰ΩúÊï∞ÈáèÂ∞ΩÂèØËÉΩÂèòÂ∞è„ÄÇ Â¶ÇÊûú‰∏ÄÁ≥ªÂàóÁöÑËøûÁª≠Êìç‰ΩúÈÉΩÂØπÂêå‰∏Ä‰∏™ÂØπË±°ÂèçÂ§çÂä†ÈîÅÂíåËß£ÈîÅÔºåÁîöËá≥Âä†ÈîÅÊìç‰ΩúÊòØÂá∫Áé∞Âú®Âæ™ÁéØ‰Ωì‰∏≠ÁöÑÔºåÈÇ£Âç≥‰ΩøÊ≤°ÊúâÁ∫øÁ®ãÁ´û‰∫âÔºåÈ¢ëÁπÅÂú∞ËøõË°å‰∫íÊñ•ÂêåÊ≠•Êìç‰Ωú‰πü‰ºöÂØºËá¥‰∏çÂøÖË¶ÅÁöÑÊÄßËÉΩÊçüËÄó„ÄÇ 1234567public String concatStringÔºàString s1ÔºåString s2ÔºåString s3Ôºâ&#123; StringBuffer sb=new StringBuffer()Ôºõ sb.appendÔºàs1ÔºâÔºõ sb.appendÔºàs2ÔºâÔºõ sb.appendÔºàs3ÔºâÔºõ return sb.toString()Ôºõ&#125; ‰∏äÈù¢ËøûÁª≠ÁöÑ append()ÊñπÊ≥ïÂ∞±Â±û‰∫éËøôÁ±ªÊÉÖÂÜµ„ÄÇÂ¶ÇÊûúËôöÊãüÊú∫Êé¢ÊµãÂà∞ÊúâËøôÊ†∑‰∏Ä‰∏≤Èõ∂Á¢éÁöÑÊìç‰ΩúÈÉΩÂØπÂêå‰∏Ä‰∏™ÂØπË±°Âä†ÈîÅÔºåÂ∞Ü‰ºöÊääÂä†ÈîÅÂêåÊ≠•ÁöÑËåÉÂõ¥Êâ©Â±ïÔºàÁ≤óÂåñÔºâÂà∞Êï¥‰∏™Êìç‰ΩúÂ∫èÂàóÁöÑÂ§ñÈÉ®Ôºå‰ª•‰∏äËø∞‰ª£Á†Å‰∏∫‰æãÔºåÂ∞±ÊòØÊâ©Â±ïÂà∞Á¨¨‰∏Ä‰∏™ append()Êìç‰Ωú‰πãÂâçÁõ¥Ëá≥ÊúÄÂêé‰∏Ä‰∏™ append()Êìç‰Ωú‰πãÂêéÔºåËøôÊ†∑Âè™ÈúÄË¶ÅÂä†ÈîÅ‰∏ÄÊ¨°Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ‰πêËßÇÈîÅÁöÑ‰∏ÄÁßçÂÆûÁé∞ÊñπÂºè‚Äî‚ÄîCAS Java ‰∏≠ÁöÑÈîÅÂàÜÁ±ª JavaÂ§öÁ∫øÁ®ãÔºà‰∏ÉÔºâ‰πãÂêåÊ≠•Âô®Âü∫Á°ÄÔºöAQSÊ°ÜÊû∂Ê∑±ÂÖ•ÂàÜÊûê È´òÂπ∂Âèë‰∏ãÊÇ≤ËßÇÈîÅ‰∏é‰πêËßÇÈîÅÁöÑÈÄâÊã©ÈóÆÈ¢ò ËÅäËÅäÂπ∂ÂèëÔºà‰∫åÔºâ‚Äî‚ÄîJava SE1.6‰∏≠ÁöÑSynchronized „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã Â¶ÇÊûúÊú¨Êñá‰∏≠Â≠òÂú®‰∏çÊ≠£Á°ÆÁöÑËØ¥Ê≥ïÔºåËØ∑ÊèêÂá∫ÔºåÂÖ±ÂêåËÆ®ËÆ∫ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Âπ∂Âèë</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ÈõÜÂêàÊ°ÜÊû∂‰πã HashMap Â∑•‰ΩúÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F09%2F10%2FJava%20%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E4%B9%8B%20HashMap%20%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Ê¶ÇË¶ÅÊ¶ÇÊã¨ÁöÑËØ¥ÔºåHashMap ÊòØ‰∏Ä‰∏™ÂÖ≥ËÅîÊï∞ÁªÑ„ÄÅÂìàÂ∏åË°®ÔºåÂÆÉÊòØÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑÔºåÂÖÅËÆ∏key ‰∏∫ null,value ‰∏∫ null„ÄÇÈÅçÂéÜÊó∂Êó†Â∫è„ÄÇÂÖ∂Â∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊï∞ÁªÑÁß∞‰πã‰∏∫ÂìàÂ∏åÊ°∂ÔºåÊØè‰∏™Ê°∂ÈáåÈù¢ÊîæÁöÑÊòØÈìæË°®ÔºåÈìæË°®‰∏≠ÁöÑÊØè‰∏™ËäÇÁÇπÔºåÂ∞±ÊòØÂìàÂ∏åË°®‰∏≠ÁöÑÊØè‰∏™ÂÖÉÁ¥†„ÄÇÂú® JDK8 ‰∏≠ÔºåÂΩìÈìæË°®ÈïøÂ∫¶ËææÂà∞ 8Ôºå‰ºöËΩ¨ÂåñÊàêÁ∫¢ÈªëÊ†ëÔºå‰ª•ÊèêÂçáÂÆÉÁöÑÊü•ËØ¢„ÄÅÊèíÂÖ•ÊïàÁéáÔºåÂÆÉÂÆûÁé∞‰∫ÜMap&lt;K,V&gt;, Cloneable, SerializableÊé•Âè£„ÄÇ Âõ†ÂÖ∂Â∫ïÂ±ÇÂìàÂ∏åÊ°∂ÁöÑÊï∞ÊçÆÁªìÊûÑÊòØÊï∞ÁªÑÔºåÊâÄ‰ª•‰πü‰ºöÊ∂âÂèäÂà∞Êâ©ÂÆπÁöÑÈóÆÈ¢ò„ÄÇ ÂΩìHashMapÁöÑÂÆπÈáèËææÂà∞thresholdÂüüÂÄºÊó∂ÔºåÂ∞±‰ºöËß¶ÂèëÊâ©ÂÆπ„ÄÇÊâ©ÂÆπÂâçÂêéÔºåÂìàÂ∏åÊ°∂ÁöÑÈïøÂ∫¶‰∏ÄÂÆö‰ºöÊòØ 2 ÁöÑÊ¨°Êñπ„ÄÇËøôÊ†∑Âú®Ê†πÊçÆ key ÁöÑ hash ÂÄºÂØªÊâæÂØπÂ∫îÁöÑÂìàÂ∏åÊ°∂Êó∂ÔºåÂèØ‰ª•Áî®‰ΩçËøêÁÆóÊõø‰ª£Âèñ‰ΩôÊìç‰ΩúÔºåÊõ¥Âä†È´òÊïà„ÄÇ ËÄå key ÁöÑ hash ÂÄºÔºåÂπ∂‰∏ç‰ªÖ‰ªÖÂè™ÊòØ key ÂØπË±°ÁöÑhashCode()ÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºåËøò‰ºöÁªèËøáÊâ∞Âä®ÂáΩÊï∞ÁöÑÊâ∞Âä®Ôºå‰ª•‰Ωø hash ÂÄºÊõ¥Âä†ÂùáË°°„ÄÇÂõ†‰∏∫hashCode()ÊòØintÁ±ªÂûãÔºåÂèñÂÄºËåÉÂõ¥ÊòØ 40 Â§ö‰∫øÔºåÂè™Ë¶ÅÂìàÂ∏åÂáΩÊï∞Êò†Â∞ÑÁöÑÊØîËæÉÂùáÂåÄÊùæÊï£ÔºåÁ¢∞ÊíûÂá†ÁéáÊòØÂæàÂ∞èÁöÑ„ÄÇ ‰ΩÜÂ∞±ÁÆóÂéüÊú¨ÁöÑhashCode()ÂèñÂæóÂæàÂ•ΩÔºåÊØè‰∏™ key ÁöÑhashCode()‰∏çÂêåÔºå‰ΩÜÊòØÁî±‰∫éHashMapÁöÑÂìàÂ∏åÊ°∂ÁöÑÈïøÂ∫¶ËøúÊØî hash ÂèñÂÄºËåÉÂõ¥Â∞èÔºåÈªòËÆ§ÊòØ 16ÔºåÊâÄ‰ª•ÂΩìÂØπ hash ÂÄº‰ª•Ê°∂ÁöÑÈïøÂ∫¶Âèñ‰ΩôÔºå‰ª•ÊâæÂà∞Â≠òÊîæËØ• key ÁöÑÊ°∂ÁöÑ‰∏ãÊ†áÊó∂ÔºåÁî±‰∫éÂèñ‰ΩôÊòØÈÄöËøá‰∏éÊìç‰ΩúÂÆåÊàêÁöÑÔºå‰ºöÂøΩÁï• hash ÂÄºÁöÑÈ´ò‰Ωç„ÄÇÂõ†Ê≠§Âè™ÊúâhashCode()ÁöÑ‰Ωé‰ΩçÂèÇÂä†ËøêÁÆóÔºåÂèëÁîü‰∏çÂêåÁöÑ hash ÂÄºÔºå‰ΩÜÊòØÂæóÂà∞ÁöÑ index Áõ∏ÂêåÁöÑÊÉÖÂÜµÁöÑÂá†Áéá‰ºöÂ§ßÂ§ßÂ¢ûÂä†ÔºåËøôÁßçÊÉÖÂÜµÁß∞‰πã‰∏∫hash Á¢∞Êíû„ÄÇ Âç≥ÔºåÁ¢∞ÊíûÁéá‰ºöÂ¢ûÂ§ß„ÄÇ Êâ∞Âä®ÂáΩÊï∞Â∞±ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥ hash Á¢∞ÊíûÁöÑ„ÄÇÂÆÉ‰ºöÁªºÂêà hash ÂÄºÈ´ò‰ΩçÂíå‰Ωé‰ΩçÁöÑÁâπÂæÅÔºåÂπ∂Â≠òÊîæÂú®‰Ωé‰ΩçÔºåÂõ†Ê≠§Âú®‰∏éËøêÁÆóÊó∂ÔºåÁõ∏ÂΩì‰∫éÈ´ò‰Ωé‰Ωç‰∏ÄËµ∑ÂèÇ‰∏é‰∫ÜËøêÁÆóÔºå‰ª•ÂáèÂ∞ë hash Á¢∞ÊíûÁöÑÊ¶ÇÁéá„ÄÇÔºàÂú® JDK8 ‰πãÂâçÔºåÊâ∞Âä®ÂáΩÊï∞‰ºöÊâ∞Âä®ÂõõÊ¨°ÔºåJDK8 ÁÆÄÂåñ‰∫ÜËøô‰∏™Êìç‰ΩúÔºâ ÊâßË°åÊâ©ÂÆπÊìç‰ΩúÊó∂Ôºå‰ºö new ‰∏Ä‰∏™Êñ∞ÁöÑNodeÊï∞ÁªÑ‰Ωú‰∏∫ÂìàÂ∏åÊ°∂ÔºåÁÑ∂ÂêéÂ∞ÜÂéüÂìàÂ∏åË°®‰∏≠ÁöÑÊâÄÊúâÊï∞ÊçÆ(NodeËäÇÁÇπ)ÁßªÂä®Âà∞Êñ∞ÁöÑÂìàÂ∏åÊ°∂‰∏≠ÔºåÁõ∏ÂΩì‰∫éÂØπÂéüÂìàÂ∏åË°®‰∏≠ÊâÄÊúâÁöÑÊï∞ÊçÆÈáçÊñ∞ÂÅö‰∫Ü‰∏Ä‰∏™ put Êìç‰Ωú„ÄÇÊâÄ‰ª•ÊÄßËÉΩÊ∂àËÄóÂæàÂ§ßÔºåÂèØÊÉ≥ËÄåÁü•ÔºåÂú®ÂìàÂ∏åË°®ÁöÑÂÆπÈáèË∂äÂ§ßÊó∂ÔºåÊÄßËÉΩÊ∂àËÄóË∂äÊòéÊòæ„ÄÇ Êâ©ÂÆπÊó∂ÔºåÂ¶ÇÊûúÂèëÁîüËøáÂìàÂ∏åÁ¢∞ÊíûÔºåËäÇÁÇπÊï∞Â∞è‰∫é 8 ‰∏™„ÄÇÂàôË¶ÅÊ†πÊçÆÈìæË°®‰∏äÊØè‰∏™ËäÇÁÇπÁöÑÂìàÂ∏åÂÄºÔºå‰æùÊ¨°ÊîæÂÖ•Êñ∞ÂìàÂ∏åÊ°∂ÂØπÂ∫î‰∏ãÊ†á‰ΩçÁΩÆ„ÄÇÂõ†‰∏∫Êâ©ÂÆπÊòØÂÆπÈáèÁøªÂÄçÔºåÊâÄ‰ª•ÂéüÈìæË°®‰∏äÁöÑÊØè‰∏™ËäÇÁÇπÔºåÁé∞Âú®ÂèØËÉΩÂ≠òÊîæÂú®ÂéüÊù•ÁöÑ‰∏ãÊ†áÔºåÂç≥ low ‰ΩçÔºå ÊàñËÄÖÊâ©ÂÆπÂêéÁöÑ‰∏ãÊ†áÔºåÂç≥ high ‰Ωç„ÄÇ high ‰Ωç= low ‰Ωç+ÂéüÂìàÂ∏åÊ°∂ÂÆπÈáèÂ¶ÇÊûúËøΩÂä†ËäÇÁÇπÂêéÔºåÈìæË°®Êï∞Èáè„Äã=8ÔºåÂàôËΩ¨Âåñ‰∏∫Á∫¢ÈªëÊ†ë Áî±Ëø≠‰ª£Âô®ÁöÑÂÆûÁé∞ÂèØ‰ª•ÁúãÂá∫ÔºåÈÅçÂéÜ HashMap Êó∂ÔºåÈ°∫Â∫èÊòØÊåâÁÖßÂìàÂ∏åÊ°∂‰ªé‰ΩéÂà∞È´òÔºåÈìæË°®‰ªéÂâçÂæÄÂêéÔºå‰æùÊ¨°ÈÅçÂéÜÁöÑ„ÄÇÂ±û‰∫éÊó†Â∫èÈõÜÂêà„ÄÇ ÂÆûÁé∞‰∏§‰∏™ÈáçË¶ÅÁöÑÂèÇÊï∞ An instance of HashMap has two parameters that affect its performance: initial capacity and load factor. The capacity is the number of buckets in the hash table, and the initial capacity is simply the capacity at the time the hash table is created. The load factor is a measure of how full the hash table is allowed to get before its capacity is automatically increased. When the number of entries in the hash table exceeds the product of the load factor and the current capacity, the hash table is rehashed (that is, internal data structures are rebuilt) so that the hash table has approximately twice the number of buckets. capacityÔºöÂÆπÈáè„ÄÇ‰πüÂ∞±ÊòØÂìàÂ∏åÊ°∂Êï∞ÁªÑÁöÑÈïøÂ∫¶„ÄÇÈªòËÆ§ÂàùÂßãÂåñÂÆπÈáè‰∏∫ 16„ÄÇ loadFactorÔºöÂä†ËΩΩÂõ†Â≠ê„ÄÇ Êâ©ÂÆπÁöÑÈòàÂÄº threshold = capacity * loadFactor Âä†ËΩΩÂõ†Â≠êÈªòËÆ§‰∏∫ 0.75ÔºåËøôÊòØÊó∂Èó¥ÂíåÁ©∫Èó¥‰∏äÁöÑÊäòË°∑ÁÇπ„ÄÇÂ§ß‰∫é 0.75ÔºåËÉΩÊèêÈ´òÁ©∫Èó¥Âà©Áî®ÁéáÔºå‰ΩÜÊòØ‰ºöÂØºËá¥Êü•ÊâæÊïàÁéáÈôç‰Ωé„ÄÇ ÂΩì hashMap ‰∏≠ÂÖÉÁ¥†ÁöÑÊÄªÊï∞Â§ß‰∫é capacity * loadFactor Êó∂ÔºåÂ∞±‰ºöÂèëÁîüÊâ©ÂÆπÔºàÂ∞Ü buckets ÁöÑÊï∞ÁõÆË∞ÉÊï¥‰∏∫ÂΩìÂâçÁöÑ‰∏§ÂÄçÔºâ„ÄÇ capacity Ë¢´ÊéßÂà∂‰∏∫ 2 ÁöÑ n Ê¨°ÊñπÔºà‰∏ÄÂÆöÊòØÂêàÊï∞ÔºâÔºåËøôÊúâÁÇπ‰∏çÂêàÂ∏∏ËßÑ„ÄÇÂ∏∏ËßÑÁöÑÂÅöÊ≥ïÊòØÂ∞ÜÊ°∂Êï∞ÁªÑÁöÑÈïøÂ∫¶ËÆæÁΩÆ‰∏∫Á¥†Êï∞ÔºåÂõ†‰∏∫Áõ∏ÂØπËÄåË®Ä‰ΩøÁî®Á¥†Êï∞ÂèëÁîüÂÜ≤Á™ÅÁöÑÊ¶ÇÁéáË¶ÅÊØî‰ΩøÁî®ÂêàÊï∞Ë¶ÅÂ∞è‰∏Ä‰∫õ„ÄÇHashTable ÈªòËÆ§ÂàùÂßãÂåñÂÆπÈáèÂ∞±‰∏∫ 11ÔºàÁ¥†Êï∞ÔºåHashtable Êâ©ÂÆπÂêé‰∏çËÉΩ‰øùËØÅËøòÊòØÁ¥†Êï∞Ôºâ„ÄÇ‰πãÊâÄ‰ª•ËøôÊ†∑ËÆæËÆ°ÊòØÂèñÊ®°ÂíåÊâ©ÂÆπÊó∂ËøõË°å‰ºòÂåñÔºà‰ΩøÁî®‰ΩçËøêÁÆóÊèêÈ´òÊïàÁéáÔºâÔºåÂêåÊó∂‰πüÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÂÜ≤Á™ÅÔºåHashMap ÂÆö‰ΩçÂìàÂ∏åÊ°∂Á¥¢Âºï‰ΩçÁΩÆÊó∂Ôºå‰πüÂä†ÂÖ•‰∫ÜÈ´ò‰ΩçÂèÇ‰∏éËøêÁÆóÁöÑËøáÁ®ã„ÄÇ put ÂáΩÊï∞ÁöÑÂÆûÁé∞1.8 ÂØπ HashMap ÁöÑÂ∫ïÂ±ÇÂÆûÁé∞ËøõË°å‰∫Ü‰øÆÊîπÔºàÂΩìÁõ∏Âêå hash ÂÄºÁöÑÂÖÉÁ¥†Â§ß‰∫é 8 ‰∏™Êó∂Ôºå‰ºöÂ∞ÜÈìæË°®ËΩ¨Êç¢‰∏∫ Á∫¢ÈªëÊ†ëÔºå‰ª•ÊèêÈ´òÊü•ÊâæÊïàÁéáÔºâÔºåÊâÄ‰ª• put ÂáΩÊï∞ÁúãËµ∑Êù•Áõ∏ÂØπÂ§çÊùÇ‰∫ÜÁÇπÔºåÈÄöËøá‰ª•‰∏ãÊµÅÁ®ãÂõæËÉΩÂ∏ÆÂä©ÁêÜËß£„ÄÇ ÂõæÁâáÂá∫Ëá™ËøôÁØáÊñáÁ´†„ÄÇ Ê≥®ÊÑèÔºöÂØπ‰∫é resize ÊñπÊ≥ïÁöÑÊòØÂê¶ÈúÄË¶ÅÊâßË°åÊúâ‰∏§Ê¨°Âà§Êñ≠Ôºö Á¨¨‰∏ÄÊ¨°Âà§Êñ≠Ê°∂Êï∞ÁªÑÊòØÂê¶‰∏∫Á©∫ÔºåÂ¶ÇÊûú‰∏∫Á©∫ÔºåÂàôÈÄöËøá resize ÊñπÊ≥ïÊâßË°åÂàùÂßãÂåñÊìç‰Ωú„ÄÇÁ¨¨‰∫åÊ¨°Âà§Êñ≠ÊòØÂú®ÊèíÂÖ•ÊàêÂäüÂêéÔºåÂà§Êñ≠ÂÆûÈôÖÂ≠òÂú®ÁöÑÈîÆÂÄºÂØπÊï∞Èáè size ÊòØÂê¶Ë∂ÖÂ§ö‰∫ÜÊúÄÂ§ßÂÆπÈáè thresholdÔºåÂ¶ÇÊûúË∂ÖËøáÔºåËøõË°åÊâ©ÂÆπ„ÄÇ put ÊñπÊ≥ïÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * Â∞ÜÊåáÂÆöÁöÑÂÄº‰∏éËØ•Êò†Â∞Ñ‰∏≠ÊåáÂÆöÁöÑÈîÆÂÖ≥ËÅîËµ∑Êù•„ÄÇ * Â¶ÇÊûúËØ• key ÂØπÂ∫îÁöÑ value Â≠òÂú®ÔºåÂàôÊõøÊç¢ÊóßÂÄº * */public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; java.util.HashMap.Node&lt;K,V&gt;[] tab; java.util.HashMap.Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0)//Ê°∂Êï∞ÁªÑ‰∏∫Á©∫ÊàñËÄÖÈïøÂ∫¶‰∏∫ 0ÔºàËØ¥ÊòéËøòÊú™ÂàùÂßãÂåñÔºâ n = (tab = resize()).length;//Ë∞ÉÁî®Êâ©ÂÆπÊñπÊ≥ïËøõË°åÂàùÂßãÂåñÔºåÂπ∂Ëé∑ÂèñÂàùÂßãÂåñÂêéÊ°∂Êï∞ÁªÑÁöÑÈïøÂ∫¶ if ((p = tab[i = (n - 1) &amp; hash]) == null)//Ê†πÊçÆ hash ÂÄº‰∏é n-1 ËøõË°å„ÄåÊ®°ËøêÁÆó„ÄçËé∑ÂèñÊèíÂÖ•Êï∞ÁªÑÁöÑÁ¥¢ÂºïÁöÑ i„ÄÇ tab[i] = newNode(hash, key, value, null);//ÂàõÂª∫Êñ∞ÁªìÁÇπ else &#123; //ÂèëÁîüÁ¢∞Êíû java.util.HashMap.Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; //key ÂÄºÁõ∏ÂêåÔºåÊõøÊç¢ÊóßÂÄº ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof java.util.HashMap.TreeNode)//ËØ•Èìæ‰∏∫Ê†ë e = ((java.util.HashMap.TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123;//ËØ•Èìæ‰∏∫ÈìæË°® for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash);//ËΩ¨Êç¢‰∏∫Á∫¢ÈªëÊ†ë break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; //Â¶ÇÊûúÊú¨Ë∫´Â≠òÂú®Áõ∏ÂêåÁöÑ keyÔºåÂàôÂ∞ÜÊóßÂÄºËøîÂõû if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount;//ÁªìÊûÑÂåñ‰øÆÊîπÊ¨°Êï∞Âä† 1 if (++size &gt; threshold)//Â¶ÇÊûúÂΩìÂâçÊï∞ÈáèË∂ÖËøáÈòàÂÄºÔºåÂàôËøõË°åÊâ©ÂÆπ resize(); afterNodeInsertion(evict);//ÈªòËÆ§‰∏∫Á©∫ÂÆûÁé∞ return null;//ÂéüÂÖà key ‰∏çÂ≠òÂú®Ôºå‰πüÂ∞±ÊòØËØ¥Ê≤°ÊúâÊóßÂÄºÔºåÁõ¥Êé•ËøîÂõû null&#125; get ÂáΩÊï∞ÁöÑÂÆûÁé∞12345678910111213141516171819202122232425262728/** * Ëé∑ÂèñÁªôÂÆö key ÁöÑ hash ÂÄºÔºåËé∑ÂèñÁõ∏Â∫î‰ΩçÁΩÆ value * */public V get(Object key) &#123; java.util.HashMap.Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final java.util.HashMap.Node&lt;K,V&gt; getNode(int hash, Object key) &#123; java.util.HashMap.Node&lt;K,V&gt;[] tab; java.util.HashMap.Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))//ÂÖàÊ£ÄÊü•ÂØπÂ∫î‰ΩçÁΩÆÁöÑ„ÄåÂ§¥ÁªìÁÇπ„ÄçÔºåÂ¶ÇÊûúÂåπÈÖçÁõ¥Êé•ËøîÂõûÂØπÂ∫îÁöÑÂÄº return first; if ((e = first.next) != null) &#123; if (first instanceof java.util.HashMap.TreeNode)//ËØ•ÈìæÊòØÁ∫¢ÈªëÊ†ëÔºåÊ†πÊçÆ hash Âíå key Âà∞ Ê†ë‰∏≠Êü•ÊâæÁõ∏Â∫îÁöÑ value,Áõ¥Êé•ËøîÂõû return ((java.util.HashMap.TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); //ËØ•ÈìæÊòØÈìæË°®ÔºåÂà∞ÈìæË°®‰∏≠ÈÅçÂéÜÊü•Êâæ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; ÂèØ‰ª•ÁúãÂà∞ get ÊñπÊ≥ïÁöÑÂ§ßËá¥ÈÄªËæëÊòØËøôÊ†∑ÁöÑÔºö ÂÖàËÆ°ÁÆóÂá∫ÂΩìÂâç key ÁöÑ hash ÂÄºÔºåÁÑ∂ÂêéÈÄöËøá getNode ÊñπÊ≥ïÂéªËé∑ÂèñÂΩìÂâçÂØπÂ∫îÁöÑÁªìÁÇπ Â¶ÇÊûúÂØπÂ∫îÁöÑËäÇÁÇπ‰∏∫ nullÔºåÁõ¥Êé•ËøîÂõû nullÔºå Âê¶ÂàôËøîÂõûËäÇÁÇπ‰∏≠ÁöÑ value„ÄÇ getNode ÊñπÊ≥ïÁöÑÂÆûÁé∞ÊÄùË∑ØÊòØËøôÊ†∑ÁöÑÔºö ÈÄöËøá hash Ë∑ü ÂΩìÂâçÂÆπÈáèËøõË°å ‰∏éËøêÁÆó ÂæóÂà∞Êï∞ÁªÑ‰∏ãÊ†á ‰ΩøÁî®ÊåáÂÆö‰∏ãÊ†áÂéªËé∑ÂèñÂØπÂ∫îÁöÑËäÇÁÇπÔºà‰ªéÂ§¥ÁªìÁÇπÂºÄÂßãÔºâ Â¶ÇÊûúÈ¶ñ‰∏™ÂÖÉÁ¥†Â∞±ÂëΩ‰∏≠ÔºåÁõ¥Êé•ËøîÂõûÁªìÁÇπ„ÄÇ Â≠òÂú®ÂÜ≤Á™ÅÔºöÂ¶ÇÊûúËØ• hash ÂÄºÂØπÂ∫îÁöÑÊòØ‰∏ÄÊ£µÁ∫¢ÈªëÊ†ëÔºåÂàôÂà∞Á∫¢ÈªëÊ†ë‰∏≠ÂéªËé∑ÂèñÁõ∏Â∫îÁöÑÁªìÁÇπ„ÄÇÂ¶ÇÊûúËØ• hash ÂÄºÂØπÂ∫îÁöÑÊòØ‰∏Ä‰∏™ÈìæË°®ÔºåÂàôÈÅçÂéÜËØ•ÈìæË°®ÔºåÁõ¥Âà∞ÂèñÂæóÁõ∏Â∫îÁöÑÁªìÁÇπÊàñËÄÖÂà∞ËææÈìæÂ∞æ„ÄÇ hash ÂáΩÊï∞ÁöÑÂÆûÁé∞Âú® HashMap ‰∏≠ÔºåÂìàÂ∏åÊ°∂Êï∞ÁªÑ table ÁöÑÈïøÂ∫¶ length Â§ßÂ∞èÂøÖÈ°ª‰∏∫ 2 ÁöÑ n Ê¨°Êñπ(‰∏ÄÂÆöÊòØÂêàÊï∞)ÔºåËøôÊòØ‰∏ÄÁßçÈùûÂ∏∏ËßÑÁöÑËÆæËÆ°ÔºåÂ∏∏ËßÑÁöÑËÆæËÆ°ÊòØÊääÊ°∂ÁöÑÂ§ßÂ∞èËÆæËÆ°‰∏∫Á¥†Êï∞„ÄÇÁõ∏ÂØπÊù•ËØ¥Á¥†Êï∞ÂØºËá¥ÂÜ≤Á™ÅÁöÑÊ¶ÇÁéáË¶ÅÂ∞è‰∫éÂêàÊï∞ÔºåÂÖ∑‰ΩìËØÅÊòéÂèØ‰ª•ÂèÇËÄÉËøôÁØáÊñáÁ´†ÔºåHashtable ÂàùÂßãÂåñÊ°∂Â§ßÂ∞è‰∏∫ 11ÔºåÂ∞±ÊòØÊ°∂Â§ßÂ∞èËÆæËÆ°‰∏∫Á¥†Êï∞ÁöÑÂ∫îÁî®ÔºàHashtable Êâ©ÂÆπÂêé‰∏çËÉΩ‰øùËØÅËøòÊòØÁ¥†Êï∞Ôºâ„ÄÇHashMap ÈááÁî®ËøôÁßçÈùûÂ∏∏ËßÑËÆæËÆ°Ôºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÂú®ÂèñÊ®°ÂíåÊâ©ÂÆπÊó∂ÂÅö‰ºòÂåñÔºåÂêåÊó∂‰∏∫‰∫ÜÂáèÂ∞ëÂÜ≤Á™ÅÔºåHashMap ÂÆö‰ΩçÂìàÂ∏åÊ°∂Á¥¢Âºï‰ΩçÁΩÆÊó∂Ôºå‰πüÂä†ÂÖ•‰∫ÜÈ´ò‰ΩçÂèÇ‰∏éËøêÁÆóÁöÑËøáÁ®ã„ÄÇ ÈÄöËøá h &amp; (table.length -1) Êù•ÂæóÂà∞ËØ•ÂØπË±°ÁöÑ‰øùÂ≠ò‰ΩçÔºåËÄå HashMap Â∫ïÂ±ÇÊï∞ÁªÑÁöÑÈïøÂ∫¶ÊÄªÊòØ 2 ÁöÑ n Ê¨°ÊñπÔºåËøôÊòØ HashMap Âú®ÈÄüÂ∫¶‰∏äÁöÑ‰ºòÂåñ„ÄÇÂΩì length ÊÄªÊòØ 2 ÁöÑ n Ê¨°ÊñπÊó∂Ôºåh&amp; (length-1) ËøêÁÆóÁ≠â‰ª∑‰∫éÂØπ length ÂèñÊ®°Ôºå‰πüÂ∞±ÊòØ h%lengthÔºå‰ΩÜÊòØ&amp;ÊØî%ÂÖ∑ÊúâÊõ¥È´òÁöÑÊïàÁéá„ÄÇ h &amp; (length - 1) „Ää==„Äã h % length Âú® JDK1.8 ÁöÑÂÆûÁé∞‰∏≠Ôºå‰ºòÂåñ‰∫ÜÈ´ò‰ΩçËøêÁÆóÁöÑÁÆóÊ≥ïÔºåÈÄöËøá hashCode()ÁöÑÈ´ò 16 ‰ΩçÔºàÂÖ∂ÂÆûÊòØÂÆåÊï¥ÁöÑÔºâ ÂºÇÊàñ ‰Ωé 16 ‰ΩçÂÆûÁé∞ÁöÑÔºö(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)Ôºå‰∏ªË¶ÅÊòØ‰ªéÈÄüÂ∫¶„ÄÅÂäüÊïà„ÄÅË¥®ÈáèÊù•ËÄÉËôëÁöÑÔºåËøô‰πàÂÅöÂèØ‰ª•Âú®Êï∞ÁªÑ table ÁöÑ length ÊØîËæÉÂ∞èÁöÑÊó∂ÂÄôÔºå‰πüËÉΩ‰øùËØÅËÄÉËôëÂà∞È´ò‰Ωé Bit ÈÉΩÂèÇ‰∏éÂà∞ Hash ÁöÑËÆ°ÁÆó‰∏≠ÔºåÂêåÊó∂‰∏ç‰ºöÊúâÂ§™Â§ßÁöÑÂºÄÈîÄ„ÄÇ hash ÊòØ int Á±ªÂûãÁöÑÔºà32 ‰ΩçÔºâÔºåÂéü hashcode ÂºÇÊàñ Âè≥Áßª 16 ‰ΩçÂêéÁöÑ hashcodeÔºåÈ´ò‰Ωé‰ΩçÂÖºÈ°æ Âè≥Áßª 16 ‰ΩçÔºåÈÇ£‰πàÈ´ò 16 ‰ΩçÂùá‰∏∫ 0ÔºåÊâÄ‰ª•È´òÂçÅÂÖ≠‰ΩçÁöÑÂèñÂÄºÁî± key ÁöÑ hashCode ÁöÑÈ´òÂçÅÂÖ≠‰ΩçÁ°ÆÂÆöÔºå ‰Ωé 16 ‰ΩçÁöÑÂÄºÁî± hashcode ÁöÑ‰ΩéÂçÅÂÖ≠‰Ωç‰∏éÈ´òÂçÅÂÖ≠‰Ωç Âú® get Âíå put ÁöÑËøáÁ®ã‰∏≠ÔºåËÆ°ÁÆó‰∏ãÊ†áÊó∂ÔºåÂÖàÂØπ hashCode ËøõË°å hash Êìç‰ΩúÔºåÁÑ∂ÂêéÂÜçÈÄöËøá hash ÂÄºËøõ‰∏ÄÊ≠•ËÆ°ÁÆó‰∏ãÊ†áÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö Âú®ÂØπ hashCode()ËÆ°ÁÆó hash Êó∂ÂÖ∑‰ΩìÂÆûÁé∞ÊòØËøôÊ†∑ÁöÑÔºö 123456static final int hash(Object key) &#123; int h; //Âõ†‰∏∫ h &gt;&gt;&gt; 16 Âè≥Áßª‰∫Ü 16 ‰Ωç(È´ò 16 ‰ΩçÈÉΩ‰∏∫ 0)ÔºåÂõ†Ê≠§ÁªìÊûúÁöÑÈ´ò 16 ‰Ωç‰ªçÁÑ∂ÊòØ key.hashCode() ÁöÑÈ´ò 16 ‰Ωç //ËÄå‰Ωé 16 ‰ΩçÂèñÂÜ≥‰∫é key.hashCode() ÁöÑÈ´òÂçÅÂÖ≠‰ΩçÂíå‰ΩéÂçÅÂÖ≠‰ΩçËøõË°åÂºÇÊàñÁöÑÁªìÊûú return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™ÂáΩÊï∞Â§ßÊ¶ÇÁöÑ‰ΩúÁî®Â∞±ÊòØÔºöÈ´ò 16bit ‰∏çÂèòÔºå‰Ωé 16bit ÂíåÈ´ò 16bit ÂÅö‰∫Ü‰∏Ä‰∏™ÂºÇÊàñ„ÄÇËøôÊ†∑ÂÅöÁöÑÁõÆÁöÑÂ∞±Âú®‰∫é‰Ω†Ê±Ç‰ΩôÁöÑÊó∂ÂÄôÂåÖÂê´‰∫ÜÈ´ò 16 ‰ΩçÂíåÁ¨¨ 16 ‰ΩçÁöÑÁâπÊÄß ‰πüÂ∞±ÊòØËØ¥‰Ω†ÊâÄËÆ°ÁÆóÂá∫Êù•ÁöÑ hash ÂÄºÂåÖÂê´‰ªéËÄå‰ΩøÂæó‰Ω†ÁöÑ hash ÂÄºÊõ¥Âä†„ÄåÈöèÊú∫„Äç‰ª•Èôç‰ΩéÁ¢∞ÊíûÁöÑÊ¶ÇÁéá ËÆ°ÁÆó‰∏ãÊ†áÂ≠òÂÇ®ÁªìÁÇπÊó∂ÔºåËÆ°ÁÆóÂæóÂà∞ÁöÑ hash ÂÄºÂèØËÉΩËøúÂ§ß‰∫éÂìàÂ∏åÊ°∂Êï∞ÁªÑÁöÑÈïøÂ∫¶Ôºå‰∏∫‰∫ÜÈÅøÂÖçÊï∞ÁªÑË∂äÁïåÔºåÊàë‰ª¨ÈúÄË¶ÅËøõË°åÂèñÊ®°ËøêÁÆó„ÄÇËÆ°ÁÆó‰∏ãÊ†áÁöÑÊó∂ÂÄôÔºåÊòØËøôÊ†∑ÂÆûÁé∞ÁöÑ(‰ΩøÁî®&amp;‰ΩçÊìç‰ΩúÔºåËÄåÈùû%Ê±Ç‰Ωô)Ôºö 1(n - 1) &amp; hash ‰∏äÈù¢ÁöÑËÆ°ÁÆóÂÆûÈôÖ‰∏äÁ≠â‰ª∑‰∫éhash % nÔºå‰ΩÜÊòØÂâçËÄÖÁöÑÊïàÁéáÊØîËæÉÈ´ò„ÄÇÂâçÈù¢Êàë‰ª¨ÊèêÂà∞ËøáÔºåHashMap ÁöÑÊï∞ÁªÑÈïøÂ∫¶‰∏ÄÂÆöÊòØ 2 ÁöÑ ÔºüÊ¨°Êñπ„ÄÇ‰πüÂ∞±ÊòØËØ¥ (n - 1) ÂèØ‰ª•Âåñ‰∏∫ 0‚Ä¶0011‚Ä¶1ÔºåËøôÊ†∑Ë∑ü hash ËøõË°å‰∏éËøêÁÆóÔºåÂ∞±Áõ∏ÂΩì‰∫éÂèñÊ®°ËøêÁÆó„ÄÇ Java 8 ÊâÄÂÅöÁöÑ‰ºòÂåñhash ÂáΩÊï∞ËÆæËÆ°ÂæóÂÜçÂ•ΩÔºå‰πüÊó†Ê≥ïÈÅøÂÖçÂÜ≤Á™ÅÁöÑ„ÄÇÂ¶Ç‰ΩïËß£ÂÜ≥ÂÜ≤Á™Å‰πüÊòØ‰∏ÄÈó®Â≠¶ÈóÆ„ÄÇ Âú® Java 8 ‰πãÂâçÁöÑÂÆûÁé∞‰∏≠ÊòØÁî®ÈìæË°®Ëß£ÂÜ≥ÂÜ≤Á™ÅÁöÑÔºåÂú®‰∫ßÁîüÁ¢∞ÊíûÁöÑÊÉÖÂÜµ‰∏ãÔºåËøõË°å get Êó∂Ôºå‰∏§Ê≠•ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÊòØ O(1)+O(n)„ÄÇÂõ†Ê≠§ÔºåÂΩìÁ¢∞ÊíûÂæàÂéâÂÆ≥ÁöÑÊó∂ÂÄô n ÂæàÂ§ßÔºåO(n)ÁöÑÈÄüÂ∫¶ÊòæÁÑ∂ÊòØÂΩ±ÂìçÈÄüÂ∫¶ÁöÑ„ÄÇ Âõ†Ê≠§Âú® Java 8 ‰∏≠ÔºåÂΩìÈìæË°®ÈïøÂ∫¶Â§ß‰∫é 8 Êó∂ÔºåÂ∞±Âà©Áî®Á∫¢ÈªëÊ†ëÊõøÊç¢ÈìæË°®ÔºåËøôÊ†∑Â§çÊùÇÂ∫¶Â∞±ÂèòÊàê‰∫Ü O(1)+O(logn)‰∫ÜÔºåËøôÊ†∑Âú® n ÂæàÂ§ßÁöÑÊó∂ÂÄôÔºåËÉΩÂ§üÊØîËæÉÁêÜÊÉ≥ÁöÑËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÂú®Java 8ÔºöHashMap ÁöÑÊÄßËÉΩÊèêÂçá‰∏ÄÊñá‰∏≠ÊúâÊÄßËÉΩÊµãËØïÁöÑÁªìÊûú„ÄÇ resize ÔºàÊâ©ÂÆπÔºâÂÆûÁé∞12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788/** * ÂàùÂßãÂåñÊàñËÄÖÊâ©ÂÆπ‰∏ÄÂÄç * */final java.util.HashMap.Node&lt;K,V&gt;[] resize() &#123; java.util.HashMap.Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length;//ÊóßÈïøÂ∫¶ int oldThr = threshold;//ÊóßÈòàÂÄº int newCap, newThr = 0; //Ëøô‰∏ÄÊÆµ‰ª£Á†ÅÁî®‰∫éÁ°ÆÂÆöÊñ∞ÂÆπÈáè,Âπ∂Ê†πÊçÆÊñ∞ÂÆπÈáèÈáçÊñ∞Á°ÆÂÆöÈòàÂÄº if (oldCap &gt; 0) &#123; if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;//ÊóßÂÆπÈáèÂ§ß‰∫éÊúÄÂ§ßÂÖÅËÆ∏ÂÆπÈáèÔºåÂ∞ÜÈòàÂÄºËµãÂÄº‰∏∫ÊúÄÂ§ßÂÖÅËÆ∏ÂÆπÈáè threshold = Integer.MAX_VALUE; return oldTab;//Áõ¥Êé•ËøîÂõûÊóßË°® &#125; else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY)//Êâ©ÂÆπÂêéÂ∞è‰∫éÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÂÆπÈáèÔºå‰∏îÂ§ß‰∫éÈªòËÆ§ÂàùÂßãÂÆπÈáèÔºà16ÔºâÔºåÂàô‰øÆÊîπ threshold newThr = oldThr &lt;&lt; 1; // threshold Â¢ûÂ§ß‰∏ÄÂÄç &#125; else if (oldThr &gt; 0) // ÂéüÊúâÈòàÂÄºÂ§ß‰∫é 0Ôºå‰ΩÜÊòØÂéüÂÆπÈáèÂ∞è‰∫é 0 newCap = oldThr;//Â∞ÜÊñ∞ÂÆπÈáèËµãÂÄº‰∏∫Â∞±ÊóßÈòàÂÄº else &#123; // ÂéüÈòàÂÄº„ÄÅÂéüÂÆπÈáèÂùá‰∏∫ 0 Ôºå‰ΩøÁî®ÈªòËÆ§ÁöÑÂàùÂßãÂåñÂèÇÊï∞Êù•ÂàõÂª∫ map newCap = DEFAULT_INITIAL_CAPACITY;//ÈªòËÆ§ÁöÑÂàùÂßãÂåñÂÆπÈáè Ôºà16Ôºâ newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);//Êñ∞ÁöÑÈòàÂÄº &#125; if (newThr == 0) &#123;//Â¶ÇÊûúÊñ∞ÈòàÂÄº‰∏∫ 0 float ft = (float)newCap * loadFactor;//ÈáçÊñ∞ËÆ°ÁÆó newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); //Â¶ÇÊûúÈòàÂÄºÂ§ß‰∫éÊúÄÂ§ßÂÆπÈáèÔºå‰øÆÊîπÈòàÂÄº‰∏∫ int ÁöÑÊúÄÂ§ßÂÄº(2^31-1)ÔºåËøôÊ†∑‰ª•ÂêéÂ∞±‰∏ç‰ºöÊâ©ÂÆπ‰∫Ü &#125; threshold = newThr; @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) java.util.HashMap.Node&lt;K,V&gt;[] newTab = (java.util.HashMap.Node&lt;K,V&gt;[])new java.util.HashMap.Node[newCap];//ÊåâÁÖßÊñ∞ÂÆπÈáè ÂàõÂª∫Êï∞ÁªÑ table = newTab; if (oldTab != null) &#123;//ÂéüÊúâÁöÑ map ‰∏äÁöÑÂÖÉÁ¥†‰∏ç‰∏∫Á©∫ÔºåÂ∞ÜÂéüÊúâ map ‰∏äÈù¢ÁöÑÊï∞ÊçÆÂ§çÂà∂Âà∞Êñ∞ÁöÑ map ‰∏äÈù¢ //ÈÅçÂéÜÊóßÂÖÉÁ¥† for (int j = 0; j &lt; oldCap; ++j) &#123; java.util.HashMap.Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null;//ÈáäÊîæÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºè if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e;//ËØ•Ê°∂‰∏≠Âè™Êúâ‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåËé∑ÂèñÁöÑ hash ÂÄºÂπ∂‰∏éÔºàÊñ∞ÂÆπÈáè -1ÔºâËøõË°å ‰∏éËøêÁÆó else if (e instanceof java.util.HashMap.TreeNode)//Â¶ÇÊûúËØ•ÂÖÉÁ¥†ÊòØ‰∏Ä‰∏™Ê†ëËäÇÁÇπÔºàËØ¥ÊòéËØ•Ê°∂ÂØπÂ∫îÊúâ‰∏ÄÊ£µÁ∫¢ÈªëÊ†ëÔºâÔºåÂ∞ÜÊ†ëÂ≠òÂÇ®Âà∞Êñ∞Êï∞ÁªÑ‰∏ä ((java.util.HashMap.TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // ‰øùÊåÅÈ°∫Â∫è //Âõ†‰∏∫Êâ©ÂÆπÊòØÂÆπÈáèÁøªÂÄçÔºåÊâÄ‰ª•ÂéüÈìæË°®‰∏äÁöÑÊØè‰∏™ËäÇÁÇπÔºåÁé∞Âú®ÂèØËÉΩÂ≠òÊîæÂú®ÂéüÊù•ÁöÑ‰∏ãÊ†áÔºåÂç≥ low ‰ΩçÔºå ÊàñËÄÖÊâ©ÂÆπÂêéÁöÑ‰∏ãÊ†áÔºåÂç≥ high ‰Ωç„ÄÇ high ‰Ωç = low ‰Ωç+ÂéüÂìàÂ∏åÊ°∂ÂÆπÈáè //‰Ωé‰ΩçÈìæË°®ÁöÑÂ§¥ÁªìÁÇπ„ÄÅÂ∞æËäÇÁÇπ java.util.HashMap.Node&lt;K,V&gt; loHead = null, loTail = null; //È´ò‰ΩçÈìæË°®ÁöÑÂ§¥ÁªìÁÇπ„ÄÅÂ∞æËäÇÁÇπ java.util.HashMap.Node&lt;K,V&gt; hiHead = null, hiTail = null; //‰∏¥Êó∂ÁªìÁÇπ java.util.HashMap.Node&lt;K,V&gt; next; do &#123; next = e.next; if ((e.hash &amp; oldCap) == 0) &#123;//Ê†πÊçÆ hash ÂÄº‰∏é oldCap ÁöÑËøêÁÆóÁªìÊûúÔºåÂ∞ÜÈìæË°®‰∏≠ÈõÜÁªìÁöÑÂÖÉÁ¥†ÂàÜÂºÄÔºåÂèØËÆ§‰∏∫ÁªìÊûúÊòØÈöèÊú∫ÁöÑ if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); //Âú®ÂéüÁ¥¢ÂºïÂ§ÑÂ≠òÊîæ „Äå‰Ωé‰ΩçÈìæË°®„Äç if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; //Âú®ÂéüÁ¥¢ÂºïÂä†‰∏äÂéüÂÆπÈáèÂ§ÑÔºåÂ≠òÊîæ„ÄåÈ´ò‰ΩçÈìæË°®„Äç if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; Êàë‰ª¨‰ΩøÁî®ÁöÑÊòØ 2 Ê¨°ÂπÇÁöÑÊâ©Â±ï(ÊåáÈïøÂ∫¶Êâ©‰∏∫ÂéüÊù• 2 ÂÄç)ÔºåÊâÄ‰ª•ÔºåÂÖÉÁ¥†ÁöÑ‰ΩçÁΩÆË¶Å‰πàÊòØÂú®Âéü‰ΩçÁΩÆÔºåË¶Å‰πàÊòØÂú®Âéü‰ΩçÁΩÆÂÜçÁßªÂä® 2 Ê¨°ÂπÇÁöÑ‰ΩçÁΩÆ„ÄÇÁúã‰∏ãÂõæÂèØ‰ª•ÊòéÁôΩËøôÂè•ËØùÁöÑÊÑèÊÄùÔºån ‰∏∫ table ÁöÑÈïøÂ∫¶ÔºåÂõæÔºàaÔºâË°®Á§∫Êâ©ÂÆπÂâçÁöÑ key1 Âíå key2 ‰∏§Áßç key Á°ÆÂÆöÁ¥¢Âºï‰ΩçÁΩÆÁöÑÁ§∫‰æãÔºåÂõæÔºàbÔºâË°®Á§∫Êâ©ÂÆπÂêé key1 Âíå key2 ‰∏§Áßç key Á°ÆÂÆöÁ¥¢Âºï‰ΩçÁΩÆÁöÑÁ§∫‰æãÔºåÂÖ∂‰∏≠ hash1 ÊòØ key1 ÂØπÂ∫îÁöÑÂìàÂ∏å‰∏éÈ´ò‰ΩçËøêÁÆóÁªìÊûú„ÄÇ ÂÖÉÁ¥†Âú®ÈáçÊñ∞ËÆ°ÁÆó hash ‰πãÂêéÔºåÂõ†‰∏∫ n Âèò‰∏∫ 2 ÂÄçÔºåÈÇ£‰πà n-1 ÁöÑ mask ËåÉÂõ¥Âú®È´ò‰ΩçÂ§ö 1bit(Á∫¢Ëâ≤)ÔºåÂõ†Ê≠§Êñ∞ÁöÑ index Â∞±‰ºöÂèëÁîüËøôÊ†∑ÁöÑÂèòÂåñÔºö Âõ†Ê≠§ÔºåÊàë‰ª¨Âú®Êâ©ÂÖÖ HashMap ÁöÑÊó∂ÂÄôÔºå‰∏çÈúÄË¶ÅÂÉè JDK1.7 ÁöÑÂÆûÁé∞ÈÇ£Ê†∑ÈáçÊñ∞ËÆ°ÁÆó hashÔºåÂè™ÈúÄË¶ÅÁúãÁúãÂéüÊù•ÁöÑ hash ÂÄºÊñ∞Â¢ûÁöÑÈÇ£‰∏™ bit ÊòØ 1 ËøòÊòØ 0 Â∞±Â•Ω‰∫ÜÔºåÊòØ 0 ÁöÑËØùÁ¥¢ÂºïÊ≤°ÂèòÔºåÊòØ 1 ÁöÑËØùÁ¥¢ÂºïÂèòÊàê‚ÄúÂéüÁ¥¢Âºï+oldCapÔºåÂèØ‰ª•ÁúãÁúã‰∏ãÂõæ‰∏∫ 16 Êâ©ÂÖÖ‰∏∫ 32 ÁöÑ resize Á§∫ÊÑèÂõæÔºö Ëøô‰∏™ËÆæËÆ°Á°ÆÂÆûÈùûÂ∏∏ÁöÑÂ∑ßÂ¶ôÔºåÊó¢ÁúÅÂéª‰∫ÜÈáçÊñ∞ËÆ°ÁÆó hash ÂÄºÁöÑÊó∂Èó¥ÔºåËÄå‰∏îÂêåÊó∂ÔºåÁî±‰∫éÊñ∞Â¢ûÁöÑ 1bit ÊòØ 0 ËøòÊòØ 1 ÂèØ‰ª•ËÆ§‰∏∫ÊòØÈöèÊú∫ÁöÑÔºåÂõ†Ê≠§ resize ÁöÑËøáÁ®ãÔºåÂùáÂåÄÁöÑÊää‰πãÂâçÁöÑÂÜ≤Á™ÅÁöÑËäÇÁÇπÂàÜÊï£Âà∞Êñ∞ÁöÑ bucket ‰∫Ü„ÄÇËøô‰∏ÄÂùóÂ∞±ÊòØ JDK1.8 Êñ∞Â¢ûÁöÑ‰ºòÂåñÁÇπ„ÄÇ Ê†ëÂåñ‰∏éÈìæË°®ÂåñÂΩìÂÜ≤Á™ÅÈìæË°®ÈïøÂ∫¶ËææÂà∞ 8 ÁöÑÊó∂ÂÄôÔºå‰ºöË∞ÉÁî® treeifyBin Â∞ùËØïÂ∞ÜÈìæË°®ËΩ¨Êç¢‰∏∫Ê†ë„ÄÇ Â¶ÇÊûúÂΩìÂâçÊï∞ÁªÑÁöÑÈïøÂ∫¶Â∞è‰∫é 64 ÁöÑËØùÔºåÂè™‰ºöËß¶ÂèëÊâ©ÂÆπÔºåËÄå‰∏ç‰ºöÂ∞ÜÈìæË°®ËΩ¨Êç¢‰∏∫Á∫¢ÈªëÊ†ë„ÄÇ 1234567891011121314151617181920final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)//Âú®„ÄåÊ†ëÂåñ„Äç‰πãÂâçÂÖàÂà§Êñ≠ÔºåÂΩìÂâçÁöÑÂÆπÈáè resize(); else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null; do &#123; TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else &#123; p.prev = tl; tl.next = p; &#125; tl = p; &#125; while ((e = e.next) != null); if ((tab[index] = hd) != null) hd.treeify(tab); &#125;&#125; ÂΩìÁßªÈô§ÂÖÉÁ¥†ÊàñËÄÖÊòØÊâ©ÂÆπÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÊ†ëÁöÑÂ§ßÂ∞è&lt;=6Ôºå‰ºöË∞ÉÁî® HashMap.TreeNode#untreeify ÊñπÊ≥ïÂ∞ÜÁ∫¢ÈªëÊ†ëËΩ¨Êç¢‰∏∫ÈìæË°®„ÄÇ ‰∏∫‰ªÄ‰πàË¶ÅËøõË°å„ÄåÊ†ëÂåñ„ÄçÂë¢Ôºü‰∏ÄÊñπÈù¢ÊòØ‰∏∫‰∫Ü‰øùËØÅÊÄßËÉΩÔºåÂ¶ÇÊûúÂêå‰∏Ä‰∏™Ê°∂‰∏äÈù¢ÁöÑÂÜ≤Á™ÅÈÉΩÈÄöËøáÈìæË°®ËøûÊé•ÔºåÈìæË°®ÁöÑÊü•ËØ¢ÊòØÁ∫øÊÄßÁöÑÔºåÂêå‰∏Ä‰∏™Ê°∂‰∏äÂÜ≤Á™ÅËæÉÂ§öÁöÑÊó∂ÂÄôÔºå‰ºö‰∏•ÈáçÂΩ±ÂìçÂ≠òÂèñÁöÑÊÄßËÉΩ„ÄÇ Âè¶‰∏Ä‰∏™ÂéüÂõ†ÂÖ∂ÂÆû‰πüÊòØÁî±ÊÄßËÉΩÈóÆÈ¢òÂºïÂèëÁöÑÂìàÂ∏åÁ¢∞ÊíûÊãíÁªùÊúçÂä°ÊîªÂáªÔºåÂõ†‰∏∫ÊûÑÈÄ†ÂìàÂ∏åÂÜ≤Á™ÅÁöÑÊï∞ÊçÆÂπ∂‰∏çÊòØÂõ∞ÈöæÁöÑ‰∫ãÊÉÖÔºåÊÅ∂ÊÑè‰ª£Á†ÅÂèØ‰ª•ÊûÑÈÄ†ËøôÊ†∑ÁöÑÊï∞ÊçÆÂ§ßÈáè‰∏éÊúçÂä°Á´Ø‰∫§‰∫íÔºåÂØºËá¥ÊúçÂä°Á´ØCPU Â§ßÈáèÂç†Áî®„ÄÇ Â∏∏ËßÅÈóÆÈ¢òÊ≠§ÈÉ®ÂàÜÂÜÖÂÆπÂèÇËÄÉËá™HashMap ÁöÑÂ∑•‰ΩúÂéüÁêÜ 1. ‰ªÄ‰πàÊó∂ÂÄô‰ºö‰ΩøÁî® HashMapÔºü‰ªñÊúâ‰ªÄ‰πàÁâπÁÇπÔºüÊòØÂü∫‰∫é Map Êé•Âè£ÁöÑÂÆûÁé∞ÔºåÂ≠òÂÇ®ÈîÆÂÄºÂØπÊó∂ÔºåÂÆÉÂèØ‰ª•Êé•Êî∂ null ÁöÑÈîÆÂÄºÔºåÊòØÈùûÂêåÊ≠•ÁöÑÔºåHashMap Â≠òÂÇ®ÁùÄ Entry(hash, key, value, next)ÂØπË±°„ÄÇ 2. ‰Ω†Áü•ÈÅì HashMap ÁöÑÂ∑•‰ΩúÂéüÁêÜÂêóÔºüÈÄöËøá hash ÁöÑÊñπÊ≥ïÔºåÈÄöËøá put Âíå get Â≠òÂÇ®ÂíåËé∑ÂèñÂØπË±°„ÄÇÂ≠òÂÇ®ÂØπË±°Êó∂ÔºåÊàë‰ª¨Â∞Ü K/V ‰º†Áªô put ÊñπÊ≥ïÊó∂ÔºåÂÆÉË∞ÉÁî® hashCode ËÆ°ÁÆó hash ‰ªéËÄåÂæóÂà∞ bucket ‰ΩçÁΩÆÔºåËøõ‰∏ÄÊ≠•Â≠òÂÇ®ÔºåHashMap ‰ºöÊ†πÊçÆÂΩìÂâç bucket ÁöÑÂç†Áî®ÊÉÖÂÜµËá™Âä®Ë∞ÉÊï¥ÂÆπÈáè(Ë∂ÖËøá Load Facotr Âàô resize ‰∏∫ÂéüÊù•ÁöÑ 2 ÂÄç)„ÄÇËé∑ÂèñÂØπË±°Êó∂ÔºåÊàë‰ª¨Â∞Ü K ‰º†Áªô getÔºåÂÆÉË∞ÉÁî® hashCode ËÆ°ÁÆó hash ‰ªéËÄåÂæóÂà∞ bucket ‰ΩçÁΩÆÔºåÂπ∂Ëøõ‰∏ÄÊ≠•Ë∞ÉÁî® equals()ÊñπÊ≥ïÁ°ÆÂÆöÈîÆÂÄºÂØπ„ÄÇÂ¶ÇÊûúÂèëÁîüÁ¢∞ÊíûÁöÑÊó∂ÂÄôÔºåHashmap ÈÄöËøáÈìæË°®Â∞Ü‰∫ßÁîüÁ¢∞ÊíûÂÜ≤Á™ÅÁöÑÂÖÉÁ¥†ÁªÑÁªáËµ∑Êù•ÔºåÂú® Java 8 ‰∏≠ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ bucket ‰∏≠Á¢∞ÊíûÂÜ≤Á™ÅÁöÑÂÖÉÁ¥†Ë∂ÖËøáÊüê‰∏™ÈôêÂà∂(ÈªòËÆ§ÊòØ 8)ÔºåÂàô‰ΩøÁî®Á∫¢ÈªëÊ†ëÊù•ÊõøÊç¢ÈìæË°®Ôºå‰ªéËÄåÊèêÈ´òÈÄüÂ∫¶„ÄÇ 3. ‰Ω†Áü•ÈÅì get Âíå put ÁöÑÂéüÁêÜÂêóÔºüequals()Âíå hashCode()ÁöÑÈÉΩÊúâ‰ªÄ‰πà‰ΩúÁî®ÔºüÈÄöËøáÂØπ key ÁöÑ hashCode()ËøõË°å hashingÔºåÂπ∂ËÆ°ÁÆó‰∏ãÊ†á( n-1 &amp; hash)Ôºå‰ªéËÄåËé∑Âæó buckets ÁöÑ‰ΩçÁΩÆ„ÄÇÂ¶ÇÊûú‰∫ßÁîüÁ¢∞ÊíûÔºåÂàôÂà©Áî® key.equals()ÊñπÊ≥ïÂéªÈìæË°®ÊàñÊ†ë‰∏≠ÂéªÊü•ÊâæÂØπÂ∫îÁöÑËäÇÁÇπ 4. ‰Ω†Áü•ÈÅì hash ÁöÑÂÆûÁé∞ÂêóÔºü‰∏∫‰ªÄ‰πàË¶ÅËøôÊ†∑ÂÆûÁé∞ÔºüÂú® Java 1.8 ÁöÑÂÆûÁé∞‰∏≠ÔºåÊòØÈÄöËøá hashCode()ÁöÑÈ´ò 16 ‰ΩçÂºÇÊàñ‰Ωé 16 ‰ΩçÂÆûÁé∞ÁöÑÔºö(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)Ôºå‰∏ªË¶ÅÊòØ‰ªéÈÄüÂ∫¶„ÄÅÂäüÊïà„ÄÅË¥®ÈáèÊù•ËÄÉËôëÁöÑÔºåËøô‰πàÂÅöÂèØ‰ª•Âú® bucket ÁöÑ n ÊØîËæÉÂ∞èÁöÑÊó∂ÂÄôÔºå‰πüËÉΩ‰øùËØÅËÄÉËôëÂà∞È´ò‰Ωé bit ÈÉΩÂèÇ‰∏éÂà∞ hash ÁöÑËÆ°ÁÆó‰∏≠ÔºåÂêåÊó∂‰∏ç‰ºöÊúâÂ§™Â§ßÁöÑÂºÄÈîÄ„ÄÇ 5. Â¶ÇÊûú HashMap ÁöÑÂ§ßÂ∞èË∂ÖËøá‰∫ÜË¥üËΩΩÂõ†Â≠ê(load factor)ÂÆö‰πâÁöÑÂÆπÈáèÔºåÊÄé‰πàÂäûÔºüÂ¶ÇÊûúË∂ÖËøá‰∫ÜË¥üËΩΩÂõ†Â≠ê(ÈªòËÆ§ 0.75)ÔºåÂàô‰ºöÈáçÊñ∞ resize ‰∏Ä‰∏™ÂéüÊù•ÈïøÂ∫¶‰∏§ÂÄçÁöÑ HashMapÔºåÂπ∂‰∏îÈáçÊñ∞Ë∞ÉÁî® hash ÊñπÊ≥ï„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Èù¢ËØïÂøÖÂ§áÔºöHashMap Ê∫êÁ†ÅËß£ÊûêÔºàJDK8Ôºâ HashMap ÁöÑ hash ÂáΩÊï∞ÂéüÁêÜ ÈáçÊñ∞ËÆ§ËØÜ HashMap HashMap ÁöÑÂ∑•‰ΩúÂéüÁêÜ Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>javaÈõÜÂêàÊ°ÜÊû∂</category>
        <category>ÂéüÁêÜÂàÜÊûê</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>javaÈõÜÂêàÊ°ÜÊû∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVM ÂûÉÂúæÊî∂ÈõÜÂô®‰∏éÂÜÖÂ≠òÂàÜÈÖçÁ≠ñÁï•]]></title>
    <url>%2Fblog%2F2017%2F09%2F08%2FJVM%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[Á°ÆÂÆöÂõûÊî∂ÁöÑÂØπË±°„ÄåÊ≠ªÂéª„ÄçÁöÑÂØπË±°Âç≥‰∏çÂèØËÉΩÂÜçË¢´‰ªª‰ΩïÈÄîÂæÑ‰ΩøÁî®ÁöÑÂØπË±°„ÄÇ Âá†‰πéÊâÄÊúâÂØπË±°ÁöÑÂÆû‰æãÈÉΩÂ≠òÂú®Â†Ü‰∏≠„ÄÇÔºàÈÉ®ÂàÜ String ÂØπË±°Â≠òÂú®‰∫éÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÊ±†‰∏≠ÔºåJDK1.7 ‰ª•ÂâçÔºåÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÊ±†Â≠òÊîæÂú®ÊñπÊ≥ïÂå∫‰∏≠Ôºâ„ÄÇ ËøõË°åÂõûÊî∂ÁöÑÁ¨¨‰∏ÄÊ≠•Â∞±ÊòØÁ°ÆÂÆöÂì™‰∫õÂØπË±°ËøòÊ¥ªÁùÄÔºåÂì™‰∫õÂ∑≤ÁªèÊ≠ª‰∫°„ÄÇ ÂºïÁî®ËÆ°Êï∞ÁÆóÊ≥ïÁªôÂØπË±°‰∏≠Ê∑ªÂä†‰∏Ä‰∏™ÂºïÁî®ËÆ°Êï∞Âô®Ôºå ÊØèÂΩìÊúâ‰∏Ä‰∏™Âú∞ÊñπÂºïÁî®ÂÆÉÊó∂ÔºåËÆ°Êï∞Âô®ÂÄºÂ∞±Âä† 1Ôºõ ÂΩìÂºïÁî®Â§±ÊïàÊó∂ÔºåËÆ°Êï∞Âô®ÂÄºÂ∞±Âáè 1Ôºõ ‰ªª‰ΩïÊó∂ÂàªËÆ°Êï∞Âô®‰∏∫ 0 ÁöÑÂØπË±°Â∞±ÊòØ‰∏çÂèØËÉΩÂÜçË¢´‰ΩøÁî®ÁöÑ„ÄÇ Áº∫ÁÇπÔºöÂæàÈöæËß£ÂÜ≥ÂØπË±°‰πãÈó¥Áõ∏‰∫íÂæ™ÁéØÂºïÁî®ÁöÑÈóÆÈ¢ò„ÄÇÂõ†Ê≠§ Java ËôöÊãüÊú∫‰∏≠Ê≤°ÊúâÈááÁî®ÂºïÁî®ËÆ°Êï∞ÁÆóÊ≥ïÊù•ÁÆ°ÁêÜÂÜÖÂ≠ò„ÄÇ ÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ï‰∏ªÊµÅÁöÑÂïÜÁî®Á®ãÂ∫èËØ≠Ë®ÄÁöÑ‰∏ªÊµÅÂÆûÁé∞‰∏≠ÔºåÈÉΩÊòØÈÄöËøáÂèØËææÊÄßÂàÜÊûêÊù•Âà§Êñ≠ÂØπË±°ÊòØÂê¶Â≠òÊ¥ªÁöÑ„ÄÇ ÁÆóÊ≥ïÁöÑÂü∫Êú¨ÊÄùË∑ØÔºö ÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑÁß∞‰∏∫ GC Root ÁöÑÂØπË±°‰Ωú‰∏∫Ëµ∑ÂßãÁÇπÔºå‰ªéËøô‰∫õËäÇÁÇπÂºÄÂßãÂêë‰∏ãÊêúÁ¥¢ÔºåÊêúÁ¥¢Ëµ∞ËøáÁöÑË∑ØÂæÑÁß∞‰∏∫„ÄéÂºïÁî®Èìæ„ÄèÔºàReference ChainÔºâ ÂΩì‰∏Ä‰∏™ÂØπË±°Âà∞ GC Root Ê≤°Êúâ‰ªª‰ΩïÂºïÁî®ÈìæÁõ∏ËøûÊó∂ÔºåÂàôËØÅÊòéÊ≠§ÂØπË±°ÊòØ‰∏çÂèØÁî®ÁöÑ„ÄÇ GC Root ÂØπË±°ÁöÑÂÆö‰πâÊòØ‰ªÄ‰πàÔºü Help - Eclipse Platform ‰∏äÁªôÁöÑÂÆö‰πâÊòØËøôÊ†∑ÁöÑÔºö A garbage collection root is an object that is accessible from outside the heap ‰πüÂ∞±ÊòØËØ¥ GC Roots ÊòØÂèØ‰ª•‰ªéÂ†ÜÂ§ñËÆøÈóÆÁöÑÂØπË±°„ÄÇÁî± Java ËøêË°åÊó∂Êï∞ÊçÆÂå∫ÂèØ‰ª•Áü•ÈÅìÔºåÂ†ÜÂ§ñÁöÑÁ©∫Èó¥ÊúâËôöÊãüÊú∫Ê†à„ÄÅÊú¨Âú∞ÊñπÊ≥ïÊ†à‰ª•ÂèäÊñπÊ≥ïÂå∫„ÄÇËÄåjava 1.8 Â∞ÜÊï¥‰∏™ÊñπÊ≥ïÂå∫Ë¢´ÁßªÂà∞‰∏Ä‰∏™Âè´ÂÖÉÁ©∫Èó¥ÁöÑÂú∞ÊñπÔºà‰ΩøÁî®Êú¨Âú∞ÂÜÖÂ≠òÂ≠òÂÇ®Ôºâ ÊâÄ‰ª•GC Roots ÂØπË±°ÂåÖÂê´‰ª•‰∏ãÂá†ÁßçÔºö ËôöÊãüÊú∫Ê†à(Ê†àÂ∏ß‰∏≠ÁöÑÊú¨Âú∞ÂèòÈáèË°®)‰∏≠ÂºïÁî®ÁöÑÂØπË±°Ôºå‰πüÂ∞±ÊòØÂ±ÄÈÉ®ÂèòÈáèÂºïÁî®ÁöÑÂØπË±°„ÄÇ Êú¨Âú∞ÊñπÊ≥ïÊ†à‰∏≠ JNI ÂºïÁî®ÁöÑÂØπË±°ÔºåÂåÖÊã¨ Êú¨Âú∞ÊñπÊ≥ïÊ†à‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáèÊàñËÄÖÂèÇÊï∞ JNIÂÖ®Â±ÄÂºïÁî® ÊñπÊ≥ïÂå∫‰∏≠Á±ªÈùôÊÄÅÂ±ûÊÄßÂºïÁî®ÁöÑÂØπË±°„ÄÇÁî± Java ËôöÊãüÊú∫Ëá™Â∏¶ÁöÑÁ±ªÂä†ËΩΩÂô®ÊâÄÂä†ËΩΩÁöÑÁ±ªÔºåÂú®ËôöÊãüÊú∫ÁöÑÁîüÂëΩÂë®Êúü‰∏≠ÔºåÂßãÁªà‰∏ç‰ºöË¢´Âç∏ËΩΩ„ÄÇÂÆÉ‰ª¨ÂèØ‰ª•ÈÄöËøáÈùôÊÄÅÂ±ûÊÄßÁöÑÊñπÂºèÊåÅÊúâÂØπË±°ÁöÑÂºïÁî®„ÄÇÊ≥®ÊÑèÔºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÁî±Ëá™ÂÆö‰πâÁöÑÁ±ªÂä†ËΩΩÂô®Âä†ËΩΩÁöÑÁ±ª‰∏çËÉΩÊàê‰∏∫GC Roots ÊñπÊ≥ïÂå∫‰∏≠Â∏∏ÈáèÂºïÁî®ÁöÑÂØπË±° ÂºïÁî®ÂàÜÁ±ªJDK 1.2 ‰πãÂêéÂØπÔºåJava ÂØπÂºïÁî®ÁöÑÊ¶ÇÂøµËøõË°å‰∫ÜÊâ©ÂÖÖÔºà‰∏çÂÜçÊòØ‰ªÖÊúâË¢´ÂºïÁî®ÊàñËÄÖÊ≤°ÊúâË¢´ÂºïÁî®‰∏§ÁßçÔºâÔºö ÂÖ±ÊúâÂõõÁßçÔºö Âº∫ÂºïÁî® Âè™Ë¶ÅÂº∫ÂºïÁî®ËøòÂ≠òÂú®ÔºåÂûÉÂúæÊî∂ÈõÜÂô®Ê∞∏Ëøú‰∏ç‰ºöÂõûÊî∂ÊéâË¢´ÂºïÁî®ÁöÑÂØπË±°„ÄÇ ËΩØÂºïÁî® SoftReference ÂÜÖÂ≠ò‰∏çÂ§üÊó∂Ë¢´ÂõûÊî∂ Âú®Á≥ªÁªüÂ∞ÜË¶ÅÂèëÁîüÂÜÖÂ≠òÊ∫¢Âá∫ÂºÇÂ∏∏‰πãÂâçÔºåÂ∞Ü‰ºöÊääËøô‰∫õÂØπË±°ÂàóËøõÂõûÊî∂ËåÉÂõ¥‰πã‰∏≠ËøõË°åÁ¨¨‰∫åÊ¨°ÂõûÊî∂„ÄÇÂ¶ÇÊûúËøôÊ¨°ÂõûÊî∂ËøòÊ≤°ÊúâË∂≥Â§üÁöÑÂÜÖÂ≠òÔºåÊâç‰ºöÊäõÂá∫ÂÜÖÂ≠òÊ∫¢Âá∫ÂºÇÂ∏∏„ÄÇ Âº±ÂºïÁî® WeakReference Âè™Ë¶Å‰∏ÄÊâßË°å GC Â∞±‰ºöË¢´ÂõûÊî∂ ËôöÂºïÁî®Ôºå‰πüÁß∞‰∏∫ÂπΩÁÅµÂºïÁî®„ÄÅÂπªÂΩ±ÂºïÁî® PhantomReference „ÄéÂΩ¢ÂêåËôöËÆæ„Äè„ÄÇ‰∏Ä‰∏™ÂØπË±°Ë¢´ÊåÅÊúâËôöÂºïÁî®ÂØπÂÖ∂ÁîüÂëΩÂë®ÊúüÊØ´Êó†ÂΩ±Âìç ËôöÂºïÁî®ÁöÑ‰ΩúÁî®‰ªÖ‰ªÖÊòØÂú®ËØ•ÂØπË±°Ë¢´ÂõûÊî∂Êó∂ÔºåÊî∂Âà∞‰∏Ä‰∏™Á≥ªÁªüÈÄöÁü•ËÄåÂ∑≤ ÁîüÂ≠òËøòÊòØÊ≠ª‰∫°‰∏Ä‰∏™ÂØπË±°ÁöÑ finalize ÊñπÊ≥ïÊúÄÂ§öÂè™‰ºöË¢´Á≥ªÁªüË∞ÉÁî®‰∏ÄÊ¨°„ÄÇ Âç≥‰ΩøÂú®ÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ï‰∏≠‰∏çÂèØËææÁöÑÂØπË±°Ôºå‰πüÂπ∂ÈùûÊòØ„ÄåÈùûÊ≠ª‰∏çÂèØ„ÄçÁöÑÔºåË¶ÅÁúüÊ≠£ÂÆ£Âëä‰∏Ä‰∏™ÂØπË±°Ê≠ª‰∫°ÔºåËá≥Â∞ëË¶ÅÁªèÂéÜ‰∏§Ê¨°Ê†áËÆ∞ËøáÁ®ãÔºö Â¶ÇÊûúÂØπË±°Âú®ËøõË°åÂèØËææÊÄßÂàÜÊûêÂêéÂèëÁé∞Ê≤°Êúâ‰∏é GCRoots Áõ∏ËøûÊé•ÁöÑÂºïÁî®ÈìæÔºåÈÇ£ÂÆÉÂ∞Ü‰ºöË¢´Á¨¨‰∏ÄÊ¨°Ê†áËÆ∞Âπ∂‰∏îËøõË°å‰∏ÄÊ¨°Á≠õÈÄâÔºå Á≠õÈÄâÁöÑÊù°‰ª∂ÊòØÊ≠§ÂØπË±°ÊòØÂê¶ÊúâÂøÖË¶ÅÊâßË°å finalize ÊñπÊ≥ï„ÄÇÂΩìÂØπË±°Ê≤°ÊúâË¶ÜÁõñ finalize ÊñπÊ≥ïÔºåÊàñËÄÖ finalize ÊñπÊ≥ïÂ∑≤ÁªèË¢´ËôöÊãüÊú∫Ë∞ÉÁî®ËøáÔºåËôöÊãüÊú∫Â∞ÜËøô‰∏§ÁßçÊÉÖÂÜµÈÉΩËßÜ‰∏∫„ÄåÊ≤°ÊúâÂøÖË¶ÅÊâßË°å„Äç„ÄÇ Â¶ÇÊûúËøô‰∏™ÂØπË±°Ë¢´Âà§ÂÆö‰∏∫ÊúâÂøÖË¶ÅÊâßË°å finalize ÊñπÊ≥ïÔºåÈÇ£‰πàËøô‰∏™ÂØπË±°Â∞Ü‰ºöÊîæÁΩÆÂú®‰∏Ä‰∏™Âè´ÂÅö F-Queue ÁöÑÈòüÂàó‰πã‰∏≠ÔºåÂπ∂Âú®Á®çÂêéÁî±‰∏Ä‰∏™Áî±ËôöÊãüÊú∫Ëá™Âä®Âª∫Á´ãÁöÑ„ÄÅ‰Ωé‰ºòÂÖàÁ∫ßÁöÑ Finalizer Á∫øÁ®ãÂéªÊâßË°åÂÆÉ„ÄÇ ËøôÈáåÊâÄË∞ìÁöÑ„ÄåÊâßË°å„ÄçÊòØÊåáËôöÊãüÊú∫ ‰ºöËß¶ÂèëËøô‰∏™ÊñπÊ≥ïÔºå‰ΩÜÂπ∂‰∏çÊâøËØ∫‰ºöÁ≠âÂæÖÂÆÉËøêË°åÁªìÊùüÔºå‰∏∫‰ªÄ‰πàË¶ÅËøô‰πàÂÅöÔºü Âõ†‰∏∫Â¶ÇÊûúÊâøËØ∫ÂæóÂà∞ finalize ÊñπÊ≥ïÊâßË°åÁªìÊùüÔºåÈÇ£‰πàÂΩì‰∏Ä‰∏™ÂØπË±°Âú® finalize ÊñπÊ≥ï‰∏≠ÊâßË°åÁºìÊÖ¢ÔºåÊàñËÄÖÂèëÁîü‰∫ÜÊ≠ªÂæ™ÁéØÔºàÊõ¥ÊûÅÁ´ØÁöÑÊÉÖÂÜµÔºâÔºåÂ∞ÜÂæàÂèØËÉΩ‰ºöÂØºËá¥ F-Queue ÈòüÂàó‰∏≠ÂÖ∂‰ªñÂØπË±°Ê∞∏‰πÖÂ§Ñ‰∫éÁ≠âÂæÖÔºåÁîöËá≥ÂØºËá¥Êï¥‰∏™ÂÜÖÂ≠òÂõûÊî∂Á≥ªÁªüÂ¥©Ê∫É„ÄÇ finalize ÊñπÊ≥ïÊòØÂØπË±°ÈÄÉËÑ±Ê≠ª‰∫°ÂëΩËøêÁöÑ==ÊúÄÂêé‰∏ÄÊ¨°Êú∫‰ºö==ÔºåÁ®çÂêé GC Â∞ÜÂØπ F-Queue ‰∏≠ÁöÑÂØπË±°ËøõË°åÁ¨¨‰∫åÊ¨°Â∞èËßÑÊ®°ÁöÑÊ†áËÆ∞Ôºå Â¶ÇÊûúÂØπË±°Ë¶ÅÂú® finalize ‰∏≠ÊàêÂäüÊãØÊïëËá™Â∑±‚Äî‚ÄîÂè™Ë¶ÅÈáçÊñ∞‰∏éÂºïÁî®Èìæ‰∏äÁöÑ‰ªª‰Ωï‰∏Ä‰∏™ÂØπË±°Âª∫Á´ãÂÖ≥ËÅîÂç≥ÂèØÔºåË≠¨Â¶ÇÊääËá™Â∑±Ôºàthis ÂÖ≥ÈîÆÂ≠óÔºâËµãÂÄºÁªôÊüê‰∏™Á±ªÂèòÈáèÊàñËÄÖÂØπË±°ÁöÑÊàêÂëòÂèòÈáèÔºåÈÇ£Âú®Á¨¨‰∫åÊ¨°Ê†áËÆ∞Êó∂ÂÆÉÂ∞ÜË¢´ÁßªÈô§Âá∫„ÄåÂç≥Â∞ÜÂõûÊî∂„ÄçÁöÑÈõÜÂêàÔºõ Â¶ÇÊûúÂØπË±°ËøôÊó∂ÂÄôËøòÊ≤°ÊúâÈÄÉËÑ±ÔºåÈÇ£Âü∫Êú¨‰∏äÂÆÉÂ∞±ÁúüÁöÑË¢´ÂõûÊî∂‰∫Ü„ÄÇ ‰ªª‰Ωï‰∏Ä‰∏™ÂØπË±°ÁöÑ finalize ÊñπÊ≥ïÂè™‰ºöË¢´Á≥ªÁªüË∞ÉÁî®‰∏ÄÊ¨°„ÄÇ ÂõûÊî∂ÊñπÊ≥ïÂå∫Ê∞∏‰πÖ‰ª£ÁöÑÂûÉÂúæÂõûÊî∂‰∏ªË¶ÅÂõûÊî∂‰∏§ÈÉ®ÂàÜÁöÑÂÜÖÂÆπÔºö Â∫üÂºÉÂ∏∏Èáè Êó†Áî®ÁöÑÁ±ª ÂõûÊî∂Â∫üÂºÉÂ∏∏ÈáèÂõûÊî∂Â∫üÂºÉÂ∏∏Èáè‰∏éÂõûÊî∂ Java Â†Ü‰∏≠ÂØπË±°ÂæàÁõ∏‰ºº„ÄÇ‰ª•Â∏∏ÈáèÊ±†‰∏≠Â≠óÈù¢ÈáèÁöÑÂõûÊî∂‰∏∫‰æãÔºåÂÅáÂ¶Ç‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤„Äåabc„ÄçÂ∑≤ÁªèËøõÂÖ•‰∫ÜÂ∏∏ÈáèÊ±†‰∏≠ÔºåÂÆÉÊ≤°ÊúâË¢´ÂºïÁî®ÔºåÂ¶ÇÊûúËøôÊó∂ÂèëÁîüÂÜÖÂ≠òÂõûÊî∂ÔºåËÄå‰∏îÂøÖË¶ÅÁöÑËØùÔºåËøô‰∏™„Äåabc„ÄçÂ∏∏ÈáèÂ∞±‰ºöË¢´Á≥ªÁªüÊ∏ÖÁêÜÂá∫Â∏∏ÈáèÊ±†„ÄÇÂ∏∏ÈáèÊ±†‰∏≠ÁöÑÂÖ∂‰ªñÁ±ªÔºàÊé•Âè£Ôºâ„ÄÅÊñπÊ≥ï„ÄÅÂ≠óÊÆµÁöÑÁ¨¶Âè∑ÂºïÁî®‰πü‰∏éÊ≠§Á±ª‰ºº„ÄÇ ÂõûÊî∂Êó†Áî®Á±ªÁ±ªÈúÄË¶ÅÂêåÊó∂Êª°Ë∂≥‰∏ãÈù¢ 3 ‰∏™Êù°‰ª∂ÊâçËÉΩÁÆóÊòØ„ÄåÊó†Áî®ÁöÑÁ±ª„ÄçÔºö ËØ•Á±ªÊâÄÊúâÁöÑÂÆû‰æãÈÉΩÂ∑≤ÁªèË¢´ÂõûÊî∂Ôºå‰πüÂ∞±ÊòØ Java Â†Ü‰∏≠‰∏çÂ≠òÂú®ËØ•Á±ªÁöÑ‰ªª‰ΩïÂÆû‰æã„ÄÇ Âä†ËΩΩËØ•Á±ªÁöÑ ClassLoader Â∑≤ÁªèË¢´ÂõûÊî∂„ÄÇ ËØ•Á±ªÂØπÂ∫îÁöÑ java.lang.Class ÂØπË±°Ê≤°ÊúâÂú®‰ªª‰ΩïÂú∞ÊñπË¢´ÂºïÁî®ÔºåÊó†Ê≥ïÂú®‰ªª‰ΩïÂú∞ÊñπÈÄöËøáÂèçÂ∞ÑËÆøÈóÆËØ•Á±ªÁöÑÊñπÊ≥ï„ÄÇ ËôöÊãüÊú∫ÂèØ‰ª•ÂØπÊª°Ë∂≥‰∏äËø∞3‰∏™Êù°‰ª∂ÁöÑÊó†Áî®Á±ªËøõË°åÂõûÊî∂ÔºåËøôÈáåËØ¥ÁöÑ‰ªÖ‰ªÖÊòØ‚ÄúÂèØ‰ª•‚ÄùÔºåËÄåÂπ∂‰∏çÊòØÂíåÂØπË±°‰∏ÄÊ†∑Ôºå‰∏ç‰ΩøÁî®‰∫ÜÂ∞±ÂøÖÁÑ∂‰ºöÂõûÊî∂„ÄÇ ËÄå‰∏îÂõ†‰∏∫Áî± Java ËôöÊãüÊú∫Ëá™Â∏¶ÁöÑÁ±ªÂä†ËΩΩÂô®ÊâÄÂä†ËΩΩÁöÑÁ±ªÔºåÂú®ËôöÊãüÊú∫ÁöÑÁîüÂëΩÂë®Êúü‰∏≠ÔºåÂßãÁªà‰∏ç‰ºöË¢´Âç∏ËΩΩ„ÄÇÊâÄ‰ª•Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÂõûÊî∂Êó†Áî®Á±ªÊî∂ÊïàÁîöÂæÆ„ÄÇ ÂûÉÂúæÊî∂ÈõÜÁÆóÊ≥ïÊ†áËÆ∞-Ê∏ÖÈô§ÁÆóÊ≥ïÊ†áËÆ∞-Ê∏ÖÈô§ (Mark-Sweep) ÁÆóÊ≥ïÊòØÊúÄÂü∫Á°ÄÁöÑÊî∂ÈõÜÁÆóÊ≥ïÔºåÂàÜ‰∏∫Ê†áËÆ∞ÂíåÊ∏ÖÈô§‰∏§‰∏™Èò∂ÊÆµÔºö È¶ñÂÖàÊ†áËÆ∞Âá∫ÊâÄÊúâÈúÄË¶ÅÂõûÊî∂ÁöÑÂØπË±°Ôºå Âú®Ê†áËÆ∞ÂÆåÊàêÂêéÁªü‰∏ÄÂõûÊî∂ÊâÄÊúâË¢´Ê†áËÆ∞ÁöÑÂØπË±° ‰πãÊâÄ‰ª•ËØ¥ÂÆÉÂü∫Á°ÄÔºåÊòØÂõ†‰∏∫ÂêéÁª≠ÁöÑÊî∂ÈõÜÁÆóÊ≥ïÈÉΩÊòØÂü∫‰∫éËøôÁßçÊÄùË∑ØÂπ∂ÂØπÂÖ∂‰∏çË∂≥ËøõË°åÊîπËøõËÄåÂæóÂà∞ÁöÑ„ÄÇ ‰∏ªË¶Å‰∏çË∂≥Êúâ‰∏§‰∏™Ôºö ÊïàÁéáÈóÆÈ¢òÔºöÊ†áËÆ∞ÂíåÊ∏ÖÈô§‰∏§‰∏™ËøáÁ®ãÁöÑÊïàÁéáÈÉΩ‰∏çÈ´òÔºõ Á©∫Èó¥ÈóÆÈ¢òÔºàÁ°ÆÂàáËÄåË®ÄÊòØÁ©∫Èó¥Á¢éÁâáÈóÆÈ¢òÔºâÔºöÊ†áËÆ∞Ê∏ÖÈô§‰πãÂêé‰ºö‰∫ßÁîüÂ§ßÈáè‰∏çËøûÁª≠ÁöÑÂÜÖÂ≠òÁ¢éÁâáÔºåÁ©∫Èó¥Á¢éÁâáÂ§™Â§öÂèØËÉΩ‰ºöÂØºËá¥‰ª•ÂêéÂú®Á®ãÂ∫èËøêË°åËøáÁ®ã‰∏≠ÈúÄË¶ÅÂàÜÈÖçËæÉÂ§ßÂØπË±°Êó∂ÔºåÊó†Ê≥ïÊâæÂà∞Ë∂≥Â§üÁöÑËøûÁª≠ÂÜÖÂ≠òËÄå‰∏çÂæó‰∏çÊèêÂâçËß¶ÂèëÂè¶‰∏ÄÊ¨°ÂûÉÂúæÊî∂ÈõÜÂä®‰Ωú„ÄÇ ‰ªÖÊúâ CMS Êî∂ÈõÜÂô®‰ΩøÁî®‰∫ÜÊ†áËÆ∞-Ê∏ÖÈô§ÁÆóÊ≥ï„ÄÇ Â§çÂà∂ÁÆóÊ≥ïÂ§çÂà∂ÁÆóÊ≥ï‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜËß£ÂÜ≥ÊïàÁéáÈóÆÈ¢òÔºåÂÆÉÂ∞ÜÂèØÁî®ÂÜÖÂ≠òÊåâÂÆπÈáèÂàíÂàÜ‰∏∫Â§ßÂ∞èÁõ∏Á≠âÁöÑ‰∏§ÂùóÔºåÊØèÊ¨°Âè™‰ΩøÁî®ÂÖ∂‰∏≠ÁöÑ‰∏ÄÂùó„ÄÇ ÂΩìËøô‰∏ÄÂùóÁöÑÂÜÖÂ≠òÁî®ÂÆå‰∫ÜÔºåÂ∞±Â∞ÜËøòÂ≠òÊ¥ªÁùÄÁöÑÂØπË±°Â§çÂà∂Âà∞Âè¶Â§ñ‰∏ÄÂùó‰∏äÈù¢ÔºåÁÑ∂ÂêéÂÜçÊääÂ∑≤‰ΩøÁî®ËøáÁöÑÂÜÖÂ≠òÁ©∫Èó¥‰∏ÄÊ¨°Ê∏ÖÁêÜÊéâ„ÄÇËøôÊ†∑‰ΩøÂæóÊØèÊ¨°ÈÉΩÊòØÂØπÊï¥‰∏™ÂçäÂå∫ËøõË°åÂÜÖÂ≠òÂõûÊî∂ÔºåÂÜÖÂ≠òÂàÜÈÖçÊó∂‰πüÂ∞±‰∏çÁî®ËÄÉËôëÂÜÖÂ≠òÁ¢éÁâáÁ≠âÂ§çÊùÇÊÉÖÂÜµÔºåÂè™Ë¶ÅÁßªÂä®Â†ÜÈ°∂ÊåáÈíàÔºåÊåâÈ°∫Â∫èÂàÜÈÖçÂÜÖÂ≠òÂç≥ÂèØÔºåÂÆûÁé∞ÁÆÄÂçïÔºåËøêË°åÈ´òÊïà„ÄÇ ÂïÜ‰∏öËôöÊãüÊú∫ÈÉΩÈááÁî®Â§çÂà∂Êî∂ÈõÜÁÆóÊ≥ïÊù•ÂõûÊî∂Êñ∞Áîü‰ª£Ôºå‰ΩÜÂπ∂‰∏çÊòØÊåâÁÖß 1:1 ÁöÑÊØî‰æãÊù•ÂàíÂàÜÂÜÖÂ≠òÁ©∫Èó¥ÔºåËÄåÊòØÂ∞ÜÂÜÖÂ≠òÂàÜ‰∏∫‰∏ÄÂùóËæÉÂ§ßÁöÑ Eden Á©∫Èó¥Âíå==‰∏§Âùó==ËæÉÂ∞èÁöÑ ==Survivor== Á©∫Èó¥ÔºåÊØèÊ¨°‰ΩøÁî® Eden ÂíåÂÖ∂‰∏≠‰∏ÄÂùó SurvivorÔºåÂΩìÂõûÊî∂Êó∂ÔºåÂ∞Ü Eden Âíå Survivor ‰∏≠ËøòÂ≠òÊ¥ªÁùÄÁöÑÂØπË±°‰∏ÄÊ¨°ÊÄßÂú∞Â§çÂà∂Âà∞==Âè¶Â§ñ‰∏ÄÂùó==Survivor Á©∫Èó¥‰∏äÔºåÊúÄÂêéÊ∏ÖÁêÜÊéâ Eden ÂíåÂàöÊâçÁî®ËøáÁöÑ Survivor Á©∫Èó¥„ÄÇ HotSpot ËôöÊãüÊú∫ÈªòËÆ§ Eden Âíå‰∏§Âùó Survivor ÁöÑÂ§ßÂ∞èÊØî‰æãÊòØ 8:1:1Ôºå‰πüÂ∞±ÊòØÊØèÊ¨°Êñ∞Áîü‰ª£‰∏≠ÂèØÁî®ÂÜÖÂ≠òÁ©∫Èó¥‰∏∫Êï¥‰∏™Êñ∞Áîü‰ª£ÂÆπÈáèÁöÑ 90%Ôºà80%+10%ÔºâÔºåÂè™Êúâ 10%ÁöÑÂÜÖÂ≠ò‰ºöË¢´„ÄåÊµ™Ë¥π„Äç„ÄÇÂΩì Survivor Á©∫Èó¥‰∏çÂ§üÁî®Êó∂ÔºåÈúÄË¶Å‰æùËµñÂÖ∂‰ªñÂÜÖÂ≠òÔºàËøôÈáåÊåáËÄÅÂπ¥‰ª£ÔºâËøõË°åÂàÜÈÖçÊãÖ‰øùÔºàHandle PromotionÔºâ„ÄÇ Áº∫ÁÇπÔºö ‰ΩøÁî®Á©∫Èó¥Êç¢ÂèñÊó∂Èó¥ÔºåËøôÁßçÁÆóÊ≥ïÂ∞ÜÂÜÖÂ≠òÁº©Â∞è‰∏∫‰∫ÜÂéüÊù•ÁöÑ‰∏ÄÂçä„ÄÇ Â§çÂà∂Êî∂ÈõÜÁÆóÊ≥ïÂú®ÂØπË±°Â≠òÊ¥ªÁéáËæÉÈ´òÊó∂Â∞±Ë¶ÅËøõË°åËæÉÂ§öÁöÑÂ§çÂà∂Êìç‰ΩúÔºåÊïàÁéáÂ∞Ü‰ºöÂèò‰Ωé„ÄÇÊõ¥ÂÖ≥ÈîÆÁöÑÊòØÔºåÂ¶ÇÊûú‰∏çÊÉ≥Êµ™Ë¥π 50%ÁöÑÁ©∫Èó¥ÔºåÂ∞±ÈúÄË¶ÅÊúâÈ¢ùÂ§ñÁöÑÁ©∫Èó¥ËøõË°åÂàÜÈÖçÊãÖ‰øùÔºå‰ª•Â∫îÂØπË¢´‰ΩøÁî®ÁöÑÂÜÖÂ≠ò‰∏≠ÊâÄÊúâÂØπË±°ÈÉΩ 100% Â≠òÊ¥ªÁöÑÊûÅÁ´ØÊÉÖÂÜµÔºåÊâÄ‰ª•Âú®ËÄÅÂπ¥‰ª£‰∏ÄËà¨‰∏çËÉΩÁõ¥Êé•ÈÄâÁî®ËøôÁßçÂ§çÂà∂ÁÆóÊ≥ï„ÄÇ Ê†áËÆ∞-==Êï¥ÁêÜ==ÁÆóÊ≥ï„ÄåÊ†áËÆ∞-Êï¥ÁêÜ„ÄçÁÆóÊ≥ïÁöÑÊ†áËÆ∞ËøáÁ®ã‰ªçÁÑ∂‰∏é„ÄåÊ†áËÆ∞-Ê∏ÖÈô§„ÄçÁÆóÊ≥ï‰∏ÄÊ†∑Ôºå‰ΩÜÂêéÁª≠Ê≠•È™§‰∏çÊòØÁõ¥Êé•ÂØπÂèØÂõûÊî∂ÂØπË±°ËøõË°åÊ∏ÖÁêÜÔºåËÄåÊòØËÆ©ÊâÄÊúâÂ≠òÊ¥ªÁöÑÂØπË±°ÈÉΩÂêë‰∏ÄÁ´ØÁßªÂä®ÔºåÁÑ∂ÂêéÁõ¥Êé•Ê∏ÖÁêÜÊéâÁ´ØËæπÁïå‰ª•Â§ñÁöÑÂÜÖÂ≠ò„ÄÇ(ÂÖàÁßªÂä®Âà∞„ÄéÂÆâÂÖ®‰ΩçÁΩÆ„ÄèÂÜçÊ∏ÖÈô§ÊéâÂÆâÂÖ®Âå∫ÂüüËæπÁïåÂ§ñÁöÑÊó†Áî®‰ΩçÁΩÆ) ÂàÜ‰ª£Êî∂ÈõÜÁÆóÊ≥ïÁõÆÂâçÂïÜ‰∏öËôöÊãüÊú∫ÁöÑÂûÉÂúæÊî∂ÈõÜÈÉΩÈááÁî®„ÄåÂàÜ‰ª£Êî∂ÈõÜ„ÄçÔºàGenerational CollectionÔºâÁÆóÊ≥ïÔºå Âè™ÊòØÊ†πÊçÆÂØπË±°Â≠òÊ¥ªÂë®ÊúüÁöÑ‰∏çÂêåÂ∞ÜÂÜÖÂ≠òÂàíÂàÜ‰∏∫Âá†Âùó„ÄÇ‰∏ÄËà¨ÊòØÊää Java Â†ÜÂàÜ‰∏∫Êñ∞Áîü‰ª£ÂíåËÄÅÂπ¥‰ª£ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Ê†πÊçÆÂêÑ‰∏™Âπ¥‰ª£ÁöÑÁâπÁÇπÈááÁî®ÊúÄÈÄÇÂΩìÁöÑÊî∂ÈõÜÁÆóÊ≥ï„ÄÇÂèØ‰ª•ÈÄöËøá -XX:NewRatioË∞ÉÊï¥Êñ∞Áîü‰ª£‰∏éËÄÅÂπ¥‰ª£ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÊØî‰æãÔºàÊåáÂÆöËÄÅÂπ¥‰ª£ÊâÄÂç†ÁöÑ„Äå‰ªΩÊï∞„ÄçÔºâ„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ã NewRatio = 2ÔºåÂç≥Ôºö Êñ∞Áîü‰ª£Á∫¶Âç†Êï¥‰∏™Â†ÜÁ©∫Èó¥ÁöÑ 1/3 ,ËÄÅÂπ¥‰ª£Á∫¶Âç† 2/3 „ÄÇ Âú®Êñ∞Áîü‰ª£‰∏≠ÔºåÂõ†‰∏∫ÂØπË±°Â≠òÊ¥ªÁéáÊØîËæÉ‰ΩéÔºåÂè™ÈúÄË¶Å‰ªòÂá∫Â∞ëÈáèÂ≠òÊ¥ªÂØπË±°ÁöÑÂ§çÂà∂ÊàêÊú¨Â∞±ÂèØ‰ª•ÂÆåÊàêÊî∂ÈõÜ„ÄÇÈÄâÁî®Â§çÂà∂ÁÆóÊ≥ï„ÄÇ ËÄåËÄÅÂπ¥‰ª£‰∏≠Âõ†‰∏∫ÂØπË±°Â≠òÊ¥ªÁéáÈ´ò„ÄÅÊ≤°ÊúâÈ¢ùÂ§ñÁ©∫Èó¥ÂØπÂÆÉËøõË°åÂàÜÈÖçÊãÖ‰øùÔºåÂ∞±ÂøÖÈ°ª‰ΩøÁî®„ÄåÊ†áËÆ∞-Ê∏ÖÁêÜ„ÄçÊàñËÄÖ„ÄåÊ†áËÆ∞-Êï¥ÁêÜ„ÄçÁÆóÊ≥ïÊù•ËøõË°åÂõûÊî∂„ÄÇ HotSpot ÁöÑÁÆóÊ≥ïÂÆûÁé∞Â¶Ç‰ΩïÂèëËµ∑ÂÜÖÂ≠òÂõûÊî∂ÔºüÈ¶ñÂÖàË¶ÅÁü•ÈÅìÂõûÊî∂ÁöÑÂì™‰∫õÂØπË±°„ÄÇ Êûö‰∏æÊ†πËäÇÁÇπÂèØ‰Ωú‰∏∫ GC Roots ÁöÑËäÇÁÇπ‰∏ªË¶ÅÂú®ÂÖ®Â±ÄÊÄßÁöÑÂºïÁî®Ôºà‰æãÂ¶ÇÂ∏∏ÈáèÊàñÁ±ªÈùôÊÄÅÂ±ûÊÄßÔºâ‰∏éÊâßË°å‰∏ä‰∏ãÊñáÔºà‰æãÂ¶ÇÊ†àÂ∏ß‰∏≠ÁöÑÊú¨Âú∞ÂèòÈáèË°®Ôºâ‰∏≠ÔºåÁé∞Âú®ÂæàÂ§öÂ∫îÁî®‰ªÖ‰ªÖÊñπÊ≥ïÂå∫Â∞±ÊúâÊï∞ÁôæÂÖÜÔºåÂ¶ÇÊûúË¶ÅÈÄê‰∏™Ê£ÄÊü•ËøôÈáåÈù¢ÁöÑÂºïÁî®ÔºåÈÇ£‰πàÂøÖÁÑ∂‰ºöÊ∂àËÄóÂæàÂ§öÊó∂Èó¥„ÄÇ ÂàÜÊûêÊúüÈó¥ÂºïÁî®‰∏çÂèØÂèòÂØºËá¥ GC ÂÅúÈ°øÂèØËææÊÄßÂàÜÊûêÂØπÊâßË°åÊó∂Èó¥ÁöÑÊïèÊÑüËøò‰ΩìÁé∞Âú® GC ÂÅúÈ°ø ‰∏äÔºåÂõ†‰∏∫ËøôÈ°πÂàÜÊûêÂ∑•‰ΩúÂøÖÈ°ªÂú®‰∏Ä‰∏™ËÉΩÁ°Æ‰øù‰∏ÄËá¥ÊÄßÁöÑÂø´ÁÖß‰∏≠ËøõË°å„ÄÇ „Äå‰∏ÄËá¥ÊÄß„ÄçÁöÑÊÑèÊÄùÊòØÊåáÂú®Êï¥‰∏™ÂàÜÊûêÊúüÈó¥Ôºå‰∏çÂèØ‰ª•Âá∫Áé∞ÂàÜÊûêËøáÁ®ã‰∏≠ÂØπË±°ÂºïÁî®ÂÖ≥Á≥ªËøòÂú®‰∏çÊñ≠ÂèòÂåñÁöÑÊÉÖÂÜµÔºåËØ•ÁÇπ‰∏çÊª°Ë∂≥ÁöÑËØùÂàÜÊûêÁªìÊûúÂáÜÁ°ÆÊÄßÂ∞±Êó†Ê≥ïÂæóÂà∞‰øùËØÅ„ÄÇËøôÁÇπÊòØÂØºËá¥ GC ËøõË°åÊó∂ÂøÖÈ°ªÂÅúÈ°øÊâÄÊúâ Java ÊâßË°åÁ∫øÁ®ãÔºàSun Â∞ÜËøô‰ª∂‰∫ãÊÉÖÁß∞‰∏∫„ÄåStop The World„ÄçÔºâÁöÑÂÖ∂‰∏≠‰∏Ä‰∏™ÈáçË¶ÅÂéüÂõ†ÔºåÂç≥‰ΩøÊòØÂú®Âè∑Áß∞ÔºàÂá†‰πéÔºâ‰∏ç‰ºöÂèëÁîüÂÅúÈ°øÁöÑ CMS Êî∂ÈõÜÂô®‰∏≠ÔºåÊûö‰∏æÊ†πËäÇÁÇπÊó∂‰πüÊòØÂøÖÈ°ªË¶ÅÂÅúÈ°øÁöÑ„ÄÇ Áî±‰∫éÁõÆÂâçÁöÑ‰∏ªÊµÅ Java ËôöÊãüÊú∫‰ΩøÁî®ÁöÑÈÉΩÊòØÂáÜÁ°ÆÂºè GCÔºå‰πüÂ∞±ÊòØËØ¥ÔºåËôöÊãüÊú∫ÂèØ‰ª•ÂáÜÁ°ÆÁöÑÁü•ÈÅìÂÜÖÂ≠ò‰∏≠Êüê‰∏™‰ΩçÁΩÆÁöÑÊï∞ÊçÆÁ±ªÂûãÊòØ‰ªÄ‰πà„ÄÇÊâÄ‰ª•ÂΩìÊâßË°åÁ≥ªÁªüÂÅúÈ°ø‰∏ãÊù•ÂêéÔºåÂπ∂‰∏çÈúÄË¶Å‰∏Ä‰∏™‰∏çÊºèÂú∞Ê£ÄÊü•ÂÆåÊâÄÊúâÊâßË°å‰∏ä‰∏ãÊñáÂíåÂÖ®Â±ÄÁöÑÂºïÁî®‰ΩçÁΩÆÔºåËôöÊãüÊú∫Âè™Ë¶ÅÁõ¥Êé•Êâ´ÊèèÂ≠òÊîæÂØπË±°ÂºïÁî®ÁöÑÂå∫Âüü„ÄÇ Âú® HotSpot ÁöÑÂÆûÁé∞‰∏≠Ôºå‰ΩøÁî®‰∏ÄÁªÑÁß∞‰∏∫ OopMap ÁöÑÊï∞ÊçÆÁªìÊûÑÊù•ËææÂà∞Ëøô‰∏™ÁõÆÁöÑÁöÑÔºåÂú®Á±ªÂä†ËΩΩÂÆåÊàêÁöÑÊó∂ÂÄôÔºåHotSpot Â∞±ÊääÂØπË±°ÂÜÖ‰ªÄ‰πàÂÅèÁßªÈáè‰∏äÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊï∞ÊçÆËÆ°ÁÆóÂá∫Êù•ÔºåÂú® JIT ÁºñËØëËøáÁ®ã‰∏≠Ôºå‰πü‰ºöÂú®ÁâπÂÆöÁöÑ‰ΩçÁΩÆËÆ∞ÂΩï‰∏ãÊ†àÂíåÂØÑÂ≠òÂô®‰∏≠Âì™‰∫õ‰ΩçÁΩÆÊòØÂºïÁî®„ÄÇËøôÊ†∑ÔºåGC Âú®Êâ´ÊèèÊó∂Â∞±ÂèØ‰ª•Áõ¥Êé•ÂæóÁü•Ëøô‰∫õ‰ø°ÊÅØ‰∫Ü„ÄÇ ‰ΩøÁî®Á©∫Èó¥Êç¢Êó∂Èó¥„ÄÇ ÂÆâÂÖ®ÁÇπ‰ªéÁ∫øÁ®ãËßíÂ∫¶ÁúãÔºåsafepoint ÂèØ‰ª•ÁêÜËß£ÊàêÊòØÂú®‰ª£Á†ÅÊâßË°åËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∫õÁâπÊÆä‰ΩçÁΩÆÔºåÂΩìÁ∫øÁ®ãÊâßË°åÂà∞Ëøô‰∫õ‰ΩçÁΩÆÁöÑÊó∂ÂÄôÔºåËØ¥ÊòéËôöÊãüÊú∫ÂΩìÂâçÁöÑÁä∂ÊÄÅÊòØÂÆâÂÖ®ÁöÑÔºåÔºàÂ∞±Â•ΩÂÉèÈ´òÈÄüÂÖ¨Ë∑Ø‰∏äÁöÑÊúçÂä°Âå∫ÔºåÂèØ‰ª•ÂÆâÂÖ®Âú∞ÂÅú‰∏ãÊù•‰ºëÊÅØÔºâ Â¶ÇÊûúÊúâÈúÄË¶ÅÔºåÂèØ‰ª•Âú®Ëøô‰∏™‰ΩçÁΩÆÊöÇÂÅúÔºåÊØîÂ¶ÇÂèëÁîü GC Êó∂ÔºåÈúÄË¶ÅÊöÇÂÅúÊöÇÂÅúÊâÄ‰ª•Ê¥ªÂä®Á∫øÁ®ãÔºå ‰ΩÜÊòØÁ∫øÁ®ãÂú®Ëøô‰∏™Êó∂ÂàªÔºåËøòÊ≤°ÊúâÊâßË°åÂà∞‰∏Ä‰∏™ÂÆâÂÖ®ÁÇπÔºåÊâÄ‰ª•ËØ•Á∫øÁ®ãÂ∫îËØ•ÁªßÁª≠ÊâßË°åÔºåÂà∞Ëææ‰∏ã‰∏Ä‰∏™ÂÆâÂÖ®ÁÇπÁöÑÊó∂ÂÄôÊöÇÂÅúÔºåÁ≠âÂæÖ GC ÁªìÊùü„ÄÇÔºàËøòÂú®È©¨Ë∑Ø‰∏äÔºåÂ∞±‰∏çËÉΩ‰ºëÊÅØÔºåË¶ÅÂà∞‰∏ã‰∏Ä‰∏™ÊúçÂä°Âå∫ÊâçËÉΩ‰ºëÊÅØÔºâ ÂÆâÂÖ®ÁöÑÈÄâÂèñÂÆâÂÖ®ÁÇπÊòØÊÄé‰πàÈÄâÁöÑÔºüÂü∫Êú¨‰∏äÊòØ‰ª•Á®ãÂ∫è„ÄåÊòØÂê¶ÂÖ∑ÊúâËÆ©Á®ãÂ∫èÈïøÊó∂Èó¥ÊâßË°åÁöÑÁâπÂæÅ„Äç‰∏∫Ê†áÂáÜËøõË°åÈÄâÂÆöÁöÑ„ÄÇ „ÄåÈïøÊó∂Èó¥ÊâßË°å„ÄçÁöÑÊúÄÊòéÊòæÁâπÂæÅÂ∞±ÊòØÊåá‰ª§Â∫èÂàóÂ§çÁî®Ôºå‰æãÂ¶ÇÔºöÊñπÊ≥ïË∞ÉÁî®„ÄÅÂæ™ÁéØË∑≥ËΩ¨„ÄÅÂºÇÂ∏∏Ë∑≥ËΩ¨Á≠âÔºåÊâÄ‰ª•ÂÖ∑ÊúâËøô‰∫õÂäüËÉΩÁöÑÊåá‰ª§Êâç‰ºö‰∫ßÁîü Safepoint„ÄÇ GC Êó∂ËÆ©Á∫øÁ®ãÂÅúÊ≠¢ÁöÑÊñπÂºèÂ¶Ç‰ΩïÂú® GC ÂèëÁîüÊó∂ËÆ©ÊâÄÊúâÁ∫øÁ®ãÔºàËøôÈáå‰∏çÂåÖÊã¨ÊâßË°å JNI Ë∞ÉÁî®ÁöÑÁ∫øÁ®ãÔºâÈÉΩ„ÄåË∑ë„ÄçÂà∞ÊúÄËøëÁöÑÂÆâÂÖ®ÁÇπ‰∏äÂÜçÂÅúÈ°ø‰∏ãÊù•Ôºü ËøôÈáåÊúâ‰∏§ÁßçÊñπÊ°àÂèØ‰æõÈÄâÊã©ÔºöÊä¢ÂÖàÂºè‰∏≠Êñ≠ÔºàPreemptive SuspensionÔºâÂíå‰∏ªÂä®Âºè‰∏≠Êñ≠ÔºàVoluntary SuspensionÔºâÔºå Êä¢ÂÖàÂºè‰∏≠Êñ≠Âú® GC ÂèëÁîüÊó∂ÔºåÈ¶ñÂÖàÊääÊâÄÊúâÁ∫øÁ®ãÂÖ®ÈÉ®‰∏≠Êñ≠ÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÁ∫øÁ®ã‰∏≠Êñ≠ÁöÑÂú∞Êñπ‰∏çÂú®ÂÆâÂÖ®ÁÇπ‰∏äÔºåÂ∞±ÊÅ¢Â§çÁ∫øÁ®ãÔºåËÆ©ÂÆÉ„ÄåË∑ë„ÄçÂà∞ÂÆâÂÖ®ÁÇπ‰∏ä„ÄÇÁé∞Âú®Âá†‰πéÊ≤°ÊúâËôöÊãüÊú∫ÂÆûÁé∞ÈááÁî®Êä¢ÂÖàÂºè‰∏≠Êñ≠Êù•ÊöÇÂÅúÁ∫øÁ®ã‰ªéËÄåÂìçÂ∫î GC ‰∫ã‰ª∂„ÄÇ ‰∏ªÂä®Âºè‰∏≠Êñ≠‰∏ªÂä®Âºè‰∏≠Êñ≠ÁöÑÊÄùÊÉ≥ÊòØÂΩì GC ÈúÄË¶Å‰∏≠Êñ≠Á∫øÁ®ãÁöÑÊó∂ÂÄôÔºå‰∏çÁõ¥Êé•ÂØπÁ∫øÁ®ãÊìç‰ΩúÔºå‰ªÖ‰ªÖÁÆÄÂçïÂú∞ËÆæÁΩÆ‰∏Ä‰∏™Ê†áÂøóÔºåÂêÑ‰∏™Á∫øÁ®ãÊâßË°åÊó∂‰∏ªÂä®ÂéªËΩÆËØ¢Ëøô‰∏™Ê†áÂøóÔºåÂèëÁé∞‰∏≠Êñ≠Ê†áÂøó‰∏∫ÁúüÊó∂Â∞±Ëá™Â∑±‰∏≠Êñ≠ÊåÇËµ∑„ÄÇ ËΩÆËØ¢Ê†áÂøóÁöÑÂú∞ÊñπÂíåÂÆâÂÖ®ÁÇπÊòØÈáçÂêàÁöÑÔºåÂè¶Â§ñÂÜçÂä†‰∏äÂàõÂª∫ÂØπË±°ÈúÄË¶ÅÂàÜÈÖçÂÜÖÂ≠òÁöÑÂú∞Êñπ„ÄÇ ÂÆâÂÖ®Âå∫ÂüüÂÆâÂÖ®Âå∫ÂüüÊòØ‰∏Ä‰∏™ÂÆâÂÖ®ÁÇπËøûÁª≠ÁöÑ‰ª£Á†ÅÊÆµ„ÄÇ ÂÆâÂÖ®Âå∫ÂüüÊòØÊåáÂú®‰∏ÄÊÆµ‰ª£Á†ÅÁâáÊÆµ‰πã‰∏≠ÔºåÂºïÁî®ÂÖ≥Á≥ª‰∏ç‰ºöÂèëÁîüÂèòÂåñ„ÄÇÂú®Ëøô‰∏™Âå∫Âüü‰∏≠ÁöÑ‰ªªÊÑèÂú∞ÊñπÂºÄÂßã GC ÈÉΩÊòØÂÆâÂÖ®ÁöÑ„ÄÇÊàë‰ª¨‰πüÂèØ‰ª•Êää Safe Region ÁúãÂÅöÊòØË¢´Êâ©Â±ï‰∫ÜÁöÑ Safepoint„ÄÇ Âú®Á∫øÁ®ãÊâßË°åÂà∞ Safe Region ‰∏≠ÁöÑ‰ª£Á†ÅÊó∂ÔºåÈ¶ñÂÖàÊ†áËØÜËá™Â∑±Â∑≤ÁªèËøõÂÖ•‰∫Ü Safe RegionÔºå ÈÇ£Ê†∑ÔºåÂΩìÂú®ËøôÊÆµÊó∂Èó¥Èáå JVM Ë¶ÅÂèëËµ∑ GC Êó∂ÔºåÂ∞±‰∏çÁî®ÁÆ°Ê†áËØÜËá™Â∑±‰∏∫ Safe Region Áä∂ÊÄÅÁöÑÁ∫øÁ®ã‰∫Ü„ÄÇ ÔºàÈÇ£‰∫õÊ≤°Ê†áËÆ∞‰∏∫ÂÆâÂÖ®Âå∫ÂüüÁöÑÊÄé‰πàÂ§ÑÁêÜÔºüÔºâ Âú®Á∫øÁ®ãË¶ÅÁ¶ªÂºÄ Safe Region Êó∂ÔºåÂÆÉË¶ÅÊ£ÄÊü•Á≥ªÁªüÊòØÂê¶Â∑≤ÁªèÂÆåÊàê‰∫Ü==Ê†πËäÇÁÇπÊûö‰∏æ==ÔºàÊàñËÄÖÊòØÊï¥‰∏™ GC ËøáÁ®ãÔºâ[Âõ†‰∏∫ÂÖ∂‰ªñÊ≠•È™§ÂèØËÉΩ‰∏çÈúÄË¶Å stop the world ] Â¶ÇÊûúÂÆåÊàê‰∫ÜÔºåÈÇ£Á∫øÁ®ãÂ∞±ÁªßÁª≠ÊâßË°åÔºå Âê¶ÂàôÂÆÉÂ∞±ÂøÖÈ°ªÁ≠âÂæÖÁõ¥Âà∞Êî∂Âà∞ÂèØ‰ª•ÂÆâÂÖ®Á¶ªÂºÄ Safe Region ÁöÑ‰ø°Âè∑‰∏∫Ê≠¢„ÄÇ ÂûÉÂúæÊî∂ÈõÜÂô®ÂÜÖÂ≠òÂõûÊî∂Â¶Ç‰ΩïËøõË°åÊòØÁî±ËôöÊãüÊú∫ÊâÄÈááÁî®ÁöÑ GC Êî∂ÈõÜÂô®ÂÜ≥ÂÆöÁöÑÔºåËÄåÈÄöÂ∏∏ËôöÊãüÊú∫‰∏≠ÂæÄÂæÄ‰∏çÊ≠¢Êúâ‰∏ÄÁßç GC Êî∂ÈõÜÂô®„ÄÇ Â¶ÇÊûúËØ¥Êî∂ÈõÜÁÆóÊ≥ïÊòØÂÜÖÂ≠òÂõûÊî∂ÁöÑÊñπÊ≥ïËÆ∫ÔºåÈÇ£‰πàÂûÉÂúæÂõûÊî∂Âô®Â∞±ÊòØÂÜÖÂ≠òÂõûÊî∂ÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ ËôöÊãüÊú∫ËßÑËåÉ‰∏≠ÂØπ‰∫éÂûÉÂúæÂõûÊî∂Âô®Â∫îËØ•Â¶Ç‰ΩïÂÆûÁé∞Âπ∂Ê≤°Êúâ‰ªª‰ΩïËßÑÂÆö„ÄÇ Âõæ 3-5 Â±ïÁ§∫‰∫Ü 7 Áßç‰ΩúÁî®‰∫é‰∏çÂêåÂàÜ‰ª£ÁöÑÊî∂ÈõÜÂô®ÔºåÂ¶ÇÊûú‰∏§‰∏™Êî∂ÈõÜÂô®‰πãÈó¥Â≠òÂú®ËøûÁ∫øÔºåÂ∞±ËØ¥ÊòéÂÆÉ‰ª¨ÂèØ‰ª•Êê≠ÈÖç‰ΩøÁî®„ÄÇËôöÊãüÊú∫ÊâÄÂ§ÑÁöÑÂå∫ÂüüÔºåÂàôË°®Á§∫ÂÆÉÊòØÂ±û‰∫éÊñ∞Áîü‰ª£Êî∂ÈõÜÂô®ËøòÊòØËÄÅÂπ¥‰ª£Êî∂ÈõÜÂô®„ÄÇ Êàë‰ª¨ÈÄâÊã©ÁöÑÂè™ÊòØÂØπÂÖ∑‰ΩìÂ∫îÁî®ÊúÄÂêàÈÄÇÁöÑÊî∂ÈõÜÂô®„ÄÇ ‰ª•‰∏ãÂàÜÊûêÁöÑÂÖ≥Ê≥®ÁÇπÔºö Êî∂ÈõÜÂô®ÁöÑÁâπÁÇπÔºö Â∑•‰ΩúÁ∫øÁ®ãÊï∞? Â∑•‰ΩúËøáÁ®ã‰∏≠ÈúÄ‰∏çÈúÄË¶Å stop the wordÔºü ÈúÄË¶ÅÁöÑËØùÂÖ∑‰ΩìÊòØÂì™‰∏™ËøáÁ®ãÈúÄË¶ÅÔºü ËÉΩ‰∏éÂì™‰∏™Êî∂ÈõÜÂô®Êê≠ÈÖç‰ΩøÁî®? Serial Êî∂ÈõÜÂô®‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÁöÑÊî∂ÈõÜÂô®„ÄÇÂçïÁ∫øÁ®ãÊåáÁöÑÊòØÂÆÉÁî®ÂçïÊù°Á∫øÁ®ãÂéªÂÆåÊàêÂûÉÂúæÊî∂ÈõÜÂ∑•‰Ωú ÈáçÁÇπÔºöÂú®ÂÆÉËøõË°åÂûÉÂúæÊî∂ÈõÜÊó∂ÔºåÂøÖÈ°ªÊöÇÂÅúÂÖ∂‰ªñÊâÄÊúâÂ∑•‰ΩúÁ∫øÁ®ãÔºåÁõ¥Âà∞ÂÆÉÊî∂ÈõÜÁªìÊùü„ÄÇ ÂÆûÈôÖ‰∏äÂà∞Áé∞Âú®‰∏∫Ê≠¢ÔºåÂÆÉ‰æùÁÑ∂ÊòØËôöÊãüÊú∫ËøêË°åÂú® Client Ê®°Âºè‰∏ãÁöÑÈªòËÆ§Êñ∞Áîü‰ª£Êî∂ÈõÜÂô®„ÄÇ ‰ºòÁÇπÔºöÁÆÄÂçïËÄåÈ´òÊïàÔºà‰∏éÂÖ∂‰ªñÊî∂ÈõÜÂô®ÁöÑÂçïÁ∫øÁ®ãÊØîÔºâÔºåÂØπ‰∫éÈôêÂÆöÂçï‰∏™ CPU ÁöÑÁéØÂ¢ÉÊù•ËØ¥ÔºåSerial Êî∂ÈõÜÂô®‰∏ìÂøÉÂÅöÂûÉÂúæÊî∂ÈõÜËá™ÁÑ∂ÂèØ‰ª•Ëé∑ÂæóÊúÄÈ´òÁöÑÂçïÁ∫øÁ®ãÊî∂ÈõÜÊïàÁéá„ÄÇ Serial Êî∂ÈõÜÂô®ÂØπ‰∫éËøêË°åÂú® Client Ê®°Âºè‰∏ãÁöÑËôöÊãüÊú∫Êù•ËØ¥ÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÈÄâÊã©Âõ†‰∏∫Âú®Áî®Êà∑ÁöÑÊ°åÈù¢Â∫îÁî®Âú∫ÊôØ‰∏≠ÔºåÂàÜÈÖçÁªôËôöÊãüÊú∫ÁÆ°ÁêÜÁöÑÂÜÖÂ≠ò‰∏ÄËà¨Êù•ËØ¥‰∏ç‰ºöÂæàÂ§ßÔºåÂÅúÈ°øÊó∂Èó¥ÂÆåÂÖ®ÂèØ‰ª•ÊéßÂà∂Âú®Âá†ÂçÅÊØ´ÁßíÊúÄÂ§ö‰∏ÄÁôæÂ§öÊØ´Áßí‰ª•ÂÜÖÔºåÂè™Ë¶Å‰∏çÊòØÈ¢ëÁπÅÂèëÁîüÔºåËøôÁÇπÂÅúÈ°øÊòØÂèØ‰ª•Êé•ÂèóÁöÑ„ÄÇ ParNew Êî∂ÈõÜÂô®ParNew Êî∂ÈõÜÂô®ÂÖ∂ÂÆûÂ∞±ÊòØ Serial Êî∂ÈõÜÂô®ÁöÑÂ§öÁ∫øÁ®ãÁâàÊú¨ ÊòØËÆ∏Â§öËøêË°åÂú® Server Ê®°Âºè‰∏ãÁöÑËôöÊãüÊú∫‰∏≠È¶ñÈÄâÁöÑÊñ∞Áîü‰ª£Êî∂ÈõÜÂô®ÔºåÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™‰∏éÊÄßËÉΩÊó†ÂÖ≥‰ΩÜÂæàÈáçË¶ÅÁöÑÂéüÂõ†ÊòØÔºåÈô§‰∫Ü Serial Êî∂ÈõÜÂô®Â§ñÔºåÁõÆÂâçÂè™ÊúâÂÆÉËÉΩ‰∏é CMS Êî∂ÈõÜÂô®ÈÖçÂêàÂ∑•‰Ωú„ÄÇ ‰∏§‰∏™ÂêçËØçÔºöÂπ∂ÂèëÂíåÂπ∂Ë°å„ÄÇ Âπ∂Ë°åÔºàParallelÔºâÔºöÊåáÂ§öÊù°ÂûÉÂúæÊî∂ÈõÜÁ∫øÁ®ãÂπ∂Ë°åÂ∑•‰ΩúÔºå‰ΩÜÊ≠§Êó∂Áî®Êà∑Á∫øÁ®ã‰ªçÁÑ∂Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅ„ÄÇ Âπ∂ÂèëÔºàConcurrentÔºâÔºöÊåáÁî®Êà∑Á∫øÁ®ã‰∏éÂûÉÂúæÊî∂ÈõÜÁ∫øÁ®ãÂêåÊó∂ÊâßË°åÔºà‰ΩÜ‰∏ç‰∏ÄÂÆöÊòØÂπ∂Ë°åÁöÑÔºåÂèØËÉΩ‰ºö‰∫§ÊõøÊâßË°åÔºâÔºåÁî®Êà∑Á®ãÂ∫èÂú®ÁªßÁª≠ËøêË°åÔºåËÄåÂûÉÂúæÊî∂ÈõÜÁ®ãÂ∫èËøêË°å‰∫éÂè¶‰∏Ä‰∏™ CPU ‰∏ä„ÄÇ ‰∫åËÄÖÂÖ≥Á≥ªÔºöÂπ∂Ë°åÊòØÂπ∂ÂèëÁöÑ‰∏Ä‰∏™Â≠êÈõÜ ParallelScavenge Êî∂ÈõÜÂô®Parallel Scavenge Êî∂ÈõÜÂô®ÊòØ‰∏Ä‰∏™Êñ∞Áîü‰ª£Êî∂ÈõÜÂô®Ôºå ‰∏é ParNew ÂæàÁõ∏‰ºº„ÄÇ‰ΩÜÂÆÉÁöÑÂÖ≥Ê≥®ÁÇπ‰∏éÂÖ∂‰ªñÊî∂ÈõÜÂô®‰∏çÂêåÔºåCMS Á≠âÊî∂ÈõÜÂô®ÁöÑÂÖ≥Ê≥®ÁÇπÊòØÂ∞ΩÂèØËÉΩÂú∞Áº©Áü≠ÂûÉÂúæÊî∂ÈõÜÊó∂Áî®Êà∑Á∫øÁ®ãÁöÑÂÅúÈ°øÊó∂Èó¥ÔºåËÄå Parallel Scavenge Êî∂ÈõÜÂô®ÁöÑÁõÆÊ†áÊòØËææÂà∞‰∏Ä‰∏™==ÂèØÊéßÂà∂==ÁöÑÂêûÂêêÈáèÔºàThroughputÔºâ„ÄÇÂÆûÈôÖ‰∏ä‰∫åËÄÖÊ¶ÇÂøµÂ≠òÂú®ÈáçÂè†ÁöÑÂú∞Êñπ„ÄÇÂõ†‰∏∫ GC ËøáÁ®ã‰∏≠Áî®Êà∑Á∫øÁ®ãÂÅúÈ°øÊó∂Èó¥Áº©Áü≠ÔºåÈÇ£‰πàÂêûÂêêÈáè‰πüÂ∞±‰∏äÂéª‰∫ÜÔºåÂè™‰∏çËøáË¶ÅËÄÉËôëÁî®Êà∑‰ª£Á†ÅÊâßË°åÊó∂Èó¥‰∏éÂÅúÈ°øÊó∂Èó¥ÁöÑÊØî‰æã„ÄÇ ÂêûÂêêÈáèÂ∞±ÊòØ CPU Áî®‰∫éËøêË°åÁî®Êà∑‰ª£Á†ÅÁöÑÊó∂Èó¥‰∏é CPU ÊÄªÊ∂àËÄóÊó∂Èó¥ÁöÑÊØîÂÄºÔºåÂç≥ ÂêûÂêêÈáè = ËøêË°åÁî®Êà∑‰ª£Á†ÅÊó∂Èó¥/ÔºàËøêË°åÁî®Êà∑‰ª£Á†ÅÊó∂Èó¥+ÂûÉÂúæÊî∂ÈõÜÊó∂Èó¥ÔºâÔºåÂÅáËÆæËôöÊãüÊú∫ÊÄªÂÖ±ËøêË°å‰∫Ü 100 ÂàÜÈíüÔºåÂÖ∂‰∏≠ÂûÉÂúæÊî∂ÈõÜËä±Êéâ 1 ÂàÜÈíüÔºåÈÇ£ÂêûÂêêÈáèÂ∞±ÊòØ 99%„ÄÇ È´òÂêûÂêêÈáèÂàôÂèØ‰ª•È´òÊïàÁéáÂú∞Âà©Áî® CPU Êó∂Èó¥ÔºåÂ∞ΩÂø´ÂÆåÊàêÁ®ãÂ∫èÁöÑËøêÁÆó‰ªªÂä°Ôºå‰∏ªË¶ÅÈÄÇÂêàÂú®ÂêéÂè∞ËøêÁÆóËÄå‰∏çÈúÄË¶ÅÂ§™Â§ö‰∫§‰∫íÁöÑ‰ªªÂä°„ÄÇ MaxGCPauseMillis ÂèÇÊï∞ÂÖÅËÆ∏ÁöÑÂÄºÊòØ‰∏Ä‰∏™Â§ß‰∫é 0 ÁöÑÊØ´ÁßíÊï∞ÔºåÊî∂ÈõÜÂô®Â∞ÜÂ∞ΩÂèØËÉΩÂú∞‰øùËØÅÂÜÖÂ≠òÂõûÊî∂Ëä±Ë¥πÁöÑÊó∂Èó¥‰∏çË∂ÖËøáËÆæÂÆöÂÄº„ÄÇÊ≥®ÊÑèÔºöGC ÂÅúÈ°øÊó∂Èó¥Áº©Áü≠ÊòØ‰ª•Áâ∫Áâ≤ÂêûÂêêÈáèÂíåÊñ∞Áîü‰ª£Á©∫Èó¥Êù•Êç¢ÂèñÁöÑÔºöÁ≥ªÁªüÊääÊñ∞Áîü‰ª£Ë∞ÉÂ∞è‰∏Ä‰∫õÔºåËøô‰πüÁõ¥Êé•ÂØºËá¥ÂûÉÂúæÊî∂ÈõÜÂèëÁîüÂæóÊõ¥È¢ëÁπÅ‰∏Ä‰∫õ„ÄÇÂÅúÈ°øÊó∂Èó¥ÁöÑÁ°ÆÂú®‰∏ãÈôçÔºå‰ΩÜÂêûÂêêÈáè‰πüÈôç‰∏ãÊù•‰∫Ü„ÄÇ GCTimeRatio ÂèÇÊï∞ÁöÑÂÄºÊòØ‰∏Ä‰∏™Â§ß‰∫é 0 ‰∏îÂ∞è‰∫é 100 ÁöÑÊï¥Êï∞Ôºå‰πüÂ∞±ÊòØÂûÉÂúæÊî∂ÈõÜÊó∂Èó¥Âç†ÊÄªÊó∂Èó¥ÁöÑÊØîÁéáÔºåÁõ∏ÂΩì‰∫éÊòØÂêûÂêêÈáèÁöÑÂÄíÊï∞„ÄÇÂ¶ÇÊûúÊääÊ≠§ÂèÇÊï∞ËÆæÁΩÆ‰∏∫ 19ÔºåÈÇ£ÂÖÅËÆ∏ÁöÑÊúÄÂ§ß GC Êó∂Èó¥Â∞±Âç†ÊÄªÊó∂Èó¥ÁöÑ 5%ÔºàÂç≥ 1/Ôºà1+19ÔºâÔºâÔºåÈªòËÆ§ÂÄº‰∏∫ 99ÔºåÂ∞±ÊòØÂÖÅËÆ∏ÊúÄÂ§ß 1 %ÔºàÂç≥ 1/Ôºà1+99ÔºâÔºâÁöÑÂûÉÂúæÊî∂ÈõÜÊó∂Èó¥„ÄÇ Áî±‰∫é‰∏éÂêûÂêêÈáèÂÖ≥Á≥ªÂØÜÂàáÔºåParallel Scavenge Êî∂ÈõÜÂô®‰πüÁªèÂ∏∏Áß∞‰∏∫„ÄåÂêûÂêêÈáè‰ºòÂÖà„ÄçÊî∂ÈõÜÂô®„ÄÇ Parallel Scavenge Êî∂ÈõÜÂô®ËøòÊúâ‰∏Ä‰∏™ÂºÄÂÖ≥ÂèÇÊï∞ -XXÔºö+UseAdaptiveSizePolicyÂΩìËøô‰∏™ÂèÇÊï∞ÊâìÂºÄ‰πãÂêéÔºåÂ∞±‰∏çÈúÄË¶ÅÊâãÂ∑•ÊåáÂÆöÊñ∞Áîü‰ª£ÁöÑÂ§ßÂ∞èÔºà-XmnÔºâ„ÄÅEden ‰∏é Survivor Âå∫ÁöÑÊØî‰æãÔºà-XXÔºöSurvivorRatioÔºâ„ÄÅÊôãÂçáËÄÅÂπ¥‰ª£ÂØπË±°Âπ¥ÈæÑÔºà-XXÔºöPretenureSizeThresholdÔºâÁ≠âÁªÜËäÇÂèÇÊï∞‰∫ÜÔºåËôöÊãüÊú∫‰ºöÊ†πÊçÆÂΩìÂâçÁ≥ªÁªüÁöÑËøêË°åÊÉÖÂÜµÊî∂ÈõÜÊÄßËÉΩÁõëÊéß‰ø°ÊÅØÔºåÂä®ÊÄÅË∞ÉÊï¥Ëøô‰∫õÂèÇÊï∞‰ª•Êèê‰æõÊúÄÂêàÈÄÇÁöÑÂÅúÈ°øÊó∂Èó¥ÊàñËÄÖÊúÄÂ§ßÁöÑÂêûÂêêÈáèÔºåËøôÁßçË∞ÉËäÇÊñπÂºèÁß∞‰∏∫ ==GC Ëá™ÈÄÇÂ∫îÁöÑË∞ÉËäÇÁ≠ñÁï•==ÔºàGC ErgonomicsÔºâ„ÄÇËá™ÈÄÇÂ∫îË∞ÉËäÇÁ≠ñÁï•‰πüÊòØ Parallel Scavenge Êî∂ÈõÜÂô®‰∏é ParNew Êî∂ÈõÜÂô®ÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÂå∫Âà´„ÄÇ SerialOld Êî∂ÈõÜÂô®Serial Old ÊòØ Serial Êî∂ÈõÜÂô®ÁöÑËÄÅÂπ¥‰ª£ÁâàÊú¨Ôºå‰ΩøÁî®„ÄåÊ†áËÆ∞-Êï¥ÁêÜ„ÄçÁÆóÊ≥ï„ÄÇ Ëøô‰∏™Êî∂ÈõÜÂô®ÁöÑ‰∏ªË¶ÅÊÑè‰πâ‰πüÊòØÂú®‰∫éÁªô Client Ê®°Âºè‰∏ãÁöÑËôöÊãüÊú∫‰ΩøÁî®„ÄÇ Â¶ÇÊûúÂú® Server Ê®°Âºè‰∏ãÔºåÈÇ£‰πàÂÆÉ‰∏ªË¶ÅËøòÊúâ‰∏§Â§ßÁî®ÈÄîÔºö ‰∏ÄÁßçÁî®ÈÄîÊòØÂú® JDK 1.5 ‰ª•Âèä‰πãÂâçÁöÑÁâàÊú¨‰∏≠‰∏é Parallel Scavenge Êî∂ÈõÜÂô®Êê≠ÈÖç‰ΩøÁî® Âè¶‰∏ÄÁßçÁî®ÈÄîÂ∞±ÊòØ‰Ωú‰∏∫ CMS Êî∂ÈõÜÂô®ÁöÑÂêéÂ§áÈ¢ÑÊ°àÔºåÂú®Âπ∂ÂèëÊî∂ÈõÜÂèëÁîü Concurrent Mode Failure Êó∂‰ΩøÁî®„ÄÇ Parallel Scavenge Êî∂ÈõÜÂô®Êû∂ÊûÑ‰∏≠Êú¨Ë∫´Êúâ PS MarkSweep Êî∂ÈõÜÂô®Êù•ËøõË°åËÄÅÂπ¥‰ª£Êî∂ÈõÜÔºåÂπ∂ÈùûÁõ¥Êé•‰ΩøÁî®‰∫Ü Serial Old Êî∂ÈõÜÂô®Ôºå‰ΩÜÊòØËøô‰∏™ PS MarkSweep Êî∂ÈõÜÂô®‰∏é Serial Old ÁöÑÂÆûÁé∞ÈùûÂ∏∏Êé•Ëøë„ÄÇ ParallelOld Êî∂ÈõÜÂô®Parallel Old ÊòØ Parallel Scavenge Êî∂ÈõÜÂô®ÁöÑËÄÅÂπ¥‰ª£ÁâàÊú¨Ôºå‰ΩøÁî®Â§öÁ∫øÁ®ãÂíå„ÄåÊ†áËÆ∞-Êï¥ÁêÜ„ÄçÁÆóÊ≥ï„ÄÇ Ëøô‰∏™Êî∂ÈõÜÂô®ÊòØÂú® JDK 1.6 ‰∏≠ÊâçÂºÄÂßãÊèê‰æõÁöÑÔºåÊ≠§ÂâçÔºåÊñ∞Áîü‰ª£ÁöÑ Parallel Scavenge Êî∂ÈõÜÂô®‰∏ÄÁõ¥Â§Ñ‰∫éÊØîËæÉÂ∞¥Â∞¨ÁöÑÁä∂ÊÄÅ„ÄÇÂõ†‰∏∫ JDK1.6 ‰ª•ÂâçÂè™ËÉΩÈÄâÊã© serial old ‰Ωú‰∏∫ËÄÅÂπ¥‰ª£Êî∂ÈõÜÂô®„ÄÇÔºàÂîØ‰∏ÄËÉΩÈÄâÊã©ÁöÑÈòüÂèã‰∏çË°åÔºâ Áõ¥Âà∞ Parallel Old Êî∂ÈõÜÂô®Âá∫Áé∞ÂêéÔºå„ÄåÂêûÂêêÈáè‰ºòÂÖà„ÄçÊî∂ÈõÜÂô®Áªà‰∫éÊúâ‰∫ÜÊØîËæÉÂêçÂâØÂÖ∂ÂÆûÁöÑÂ∫îÁî®ÁªÑÂêàÔºåÂú®Ê≥®ÈáçÂêûÂêêÈáè‰ª•Âèä CPU ËµÑÊ∫êÊïèÊÑüÁöÑÂú∫ÂêàÔºåÈÉΩÂèØ‰ª•‰ºòÂÖàËÄÉËôë Parallel Scavenge Âä† Parallel Old Êî∂ÈõÜÂô®„ÄÇ CMS Êî∂ÈõÜÂô®CMS Êî∂ÈõÜÂô®ÔºàConcurrent Mark SweepÔºâÂú® JDK1.5 Êó∂ÊúüË¢´Êé®Âá∫ÔºåËøôÊ¨æÊî∂ÈõÜÂô®ÊòØ HotSpot ËôöÊãüÊú∫‰∏≠Á¨¨‰∏ÄÊ¨æÁúüÊ≠£ÊÑè‰πâ‰∏äÁöÑ==Âπ∂Âèë==Êî∂ÈõÜÂô®ÔºåÂÆÉÁ¨¨‰∏ÄÊ¨°ÂÆûÁé∞‰∫ÜËÆ©ÂûÉÂúæÊî∂ÈõÜÁ∫øÁ®ã‰∏éÁî®Êà∑Á∫øÁ®ãÔºàÂü∫Êú¨‰∏äÔºâÂêåÊó∂Â∑•‰Ωú„ÄÇ CMS ‰Ωú‰∏∫ËÄÅÂπ¥‰ª£ÁöÑÊî∂ÈõÜÂô®ÔºåÂç¥Êó†Ê≥ï‰∏é JDK 1.4.0 ‰∏≠Â∑≤ÁªèÂ≠òÂú®ÁöÑÊñ∞Áîü‰ª£Êî∂ÈõÜÂô® Parallel Scavenge ÈÖçÂêàÂ∑•‰Ωú„ÄÇ CMSÔºàConcurrent Mark SweepÔºâÊî∂ÈõÜÂô®ÊòØ‰∏ÄÁßç‰ª•Ëé∑ÂèñÊúÄÁü≠ÂõûÊî∂ÂÅúÈ°øÊó∂Èó¥‰∏∫ÁõÆÊ†áÁöÑÊî∂ÈõÜÂô®„ÄÇÈÄÇÂêà‰∫é‰∫§‰∫íÂûãÁöÑÂ∫îÁî®„ÄÇÂ∏åÊúõÁ≥ªÁªüÂÅúÈ°øÊó∂Èó¥ÊúÄÁü≠Ôºå‰ª•ÁªôÁî®Êà∑Â∏¶Êù•ËæÉÂ•ΩÁöÑ‰ΩìÈ™å„ÄÇCMS Êî∂ÈõÜÂô®Â∞±ÈùûÂ∏∏Á¨¶ÂêàËøôÁ±ªÂ∫îÁî®ÁöÑÈúÄÊ±Ç„ÄÇ‰ªéÂêçÂ≠óÔºàÂåÖÂê´„ÄåMark Sweep„ÄçÔºâ‰∏äÂ∞±ÂèØ‰ª•ÁúãÂá∫ÔºåCMS Êî∂ÈõÜÂô®ÊòØÂü∫‰∫é„ÄåÊ†áËÆ∞‚Äî==Ê∏ÖÈô§==„ÄçÁÆóÊ≥ïÂÆûÁé∞ÁöÑÔºåÂÆÉÁöÑËøê‰ΩúËøáÁ®ãÁõ∏ÂØπ‰∫éÂâçÈù¢Âá†ÁßçÊî∂ÈõÜÂô®Êù•ËØ¥Êõ¥Â§çÊùÇ‰∏Ä‰∫õÔºåÊï¥‰∏™ËøáÁ®ãÂàÜ‰∏∫ 4 ‰∏™Ê≠•È™§ÔºåÂåÖÊã¨Ôºö ÂàùÂßãÊ†áËÆ∞ÔºàCMS initial markÔºâ ,ÈúÄË¶Å„ÄåStop The World„Äç‰ªÖ‰ªÖÂè™ÊòØÊ†áËÆ∞‰∏Ä‰∏ã GC Roots ËÉΩÁõ¥Êé•ÂÖ≥ËÅîÂà∞ÁöÑÂØπË±°ÔºåÈÄüÂ∫¶ÂæàÂø´ Âπ∂ÂèëÊ†áËÆ∞ÔºàCMS concurrent markÔºâËøõË°å GC RootsTracing ÈáçÊñ∞Ê†áËÆ∞ÔºàCMS remarkÔºâ,ÈúÄË¶Å„ÄåStop The World„Äç‰∏∫‰∫Ü‰øÆÊ≠£Âπ∂ÂèëÊ†áËÆ∞ÊúüÈó¥Âõ†Áî®Êà∑Á®ãÂ∫èÁªßÁª≠Ëøê‰ΩúËÄåÂØºËá¥Ê†áËÆ∞‰∫ßÁîüÂèòÂä®ÁöÑÈÇ£‰∏ÄÈÉ®ÂàÜÂØπË±°ÁöÑÊ†áËÆ∞ËÆ∞ÂΩïÔºåËøô‰∏™Èò∂ÊÆµÁöÑÂÅúÈ°øÊó∂Èó¥‰∏ÄËà¨‰ºöÊØîÂàùÂßãÊ†áËÆ∞Èò∂ÊÆµÁ®çÈïø‰∏Ä‰∫õÔºå‰ΩÜËøúÊØîÂπ∂ÂèëÊ†áËÆ∞ÁöÑÊó∂Èó¥Áü≠„ÄÇ Âπ∂ÂèëÊ∏ÖÈô§ÔºàCMS concurrent sweepÔºâ Áî±‰∫éÊï¥‰∏™ËøáÁ®ã‰∏≠ËÄóÊó∂ÊúÄÈïøÁöÑÂπ∂ÂèëÊ†áËÆ∞ÂíåÂπ∂ÂèëÊ∏ÖÈô§ËøáÁ®ãÊî∂ÈõÜÂô®Á∫øÁ®ãÈÉΩÂèØ‰ª•‰∏éÁî®Êà∑Á∫øÁ®ã‰∏ÄËµ∑Â∑•‰ΩúÔºåÊâÄ‰ª•Ôºå‰ªéÊÄª‰Ωì‰∏äÊù•ËØ¥ÔºåCMS Êî∂ÈõÜÂô®ÁöÑÂÜÖÂ≠òÂõûÊî∂ËøáÁ®ãÊòØ‰∏éÁî®Êà∑Á∫øÁ®ã‰∏ÄËµ∑Âπ∂ÂèëÊâßË°åÁöÑ„ÄÇÈÄöËøáÂõæ 3-10 ÂèØ‰ª•ÊØîËæÉÊ∏ÖÊ•öÂú∞ÁúãÂà∞ CMS Êî∂ÈõÜÂô®ÁöÑËøê‰ΩúÊ≠•È™§‰∏≠Âπ∂ÂèëÂíåÈúÄË¶ÅÂÅúÈ°øÁöÑÊó∂Èó¥„ÄÇ Áº∫ÁÇπ ÂØπ CPU ËµÑÊ∫êÈùûÂ∏∏ÊïèÊÑüÂÖ∂ÂÆûÔºåÈù¢ÂêëÂπ∂ÂèëËÆæËÆ°ÁöÑÁ®ãÂ∫èÈÉΩÂØπ CPU ËµÑÊ∫êÊØîËæÉÊïèÊÑü„ÄÇÂú®Âπ∂ÂèëÈò∂ÊÆµÔºåÂÆÉËôΩÁÑ∂‰∏ç‰ºöÂØºËá¥Áî®Êà∑Á∫øÁ®ãÂÅúÈ°øÔºå‰ΩÜÊòØ‰ºöÂõ†‰∏∫Âç†Áî®‰∫Ü‰∏ÄÈÉ®ÂàÜÁ∫øÁ®ãÔºàÊàñËÄÖËØ¥ CPU ËµÑÊ∫êÔºâËÄåÂØºËá¥Â∫îÁî®Á®ãÂ∫èÂèòÊÖ¢ÔºåÊÄªÂêûÂêêÈáè‰ºöÈôç‰Ωé„ÄÇ CMS ÈªòËÆ§ÂêØÂä®ÁöÑÂõûÊî∂Á∫øÁ®ãÊï∞ÊòØÔºàCPU Êï∞Èáè + 3Ôºâ/ 4Ôºå ‰πüÂ∞±ÊòØÂΩì CPU Âú® 4 ‰∏™‰ª•‰∏äÊó∂ÔºåÂπ∂ÂèëÂõûÊî∂Êó∂ÂûÉÂúæÊî∂ÈõÜÁ∫øÁ®ã‰∏çÂ∞ë‰∫é 25%ÁöÑ CPU ËµÑÊ∫êÔºåÂπ∂‰∏îÈöèÁùÄ CPU Êï∞ÈáèÁöÑÂ¢ûÂä†ËÄå‰∏ãÈôç„ÄÇ ‰ΩÜÊòØÂΩì CPU ‰∏çË∂≥ 4 ‰∏™ÔºàË≠¨Â¶Ç 2 ‰∏™ÔºâÊó∂ÔºåCMS ÂØπÁî®Êà∑Á®ãÂ∫èÁöÑÂΩ±ÂìçÂ∞±ÂèØËÉΩÂèòÂæóÂæàÂ§ß. Áî®Êà∑Á®ãÂ∫èÂú® GC ËøáÁ®ã‰∏≠ÊâßË°å ÁºìÊÖ¢ÁöÑÈóÆÈ¢òÔºåÊé®Âá∫‰∫ÜÂ¢ûÈáèÂºè CMSÔºài-CMSÔºâÔºåÂú®Âπ∂ÂèëÊ†áËÆ∞„ÄÅÊ∏ÖÈô§Êó∂ËÆ© GC Á∫øÁ®ã‰∏éÁî®Êà∑Á∫øÁ®ã‰∫§ÊõøÊâßË°åÔºåÂ∞ΩÈáèÂáèÂ∞ë GC Á∫øÁ®ãÁã¨Âç†ËµÑÊ∫êÁöÑÊó∂Èó¥ÔºåËôΩÁÑ∂ËøôÊ†∑‰ºöÂØºËá¥Êï¥‰∏™ÂûÉÂúæÂõûÊî∂ËøáÁ®ãÂèòÈïø„ÄÇ‰ΩÜÊòØÊïàÊûú‰∏çÊòéÊòæÔºåÁõÆÂâçÁâàÊú¨‰∏≠Â∑≤Áªè‰∏çÂÜçÊé®Ëçê‰ΩøÁî®„ÄÇ Êó†Ê≥ïÂ§ÑÁêÜÊµÆÂä®ÂûÉÂúæÔºàFloating GarbageÔºâÂèØËÉΩÂá∫Áé∞„ÄåConcurrent Mode Failure„ÄçÂ§±Ë¥•ËÄåÂØºËá¥Âè¶‰∏ÄÊ¨° Full GC ÁöÑ‰∫ßÁîü„ÄÇ Áî±‰∫é CMS Âπ∂ÂèëÊ∏ÖÁêÜÈò∂ÊÆµÁî®Êà∑Á∫øÁ®ãËøòÂú®ËøêË°åÁùÄÔºå‰º¥ÈöèÁ®ãÂ∫èËøêË°åËá™ÁÑ∂Â∞±Ëøò‰ºöÊúâÊñ∞ÁöÑÂûÉÂúæ‰∏çÊñ≠‰∫ßÁîüÔºåËøô‰∏ÄÈÉ®ÂàÜÂûÉÂúæÂá∫Áé∞Âú®Ê†áËÆ∞ËøáÁ®ã‰πãÂêéÔºåCMS Êó†Ê≥ïÂú®ÂΩìÊ¨°Êî∂ÈõÜ‰∏≠Â§ÑÁêÜÊéâÂÆÉ‰ª¨ÔºåÂè™Â•ΩÁïôÂæÖ‰∏ã‰∏ÄÊ¨° GC Êó∂ÂÜçÊ∏ÖÁêÜÊéâ„ÄÇËøô‰∏ÄÈÉ®ÂàÜÂûÉÂúæÂ∞±Áß∞‰∏∫„ÄåÊµÆÂä®ÂûÉÂúæ„Äç„ÄÇ Êî∂ÈõÜÁªìÊùüÊó∂‰ºö‰∫ßÁîüÂ§ßÈáèÁ©∫Èó¥Á¢éÁâá„ÄÇÔºàÂõ†‰∏∫‰ΩøÁî®‰∫Ü„ÄåÊ†áËÆ∞-Ê∏ÖÈô§„ÄçÁÆóÊ≥ïÔºâÁ©∫Èó¥Á¢éÁâáËøáÂ§öÊó∂ÔºåÂ∞Ü‰ºöÁªôÂ§ßÂØπË±°ÂàÜÈÖçÂ∏¶Êù•ÂæàÂ§ßÈ∫ªÁÉ¶ÔºåÂæÄÂæÄ‰ºöÂá∫Áé∞ËÄÅÂπ¥‰ª£ËøòÊúâÂæàÂ§ßÁ©∫Èó¥Ââ©‰ΩôÔºå‰ΩÜÊòØÊó†Ê≥ïÊâæÂà∞Ë∂≥Â§üÂ§ßÁöÑËøûÁª≠Á©∫Èó¥Êù•ÂàÜÈÖçÂΩìÂâçÂØπË±°Ôºå‰∏çÂæó‰∏çÊèêÂâçËß¶Âèë‰∏ÄÊ¨° Full GC „ÄÇ ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåCMS Êî∂ÈõÜÂô®Êèê‰æõ‰∫Ü‰∏Ä‰∏™-XXÔºö+UseCMSCompactAtFullCollection ÂºÄÂÖ≥ÂèÇÊï∞ÔºàÈªòËÆ§Â∞±ÊòØÂºÄÂêØÁöÑÔºâÔºåÁî®‰∫éÂú® CMS Êî∂ÈõÜÂô®È°∂‰∏ç‰ΩèË¶ÅËøõË°å FullGC Êó∂ÂºÄÂêØÂÜÖÂ≠òÁ¢éÁâáÁöÑÂêàÂπ∂Êï¥ÁêÜËøáÁ®ãÔºåÂÜÖÂ≠òÊï¥ÁêÜÁöÑËøáÁ®ãÊòØÊó†Ê≥ïÂπ∂ÂèëÁöÑÔºåÁ©∫Èó¥Á¢éÁâáÈóÆÈ¢òÊ≤°Êúâ‰∫ÜÔºå‰ΩÜÂÅúÈ°øÊó∂Èó¥‰∏çÂæó‰∏çÂèòÈïø„ÄÇ Âè¶Â§ñ‰∏Ä‰∏™ÂèÇÊï∞-XXÔºöCMSFullGCsBeforeCompactionÔºåËøô‰∏™ÂèÇÊï∞ÊòØÁî®‰∫éËÆæÁΩÆÊâßË°åÂ§öÂ∞ëÊ¨°‰∏çÂéãÁº©ÁöÑ Full GC ÂêéÔºåË∑üÁùÄÊù•‰∏ÄÊ¨°Â∏¶ÂéãÁº©ÁöÑÔºàÈªòËÆ§ÂÄº‰∏∫ 0ÔºåË°®Á§∫ÊØèÊ¨°ËøõÂÖ• Full GC Êó∂ÈÉΩËøõË°åÁ¢éÁâáÊï¥ÁêÜÔºâ„ÄÇ G1 Êî∂ÈõÜÂô®G1ÔºàGarbage-FirstÔºâÊòØ‰∏ÄÊ¨æÈù¢ÂêëÊúçÂä°Á´ØÂ∫îÁî®ÁöÑÂûÉÂúæÊî∂ÈõÜÂô®„ÄÇÂÆÉÊúâ‰ª•‰∏ãÂá†‰∏™‰ºòÁÇπÔºö Âπ∂Ë°å‰∏éÂπ∂ÂèëÔºöG1 ËÉΩÂÖÖÂàÜÂà©Áî®Â§ö CPU„ÄÅÂ§öÊ†∏ÁéØÂ¢É‰∏ãÁöÑÁ°¨‰ª∂‰ºòÂäøÔºå‰ΩøÁî®Â§ö‰∏™ CPUÔºàCPU ÊàñËÄÖ CPU Ê†∏ÂøÉÔºâÊù•Áº©Áü≠Stop-The-WorldÂÅúÈ°øÁöÑÊó∂Èó¥ ÂàÜ‰ª£Êî∂ÈõÜÔºö‰∏çÈúÄË¶ÅÂÖ∂‰ªñÊî∂ÈõÜÂô®ÈÖçÂêàÂ∞±ËÉΩÁã¨Á´ãÁÆ°ÁêÜÊï¥‰∏™ GC Â†ÜÔºåËÉΩÂ§üÈááÁî®‰∏çÂêåÁöÑÊñπÂºèÂéªÂ§ÑÁêÜÊñ∞ÂàõÂª∫ÁöÑÂØπË±°ÂíåÂ∑≤ÁªèÂ≠òÊ¥ª‰∫Ü‰∏ÄÊÆµÊó∂Èó¥„ÄÅÁÜ¨ËøáÂ§öÊ¨° GC ÁöÑÊóßÂØπË±°‰ª•Ëé∑ÂèñÊõ¥Â•ΩÁöÑÊî∂ÈõÜÊïàÊûú„ÄÇ Á©∫Èó¥Êï¥ÂêàÔºöÊó†ÂÜÖÂ≠òÁ¢éÁâá„ÄÇ‰∏é CMS ÁöÑ„ÄåÊ†áËÆ∞‚ÄîÊ∏ÖÁêÜ„ÄçÁÆóÊ≥ï‰∏çÂêåÔºåG1 ‰ªéÊï¥‰ΩìÊù•ÁúãÊòØÂü∫‰∫é„ÄåÊ†áËÆ∞‚ÄîÊï¥ÁêÜ„ÄçÁÆóÊ≥ïÂÆûÁé∞ÁöÑÊî∂ÈõÜÂô® ‰ªéÂ±ÄÈÉ®Ôºà‰∏§‰∏™ Region ‰πãÈó¥Ôºâ‰∏äÊù•ÁúãÊòØÂü∫‰∫é„ÄåÂ§çÂà∂„ÄçÁÆóÊ≥ïÂÆûÁé∞ÁöÑ Ëøô‰∏§ÁßçÁÆóÊ≥ïÈÉΩÊÑèÂë≥ÁùÄG1 Ëøê‰ΩúÊúüÈó¥‰∏ç‰ºö‰∫ßÁîüÂÜÖÂ≠òÁ©∫Èó¥Á¢éÁâáÔºåÊî∂ÈõÜÂêéËÉΩÊèê‰æõËßÑÊï¥ÁöÑÂèØÁî®ÂÜÖÂ≠ò„ÄÇËøôÁßçÁâπÊÄßÊúâÂà©‰∫éÁ®ãÂ∫èÈïøÊó∂Èó¥ËøêË°åÔºåÂàÜÈÖçÂ§ßÂØπË±°Êó∂‰∏ç‰ºöÂõ†‰∏∫Êó†Ê≥ïÊâæÂà∞ËøûÁª≠ÂÜÖÂ≠òÁ©∫Èó¥ËÄåÊèêÂâçËß¶Âèë‰∏ã‰∏ÄÊ¨° GC„ÄÇ ÂèØÈ¢ÑÊµãÁöÑÂÅúÈ°øÔºöÈôç‰ΩéÂÅúÈ°øÊó∂Èó¥ÊòØ G1 Âíå CMS ÂÖ±ÂêåÁöÑÂÖ≥Ê≥®ÁÇπÔºå‰ΩÜ G1 Èô§‰∫ÜËøΩÊ±Ç‰ΩéÂÅúÈ°øÂ§ñÔºåËøòËÉΩÂª∫Á´ãÂèØÈ¢ÑÊµãÁöÑÂÅúÈ°øÊó∂Èó¥Ê®°ÂûãÔºåËÉΩËÆ©‰ΩøÁî®ËÄÖÊòéÁ°ÆÊåáÂÆöÂú®‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫ M ÊØ´ÁßíÁöÑÊó∂Èó¥ÁâáÊÆµÂÜÖÔºåÊ∂àËÄóÂú®ÂûÉÂúæÊî∂ÈõÜ‰∏äÁöÑÊó∂Èó¥‰∏çÂæóË∂ÖËøá N ÊØ´Áßí„ÄÇ‰ΩøÁî® G1 Êî∂ÈõÜÂô®Êó∂ÔºåJava Â†ÜÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÂ∞±‰∏éÂÖ∂‰ªñÊî∂ÈõÜÂô®ÊúâÂæàÂ§ßÂ∑ÆÂà´ÔºàÂÖ∂‰ªñÊî∂ÈõÜÂô®ÈÉΩÊòØÂØπÊï¥‰∏Ä‰∏™ËÄÅÂπ¥‰ª£ÊàñËÄÖÊñ∞Áîü‰ª£ËøõË°åÊìç‰ΩúÔºâÔºåÂÆÉÂ∞ÜÊï¥‰∏™ Java Â†ÜÂàíÂàÜ‰∏∫Â§ö‰∏™Â§ßÂ∞èÁõ∏Á≠âÁöÑÁã¨Á´ãÂå∫ÂüüÔºàRegionÔºâÔºåËôΩÁÑ∂Ëøò‰øùÁïôÊúâÊñ∞Áîü‰ª£ÂíåËÄÅÂπ¥‰ª£ÁöÑÊ¶ÇÂøµÔºå‰ΩÜÊñ∞Áîü‰ª£ÂíåËÄÅÂπ¥‰ª£‰∏çÂÜçÊòØÁâ©ÁêÜÈöîÁ¶ªÁöÑ‰∫ÜÔºåÂÆÉ‰ª¨ÈÉΩÊòØ‰∏ÄÈÉ®ÂàÜ RegionÔºà‰∏çÈúÄË¶ÅËøûÁª≠ÔºâÁöÑÈõÜÂêà„ÄÇ ‰πãÊâÄ‰ª•ËÉΩÂª∫Á´ãÂèØÈ¢ÑÊµãÁöÑÂÅúÈ°øÊó∂Èó¥Ê®°ÂûãÔºåÊòØÂõ†‰∏∫ÂÆÉÂèØ‰ª•ÊúâËÆ°ÂàíÂú∞ÈÅøÂÖçÂú®Êï¥‰∏™ Java Â†Ü‰∏≠ËøõË°åÂÖ®Âå∫ÂüüÁöÑÂûÉÂúæÊî∂ÈõÜ„ÄÇG1 Ë∑üË∏™ÂêÑ‰∏™ Region ÈáåÈù¢ÁöÑÂûÉÂúæÂ†ÜÁßØÁöÑ‰ª∑ÂÄºÂ§ßÂ∞èÔºàÂõûÊî∂ÊâÄËé∑ÂæóÁöÑÁ©∫Èó¥Â§ßÂ∞è‰ª•ÂèäÂõûÊî∂ÊâÄÈúÄÊó∂Èó¥ÁöÑÁªèÈ™åÂÄºÔºâÔºåÂú®ÂêéÂè∞Áª¥Êä§‰∏Ä‰∏™‰ºòÂÖàÂàóË°®ÔºåÊØèÊ¨°Ê†πÊçÆÂÖÅËÆ∏ÁöÑÊî∂ÈõÜÊó∂Èó¥Ôºå‰ºòÂÖàÂõûÊî∂‰ª∑ÂÄºÊúÄÂ§ßÁöÑ RegionÔºàËøô‰πüÂ∞±ÊòØ Garbage-First ÂêçÁß∞ÁöÑÊù•Áî±Ôºâ„ÄÇËøôÁßç‰ΩøÁî® Region ÂàíÂàÜÂÜÖÂ≠òÁ©∫Èó¥‰ª•ÂèäÊúâ‰ºòÂÖàÁ∫ßÁöÑÂå∫ÂüüÂõûÊî∂ÊñπÂºèÔºå‰øùËØÅ‰∫Ü G1 Êî∂ÈõÜÂô®Âú®ÊúâÈôêÁöÑÊó∂Èó¥ÂÜÖÂèØ‰ª•Ëé∑ÂèñÂ∞ΩÂèØËÉΩÈ´òÁöÑÊî∂ÈõÜÊïàÁéá„ÄÇ Region ‰∏çÂèØËÉΩÊòØÂ≠§Á´ãÁöÑ„ÄÇ‰∏Ä‰∏™ÂØπË±°ÂàÜÈÖçÂú®Êüê‰∏™ Region ‰∏≠ÔºåÂèØ‰ª•‰∏éÊï¥‰∏™ Java Â†Ü‰ªªÊÑèÁöÑÂØπË±°ÂèëÁîüÂºïÁî®ÂÖ≥Á≥ª„ÄÇÈÇ£Âú®ÂÅöÂèØËææÊÄßÂà§ÂÆöÁ°ÆÂÆöÂØπË±°ÊòØÂê¶Â≠òÊ¥ªÁöÑÊó∂ÂÄôÔºåÂ≤Ç‰∏çÊòØËøòÂæóÊâ´ÊèèÊï¥‰∏™ Java Â†ÜÊâçËÉΩ‰øùËØÅÂáÜÁ°ÆÊÄßÔºüÂú® G1 Êî∂ÈõÜÂô®‰∏≠ÔºåRegion ‰πãÈó¥ÁöÑÂØπË±°ÂºïÁî®‰ª•ÂèäÂÖ∂‰ªñÊî∂ÈõÜÂô®‰∏≠ÁöÑÊñ∞Áîü‰ª£‰∏éËÄÅÂπ¥‰ª£‰πãÈó¥ÁöÑÂØπË±°ÂºïÁî®ÔºåËôöÊãüÊú∫ÈÉΩÊòØ‰ΩøÁî® ==Remembered Set== Êù•ÈÅøÂÖçÂÖ®Â†ÜÊâ´ÊèèÁöÑ„ÄÇ G1 ‰∏≠ÊØè‰∏™ Region ÈÉΩÊúâ‰∏Ä‰∏™‰∏é‰πãÂØπÂ∫îÁöÑ Remembered SetÔºåËôöÊãüÊú∫ÂèëÁé∞Á®ãÂ∫èÂú®ÂØπ Reference Á±ªÂûãÁöÑÊï∞ÊçÆËøõË°åÂÜôÊìç‰ΩúÊó∂Ôºå‰ºö‰∫ßÁîü‰∏Ä‰∏™ Write Barrier ÊöÇÊó∂‰∏≠Êñ≠ÂÜôÊìç‰ΩúÔºåÊ£ÄÊü• Reference ÂºïÁî®ÁöÑÂØπË±°ÊòØÂê¶Â§Ñ‰∫é‰∏çÂêåÁöÑ Region ‰πã‰∏≠ÔºàÂú®ÂàÜ‰ª£ÁöÑ‰æãÂ≠ê‰∏≠Â∞±ÊòØÊ£ÄÊü•ÊòØÂê¶ËÄÅÂπ¥‰ª£‰∏≠ÁöÑÂØπË±°ÂºïÁî®‰∫ÜÊñ∞Áîü‰ª£‰∏≠ÁöÑÂØπË±°ÔºâÔºåÂ¶ÇÊûúÊòØÔºå‰æøÈÄöËøá CardTable ÊääÁõ∏ÂÖ≥ÂºïÁî®‰ø°ÊÅØËÆ∞ÂΩïÂà∞Ë¢´ÂºïÁî®ÂØπË±°ÊâÄÂ±ûÁöÑ Region ÁöÑ Remembered Set ‰πã‰∏≠„ÄÇ ÂΩìËøõË°åÂÜÖÂ≠òÂõûÊî∂Êó∂ÔºåÂú® GC Ê†πËäÇÁÇπÁöÑÊûö‰∏æËåÉÂõ¥‰∏≠Âä†ÂÖ• Remembered Set Âç≥ÂèØ‰øùËØÅ‰∏çÂØπÂÖ®Â†ÜÊâ´Êèè‰πü‰∏ç‰ºöÊúâÈÅóÊºè„ÄÇ Â¶ÇÊûú‰∏çËÆ°ÁÆóÁª¥Êä§ Remembered Set ÁöÑÊìç‰ΩúÔºåG1 Êî∂ÈõÜÂô®ÁöÑËøê‰ΩúÂ§ßËá¥ÂèØÂàíÂàÜ‰∏∫‰ª•‰∏ãÂá†‰∏™Ê≠•È™§Ôºö ÂàùÂßãÊ†áËÆ∞ÔºàInitial MarkingÔºâ Âπ∂ÂèëÊ†áËÆ∞ÔºàConcurrent MarkingÔºâ ÊúÄÁªàÊ†áËÆ∞ÔºàFinal MarkingÔºâ Á≠õÈÄâÂõûÊî∂ÔºàLive Data Counting and EvacuationÔºâ Âì™‰∏ÄÂùóÂõûÊî∂ÁöÑÊî∂ÁõäÂ§ßÂ∞±ÈÄâÂì™‰∏ÄÂùó„ÄÇ G1 ÁöÑÂâçÂá†‰∏™Ê≠•È™§ÁöÑËøê‰ΩúËøáÁ®ãÂíå CMS ÊúâÂæàÂ§öÁõ∏‰ºº‰πãÂ§Ñ„ÄÇ ÂàùÂßãÊ†áËÆ∞Èò∂ÊÆµ‰ªÖ‰ªÖÂè™ÊòØÊ†áËÆ∞‰∏Ä‰∏ã GC Roots ËÉΩÁõ¥Êé•ÂÖ≥ËÅîÂà∞ÁöÑÂØπË±°ÔºåÂπ∂‰∏î‰øÆÊîπ TAMSÔºàNext Top at Mark StartÔºâÁöÑÂÄºÔºåËÆ©‰∏ã‰∏ÄÈò∂ÊÆµÁî®Êà∑Á®ãÂ∫èÂπ∂ÂèëËøêË°åÊó∂ÔºåËÉΩÂú®Ê≠£Á°ÆÂèØÁî®ÁöÑ Region ‰∏≠ÂàõÂª∫Êñ∞ÂØπË±°ÔºåËøôÈò∂ÊÆµÈúÄË¶ÅÂÅúÈ°øÁ∫øÁ®ãÔºå‰ΩÜËÄóÊó∂ÂæàÁü≠„ÄÇ Âπ∂ÂèëÊ†áËÆ∞Èò∂ÊÆµÊòØ‰ªé GC Root ÂºÄÂßãÂØπÂ†Ü‰∏≠ÂØπË±°ËøõË°åÂèØËææÊÄßÂàÜÊûêÔºåÊâæÂá∫Â≠òÊ¥ªÁöÑÂØπË±°ÔºåËøôÈò∂ÊÆµËÄóÊó∂ËæÉÈïøÔºå‰ΩÜÂèØ‰∏éÁî®Êà∑Á®ãÂ∫èÂπ∂ÂèëÊâßË°å„ÄÇ ÊúÄÁªàÊ†áËÆ∞Èò∂ÊÆµÊòØ‰∏∫‰∫Ü‰øÆÊ≠£Âú®Âπ∂ÂèëÊ†áËÆ∞ÊúüÈó¥Âõ†Áî®Êà∑Á®ãÂ∫èÁªßÁª≠Ëøê‰ΩúËÄåÂØºËá¥Ê†áËÆ∞‰∫ßÁîüÂèòÂä®ÁöÑÈÇ£‰∏ÄÈÉ®ÂàÜÊ†áËÆ∞ËÆ∞ÂΩïÔºåËôöÊãüÊú∫Â∞ÜËøôÊÆµÊó∂Èó¥ÂØπË±°ÂèòÂåñËÆ∞ÂΩïÂú®Á∫øÁ®ã Remembered Set Logs ÈáåÈù¢ÔºåÊúÄÁªàÊ†áËÆ∞Èò∂ÊÆµÈúÄË¶ÅÊää Remembered Set Logs ÁöÑÊï∞ÊçÆÂêàÂπ∂Âà∞ Remembered Set ‰∏≠ÔºåËøôÈò∂ÊÆµÈúÄË¶ÅÂÅúÈ°øÁ∫øÁ®ãÔºå‰ΩÜÊòØÂèØÂπ∂Ë°åÊâßË°å„ÄÇ Á≠õÈÄâÂõûÊî∂Èò∂ÊÆµÂØπÂêÑ‰∏™ Region ÁöÑÂõûÊî∂‰ª∑ÂÄºÂíåÊàêÊú¨ËøõË°åÊéíÂ∫èÔºåÊ†πÊçÆÁî®Êà∑ÊâÄÊúüÊúõÁöÑ GC ÂÅúÈ°øÊó∂Èó¥Êù•Âà∂ÂÆöÂõûÊî∂ËÆ°Âàí„ÄÇ ÁªÑÂêàÁ≠ñÁï•Âú®ËøõË°å JVM Ë∞É‰ºòÁöÑËøáÁ®ã‰∏≠ÔºåÂπ∂Èùû‰ªª‰Ωï‰∏ÄÁßçÊñ∞Áîü‰ª£ GC Á≠ñÁï•ÈÉΩÂèØ‰ª•ÂíåÂè¶‰∏ÄÁßçÂπ¥ËÄÅ‰ª£ GC Á≠ñÁï•ËøõË°åÈÖçÂêàÂ∑•‰ΩúÔºåÊâÄ‰ª•ÔºåÊàë‰ª¨Â∫îËØ•Áü•ÈÅìÔºåÂì™‰∫õÁßçÁªÑÂêàÂèØ‰ª•ÊúâÊïàÂú∞ËøõË°å GCÔºåËÄå‰∏îÂ∫îËØ•Âú®‰ªÄ‰πàÊ†∑ÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏ãÈÄâÊã©Âì™‰∏ÄÁßçÁªÑÂêàÔºåÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö Êñ∞Áîü‰ª£ GC Á≠ñÁï• Âπ¥ËÄÅ‰ª£ GC Á≠ñÁï• ËØ¥Êòé ÁªÑÂêà 1 Serial Serial Old Serial Âíå Serial Old ÈÉΩÊòØÂçïÁ∫øÁ®ãËøõË°å GCÔºåÁâπÁÇπÂ∞±ÊòØ GC Êó∂ÊöÇÂÅúÊâÄÊúâÂ∫îÁî®Á∫øÁ®ã„ÄÇ ÁªÑÂêà 2 Serial CMS+Serial Old CMSÔºàConcurrent Mark SweepÔºâÊòØÂπ∂Âèë GCÔºåÂÆûÁé∞ GC Á∫øÁ®ãÂíåÂ∫îÁî®Á∫øÁ®ãÂπ∂ÂèëÂ∑•‰ΩúÔºå‰∏çÈúÄË¶ÅÊöÇÂÅúÊâÄÊúâÂ∫îÁî®Á∫øÁ®ã„ÄÇÂè¶Â§ñÔºåÂΩì CMS ËøõË°å GC Â§±Ë¥•Êó∂Ôºå‰ºöËá™Âä®‰ΩøÁî® Serial Old Á≠ñÁï•ËøõË°å GC„ÄÇ ÁªÑÂêà 3 ParNew CMS ‰ΩøÁî®-XX:+UseParNewGC ÈÄâÈ°πÊù•ÂºÄÂêØ„ÄÇParNew ÊòØ Serial ÁöÑÂπ∂Ë°åÁâàÊú¨ÔºåÂèØ‰ª•ÊåáÂÆö GC Á∫øÁ®ãÊï∞ÔºåÈªòËÆ§ GC Á∫øÁ®ãÊï∞‰∏∫ CPU ÁöÑÊï∞Èáè„ÄÇÂèØ‰ª•‰ΩøÁî®-XX:ParallelGCThreads ÈÄâÈ°πÊåáÂÆö GC ÁöÑÁ∫øÁ®ãÊï∞„ÄÇÂ¶ÇÊûúÊåáÂÆö‰∫ÜÈÄâÈ°π-XX:+UseConcMarkSweepGC ÈÄâÈ°πÔºåÂàôÊñ∞Áîü‰ª£ÈªòËÆ§‰ΩøÁî® ParNew GC Á≠ñÁï•„ÄÇ ÁªÑÂêà 4 ParNew Serial Old ‰ΩøÁî®-XX:+UseParNewGC ÈÄâÈ°πÊù•ÂºÄÂêØ„ÄÇÊñ∞Áîü‰ª£‰ΩøÁî® ParNew GC Á≠ñÁï•ÔºåÂπ¥ËÄÅ‰ª£ÈªòËÆ§‰ΩøÁî® Serial Old GC Á≠ñÁï•„ÄÇ ÁªÑÂêà 5 Parallel Scavenge Serial Old Parallel Scavenge Á≠ñÁï•‰∏ªË¶ÅÊòØÂÖ≥Ê≥®‰∏Ä‰∏™ÂèØÊéßÁöÑÂêûÂêêÈáèÔºöÂ∫îÁî®Á®ãÂ∫èËøêË°åÊó∂Èó¥ / (Â∫îÁî®Á®ãÂ∫èËøêË°åÊó∂Èó¥ + GC Êó∂Èó¥)ÔºåÂèØËßÅËøô‰ºö‰ΩøÂæó CPU ÁöÑÂà©Áî®ÁéáÂ∞ΩÂèØËÉΩÁöÑÈ´òÔºåÈÄÇÁî®‰∫éÂêéÂè∞ÊåÅ‰πÖËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåËÄå‰∏çÈÄÇÁî®‰∫é‰∫§‰∫íËæÉÂ§öÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÇ ÁªÑÂêà 6 Parallel Scavenge Parallel Old Parallel Old ÊòØ Parallel Scavenge Êî∂ÈõÜÂô®ÁöÑËÄÅÂπ¥‰ª£ÁâàÊú¨„ÄÇÈÄÇÁî®‰∫éÊ≥®ÈáçÂêûÂêêÈáè‰ª•Âèä CPU ËµÑÊ∫êÊïèÊÑüÁöÑÂú∫Âêà 7 G1 G1 ÊòØ Garbage First ÂûÉÂúæÊî∂ÈõÜÂô®„ÄÇ ÁêÜËß£ GC Êó•ÂøóGC Êó•ÂøóÂºÄÂ§¥ÁöÑ „Äå[GC„ÄçÂíå„Äå[Full GC„ÄçËØ¥Êòé‰∫ÜËøôÊ¨°ÂûÉÂúæÊî∂ÈõÜÁöÑ==ÂÅúÈ°øÁ±ªÂûã==ÔºåËÄå‰∏çÊòØÁî®Êù•Âå∫ÂàÜÊñ∞Áîü‰ª£ GC ËøòÊòØËÄÅÂπ¥‰ª£ GC ÁöÑ„ÄÇ Â¶ÇÊûúÊúâ„ÄåFull„ÄçÔºåËØ¥ÊòéËøôÊ¨° GC ÊòØÂèëÁîü‰∫Ü Stop-The-World ÁöÑÔºåËøôÊÆµÊñ∞Áîü‰ª£Êî∂ÈõÜÂô® ParNew ÁöÑÊó•Âøó‰πü‰ºöÂá∫Áé∞„Äå[Full GC„ÄçÔºàËøô‰∏ÄËà¨ÊòØÂõ†‰∏∫Âá∫Áé∞‰∫ÜÂàÜÈÖçÊãÖ‰øùÂ§±Ë¥•‰πãÁ±ªÁöÑÈóÆÈ¢òÔºåÊâÄ‰ª•ÊâçÂØºËá¥ STWÔºâ„ÄÇ Â¶ÇÊûúÊòØË∞ÉÁî® System.gcÔºàÔºâÊñπÊ≥ïÊâÄËß¶ÂèëÁöÑÊî∂ÈõÜÔºåÈÇ£‰πàÂú®ËøôÈáåÂ∞ÜÊòæÁ§∫„Äå[Full GCÔºàSystemÔºâ„Äç„ÄÇ Êé•‰∏ãÊù•ÁöÑ„Äå[DefNew„Äç„ÄÅ„Äå[Tenured„Äç„ÄÅ„Äå[Perm„ÄçË°®Á§∫ GC ÂèëÁîüÁöÑÂå∫ÂüüÔºåËøôÈáåÊòæÁ§∫ÁöÑÂå∫ÂüüÂêçÁß∞‰∏é‰ΩøÁî®ÁöÑ GC Êî∂ÈõÜÂô®ÊòØÂØÜÂàáÁõ∏ÂÖ≥ÁöÑÔºå Serial Êî∂ÈõÜÂô®‰∏≠ÁöÑÊñ∞Áîü‰ª£Âêç‰∏∫ „ÄåDefault New Generation„ÄçÔºåÊâÄ‰ª•ÊòæÁ§∫ÁöÑÊòØ„Äå[DefNew„Äç„ÄÇ Â¶ÇÊûúÊòØ ParNew Êî∂ÈõÜÂô®ÔºåÊñ∞Áîü‰ª£ÂêçÁß∞Â∞±‰ºöÂèò‰∏∫„Äå[ParNew„ÄçÔºåÊÑè‰∏∫ „ÄåParallel New Generation„Äç„ÄÇ Â¶ÇÊûúÈááÁî® Parallel Scavenge Êî∂ÈõÜÂô®ÔºåÈÇ£ÂÆÉÈÖçÂ•óÁöÑÊñ∞Áîü‰ª£Áß∞‰∏∫„ÄåPSYoungGen„Äç ÂÜÖÂ≠òÂàÜÈÖç‰∏éÂõûÊî∂Á≠ñÁï•ÂØπË±°ÁöÑÂÜÖÂ≠òÂàÜÈÖçÔºåÂæÄÂ§ßÊñπÂêëËÆ≤ÔºåÂ∞±ÊòØÂú®Â†Ü‰∏äÂàÜÈÖçÔºà‰ΩÜ‰πüÂèØËÉΩÁªèËøá JIT ÁºñËØëÂêéË¢´ÊãÜÊï£‰∏∫Ê†áÈáèÁ±ªÂûãÂπ∂Èó¥Êé•Âú∞Ê†à‰∏äÂàÜÈÖçÔºâÔºåÂØπË±°‰∏ªË¶ÅÂàÜÈÖçÂú®Êñ∞Áîü‰ª£ÁöÑ Eden Âå∫‰∏äÔºåÂ¶ÇÊûúÂêØÂä®‰∫ÜÊú¨Âú∞Á∫øÁ®ãÂàÜÈÖçÁºìÂÜ≤ÔºåÂ∞ÜÊåâÁ∫øÁ®ã‰ºòÂÖàÂú® TLAB ‰∏äÂàÜÈÖç*„ÄÇÂ∞ëÊï∞ÊÉÖÂÜµ‰∏ã‰πüÂèØËÉΩ‰ºöÁõ¥Êé•ÂàÜÈÖçÂú®ËÄÅÂπ¥‰ª£‰∏≠Ôºå Ê≥®: TLAB ÂÖ®Áß∞‰∏∫ Thread Local Allocation Buffered ÂàÜÈÖçÁöÑËßÑÂàôÂπ∂‰∏çÊòØÁôæÂàÜ‰πãÁôæÂõ∫ÂÆöÁöÑÔºåÂÖ∂ÁªÜËäÇÂèñÂÜ≥‰∫éÂΩìÂâç‰ΩøÁî®ÁöÑÊòØÂì™‰∏ÄÁßçÂûÉÂúæÊî∂ÈõÜÂô®ÁªÑÂêàÔºåËøòÊúâËôöÊãüÊú∫‰∏≠‰∏éÂÜÖÂ≠òÁõ∏ÂÖ≥ÁöÑÂèÇÊï∞ÁöÑËÆæÁΩÆ„ÄÇ‰ª•‰∏ã‰∏∫Âá†Êù°ÊúÄÊôÆÈÅçÁöÑÂÜÖÂ≠òÂàÜÈÖçËßÑÂàô„ÄÇ ÂØπË±°‰ºòÂÖàÂú® Eden ÂàÜÈÖç„ÄÅ Â§ßÂØπË±°Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£„ÄÅ ÈïøÊúüÂ≠òÊ¥ªÁöÑÂØπË±°Â∞ÜËøõÂÖ•ËÄÅÂπ¥‰ª£ „ÄÅ Âä®ÊÄÅÂØπË±°Âπ¥ÈæÑÂà§ÂÆö „ÄÅ Á©∫Èó¥ÂàÜÈÖçÊãÖ‰øù ÂØπË±°‰ºòÂÖàÂú® Eden ÂàÜÈÖçÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÂØπË±°Âú®Êñ∞Áîü‰ª£ Eden Âå∫‰∏≠ÂàÜÈÖç„ÄÇÂΩì Eden Âå∫Ê≤°ÊúâË∂≥Â§üÁ©∫Èó¥ËøõË°åÂàÜÈÖçÊó∂ÔºåËôöÊãüÊú∫Â∞ÜÂèëËµ∑‰∏ÄÊ¨° Minor GC„ÄÇ Minor GC Âíå Full/major GC Êúâ‰ªÄ‰πà‰∏ç‰∏ÄÊ†∑ÂêóÔºü Êñ∞Áîü‰ª£ GCÔºàMinor GCÔºâÔºöÊåáÂèëÁîüÂú®Êñ∞Áîü‰ª£ÁöÑÂûÉÂúæÊî∂ÈõÜÂä®‰ΩúÔºåÂõ†‰∏∫ Java ÂØπË±°Â§ßÂ§öÈÉΩÂÖ∑Â§áÊúùÁîüÂ§ïÁÅ≠ÁöÑÁâπÊÄßÔºåÊâÄ‰ª• Minor GC ÈùûÂ∏∏È¢ëÁπÅÔºå‰∏ÄËà¨ÂõûÊî∂ÈÄüÂ∫¶‰πüÊØîËæÉÂø´„ÄÇ ËÄÅÂπ¥‰ª£ GCÔºàMajor GC/Full GCÔºâÔºöÊåáÂèëÁîüÂú®ËÄÅÂπ¥‰ª£ÁöÑ GCÔºåÂá∫Áé∞‰∫Ü Major GCÔºåÁªèÂ∏∏‰ºö‰º¥ÈöèËá≥Â∞ë‰∏ÄÊ¨°ÁöÑ Minor GCÔºà‰ΩÜÈùûÁªùÂØπÁöÑÔºåÂú® Parallel Scavenge Êî∂ÈõÜÂô®ÁöÑÊî∂ÈõÜÁ≠ñÁï•ÈáåÂ∞±ÊúâÁõ¥Êé•ËøõË°å Major GC ÁöÑÁ≠ñÁï•ÈÄâÊã©ËøáÁ®ãÔºâ„ÄÇMajor GC ÁöÑÈÄüÂ∫¶‰∏ÄËà¨‰ºöÊØî Minor GC ÊÖ¢ 10 ÂÄç‰ª•‰∏ä„ÄÇ Â§ßÂØπË±°Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£ÊâÄË∞ìÁöÑÂ§ßÂØπË±°ÊòØÊåáÔºåÈúÄË¶ÅÂ§ßÈáèËøûÁª≠ÂÜÖÂ≠òÁ©∫Èó¥ÁöÑ Java ÂØπË±°ÔºåÊúÄÂÖ∏ÂûãÁöÑÂ§ßÂØπË±°Â∞±ÊòØÈÇ£ÁßçÂæàÈïøÁöÑÂ≠óÁ¨¶‰∏≤‰ª•ÂèäÊï∞ÁªÑ„ÄÇ ËôöÊãüÊú∫Êèê‰æõ‰∫Ü‰∏Ä‰∏™-XXÔºöPretenureSizeThreshold ÂèÇÊï∞Ôºå‰ª§Â§ß‰∫éËøô‰∏™ËÆæÁΩÆÂÄºÁöÑÂØπË±°Áõ¥Êé•Âú®ËÄÅÂπ¥‰ª£ÂàÜÈÖç„ÄÇËøôÊ†∑ÂÅöÁöÑÁõÆÁöÑÊòØÈÅøÂÖçÂú® Eden Âå∫Âèä‰∏§‰∏™ Survivor Âå∫‰πãÈó¥ÂèëÁîüÂ§ßÈáèÁöÑÂÜÖÂ≠òÂ§çÂà∂ÔºàÂ§ç‰π†‰∏Ä‰∏ãÔºöÊñ∞Áîü‰ª£ÈááÁî®Â§çÂà∂ÁÆóÊ≥ïÊî∂ÈõÜÂÜÖÂ≠òÔºâ„ÄÇ ÈïøÊúüÂ≠òÊ¥ªÁöÑÂØπË±°Â∞ÜËøõÂÖ•ËÄÅÂπ¥‰ª£‰∏∫‰∫ÜÂÅöÂà∞ËøôÁÇπÔºåËôöÊãüÊú∫ÁªôÊØè‰∏™ÂØπË±°ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÂØπË±°Âπ¥ÈæÑÔºàAgeÔºâËÆ°Êï∞Âô®„ÄÇ Â¶ÇÊûúÂØπË±°Âú® Eden Âá∫ÁîüÂπ∂ÁªèËøáÁ¨¨‰∏ÄÊ¨° Minor GC Âêé‰ªçÁÑ∂Â≠òÊ¥ªÔºåÂπ∂‰∏îËÉΩË¢´ Survivor ÂÆπÁ∫≥ÁöÑËØùÔºåÂ∞ÜË¢´ÁßªÂä®Âà∞ Survivor Á©∫Èó¥‰∏≠ÔºåÂπ∂‰∏îÂØπË±°Âπ¥ÈæÑËÆæ‰∏∫ 1„ÄÇ ÂØπË±°Âú® Survivor Âå∫‰∏≠ÊØè„ÄåÁÜ¨Ëøá„Äç‰∏ÄÊ¨° Minor GCÔºåÂπ¥ÈæÑÂ∞±Â¢ûÂä† 1 Â≤ÅÔºåÂΩìÂÆÉÁöÑÂπ¥ÈæÑÂ¢ûÂä†Âà∞‰∏ÄÂÆöÁ®ãÂ∫¶ÔºàÈªòËÆ§‰∏∫ 15 Â≤ÅÔºâÔºåÂ∞±Â∞Ü‰ºöË¢´ÊôãÂçáÂà∞ËÄÅÂπ¥‰ª£‰∏≠„ÄÇ ÂØπË±°ÊôãÂçáËÄÅÂπ¥‰ª£ÁöÑÂπ¥ÈæÑÈòàÂÄºÔºåÂèØ‰ª•ÈÄöËøáÂèÇÊï∞ -XXÔºöMaxTenuringThreshold ËÆæÁΩÆ„ÄÇ Âä®ÊÄÅÂØπË±°Âπ¥ÈæÑÂà§ÂÆöËôöÊãüÊú∫Âπ∂‰∏çÊòØÊ∞∏ËøúÂú∞Ë¶ÅÊ±ÇÂØπË±°ÁöÑÂπ¥ÈæÑÂøÖÈ°ªËææÂà∞‰∫Ü MaxTenuringThresholdÊâçËÉΩÊôãÂçáËÄÅÂπ¥‰ª£ÔºåÂ¶ÇÊûúÂú® Survivor Á©∫Èó¥‰∏≠Áõ∏ÂêåÂπ¥ÈæÑÊâÄÊúâÂØπË±°Â§ßÂ∞èÁöÑÊÄªÂíåÂ§ß‰∫é Survivor Á©∫Èó¥ÁöÑ‰∏ÄÂçäÔºåÂπ¥ÈæÑÂ§ß‰∫éÊàñÁ≠â‰∫éËØ•Âπ¥ÈæÑÁöÑÂØπË±°Â∞±ÂèØ‰ª•Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£ÔºåÊó†È°ªÁ≠âÂà∞ MaxTenuringThreshold‰∏≠Ë¶ÅÊ±ÇÁöÑÂπ¥ÈæÑ„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÔºåÂêåÈæÑÁöÑÂ∞è‰ºô‰º¥ÁöÑÂÜÖÂ≠òÂ§ß‰∫éÊÄªÂÜÖÂ≠òÁöÑ‰∏ÄÂçä„ÄÇÈÇ£‰πà &gt;= ËØ•Âπ¥ÈæÑÁöÑÂ∞±ÁÆóËÄÅ‰∫Ü„ÄÇ Á©∫Èó¥ÂàÜÈÖçÊãÖ‰øùÂú®ÂèëÁîü Minor GC ‰πãÂâçÔºå ËôöÊãüÊú∫‰ºöÂÖàÊ£ÄÊü•ËÄÅÂπ¥‰ª£ÊúÄÂ§ßÂèØÁî®ÁöÑËøûÁª≠Á©∫Èó¥ÊòØÂê¶Â§ß‰∫éÊñ∞Áîü‰ª£ÊâÄÊúâÂØπË±°ÊÄªÁ©∫Èó¥Ôºå Â¶ÇÊûúËøô‰∏™Êù°‰ª∂ÊàêÁ´ãÔºåÈÇ£‰πà Minor GC ÂèØ‰ª•Á°Æ‰øùÊòØÂÆâÂÖ®ÁöÑ„ÄÇ Â¶ÇÊûú‰∏çÊàêÁ´ãÔºåÂàôËôöÊãüÊú∫‰ºöÊü•Áúã HandlePromotionFailure ËÆæÁΩÆÂÄºÊòØÂê¶ÂÖÅËÆ∏ÊãÖ‰øùÂ§±Ë¥•„ÄÇ Â¶ÇÊûúÂÖÅËÆ∏ÔºåÈÇ£‰πà‰ºöÁªßÁª≠Ê£ÄÊü•ËÄÅÂπ¥‰ª£ÊúÄÂ§ßÂèØÁî®ÁöÑËøûÁª≠Á©∫Èó¥ÊòØÂê¶Â§ß‰∫éÂéÜÊ¨°ÊôãÂçáÂà∞ËÄÅÂπ¥‰ª£ÂØπË±°ÂÆπÈáèÁöÑ==Âπ≥ÂùáÂ§ßÂ∞è==Ôºå Â¶ÇÊûúÂ§ß‰∫éÔºåÂ∞ÜÂ∞ùËØïÁùÄËøõË°å‰∏ÄÊ¨° Minor GCÔºåÂ∞ΩÁÆ°ËøôÊ¨° Minor GC ÊòØÊúâÈ£éÈô©ÁöÑÔºõ Â¶ÇÊûúÂ∞è‰∫éÔºåÊàñËÄÖ HandlePromotionFailure ËÆæÁΩÆ‰∏çÂÖÅËÆ∏ÂÜíÈô©ÔºåÈÇ£ËøôÊó∂‰πüË¶ÅÊîπ‰∏∫ËøõË°å‰∏ÄÊ¨° Full GC„ÄÇ Â¶ÇÊûú‰∏çÂÖÅËÆ∏ÔºåÊîπ‰∏∫ËøõË°å‰∏ÄÊ¨° Full GC „ÄåÂÜíÈô©„ÄçÊòØÂÜí‰∫Ü‰ªÄ‰πàÈ£éÈô©Ôºü ‰∏ÄÂè•ËØùÂ∞±ÊòØÔºöËÄÅÂπ¥‰ª£ÁöÑÊúÄÂ§ßÂèØÁî®ËøûÁª≠Á©∫Èó¥ÂèØËÉΩÂ∞è‰∫éÊñ∞Áîü‰ª£ÊâÄÊúâÂ≠òÊ¥ªÂØπË±°ÊÄªÁ©∫Èó¥ÔºåÂ∞±‰ºöÂØºËá¥ Full GCÔºåÊú¨Êù•ÊòØÂ∫îËØ•Áõ¥Êé•ÊâßË°å Full GC ÁöÑÔºå‰ΩÜÊòØÊ≤°ÊúâÁõ¥Êé•ÊâßË°åÔºåÂØºËá¥Êµ™Ë¥π‰∫ÜÊó∂Èó¥„ÄÇ ÂÖ∑‰ΩìËÄåË®ÄÔºöÊñ∞Áîü‰ª£‰ΩøÁî®Â§çÂà∂Êî∂ÈõÜÁÆóÊ≥ïÔºå‰ΩÜ‰∏∫‰∫ÜÂÜÖÂ≠òÂà©Áî®ÁéáÔºåÂè™‰ΩøÁî®ÂÖ∂‰∏≠‰∏Ä‰∏™ Survivor Á©∫Èó¥Êù•‰Ωú‰∏∫ËΩÆÊç¢Â§á‰ªΩÔºåÂõ†Ê≠§ÂΩìÂá∫Áé∞Â§ßÈáèÂØπË±°Âú® Minor GC Âêé‰ªçÁÑ∂Â≠òÊ¥ªÁöÑÊÉÖÂÜµÔºàÊúÄÊûÅÁ´ØÁöÑÊÉÖÂÜµÂ∞±ÊòØÂÜÖÂ≠òÂõûÊî∂ÂêéÊñ∞Áîü‰ª£‰∏≠ÊâÄÊúâÂØπË±°ÈÉΩÂ≠òÊ¥ªÔºâÔºåÂ∞±ÈúÄË¶ÅËÄÅÂπ¥‰ª£ËøõË°åÂàÜÈÖçÊãÖ‰øùÔºåÊää Survivor Êó†Ê≥ïÂÆπÁ∫≥ÁöÑÂØπË±°Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£„ÄÇËÄÅÂπ¥‰ª£Ë¶ÅËøõË°åËøôÊ†∑ÁöÑÊãÖ‰øùÔºåÂâçÊèêÊòØËÄÅÂπ¥‰ª£Êú¨Ë∫´ËøòÊúâÂÆπÁ∫≥Ëøô‰∫õÂØπË±°ÁöÑÂâ©‰ΩôÁ©∫Èó¥Ôºå‰∏ÄÂÖ±ÊúâÂ§öÂ∞ëÂØπË±°‰ºöÊ¥ª‰∏ãÊù•Âú®ÂÆûÈôÖÂÆåÊàêÂÜÖÂ≠òÂõûÊî∂‰πãÂâçÊòØÊó†Ê≥ïÊòéÁ°ÆÁü•ÈÅìÁöÑÔºåÊâÄ‰ª•Âè™Â•ΩÂèñ‰πãÂâçÊØè‰∏ÄÊ¨°ÂõûÊî∂ÊôãÂçáÂà∞ËÄÅÂπ¥‰ª£ÂØπË±°ÂÆπÈáèÁöÑÂπ≥ÂùáÂ§ßÂ∞èÂÄº‰Ωú‰∏∫ÁªèÈ™åÂÄºÔºå‰∏éËÄÅÂπ¥‰ª£ÁöÑÂâ©‰ΩôÁ©∫Èó¥ËøõË°åÊØîËæÉÔºåÂÜ≥ÂÆöÊòØÂê¶ËøõË°å Full GC Êù•ËÆ©ËÄÅÂπ¥‰ª£ËÖæÂá∫Êõ¥Â§öÁ©∫Èó¥„ÄÇ ÂèñÂπ≥ÂùáÂÄºËøõË°åÊØîËæÉÂÖ∂ÂÆû‰ªçÁÑ∂ÊòØ‰∏ÄÁßçÂä®ÊÄÅÊ¶ÇÁéáÁöÑÊâãÊÆµÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂ¶ÇÊûúÊüêÊ¨° Minor GC Â≠òÊ¥ªÂêéÁöÑÂØπË±°Á™ÅÂ¢ûÔºåËøúËøúÈ´ò‰∫éÂπ≥ÂùáÂÄºÁöÑËØùÔºå‰æùÁÑ∂‰ºöÂØºËá¥ÊãÖ‰øùÂ§±Ë¥•ÔºàHandle Promotion FailureÔºâ„ÄÇÂ¶ÇÊûúÂá∫Áé∞‰∫Ü HandlePromotionFailure Â§±Ë¥•ÔºåÈÇ£Â∞±Âè™Â•ΩÂú®Â§±Ë¥•ÂêéÈáçÊñ∞ÂèëËµ∑‰∏ÄÊ¨° Full GC„ÄÇ ËôΩÁÑ∂ÊãÖ‰øùÂ§±Ë¥•Êó∂ÁªïÁöÑÂúàÂ≠êÊòØÊúÄÂ§ßÁöÑÔºå‰ΩÜÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÈÉΩËøòÊòØ‰ºöÂ∞Ü HandlePromotionFailure ÂºÄÂÖ≥ÊâìÂºÄÔºåÈÅøÂÖç Full GC Ëøá‰∫éÈ¢ëÁπÅ„ÄÇ Â∏∏ËßÅÈóÆÈ¢ò‰Ω†ËÉΩ‰∏çËÉΩË∞àË∞àÔºåGC ÊòØÂú®‰ªÄ‰πàÊó∂ÂÄôÔºåÂØπ‰ªÄ‰πà‰∏úË•øÔºåÂÅö‰∫Ü‰ªÄ‰πà‰∫ãÊÉÖÔºüÊ≠§ÈóÆÈ¢òÊëòËá™„ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã‰ΩúËÄÖÁöÑ‰∏ÄÁØáÂçöÊñáÔºåËØ¶ËßÅ ‰∏Ä‰∏™Èù¢ËØïÂÆòÂØπÈù¢ËØïÈóÆÈ¢òÁöÑÂàÜÊûê javaÁöÑgc‰∏∫‰ªÄ‰πàË¶ÅÂàÜ‰ª£ÔºüÁ≠îÊ°àÂèØÂèÇËÄÉ R Â§ßÁöÑËøô‰∏™ÂõûÁ≠î ÊÄªÁªìÊ≤°ÊúâÂõ∫ÂÆöÊî∂ÈõÜÂô®„ÄÅÂèÇÊï∞ÁªÑÂêàÔºå‰πüÊ≤°ÊúâÊúÄ‰ºòÁöÑË∞É‰ºòÊñπÊ≥ïÔºåËôöÊãüÊú∫‰πüÂ∞±Ê≤°Êúâ‰ªÄ‰πàÂøÖÁÑ∂ÁöÑÂÜÖÂ≠òÂõûÊî∂Ë°å‰∏∫„ÄÇ Â≠¶‰π†ËôöÊãüÊú∫ÂÜÖÂ≠òÁü•ËØÜÔºåÂ¶ÇÊûúË¶ÅÂà∞ÂÆûË∑µË∞É‰ºòÈò∂ÊÆµÔºåÈÇ£‰πàÂøÖÈ°ª‰∫ÜËß£ÊØè‰∏™ÂÖ∑‰ΩìÊî∂ÈõÜÂô®ÁöÑË°å‰∏∫„ÄÅ‰ºòÂäøÂíåÂä£Âäø„ÄÅË∞ÉËäÇÂèÇÊï∞„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã Êú¨ÊñáÂ§ßÈÉ®ÂàÜÂÜÖÂÆπÈÉΩÂá∫Ëá™„ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫„Äã Á¨¨‰∏âÁ´†ÔºåËã•Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVM ËøêË°åÊó∂Êï∞ÊçÆÂå∫Âüü‰∏éÂØπË±°ÂàõÂª∫Â∏ÉÂ±Ä]]></title>
    <url>%2Fblog%2F2017%2F09%2F07%2FJVM-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F%E4%B8%8E%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%B8%83%E5%B1%80%2F</url>
    <content type="text"><![CDATA[java ËøêË°åÊó∂Êï∞ÊçÆÂå∫ÂüüÊ†πÊçÆ„ÄäJava ËôöÊãüÊú∫ËßÑËåÉ„ÄãËßÑÂÆöÔºåJava ËôöÊãüÊú∫ÈîÅÁÆ°ÁêÜÁöÑÂÜÖÂ≠òÂåÖÂê´‰ª•‰∏ã‰ª•‰∏ãÂá†‰∏™ËøêË°åÊó∂Êï∞ÊçÆÂå∫ÂüüÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö Á®ãÂ∫èËÆ°Êï∞Âô®Á®ãÂ∫èËÆ°Êï∞Âô®ÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºåÂêÑÁ∫øÁ®ãÁã¨Á´ãÂ≠òÂÇ®Ôºå‰ª•‰æøÁ∫øÁ®ãÂàáÊç¢ÂêéËÉΩÊÅ¢Â§çÂà∞Ê≠£Á°ÆÁöÑÊâßË°å‰ΩçÁΩÆ„ÄÇÂèØ‰ª•Áúã‰ΩúÊòØÂΩìÂâçÁ∫øÁ®ãÊâÄÊâßË°åÁöÑÂ≠óËäÇÁ†ÅÁöÑË°åÂè∑ÊåáÁ§∫Âô®„ÄÇ Â¶ÇÊûúÊ≠£Âú®ÊâßË°åÁöÑÊòØ‰∏Ä‰∏™ Java ÊñπÊ≥ïÔºåËØ•ËÆ°Êï∞Âô®ËÆ∞ÂΩïÁöÑÊòØÊ≠£Âú®ÊâßË°åÁöÑËôöÊãüÊú∫Â≠óËäÇÁ†ÅÊåá‰ª§ÁöÑÂú∞ÂùÄ„ÄÇ Â¶ÇÊûúÊ≠£Âú®ÊâßË°åÁöÑÊòØ‰∏Ä‰∏™ Native ÊñπÊ≥ïÔºåÂàôËØ•ËÆ°Êï∞Âô®ÂÄº‰∏∫Á©∫„ÄÇ ==Ê≠§ÂÜÖÂ≠òÂå∫ÂüüÊòØÂîØ‰∏Ä‰∏Ä‰∏™Âú® Java ËôöÊãüÊú∫ËßÑËåÉ‰∏≠Ê≤°ÊúâËßÑÂÆö‰ªª‰Ωï OOM ÊÉÖÂÜµÁöÑÂå∫Âüü== Java ËôöÊãüÊú∫Ê†àJava ËôöÊãüÊú∫Ê†àÊòØ==Á∫øÁ®ãÁßÅÊúâÁöÑ==„ÄÇÁîüÂëΩÂë®Êúü‰∏éÁ∫øÁ®ãÁõ∏Âêå„ÄÇ ËôöÊãüÊú∫Ê†àÊèèËø∞ÁöÑÊòØ Java ÊñπÊ≥ïÊâßË°åÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºöÊØè‰∏™ÊñπÊ≥ïÂú®ÊâßË°åÁöÑÂêåÊó∂ÈÉΩ‰ºöÂàõÂª∫‰∏Ä‰∏™Ê†àÂ∏ßÔºàStack FrameÔºâ„ÄÇÊØè‰∏Ä‰∏™ÊñπÊ≥ï‰ªéË∞ÉÁî®Âà∞ÊâßË°åÈÉΩÂØπÂ∫îÁùÄ‰∏Ä‰∏™Ê†àÂ∏ßÂú®ËôöÊãüÊú∫Ê†à‰∏≠ÂÖ•Ê†àÂíåÂá∫Ê†àÁöÑËøáÁ®ã„ÄÇ Ê≥®ÔºöÊ†àÂ∏ßÔºàStack Frame ÔºâÊòØÊñπÊ≥ïËøêË°åÊó∂Âü∫Á°ÄÊï∞ÊçÆÁªìÊûÑÔºåÂÖ∂‰∏≠Â≠òÂÇ®‰∫ÜÂ±ÄÈÉ®ÂèòÈáèË°®„ÄÅÊìç‰ΩúÊï∞Ê†à„ÄÅÂä®ÊÄÅÈìæÊé•„ÄÅÊñπÊ≥ïÂá∫Âè£Á≠â‰ø°ÊÅØ„ÄÇ Âπ≥Êó∂ÊâÄËÆ≤ÁöÑÊ†àÂÜÖÂ≠òÔºåÂ∞±ÊòØÁé∞Âú®ËÆ≤ÁöÑ Java ËôöÊãüÊú∫Ê†àÔºåÊàñËÄÖËØ¥ÊòØËôöÊãüÊú∫Ê†à‰∏≠Â±ÄÈÉ®ÂèòÈáèË°®ÈÉ®ÂàÜ„ÄÇ Â¶ÇÊûúÁ∫øÁ®ãËØ∑Ê±ÇÁöÑÊ†àÊ∑±Â∫¶Â§ß‰∫éËôöÊãüÊú∫ÊâÄÂÖÅËÆ∏ÁöÑÊ∑±Â∫¶ÔºåÂ∞ÜÊäõÂá∫ SOFÔºàStack Over FlowÔºâ ÂºÇÂ∏∏ Â¶ÇÊûúÊâ©Â±ïÊó∂ÔºåÊó†Ê≥ïÁî≥ËØ∑Âà∞Ë∂≥Â§üÁöÑÂÜÖÂ≠òÔºåÂ∞±‰ºöÊäõ OOMError ÂºÇÂ∏∏ Êú¨Âú∞ÊñπÊ≥ïÊ†àÂèëÊå•ÁöÑ‰ΩúÁî®‰∏éËôöÊãüÊú∫Ê†àÁõ∏‰ºº„ÄÇÂè™‰∏çËøá‰∏Ä‰∏™ÊòØÈíàÂØπ Java ÊñπÊ≥ïÔºå‰∏Ä‰∏™ÊòØÈíàÂØπÊú¨Âú∞ÊñπÊ≥ï„ÄÇ Java Â†ÜÂØπ‰∫éÂ§ßÂ§öÊï∞Â∫îÁî®ËÄåË®ÄÔºåJava Â†ÜÊòØ Java ËôöÊãüÊú∫ÊâÄÁÆ°ÁêÜÁöÑÂÜÖÂ≠ò‰∏≠ÊúÄÂ§ßÁöÑ‰∏ÄÂùó„ÄÇÂêåÊó∂ÂÆÉ‰πüÊòØ==ÊâÄÊúâÁ∫øÁ®ãÂÖ±‰∫´==ÁöÑ‰∏ÄÂùóÂÜÖÂ≠òÂå∫Âüü„ÄÇJava ËôöÊãüÊú∫ËßÑÂÆöÔºåJava Â†ÜÂèØ‰ª•ÊòØÁâ©ÁêÜ‰∏ä‰∏çËøûÁª≠ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂè™Ë¶ÅÈÄªËæë‰∏äËøûÁª≠Âç≥ÂèØ„ÄÇ ÊåâÁÖßËôöÊãüÊú∫ËßÑËåÉ‰∏≠ÁöÑÊèèËø∞ÔºåÊâÄÊúâÂØπË±°ÂÆû‰æã‰ª•ÂèäÊï∞ÁªÑÈÉΩË¶ÅÂú®Â†Ü‰∏äÂàÜÈÖç„ÄÇ‰∏çËøáÈöèÁùÄ JIT ÁºñËØëÂô®ÁöÑÂèëÂ±ïÂíåÈÄÉÈÄ∏ÂàÜÊûêÊäÄÊúØÁöÑÈÄêÊ∏êÊàêÁÜüÔºåÊú™Êù•ÊàñËÆ∏‰ºöÊúâÊâÄÊîπÂèò„ÄÇ ‰ªéÂÜÖÂ≠òÂàÜÈÖçËßíÂ∫¶Êù•ÁúãÔºåÁ∫øÁ®ãÂÖ±‰∫´ÁöÑ Java Â†Ü‰∏≠ÂèØËÉΩ‰ºöÂàíÂàÜÂá∫Â§ö‰∏™Á∫øÁ®ãÁßÅÊúâÁöÑÂàÜÈÖçÁºìÂÜ≤Âå∫ÔºàThread Local Allocation BufferÔºåTLABÔºâ„ÄÇ‰∏çÁÆ°ÊÄé‰πàÂàíÂàÜÔºåÂÖ∂‰∏≠Â≠òÂÇ®ÁöÑÈÉΩÊòØÂØπË±°ÔºåËøõË°åÂàíÂàÜÁöÑÁõÆÁöÑÂè™ÊòØ‰∏∫‰∫ÜÊõ¥Â•ΩÂú∞ÂõûÊî∂/ÂàÜÈÖçÂÜÖÂ≠ò„ÄÇ ÊñπÊ≥ïÂå∫ÊñπÊ≥ïÂå∫Êúâ‰∏Ä‰∏™Âà´ÂêçÔºönon-heapÔºå‰∏é Java Â†ÜÂå∫ÂàÜÂºÄÊù•„ÄÇÂÆÉÊòØ==ÊâÄÊúâÁ∫øÁ®ãÂÖ±‰∫´==ÁöÑÔºåÁî®‰∫éÂ≠òÂÇ®Â∑≤Ë¢´ËôöÊãüÊú∫Âä†ËΩΩÁöÑÁ±ª‰ø°ÊÅØ„ÄÅÂ∏∏Èáè„ÄÅÈùôÊÄÅÂ∏∏Èáè„ÄÅÂç≥Êó∂ÁºñËØëÂô®ÁºñËØëÂêéÁöÑ‰ª£Á†ÅÁ≠âÊï∞ÊçÆ„ÄÇ Hotspot ËôöÊãüÊú∫ËÆæËÆ°Âõ¢ÈòüÈÄâÊã©Êää GC ÂàÜ‰ª£Êî∂ÈõÜÊâ©Â±ïÂà∞ÊñπÊ≥ïÂå∫ÔºåÊàñËÄÖËØ¥‰ΩøÁî®Ê∞∏‰πÖ‰ª£Êù•ÂÆûÁé∞ÊñπÊ≥ïÂå∫„ÄÇÂõ†‰∏∫ËøôÊ†∑Â∞±‰∏çÁî®‰∏ìÈó®‰∏∫ÊñπÊ≥ïÂå∫ÁºñÂÜôÂÜÖÂ≠òÁÆ°ÁêÜÁöÑ‰ª£Á†ÅÁöÑÂ∑•‰Ωú„ÄÇÂØπ‰∫éÂÖ∂‰ªñËôöÊãüÊú∫ËÄåË®ÄÊòØ‰∏çÂ≠òÂú®Ê∞∏‰πÖ‰ª£Ëøô‰∏™Ê¶ÇÂøµÁöÑ„ÄÇ ‰ΩøÁî®Ê∞∏‰πÖ‰ª£Êù•ÂÆûÁé∞ÊñπÊ≥ïÂå∫ÁöÑÂ•ΩÂ§ÑÂú®‰∫éÂèØ‰ª•Áõ¥Êé•ÂÉèÁÆ°ÁêÜ Java Â†ÜÈÇ£Ê†∑ÁÆ°ÁêÜËøôÈÉ®ÂàÜÂÜÖÂ≠òÔºåËÄå‰∏çÈúÄË¶ÅÂÜç‰∏ìÈó®‰∏∫ÊñπÊ≥ïÂå∫ÁºñÂÜôÂÜÖÂ≠òÁÆ°ÁêÜ‰ª£Á†Å„ÄÇÂùèÂ§ÑÂú®‰∫éËøôÊ†∑Êõ¥ÂÆπÊòìÂØºËá¥ OOMÔºåÂõ†‰∏∫Ê∞∏‰πÖ‰ª£Êúâ -XXÔºöMaxPermSize ÁöÑ‰∏äÈôê„ÄÇÂú® JDK 1.8 HotSpot ËôöÊãüÊú∫ÁöÑÂÆûÁé∞‰∏≠Â∑≤ÁªèÂ∞ÜÊï¥‰∏™Ê∞∏‰πÖ‰ª£ÁßªÈô§ÔºåÂèñËÄå‰ª£‰πãÁöÑÊòØ‰∏Ä‰∏™Âè´ÂÖÉÁ©∫Èó¥ÔºàMetaspaceÔºâÁöÑÂå∫Âüü„ÄÇ ÂΩìÊñπÊ≥ïÂå∫Êó†Ê≥ïÊª°Ë∂≥ÂÜÖÂ≠òÂàÜÈÖçÈúÄÊ±ÇÊó∂ÔºåÂ∞ÜÊäõÂá∫ java.lang.OutOfMemoryError: PermGen space „ÄÇ ËøêË°åÊó∂Â∏∏ÈáèÊ±†Class Êñá‰ª∂‰∏≠Èô§‰∫ÜÊúâÁ±ªÁöÑÁâàÊú¨„ÄÅÂ≠óÊÆµ„ÄÅÊñπÊ≥ï„ÄÅÊé•Âè£Á≠âÊèèËø∞‰ø°ÊÅØÔºåËøòÊúâ‰∏ÄÈ°π‰ø°ÊÅØÊòØÂ∏∏ÈáèÊ±†ÔºåÁî®‰∫éÂ≠òÊîæÁºñËØëÊúüÁîüÊàêÁöÑÂêÑÁßçÂ≠óÈù¢ÈáèÂíåÁ¨¶Âè∑ÂºïÁî®„ÄÇJDK 1.8 ÂâçËøêË°åÊó∂Â∏∏ÈáèÊ±†ÊòØÊñπÊ≥ïÂå∫ÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ ËôöÊãüÊú∫ËßÑËåÉ‰∏≠ÂØπ Class Êñá‰ª∂‰∏≠ÁöÑÊØè‰∏Ä‰∏™ÈÉ®ÂàÜÁöÑÊ†ºÂºèÈÉΩÊúâ‰∏•Ê†ºËßÑÂÆö„ÄÇ‰ΩÜÊòØÂØπ‰∫éËøêË°åÊó∂Â∏∏ÈáèÊ±†ÔºåÂπ∂Ê≤°ÊúâÂÅö‰ªª‰ΩïÁªÜËäÇÁöÑË¶ÅÊ±Ç„ÄÇ‰∏ÄËà¨ËÄåË®ÄÔºåÈô§‰∫Ü‰øùÂ≠ò Class Êñá‰ª∂‰∏≠ÊèèËø∞ÁöÑÁ¨¶Âè∑ÂºïÁî®Â§ñÔºåËøò‰ºöÊääÁøªËØëÂá∫Êù•ÁöÑÁõ¥Êé•ÂºïÁî®‰πüÂ≠òÂÇ®Âú®ËøêË°åÊó∂Â∏∏ÈáèÊ±†‰∏≠„ÄÇ ËøêË°åÊó∂Â∏∏ÈáèÊ±†Áõ∏ÂØπ‰∫é Class Êñá‰ª∂Â∏∏ÈáèÊ±†ÁöÑÁöÑÂè¶‰∏ÄÁâπÂæÅÂú®‰∫éÂÖ∑Â§áÂä®ÊÄÅÊÄß„ÄÇjava ËøêË°åÊúüÈó¥‰πüÂèØ‰ª•ÊääÊñ∞ÁöÑÂ∏∏ÈáèÊîæÂÖ•Ê±†‰∏≠„ÄÇÊØîÂ¶Ç‰ΩøÁî® String.intern() Â∞ÜÂ†Ü‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤Âä†ÂÖ•Â∏∏ÈáèÊ±†‰∏≠„ÄÇ JDK1.7 ‰∏≠ÊääÂéüÊú¨ÊîæÂú®Ê∞∏‰πÖ‰ª£ÁöÑÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÊ±†ÁßªÂà∞ Java Â†Ü‰∏≠„ÄÇÂ∏∏ÈáèÊ±†‰ΩçÁΩÆÁöÑ‰∏çÂêåÂΩ±ÂìçÂà∞‰∫Ü String ÁöÑ intern()ÊñπÊ≥ïÁöÑË°®Áé∞„ÄÇ‰∏çÂêåÁâàÊú¨ÁöÑ JDK ‰ΩøÁî®„Äå==„ÄçÂéªÊØîËæÉ String Â≠óÁ¨¶‰∏≤ÁöÑÁªìÊûú‰ºöÊúâ‰∏çÂêå„ÄÇÂÖ∑‰ΩìÊÉÖÂÜµÂèØÂèÇËÄÉËøôÁØáÊñáÁ´†‚Äî‚ÄîJava ÊäÄÊúØ‚Äî‚Äî‰Ω†ÁúüÁöÑ‰∫ÜËß£ String Á±ªÁöÑ intern()ÊñπÊ≥ïÂêó MetaspaceÔºàÂÖÉÁ©∫Èó¥Ôºâ‰ªãÁªçÂÖÉÁ©∫Èó¥‰πãÂâçÂÖàËØ¥ÁÇπÈ¢òÂ§ñËØù„ÄÇÂÖ∂ÂÆûÔºåÁßªÈô§Ê∞∏‰πÖ‰ª£ÁöÑÂ∑•‰Ωú‰ªé JDK1.7 Â∞±ÂºÄÂßã‰∫Ü„ÄÇJDK1.7 ‰∏≠ÔºåÂ≠òÂÇ®Âú®Ê∞∏‰πÖ‰ª£ÁöÑÈÉ®ÂàÜÊï∞ÊçÆÂ∞±Â∑≤ÁªèËΩ¨ÁßªÂà∞‰∫Ü Java Heap ÊàñËÄÖÊòØ Native Heap„ÄÇË≠¨Â¶ÇÁ¨¶Âè∑ÂºïÁî®(Symbols)ËΩ¨ÁßªÂà∞‰∫Ü native heap„ÄÅÂ≠óÈù¢Èáè(interned strings)ËΩ¨ÁßªÂà∞‰∫Ü java heap„ÄÅÁ±ªÁöÑÈùôÊÄÅÂèòÈáè(class statics)ËΩ¨ÁßªÂà∞‰∫Ü java heap„ÄÇ‰ΩÜ JDK1.7 Âπ∂Ê≤°ÊúâÂÆåÂÖ®ÁßªÈô§Â∞ÜÊ∞∏‰πÖ‰ª£ÂÆåÂÖ®ÁßªÈô§„ÄÇÁõ¥Âà∞ JDK1.8 ÊâçÂ∞ÜÊ∞∏‰πÖ‰ª£ÂÆåÊï¥Âú∞ÁßªÈô§„ÄÇ ÂÖÉÁ©∫Èó¥ÁöÑÊú¨Ë¥®ÂíåÊ∞∏‰πÖ‰ª£Á±ª‰ººÔºåÈÉΩÊòØÂØπ JVM ËßÑËåÉ‰∏≠ÊñπÊ≥ïÂå∫ÁöÑÂÆûÁé∞„ÄÇ‰∏çËøáÂÖÉÁ©∫Èó¥‰∏éÊ∞∏‰πÖ‰ª£‰πãÈó¥ÊúÄÂ§ßÁöÑÂå∫Âà´Âú®‰∫éÔºöÂÖÉÁ©∫Èó¥Âπ∂‰∏çÂú®ËôöÊãüÊú∫‰∏≠ÔºåËÄåÊòØ‰ΩøÁî®Êú¨Âú∞ÂÜÖÂ≠ò„ÄÇÂõ†Ê≠§ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÖÉÁ©∫Èó¥ÁöÑÂ§ßÂ∞è‰ªÖÂèóÊú¨Âú∞ÂÜÖÂ≠òÈôêÂà∂Ôºå‰ΩÜÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂèÇÊï∞Êù•ÊåáÂÆöÂÖÉÁ©∫Èó¥ÁöÑÂ§ßÂ∞èÔºö -XX:MetaspaceSizeÔºåÂàùÂßãÁ©∫Èó¥Â§ßÂ∞èÔºåËææÂà∞ËØ•ÂÄºÂ∞±‰ºöËß¶ÂèëÂûÉÂúæÊî∂ÈõÜËøõË°åÁ±ªÂûãÂç∏ËΩΩÔºåÂêåÊó∂ GC ‰ºöÂØπËØ•ÂÄºËøõË°åË∞ÉÊï¥ÔºöÂ¶ÇÊûúÈáäÊîæ‰∫ÜÂ§ßÈáèÁöÑÁ©∫Èó¥ÔºåÂ∞±ÈÄÇÂΩìÈôç‰ΩéËØ•ÂÄºÔºõÂ¶ÇÊûúÈáäÊîæ‰∫ÜÂæàÂ∞ëÁöÑÁ©∫Èó¥ÔºåÈÇ£‰πàÂú®‰∏çË∂ÖËøá MaxMetaspaceSize Êó∂ÔºåÈÄÇÂΩìÊèêÈ´òËØ•ÂÄº„ÄÇ -XX:MaxMetaspaceSizeÔºåÊúÄÂ§ßÁ©∫Èó¥ÔºåÈªòËÆ§ÊòØÊ≤°ÊúâÈôêÂà∂ÁöÑ„ÄÇ Â¶ÇÊûúÊú¨Âú∞Á©∫Èó¥ÁöÑÂÜÖÂ≠òÁî®Â∞Ω‰∫Ü‰ºöÊî∂Âà∞java.lang.OutOfMemoryError: Metadata space ÁöÑÈîôËØØ‰ø°ÊÅØ„ÄÇJDK1.8 ‰∏≠ÊåÅ‰πÖ‰ª£Áõ∏ÂÖ≥ÁöÑ JVM ÂèÇÊï∞ -XX:PermSize Âèä -XX:MaxPermSize Â∞Ü‰ºöË¢´ÂøΩÁï•Êéâ„ÄÇ ‰∏∫‰ªÄ‰πàÁßªÈô§ÊåÅ‰πÖ‰ª£Ôºü ÂÆÉÁöÑÂ§ßÂ∞èÂè™ËÉΩÂú®ÂêØÂä®Êó∂ÊåáÂÆöÔºåËøêË°åÊó∂Êó†Ê≥ï‰øÆÊîπ‚Äî‚ÄîÂæàÈöæËøõË°åË∞É‰ºò„ÄÇ-XX:MaxPermSizeÔºåËÆæÁΩÆÊàêÂ§öÂ∞ëÂ•ΩÂë¢Ôºü HotSpot ÁöÑÂÜÖÈÉ®Á±ªÂûã‰πüÊòØ Java ÂØπË±°ÔºöÂÆÉÂèØËÉΩ‰ºöÂú® Full GC ‰∏≠Ë¢´ÁßªÂä®ÔºåÂêåÊó∂ÂÆÉÂØπÂ∫îÁî®‰∏çÈÄèÊòéÔºå‰∏îÊòØÈùûÂº∫Á±ªÂûãÁöÑÔºåÈöæ‰ª•Ë∑üË∏™Ë∞ÉËØïÔºåËøòÈúÄË¶ÅÂ≠òÂÇ®ÂÖÉÊï∞ÊçÆÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºàmeta-metadataÔºâ„ÄÇ ÁÆÄÂåñ Full GCÔºöÊØè‰∏Ä‰∏™ÂõûÊî∂Âô®Êúâ‰∏ìÈó®ÁöÑÂÖÉÊï∞ÊçÆËø≠‰ª£Âô®„ÄÇ ÂèØ‰ª•Âú® GC ‰∏çËøõË°åÊöÇÂÅúÁöÑÊÉÖÂÜµ‰∏ãÂπ∂ÂèëÂú∞ÈáäÊîæÁ±ªÊï∞ÊçÆ„ÄÇ ‰ΩøÂæóÂéüÊù•ÂèóÈôê‰∫éÊåÅ‰πÖ‰ª£ÁöÑ‰∏Ä‰∫õÊîπËøõÊú™Êù•ÊúâÂèØËÉΩÂÆûÁé∞ ÂÖÉÁ©∫Èó¥ÁöÑÂÜÖÂ≠òÂàÜÈÖçÊ®°Âûã ÁªùÂ§ßÂ§öÊï∞ÁöÑÁ±ªÂÖÉÊï∞ÊçÆÁöÑÁ©∫Èó¥ÈÉΩ‰ªéÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠ÂàÜÈÖç Áî®Êù•ÊèèËø∞Á±ªÂÖÉÊï∞ÊçÆÁöÑÁ±ªÔºàklasses)‰πüË¢´Âà†Èô§‰∫Ü ÂàÜÂÖÉÊï∞ÊçÆÂàÜÈÖç‰∫ÜÂ§ö‰∏™ËôöÊãüÂÜÖÂ≠òÁ©∫Èó¥ ÁªôÊØè‰∏™Á±ªÂä†ËΩΩÂô®ÂàÜÈÖç‰∏Ä‰∏™ÂÜÖÂ≠òÂùóÁöÑÂàóË°®„ÄÇÂùóÁöÑÂ§ßÂ∞èÂèñÂÜ≥‰∫éÁ±ªÂä†ËΩΩÂô®ÁöÑÁ±ªÂûã; sun/ÂèçÂ∞Ñ/‰ª£ÁêÜÂØπÂ∫îÁöÑÁ±ªÂä†ËΩΩÂô®ÁöÑÂùó‰ºöÂ∞è‰∏Ä‰∫õ ÂΩíËøòÂÜÖÂ≠òÂùóÔºåÈáäÊîæÂÜÖÂ≠òÂùóÂàóË°® ‰∏ÄÊó¶ÂÖÉÁ©∫Èó¥ÁöÑÊï∞ÊçÆË¢´Ê∏ÖÁ©∫‰∫ÜÔºåËôöÊãüÂÜÖÂ≠òÁöÑÁ©∫Èó¥‰ºöË¢´ÂõûÊî∂Êéâ ÂáèÂ∞ëÁ¢éÁâáÁöÑÁ≠ñÁï• Áõ¥Êé•ÂÜÖÂ≠òÁõ¥Êé•ÂÜÖÂ≠òÂπ∂‰∏çÊòØËôöÊãüÊú∫ËøêË°åÊó∂Êï∞ÊçÆÂå∫ÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰πü‰∏çÊòØËôöÊãüÊú∫ËßÑËåÉ‰∏≠ÂÆö‰πâÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ JDK 1.4 Êñ∞Ê∑ªÂä†ÁöÑ NIOÔºàNew Input/OutputÔºâ ÂèØ‰ª•‰ΩøÁî® Native ÂáΩÊï∞Â∫ìÁõ¥Êé•ÂàÜÈÖçÂ†ÜÂ§ñÂ≠òÔºåÁÑ∂ÂêéÈÄöËøá‰∏Ä‰∏™Â≠òÂÇ®Âú® Java Â†Ü‰∏≠ÁöÑ DireByteBuffer ÂØπË±°‰Ωú‰∏∫ËøôÂùóÂÜÖÂ≠òÁöÑÂºïÁî®ËøõË°åÊìç‰Ωú„ÄÇËøôÊ†∑ÈÅøÂÖç‰∫ÜÂú® Java Â†ÜÂíå Native Â†Ü‰∏≠Êù•ÂõûÂ§çÂà∂Êï∞ÊçÆÔºåÂõ†Ê≠§Âú®‰∏Ä‰∫õÂú∫ÂêàËÉΩÂ§üÊòæËëóÊèêÈ´òÊÄßËÉΩ„ÄÇ Êú¨Êú∫Áõ¥Êé•ÂÜÖÂ≠ò‰∏çÂèó Java Â†ÜÂ§ßÂ∞èÁöÑÈôêÂà∂Ôºå‰ΩÜÊòØÂèóÂà∞Êú¨Êú∫ÊÄªÂÜÖÂ≠òÁöÑÂ§ßÂ∞è‰ª•ÂèäÂ§ÑÁêÜÂô®ÂØªÂùÄÁ©∫Èó¥ÁöÑÈôêÂà∂„ÄÇ HotSpot ËôöÊãüÊú∫‰∏≠ÂØπË±°ÂàõÂª∫„ÄÅÂàùÂßãÂåñ‰∏éÂ∏ÉÂ±ÄÂØπË±°ÁöÑÂàõÂª∫Á±ªÂä†ËΩΩÊ£ÄÊü•„ÄÅÂà§Êñ≠ÈÅáÂà∞‰∏ÄÊù° new Êåá‰ª§ÔºåÈ¶ñÂÖàÊ£ÄÊü•Ëøô‰∏™Êåá‰ª§ÁöÑÂèÇÊï∞ÊòØÂê¶ËÉΩÂú®Â∏∏ÈáèÊ±†‰∏≠ÂÆö‰ΩçÂà∞‰∏Ä‰∏™Á±ªÁöÑÁ¨¶Âè∑ÂºïÁî®ÔºåÂπ∂‰∏îÊ£ÄÊü•Ëøô‰∏™Á¨¶Âè∑ÂºïÁî®‰ª£Ë°®ÁöÑÁ±ªÊòØÂê¶Â∑≤Ë¢´Âä†ËΩΩ„ÄÅËß£ÊûêÂíåÂàùÂßãÂåñËøá„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÔºåÈÇ£ÂøÖÈ°ªÂÖàÊâßË°åÁõ∏Â∫îÁöÑÁ±ªÂä†ËΩΩ„ÄÇ ÂàÜÈÖçÂÜÖÂ≠òÁ±ªÂä†ËΩΩÊ£ÄÊü•ÈÄöËøáÂêéÔºåÂ∞Ü‰∏∫Êñ∞ÁîüÂØπË±°ÂàÜÈÖçÂÜÖÂ≠ò„ÄÇ‰πüÂ∞±ÊòØÂàíÂàÜÂá∫‰∏ÄÂùóÂÜÖÂ≠òÂå∫Âüü„ÄÇ Â¶ÇÊûú java Â†Ü‰∏≠ÁöÑÂÜÖÂ≠òÊòØÁªùÂØπËßÑÊï¥ÁöÑÔºåÈÇ£‰πà‰ºö‰ΩøÁî®ÊåáÈíàÁ¢∞ÊíûÁöÑÂàÜÈÖçÊñπÂºè Â¶ÇÊûú java Â†Ü‰∏≠ÁöÑÂÜÖÂ≠ò‰∏çËßÑÊï¥ÁöÑÔºåËôöÊãüÊú∫ÂøÖÈ°ªÁª¥Êä§‰∏Ä‰∏™ÂàóË°®ÔºåËÆ∞ÂΩïÂì™‰∫õÂÜÖÂ≠òÂùóÂèØÁî®ÔºåÂú®ÂàÜÈÖçÊó∂‰ªéÂàóË°®‰∏≠ÔºåÊâæÂà∞‰∏ÄÂùóË∂≥Â§üÂ§ßÁöÑÁ©∫Èó¥ÂàíÂàÜÁªôÂØπË±°„ÄÇÂç≥Ôºå‰ΩøÁî®Á©∫Èó≤ÂàóË°®ÁöÑÂàÜÈÖçÊñπÂºè„ÄÇ ÈÄâÊã©Âì™ÁßçÂàÜÈÖçÊñπÂºèÁî± java Â†ÜÊòØÂê¶ËßÑÊï¥ÂÜ≥ÂÆöÔºåËÄå Java Â†ÜÊòØÂê¶ËßÑÊï¥ÂèàÁî±ÊâÄÈááÁî®ÁöÑÂûÉÂúæÊî∂ÈõÜÂô®ÊòØÂê¶Â∏¶ÊúâÂéãÁº©Êï¥ÁêÜÂäüËÉΩÂÜ≥ÂÆö„ÄÇ Âú®‰ΩøÁî® Serial„ÄÅParNew Á≠âÂ∏¶ Compact ËøáÁ®ãÁöÑÊî∂ÈõÜÂô®Êó∂ÔºåÁ≥ªÁªüÈááÁî®ÁöÑÂàÜÈÖçÁÆóÊ≥ïÊòØÊåáÈíàÁ¢∞Êíû ËÄå‰ΩøÁî® CMS ËøôÁßçÂü∫‰∫é Mark-Sweep ÁÆóÊ≥ïÁöÑÊî∂ÈõÜÂô®Êó∂ÔºåÈÄöÂ∏∏ÈááÁî®Á©∫Èó≤ÂàóË°®„ÄÇ Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÔºöÂè¶Â§ñ‰∏Ä‰∏™ÈúÄË¶ÅËÄÉËôëÁöÑÈóÆÈ¢òÊòØÂØπË±°ÂàõÂª∫Âú®ËôöÊãüÊú∫‰∏≠ÊòØÈùûÂ∏∏È¢ëÁπÅÁöÑË°å‰∏∫ÔºåÂç≥‰ΩøÊòØ‰ªÖ‰ªÖ‰øÆÊîπ‰∏Ä‰∏™ÊåáÈíàÊâÄÊåáÂêëÁöÑ‰ΩçÁΩÆÔºåÂú®Âπ∂ÂèëÊÉÖÂÜµ‰∏ã‰πüÂπ∂‰∏çÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂèØËÉΩÂá∫Áé∞Ê≠£Âú®ÁªôÂØπË±° A ÂàÜÈÖçÂÜÖÂ≠òÔºåÊåáÈíàËøòÊ≤°Êù•ÂæóÂèä‰øÆÊîπÔºåÂØπË±° B ÂèàÂêåÊó∂‰ΩøÁî®‰∫ÜÂéüÊù•ÁöÑÊåáÈíàÊù•ÂàÜÈÖçÂÜÖÂ≠òÁöÑÊÉÖÂÜµ„ÄÇËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÊúâ‰∏§ÁßçÊñπÊ°àÔºö ‰∏ÄÁßçÊòØÂØπÂàÜÈÖçÂÜÖÂ≠òÁ©∫Èó¥ÁöÑÂä®‰ΩúËøõË°åÂêåÊ≠•Â§ÑÁêÜ‚Äî‚ÄîÂÆûÈôÖ‰∏äËôöÊãüÊú∫ÈááÁî® CAS ÈÖç‰∏äÂ§±Ë¥•ÈáçËØïÁöÑÊñπÂºè‰øùËØÅÊõ¥Êñ∞Êìç‰ΩúÁöÑÂéüÂ≠êÊÄßÔºõ Âè¶‰∏ÄÁßçÊòØÊääÂÜÖÂ≠òÂàÜÈÖçÁöÑÂä®‰ΩúÊåâÁÖßÁ∫øÁ®ãÂàíÂàÜÂú®‰∏çÂêåÁöÑÁ©∫Èó¥‰πã‰∏≠ËøõË°åÔºåÂç≥ÊØè‰∏™Á∫øÁ®ãÂú® Java Â†Ü‰∏≠È¢ÑÂÖàÂàÜÈÖç‰∏ÄÂ∞èÂùóÂÜÖÂ≠òÔºåÁß∞‰∏∫Êú¨Âú∞Á∫øÁ®ãÂàÜÈÖçÁºìÂÜ≤ÔºàThread Local Allocation Buffer,TLABÔºâ„ÄÇ Âì™‰∏™Á∫øÁ®ãË¶ÅÂàÜÈÖçÂÜÖÂ≠òÔºåÂ∞±Âú®Âì™‰∏™Á∫øÁ®ãÁöÑ TLAB ‰∏äÂàÜÈÖçÔºåÂè™Êúâ TLAB Áî®ÂÆåÂπ∂ÂàÜÈÖçÊñ∞ÁöÑ TLAB Êó∂ÔºåÊâçÈúÄË¶ÅÂêåÊ≠•ÈîÅÂÆö„ÄÇ ËôöÊãüÊú∫ÊòØÂê¶‰ΩøÁî® TLABÔºåÂèØ‰ª•ÈÄöËøá-XXÔºö+/-UseTLAB ÂèÇÊï∞Êù•ËÆæÂÆö„ÄÇ ÂØπË±°ÁöÑÂàùÂßãÂåñÊ≠§Â§ÑÁöÑÂàùÂßãÂåñÊåáÁöÑÊòØÂ∞ÜÂàÜÈÖçÂà∞ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÂàùÂßãÂåñ‰∏∫Èõ∂ÂÄº„ÄÇÔºà‰∏çÂåÖÊã¨ÂØπË±°Â§¥Ôºâ„ÄÇÂ¶ÇÊûú‰ΩøÁî® TLABÔºåËØ•ËøáÁ®ã‰πüÂèØ‰ª•ÊèêÂâçËá≥ TLAB ÂàÜÈÖçÊó∂ËøõË°å„ÄÇÂàùÂßãÂåñ‰∏∫Èõ∂ÂÄºÁöÑÊìç‰Ωú‰øùËØÅ‰∫ÜÂØπË±°ÁöÑÂÆû‰æãÂ≠óÊÆµÂú® Java ‰ª£Á†Å‰∏≠ÂèØ‰∏çËµãÂàùÂÄºÂ∞±‰ΩøÁî®„ÄÇ ÂØπË±°Â§¥ÁöÑËÆæÁΩÆÔºö ÂØπË±°ÊòØÂì™‰∏™Á±ªÁöÑÂÆû‰æã Â¶Ç‰ΩïÊâçËÉΩÊâæÂà∞Á±ªÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ ÂØπË±°ÁöÑÂìàÂ∏åÁ†Å ÂØπË±°ÁöÑ GC ÂàÜ‰ª£Âπ¥ÈæÑÁ≠â‰ø°ÊÅØ„ÄÇ ‚Ä¶ ‰ªéËôöÊãüÊú∫ÁöÑËßÜËßíÊù•ÁúãÔºå‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°Â∑≤ÁªèÂàõÂª∫ÂÆåÊØï„ÄÇ ‰ΩÜ‰ªé Java Á®ãÂ∫èËßÜËßíÊù•ÁúãÔºåÂØπË±°ÁöÑÂàõÂª∫ÊâçÂàöÂàöÂºÄÂßã‚Äî‚Äî ÊñπÊ≥ïËøòÊ≤°ÊúâÊâßË°å„ÄÅÊâÄÊúâÂ≠óÊÆµÈÉΩËøò‰∏∫Èõ∂. ‰∏ÄËà¨Êù•ËØ¥ÔºàÁî±Â≠óËäÇÁ†Å‰∏≠ÊòØÂê¶Ë∑üÈöè invokespecial Êåá‰ª§ÊâÄÂÜ≥ÂÆöÔºâÔºåÊâßË°å new Êåá‰ª§‰πãÂêé‰ºöÊé•ÁùÄÊâßË°å ÊñπÊ≥ïÔºåÊääÂØπË±°ÊåâÁÖßÁ®ãÂ∫èÂëòÁöÑÊÑèÊÑøËøõË°åÂàùÂßãÂåñÔºåËøôÊ†∑‰∏Ä‰∏™ÁúüÊ≠£ÂèØÁî®ÁöÑÂØπË±°ÊâçÁÆóÂÆåÂÖ®‰∫ßÁîüÂá∫Êù•„ÄÇ ÂØπË±°ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄHotSpot ‰∏≠ÔºåÂØπË±°Âú®ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®ÁöÑÂ∏ÉÂ±ÄÂèØ‰ª•ÂàÜ‰∏∫ 3 ÂùóÂå∫ÂüüÔºö ÂØπË±°Â§¥ Header ÂÆû‰æãÊï∞ÊçÆ Instance Data ÂØπÈΩêÂ°´ÂÖÖ Padding (Âπ∂‰∏çÊòØÂøÖÁÑ∂Â≠òÂú®) 1. ÂØπË±°Â§¥ÂØπË±°Â§¥ÂåÖÊã¨‰∏§ÈÉ®ÂàÜ‰ø°ÊÅØÔºöÁ¨¨‰∏ÄÈÉ®ÂàÜ‰∏∫Â≠òÂÇ®ÂØπË±°Ëá™Ë∫´ÂæóËøêË°åÊó∂Êï∞ÊçÆÔºåÁ¨¨‰∫åÈÉ®ÂàÜ‰∏∫Á±ªÂûãÊåáÈíà„ÄÇ Â≠òÂÇ®ÂØπË±°Ëá™Ë∫´ÁöÑËøêË°åÊó∂Êï∞ÊçÆ„ÄÇÂ¶ÇÔºö ÂìàÂ∏åÁ†ÅÔºàHashCodeÔºâ GC ÂàÜ‰ª£Âπ¥ÈæÑ„ÄÅ ÈîÅÁä∂ÊÄÅÊ†áÂøó„ÄÅ Á∫øÁ®ãÊåÅÊúâÁöÑÈîÅ„ÄÅ ÂÅèÂêëÁ∫øÁ®ã ID„ÄÅ ÂÅèÂêëÊó∂Èó¥Êà≥Á≠âÔºåËøôÈÉ®ÂàÜÊï∞ÊçÆÁöÑÈïøÂ∫¶Âú® 32 ‰ΩçÂíå 64 ‰ΩçÁöÑËôöÊãüÊú∫ÔºàÊú™ÂºÄÂêØÂéãÁº©ÊåáÈíàÔºâ‰∏≠ÂàÜÂà´‰∏∫ 32bit Âíå 64bitÔºåÂÆòÊñπÁß∞ÂÆÉ‰∏∫„ÄåMark Word„Äç„ÄÇ ÂØπË±°Â§¥‰ø°ÊÅØÊòØ‰∏éÂØπË±°Ëá™Ë∫´ÂÆö‰πâÁöÑÊï∞ÊçÆÊó†ÂÖ≥ÁöÑÈ¢ùÂ§ñÂ≠òÂÇ®ÊàêÊú¨ÔºåËÄÉËôëÂà∞ËôöÊãüÊú∫ÁöÑÁ©∫Èó¥ÊïàÁéáÔºåMark Word Ë¢´ËÆæËÆ°Êàê‰∏Ä‰∏™ÈùûÂõ∫ÂÆöÁöÑÊï∞ÊçÆÁªìÊûÑ‰ª•‰æøÂú®ÊûÅÂ∞èÁöÑÁ©∫Èó¥ÂÜÖÂ≠òÂÇ®Â∞ΩÈáèÂ§öÁöÑ‰ø°ÊÅØÔºåÂÆÉ‰ºöÊ†πÊçÆÂØπË±°ÁöÑÁä∂ÊÄÅÂ§çÁî®Ëá™Â∑±ÁöÑÂ≠òÂÇ®Á©∫Èó¥„ÄÇ Á±ªÂûãÊåáÈíàÔºåÂç≥ÂØπË±°ÊåáÂêëÂÆÉÁöÑÁ±ªÂÖÉÊï∞ÊçÆÁöÑÊåáÈíàÔºåËôöÊãüÊú∫ÈÄöËøáËØ•ÊåáÈíàÊù•Á°ÆÂÆöËøô‰∏™ÂØπË±°ÊòØÂì™‰∏™Á±ªÁöÑÂÆû‰æã„ÄÇ Â¶ÇÊûúÂØπË±°ÊòØ‰∏Ä‰∏™Êï∞ÁªÑÔºåÈÇ£‰πàÂØπË±°Â§¥‰∏≠ËøòÈúÄË¶ÅÊúâ‰∏ÄÂùóÁî®‰∫éËÆ∞ÂΩïÊï∞ÊçÆÈïøÂ∫¶ÁöÑÊï∞ÊçÆ Âõ†‰∏∫‰ªéÊï∞ÊçÆÁöÑÂÖÉÊï∞ÊçÆÊó†Ê≥ïÁ°ÆÂÆöÊï∞ÁªÑÁöÑÂ§ßÂ∞è Ê≥®ÊÑèÔºöÂπ∂‰∏çÊòØÊâÄÊúâÁöÑËôöÊãüÊú∫ÂÆûÁé∞ÈÉΩÂøÖÈ°ªÂú®ÂØπË±°Êï∞ÊçÆ‰∏ä‰øùÁïôÁ±ªÂûãÊåáÈíàÔºåÊç¢Âè•ËØùËØ¥ÔºåÊü•ÊâæÂØπË±°ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÂπ∂‰∏ç‰∏ÄÂÆöË¶ÅÁªèËøáÂØπË±°Êú¨Ë∫´ ÊØîÂ¶ÇÔºöÈÄöËøáÂè•ÊüÑËÆøÈóÆÂØπË±° 2. ÂÆû‰æãÊï∞ÊçÆÊé•‰∏ãÊù•ÁöÑÂÆû‰æãÊï∞ÊçÆÈÉ®ÂàÜÊòØÂØπË±°ÁúüÊ≠£Â≠òÂÇ®ÁöÑÊúâÊïà‰ø°ÊÅØÔºå‰πüÊòØÂú®Á®ãÂ∫è‰ª£Á†Å‰∏≠ÊâÄÂÆö‰πâÁöÑÂêÑÁßçÁ±ªÂûãÁöÑÂ≠óÊÆµÂÜÖÂÆπ„ÄÇ Êó†ËÆ∫ÊòØ‰ªéÁà∂Á±ªÁªßÊâø‰∏ãÊù•ÁöÑÔºåËøòÊòØÂú®Â≠êÁ±ª‰∏≠ÂÆö‰πâÁöÑÔºåÈÉΩÈúÄË¶ÅËÆ∞ÂΩïËµ∑Êù•„ÄÇ ËøôÈÉ®ÂàÜÁöÑÂ≠òÂÇ®È°∫Â∫è‰ºöÂèóÂà∞ËôöÊãüÊú∫ÂàÜÈÖçÁ≠ñÁï•ÂèÇÊï∞ÔºàFieldsAllocationStyleÔºâÂíåÂ≠óÊÆµÂú® Java Ê∫êÁ†Å‰∏≠ÂÆö‰πâÈ°∫Â∫èÁöÑÂΩ±Âìç„ÄÇ HotSpot ËôöÊãüÊú∫ÈªòËÆ§ÁöÑÂàÜÈÖçÁ≠ñÁï•‰∏∫ longs/doubles„ÄÅints„ÄÅshorts/chars„ÄÅbytes/booleans„ÄÅoopsÔºàOrdinary Object PointersÔºâÔºå ÂèØ‰ª•ÁúãÂá∫ÔºåÁõ∏ÂêåÂÆΩÂ∫¶ÁöÑÂ≠óÊÆµÊÄªÊòØË¢´ÂàÜÈÖçÂà∞‰∏ÄËµ∑„ÄÇ Âú®Êª°Ë∂≥Ëøô‰∏™ÂâçÊèêÊù°‰ª∂ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂú®Áà∂Á±ª‰∏≠ÂÆö‰πâÁöÑÂèòÈáè‰ºöÂá∫Áé∞Âú®Â≠êÁ±ª‰πãÂâç„ÄÇ Â¶ÇÊûú CompactFields ÂèÇÊï∞ÂÄº‰∏∫ trueÔºàÈªòËÆ§‰∏∫ trueÔºâÔºåÈÇ£‰πàÂ≠êÁ±ª‰πã‰∏≠ËæÉÁ™ÑÁöÑÂèòÈáè‰πüÂèØËÉΩ‰ºöÊèíÂÖ•Âà∞Áà∂Á±ªÂèòÈáèÁöÑÁ©∫Èöô‰πã‰∏≠„ÄÇ 3. ÂØπÈΩêÂ°´ÂÖÖÂØπÈΩêÂ°´ÂÖÖÂπ∂‰∏çÊòØÂøÖÁÑ∂Â≠òÂú®ÁöÑÔºå‰πüÊ≤°ÊúâÁâπÂà´ÁöÑÂê´‰πâÔºåÂÆÉ‰ªÖ‰ªÖËµ∑ÁùÄÂç†‰ΩçÁ¨¶ÁöÑ‰ΩúÁî®„ÄÇ Áî±‰∫é HotSpot VM ÁöÑËá™Âä®ÂÜÖÂ≠òÁÆ°ÁêÜÁ≥ªÁªüË¶ÅÊ±ÇÂØπË±°Ëµ∑ÂßãÂú∞ÂùÄÂøÖÈ°ªÊòØ 8 Â≠óËäÇÁöÑÊï¥Êï∞ÂÄçÔºåÊç¢Âè•ËØùËØ¥ÔºåÂ∞±ÊòØÂØπË±°ÁöÑÂ§ßÂ∞èÂøÖÈ°ªÊòØ 8 Â≠óËäÇÁöÑÊï¥Êï∞ÂÄç„ÄÇ ÂØπË±°ÁöÑËÆøÈóÆÂÆö‰ΩçÁî±‰∫é reference Á±ªÂûãÂú® Java ËôöÊãüÊú∫ËßÑËåÉ‰∏≠Âè™ËßÑÂÆö‰∫Ü‰∏Ä‰∏™ÊåáÂêëÂØπË±°ÁöÑÂºïÁî®ÔºåÂπ∂Ê≤°ÊúâÂÆö‰πâËøô‰∏™ÂºïÁî®Â∫îËØ•ÈÄöËøá‰ΩïÁßçÊñπÂºèÂéªÂÆö‰Ωç„ÄÅËÆøÈóÆÂ†Ü‰∏≠ÁöÑÂØπË±°ÁöÑÂÖ∑‰Ωì‰ΩçÁΩÆÔºåÊâÄ‰ª•ÂØπË±°ËÆøÈóÆÊñπÂºè‰πüÊòØÂèñÂÜ≥‰∫éËôöÊãüÊú∫ÂÆûÁé∞ËÄåÂÆöÁöÑ„ÄÇ ‰∏ªÊµÅÁöÑËÆøÈóÆÊñπÂºèÊúâ‰∏§ÁßçÔºö1. ‰ΩøÁî®Âè•ÊüÑÔºå2. ‰ΩøÁî®Áõ¥Êé•ÊåáÈíà ‰ΩøÁî®Âè•ÊüÑËÆøÈóÆÔºö Java Â†Ü‰∏≠Â∞Ü‰ºöÂàíÂàÜÂá∫Êù•‰∏ÄÂùóÂÜÖÂ≠ò‰Ωú‰∏∫Âè•ÊüÑÊ±†Ôºåreference ‰∏≠Â∞±ÊòØÂ≠òÂÇ®‰∫ÜÂØπË±°ÁöÑÂè•ÊüÑÂú∞ÂùÄÔºåËÄåÂè•ÊüÑ‰∏≠ÂåÖÂê´‰∫ÜÂØπË±°ÂÆû‰æãÊï∞ÊçÆÂíåÁ±ªÂûãÊï∞ÊçÆÂêÑËá™ÁöÑÂÖ∑‰ΩìÂú∞ÂùÄ‰ø°ÊÅØ„ÄÇ Áõ¥Êé•ÊåáÈíàËÆøÈóÆÔºö ÈááÁî®ËøôÁßçÊñπÂºèÔºåÈÇ£‰πà Java Â†ÜÂØπË±°ÁöÑÂ∏ÉÂ±Ä‰∏≠Â∞±ÂøÖÈ°ªËÄÉËôëÂ¶Ç‰ΩïÊîæÁΩÆËÆøÈóÆÁ±ªÂûãÊï∞ÊçÆÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåreference ‰∏≠Â≠òÂÇ®ÁöÑÁõ¥Êé•Â∞±ÊòØÂØπË±°Âú∞ÂùÄÔºåËÄåÂØπË±°‰∏≠ÂåÖÂê´‰∫ÜÂØπË±°Á±ªÂûãÊï∞ÊçÆÁöÑÂú∞ÂùÄ‰ø°ÊÅØ„ÄÇ ÂØπÊØî ‰ΩøÁî®Âè•ÊüÑËÆøÈóÆ‰ºòÁÇπÔºöÊòØ reference ‰∏≠Â≠òÂÇ®ÁöÑÊòØÁ®≥ÂÆöÁöÑÂè•ÊüÑÂú∞ÂùÄÔºåÂú®ÂØπË±°Ë¢´ÁßªÂä®Êó∂ÔºåÂè™‰ºöÊîπÂèòÂè•ÊüÑ‰∏≠ÁöÑÂÆû‰æãÊï∞ÊçÆÊåáÈíàÔºåËÄå reference Êú¨Ë∫´‰∏çÈúÄË¶ÅË¢´‰øÆÊîπ„ÄÇ ‰ΩøÁî®Áõ¥Êé•ÊåáÈíàÁöÑÊúÄÂ§ßÂ•ΩÂ§ÑÂ∞±ÊòØÈÄüÂ∫¶Êõ¥Âø´ÔºåËäÇÁúÅ‰∫Ü‰∏ÄÊ¨°ÊåáÈíàÂÆö‰ΩçÈúÄË¶ÅÁöÑÊó∂Èó¥ÂºÄÈîÄÔºåÁî±‰∫é Java ÂØπË±°ËÆøÈóÆÂçÅÂàÜÈ¢ëÁπÅÔºåËøôÁ±ªÂºÄÈîÄÁßØÂ∞èÊàêÂ§öÂêé‰πüÊòØ‰∏ÄÈ°πÈùûÂ∏∏ÂèØËßÇÁöÑÊâßË°åÊàêÊú¨„ÄÇ Sun HotSpot ËôöÊãüÊú∫‰ΩøÁî®ÁöÑÂ∞±ÊòØËøôÁßçËÆøÈóÆÊñπÂºè„ÄÇ OutOfMemoryError ÂºÇÂ∏∏ÁÆÄÊûêJava Â†ÜÊ∫¢Âá∫‰∏çÊñ≠ÂàõÂª∫ÂØπË±°ÔºåÂπ∂‰∏î‰øùËØÅ GC Roots Âà∞ÂØπË±°‰πãÈó¥ÊúâÂèØËææË∑ØÂæÑÊù•ÈÅøÂÖçÂûÉÂúæÂõûÊî∂Êú∫Âà∂Ê∏ÖÈô§Ëøô‰∫õÂØπË±°„ÄÇÂú®ÂØπË±°ÊÄªÂÜÖÂ≠òËææÂà∞ -XmX:heapSizeÊåáÂÆöÁöÑÂÄº‰πãÂêéÂ∞±‰ºö OOM„ÄÇ ‰∏ÄËà¨Âá∫Áé∞ËøôÁßçÊÉÖÂÜµÈÉΩÊòØÈÄöËøá MAT Â∑•ÂÖ∑Êù•ÂàÜÊûê„ÄÇÁ°ÆÂÆöÊòØÂá∫Áé∞‰∫ÜÂÜÖÂ≠òÊ≥ÑÊºèÔºåËøòÊòØÁöÑÊúÄÂ§ßÂ†ÜÁ©∫Èó¥ÁöÑËÆæÁΩÆ‰∏çÂêàÁêÜ„ÄÇ Â¶ÇÊûúÊòØÂÜÖÂ≠òÊ≥ÑÊºèÔºåÂèØËøõ‰∏ÄÊ≠•ÈÄöËøáÂ∑•ÂÖ∑Êù•Êü•ÁúãÂØπË±°Âà∞ GC Roots ÁöÑÂºïÁî®ÈìæÔºåÊâæÂá∫ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂéüÂõ† Â¶ÇÊûú‰∏çÂ≠òÂú®ÂÜÖÂ≠òÊ≥ÑÊºèÔºåÂç≥ÂØπË±°Á°ÆÂÆûÂøÖÈ°ªÂ≠òÊ¥ªÁùÄÔºåÈÇ£Â∞±Ë¶ÅÊ£ÄÊü•ËôöÊãüÊú∫ÁöÑÂ†ÜÂèÇÊï∞Ôºà-Xmx ‰∏é -XmsÔºâ‰∏éÊú∫Âô®Áâ©ÁêÜÂÜÖÂ≠òÊØîËæÉÁúãÊòØÂê¶ËøòÂèØ‰ª•Ë∞ÉÂ§ßÔºõÂêåÊó∂‰πüÂèØ‰ª•ÈÄöËøáÊ£ÄÊü•‰ª£Á†Å‰∏≠ÊòØÂê¶Â≠òÂú®‰∏Ä‰∫õÂØπË±°ÁöÑÁîüÂëΩÂë®ÊúüËøáÈïø„ÄÅÊåÅÊúâÁä∂ÊÄÅÊó∂Èó¥ËøáÈïøÁöÑÊÉÖÂÜµÔºåÂ∞ùËØï¬∑ÂáèÂ∞ëÁ®ãÂ∫èËøêË°åÊúüÁöÑÂÜÖÂ≠òÊ∂àËÄó„ÄÇ ËôöÊãüÊú∫Ê†àÂíåÊú¨Âú∞ÊñπÊ≥ïÊ†àÊ∫¢Âá∫Âú® HotSpot ËôöÊãüÊú∫‰∏≠Âπ∂‰∏çÂå∫ÂàÜËôöÊãüÊú∫Ê†àÂíåÊú¨Âú∞ÊñπÊ≥ïÊ†à„ÄÇÊ†àÂÆπÈáèÂè™Áî± -Xss ÂèÇÊï∞ËÆæÂÆö„ÄÇ ÂÖ≥‰∫éËôöÊãüÊú∫Ê†àÂíåÊú¨Âú∞ÊñπÊ≥ïÊ†àÔºåÂú®JavaËôöÊãüÊú∫ËßÑËåÉ‰∏≠ÊèèËø∞‰∫Ü‰∏§ÁßçÂºÇÂ∏∏Ôºö Â¶ÇÊûúÁ∫øÁ®ãËØ∑Ê±ÇÁöÑÊ†àÊ∑±Â∫¶Â§ß‰∫éËôöÊãüÊú∫ÊâÄÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÊ∑±Â∫¶ÔºåÂ∞ÜÊäõÂá∫StackOverflowErrorÂºÇÂ∏∏„ÄÇ Â¶ÇÊûúËôöÊãüÊú∫Âú®Êâ©Â±ïÊ†àÊó∂Êó†Ê≥ïÁî≥ËØ∑Âà∞Ë∂≥Â§üÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂàôÊäõÂá∫OutOfMemoryErrorÂºÇÂ∏∏„ÄÇ ÂØºËá¥ SOF ÁöÑÂ∏∏ËßÅÂéüÂõ†ÊúâÈÄíÂΩí„ÄÅÂÆö‰πâÂ§ßÈáèÁöÑÂ±ÄÈÉ®ÂèòÈáèÁ≠â„ÄÇ ÊñπÊ≥ïÂå∫ÂíåËøêË°åÊó∂Â∏∏ÈáèÊ±†Ê∫¢Âá∫ÂèØ‰ª•ÈÄöËøáÂú®ËøêË°åÊó∂‰∫ßÁîüÂ§ßÈáèÁöÑÁ±ªÂéªÂ°´Êª°ÊñπÊ≥ïÂå∫„ÄÇ Áî±‰∫é JDK1.7 ÊääÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÊ±†‰ªéÊñπÊ≥ïÂå∫ÁßªÂà∞Â†Ü‰∏≠ÔºåÂú®‰∏çÂêåÁöÑÁâàÊú¨ÁöÑ JDK‰∏≠String.intern()ÊñπÊ≥ïÁöÑË°®Áé∞‰∏ç‰∏Ä„ÄÇ JDK1.6 ‰∏≠Ë∞ÉÁî® String.intern() ÊñπÊ≥ïÊó∂Ôºå‰ºöÊääÈ¶ñÊ¨°ÈÅáÂà∞ÁöÑÂ≠óÁ¨¶‰∏≤Â§çÂà∂Âà∞Ê∞∏‰πÖ‰ª£‰∏≠„ÄÇ JDK1.7 ‰∏≠Ë∞ÉÁî® String.intern()ÊñπÊ≥ïÊó∂Ôºå‰∏ç‰ºöÂÜçÂ§çÂà∂ÂÆû‰æãÔºåÂè™ÊòØÂú®Â∏∏ÈáèÊ±†‰∏≠ËÆ∞ÂΩïÈ¶ñÊ¨°Âá∫Áé∞ÁöÑÂÆû‰æãÂºïÁî® Êú¨Êú∫Áõ¥Êé•ÂÜÖÂ≠òÊ∫¢Âá∫ÂèØ‰ª•ÈÄöËøá -XX:MaxDirectMemorySize ÊåáÂÆöÔºåÂ¶ÇÊûú‰∏çÊåáÂÆöÔºåÈªòËÆ§‰∏é Java Â†ÜÊúÄÂ§ßÂÄºÔºà-XmxÊåáÂÆöÔºâ‰∏ÄÊ†∑ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Java8 ÂÜÖÂ≠òÊ®°Âûã‚ÄîÊ∞∏‰πÖ‰ª£(PermGen)ÂíåÂÖÉÁ©∫Èó¥(Metaspace) Java 8 ÁöÑÂÖÉÁ©∫Èó¥ Java 8 ÁöÑÂÖÉÁ©∫Èó¥Ëã±ÊñáÂéüÊñá JAVA 8 Ôºö‰ªéÊ∞∏‰πÖÂå∫ÔºàPermGenÔºâÂà∞ÂÖÉÁ©∫Èó¥ÔºàMetaspaceÔºâ JavaËôöÊãüÊú∫Ôºà‰∏ÄÔºâÁªìÊûÑÂéüÁêÜ‰∏éËøêË°åÊó∂Êï∞ÊçÆÂå∫Âüü „ÄäÊ∑±ÂÖ•ÁêÜËß£ Java ËôöÊãüÊú∫(Á¨¨ 2 Áâà)„Äã Ëã•Êú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊèêÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ÈõÜÂêàÊ°ÜÊû∂‰πã ArrayList]]></title>
    <url>%2Fblog%2F2017%2F09%2F06%2FJava-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E4%B9%8BArrayList%2F</url>
    <content type="text"><![CDATA[Ê¶ÇË¶ÅArrayList ÊòØ‰∏Ä‰∏™Âä®ÊÄÅÊï∞ÁªÑÔºåÂÆÉÊòØÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑÔºåÂÖÅËÆ∏ÂÖÉÁ¥†‰∏∫ null„ÄÇÂÆÉÁöÑÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊï∞ÁªÑÔºåArrayList ÂÆûÁé∞‰∫Ü List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable Êé•Âè£ÔºåÂÖ∂‰∏≠ RandomAccess ‰ª£Ë°®‰∫ÜÂÖ∂Êã•ÊúâÈöèÊú∫Âø´ÈÄüËÆøÈóÆÁöÑËÉΩÂäõÔºåArrayList ÂèØ‰ª•‰ª• O(1) ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÂéªÊ†πÊçÆ‰∏ãÊ†áËÆøÈóÆÂÖÉÁ¥†„ÄÇ Êó∂Èó¥„ÄÅÁ©∫Èó¥ÊïàÁéáÂõ†‰∏∫Êï∞ÁªÑÂÜÖÂ≠òÁöÑËøûÁª≠ÔºåÂèØ‰ª•Ê†πÊçÆ‰∏ãÊ†á‰ª• O1 ÁöÑÊó∂Èó¥ÊîπÊü•ÂÖÉÁ¥†ÔºåÂõ†Ê≠§Êó∂Èó¥ÊïàÁéáÂæàÈ´ò ÂêåÊ†∑‰πüÂõ†‰∏∫Êï∞ÁªÑË¶ÅÂç†ÊçÆ‰∏ÄÂùóËøûÁª≠ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÊâÄ‰ª•ÂÆÉ‰πüÊúâÊï∞ÁªÑÁöÑÁº∫ÁÇπ‚Äî‚ÄîÁ©∫Èó¥ÊïàÁéá‰∏çÈ´ò„ÄÇ ÊÄßËÉΩÂΩìÈõÜÂêà‰∏≠ÁöÑÂÖÉÁ¥†Ë∂ÖÂá∫ÂÆπÈáèÊó∂Ôºå‰ºöËøõË°åÊâ©ÂÆπÊìç‰ΩúÔºåÊâ©ÂÆπÊìç‰ΩúÊòØ‰∏Ä‰∏™ÊÄßËÉΩÊ∂àËÄóËæÉÂ§ßÁöÑÂú∞ÊñπÔºåÊâÄ‰ª•Â¶ÇÊûúËÉΩÈ¢ÑÁü•Êï∞ÊçÆÁöÑËßÑÊ®°ÔºåÊúÄÂ•ΩÂú®ÂàùÂßãÂåñÊó∂ÈÄöËøá public ArrayList(int initialCapacity) ÊûÑÈÄ†ÊñπÊ≥ïÊåáÂÆö ArrayList ÁöÑÂ§ßÂ∞èÔºåÊù•ÊûÑÈÄ† ArrayList ÂÆû‰æãÔºå‰ª•ÂáèÂ∞ëÊâ©ÂÆπÊ¨°Êï∞ÔºåÊèêÈ´òÊïàÁéá„ÄÇ Âú®Ê∑ªÂä†Â§ßÈáèÂÖÉÁ¥†ÂâçÔºåÂ∫îÁî®Á®ãÂ∫è‰πüÂèØ‰ª•‰ΩøÁî® ensureCapacity Êìç‰ΩúÊù•Â¢ûÂä† ArrayList ÂÆû‰æãÁöÑÂÆπÈáèÔºåËøôÂèØ‰ª•ÂáèÂ∞ëÈÄíÂ¢ûÂºèÂÜçÂàÜÈÖçÁöÑÊï∞Èáè„ÄÇ ‰∏çËøáËØ•ÊñπÊ≥ïÊòØ ArrayList ‰∏≠Ê∑ªÂä†ÁöÑÔºåList ‰∏≠Ê≤°ÊúâËØ•ÊñπÊ≥ï„ÄÇÊâÄ‰ª•Â¶ÇÊûúÂ£∞ÊòéÁöÑÁ±ªÂûã‰∏∫ List ÁöÑËØùÔºåÈúÄË¶ÅËøõË°åÂº∫ËΩ¨„ÄÇ((ArrayList)list).ensureCapacity(number); ÂΩìÊØèÊ¨°‰øÆÊîπÁªìÊûÑÊó∂(Ê∑ªÂä†ÊàñËÄÖÂà†Èô§ÂÖÉÁ¥†)ÔºåÈÉΩ‰ºö‰øÆÊîπ modCount„ÄÇ ÊàêÂëòÂèòÈáè123456789101112131415private static final int DEFAULT_CAPACITY = 10;//ÈªòËÆ§ÂàùÂßãÂÆπÈáèprivate static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;//Á©∫ÂØπË±°Êï∞ÊçÆÔºåÁî®‰∫éÁ©∫ÂØπË±°ÔºåÂ¶ÇÊûúÊåáÂÆöÂàùÂßãÂÆπÈáè‰∏∫ 0 Â∞±ÁªôÂÖÉÁ¥†ÈôÑ‰∏Ä‰∏™Á©∫ÂØπË±°/** * Shared empty array instance used for default sized empty instances. We * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when * first element is added. */private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;//ÂÖ±‰∫´ÁöÑÁ©∫Êï∞ÁªÑÂØπË±°Ôºå‰ΩøÁî®ËØ•ÂØπË±°Áî®‰ª•Âå∫ÂàÜ EMPTY_ELEMENTDATAÔºå‰ªéËÄåÁü•ÈÅìÁ¨¨‰∏ÄÊ¨°Ê∑ªÂä†ÂÖÉÁ¥†Êó∂ÔºåÂ∫îËØ•ÂàùÂßãÂåñÁöÑÊï∞ÁªÑÈïøÂ∫¶„ÄÇtransient Object[] elementData; // ‰πãÊâÄ‰ª•‰∏çÂ£∞Êòé‰∏∫ private ÊòØ‰∏∫‰∫ÜÁÆÄÂåñÂÜÖÈÉ®Á±ªËÆøÈóÆÔºå// ÊâÄÊúâÂéüÊú¨‰∏∫ÈªòËÆ§ÂÆπÈáèÁöÑÁ©∫Êï∞ÁªÑÔºåÂú®Á¨¨‰∏ÄÊ¨°Ê∑ªÂä†ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÈÉΩ‰ºöË¢´ÂàùÂßãÂåñ‰∏∫ÈïøÂ∫¶‰∏∫ÈªòËÆ§ÂÆπÈáèÁöÑÊï∞ÁªÑprivate int size;//ÂåÖÂê´ÂÖÉÁ¥†ÁöÑÊï∞Èáè ÊûÑÈÄ†ÊñπÊ≥ïArrayList Êèê‰æõ‰∫Ü‰∏âÁßçÊñπÂºèÁöÑÊûÑÈÄ†Âô®ÔºåÂèØ‰ª•ÊûÑÈÄ†‰∏Ä‰∏™ÈªòËÆ§ÂàùÂßãÂÆπÈáè‰∏∫ 10 ÁöÑÁ©∫ÂàóË°®„ÄÅÊûÑÈÄ†‰∏Ä‰∏™ÊåáÂÆöÂàùÂßãÂÆπÈáèÁöÑÁ©∫ÂàóË°®‰ª•ÂèäÊûÑÈÄ†‰∏Ä‰∏™ÂåÖÂê´ÊåáÂÆö collection ÁöÑÂÖÉÁ¥†ÁöÑÂàóË°®ÔºåËøô‰∫õÂÖÉÁ¥†ÊåâÁÖßËØ• collection ÁöÑËø≠‰ª£Âô®ËøîÂõûÂÆÉ‰ª¨ÁöÑÈ°∫Â∫èÊéíÂàóÁöÑ„ÄÇ 123456789101112131415161718192021222324252627public ArrayList(int initialCapacity) &#123;//ÊåâÁÖßÊåáÂÆöÁöÑÂàùÂßãÂÆπÈáèÂàùÂßãÂåñ if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity];//ÂàõÂª∫Êï∞ÁªÑ &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA;//Â¶ÇÊûúÊåáÂÆöÂàùÂßãÂÆπÈáè‰∏∫ 0 Â∞±ÁªôÂÖÉÁ¥†ÈôÑ‰∏Ä‰∏™Á©∫ÂØπË±° &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: " + initialCapacity); &#125;&#125;public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;//ÂàùÂßãÂåñ‰∏Ä‰∏™ÂàùÂßãÂÆπÈáè‰∏∫ 10 ÁöÑ ArrayList&#125;//ÊûÑÈÄ†‰∏Ä‰∏™ÂåÖÂê´ÊåáÂÆö collection ÁöÑÂÖÉÁ¥†ÁöÑÂàóË°®ÔºåËøô‰∫õÂÖÉÁ¥†ÊåâÁÖßËØ• collection ÁöÑËø≠‰ª£Âô®ËøîÂõûÂÆÉ‰ª¨ÁöÑÈ°∫Â∫èÊéíÂàóÁöÑ„ÄÇpublic ArrayList(Collection&lt;? extends E&gt; c) &#123;//‰ªéÁªôÂÆöÁöÑÂÆπÂô®‰∏≠ÊûÑÂª∫‰∏Ä‰∏™ ArrayList elementData = c.toArray();//Â∞ÜÂÆπÂô®ÂØπË±°‰∏≠ÁöÑÂÖÉÁ¥†ËΩ¨Êç¢‰∏∫Êï∞ÁªÑ if ((size = elementData.length) != 0) &#123;//ÈïøÂ∫¶‰∏ç‰∏∫ 0ÔºåËøõË°åÂà§Êñ≠Êìç‰Ωú // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class);//Â¶ÇÊûúËøîÂõûÁöÑÊï∞ÁªÑ‰∏çÊòØ Object[].class Á±ªÂûãÁöÑÔºåÂàôËøõË°åÂ∞ÜÊï∞ÁªÑÂÖÉÁ¥†Â§çÂà∂Âà∞Á±ªÂûã‰∏∫ Object Êï∞ÁªÑ‰∏ä &#125; else &#123; // replace with empty array. this.elementData = EMPTY_ELEMENTDATA;//ÈïøÂ∫¶‰∏∫ 0ÔºåÂàôÂ∞ÜÁ©∫Êï∞ÁªÑÂØπË±°ËµãÂÄºÁªôÂÖÉÁ¥†Êï∞ÁªÑ &#125;&#125; ËøôÈáåË¶ÅÊ≥®ÊÑèÁöÑÊòØÁ¨¨‰∏â‰∏™ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂØπÊï∞ÁªÑÂÖÉÁ¥†Á±ªÂûãÁöÑÂà§Êñ≠ 12345if (elementData.getClass() != Object[].class)&#123; elementData = Arrays.copyOf(elementData, size, Object[].class);&#125; else&#123; //...&#125; ËôΩÁÑ∂Ë°®Èù¢‰∏äÁúãËµ∑Êù•Ôºåc.toArray() ‰ºöËøîÂõû‰∏Ä‰∏™ Object[] ÂØπË±°Êï∞ÁªÑÔºå‰ΩÜÊòØÂÆÉÊåáÂêëÁöÑÂÆûÈôÖÁ±ªÂûãÂπ∂‰∏ç‰∏ÄÂÆöÊòØ Object[]ÔºåËøôÊ†∑ÂΩìÊàë‰ª¨Ë∞ÉÁî® objList[i] = new Object(); Â∞±‰ºöÊä•Èîô „ÄÇ ÊØîÂ¶ÇËØ¥Â¶ÇÊûúÊàë‰ª¨Êúâ 1 ‰∏™ List stringList ÂØπË±°ÔºåÂΩìÊàë‰ª¨Ë∞ÉÁî®Object[] objectArray = stringList.toArray()ÁöÑÊó∂ÂÄôÔºå objectArray Âè™ËÉΩÂ≠òÊîæ String Á±ªÂûãÁöÑÊï∞ÊçÆËÄå‰∏çËÉΩÂ≠òÂÇ®ÂÖ∂‰ªñÁ±ªÂûãÁöÑÂØπË±°„ÄÇ Â¢û ArrayList Êèê‰æõ‰∫Ü add(E e)„ÄÅadd(int index, E element)„ÄÅaddAll(Collection&lt;? extends E&gt; c)„ÄÅaddAll(int index, Collection&lt;? extends E&gt; c)Ëøô‰∫õÊ∑ªÂä†ÂÖÉÁ¥†ÁöÑÊñπÊ≥ï„ÄÇ 1234567891011121314151617181920212223/** * Ê∑ªÂä†ÂÖÉÁ¥†Âà∞ÂàóË°®Â∞æÈÉ®„ÄÇ * ÂÖàÁ°ÆËÆ§ ArrayList ÁöÑÂÆπÈáè * ÊØèÊ¨° add ‰πãÂâçÔºåÈÉΩ‰ºöÂà§Êñ≠ add ÂêéÁöÑÂÆπÈáèÔºåÊòØÂê¶ÈúÄË¶ÅÊâ©ÂÆπ„ÄÇ * */public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! Á°Æ‰øùÂÆπÈáèË∂≥‰ª•ÂÆπÁ∫≥ÂéüÊúâÂÖÉÁ¥†Âä†‰∏äÊñ∞Â¢ûÁöÑÂÖÉÁ¥† elementData[size++] = e; return true;&#125;/** * Ê∑ªÂä†ÂÖÉÁ¥†Âà∞ÂàóË°®ÊåáÂÆö‰ΩçÁΩÆ„ÄÇÈúÄË¶ÅÂ∞ÜËØ•‰ΩçÁΩÆÂè≥Á´ØÁöÑÊâÄÊúâÂÖÉÁ¥†ÈÉΩÂæÄÂè≥ÁßªÂä®‰∏Ä‰∏™Âçï‰Ωç * ÂÖàÁ°ÆËÆ§ ArrayList ÁöÑÂÆπÈáè * */public void add(int index, E element) &#123; rangeCheckForAdd(index);//‰∏ä‰∏ãÁïåÂà§Êñ≠ ensureCapacityInternal(size + 1); // Increments modCount!! Âà§Êñ≠ add ‰πãÂêéÁöÑÂÆπÈáèÔºåÊ†πÊçÆÊÉÖÂÜµËøõË°åÊâ©ÂÆπ System.arraycopy(elementData, index, elementData, index + 1,// Â∞Ü index ~ size-1 ËåÉÂõ¥ÂÜÖÁöÑÂÖÉÁ¥†Â§çÂà∂Âà∞ index+1 ~ size ËåÉÂõ¥‰∏≠„ÄÇ‰πüÂ∞±ÊòØÂ∞Ü index ÂèäÂÖ∂‰ª•ÂêéÁöÑÂÖÉÁ¥†ÂêéÁßª‰∏Ä‰∏™‰ΩçÁΩÆ size - index); elementData[index] = element;//Â∞ÜÁªôÂÆöÂÖÉÁ¥†Ê∑ªÂä†Âà∞ÊåáÂÆöÂÖÉÁ¥†‰∏≠ size++;//ÂÖÉÁ¥†Êï∞Èáè + 1&#125; 12345678910111213141516171819202122232425262728293031/** * Ê∑ªÂä†ÁªôÂÆöÈõÜÂêà‰∏≠ÁöÑÊâÄÊúâÂÖÉÁ¥†Âà∞ ArrayList ‰∏≠ * */public boolean addAll(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray();//ÂÖàËΩ¨Êç¢‰∏∫Êï∞ÁªÑ int numNew = a.length;//Ë¶ÅÊ∑ªÂä†ÁöÑÂÖÉÁ¥†Êï∞Èáè ensureCapacityInternal(size + numNew); // Increments modCountÔºåÁ°Æ‰øùÂÆπÈáèË∂≥Â§üÂÆπÁ∫≥Êñ∞Ê∑ªÂä†ÁöÑÊâÄÊúâÂÖÉÁ¥† System.arraycopy(a, 0, elementData, size, numNew);//Â∞ÜÂÖÉÁ¥†Ê∑ªÂä†Âà∞ÂàóË°®Â∞æÈÉ® size += numNew; return numNew != 0;&#125;/** * ‰ªéÊåáÂÆöÁöÑ‰ΩçÁΩÆÂºÄÂßãÔºåÂ∞ÜÊåáÂÆö collection ‰∏≠ÁöÑÊâÄÊúâÂÖÉÁ¥†ÊèíÂÖ•Âà∞Ê≠§ÂàóË°®‰∏≠„ÄÇ * */public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; rangeCheckForAdd(index);//Ê£ÄÊü•‰∏ä‰∏ãÁïå Object[] a = c.toArray();//ËΩ¨Êç¢‰∏∫Êï∞ÁªÑ int numNew = a.length;//Â¢ûÂä†ÁöÑÊï∞Èáè ensureCapacityInternal(size + numNew); // Increments modCount int numMoved = size - index;//Ë¶ÅÁßªÂä®ÁöÑÂÖÉÁ¥†Êï∞ if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved);//ÁßªÂä®Êï∞ÁªÑ‰∏≠ÈúÄË¶ÅÁßªÂä®ÁöÑÂÖÉÁ¥† System.arraycopy(a, 0, elementData, index, numNew);//ÊèíÂÖ•ÂÖÉÁ¥† size += numNew; return numNew != 0;&#125; Âà†ArrayList Êèê‰æõ‰∫ÜÊ†πÊçÆ‰∏ãÊ†áÊàñËÄÖÊåáÂÆöÂØπË±°‰∏§ÁßçÊñπÂºèÁöÑÂà†Èô§ÂäüËÉΩ„ÄÇ 1234567891011121314151617/** * ÁßªÈô§ÊåáÂÆö‰ΩçÁΩÆÁöÑÂÖÉÁ¥† * */public E remove(int index) &#123; rangeCheck(index);//‰∏äÁïåÂà§Êñ≠ modCount++;//ÁªìÊûÑ‰øÆÊîπÊ¨°Êï∞ + 1 E oldValue = elementData(index); int numMoved = size - index - 1;//ÁßªÂä®ÁöÑÂÖÉÁ¥†ÊÄªÊï∞ if (numMoved &gt; 0) System.arraycopy(elementData, index + 1, elementData, index,// numMoved);//Â∞ÜË¶ÅÂà†Èô§ÁöÑÂÖÉÁ¥†ÁöÑÂêéÈù¢ÁöÑÊâÄÊúâÂÖÉÁ¥†ÂæÄÂâçÁßª‰∏Ä‰∏™Âçï‰Ωç elementData[--size] = null; // clear to let GC do its work Â∞ÜÊú´ÂÖÉÁ¥†ÁΩÆ‰∏∫ nullÔºå‰ª•ÂÖçÂÜÖÂ≠òÊ≥ÑÊºè return oldValue;//ËøîÂõûÂà†Èô§ÊéâÁöÑÂÄº&#125; 123456789101112131415161718192021/** * ÁßªÈô§Ê≠§ÂàóË°®‰∏≠È¶ñÊ¨°Âá∫Áé∞ÁöÑÊåáÂÆöÂÖÉÁ¥†ÔºàÂ¶ÇÊûúÂ≠òÂú®ÁöÑËØùÔºâ„ÄÇ * ÂÖàÊâæÂà∞ÊåáÂÆöÂÖÉÁ¥†Âú®Êï∞ÁªÑ‰∏≠ÁöÑ‰ΩçÁΩÆÔºåÁÑ∂ÂêéÂÜçË∞ÉÁî® fastRemove Âà†Èô§ * */public boolean remove(Object o) &#123; // Áî±‰∫é ArrayList ‰∏≠ÂÖÅËÆ∏Â≠òÊîæ nullÔºåÂõ†Ê≠§‰∏ãÈù¢ÈÄöËøá‰∏§ÁßçÊÉÖÂÜµÊù•ÂàÜÂà´Â§ÑÁêÜ„ÄÇ if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false;&#125; 12345678910111213141516/** * Âà†Èô§ [fromIndexÔºåtoIndex) ËåÉÂõ¥‰∏≠ÁöÑÊâÄÊúâÂÖÉÁ¥† * */protected void removeRange(int fromIndex, int toIndex) &#123; modCount++; int numMoved = size - toIndex; System.arraycopy(elementData, toIndex, elementData, fromIndex, numMoved); // clear to let GC do its work int newSize = size - (toIndex - fromIndex); for (int i = newSize; i &lt; size; i++) &#123; elementData[i] = null; &#125; size = newSize;&#125; 1234567/** * ÁßªÈô§ ArrayList ‰∏≠ÁªôÂÆöÊåáÂÆöÈõÜÂêà‰∏≠ÁöÑÊâÄÊúâÂÖÉÁ¥†„ÄÇ * */public boolean removeAll(Collection&lt;?&gt; c) &#123; Objects.requireNonNull(c); return batchRemove(c, false);&#125; 123456789101112131415161718192021222324252627282930313233343536/** * ÊâπÈáèÂà†Èô§ * complement ‰∏∫ false Êó∂ÔºåÂà†Èô§ÊåáÂÆöÈõÜÂêà c ‰∏≠ÊâÄÊúâÁöÑÂÖÉÁ¥†„ÄÇ * complement ‰∏∫ true Êó∂ÔºåÂà†Èô§ÊåáÂÆöÈõÜÂêà c ‰∏≠‰ª•Â§ñÁöÑÊâÄÊúâÁöÑÂÖÉÁ¥†„ÄÇ * */private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123;// complement ‰∏∫ true Êó∂‰∏∫Ë°•ÈõÜ final Object[] elementData = this.elementData;//Â∞ÜÊï∞ÁªÑÂºïÁî®ËµãÁªô elementdata,ËäÇÁúÅÁ©∫Èó¥ int r = 0, w = 0; boolean modified = false; try &#123; //ÈÅçÂéÜÔºåÊääË¶Å‰øùÂ≠òÁöÑÂÖÉÁ¥†Â≠òÂú®ÂâçÈù¢ for (; r &lt; size; r++) if (c.contains(elementData[r]) == complement)//Â≠òÂÇ®Ë¶Å‰øùÁïôÁöÑÂÖÉÁ¥†„ÄÇÈõÜÂêà c ‰∏≠ÊòØÂê¶ÂåÖÊã¨ËØ•ÂÖÉÁ¥† == Âà†Èô§Ë°•ÈõÜÔºü elementData[w++] = elementData[r]; &#125; finally &#123; // Preserve behavioral compatibility with AbstractCollection, // even if c.contains() throws. if (r != size) &#123;// Ê≠§ÊÆµ‰ª£Á†Å‰ΩúÁî®‰∏∫ÔºöÂΩì c.contains ÊäõÂá∫ÂºÇÂ∏∏Êó∂ÔºàÊ≠§Êó∂ r &lt; size ÔºâÔºå‰øùÊåÅ‰∏é AbstractCollection ÁöÑË°å‰∏∫ÂÖºÂÆπÊÄß System.arraycopy(elementData, r, elementData, w, size - r);//Â∞ÜÂêéÈù¢ÁöÑÂÖÉÁ¥†ÁßªÂä®Âà∞ w ÂêéÈù¢ w += size - r;//Âä†‰∏äÁßªÂä®ÁöÑÂÖÉÁ¥†Êï∞ÔºåËé∑Âèñ„ÄåÊúÄÂêéÁöÑÂÖÉÁ¥†„ÄçÁöÑ‰∏ãÊ†á &#125; if (w != size) &#123;//Ê∏ÖÈô§ÂºïÁî®ÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºè // clear to let GC do its work for (int i = w; i &lt; size; i++)//Â∞Ü w ‰πãÂêéÁöÑÂÖÉÁ¥†ÈÉΩÁΩÆ‰∏∫ null elementData[i] = null; modCount += size - w; size = w; modified = true; &#125; &#125; return modified;&#125; ÊÄßËÉΩÊ≥®ÊÑèÔºö‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§ÂÖÉÁ¥†ÁöÑÊìç‰ΩúÔºå‰πü‰ºöÂØºËá¥Ë¢´ÁßªÈô§ÁöÑÂÖÉÁ¥†‰ª•ÂêéÁöÑÊâÄÊúâÂÖÉÁ¥†ÁöÑÂêëÂ∑¶ÁßªÂä®‰∏Ä‰∏™‰ΩçÁΩÆ„ÄÇ Êü•/Ëé∑Âèñ Ëé∑ÂèñÊ≠§ÂàóË°®‰∏≠ÊåáÂÆö‰ΩçÁΩÆ‰∏äÁöÑÂÖÉÁ¥†„ÄÇ 12345public E get(int index) &#123; rangeCheck(index); checkForComodification(); return java.util.ArrayList.this.elementData(offset + index);&#125; Â∞èÁªì„ÄÅÂØπÊØîÊîπ1234567public E set(int index, E e) &#123; rangeCheck(index); checkForComodification(); E oldValue = java.util.ArrayList.this.elementData(offset + index); java.util.ArrayList.this.elementData[offset + index] = e; return oldValue;&#125; ÂØπÊØîË∞ÉÊï¥Êï∞ÁªÑÂÆπÈáèÊâ©ÂÆπ123456789101112131415161718192021222324252627282930313233343536public void ensureCapacity(int minCapacity) &#123; int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // any size if not default element table ? 0 // larger than default for default empty table. It's already // supposed to be at default size. : DEFAULT_CAPACITY; if (minCapacity &gt; minExpand) &#123; ensureExplicitCapacity(minCapacity); &#125;&#125;/** * ÂÜÖÈÉ®‰øùËØÅÂÆπÈáèÔºåÂ¶ÇÊûú ArrayList ÊòØÈÄöËøáÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞ÂàõÂª∫ÁöÑÔºå * ÈÇ£‰πàÁ¨¨‰∏ÄÊ¨° add ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÂ∞±‰ºöË∞ÉÁî®ËØ•ÊñπÊ≥ïÊâ©ÂÆπ * */private void ensureCapacityInternal(int minCapacity) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; ensureExplicitCapacity(minCapacity);&#125;/** * Á°Æ‰øùÂàÜÈÖçÊåáÂÆöÁöÑÂÆπÈáè * */private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; // overflow-conscious code //Â¶ÇÊûúÊåáÊòéÁöÑÊúÄÂ∞èÂÆπÈáèË∂ÖËøáÊï∞ÁªÑÁöÑÈïøÂ∫¶ÔºåÂ∞±Â¢ûÂ§ßÂÆπÈáè if (minCapacity - elementData.length &gt; 0) grow(minCapacity);&#125; ÊØèÊ¨°Êï∞ÁªÑÂÆπÈáèÁöÑÂ¢ûÈïøÂ§ßÁ∫¶ÊòØÂÖ∂ÂéüÂÆπÈáèÁöÑ 1.5 ÂÄç„ÄÇËøôÁßçÊìç‰ΩúÁöÑ‰ª£‰ª∑ÊòØÂæàÈ´òÁöÑÔºåÂõ†Ê≠§Âú®ÂÆûÈôÖ‰ΩøÁî®Êó∂ÔºåÊàë‰ª¨Â∫îËØ•Â∞ΩÈáèÈÅøÂÖçÊï∞ÁªÑÂÆπÈáèÁöÑÊâ©Âº†„ÄÇÂΩìÊàë‰ª¨ÂèØÈ¢ÑÁü•Ë¶Å‰øùÂ≠òÁöÑÂÖÉÁ¥†ÁöÑÂ§öÂ∞ëÊó∂ÔºåË¶ÅÂú®ÊûÑÈÄ† ArrayList ÂÆû‰æãÊó∂ÔºåÂ∞±ÊåáÂÆöÂÖ∂ÂÆπÈáèÔºå‰ª•ÈÅøÂÖçÊï∞ÁªÑÊâ©ÂÆπÁöÑÂèëÁîü„ÄÇÊàñËÄÖÊ†πÊçÆÂÆûÈôÖÈúÄÊ±ÇÔºåÈÄöËøáË∞ÉÁî® ensureCapacity ÊñπÊ≥ïÊù•ÊâãÂä®Â¢ûÂä† ArrayList ÂÆû‰æãÁöÑÂÆπÈáè„ÄÇ „ÄåÂéãÁº©„Äç ArrayList ËøòÁªôÊàë‰ª¨Êèê‰æõ‰∫ÜÂ∞ÜÂ∫ïÂ±ÇÊï∞ÁªÑÁöÑÂÆπÈáèË∞ÉÊï¥‰∏∫ÂΩìÂâçÂàóË°®‰øùÂ≠òÁöÑÂÆûÈôÖÂÖÉÁ¥†ÁöÑÂ§ßÂ∞èÁöÑÂäüËÉΩ„ÄÇÂÆÉÂèØ‰ª•ÈÄöËøá trimToSize ÊñπÊ≥ïÊù•ÂÆûÁé∞„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö 12345678910//Â∞Ü ArrayList ÁöÑÂÆπÈáèÂéãÁº©Âà∞ÂΩìÂâçÂÖÉÁ¥†Êï∞ÈáèÔºåËøôÊ†∑ÂèØ‰ª•ÊúÄÂ§ßÈôêÂ∫¶ËäÇÁúÅÁ©∫Èó¥public void trimToSize() &#123; modCount++;//ÂÆö‰πâ‰∏éÁà∂Á±ª AbstractList ‰∏≠ÔºåËÆ∞ÂΩïÂèëÁîüÁªìÊûÑÂåñ‰øÆÊîπÁöÑÊ¨°Êï∞„ÄÇÂ¶ÇÊûú‰∏çÊâìÁÆóÊèê‰æõ„ÄåÂø´ÈÄüÂ§±Ë¥•ÁöÑËø≠‰ª£Âô®„ÄçÔºåÂèØÂøΩÁï•Ê≠§Âüü if (size &lt; elementData.length) &#123; elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); &#125;&#125; Fail-Fast Êú∫Âà∂ArrayList ‰πüÈááÁî®‰∫ÜÂø´ÈÄüÂ§±Ë¥•ÁöÑÊú∫Âà∂ÔºåÈÄöËøáËÆ∞ÂΩï modCount ÂèÇÊï∞Êù•ÂÆûÁé∞„ÄÇÂú®Èù¢ÂØπÂπ∂ÂèëÁöÑ‰øÆÊîπÊó∂ÔºåËø≠‰ª£Âô®ÂæàÂø´Â∞±‰ºöÂÆåÂÖ®Â§±Ë¥•ÔºåËÄå‰∏çÊòØÂÜíÁùÄÂú®Â∞ÜÊù•Êüê‰∏™‰∏çÁ°ÆÂÆöÊó∂Èó¥ÂèëÁîü‰ªªÊÑè‰∏çÁ°ÆÂÆöË°å‰∏∫ÁöÑÈ£éÈô©„ÄÇÂÖ∑‰Ωì‰ªãÁªçËØ∑ÂèÇËÄÉÊàë‰πãÂâçÁöÑÊñáÁ´†Ê∑±ÂÖ• Java ÈõÜÂêàÂ≠¶‰π†Á≥ªÂàóÔºöHashMap ÁöÑÂÆûÁé∞ÂéüÁêÜ ‰∏≠ÁöÑ Fail-Fast Êú∫Âà∂„ÄÇ Âø´ÈÄüÂ§±Ë¥•ÔºöÂΩì‰Ω†Âú®Ëø≠‰ª£‰∏Ä‰∏™ÈõÜÂêàÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÊúâÂè¶‰∏Ä‰∏™Á∫øÁ®ãÊ≠£Âú®‰øÆÊîπ‰Ω†Ê≠£Âú®ËÆøÈóÆÁöÑÈÇ£‰∏™ÈõÜÂêàÊó∂ÔºåÂ∞±‰ºöÊäõÂá∫‰∏Ä‰∏™ ConcurrentModification ÂºÇÂ∏∏„ÄÇ Âú® java.util ÂåÖ‰∏ãÁöÑÈÉΩÊòØÂø´ÈÄüÂ§±Ë¥•„ÄÇ ÂÆâÂÖ®Â§±Ë¥•Ôºö‰Ω†Âú®Ëø≠‰ª£ÁöÑÊó∂ÂÄô‰ºöÂéªÂ∫ïÂ±ÇÈõÜÂêàÂÅö‰∏Ä‰∏™Êã∑Ë¥ùÔºåÊâÄ‰ª•‰Ω†Âú®‰øÆÊîπ‰∏äÂ±ÇÈõÜÂêàÁöÑÊó∂ÂÄôÊòØ‰∏ç‰ºöÂèóÂΩ±ÂìçÁöÑÔºå‰∏ç‰ºöÊäõÂá∫ ConcurrentModification ÂºÇÂ∏∏„ÄÇ Âú® java.util.concurrent ÂåÖ‰∏ãÁöÑÂÖ®ÊòØÂÆâÂÖ®Â§±Ë¥•ÁöÑ„ÄÇ Âç≥ ÊäõÂºÇÂ∏∏ÊòØÂø´ÈÄüÂ§±Ë¥•Ôºàutil ÂåÖ‰∏ãÈÉΩÊòØÂø´ÈÄüÂ§±Ë¥•ÔºâÔºå‰∏çÊäõÂºÇÂ∏∏ÊòØÂÆâÂÖ®Â§±Ë¥•„ÄÇ Java ÁâàÊú¨Ë∂äÂæÄÂêéË∂ä„ÄåÂÆâÂÖ®„ÄçÔºåconcurrent ÂåÖ‰∏ãÈù¢ÂÖ®ÈÉ®‰∏∫ÂÆâÂÖ®Â§±Ë¥• ÊÄªÁªìÂèØ‰ª•ÁúãÂà∞Ê†∏ÂøÉÊìç‰ΩúÂú®‰∫éÂ¢ûÂä†ÂíåÂà†Èô§ÂÖÉÁ¥†„ÄÇ Â¢ûÂà†ÊîπÊü•‰∏≠Ôºå Â¢ûÂØºËá¥Êâ©ÂÆπÔºåÂàô‰ºö‰øÆÊîπ modCountÔºåÂà†‰∏ÄÂÆö‰ºö‰øÆÊîπ„ÄÇ ÊîπÂíåÊü•‰∏ÄÂÆö‰∏ç‰ºö‰øÆÊîπ modCount„ÄÇ Êâ©ÂÆπÊìç‰Ωú‰ºöÂØºËá¥Êï∞ÁªÑÂ§çÂà∂ÔºåÊâπÈáèÂà†Èô§‰ºöÂØºËá¥ÊâæÂá∫‰∏§‰∏™ÈõÜÂêàÁöÑ‰∫§ÈõÜÔºå‰ª•ÂèäÊï∞ÁªÑÂ§çÂà∂Êìç‰ΩúÔºåÂõ†Ê≠§ÔºåÂ¢û„ÄÅÂà†ÈÉΩÁõ∏ÂØπ‰ΩéÊïà„ÄÇ ËÄå Êîπ„ÄÅÊü•ÈÉΩÊòØÂæàÈ´òÊïàÁöÑÊìç‰Ωú„ÄÇ Âõ†Ê≠§ÔºåÁªìÂêàÁâπÁÇπÔºåÂú®‰ΩøÁî®‰∏≠Ôºå‰ª• Android ‰∏≠ÊúÄÂ∏∏Áî®ÁöÑÂ±ïÁ§∫ÂàóË°®‰∏∫‰æãÔºåÂàóË°®ÊªëÂä®Êó∂ÈúÄË¶ÅÂ±ïÁ§∫ÊØè‰∏Ä‰∏™ ItemÔºàelementÔºâÁöÑÊï∞ÁªÑÔºåÊâÄ‰ª• Êü• Êìç‰ΩúÊòØÊúÄÈ´òÈ¢ëÁöÑ„ÄÇÁõ∏ÂØπÊù•ËØ¥ÔºåÂ¢ûÊìç‰ΩúÂè™ÊúâÂú®ÂàóË°®Âä†ËΩΩÊõ¥Â§öÊó∂Êâç‰ºöÁî®Âà∞ ÔºåËÄå‰∏îÊòØÂú®ÂàóË°®Â∞æÈÉ®ÊèíÂÖ•ÔºåÊâÄ‰ª•‰πü‰∏çÈúÄË¶ÅÁßªÂä®Êï∞ÊçÆÁöÑÊìç‰Ωú„ÄÇËÄåÂà†Êìç‰ΩúÂàôÊõ¥‰ΩéÈ¢ë„ÄÇ ÊïÖÈÄâÁî® ArrayList ‰Ωú‰∏∫‰øùÂ≠òÊï∞ÊçÆÁöÑÁªìÊûÑ„ÄÇ ÂíåVectorÁöÑÂå∫Âà´ÔºåVectorÂÜÖÈÉ®‰πüÊòØÊï∞ÁªÑÂÆûÁé∞ÁöÑÔºåÂå∫Âà´Âú®‰∫éVectorÂú® API ‰∏äÈÉΩÂä†‰∫ÜsynchronizedÊâÄ‰ª•ÂÆÉÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºå‰ª•ÂèäVectorÊâ©ÂÆπÊó∂ÔºåÊòØÁøªÂÄç sizeÔºåËÄåArrayList`ÊòØÊâ©ÂÆπ 50%„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Èù¢ËØïÂøÖÂ§áÔºöArrayList Ê∫êÁ†ÅËß£ÊûêÔºàJDK8Ôºâ Ê∑±ÂÖ• Java ÈõÜÂêàÂ≠¶‰π†Á≥ªÂàóÔºöArrayList ÁöÑÂÆûÁé∞ÂéüÁêÜ Java ArrayList Â∑•‰ΩúÂéüÁêÜÂèäÂÆûÁé∞ Ëã•Êú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊèêÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>javaÈõÜÂêàÊ°ÜÊû∂</category>
        <category>ÂéüÁêÜÂàÜÊûê</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>javaÈõÜÂêàÊ°ÜÊû∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Ê∫êÁ†Å‰∏≠ÁöÑË£ÖÈ•∞ËÄÖÊ®°Âºè]]></title>
    <url>%2Fblog%2F2017%2F09%2F05%2FAndroid-%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Ë£ÖÈ•∞ËÄÖÊ®°ÂºèÁöÑÂÆö‰πâË£ÖÈ•∞Ê®°ÂºèÔºàDecorator PatternÔºâ ‰πüÁß∞ÂåÖË£ÖÊ®°ÂºèÔºàWrapper PatternÔºâÔºåÊòØÁªìÊûÑÂûãËÆæËÆ°Ê®°Âºè‰πã‰∏ÄÔºå‰ΩøÁî®‰∏ÄÁßçÂØπÂÆ¢Êà∑Á´ØÈÄèÊòéÁöÑÊñπÂºèÊù•Âä®ÊÄÅÂú∞ÊãìÂ±ïÂØπË±°ÁöÑÂäüËÉΩÔºåÂêåÊó∂ÂÆÉ‰πüÊòØÁªßÊâøÂÖ≥Á≥ªÁöÑ‰∏ÄÁßçÊõø‰ª£ÊñπÊ°à‰πã‰∏Ä„ÄÇ ÈÄöËøáË£ÖÈ•∞ËÄÖÊ®°ÂºèÂèØ‰ª•Âä®ÊÄÅÂú∞Áªô‰∏Ä‰∏™ÂØπË±°Ê∑ªÂä†‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑËÅåË¥£„ÄÇÂ∞±Â¢ûÂä†ÂäüËÉΩËÄåË®ÄÔºåË£ÖÈ•∞Ê®°ÂºèÁõ∏ÊØîÁîüÊàêÂ≠êÁ±ªÊõ¥ÁÅµÊ¥ª„ÄÇÂõ†‰∏∫ÂÆÉË£ÖÈ•∞ËÄÖÊåÅÊúâ‰∏Ä‰∏™Ë¢´Ë£ÖÈ•∞ËÄÖÁöÑÂºïÁî®ÔºåÂõ†Ê≠§ÂèØ‰ª•Êñπ‰æøÂú∞Ë∞ÉÁî®ÂÖ∑‰ΩìË¢´Ë£ÖÈ•∞ËÄÖÂØπË±°‰∏≠ÁöÑÊñπÊ≥ïÔºåÂõ†Ê≠§ÂèØ‰ª•Âú®‰∏çÁ†¥ÂùèÂéüÁ±ªÂ±ÇÊ¨°ÁªìÊûÑÁöÑÊÉÖÂÜµ‰∏ã‰∏∫Á±ªÂ¢ûÂä†‰∏Ä‰∫õÂäüËÉΩÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂú®Ë¢´Ë£ÖÈ•∞ËÄÖÂØπË±°ÁöÑÁõ∏Â∫îÊñπÊ≥ïÂâçÂêéÂ¢ûÂä†Áõ∏Â∫îÁöÑÂäüËÉΩÈÄªËæëÂç≥ÂèØ„ÄÇ ‰ΩøÁî®Âú∫ÊôØÈúÄË¶ÅÈÄèÊòé‰∏îÂä®ÊÄÅÂú∞ÊãìÂ±ïÁ±ªÁöÑÂäüËÉΩÊó∂„ÄÇ UML Á±ªÂõæ Component ÊäΩË±°ÁªÑ‰ª∂ ÂèØ‰ª•ÊòØÊé•Âè£ÊàñËÄÖÊäΩË±°Á±ªÔºåÂÖÖÂΩì‰∏Ä‰∏™Ë¢´Ë£ÖÈ•∞ÁöÑÂéüÂßãÂØπË±°„ÄÇÔºàÂú®ËØ•Ê®°Âºè‰∏≠‰Ωç‰∫éÁªßÊâøÁªìÊûÑÁöÑÈ°∂ÈÉ®ÔºåÂ§ßÂÆ∂ÈÉΩÁõ¥Êé•/Èó¥Êé•Âú∞ÁªßÊâøÂÆÉÔºâ ConcreteComponent ÁªÑ‰ª∂ÂÖ∑‰ΩìÂÆûÁé∞Á±ª ËØ•Á±ªÊòØ Component Á±ªÁöÑÂÖ∑‰ΩìÂÆûÁé∞Ôºå‰πüÊòØÊàë‰ª¨Ë£ÖÈ•∞ÁöÑÂÖ∑‰ΩìÂØπË±°„ÄÇ Decorator ÊäΩË±°Ë£ÖÈ•∞ËÄÖ ÁªßÊâøËá™ Component Âπ∂‰∏îÂøÖÈ°ªÊåÅÊúâ‰∏Ä‰∏™ÊåáÂêë Component ÁöÑÂºïÁî® ÈÄöÂ∏∏‰ºöÂú®ÂÖ∂ÊñπÊ≥ï‰∏≠Ë∞ÉÁî® ConcreteComponent ÁöÑÊñπÊ≥ï„ÄÇ Â¶ÇÊûúË£ÖÈ•∞ÈÄªËæëÂçï‰∏ÄÔºåÂèØ‰ª•Áõ¥Êé•ÁúÅÁï•ËØ•Á±ªÔºåÁõ¥Êé•ÂÜô‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑË£ÖÈ•∞ËÄÖÂØπË±°Âç≥ÂèØ„ÄÇ ConcreteDecoratorA,B,C ÁªßÊâøËá™ DecorationÔºå Âú®Áà∂Á±ªÂØπ Component ÁöÑÊñπÊ≥ïË∞ÉÁî®Âü∫Á°Ä‰∏ä‰∏äÔºåÂ¢ûÂä†Ëá™Â∑±ÁöÑ‰∏Ä‰∫õÂäüËÉΩ„ÄÇÔºàÈÄöÂ∏∏ÈÉΩÊòØÂú®Âü∫Á°ÄÊñπÊ≥ïÊâßË°åÂâçÊàñËÄÖÂêéË∞ÉÁî®Ëá™Â∑±Êñ∞Â¢ûÁöÑÊñπÊ≥ïÔºâ ‰ΩøÁî®Êó∂ÁªèÂ∏∏‰ºöÊää ComponentImpl ÊàñËÄÖËØ¥ ConcreteComponent ‰º†ÂÖ•ÁªôÂÖ∑‰ΩìÁöÑ Decorator„ÄÇ 123Compoent component = new ConponentImpl();DecoratorImpl decoratorImpl = new DecoratorImpl(component);decoratorImpl.xxOperation(); Android Ê∫êÁ†Å‰∏≠ÁöÑÊ®°ÂºèÂÆûÁé∞ ËßíËâ≤ÁÆÄ‰ªãÔºö Context ÔºöÊäΩË±°ÁªÑ‰ª∂ ComtextImpl ÔºöContext ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Á±ª ContextWrapper ÔºöË£ÖÈ•∞ËÄÖÁöÑÁà∂Á±ªÔºàÂÖ∂‰∏≠ÁöÑÊâÄÊúâÊñπÊ≥ïÈÉΩÂè™ÊòØË∞ÉÁî®‰∫Ü ContextImpl ‰∏≠ÂØπÂ∫îÁöÑÊñπÊ≥ïÔºâ ContextThemeWrapper ÔºöÁªßÊâøËá™ ContextWrapper ÁöÑË£ÖÈ•∞ËÄÖ Activity ÔºöÁªßÊâøËá™ ContextThemeWrapper ÁöÑË£ÖÈ•∞ËÄÖ Êàë‰ª¨‰ª•Â∏∏Áî®ÁöÑÊñπÊ≥ï‰∏∫‰æãÔºåÁúãÁúãË£ÖÈ•∞ËÄÖÊ®°ÂºèÂú®ÂÖ∂‰∏≠ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊñπÂºè 123456789101112131415161718192021222324252627public class ContextWrapper extends Context &#123; Context mBase; public ContextWrapper(Context base) &#123; mBase = base; &#125; //ÂêØÂä® Activity @Override public void startActivity(Intent intent, Bundle options) &#123; mBase.startActivity(intent, options); &#125; //ÂèëÈÄÅÂπøÊí≠ @SystemApi @Override public void sendBroadcast(Intent intent, String receiverPermission, Bundle options) &#123; mBase.sendBroadcast(intent, receiverPermission, options); &#125; //Ê≥®ÂÜåÁõëÂê¨Âô® @Override public Intent registerReceiver( BroadcastReceiver receiver, IntentFilter filter) &#123; return mBase.registerReceiver(receiver, filter); &#125;&#125; ‰ªé‰ª•‰∏äÁöÑ‰ª£Á†Å‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåContextWrapper ‰Ωú‰∏∫Ë£ÖÈ•∞ËÄÖÁöÑÁà∂Á±ªÔºåÊåÅÊúâ Context ÁöÑÂºïÁî® mBaseÔºàmBase ÁöÑÂÆûÈôÖÁ±ªÂûã‰∏∫ ContextImplÔºâÔºåÂÖ∂‰∏≠ÁöÑÊâÄÊúâÊñπÊ≥ïÈÉΩÂè™ÊòØË∞ÉÁî®‰∫Ü ContextImpl ‰∏≠ÂØπÂ∫îÁöÑÊñπÊ≥ï„ÄÇ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485class ContextImpl extends Context &#123; //ÂêØÂä® Activity ÁöÑÈÄªËæëÂÆûÁé∞ @Override public void startActivity(Intent intent) &#123; warnIfCallingFromSystemProcess(); startActivity(intent, null); &#125; @Override public void startActivity(Intent intent, Bundle options) &#123; warnIfCallingFromSystemProcess(); // ‰ª£Á†ÅÁúÅÁï• //Ë∞ÉÁî® Instrumentation.execStartActivity() ÊñπÊ≥ï mMainThread.getInstrumentation().execStartActivity( getOuterContext(), mMainThread.getApplicationThread(), null, (Activity) null, intent, -1, options); &#125; @Override public void sendBroadcast(Intent intent, String receiverPermission) &#123; warnIfCallingFromSystemProcess(); String resolvedType = intent.resolveTypeIfNeeded(getContentResolver()); String[] receiverPermissions = receiverPermission == null ? null : new String[] &#123;receiverPermission&#125;; try &#123; intent.prepareToLeaveProcess(this); //Ë∞ÉÁî® AMS ÁöÑ broadcastIntent ÊñπÊ≥ï ActivityManagerNative.getDefault().broadcastIntent( mMainThread.getApplicationThread(), intent, resolvedType, null, Activity.RESULT_OK, null, null, receiverPermissions, AppOpsManager.OP_NONE, null, false, false, getUserId()); &#125; catch (RemoteException e) &#123; throw e.rethrowFromSystemServer(); &#125; &#125; //Ê≥®ÂÜåÂπøÊí≠ÁöÑÊñπÊ≥ï public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter) &#123; return registerReceiver(receiver, filter, null, null); &#125; //Ê≥®ÂÜåÂπøÊí≠ @Override public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter, String broadcastPermission, Handler scheduler) &#123; return registerReceiverInternal(receiver, getUserId(), filter, broadcastPermission, scheduler, getOuterContext()); &#125; //Ê≥®ÂÜåÂπøÊí≠ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ private Intent registerReceiverInternal(BroadcastReceiver receiver, int userId, IntentFilter filter, String broadcastPermission, Handler scheduler, Context context) &#123; IIntentReceiver rd = null; if (receiver != null) &#123; if (mPackageInfo != null &amp;&amp; context != null) &#123; if (scheduler == null) &#123; scheduler = mMainThread.getHandler(); &#125; rd = mPackageInfo.getReceiverDispatcher( receiver, context, scheduler, mMainThread.getInstrumentation(), true); &#125; else &#123; if (scheduler == null) &#123; scheduler = mMainThread.getHandler(); &#125; rd = new LoadedApk.ReceiverDispatcher( receiver, context, scheduler, null, true).getIIntentReceiver(); &#125; &#125; try &#123; //Ë∞ÉÁî® AMS ÁöÑ registerReceiver ÊñπÊ≥ï final Intent intent = ActivityManagerNative.getDefault().registerReceiver( mMainThread.getApplicationThread(), mBasePackageName, rd, filter, broadcastPermission, userId); if (intent != null) &#123; intent.setExtrasClassLoader(getClassLoader()); intent.prepareToEnterProcess(); &#125; return intent; &#125; catch (RemoteException e) &#123; throw e.rethrowFromSystemServer(); &#125; &#125; &#125; ÂèØ‰ª•ÁúãÂà∞ÔºåContextImpl ‰∏≠Êèê‰æõ‰∫ÜÂÖ∑‰ΩìÁöÑÊñπÊ≥ïÂÆûÁé∞„ÄÇ ContextWrapper ÁöÑÂ≠êÁ±ªÔºå‰æãÂ¶Ç Activity ‰ºöÊ†πÊçÆÈúÄË¶ÅÂØπÂÖ∑‰ΩìÊñπÊ≥ïÁöÑÂÆûÁé∞ËøõË°åË£ÖÈ•∞ÊàñËÄÖ‰øÆÊîπ„ÄÇ ÊØîÂ¶Ç startActivity() ÊñπÊ≥ïÔºåActivity Ê≤°Êúâ‰ΩøÁî®Ë¢´Ë£ÖÈ•∞ËÄÖÁöÑÂÆûÁé∞ÔºåËÄåÊòØËá™Â∑±ÂÆûÁé∞‰∫Ü‰∏ÄÂ•óÈÄªËæë„ÄÇ 123456789101112131415161718192021222324252627282930313233public class Activity extends ContextThemeWrapper implements LayoutInflater.Factory2, Window.Callback, KeyEvent.Callback, OnCreateContextMenuListener, ComponentCallbacks2, Window.OnWindowDismissedCallback, WindowControllerCallback &#123; @Override public void startActivity(Intent intent) &#123; this.startActivity(intent, null); &#125; @Override public void startActivity(Intent intent, @Nullable Bundle options) &#123; if (options != null) &#123; startActivityForResult(intent, -1, options); &#125; else &#123; // Note we want to go through this call for compatibility with // applications that may have overridden the method. startActivityForResult(intent, -1); &#125; &#125; public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,@Nullable Bundle options) &#123; if (mParent == null) &#123; options = transferSpringboardActivityOptions(options); //Ë∞ÉÁî® Instrumentation.execStartActivity() ÊñπÊ≥ï Instrumentation.ActivityResult ar = mInstrumentation.execStartActivity( this, mMainThread.getApplicationThread(), mToken, this, intent, requestCode, options); //‰ª£Á†ÅÁúÅÁï• &#125;&#125; ContextImpl ÁöÑÂàõÂª∫‰ªé‰∏äÈù¢Ëß£Êûê‰∏≠Êàë‰ª¨Áü•ÈÅì Context ÁöÑÂÆûÁé∞‰∏≠‰ΩøÁî®‰∫ÜË£ÖÈ•∞ËÄÖÊ®°Âºè‰πüÁü•ÈÅì‰∫Ü ContextImpl ÊòØ Context ÂÖ∑‰ΩìÂÆûÁé∞Á±ªÔºå‰ΩÜÊòØ ContextImpl ÊòØÂú®‰∏äÈù¢Âú∞ÊñπË¢´ÂàùÂßãÂåñÁöÑÂë¢Ôºü Âõ†‰∏∫ Activity ÂêØÂä®‰πãÂêéÊàë‰ª¨‰æøÂèØ‰ª•Ë∞ÉÁî® Context ‰∏≠ÁöÑÊñπÊ≥ï‰∫ÜÔºåÊàë‰ª¨ÁåúÊÉ≥ ContextImpl ÊòØÂú® Activity ÂàõÂª∫ËøáÁ®ã‰∏≠ÂàùÂßãÂåñÁöÑ„ÄÇ ÂØπ Android Framework Â±ÇÊúâÊâÄ‰∫ÜËß£ÂêåÂ≠¶Â∫îËØ•Áü•ÈÅì Activity ÊòØÁî± AMS ÁÆ°ÁêÜÁöÑÔºåAMS ‰ºöÈÄöËøáË∞ÉÁî® ApplicationThread ‰∏éÈó¥Êé•Âú∞ÊéßÂà∂ Activity„ÄÇ ApplicationThread ÁöÑ scheduleXxx ÊñπÊ≥ï‰∏≠‰ºöË∞ÉÁî® sendMessage ÊñπÊ≥ïÂ∞ÜÁõ∏Â∫îÁöÑ Message ÂèëÈÄÅÁªô HÔºåH Ê†πÊçÆ‰∏çÂêåÁöÑ Message Ë∞ÉÁî® ActivityThread ‰∏≠Áõ∏Â∫îÁöÑ handleXxx ÊñπÊ≥ï„ÄÇ ActivityThread#H 12345678910111213141516private class H extends Handler &#123; //‰ª£Á†ÅÁúÅÁï• public void handleMessage(Message msg) &#123; //‰ª£Á†ÅÁúÅÁï• switch (msg.what) &#123; case LAUNCH_ACTIVITY: &#123; Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "activityStart"); final ActivityClientRecord r = (ActivityClientRecord) msg.obj; r.packageInfo = getPackageInfoNoCheck( r.activityInfo.applicationInfo, r.compatInfo); //Ë∞ÉÁî® handleLaunchActivity handleLaunchActivity(r, null, "LAUNCH_ACTIVITY"); Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER); &#125; break; //‰ª£Á†ÅÁúÅÁï•&#125; ÂΩìÈúÄË¶ÅÂêØÂä®Êñ∞ÁöÑ Activity Êó∂ÔºåApplicationThread ÁöÑ scheduleLaunchActivity ÊñπÊ≥ï‰ºöÂÖàË¢´Ë∞ÉÁî®ÔºåËØ•ÊñπÊ≥ï‰ºöÈÄöËøá H Ë∞ÉÁî® handleLaunchActivity ÊñπÊ≥ïÔºåËÄå handleLaunchActivity ÊñπÊ≥ïÂèà‰ºöË∞ÉÁî® performLaunchActivity ÊñπÊ≥ï„ÄÇ ActivityThread#performLaunchActivity 1234567891011121314151617181920212223242526private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123; //‰ª£Á†ÅÁúÅÁï• Activity activity = null; try &#123; java.lang.ClassLoader cl = r.packageInfo.getClassLoader(); //ÂàõÂª∫ Activity activity = mInstrumentation.newActivity( cl, component.getClassName(), r.intent); &#125; try &#123; Application app = r.packageInfo.makeApplication(false, mInstrumentation); if (activity != null) &#123; //Ëé∑Âèñ Context Context appContext = createBaseContextForActivity(r, activity); //Â∞ÜÂâçÈù¢ÂáÜÂ§áÁöÑÂÄºÂÖ≥ËÅîÂà∞ Activity ‰∏≠ activity.attach(appContext, this, getInstrumentation(), r.token, r.ident, app, r.intent, r.activityInfo, title, r.parent, r.embeddedID, r.lastNonConfigurationInstances, config, r.referrer, r.voiceInteractor, window); //‰ª£Á†ÅÁúÅÁï• &#125; return activity;&#125; ActivityThread#createBaseContextForActivity 12345678private Context createBaseContextForActivity(ActivityClientRecord r, final Activity activity) &#123; ContextImpl appContext = ContextImpl.createActivityContext(//Ë∞ÉÁî® ContextImpl ÁöÑÈùôÊÄÅÊñπÊ≥ïÂàõÂª∫ Activity Context this, r.packageInfo, r.token, displayId, r.overrideConfig); appContext.setOuterContext(activity);//Â§ñÈÉ®ÁöÑ contextÔºàÊ≠§Â§Ñ‰∏∫ ActivityÔºâËÆæÁΩÆÁªô ContextImpl Context baseContext = appContext; //‰ª£Á†ÅÁúÅÁï• return baseContext;&#125; ContextImpl#createActivityContext() 1234567static ContextImpl createActivityContext(ActivityThread mainThread, LoadedApk packageInfo, IBinder activityToken, int displayId, Configuration overrideConfiguration) &#123; if (packageInfo == null) throw new IllegalArgumentException("packageInfo"); return new ContextImpl(null, mainThread, packageInfo, activityToken, null, 0, null, overrideConfiguration, displayId);&#125; ÁªèËøá‰∏äÈù¢ÁöÑÂàÜÊûêÔºåÊàë‰ª¨ÂèØ‰ª•ÂæóÂá∫ÁªìËÆ∫ÔºåActivity ÁöÑ Context ÊòØÂú® performLaunchActivity ÊñπÊ≥ï‰∏≠ÈÄöËøáË∞ÉÁî® createBaseContextForActivity ÂàùÂßãÂåñÁöÑ„ÄÇÂú® createBaseContextForActivity ÊñπÊ≥ï‰∏≠ÔºåÈÄöËøáË∞ÉÁî® ContextImpl ÁöÑÈùôÊÄÅÊñπÊ≥ï createActivityContext ÂàõÂª∫ Ëé∑Âèñ‰∏Ä‰∏™ ContextImpl ÁöÑÂÆû‰æãÂØπË±°ÔºåÂπ∂ÈÄöËøá setOuterContext ÊñπÊ≥ïÂ∞Ü‰∏§ËÄÖÂª∫Á´ãÂÖ≥ËÅî„ÄÇ ÊÄªÁªìÂ≠¶Ëøá‰ª£ÁêÜÊ®°ÂºèÁöÑÂêåÂ≠¶ÂèØËÉΩËßâÂæóË£ÖÈ•∞Ê®°Âºè‰∏é‰ª£ÁêÜÊ®°ÂºèÊúâÁÇπÂÉèÔºàÂõ†‰∏∫ÂêåÊ†∑ÊåÅÊúâÂºïÁî®Ôºâ„ÄÇ‰ΩÜÊòØÊó¢ÁÑ∂ÊòØÂÆÉ‰ª¨ÊòØ‰∏§‰∏™‰∏çÂêåÁöÑËÆæËÆ°Ê®°ÂºèÔºåÂÖàÁúãÁúãÂÆÉ‰ª¨ÂêÑËá™ÁöÑÂÆö‰πâ„ÄÇ Ë£ÖÈ•∞Ê®°ÂºèÔºö‰ª•ÂØπÂÆ¢Êà∑Á´ØÈÄèÊòéÁöÑÊñπÂºèÊâ©Â±ïÂØπË±°ÁöÑÂäüËÉΩÔºåÊòØÁªßÊâøÂÖ≥Á≥ªÁöÑ‰∏Ä‰∏™Êõø‰ª£ÊñπÊ°àÔºõ‰ª£ÁêÜÊ®°ÂºèÔºöÁªô‰∏Ä‰∏™ÂØπË±°Êèê‰æõ‰∏Ä‰∏™‰ª£ÁêÜÂØπË±°ÔºåÂπ∂Áî±‰ª£ÁêÜÂØπË±°Êù•ÊéßÂà∂ÂØπÂéüÊúâÂØπË±°ÁöÑÂºïÁî®Ôºõ ÂÖâÁúãÂÆö‰πâÂèØËÉΩËøòÊòØÊØîËæÉÊ®°Á≥ä„ÄÇ‰∫åËÄÖÂå∫Âà´Âú®Âì™ÈáåÂë¢Ôºü Ë£ÖÈ•∞Ê®°ÂºèÂ∫îËØ•‰∏∫ÊâÄË£ÖÈ•∞ÁöÑÂØπË±°Â¢ûÂº∫ÂäüËÉΩ ‰ª£ÁêÜÊ®°ÂºèÂØπ‰ª£ÁêÜÁöÑÂØπË±°ÊñΩÂä†ÊéßÂà∂Ôºå‰ΩÜ‰∏çÂØπÂØπË±°Êú¨Ë∫´ÁöÑÂäüËÉΩËøõË°åÂ¢ûÂº∫„ÄÇ ÂèØ‰ª•ÁÆÄÂçïÂú∞ÁêÜËß£‰∏∫Ôºö‰Ω†Âú®‰∏Ä‰∏™Âú∞ÊñπÂÜôË£ÖÈ•∞ÔºåÂ§ßÂÆ∂Â∞±Áü•ÈÅìËøôÊòØÂú®Â¢ûÂä†ÂäüËÉΩÔºå‰Ω†ÂÜô‰ª£ÁêÜÔºåÂ§ßÂÆ∂Â∞±Áü•ÈÅìÊòØÂú®ÈôêÂà∂„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Ê∫êÁ†Å‰∏≠ÁöÑ‰∫´ÂÖÉÊ®°Âºè‚Äî‚ÄîMessage Â§çÁî®ÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F08%2F26%2FAndroid-%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94Message%E5%A4%8D%E7%94%A8%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[‰ªãÁªç‰∫´ÂÖÉÊ®°ÂºèÊòØÂØπË±°Ê±†ÁöÑ‰∏ÄÁßçÂÆûÁé∞ÔºåÂÆÉÁöÑËã±ÊñáÂêç‰∏∫ FlyweightÔºå‰ª£Ë°®ËΩªÈáèÁ∫ßÁöÑÊÑèÊÄù„ÄÇ ‰∫´ÂÖÉÊ®°ÂºèÁî®Êù•Â∞ΩÂèØËÉΩ==ÂáèÂ∞ëÂÜÖÂ≠ò‰ΩøÁî®Èáè==ÔºåÂÆÉÈÄÇÂêàÁî®‰∫éÂèØËÉΩÂ≠òÂú®Â§ßÈáèÂØπË±°ÁöÑÂú∫ÊôØÔºåÊù•==ÁºìÂ≠òÂèØÂÖ±‰∫´ÁöÑÂØπË±°==Ôºà‰æãÂ¶Ç Message„ÄÅJava ‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÊ±†Ôºâ,‰ªéËÄåÂÆûÁé∞ÂØπË±°ÂÖ±‰∫´„ÄÅÈÅøÂÖçÂàõÂª∫ËøáÂ§öÂØπË±°ÁöÑÊïàÊûúÔºåËøôÊ†∑‰∏ÄÊù•Â∞±ÂèØ‰ª•ÊèêÂçáÊÄßËÉΩÔºåÈÅøÂÖçÂÜÖÂ≠òÁßªÈô§Á≠â„ÄÇ ‰∫´ÂÖÉÊ®°Âºè‰∏≠ÁöÑÈÉ®ÂàÜÁä∂ÊÄÅÊòØÂèØ‰ª•ÂÖ±‰∫´ÁöÑÔºå ÂèØ‰ª•ÂÖ±‰∫´ÁöÑÁä∂ÊÄÅÁß∞‰∏∫ÂÜÖÈÉ®Áä∂ÊÄÅ„ÄÇÂÜÖÈÉ®Áä∂ÊÄÅ‰∏ç‰ºöÈöèÁùÄÁéØÂ¢ÉÂèòÂåñ ‰∏çÂèØÂÖ±‰∫´ÁöÑÁä∂ÊÄÅÂàôÁß∞‰πã‰∏∫Â§ñÈÉ®Áä∂ÊÄÅÔºå‰ªñ‰ª¨‰ºöÈöèÁùÄÁéØÂ¢ÉÁöÑÊîπÂèòËÄåÊîπÂèò„ÄÇ ‰∫´ÂÖÉÊ®°Âºè‰ºöÂª∫Á´ã‰∏Ä‰∏™ÂØπË±°ÂÆπÂô®ÔºåÂú®ÁªèÂÖ∏ÁöÑ‰∫´ÂÖÉÊ®°Âºè‰∏≠ÔºåËØ•ÂÆπÂô®‰∏∫‰∏Ä‰∏™ MapÔºåÂÆÉÁöÑÈîÆÊòØ‰∫´ÂÖÉÂØπË±°ÁöÑÂÜÖÈÉ®Áä∂ÊÄÅÔºåÂÆÉÁöÑÂÄºÂ∞±ÊòØ‰∫´ÂÖÉÂØπË±°Êú¨Ë∫´„ÄÇ ‰∫´ÂÖÉÊ®°ÂºèÁöÑÂÆö‰πâ‰∫´ÂÖÉÊ®°ÂºèÊòØ‰∏ÄÁßçÁªìÊûÑÂûãËÆæËÆ°Ê®°ÂºèÔºå‰ª•ÂÖ±‰∫´ÁöÑÊñπÂºèÈ´òÊïàÂú∞ÊîØÊåÅÂ§ßÈáèÁöÑÁªÜÁ≤íÂ∫¶ÂØπË±°„ÄÇ ‰ΩøÁî®Âú∫ÊôØ Á≥ªÁªü‰∏≠Â≠òÂú®Â§ßÈáèÁöÑÁõ∏‰ººÂØπË±° ÁªÜÁ≤íÂ∫¶ÁöÑÂØπË±°ÈÉΩÂÖ∑Â§áËæÉÊé•ËøëÁöÑÂ§ñÈÉ®Áä∂ÊÄÅÔºåËÄå‰∏îÂÜÖÈÉ®Áä∂ÊÄÅ‰∏éÁéØÂ¢ÉÊó†ÂÖ≥Ôºå‰πüÂ∞±ÊòØËØ¥ÂØπË±°Ê≤°ÊúâÁâπÂÆöË∫´‰ªΩ„ÄÇ ÈúÄË¶ÅÁºìÂÜ≤Ê±†ÁöÑÂú∫ÊôØ„ÄÇ UML Á±ªÂõæ Flyweight Ôºö‰∫´ÂÖÉÂØπË±°ÊäΩË±°Âü∫Á±ªÊàñËÄÖÊé•Âè£„ÄÇ ConcreteFlyweightÔºöÂÖ∑‰Ωì‰∫´ÂÖÉÂØπË±°„ÄÇ FlyweightFactory Ôºö‰∫´ÂÖÉÂ∑•ÂéÇÔºåË¥üË¥£ÂàõÂª∫‰∫´ÂÖÉÂØπË±°ÂíåÁÆ°ÁêÜ‰∫´ÂÖÉÂØπË±°Ê±†„ÄÇ Android Ê∫êÁ†Å‰∏≠ÁöÑ‰∫´ÂÖÉÊ®°ÂºèÂú®‰ΩøÁî® Handler ÂèëÈÄÅÊ∂àÊÅØ‰πãÂâçÔºåÊàë‰ª¨‰∏ÄËà¨ÈÉΩ‰ºö‰ΩøÁî®Â¶Ç‰∏ã‰ª£Á†ÅË∞ÉÁî® mHandler.obtainMessage() ÊñπÊ≥ïËé∑Âèñ‰∏Ä‰∏™ Message ÂØπË±°„ÄÇËøôÂÖ∂‰∏≠Á©∂Á´üÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÂë¢Ôºü 1234567891011121314Handler mHandler = new Handler();public void do() &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; //do sth Message message = mHandler.obtainMessage(); message.what = 1; message.obj = result; mHandler.sendMessage(message); &#125; &#125;);&#125; 1234//Handler.otainMessage()ÊñπÊ≥ïpublic final Message obtainMessage()&#123; return Message.obtain(this);&#125; ÂèØ‰ª•ÁúãÂà∞ Handler.obtainMessage() ÂÆûÈôÖ‰∏äË∞ÉÁî®ÁöÑÊòØ Message ÁöÑ obtain ÊñπÊ≥ïÔºåÊàë‰ª¨È°∫ÁùÄÊ∫êÁ†ÅÁúã‰∏ãÂéª„ÄÇ ÂÖàÁúãÁúã Message Á±ªÈÉ®ÂàÜÊ∫êÁ†Å 1234567891011121314151617181920212223242526272829// sometimes we store linked lists of these thingsMessage next;private static final Object sPoolSync = new Object();//‰Ωú‰∏∫ÈîÅÂØπË±°private static Message sPool;//ËôΩÁÑ∂ÂêçÁß∞‰∏∫ sPool ‰ΩÜÊòØÂÆûÈôÖ‰∏äÊòØ‰∏Ä‰∏™ÊåáÂêëÊ∂àÊÅØÈòüÂàóÈòüÈ¶ñÁöÑÊåáÈíàprivate static int sPoolSize = 0;//private static final int MAX_POOL_SIZE = 50;//„ÄåÂØπË±°Ê±†„Äç‰∏≠ÁöÑÊúÄÂ§ßÊï∞Èáèpublic static Message obtain(Handler h) &#123; Message m = obtain();//Ë∞ÉÁî® obtain ÊñπÊ≥ïËé∑Âèñ message ÂØπË±° m.target = h;//ÊåáÂÆö message ÁöÑÁõÆÊ†áÂØπË±° return m;&#125;//‰ªéÊ∂àÊÅØÂØπË±°Ê±†‰∏≠ÂèñÂá∫‰∏Ä‰∏™ Message ÂØπË±°ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ∞±ÂàõÂª∫‰∏Ä‰∏™public static Message obtain() &#123; synchronized (sPoolSync) &#123; if (sPool != null) &#123; Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // Ê∏ÖÁ©∫ in-use flag sPoolSize--; return m; &#125; &#125; return new Message();//Ê∂àÊÅØÊ±†‰∏≠Ê≤°ÊúâÂèØÂ§çÁî®ÁöÑ Message Â∞±ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ Message&#125; Ëá≥Ê≠§Ôºå‰ªéÂØπË±°Ê±†‰∏≠Ëé∑ÂèñÂØπË±°ÁöÑÂ§ßËá¥ÊµÅÁ®ã„ÄÇÊó†ËÆ∫ÊòØ Handler.obtainMessage(ÂèÇÊï∞ÂàóË°®) ÊñπÊ≥ïÔºåËøòÊòØ Message ÁöÑ obtain(ÂèÇÊï∞ÂàóË°®) ÊñπÊ≥ïÔºåÊúÄÁªàÈÉΩ‰ºöË∞ÉÁî® Message.obtain() ÊñπÊ≥ï„ÄÇÂú® Message.obtain() ÊñπÊ≥ïÁöÑÂÆûÁé∞‰∏≠Ôºå‰ºöÂÖà‰ªéÂØπË±°Ê±†‰∏≠Ëé∑Âèñ Message ÂØπË±°ÔºåÂ¶ÇÊûúËé∑Âèñ‰∏çÂà∞ÔºåÂàôÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ Message ÂØπË±°ÔºåÁÑ∂ÂêéËøîÂõû„ÄÇËØ•ÂØπË±°Âú®ÂêéÁª≠ÁöÑÊâßË°åËøáÁ®ã‰∏≠‰ºöË¢´ÂõûÊî∂Âà∞ÂØπË±°Ê±†Ôºå‰ª•‰æøÂ§çÁî®„ÄÇ ‰ΩÜÊòØ Message ÂØπË±°ÊòØÂ¶Ç‰ΩïË¢´ÂõûÊî∂Âà∞„ÄåÂØπË±°Ê±†„Äç‰∏≠ÁöÑÂë¢Ôºü ‰ªé Message Á±ªÁöÑÈÉ®ÂàÜ‰ª£Á†Å‰∏≠Êàë‰ª¨ÁúãÂà∞ sPool ÁöÑÂÆûÈôÖÁ±ªÂûãÊòØ‰∏Ä‰∏™ Message ÂØπË±°ÔºåËÄå‰∏çÊòØ‰∏Ä‰∏™ÂÆπÂô®„ÄÇÂè¶Â§ñ‰ªé obtain ÊñπÊ≥ï‰∏≠Êàë‰ª¨‰∏çÈöæÁúãÂà∞ÈìæË°®ÁöÑË∏™ÂΩ±„ÄÇÈöæÈÅìÊ∂àÊÅØÊ±†ÊòØ‰ΩøÁî®ÈìæË°®ÂÆûÁé∞ÁöÑÂêóÔºü Âú® AS ‰∏≠ÊâìÂºÄ Message Á±ªÁöÑÁªìÊûÑÂõæÔºåÂèØ‰ª•ÁúãÂà∞ÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™ recycle ÊñπÊ≥ïÔºåÊàë‰ª¨ÁúãÁúãÈáåÈù¢ÊòØÊÄé‰πàÂÆûÁé∞ÁöÑ„ÄÇ 123456789101112131415161718192021222324252627282930313233343536public void recycle() &#123; if (isInUse()) &#123;//Âà§Êñ≠Ê∂àÊÅØÊòØÂê¶ËøòÂú®‰ΩøÁî® if (gCheckRecycle) &#123;//Â¶ÇÊûúÊ∂àÊÅØÂ§ÑÂú®‰ΩøÁî®Áä∂ÊÄÅÊó∂Ë¢´ gc ÂõûÊî∂ÔºåÂ∞±ÊäõÂá∫ÂºÇÂ∏∏ throw new IllegalStateException("This message cannot be recycled because it " + "is still in use."); &#125; return;//Áõ¥Êé•ËøîÂõûÔºåÂèñÊ∂àÂõûÊî∂Êìç‰Ωú &#125; recycleUnchecked();//Ë∞ÉÁî®ÂõûÊî∂ÊñπÊ≥ï&#125;/** * ÂõûÊî∂‰∏Ä‰∏™ÂèØËÉΩËøòÂú®‰ΩøÁî®ÁöÑÂØπË±° */void recycleUnchecked() &#123; // Âè™Ë¶ÅËØ•ÂØπË±°ËøòÂú®ÂõûÊî∂ÂØπË±°Ê±†‰∏≠ÔºåÂ∞±Ê†áËÆ∞ËØ•ÂØπË±°‰∏∫Ê≠£Âú®‰ΩøÁî®Áä∂ÊÄÅ„ÄÇ // Ê∏ÖÁ©∫ÂÖ∂‰ªñÁä∂ÊÄÅ flags = FLAG_IN_USE; what = 0; arg1 = 0; arg2 = 0; obj = null; replyTo = null; sendingUid = -1; when = 0; target = null; callback = null; data = null; //ÂõûÊî∂Ê∂àÊÅØÂà∞Ê∂àÊÅØÊ±†‰∏≠ synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; next = sPool; sPool = this; sPoolSize++; &#125; &#125;&#125; recycle ÊñπÊ≥ïÈ¶ñÂÖà‰ºöÂà§Êñ≠ Message ÂØπË±°ÊòØÂê¶Â§ÑÂú®‰ΩøÁî®Áä∂ÊÄÅ„ÄÇÂ¶ÇÊûúÂ§ÑÂú®‰ΩøÁî®Áä∂ÊÄÅ‰ºöÁõ¥Êé•ËøîÂõûÔºàÂ¶ÇÊûúÊ≠§Êó∂ GC ÂõûÊî∂ËØ•ÂØπË±°‰ºöÊäõÂá∫ÂºÇÂ∏∏ÔºâÔºåÂê¶ÂàôË∞ÉÁî® recycleUnchecked ÊñπÊ≥ïÔºåÂÖ∑‰ΩìÁöÑÂõûÊî∂ÈÄªËæëÊòØÂú® recycleUnchecked ÊñπÊ≥ï‰∏≠ÂÆûÁé∞ÁöÑ„ÄÇÈ¶ñÂÖà‰ºöÊ†áËÆ∞ Message Â§Ñ‰∫é‰ΩøÁî®Áä∂ÊÄÅÔºåÁÑ∂ÂêéÊ∏ÖÁ©∫ÂØπË±°‰∏≠ÁöÑÂÖ∂‰ªñÁä∂ÊÄÅ„ÄÇÂ∞ÜÊ∂àÊÅØÂ≠òÂÖ•ÂõûÊî∂Ê±†Ôºå‰∏ªË¶ÅÊòØÈìæË°®ÁöÑÊìç‰Ωú„ÄÇÂ§ßËá¥Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ Â∞èÁªìMessage ÈÄöËøáÂú®ÂÜÖÈÉ®ÊûÑÂª∫‰∏Ä‰∏™ÈìæË°®Êù•Áª¥Êä§‰∏Ä‰∏™Ë¢´‰ºöÂèóÂà∞ Message ÂØπË±°ÁöÑÂØπË±°Ê±†ÔºåÂΩìÁî®Êà∑Ë∞ÉÁî® obtain ÊñπÊ≥ïÊó∂Ôºå‰ºö‰ºòÂÖà‰ªéÊ±†‰∏≠Ëé∑Âèñ„ÄÇÂ¶ÇÊûúÊ±†‰∏≠Ê≤°ÊúâÂèØ‰ª•Â§çÁî®ÁöÑÂØπË±°Â∞±ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°ÔºåËØ•ÂØπË±°‰ΩøÁî®ÂÆå‰πãÂêéÔºå‰ºöË¢´ÁºìÂ≠òÂà∞ÂØπË±°Ê±†‰∏≠ÔºåÂΩì‰∏ãÊ¨°Ë∞ÉÁî® obtain ÊñπÊ≥ïÊó∂Ôºå‰ªñ‰ª¨Â∞±‰ºöË¢´Â§çÁî®„ÄÇ Ê≠§Â§Ñ Message ÊâÆÊºî‰∫Ü‰∏â‰∏™ËßíËâ≤„ÄÇÊó¢ÊòØ FlyWeight ÊäΩË±°ÔºåÂèàÊòØ ConcreteFlyWeight ÂØπË±°ÔºåÂêåÊó∂ËøòÊãÖ‰ªª FlyWeightFactory ËßíËâ≤ÔºåÊâøÊãÖÁùÄÁÆ°ÁêÜÂØπË±°Ê±†ÁöÑËÅåË¥£„ÄÇ ÊÉ≥Ëøõ‰∏ÄÊ≠•‰∫ÜËß£ Android Ê∂àÊÅØÊú∫Âà∂ÁöÑÂêåÂ≠¶ÂèØÂèÇËÄÉAndroid Ê∂àÊÅØÊú∫Âà∂Ëß£Êûê„ÄÇ ÊÄªÁªì‰∫´ÂÖÉÊ®°ÂºèÁöÑ‰ºòÁÇπÔºö Â§ßÂπÖÂ∫¶Èôç‰Ωé‰∫ÜÂÜÖÂ≠ò‰∏≠ÂØπË±°ÁöÑÊï∞Èáè„ÄÇ‰ªéËÄåÈôç‰Ωé‰∫ÜÂÜÖÂ≠òÁöÑÂç†Áî®ÔºåÊèêÈ´ò‰∫ÜÁ®ãÂ∫èÁöÑÊÄßËÉΩ„ÄÇ Áº∫ÁÇπÔºö ‰ΩøÂæóÁ≥ªÁªüÊõ¥Âä†Â§çÊùÇ„ÄÇ‰∏∫‰∫Ü‰ΩøÂ∫îÁî®ËÉΩÂ§üÂÖ±‰∫´ÔºåÈúÄË¶ÅÂ∞Ü‰∏Ä‰∫õÁä∂ÊÄÅÂ§ñÈÉ®ÂåñÔºåËøô‰ΩøÂæóÁ®ãÂ∫èÁöÑÈÄªËæëÂ§çÊùÇÂåñ„ÄÇ ‰∫´ÂÖÉÊ®°ÂºèÂ∞ÜÁä∂ÊÄÅÂ§ñÈÉ®ÂåñÔºåËÄåËØªÂèñÂ§ñÈÉ®Áä∂ÊÄÅ‰ΩøÂæóËøêË°åÊó∂Èó¥Á®çÂæÆÂèòÈïø ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäJAVA ‰∏éÊ®°Âºè„Äã‰πã‰∫´ÂÖÉÊ®°Âºè „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Android Ê∂àÊÅØÊú∫Âà∂Ëß£Êûê Ëã•Êú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Ê∫êÁ†Å‰∏≠ÁöÑÊ®°ÊùøÊñπÊ≥ïÊ®°Âºè‚Äî‚ÄîAsyncTaskËß£Êûê]]></title>
    <url>%2Fblog%2F2017%2F08%2F24%2FAndroid-%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94AsyncTask%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÂÅáËÆæÊàë‰ª¨Áü•ÈÅì‰∏Ä‰∏™ÁÆóÊ≥ïÊâÄÈúÄÁöÑÂÖ≥ÈîÆÊ≠•È™§ÔºåÂπ∂Á°ÆÂÆö‰∫ÜËøô‰∫õÊ≠•È™§ÁöÑÊâßË°åÈ°∫Â∫èÔºå‰ΩÜÊòØÔºåÊüê‰∫õÊ≠•È™§ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊòØÊú™Áü•ÁöÑÔºåÊàñËÄÖËØ¥Êüê‰∫õÊ≠•È™§ÁöÑÂÆûÁé∞ÊòØ‰ºöÈöèÁùÄÁéØÂ¢ÉÁöÑÂèòÂåñËÄåÊîπÂèòÁöÑ„ÄÇÂ∞±Â•ΩÂÉèÊâßË°åÁ®ãÂ∫èÁöÑÊµÅÁ®ãÔºö Ê£ÄÊü•‰ª£Á†ÅÁöÑÊ≠£Á°ÆÊÄß ÈìæÊé•Áõ∏ÂÖ≥‰ª£Á†Å ÁºñËØëÁõ∏ÂÖ≥‰ª£Á†Å ÊâßË°åÁ®ãÂ∫è ÂØπ‰∫é‰∏çÂêåÁöÑËØ≠Ë®ÄÔºå‰∏äËø∞ 4 ‰∏™Ê≠•È™§ÈÉΩÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºå‰ΩÜÊòØÂÆÉ‰ª¨ÁöÑÊâßË°åÊµÅÁ®ãÊòØÂõ∫ÂÆöÁöÑÔºåËøôÁ±ªÈóÆÈ¢òÁöÑËß£ÂÜ≥ÊñπÊ°àÂ∞±ÊòØÊàë‰ª¨‰ªãÁªçÁöÑÊ®°ÊùøÊñπÊ≥ïÊ®°Âºè„ÄÇ Ê®°ÊùøÊñπÊ≥ïÊ®°ÂºèÁöÑÂÆö‰πâÂÆö‰πâ‰∏Ä‰∏™Êìç‰Ωú‰∏≠ÁöÑÁÆóÊ≥ïÁöÑÊ°ÜÊû∂ÔºåËÄåÂ∞Ü‰∏Ä‰∫õÊ≠•È™§Âª∂ËøüÂà∞Â≠êÁ±ª‰∏≠Ôºå‰ΩøÂæóÂ≠êÁ±ªÂèØ‰ª•‰∏çÊîπÂèò‰∏Ä‰∏™ÁÆóÊ≥ïÁöÑÁªìÊûÑÂç≥ÂèØÈáçÂÆö‰πâËØ•ÁÆóÊ≥ïÁöÑÊüê‰∫õÁâπÂÆöÊ≠•È™§„ÄÇ Ê®°ÊùøÊñπÊ≥ïÊ®°ÂºèÁöÑ‰ΩøÁî®Âú∫ÊôØ Â§ö‰∏™Â≠êÁ±ªÊúâÂÖ¨ÊúâÁöÑÊñπÊ≥ïÔºåÂπ∂‰∏îÈÄªËæëÂü∫Êú¨Áõ∏ÂêåÊó∂„ÄÇ ÈáçË¶Å„ÄÅÂ§çÊùÇÁöÑÁÆóÊ≥ïÔºåÂèØ‰ª•ÊääÊ†∏ÂøÉÁÆóÊ≥ïËÆæËÆ°‰∏∫Ê®°ÊùøÊñπÊ≥ïÔºåÂë®ËæπÁöÑÁõ∏ÂÖ≥ÁªÜËäÇÂäüËÉΩÂàôÁî±ÂêÑ‰∏™Â≠êÁ±ªÂÆûÁé∞„ÄÇ ÈáçÊûÑÊó∂ÔºåÊääÁõ∏ÂêåÁöÑ‰ª£Á†ÅÊäΩÂèñÂà∞Áà∂Á±ª‰∏≠ÔºåÁÑ∂ÂêéÈÄöËøáÈí©Â≠êÊñπÊ≥ïÁ∫¶ÊùüÂÖ∂Ë°å‰∏∫„ÄÇ Ê≥®Ôºö‰ΩïË∞ìÈí©Â≠êÊñπÊ≥ïÔºüÂü∫Êú¨ÊñπÊ≥ïÂèàÂèØ‰ª•ÂàÜ‰∏∫‰∏âÁßçÔºöÊäΩË±°ÊñπÊ≥ïÔºàAbstract MethodÔºâ„ÄÅÂÖ∑‰ΩìÊñπÊ≥ïÔºàConcrete MethodÔºâÂíåÈí©Â≠êÊñπÊ≥ïÔºàHook MethodÔºâ„ÄÇ ËøôÊòØ„Ääjava‰∏éÊ®°Âºè„Äã‰π¶ÈáåÁöÑ‰∏ÄÁßçËØ¥Ê≥ïÔºå‰∏âÁßçÊñπÊ≥ï‰πüÊòØÂú®‰π¶‰∏≠ÁöÑÊ®°ÊùøÊñπÊ≥ïÊ®°Âºè‰∏≠ÊèêÂèäÂà∞ÁöÑ„ÄÇ ÂÖàËØ¥Ëøô‰∏™‰∏â‰∏™ÊñπÊ≥ïÁöÑÂü∫Êú¨ÂÆö‰πâÔºö ÊäΩË±°ÊñπÊ≥ïÔºöÁî±ÊäΩË±°Á±ªÂ£∞ÊòéÔºåÁî±ÂÖ∑‰ΩìÂ≠êÁ±ªÂÆûÁé∞„ÄÇÂú®javaËØ≠Ë®ÄÈáå‰∏Ä‰∏™ÊäΩË±°ÊñπÊ≥ï‰ª•abstractÂÖ≥ÈîÆÂ≠óÊ†áÁ§∫Âá∫Êù•„ÄÇ ÂÖ∑‰ΩìÊñπÊ≥ïÔºöÁî±ÊäΩË±°Á±ªÂ£∞ÊòéÂπ∂ÂÆûÁé∞ÔºåËÄåÂ≠êÁ±ªÂπ∂‰∏çÂÆûÁé∞ÊàñË¶ÜÁõñ„ÄÇÂÖ∂ÂÆûÂ∞±ÊòØ‰∏ÄËà¨ÁöÑÊñπÊ≥ïÔºå‰ΩÜÊòØ‰∏çÈúÄË¶ÅÂ≠êÁ±ªÊù•ÂÆûÁé∞„ÄÇ Èí©Â≠êÊñπÊ≥ïÔºöÁî±ÊäΩË±°Á±ªÂ£∞ÊòéÂπ∂ÂÆûÁé∞ÔºåËÄåÂ≠êÁ±ª‰πü‰ºöÂä†‰ª•Êâ©Â±ï„ÄÇÈÄöÂ∏∏ÊäΩË±°Á±ªÁªôÂá∫ÁöÑÊòØ‰∏Ä‰∏™Á©∫ÁöÑÈí©Â≠êÊñπÊ≥ïÔºå‰πüÂ∞±ÊòØÊñπÊ≥ï‰Ωì‰∏∫Á©∫ÁöÑÊñπÊ≥ïÔºà‰πüÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂÆûÁé∞ÈÉ®ÂàÜÈÄªËæëÔºâ„ÄÇÂÖ∂ÂÆûÂÆÉÂíåÂÖ∑‰ΩìÊñπÊ≥ïÂú®‰ª£Á†Å‰∏äÊ≤°ÊúâÂå∫Âà´Ôºå‰∏çËøáÊòØÊÑèËØÜ‰∏äÁöÑ‰∏ÄÁßçÂå∫Âà´„ÄÇ ËØ¶ËßÅÊäΩË±°ÊñπÊ≥ï ÂÖ∑‰ΩìÊñπÊ≥ï Èí©Â≠êÊñπÊ≥ï Ê®°ÊùøÊñπÊ≥ïÊ®°ÂºèÁöÑ UML Á±ªÂõæ AbsTemplateÔºöÊäΩË±°Á±ªÔºåÂÆö‰πâ‰∏ÄÂ•óÁÆóÊ≥ïÊ°ÜÊû∂ ConcreteImplAÔºöÂÖ∑‰ΩìÂÆûÁé∞Á±ª A ConcreteImplBÔºöÂÖ∑‰ΩìÂÆûÁé∞Á±ª B Ê®°ÊùøÊñπÊ≥ïÊ®°ÂºèÁöÑÁÆÄÂçïÁ§∫‰æãÂÆûÈôÖ‰∏äÊòØÂ∞ÅË£Ö‰∏Ä‰∏™Âõ∫ÂÆöÊµÅÁ®ãÔºåÂ∞±ÂÉèÊòØ‰∏ÄÂ•óÊâßË°åÊ®°Êùø‰∏ÄÊ†∑ÔºåÁ¨¨‰∏ÄÊ≠•ËØ•ÂÅö‰ªÄ‰πàÔºåÁ¨¨‰∫åÊ≠•ËØ•ÂÅö‰ªÄ‰πàÈÉΩÂ∑≤ÁªèÂú®ÊäΩË±°Á±ª‰∏≠ÂÆö‰πâÂ•Ω„ÄÇËÄåÂ≠êÁ±ªÂèØ‰ª•Êúâ‰∏çÂêåÁöÑÁÆóÊ≥ïÂÆûÁé∞ÔºåÂú®Ê°ÜÊû∂‰∏çË¢´‰øÆÊîπÁöÑÊÉÖÂÜµ‰∏ãÂÆûÁé∞Êüê‰∫õÊ≠•È™§ÁöÑÁÆóÊ≥ïÊõøÊç¢„ÄÇ Android Ê∫êÁ†Å‰∏≠ÁöÑÊ®°ÊùøÊñπÊ≥ïÊ®°ÂºèAsyncTask‰ΩøÁî®Ëøá AsyncTask ÁöÑÂêåÂ≠¶ÈÉΩÁü•ÈÅìÔºåÊàë‰ª¨Ë∞ÉÁî® execute ‰πãÂêéÔºåÔºàÂ¶ÇÊûúÊ≤°ÊúâË∞ÉÁî® cancel ÊñπÊ≥ïÁöÑËØùÔºâ‰ª•‰∏ã‰∏â‰∏™ÊñπÊ≥ï‰ºö‰æùÊ¨°ÊâßË°åÔºö onPreExecute doInBackground onPostExecute ‰∏∫‰ªÄ‰πàËÉΩËÆ©ÂÆÉ‰ª¨‰æùÊ¨°ÊâßË°åÂë¢ÔºüÂÖ∂ÂÜÖÈÉ®ÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºüÊàë‰ª¨ÁúãÁúãÊ∫êÁ†ÅÔºå‰∏ÄÊé¢Á©∂Á´ü„ÄÇ È¶ñÂÖàÁúãÁúãÂºÇÊ≠•‰ªªÂä°ÁöÑÂÖ•Âè£ÊñπÊ≥ï execute„ÄÇ123456789101112131415161718192021222324252627282930 @MainThreadpublic final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123; return executeOnExecutor(sDefaultExecutor, params);&#125;@MainThreadpublic final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec, Params... params) &#123; if (mStatus != Status.PENDING) &#123; switch (mStatus) &#123; case RUNNING: throw new IllegalStateException("Cannot execute task:" + " the task is already running."); case FINISHED: throw new IllegalStateException("Cannot execute task:" + " the task has already been executed " + "(a task can be executed only once)"); &#125; &#125; mStatus = Status.RUNNING; onPreExecute(); mWorker.mParams = params; exec.execute(mFuture); return this;&#125; ‰ª•‰∏ä‰∏§‰∏™ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠‰∏ªË¶ÅÂÅö‰∫ÜÂ¶Ç‰∏ãÂá†‰ª∂‰∫ãÔºö Áä∂ÊÄÅÂà§Êñ≠ Âà§Êñ≠‰πãÂêéÊâßË°å onPreExecute(); ‰ΩøÁî®Á∫øÁ®ãÊ±†ÊâßË°å mFuture ‰ªÄ‰πàÊ†∑ÁöÑÁ∫øÁ®ãÊ±†Ôºü ÈªòËÆ§‰∏∫ SerialExecutor Âç≥ÂçïÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÊ±† 123456789101112131415161718192021222324252627282930313233343536public AsyncTask() &#123; mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123; public Result call() throws Exception &#123; mTaskInvoked.set(true); Result result = null; try &#123; Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);//ËÆæÁΩÆËøõÁ®ã‰ºòÂÖàÁ∫ß //noinspection unchecked result = doInBackground(mParams);//Ë∞ÉÁî® doInBackground ÊñπÊ≥ï Binder.flushPendingCommands(); &#125; catch (Throwable tr) &#123; mCancelled.set(true); throw tr; &#125; finally &#123; postResult(result);//Ë∞ÉÁî® postResult ÊñπÊ≥ï &#125; return result; &#125; &#125;; mFuture = new FutureTask&lt;Result&gt;(mWorker) &#123; @Override protected void done() &#123; try &#123; postResultIfNotInvoked(get());//‰ªªÂä°ÂÆåÊàê &#125; catch (InterruptedException e) &#123; android.util.Log.w(LOG_TAG, e); &#125; catch (ExecutionException e) &#123; throw new RuntimeException("An error occurred while executing doInBackground()", e.getCause()); &#125; catch (CancellationException e) &#123; postResultIfNotInvoked(null); &#125; &#125; &#125;;&#125; 12private final WorkerRunnable&lt;Params, Result&gt; mWorker;private final FutureTask&lt;Result&gt; mFuture; mWorker Á±ªÂûã‰∏∫ WorkerRunnable&lt;Params, Result&gt; Ôºå WorkerRunnable ÂÆûÁé∞‰∫Ü Callable mFuture Á±ªÂûã‰∏∫ FutureTask&lt;Result&gt; ÁÆÄËÄåË®Ä‰πãÔºåËøô‰∏™ mFuture ÂåÖË£Ö‰∫ÜËøô‰∏™ mWorker ÂØπË±°ÔºåËÄå mFuture ÊòØÂú®Á∫øÁ®ãÊ±†‰∏≠ÊâßË°åÁöÑÔºå‰ºöË∞ÉÁî® mFuture ÁöÑ run ÊñπÊ≥ïÔºåËØ• run ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü mWorker ÁöÑ call ÊñπÊ≥ïÔºåmWorker ÁöÑ call ÊñπÊ≥ïÂèàË∞ÉÁî®‰∫Ü doInBackground ÊñπÊ≥ïÔºåÊâÄ‰ª• doInBackground ÊòØÂú®Â∑•‰ΩúÁ∫øÁ®ãÊâßË°åÁöÑ„ÄÇ 123456private void postResultIfNotInvoked(Result result) &#123; final boolean wasTaskInvoked = mTaskInvoked.get(); if (!wasTaskInvoked) &#123; postResult(result); &#125;&#125; doInBackground ÊâßË°åÂÆåÊàêÂêé‰ºöÈÄöËøá postResult(result) ÊñπÊ≥ïÂ∞ÜÁªìÊûú‰º†ÈÄíÁªô‰∏ªÁ∫øÁ®ã„ÄÇ postResult(result) ÂèØËÉΩÈÄöËøá call ÊñπÊ≥ïÁöÑ finally ÂùóÁõ¥Êé•Ë∞ÉÁî®ÊàñËÄÖÈÄöËøá FutureTask ‰∏≠ÁöÑ done ÊñπÊ≥ïÈáåÈù¢ÁöÑ postResultIfNotInvoked(get()); Êù•Èó¥Êé•Ë∞ÉÁî®„ÄÇ Êé•‰∏ãÊù•Êàë‰ª¨ÁúãÁúã postResult(result) ÊñπÊ≥ï1234567private Result postResult(Result result) &#123; @SuppressWarnings("unchecked") Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT, new AsyncTaskResult&lt;Result&gt;(this, result)); message.sendToTarget(); return result;&#125; 1234567891011121314151617181920private static class InternalHandler extends Handler &#123; public InternalHandler() &#123; super(Looper.getMainLooper()); &#125; @SuppressWarnings(&#123;"unchecked", "RawUseOfParameterizedType"&#125;) @Override public void handleMessage(Message msg) &#123; AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj; switch (msg.what) &#123; case MESSAGE_POST_RESULT: // Ë∞ÉÁî® AsyncTask ÁöÑ finish ÊñπÊ≥ï result.mTask.finish(result.mData[0]); break; case MESSAGE_POST_PROGRESS: result.mTask.onProgressUpdate(result.mData); break; &#125; &#125;&#125; 12345678private void finish(Result result) &#123; if (isCancelled()) &#123; onCancelled(result); &#125; else &#123; onPostExecute(result); &#125; mStatus = Status.FINISHED;&#125; postResult(result) ÊñπÊ≥ïÂ∞±ÊòØÈÄöËøáÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÔºàmsg.what == MESSAGE_POST_RESULTÔºâÁªô sHandlerÔºåsHandler ‰∏∫ InternalHanlder„ÄÇÂΩì InternalHanlder Êé•Êî∂Âà∞ MESSAGE_POST_RESULT Êó∂ÔºåÂ∞±‰ºöË∞ÉÁî® result.mTask.finish(result.mData[0]) ÊñπÊ≥ïÔºåresult ÁöÑÁ±ªÂûã‰∏∫ AsyncTaskResult 123456789private static class AsyncTaskResult&lt;Data&gt; &#123; final AsyncTask mTask; final Data[] mData; AsyncTaskResult(AsyncTask task, Data... data) &#123; mTask = task; mData = data; &#125;&#125; ‰ªé AsyncTaskResult ÁöÑÂÖ∑‰ΩìÂÆûÁé∞‰∏≠ÂêóÔºåÊàë‰ª¨Áü•ÈÅì mTask Â∞±ÊòØ AsyncTaskÔºåfinish ÊñπÊ≥ï‰∏≠ÂèàË∞ÉÁî®‰∫Ü onPostExecute ÔºåÊ≠§Êó∂Êï¥‰∏™ÊâßË°åÊµÅÁ®ãÂ∞±ÂÆåÊàê‰∫Ü„ÄÇ Â∞èÁªìexecute ÊñπÊ≥ïÂÜÖÈÉ®Â∞ÅË£Ö‰∫Ü onPreExecute„ÄÅdoInBackGround„ÄÅonPostExecute Ëøô‰∏™ÈÄªËæëÊµÅÁ®ã„ÄÇÈÄöËøáËøôÁßçÊñπÂºèÔºåÁî®Êà∑ÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÈúÄÊ±ÇÂÜçË¶ÜÂÜôËøôÂá†‰∏™ÊñπÊ≥ïÔºå‰ΩøÂæóÁî®Êà∑ÂèØ‰ª•ÂæàÊñπ‰æøÂú∞‰ΩøÁî®ÂºÇÊ≠•‰ªªÂä°Êù•ÂÆåÊàêËÄóÊó∂ÁöÑÊìç‰ΩúÂèäÊõ¥Êñ∞ UI„ÄÇÂÆûÈôÖ‰∏äÂ∞±ÊòØÈÄöËøáÁ∫øÁ®ãÊ±†Êù•ÊâßË°åËÄóÊó∂ÁöÑ‰ªªÂä°ÔºåÂæóÂà∞ÁªìÊûú‰πãÂêéÔºåÈÄöËøá Handler Â∞ÜÁªìÊûú‰º†ÈÄíÁªô UI Á∫øÁ®ãÊâßË°å„ÄÇ Activity ÁöÑÁîüÂëΩÂë®ÊúüÂáΩÊï∞Èô§‰∫Ü AsyncTask ‰ª•Â§ñÔºåAndroid Ê∫êÁ†Å‰∏≠ËøòÊúâ‰∏çÂ∞ëÂú∞ÊñπÊúâÊ®°ÊùøÊñπÊ≥ïÁöÑË∫´ÂΩ±ÔºåÊØîÂ¶ÇËØ¥ Activity ÁöÑÁîüÂëΩÂë®ÊúüÊñπÊ≥ï‚Äî‚Äî onCreate „ÄÅonStart„ÄÅonResume Á≠âÔºåÈÉΩÊòØÊåâÁÖßÈ°∫Â∫èË∞ÉÁî®ÁöÑÔºåÊàë‰ª¨‰ºöÂú®ÂØπÂ∫îÁöÑÊñπÊ≥ï‰∏≠ÊâßË°åÂêàÈÄÇÁöÑÊìç‰Ωú„ÄÇ ÂÖ∂ÂÜÖÈÉ®ÂÆûÁé∞Ê∂âÂèäÂà∞ËøõÁ®ãÈó¥ÈÄö‰ø°ÔºåÈôê‰∫éÁØáÂπÖÔºåÊú¨Êñá‰∏ç‰ΩúÊ∑±ÂÖ•‰ªãÁªç„ÄÇÊúâÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•ÁúãÁúã ActivityThread ÁöÑ main ÊñπÊ≥ïÔºå‰ª•‰πã‰Ωú‰∏∫ÂÖ•Âè£ÔºåÂØπÁîüÂëΩÂë®ÊúüÊñπÊ≥ïÁöÑË∞ÉÁî®Êó∂Êú∫ÂÅöËøõ‰∏ÄÊ≠•Á†îÁ©∂„ÄÇ Ê®°ÊùøÊñπÊ≥ïÊÄªÁªìÁÆÄÂçïÊ¶ÇÊã¨Ê®°ÊùøÊñπÊ≥ïÊ®°ÂºèÂ∞±ÊòØÊµÅÁ®ãÂ∞ÅË£Ö„ÄÇÊääÊüê‰∏Ä‰∏™Âõ∫ÂÆöÁöÑÊµÅÁ®ãÂ∞ÅË£ÖÂà∞‰∏Ä‰∏™Âõ∫ÂÆöÁöÑ final ÊñπÊ≥ï‰∏≠„ÄÇÂπ∂‰∏îËÆ©Â≠êÁ±ªËÉΩÂ§üÂÆöÂà∂Ëøô‰∏™ËøáÁ®ã‰∏≠ÁöÑÊüê‰∫õÁîöËá≥ÊâÄÊúâÊ≠•È™§ÔºåËøôÂ∞±Ë¶ÅÊ±ÇÁà∂Á±ªÊèêÂèñÂÖ±Áî®ÁöÑ‰ª£Á†ÅÔºåÊèêÂçá‰ª£Á†ÅÁöÑÂ§çÁî®ÁéáÔºåÂêåÊó∂‰πüÂ∏¶Êù•‰∫ÜÊõ¥È´òÁöÑÂèØÊâ©Â±ïÊÄß„ÄÇ ‰ºòÁÇπÔºö Â∞ÅË£Ö‰∏çÂèòÁöÑÈÉ®ÂàÜÔºåÊâ©Â±ïÂèØÂèòÁöÑÈÉ®ÂàÜ ÊèêÂèñÂÖ¨ÂÖ±ÈÉ®ÂàÜ‰ª£Á†ÅÔºå‰æø‰∫éÁª¥Êä§„ÄÇ Áº∫ÁÇπÔºö ÊèêÈ´ò‰∫Ü‰ª£Á†ÅÈòÖËØªÁöÑÈöæÂ∫¶Ôºå‰ºöËÆ©Áî®Êà∑ËßâÂæóÈöæ‰ª•ÁêÜËß£ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã ÊäΩË±°ÊñπÊ≥ï ÂÖ∑‰ΩìÊñπÊ≥ï Èí©Â≠êÊñπÊ≥ï Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ë°å‰∏∫ÂûãËÆæËÆ°Ê®°Âºè‰πãÂ§áÂøòÂΩïÊ®°Âºè]]></title>
    <url>%2Fblog%2F2017%2F08%2F21%2F%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Â§áÂøòÂΩïÊ®°ÂºèÁöÑÂÆö‰πâÂ§áÂøòÂΩïÊ®°ÂºèÊòØ‰∏ÄÁßçË°å‰∏∫ÂûãËÆæËÆ°Ê®°ÂºèÔºåËØ•Ê®°ÂºèÁî®‰∫é‰øùÂ≠òÂØπË±°ÂΩìÂâçÁöÑÁä∂ÊÄÅÔºåÂπ∂‰∏îÂú®‰πãÂêéÂèØ‰ª•ÂÜçÊ¨°ÊÅ¢Â§çÂà∞Ê≠§Áä∂ÊÄÅ„ÄÇ ÂÆûÁé∞ÊïàÊûú‰∏∫ÔºöÂú®‰∏çÁ†¥ÂùèÂ∞ÅÈó≠ÁöÑÂâçÊèê‰∏ãÔºåÊçïËé∑‰∏Ä‰∏™ÂØπË±°ÁöÑÂÜÖÈÉ®Áä∂ÊÄÅÔºåÂπ∂Âú®ËØ•ÂØπË±°‰πãÂ§ñ‰øùÂ≠òËøô‰∏™Áä∂ÊÄÅÔºå‰ª•‰æøÂêéÁª≠Â∞ÜÂØπË±°ÊÅ¢Â§çÂà∞ÂéüÊù•ÁöÑÁä∂ÊÄÅ„ÄÇ Â§áÂøòÂΩïÊ®°ÂºèÁöÑ‰ΩøÁî®Âú∫ÊôØ ÈúÄË¶Å‰øùÂ≠ò‰∏Ä‰∏™ÂØπË±°Âú®Êüê‰∏Ä‰∏™Êó∂ÂàªÁöÑÁä∂ÊÄÅÊàñÈÉ®ÂàÜÁä∂ÊÄÅ ‰∏Ä‰∏™ÂØπË±°‰∏çÂ∏åÊúõÂ§ñÁïåÁõ¥Êé•ËÆøÈóÆÂÖ∂ÂÜÖÈÉ®Áä∂ÊÄÅÔºåÈÄöËøá‰∏≠Èó¥ÂØπË±°ÂèØ‰ª•Èó¥Êé•ËÆøÈóÆÂÖ∂ÂÜÖÈÉ®Áä∂ÊÄÅ„ÄÇÔºàÂ¶ÇÊûú‰ΩøÁî®Êé•Âè£Êù•ËÆ©ÂÖ∂‰ªñÂØπË±°Ëé∑ÂèñÂØπË±°ÁöÑÁä∂ÊÄÅÔºå‰ºöÁ†¥ÂùèÂ∞ÅË£ÖÊÄßÔºâ Â§áÂøòÂΩïÊ®°ÂºèÁöÑUMLÁ±ªÂõæ ‰∏â‰∏™ËßíËâ≤Ôºö OriginatorÔºöÈúÄË¶Å‰øùÂ≠òÁä∂ÊÄÅÁöÑÂØπË±°„ÄÇË¥üË¥£ÂàõÂª∫‰∏Ä‰∏™Â§áÂøòÂΩïÔºåÂèØ‰ª•ËÆ∞ÂΩï„ÄÅÊÅ¢Â§çËá™Ë∫´ÁöÑÂÜÖÈÉ®Áä∂ÊÄÅ„ÄÇÂêåÊó∂ Originator ËøòÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂÜ≥ÂÆö Memento Â≠òÂÇ®Ëá™Ë∫´ÁöÑÂì™‰∫õÂÜÖÈÉ®Áä∂ÊÄÅ„ÄÇ MementoÔºàÁ±ª‰ºº‰∫é pojo Á±ªÔºâÂ§áÂøòÂΩïËßíËâ≤„ÄÇÁî®‰∫éÂ≠òÂÇ® Originator ÂÜÖÈÉ®Áä∂ÊÄÅÔºåÂπ∂‰∏îÂèØ‰ª•Èò≤Ê≠¢ Originator ‰ª•Â§ñÁöÑÂØπË±°ËÆøÈóÆ Memento CaretakerÔºöË¥üË¥£Â≠òÂÇ®Â§áÂøòÂΩïÔºå‰∏çËÉΩÂØπÂ§áÂøòÂΩïÁöÑÂÜÖÂÆπËøõË°åÊìç‰ΩúÂíåËÆøÈóÆÔºåÂè™ËÉΩÂ∞ÜÂ§áÂøòÂΩï‰º†ÈÄíÁªôÂÖ∂‰ªñÂØπË±°„ÄÇ AndroidÊ∫êÁ†Å‰∏≠ÁöÑÂ§áÂøòÂΩïÊ®°ÂºèÊó•Â∏∏ÂºÄÂèë‰∏≠Â¶ÇÊûúÈúÄË¶Å‰øùÂ≠ò‰ªÄ‰πàÊï∞ÊçÆ‰ª•Èò≤Ê≠¢ Activity ÊÑèÂ§ñÈîÄÊØÅÔºåÁ¨¨‰∏ÄÊó∂Èó¥‰ºöÊÉ≥Âà∞ Activity ‰∏≠ÁöÑËøô‰∏§‰∏™ÊñπÊ≥ï‚Äî‚ÄîonSaveInstanceState„ÄÅonRestoreInstanceState„ÄÇÂÖ∂ÂÜÖÈÉ®ÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïÂÆûÁé∞Êï∞ÊçÆ‰øùÂ≠òÁöÑÂë¢Ôºü ÂÖàÈÄèÊºè‰∏Ä‰∏ãÔºåËøôÈáåÈù¢‰ΩøÁî®Âà∞‰∫ÜÂ§áÂøòÂΩïÊ®°Âºè„ÄÇ 123456789101112protected void onSaveInstanceState(Bundle outState) &#123; //1. Â≠òÂÇ®Á™óÂè£ÁöÑËßÜÂõæÊ†ëÁöÑÁä∂ÊÄÅ outState.putBundle(WINDOW_HIERARCHY_TAG, mWindow.saveHierarchyState()); //2. Â≠òÂÇ® Fragment ‰∏≠ÁöÑÁä∂ÊÄÅ Parcelable p = mFragments.saveAllState(); if (p != null) &#123; outState.putParcelable(FRAGMENTS_TAG, p); &#125; //3. Ëã•Áî®Êà∑ËÆæÁΩÆ‰∫Ü Activity ÁöÑ ActivityLifeCycleCallbacksÔºå //ÂàôË∞ÉÁî® ActivityLifeCycleCallbacks ÁöÑ onSaveInstanceState ËøõË°åÂ≠òÂÇ®Áä∂ÊÄÅ„ÄÇ getApplication().dispatchActivitySaveInstanceState(this, outState);&#125; Activity.onSaveInstanceState ÊñπÊ≥ï‰∏≠‰∏ªË¶ÅÂÅö‰∫Ü‰∏â‰ª∂‰∫ã Â≠òÂÇ®Á™óÂè£ÁöÑËßÜÂõæÊ†ëÁöÑÁä∂ÊÄÅ Â≠òÂÇ® Fragment ‰∏≠ÁöÑÁä∂ÊÄÅ Ëã•Áî®Êà∑ËÆæÁΩÆ‰∫Ü Activity ÁöÑ ActivityLifeCycleCallbacksÔºåÂàôË∞ÉÁî® ActivityLifeCycleCallbacks ÁöÑ onSaveInstanceState ËøõË°åÂ≠òÂÇ®Áä∂ÊÄÅ„ÄÇ È¶ñÂÖàÁúãÁúãÊ≠•È™§ 1ÔºåËØ•Ê≠•È™§Â∞Ü Window ÂØπË±°‰∏≠ÁöÑËßÜÂõæÊ†ë‰∏≠ÁöÑÂêÑ‰∏™ View Áä∂ÊÄÅÂ≠òÂÇ®Âà∞ Bundle ‰∏≠„ÄÇ Window ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Âú® PhoneWindow ‰∏≠.‰ª•‰∏ã‰∏∫ PhoneWindow.saveHierarchyState ÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ 12345678910111213141516171819202122232425262728293031public Bundle saveHierarchyState() &#123; Bundle outState = new Bundle(); if (mContentParent == null) &#123; return outState; &#125; // SparseArray Áõ∏ÂΩì‰∫é‰∏Ä‰∏™ key ‰∏∫ Êï¥ÂûãÁöÑ map SparseArray&lt;Parcelable&gt; states = new SparseArray&lt;Parcelable&gt;(); //Ê≠§Â§ÑÁöÑ mContentParent Â∞±ÊòØÊàë‰ª¨ setContentView Êó∂ËÆæÁΩÆÁöÑ View mContentParent.saveHierarchyState(states); outState.putSparseParcelableArray(VIEWS_TAG, states); // ÊåÅÊúâÁÑ¶ÁÇπÁöÑ View ÂøÖÈ°ªËÆæÁΩÆ idÔºåÂê¶ÂàôÈáçÊñ∞ËøõÂÖ•ËØ•ÁïåÈù¢Êó∂‰∏ç‰ºöÊÅ¢Â§çÂÆÉÁöÑÁÑ¶ÁÇπÁä∂ÊÄÅ final View focusedView = mContentParent.findFocus(); if (focusedView != null &amp;&amp; focusedView.getId() != View.NO_ID) &#123; outState.putInt(FOCUSED_ID_TAG, focusedView.getId()); &#125; // Â≠òÂÇ®Êï¥‰∏™Èù¢ÊùøÁöÑÁä∂ÊÄÅ SparseArray&lt;Parcelable&gt; panelStates = new SparseArray&lt;Parcelable&gt;(); savePanelState(panelStates); if (panelStates.size() &gt; 0) &#123; outState.putSparseParcelableArray(PANELS_TAG, panelStates); &#125; // ‰øùÂ≠ò actionbar ÁöÑÁä∂ÊÄÅ if (mDecorContentParent != null) &#123; SparseArray&lt;Parcelable&gt; actionBarStates = new SparseArray&lt;Parcelable&gt;(); mDecorContentParent.saveToolbarHierarchyState(actionBarStates); outState.putSparseParcelableArray(ACTION_BAR_TAG, actionBarStates); &#125; return outState;&#125; ÁúãÁúãÊ≠•È™§ 2 ‰∏≠ÁöÑ mContentParent.saveHierarchyState ÊñπÊ≥ïÔºåmContentParent ÊòØ‰∏Ä‰∏™ ViewGroup ‰ΩÜÊòØ saveHierarchyState ÊñπÊ≥ïÂπ∂‰∏çÊòØÂÆö‰πâÂú® ViewGroup ‰∏≠ÔºåËÄåÊòØÂÆö‰πâÂú®ÂÆÉÁöÑÁà∂Á±ª‚Äî‚ÄîView ‰∏≠ÔºåÊü•Áúã‰∏ãËØ•ÊñπÊ≥ïÂú® View ‰∏≠ÁöÑÂÆûÁé∞„ÄÇ123public void saveHierarchyState(SparseArray&lt;Parcelable&gt; container) &#123; dispatchSaveInstanceState(container);&#125; 12345678910111213141516protected void dispatchSaveInstanceState(SparseArray&lt;Parcelable&gt; container) &#123; //1. Âè™ÊúâÂê´Êúâ id ÁöÑ ViewÔºåÁä∂ÊÄÅÊâç‰ºöË¢´Â≠òÂÇ® if (mID != NO_ID &amp;&amp; (mViewFlags &amp; SAVE_DISABLED_MASK) == 0) &#123; mPrivateFlags &amp;= ~PFLAG_SAVE_STATE_CALLED; //2. Ë∞ÉÁî® onSaveInstanceState ÊñπÊ≥ïËé∑ÂèñËá™Ë∫´Áä∂ÊÄÅ Parcelable state = onSaveInstanceState(); if ((mPrivateFlags &amp; PFLAG_SAVE_STATE_CALLED) == 0) &#123; throw new IllegalStateException( "Derived class did not call super.onSaveInstanceState()"); &#125; //3. Â∞ÜËá™Ë∫´Áä∂ÊÄÅÂ≠òÊîæÂà∞ container ‰∏≠ if (state != null) &#123; container.put(mID, state); &#125; &#125;&#125; View.onSaveInstanceState ÊñπÊ≥ïÈªòËÆ§Â≠òÂÇ®ÁöÑÁä∂ÊÄÅ‰∏∫Á©∫Áä∂ÊÄÅ„ÄÇ‰ΩÜÊòØÂÆÉÁöÑÂ≠êÁ±ªÈÄöÂ∏∏ÈÉΩÊúâÂÆö‰πâËá™Ë∫´ÁöÑË¶ÜÁõñÊñπÊ≥ï„ÄÇ12345678910@CallSuperprotected Parcelable onSaveInstanceState() &#123; mPrivateFlags |= PFLAG_SAVE_STATE_CALLED; if (mStartActivityRequestWho != null) &#123; BaseSavedState state = new BaseSavedState(AbsSavedState.EMPTY_STATE); state.mStartActivityRequestWhoSaved = mStartActivityRequestWho; return state; &#125; return BaseSavedState.EMPTY_STATE;&#125; Ê≠•È™§ 2 ‰∏≠ÁöÑ View ÁöÑË∞ÉÁî®Â§ßËá¥Â¶Ç‰∏ãÔºösaveHierarchyState ==„Äã dispatchSaveInstanceState ==„Äã onSaveInstanceState ÂÖ∂‰∏≠Ë¶ÅÊ≥®ÊÑèÁöÑÊòØ Âè™ÊúâÂê´Êúâ id ÁöÑ ViewÔºåÁä∂ÊÄÅÊâç‰ºöË¢´Â≠òÂÇ®ÔºåÂ¶ÇÊûúÊ≤°ÊúâÁªô view Ëµã‰∏Ä‰∏™ idÔºåÈÇ£‰πàÁ≥ªÁªüÊòØ‰∏ç‰ºöÂ∏ÆÂøô‰øùÂ≠òËØ• view ÁöÑÁä∂ÊÄÅÁöÑ„ÄÇ View Á±ª‰∏≠ÁöÑ saveHierarchyState ÊñπÊ≥ïË∞ÉÁî®‰∫ÜdispatchSaveInstanceState ÊñπÊ≥ïÁî®Êù•Â≠òÂÇ®Ëá™Ë∫´Áä∂ÊÄÅ„ÄÇ ViewGroup Ë¶ÜÂÜô‰∫Ü dispatchSaveInstanceState Êù•Â≠òÂÇ®Ëá™Ë∫´‰ª•ÂèäÂ≠êËßÜÂõæÁöÑÁä∂ÊÄÅ„ÄÇ ViewGroup.dispatchSaveInstanceStateÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö123456789101112@Overrideprotected void dispatchSaveInstanceState(SparseArray&lt;Parcelable&gt; container) &#123; super.dispatchSaveInstanceState(container); final int count = mChildrenCount; final View[] children = mChildren; for (int i = 0; i &lt; count; i++) &#123;//ÈÅçÂéÜË∞ÉÁî®Â≠ê View ÁöÑ dispatchSaveInstanceState ÊñπÊ≥ï View c = children[i]; if ((c.mViewFlags &amp; PARENT_SAVE_DISABLED_MASK) != PARENT_SAVE_DISABLED) &#123; c.dispatchSaveInstanceState(container); &#125; &#125;&#125; ÂèØ‰ª•ÁúãÂà∞ ViewGroup ÁöÑ dispatchSaveInstanceState ÊñπÊ≥ï‰ºöÂÖàË∞ÉÁî® super.dispatchSaveInstanceState(container); Â≠òÂÇ®Ëá™Ë∫´ÁöÑÁä∂ÊÄÅ„ÄÇÁÑ∂ÂêéÈÅçÂéÜË∞ÉÁî®ÊâÄÊúâÂ≠êËßÜÂõæÁöÑ dispatchSaveInstanceState(container) ÊñπÊ≥ïÊù•‰øùÂ≠òÂÆÉ‰ª¨ÁöÑÁä∂ÊÄÅÔºåÂ¶ÇÊûúÂ≠ê View ‰πüÊòØ‰∏Ä‰∏™ ViewGroupÔºåÂàô‰ºöÂÜçÊ¨°ÊâßË°åËøô‰∏™ËøáÁ®ã„ÄÇ Êàë‰ª¨‰ª• TextView ÁöÑ saveInstanceState ÊñπÊ≥ï‰∏∫‰æãÔºåÁúãÁúãÂÖ∑‰ΩìÁöÑÊéß‰ª∂ÊòØÂ¶Ç‰Ωï‰øùÂ≠òËá™Ë∫´Áä∂ÊÄÅÁöÑ„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657@Overridepublic Parcelable onSaveInstanceState() &#123; Parcelable superState = super.onSaveInstanceState(); // Save state if we are forced to final boolean freezesText = getFreezesText(); boolean hasSelection = false; int start = -1; int end = -1; //Â≠òÂÇ® TextView ÁöÑ start„ÄÅend if (mText != null) &#123; start = getSelectionStart(); end = getSelectionEnd(); if (start &gt;= 0 || end &gt;= 0) &#123; // ÊòØÂê¶Â≠òÂ≠òÂú®ÈÄâÈ°π hasSelection = true; &#125; &#125; if (freezesText || hasSelection) &#123; SavedState ss = new SavedState(superState); //‰øùÂ≠ò TextView ÁöÑÊñáÊú¨ÂÜÖÂÆπ if (freezesText) &#123; if (mText instanceof Spanned) &#123; final Spannable sp = new SpannableStringBuilder(mText); if (mEditor != null) &#123; removeMisspelledSpans(sp); sp.removeSpan(mEditor.mSuggestionRangeSpan); &#125; ss.text = sp; &#125; else &#123; ss.text = mText.toString(); &#125; &#125; //Â≠òÂÇ® TextView ÁöÑ start„ÄÅend if (hasSelection) &#123; // XXX Should also save the current scroll position! ss.selStart = start; ss.selEnd = end; &#125; if (isFocused() &amp;&amp; start &gt;= 0 &amp;&amp; end &gt;= 0) &#123; ss.frozenWithFocus = true; &#125; ss.error = getError(); if (mEditor != null) &#123; ss.editorState = mEditor.saveInstanceState(); &#125; //ËøîÂõûÁä∂ÊÄÅÂØπË±° return ss; &#125; return superState;&#125; Ë∞ÉÁî® View ÁöÑ onSaveInstance ÂáΩÊï∞‰πãÂêéÂ∞±ÂæóÂà∞‰∫Ü View Ë¶ÅÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÊ≠§Êó∂ÊâßË°åÂà∞ View ÁöÑ dispatchSaveInstanceState ÊñπÊ≥ï‰∏≠ÁöÑÊ≥®Èáä 3„ÄÇËøôÈáå‰ª• View ÁöÑ id ‰∏∫ keyÔºå‰ª•Áä∂ÊÄÅ‰∏∫ valueÔºåÂ≠òÂÇ®Âà∞ containerÔºà SparseArray Á±ªÂûãÔºâ‰∏≠„ÄÇ1234//3. Â∞ÜËá™Ë∫´Áä∂ÊÄÅÂ≠òÊîæÂà∞ container ‰∏≠if (state != null) &#123; container.put(mID, state);&#125; Â≠òÂÇ®ÂÆå Window ÁöÑËßÜÂõæÁä∂ÊÄÅ‰ø°ÊÅØ‰πãÂêéÔºå‰æø‰ºöÊâßË°åÂ≠òÂÇ® Fragment ‰∏≠ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØ„ÄÅÂõûÈÄÄÊ†àÁ≠â„ÄÇFragment ‰πüÊòØÈÄöËøáË∞ÉÁî®Ëá™Ë∫´ÁöÑ onSaveInstaceState ÊñπÊ≥ïÊù•Â≠òÂÇ®Ëá™Ë∫´ÁöÑ View ËßÜÂõæÊ†ëÁä∂ÊÄÅÁöÑ„ÄÇ ÊúÄÂêéÂ∞±ÊòØË∞ÉÁî®Áî®Êà∑ËÆæÁΩÆÁöÑ ActivityLifecycleCallbacks ÁöÑ onSaveInstaceState ÊñπÊ≥ïÔºåËÆ©Áî®Êà∑ÂÅö‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑÂ§ÑÁêÜ ÂâçÈù¢Êàë‰ª¨ÊâÄÊèêÂèäÂà∞ÁöÑÂè™ÊòØÂ§áÂøòÂΩïÊ®°Âºè‰∏≠ÁöÑ Originator ËßíËâ≤ÔºåÂç≥ÈúÄË¶Å‰øùÂ≠òÂ§áÂøòÂΩïÁöÑÂØπË±°„ÄÇ‰∏çËøá‰πüÊúâÊ∂âÂèäÂà∞ CareTaker ËßíËâ≤‚Äî‚ÄîActivity„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÂÜçÁúãÁúãÂè¶Â§ñ‰∏§‰∏™ËßíËâ≤‚Äî‚ÄîMemoto Âíå CareTaker„ÄÇ Â≠ò‰∫ÜÁä∂ÊÄÅ‰ø°ÊÅØÁöÑ Bundle Êï∞ÊçÆÂ≠òÂÇ®Âú®Âì™Ôºü onSaveInstance ÊñπÊ≥ïÊòØÂú® onStop ÊñπÊ≥ï‰πãÂâçË∞ÉÁî®ÁöÑ„ÄÇActivity.onStop ÊñπÊ≥ïÊòØÈÄöËøá Activity ÁöÑ performStopActivity Èó¥Êé•Ë∞ÉÁî®„ÄÇ123456 final void performStopActivity(IBinder token, boolean saveState, String reason) &#123; //Ëé∑Âèñ ActivityClientRecord ActivityClientRecord r = mActivities.get(token); // saveState Ë°®Á§∫ÊòØÂê¶‰øùÂ≠òÁä∂ÊÄÅ performStopActivityInner(r, null, false, saveState, reason);&#125; 1234567891011121314151617181920212223242526272829303132333435private void performStopActivityInner(ActivityClientRecord r, StopInfo info, boolean keepShown, boolean saveState, String reason) &#123; if (r != null) &#123; if (!keepShown &amp;&amp; r.stopped) &#123; if (r.activity.mFinished) &#123; // Â¶ÇÊûúÊ≠£Âú®ÊâßË°åÈîÄÊØÅËøáÁ®ãÔºåÊòØÁî®Êà∑‰∏ªÂä®ÈîÄÊØÅ„ÄÇ activity ‰∏çÊâìÁÆóÊÅ¢Â§çÔºåÊàë‰ª¨‰πüÊ≤°ÂøÖË¶ÅË∞ÉÁî® onStop ÊñπÊ≥ï return; &#125; //‰ª£Á†ÅÁúÅÁï• &#125; // Âú®Ë∞ÉÁî® onStop ‰πãÂâçÂøÖÈ°ªÂÖàË∞ÉÁî® onPause performPauseActivityIfNeeded(r, reason); //‰ª£Á†ÅÁúÅÁï• // Êé•‰∏ãÊù•ËÆ© activity ‰øùÂ≠òÂÆÉÁõÆÂâçÁöÑÁä∂ÊÄÅÂíåÂÆÉÊâÄÁÆ°ÁêÜÁöÑ dialogs if (!r.activity.mFinished &amp;&amp; saveState) &#123; if (r.state == null) &#123; // Èó¥Êé•Ë∞ÉÁî® Activity.onSaveInstance() callCallActivityOnSaveInstanceState(r); &#125; &#125; if (!keepShown) &#123; try &#123; // ÊâßË°å onStop ÊñπÊ≥ï r.activity.performStop(false /*preserveWindow*/); &#125; catch (Exception e) &#123; // ... &#125; //Â∞Ü stop Â≠óÊÆµÁΩÆ‰∏∫ true Ë°®Á§∫Â∑≤ÁªèË∞ÉÁî®‰∫Ü stop ÊñπÊ≥ï„ÄÇ r.stopped = true; &#125; &#125;&#125; 123456789101112private void callCallActivityOnSaveInstanceState(ActivityClientRecord r) &#123; r.state = new Bundle();//ÂÜÖÂÆπÂ∞±Â≠òÂÇ®Âú®ËØ• Bundle ‰∏≠ r.state.setAllowFds(false); if (r.isPersistable()) &#123; r.persistentState = new PersistableBundle(); mInstrumentation.callActivityOnSaveInstanceState(r.activity, r.state, r.persistentState); &#125; else &#123; //ËØ•ÊñπÊ≥ïÂÆûÈôÖË∞ÉÁî®‰∫Ü Activity.onSaveInstanceState ÊñπÊ≥ï mInstrumentation.callActivityOnSaveInstanceState(r.activity, r.state); &#125;&#125; 1234public void callActivityOnSaveInstanceState(Activity activity, Bundle outState, PersistableBundle outPersistentState) &#123; activity.performSaveInstanceState(outState, outPersistentState);&#125; ‰∏äÈù¢ÁöÑ performStopActivity ‰∏é performStopActivityInner ÊñπÊ≥ï‰∏≠ÔºåÈ¶ñÂÖàÈÄöËøá token ‰ªé mActivities ‰∏≠Ëé∑Âèñ‰∏Ä‰∏™ ActivityClientRecord ÂØπË±°ÔºåÁä∂ÊÄÅ‰ø°ÊÅØÂ∞±ÊòØÂ≠òÂÇ®Âú®ËøôÈáåÈù¢ÁöÑ„ÄÇËé∑ÂèñËØ•ÂØπË±°‰πãÂêéÔºåË∞ÉÁî®‰∫Ü performStopActivityInner ÊñπÊ≥ïÔºåÂØπ‰∫é‰øùÂ≠òÁä∂ÊÄÅËÄåË®ÄÔºåËØ•ÊñπÊ≥ïÂ§ßÊ¶ÇÊúâÂ¶Ç‰∏ã‰∏âÊ≠• Âà§Êñ≠ Activity ÊòØÂê¶ÈúÄË¶Å‰øùÂ≠òÁä∂ÊÄÅ Â¶ÇÊûúÈúÄË¶ÅÔºåÂàôË∞ÉÁî® onSaveInstance ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ï‰ºöÂ∞ÜÁä∂ÊÄÅ‰ø°ÊÅØÂ≠òÂÇ®Âà∞ ActivityClientRecord ‰∏≠ Ë∞ÉÁî® Activity.onStop() ÊñπÊ≥ï ÊâßË°å onStop ÊñπÊ≥ï‰πãÂâçÔºåÁ≥ªÁªü‰ºöÊ†πÊçÆÊÉÖÂÜµÊù•ÈÄâÊã©ÊòØÂê¶Â≠òÂÇ® Activity ÁöÑÁä∂ÊÄÅÔºåÂπ∂‰∏îÂ∞ÜËøô‰∫õÁä∂ÊÄÅÔºàÁÆÄ‰ªãÂú∞ÔºâÂ≠òÂÇ®Âà∞ mActivities ‰∏≠„ÄÇ mActivities ÊòØ‰∏Ä‰∏™ ArrayMap&lt;IBinder, ActivityClientRecord&gt; ÔºåÂÆÉÁª¥Êä§‰∫Ü‰∏Ä‰∏™ Activity ÁöÑ‰ø°ÊÅØË°®ÔºåÂΩì Activity ÈáçÊñ∞ÂêØÂä®Êó∂Ôºå‰ºö‰ªé mActivities ‰∏≠Êü•ËØ¢ÂØπÂ∫îÁöÑ ActivityClientRecordÔºåÂ¶ÇÊûúËøô‰∏™ËÆ∞ÂΩïÂØπË±°‰∏≠Âê´ÊúâÁä∂ÊÄÅ‰ø°ÊÅØÂ∞±Ë∞ÉÁî® Activity ÁöÑ onRestoreInstanceState ÊñπÊ≥ï„ÄÇÂºÄÂèë‰∫∫ÂëòÂèØ‰ª•‰ªéËøô‰∏™ÊñπÊ≥ï‰∏≠ÂÅö‰∏Ä‰∫õÁä∂ÊÄÅÊÅ¢Â§çÊìç‰Ωú„ÄÇ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123; //‰ª£Á†ÅÁúÅÁï• Activity activity = null; try &#123; java.lang.ClassLoader cl = r.packageInfo.getClassLoader(); //1. ÊûÑÂª∫ Activity activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent); //‰ª£Á†ÅÁúÅÁï• &#125; catch (Exception e) &#123; //‰ª£Á†ÅÁúÅÁï• &#125; try &#123; //2. ÂàõÂª∫‰∏Ä‰∏™ Application ÂØπË±° Application app = r.packageInfo.makeApplication(false, mInstrumentation); //‰ª£Á†ÅÁúÅÁï• if (activity != null) &#123; //ÂàõÂª∫ appContextÔºåÁ±ªÂûã‰∏∫ ContextImpl Context appContext = createBaseContextForActivity(r, activity); //‰ª£Á†ÅÁúÅÁï• //3. ÂÖ≥ËÅî appContext„ÄÅApplication Á≠âÂØπË±°Âà∞ Activity ‰∏≠ activity.attach(appContext, this, getInstrumentation(), r.token, r.ident, app, r.intent, r.activityInfo, title, r.parent, r.embeddedID, r.lastNonConfigurationInstances, config, r.referrer, r.voiceInteractor, window); //‰ª£Á†ÅÁúÅÁï• activity.mCalled = false; //4. Ë∞ÉÁî® Activity.onCreate ÊñπÊ≥ï if (r.isPersistable()) &#123; mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState); &#125; else &#123; mInstrumentation.callActivityOnCreate(activity, r.state); &#125; //‰ª£Á†ÅÁúÅÁï• r.activity = activity; r.stopped = true; if (!r.activity.mFinished) &#123; //Ë∞ÉÁî® onStart ÊñπÊ≥ï activity.performStart(); r.stopped = false; &#125; //5. Â¶ÇÊûúÊúâ‰øùÂ≠òÁä∂ÊÄÅÁöÑËØùÔºåË∞ÉÁî® Activity.onRestoreInstanceState ÊñπÊ≥ïÊÅ¢Â§çÁä∂ÊÄÅ if (!r.activity.mFinished) &#123; if (r.isPersistable()) &#123; if (r.state != null || r.persistentState != null) &#123; mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state, r.persistentState); &#125; &#125; else if (r.state != null) &#123; mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state); &#125; &#125; //‰ª£Á†ÅÁúÅÁï• &#125; r.paused = true; //6. Â∞Ü Activity ÁöÑ‰ø°ÊÅØËÆ∞ÂΩïÂØπË±°‚Äî‚ÄîActivityClientRecord Â≠òÂÇ®Âà∞ mActivities ‰∏≠„ÄÇ mActivities.put(r.token, r); &#125; catch (SuperNotCalledException e) &#123; throw e; &#125; return activity;&#125; Âú®‰∏äÈù¢ÁöÑÊ≥®Èáä 5 Â§ÑÔºåÁ≥ªÁªü‰ºöÂà§Êñ≠ Activity ÊòØÂê¶Ë∞ÉÁî®Ëøá‰∫Ü Activity.finish() ÊñπÊ≥ï„ÄÅÊòØÂê¶ÊòØ„ÄåÊ∞∏‰πÖÁöÑ„Äç‰ª•Âèä ActivityClientRecord ÂØπË±°‰∏≠ÁöÑ state ÊòØÂê¶‰∏∫Á©∫Ôºå Â¶ÇÊûúÊª°Ë∂≥Êù°‰ª∂ÔºåÂ∞±‰ºöËé∑ÂèñÂ≠òÂÇ®ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØ‰º†ÈÄíÁªô Activity.onRestoreInstanceState ÊñπÊ≥ïÔºå‰πü‰ºöÂ∞ÜËøô‰∫õÊï∞ÊçÆ‰º†ÈÄíÁªô onCreate ÊñπÊ≥ïÁöÑ bundle ÂèÇÊï∞ „ÄÇ ‰∏çËøá Google ÂÆòÊñπÊé®ËçêË∞ÉÁî® onRestoreInstanceState ÊñπÊ≥ïÊù•ÊÅ¢Â§çÁä∂ÊÄÅÔºåÂõ†‰∏∫Âè™ÊúâÂú®Â≠òÂÇ®ÊúâÁä∂ÊÄÅ‰ø°ÊÅØÁöÑÊó∂ÂÄôÊâç‰ºöË∞ÉÁî®ËØ•ÊñπÊ≥ïÔºåËÄåÂú® onCreate ÊñπÊ≥ï‰∏≠ËøòÈúÄË¶ÅÂÖàËøõË°åÂà§Á©∫Â§ÑÁêÜ„ÄÇ Â∞èÁªì‰∏äËø∞ËøáÁ®ã‰∏≠Â§áÂøòÂΩïÊ®°ÂºèÁöÑ‰∏âÁßçÂÖ≥ÈîÆËßíËâ≤ÂàÜÂà´Áî±‰ªÄ‰πàÁ±ªÊâÆÊºîÔºü CareTakerÔºöActivity Ë¥üË¥£Â≠òÂÇ®„ÄÅÊÅ¢Â§ç UI ÁöÑÊÄÅ‰ø°ÊÅØ„ÄÇ OriginatorÔºöActivity„ÄÅFragment„ÄÅView„ÄÅViewGroup ÔºåÊòØÈúÄË¶ÅÂ≠òÂÇ®Áä∂ÊÄÅÁöÑÂØπË±° MemotoÔºöÁî± Bundle Á±ªÊâÆÊºî Activity ‰ºöÂú®ÂÅúÊ≠¢‰πãÂâçÊ†πÊçÆ Activity ÁöÑÈÄÄÂá∫ÊÉÖÊôØÊù•ÈÄâÊã©ÊòØÂê¶ÈúÄË¶ÅÂ≠òÂÇ®Áä∂ÊÄÅ Âú®ÈáçÊñ∞ÂêØÂä®ËØ• Activity Êó∂‰ºöÂà§Êñ≠ ActivityClientRecord ÂØπË±°‰∏≠ÊòØÂê¶Â≠òÂÇ®‰∫Ü Activity ÁöÑÁä∂ÊÄÅ Â¶ÇÊûúÂê´ÊúâÁä∂ÊÄÅÔºåË∞ÉÁî® Activity.onRestoreInstanceState() ÊñπÊ≥ïÊÅ¢Â§çÁä∂ÊÄÅ„ÄÇ‰ªéËÄå‰ΩøÂæó Activity ÁöÑ UI ÂèØ‰ª•ÊÅ¢Â§çËá≥ÂºÇÂ∏∏ÈÄÄÂá∫ÂâçÁöÑÁä∂ÊÄÅ„ÄÇ ‰Ω†ÂèØËÉΩ‰ºöÈóÆÁöÑÈóÆÈ¢òonSaveInstanceState ‰ΩïÊó∂Ë¢´Ë∞ÉÁî®onSaveInstanceState() ÊñπÊ≥ï‰ºöÂú®‰ªÄ‰πàÊó∂ÂÄôË¢´ÊâßË°åÔºüÊúâËøô‰πàÂá†ÁßçÊÉÖÂÜµÔºö ÂΩìÁî®Êà∑Êåâ‰∏ã HOME ÈîÆÊó∂„ÄÇ ËøôÊòØÊòæËÄåÊòìËßÅÁöÑÔºåÁ≥ªÁªü‰∏çÁü•ÈÅì‰Ω†Êåâ‰∏ãHOMEÂêéË¶ÅËøêË°åÂ§öÂ∞ëÂÖ∂‰ªñÁöÑÁ®ãÂ∫èÔºåËá™ÁÑ∂‰πü‰∏çÁü•ÈÅìactivity AÊòØÂê¶‰ºöË¢´ÈîÄÊØÅÔºåÂõ†Ê≠§Á≥ªÁªü‰ºöË∞ÉÁî®onSaveInstanceState()ÔºåËÆ©Áî®Êà∑ÊúâÊú∫‰ºö‰øùÂ≠òÊüê‰∫õÈùûÊ∞∏‰πÖÊÄßÁöÑÊï∞ÊçÆ„ÄÇ‰ª•‰∏ãÂá†ÁßçÊÉÖÂÜµÁöÑÂàÜÊûêÈÉΩÈÅµÂæ™ËØ•ÂéüÂàô ÈïøÊåâHOMEÈîÆÔºåÈÄâÊã©ËøêË°åÂÖ∂‰ªñÁöÑÁ®ãÂ∫èÊó∂„ÄÇ Êåâ‰∏ãÁîµÊ∫êÊåâÈîÆÔºàÂÖ≥Èó≠Â±èÂπïÊòæÁ§∫ÔºâÊó∂„ÄÇ ‰ªé Activity A ‰∏≠ÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑ Activity Êó∂„ÄÇ Â±èÂπïÊñπÂêëÂàáÊç¢Êó∂Ôºå‰æãÂ¶Ç‰ªéÁ´ñÂ±èÂàáÊç¢Âà∞Ê®™Â±èÊó∂„ÄÇ onSaveInstanceState ÁöÑË∞ÉÁî®Âú® onStop ÊñπÊ≥ï‰πãÂâçÔºå‰ΩÜÊòØ‰∏é onPause ÊñπÊ≥ï‰πãÈó¥Ê≤°ÊúâÊó¢ÂÆöÂÖ≥Á≥ª„ÄÇ ÊÄªËÄåË®Ä‰πãÔºåÂΩìÁ≥ªÁªüÂ≠òÂú®„Äå==Êú™ÁªèÁî®Êà∑ËÆ∏ÂèØ==„ÄçÊó∂ÈîÄÊØÅ‰∫ÜÊàë‰ª¨ÁöÑ ActivityÔºåÂàô onSaveInstanceState() ‰ºöË¢´Á≥ªÁªüË∞ÉÁî®ÔºåËøôÊòØÁ≥ªÁªüÁöÑË¥£‰ªªÔºåÂõ†Ê≠§ÂÆÉÂøÖÈ°ªÊèê‰æõ‰∏Ä‰∏™Êú∫‰ºöËÆ©Áî®Êà∑‰øùÂ≠òÊï∞ÊçÆ„ÄÇ „ÄåÁªèÁî®Êà∑ËÆ∏ÂèØ„ÄçÁöÑÊÉÖÂÜµ‰∏çÂ§öÔºåÈÄöÂ∏∏Âè™ÊúâÁî®Êà∑Êåâ‰∏ãÂõûÈÄÄÈîÆËøô‰∏ÄÁßç„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÊòØÁî®Êà∑‰∏ªÂä®ÈÄÄÂá∫Êüê‰∏™ ActivityÔºåÁ≥ªÁªü‰∏ç‰ºöË∞ÉÁî® onSaveInstanceState() ÊñπÊ≥ï„ÄÇ ÂêÑ‰∏™ „ÄåOriginator „Äç ÁöÑ onSaveInstanceState() ÊñπÊ≥ïÁöÑÈªòËÆ§ÂÆûÁé∞ÊòØÊÄé‰πàÊ†∑ÁöÑÔºüÂú®ÂâçÈù¢ÁöÑÂàÜÊûê‰∏≠Êàë‰ª¨Áü•ÈÅìÂç≥‰ΩøÊ≤°ÊúâË¶ÜÂÜô onSaveInstanceState()ÊñπÊ≥ï, ViewGroup„ÄÅView„ÄÅFragment„ÄÅActivity ÂÜÖÈÉ®ÈÉΩÊúâËá™Â∑±ÁöÑÈªòËÆ§ÂÆûÁé∞ÔºåÂÆÉ‰ª¨ÁöÑÈªòËÆ§ÂÆûÁé∞‰πü‰ºö‰øùÂ≠òÊüê‰∫õÁä∂ÊÄÅÊï∞ÊçÆ„ÄÇ ÊØîÂ¶Ç activity ‰∏≠ÂêÑÁßç UI Êéß‰ª∂ÁöÑÁä∂ÊÄÅ„ÄÇandroid Â∫îÁî®Ê°ÜÊû∂‰∏≠ÂÆö‰πâÁöÑÂá†‰πéÊâÄÊúâ UI Êéß‰ª∂ÈÉΩÊÅ∞ÂΩìÁöÑÂÆûÁé∞‰∫Ü onSaveInstanceState() ÊñπÊ≥ï,Âõ†Ê≠§ÂΩì Activity Ë¢´ÈîÄÊØÅÂíåÈáçÂª∫Êó∂, Ëøô‰∫õ UI Êéß‰ª∂‰ºöËá™Âä®‰øùÂ≠òÂíåÊÅ¢Â§çÁä∂ÊÄÅÊï∞ÊçÆ. EditText Êéß‰ª∂‰ºöËá™Âä®‰øùÂ≠òÂíåÊÅ¢Â§çËæìÂÖ•ÁöÑÊï∞ÊçÆ CheckBox Êéß‰ª∂‰ºöËá™Âä®‰øùÂ≠òÂíåÊÅ¢Â§çÈÄâ‰∏≠Áä∂ÊÄÅ ‚Ä¶ ÂºÄÂèëËÄÖÂè™ÈúÄË¶Å‰∏∫Ëøô‰∫õÊéß‰ª∂ÊåáÂÆö‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑ id(ÈÄöËøáËÆæÁΩÆ android:id Â±ûÊÄßÂç≥ÂèØ), Ââ©‰ΩôÁöÑ‰∫ãÊÉÖÂ∞±ÂèØ‰ª•Ëá™Âä®ÂÆåÊàê‰∫Ü Ê≥®ÊÑèÔºöÂ¶ÇÊûúÊ≤°Êúâ‰∏∫Êéß‰ª∂ÊåáÂÆöID, ÂàôËøô‰∏™Êéß‰ª∂Â∞±‰∏ç‰ºöËøõË°åËá™Âä®ÁöÑÊï∞ÊçÆ‰øùÂ≠òÂíåÊÅ¢Â§çÊìç‰Ωú„ÄÇ Áî±‰∏äÊâÄËø∞, Â¶ÇÊûúÊàë‰ª¨ÈúÄË¶ÅË¶ÜÂÜô onSaveInstanceState() ÊñπÊ≥ï, ‰∏ÄËà¨‰ºöÂú®Á¨¨‰∏ÄË°å‰ª£Á†Å‰∏≠Ë∞ÉÁî®ËØ•ÊñπÊ≥ïÁöÑÈªòËÆ§ÂÆûÁé∞:super.onSaveInstanceState(outState)„ÄÇ ÊúâÈªòËÆ§ÂÆûÁé∞ÔºåËøòÈúÄË¶ÅÈáçÂÜô onSaveInstanceState() ÊñπÊ≥ïÂêóÔºüÊó¢ÁÑ∂ËØ•ÊñπÊ≥ïÁöÑÈªòËÆ§ÂÆûÁé∞ÂèØ‰ª•Ëá™Âä®ÁöÑ‰øùÂ≠òUIÊéß‰ª∂ÁöÑÁä∂ÊÄÅÊï∞ÊçÆ, ÈÇ£‰ªÄ‰πàÊó∂ÂÄôÈúÄË¶ÅË¶ÜÂÜôËØ•ÊñπÊ≥ïÂë¢? Â¶ÇÊûúÈúÄË¶Å‰øùÂ≠òÈ¢ùÂ§ñÁöÑÊï∞ÊçÆÊó∂, Â∞±ÈúÄË¶ÅË¶ÜÂÜô onSaveInstanceState() ÊñπÊ≥ï„ÄÇÂ§ßÂÆ∂ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºöonSaveInstanceState()ÊñπÊ≥ïÂè™ÈÄÇÂêà‰øùÂ≠òÁû¨ÊÄÅÊï∞ÊçÆ, ÊØîÂ¶Ç UI Êéß‰ª∂ÁöÑÁä∂ÊÄÅÔºåÊàêÂëòÂèòÈáèÁöÑÂÄºÁ≠âÔºåËÄå‰∏çÂ∫îËØ•Áî®Êù•‰øùÂ≠òÊåÅ‰πÖÂåñÊï∞ÊçÆÔºåÊåÅ‰πÖÂåñÊï∞ÊçÆÂ∫îËØ•ÂΩìÁî®Êà∑Á¶ªÂºÄÂΩìÂâçÁöÑ activityÊó∂ÔºåÂú® onPause() ‰∏≠‰øùÂ≠òÔºàÊØîÂ¶ÇÂ∞ÜÊï∞ÊçÆ‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÊàñÊñá‰ª∂‰∏≠Ôºâ„ÄÇËØ¥Âà∞ËøôÈáåÔºåËøòË¶ÅËØ¥‰∏ÄÁÇπÁöÑÂ∞±ÊòØÂú®onPause()‰∏≠‰∏çÈÄÇÂêàÁî®Êù•‰øùÂ≠òÊØîËæÉË¥πÊó∂ÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª•ËøôÁÇπË¶ÅÁêÜËß£„ÄÇ Âè¶Â§ñÁî±‰∫é onSaveInstanceState() ÊñπÊ≥ïÊñπÊ≥ï‰∏ç‰∏ÄÂÆö‰ºöË¢´Ë∞ÉÁî®, Âõ†Ê≠§‰∏çÈÄÇÂêàÂú®ËØ•ÊñπÊ≥ï‰∏≠‰øùÂ≠òÊåÅ‰πÖÂåñÊï∞ÊçÆ, ‰æãÂ¶ÇÂêëÊï∞ÊçÆÂ∫ì‰∏≠ÊèíÂÖ•ËÆ∞ÂΩïÁ≠â„ÄÇ ‰øùÂ≠òÊåÅ‰πÖÂåñÊï∞ÊçÆÁöÑÊìç‰ΩúÂ∫îËØ•ÊîæÂú® onPause() ‰∏≠„ÄÇËã•ÊòØÊ∞∏‰πÖÊÄßÂÄºÔºåÂàôÂú® onPause() ‰∏≠‰øùÂ≠òÔºõËã•ÊúâÂ§ßÈáèË¶Å‰øùÂ≠òÁöÑÊï∞ÊçÆÔºåÂàôÂè¶ÂºÄÁ∫øÁ®ãÔºå‰ª•ÂÖçÈòªÂ°û UI Á∫øÁ®ã„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Android ÂºÄÂèë‰πã instanceStateËØ¶Ëß£]]></content>
      <categories>
        <category>ËÆæËÆ°Ê®°Âºè</category>
        <category>Android ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
      </categories>
      <tags>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
        <tag>Android ÂéüÁêÜÂàÜÊûê</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê∑±ÂÖ•ÁêÜËß£ ThreadLocal]]></title>
    <url>%2Fblog%2F2017%2F08%2F21%2F%E7%90%86%E8%A7%A3%20ThreadLocal%2F</url>
    <content type="text"><![CDATA[ThreadLocal ÊòØ‰ªÄ‰πàÔºüThreadLocal ÊòØ‰∏Ä‰∏™Á∫øÁ®ãÂÜÖÈÉ®ÁöÑÊï∞ÊçÆÂ≠òÂÇ®Á±ªÔºåÈÄöËøáÂÆÉÂèØ‰ª•Âú®ÊåáÂÆöÁöÑÁ∫øÁ®ã‰∏≠Â≠òÂÇ®Êï∞ÊçÆÔºåÊï∞ÊçÆÂ≠òÂÇ®ÂêéÔºåÂè™ÊúâÂú®ÊåáÂÆöÁ∫øÁ®ã‰∏≠ÊâçËÉΩËé∑ÂèñÂà∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÂØπ‰∫éÂÖ∂‰ªñÁ∫øÁ®ãÊù•ËØ¥ÂàôÊó†Ê≥ïËé∑ÂèñÂà∞Êï∞ÊçÆ„ÄÇ ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî® ThreadLocalÔºü‰ªéÂÆö‰πâÊàë‰ª¨Áü•ÈÅì ThreadLocal ÊòØ‰∏Ä‰∏™Áî®‰∫éÂ≠òÂÇ®Êú¨Á∫øÁ®ãÂÜÖÈÉ®Êï∞ÊçÆÁöÑÁ±ª„ÄÇÂÅáËÆæÊ≤°Êúâ ThreadLocal ÁöÑËØùÔºåÊØè‰∏™ Thread ‰∏≠ÂèØ‰ª•ËæìÂÖ•Ëá™Â∑±ÁöÑ‰∏Ä‰∏™Êú¨Âú∞ÂèòÈáèÔºå‰ΩÜÊòØÂú®Êï¥‰∏™ Thread ÁöÑÁîüÂëΩÂë®Êúü‰∏≠ÔºåÂ¶ÇÊûúË¶ÅÁ©øÊ¢≠ÂæàÂ§ö class ÁöÑÂæàÂ§ö method Êù•‰ΩøÁî®Ëøô‰∏™Êú¨Âú∞ÂèòÈáèÁöÑËØùÔºåÂ∞±Ë¶Å‰∏ÄÁõ¥‰∏ÄÁõ¥Âêë‰∏ã‰º†ÈÄÅËøô‰∏™ÂèòÈáèÔºåÊòæÁÑ∂ÂæàÈ∫ªÁÉ¶„ÄÇÈÇ£‰πàÊÄé‰πàÊâçËÉΩÂú®Ëøô‰∏™ Thread ÁöÑÁîüÂëΩ‰∏≠ÔºåÂú®‰ªª‰ΩïÂú∞ÊñπÈÉΩËÉΩÂ§üÊñπ‰æøÁöÑËÆøÈóÆÂà∞Ëøô‰∏™ÂèòÈáèÂë¢ÔºåËøôÊó∂ÂÄô ThreadLocal Â∞±ËØûÁîü‰∫Ü„ÄÇ ThreadLocal Â∞±ÊòØËøô‰πà‰∏™‰ΩúÁî®ÔºåÈô§Ê≠§‰πãÂ§ñÂíåÈÄöÂ∏∏‰ΩøÁî®ÁöÑÊú¨Âú∞ÂèòÈáèÊ≤°Êúâ‰ªª‰ΩïÂå∫Âà´„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÊ≤°Êúâ ThreadLocal ‰πüÊòØÂèØ‰ª•Ëß£ÂÜ≥ÈóÆÈ¢òÁöÑÔºå‰ΩÜÊòØ‰ºöÊØîËæÉÈ∫ªÁÉ¶ÔºåThreadLocal ÁöÑ‰ΩúÁî®‰æøÊòØÁÆÄÂåñÁ∫øÁ®ãÂÜÖÈÉ®Êï∞ÊçÆÁöÑ‰ΩøÁî®ÊµÅÁ®ã„ÄÇ ThreadLocal ÁöÑÂÜÖÈÉ®ÂÆûÁé∞Êó¢ÁÑ∂ÊòØÁ∫øÁ®ãÁöÑÊú¨Âú∞ÂèòÈáèÔºåÈÇ£Ëá™ÁÑ∂‰∏éÁ∫øÁ®ãÊúâÁùÄÂØÜÂàáÁöÑËÅîÁ≥ª„ÄÇ ÊâìÂºÄ Thread ÁöÑÊ∫êÁ†ÅÂèØ‰ª•ÁúãÂà∞ÔºåÊ∫êÁ†Å‰∏≠Êúâ‰∏Ä‰∏™Á±ªÂûã‰∏∫ ThreadLocal.ThreadLocalMap ÁöÑÂèòÈáè1ThreadLocal.ThreadLocalMap threadLocals = null; ThreadLocal#get ÊµÅÁ®ãÊàë‰ª¨‰ª• ThreadLocal#get ÊñπÊ≥ï‰Ωú‰∏∫ÂàÜÊûêÁöÑÊ∫êÂ§¥„ÄÇËøô‰∫õÊñπÊ≥ïÁöÑÈÄªËæëÈÉΩÊØîËæÉÁÆÄÂçïÔºåÂõ†Ê≠§Áõ¥Êé•Âú®Ê≥®Èáä‰∏≠ËØ¥Êòé„ÄÇÂèØÂèÇËÄÉÂ∞èÁªìÈÉ®ÂàÜÁöÑË∞ÉÁî®ÊµÅÁ®ãÂõæ„ÄÇ 12345678910public T get() &#123; Thread t = Thread.currentThread();//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã ThreadLocalMap map = getMap(t);//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±° if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this);//Ëé∑ÂèñÂ≠òÂÇ®ËØ• ThreadLocal ÁöÑ Entry if (e != null) return (T)e.value;//Ëé∑ÂèñÁõÆÊ†áÂÄºÂπ∂ËøîÂõû &#125; return setInitialValue();//ËÆæÁΩÆÂàùÂßãÂÄº&#125; ThreadLocal#getMapÔºåËØ•ÊñπÊ≥ïËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±°„ÄÇ 123ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals;&#125; Entry Á±ªÁªßÊâøËá™Âº±ÂºïÁî®ÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇÂÖ∂‰∏≠Â≠òÂÇ®‰∫Ü ThreadLocal ‰ª•ÂèäÂØπÂ∫îÁöÑÂÄº 12345678static class Entry extends WeakReference&lt;ThreadLocal&gt; &#123; Object value; Entry(ThreadLocal k, Object v) &#123; super(k); value = v; &#125;&#125; ThreadLocal#setInitialValue 12345678910private T setInitialValue() &#123; T value = initialValue();//Ëé∑ÂèñÈªòËÆ§ÁöÑÂàùÂßãÂÄº Thread t = Thread.currentThread();//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã ThreadLocalMap map = getMap(t);//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±° if (map != null) map.set(this, value);//ÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±°‰∏ç‰∏∫Á©∫ÔºåÁõ¥Êé•ËÆæÁΩÆÁªôÁõÆÊ†áÂØπË±°„ÄÇ else createMap(t, value);//‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫ ThreadLocalMap ÂØπË±°„ÄÇ return value;&#125; ThreadLocal#initialValue 123456//ËØ•ÊñπÊ≥ïÁöÑË∞ÉÁî®Êó∂Êú∫Ôºö//1. ÈÄöÂ∏∏ËØ•ÊñπÊ≥ïÂè™‰ºöË¢´Ë∞ÉÁî®‰∏ÄÊ¨°Ôºå‰πüÂ∞±ÊòØÂú®Á¨¨‰∏ÄÊ¨°ÂàùÂßãÂåñÊó∂//2. Ë∞ÉÁî®‰∫Ü ThreadLocal#remove ÊñπÊ≥ï‰πãÂêéÔºà‰ΩøÂæó Entry Ë¢´ÂõûÊî∂ÔºâÔºåÂÜçË∞ÉÁî® ThreadLocal#get ÊñπÊ≥ïprotected T initialValue() &#123; return null;//ÔºõÈªòËÆ§ÂÆûÁé∞‰∏∫ËøîÂõû null&#125; ThreadLocal#createMap 123void createMap(Thread t, T firstValue) &#123; t.threadLocals = new ThreadLocalMap(this, firstValue);//Ë∞ÉÁî®ÊûÑÈÄ†ÊñπÊ≥ïÂàùÂßãÂåñ&#125; ThreadLocal#set ÊµÅÁ®ã12345678public void set(T value) &#123; Thread t = Thread.currentThread();//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã ThreadLocalMap map = getMap(t);//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±° if (map != null) map.set(this, value);//ÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ÂØπË±° Â∑≤ÁªèÂ≠òÂú®Áõ¥Êé•ËÆæÁΩÆÂÄº else createMap(t, value);//‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫ ThreadLocalMap &#125; ÂèØ‰ª•ÁúãÂà∞ ThreadLocal#set ÊñπÊ≥ïÁöÑÈÄªËæë‰∏é ThreadLocal#setInitialValue ÊñπÊ≥ï‰∏≠ÁöÑÈÄªËæëÂ¶ÇÂá∫‰∏ÄËæôÔºåËøôÈáå‰∏çÂÜçËµòËø∞„ÄÇ ThreadLocalMapThreadLocalMap ÊòØ ThreadLocal ÁöÑ‰∏Ä‰∏™ÈùôÊÄÅÂÜÖÈÉ®Á±ª„ÄÇÂÖ∂‰∏≠‰ª•ÈîÆÂÄºÂØπÁöÑÂΩ¢ÂºèÂ≠òÂÇ®Êï∞ÊçÆ„ÄÇÂèØ‰ª•Â∞ÜÂÆÉÁÆÄÂçïÁêÜËß£‰∏∫‰∏Ä‰∏™ HashMap„ÄÇThreadLocal#createMap ÊñπÊ≥ïÈÄöËøáË∞ÉÁî® ThreadLocalMap ÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ ThreadLocalMap ÂØπË±°„ÄÇ ThreadLocalMap ÁöÑÊûÑÈÄ†ÊñπÊ≥ï1234567ThreadLocalMap(ThreadLocal firstKey, Object firstValue) &#123; table = new Entry[INITIAL_CAPACITY];//ÂàõÂª∫‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫ 16 ÁöÑ Entry Êï∞ÁªÑ int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);//ËÆ°ÁÆó key ÁöÑÂìàÂ∏åÂÄº table[i] = new Entry(firstKey, firstValue);//Â∞Ü Entry Â≠òÂà∞ÊåáÂÆö‰ΩçÁΩÆ„ÄÇ size = 1; setThreshold(INITIAL_CAPACITY);&#125; ThreadLocalMap ÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏ªË¶ÅÂÅö‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ãÔºö È¶ñÂÖàÂàõÂª∫‰∫Ü‰∏Ä‰∏™ Entry Êï∞ÁªÑÔºå Entry ÊòØ ThreadLocalMap ‰∏≠ÁöÑ‰∏Ä‰∏™ÈùôÊÄÅÂÜÖÈÉ®Á±ª,ÂÆÉ‰ª• ThreadLocal ‰∏∫ keyÔºå‰ª•Ë¶ÅÂ≠òÂÇ®ÁöÑÂÄº‰∏∫ value„ÄÇ ÁÑ∂ÂêéÊ†πÊçÆ key ËÆ°ÁÆó Hash ÂÄº Êé•ÁùÄÂàõÂª∫‰∏Ä‰∏™ Entry ÂØπË±°Â≠òÂÇ®Âú®Êï∞ÁªÑ‰∏≠ ÊúÄÂêéËÆæÁΩÆÂ§ßÂ∞èÂíåÈòàÂÄº„ÄÇ ThreadLocalMap.Entry123456789static class Entry extends WeakReference&lt;ThreadLocal&gt; &#123; /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal k, Object v) &#123; super(k); value = v; &#125;&#125; Entry ‰Ωú‰∏∫ ThreadLocalMap ÁöÑÂÖÉÁ¥†ÔºåË°®Á§∫ÁöÑÊòØ‰∏Ä‰∏™ÈîÆÂÄºÂØπÔºöThreadLocal ÁöÑÂº±ÂºïÁî®‰∏∫ÈîÆÔºåÂ∞ÜË¶ÅÁî® ThreadLocal Â≠òÂÇ®ÁöÑÂØπË±°‰∏∫ÂÄº„ÄÇ Ëß£ÂÜ≥ÂÜ≤Á™ÅÁöÑÊñπÂºèÁ∫øÊÄßÊé¢ÊµãÊ≥ï„ÄÇ 123456789101112131415161718 /*ThreadLocals ‰æùËµñ‰∫éÈôÑÂä†Âà∞ÊØè‰∏™Á∫øÁ®ãÔºàThread.threadLocalsÂíåinheritableThreadLocalsÔºâÁöÑÁ∫øÊÄßÊé¢Êµã HashMap„ÄÇ ThreadLocalÂØπË±°‰Ωú‰∏∫ÈîÆÔºåÈÄöËøáthreadLocalHashCodeËøõË°åÊêúÁ¥¢„ÄÇËøôÊòØ‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑ hash codeÔºà‰ªÖÂú®ThreadLocalMaps‰∏≠ÊúâÁî®ÔºâÔºåÂèØ‰ª•Ê∂àÈô§Â∏∏ËßÅÊÉÖÂÜµ‰∏ãÁöÑÂÜ≤Á™ÅÔºåËÄåÂú®‰∏çÂ∏∏ËßÅÁöÑÊÉÖÂÜµ‰∏ã‰πüËÉΩË°®Áé∞ËâØÂ•Ω„ÄÇ*/private final int threadLocalHashCode = nextHashCode();private static AtomicInteger nextHashCode = new AtomicInteger();/** * The difference between successively generated hash codes - turns * implicit sequential thread-local IDs into near-optimally spread * multiplicative hash values for power-of-two-sized tables. */private static final int HASH_INCREMENT = 0x61c88647;//Ôºà1640531527ÔºâÂçÅËøõÂà∂/** * Returns the next hash code. */private static int nextHashCode() &#123; return nextHashCode.getAndAdd(HASH_INCREMENT);&#125; java.lang.ThreadLocal.ThreadLocalMap#getEntryAfterMiss 12345678910111213141516private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123; Entry[] tab = table; int len = tab.length; while (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) return e; if (k == null) expungeStaleEntry(i); else i = nextIndex(i, len); e = tab[i]; &#125; return null;&#125; java.lang.ThreadLocal.ThreadLocalMap#nextIndex 123private static int nextIndex(int i, int len) &#123; return ((i + 1 &lt; len) ? i + 1 : 0);&#125; ThreadLocal ‰ºöÈÄ†ÊàêÂÜÖÂ≠òÊ≥ÑÊºèÔºüÂõ†‰∏∫‰Ωú‰∏∫ key ÁöÑ ThreadLocal ÊòØÂº±ÂºïÁî®ÔºåÊâÄ‰ª•‰∏ÄÂèëÁîü GC ÔºåThreadLocal Â∞±‰ºöË¢´ÂõûÊî∂ÔºåËøô‰∏™Êó∂ÂÄô Map ‰∏≠Â≠òÂú®‰∏Ä‰∏™ Key ‰∏∫ null ÁöÑÈîÆÂÄºÂØπÔºå‰ΩÜÊòØ value ‰ªçÁÑ∂Ë¢´Á∫øÁ®ãÂº∫ÂºïÁî®ÁùÄÔºåÈÇ£‰πàÂ¶ÇÊûúÁî®ÂÆåThreadLocalÂêé‰∏ç‰∏ªÂä®ÁßªÈô§ÔºàË∞ÉÁî® ThreadLocal#remove ÊñπÊ≥ïÔºâÔºåÂ∞±‰ºöÈÄ†ÊàêÁü≠ÊúüÁöÑÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ‰ΩÜ‰∫ãÂÆû‰∏äÔºåThreadLocal Áî®ÂÆåÂêé‰∏ªÂä®Ë∞É remove Â∞±ËÉΩËßÑÈÅøËøô‰∏™ÈóÆÈ¢ò„ÄÇ Ê≥®Ôºö‰∏äÈù¢ËØ¥ value Ë¢´Á∫øÁ®ãÂº∫ÂºïÁî®ÊòØÂõ†‰∏∫Â≠òÂú®ËøôÊ†∑‰∏ÄÊù°ÂºïÁî®ÈìæÔºöÊ†àÂ∏ß‰∏≠ÊåÅÊúâ‰∏Ä‰∏™ÂΩìÂâçÁ∫øÁ®ãÁöÑÂºïÁî®ÔºåThreadLocalMap Ë¢´ÂΩìÂâçÁ∫øÁ®ãÂºïÁî®ÁùÄÔºåThreadLocalMap ‰∏≠ÊúâÊåáÂêë Entry ÁöÑÂº∫ÂºïÁî®ÔºåEntry ÊúâÊåÅÊúâ value ÁöÑÂº∫ÂºïÁî®„ÄÇÂÖ∑‰ΩìÂèØÂèÇËÄÉ‰∏ãÂõæ„ÄÇ ÂΩìÂâç Thread ÁªìÊùü‰ª•Âêé, Current Thread Â∞±‰∏ç‰ºöÂ≠òÂú®Ê†à‰∏≠,Âº∫ÂºïÁî®Êñ≠ÂºÄ, Current Thread, Map, valueÂ∞ÜÂÖ®ÈÉ®Ë¢´GCÂõûÊî∂„ÄÇ ÂâçÈù¢ÊèêÂà∞‰∏çË∞ÉÁî® remove ÊñπÊ≥ï ThreadLocal ‰ºöÈÄ†ÊàêÁü≠ÊúüÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÔºå‰∏ãÈù¢Â∞±Êù•ËØÅÊòé‰∏ãËøô‰∏™ËØ¥Ê≥ïÊòØÂê¶Ê≠£Á°Æ„ÄÇ ‰∏∫‰ªÄ‰πàËØ¥ÊòØ„ÄåÁü≠ÊúüÁöÑÂÜÖÂ≠òÊ≥ÑÊºè„ÄçÂë¢Ôºü‰ª• ThreadLocal#get ‰∏∫‰æã 12345678910public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this);//Ë∞ÉÁî® ThreadLcoalMap#getEntry ÊñπÊ≥ï if (e != null) return (T)e.value; &#125; return setInitialValue();&#125; 12345678private Entry getEntry(ThreadLocal key) &#123; int i = key.threadLocalHashCode &amp; (table.length - 1); Entry e = table[i]; if (e != null &amp;&amp; e.get() == key)//ÂëΩ‰∏≠ return e; else return getEntryAfterMiss(key, i, e);//‰∏çÂú®Êï∞ÁªÑÁöÑÁõ∏Â∫î‰ΩçÁΩÆ‰∏äÔºàÂèØËÉΩÊòØÂÜ≤Á™ÅÔºâ&#125; ThreadLocal.ThreadLocalMap#getEntryAfterMiss 12345678910111213141516private Entry getEntryAfterMiss(ThreadLocal key, int i, Entry e) &#123; Entry[] tab = table; int len = tab.length; while (e != null) &#123; ThreadLocal k = e.get(); if (k == key) return e; if (k == null) expungeStaleEntry(i);//ÁßªÈô§„ÄåËøáÊúüÁöÑ„ÄçEntryÔºå‰πüÂ∞±ÊòØÁßªÈô§ key ‰∏∫ null ÁöÑ Entry else i = nextIndex(i, len);//Âä† 1 „ÄåÂèñÊ®°„ÄçÔºåËé∑Âæó‰∏ã‰∏Ä‰∏™Âú∞ÂùÄ e = tab[i]; &#125; return null;&#125; ThreadLocal.ThreadLocalMap#expungeStaleEntry 123456789101112131415161718192021222324252627282930313233//ÁßªÈô§ÊåáÂÆö‰∏ãÊ†áÂØπÂ∫îÁöÑÁöÑ„ÄåËøáÊúüÁöÑ„ÄçEntryÔºåprivate int expungeStaleEntry(int staleSlot) &#123; Entry[] tab = table; int len = tab.length; // Âà†Èô§ËøáÊúüÁöÑ slot ‰∏äÁöÑ entry tab[staleSlot].value = null; tab[staleSlot] = null; size--; // ‰∏çÊñ≠Â∞ùËØïÔºåÁõ¥Âà∞ÈÅáÂà∞ e ‰∏∫ null‰∏∫Ê≠¢„ÄÇ Entry e; int i; for (i = nextIndex(staleSlot, len);//ÔºàstaleSlot +1Ôºâ% len (e = tab[i]) != null; i = nextIndex(i, len)) &#123;//(i+1)%len ThreadLocal k = e.get();//ÂæÖÊ∏ÖÈô§ÁöÑ entry if (k == null) &#123;//key ‰∏∫ nullÔºåËØ¥ÊòéËØ• entry Â∑≤ÁªèËøáÊúüÔºåÈúÄË¶ÅË¢´ÁßªÈô§ e.value = null;//Â∞Ü value ÁΩÆ‰∏∫ nullÔºåÊñπ‰æø GC tab[i] = null;//Ëß£Èô§ÂØπ entry ÁöÑÂ∫îÁî® size--; &#125; else &#123;//key ‰∏ç‰∏∫ null ÁöÑÊÉÖÂÜµ„ÄÇËøô‰∏ÄÊ≠•ÁöÑÊìç‰Ωú‰∏ªË¶ÅÊòØÊñπ‰æøÊü•ÊâæÔºåÊèêÈ´òÂëΩ‰∏≠Áéá int h = k.threadLocalHashCode &amp; (len - 1);//ÈÄöËøá hash ÂÄºËÆ°ÁÆó‰∏ãÊ†á if (h != i) &#123;//‰∏ãÊ†á‰∏çÁõ∏Á≠âÔºåËØ¥Êòé‰πãÂâçsetValue Êó∂ÂèëÁîüÂÜ≤Á™ÅÔºåÂæÄÂêéÈù¢Â≠òÂÇ®‰∫Ü„ÄÇ tab[i] = null;//Â∞Ü //‰∏éKnuth 6.4ÁÆóÊ≥ïR ‰∏çÂêåÔºåÊàë‰ª¨ÂøÖÈ°ªÊâ´ÊèèÁõ¥Âà∞nullÔºåÂõ†‰∏∫ÂèØËÉΩÊúâÂ§ö‰∏™entryÂ∑≤ÁªèËøáÊúü„ÄÇ while (tab[h] != null)//‰ªé„ÄåÊú¨Â∫îËØ•ÂØπÂ∫îÁöÑ‰∏ãÊ†á„ÄçÂºÄÂßãÂæÄÂêéÊé¢ÊµãÔºåÁõ¥Âà∞ÊúâÁ©∫‰Ωç h = nextIndex(h, len); tab[h] = e;//Â∞Ü e Â≠òÂÇ®Âú®ÂΩìÂâçÊÉÖÂÜµ‰∏ãÔºåÊúÄÊé•ËøëËá™Â∑±ËÆ°ÁÆóÂæóÂá∫‰ΩçÁΩÆÁöÑÈÇ£‰∏™‰∏ãÊ†á„ÄÇ &#125; &#125; return i;&#125; ‰ªé ThreadLocal#get ÊñπÊ≥ïÔºàset ÊñπÊ≥ï‰πüÊúâÁ±ª‰ººÁöÑÂÆûÁé∞ÔºâÁöÑË∞ÉÁî®Èìæ‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºöÂú®Ê≤°Êúâ‰∏ªÂä®Ë∞ÉÁî® ThreadLocal#remove ÁöÑÊÉÖÂÜµ‰∏ãÔºåThreadLocalMapÂêéÁª≠ÁöÑget/set‰∏≠‰πü‰ºöÊé¢ÊµãÂà∞ÈÇ£‰∫õkey‰∏∫ nullÁöÑentryÔºåÁÑ∂ÂêéÂ∞ÜÂÖ∂ value ËÆæÁΩÆ‰∏∫ null ‰ª•Â∏ÆÂä©GCÔºåÂõ†Ê≠§ value Âú® key Ë¢´ GC ÂêéÂèØËÉΩËøò‰ºöÂ≠òÊ¥ª‰∏ÄÊÆµÊó∂Èó¥Ôºà‰πüÂ∞±ÊòØËØ¥‰ºöÈÄ†ÊàêÁü≠ÊúüÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÔºâÔºå‰ΩÜÊúÄÁªà‰πü‰ºöË¢´ÂõûÊî∂„ÄÇËøô‰∏™ËøáÁ®ãÂíå java.util.WeakHashMap ÁöÑÂÆûÁé∞Âá†‰πéÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ‰∏çËøá‰∏∫‰∫ÜÈÅøÂÖçÊΩúÂú®ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèËøòÊòØË¶ÅÂÖªÊàê‰∏Ä‰∏™‰π†ÊÉØÔºå‰ΩøÁî®ÂÆå ThreadLocal ‰∏≠ÁöÑvalue ‰πãÂêéË¶ÅË∞ÉÁî® ThreadLocal#remove „ÄÇ Â∞èÁªìget ÊñπÊ≥ïË∞ÉÁî®ÁöÑ‰∏ªË¶ÅÊµÅÁ®ã get ÊñπÊ≥ï‰∏≠‰ºöÂ∞ùËØïËé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap Â¶ÇÊûú ThreadLocalMap ÈùûÁ©∫ÔºåÂπ∂‰∏î‰ª•ÂΩìÂâç ThreadLocal ÂØπË±°‰∏∫ key ÂéªËé∑ÂèñÂà∞ÁöÑ Entry ‰∏ç‰∏∫Á©∫ÔºåÂ∞±ËøîÂõûËØ• ThreadLocal ÂØπÂ∫îÁöÑÂÄºÔºõ Âê¶ÂàôÔºåÂÖàËé∑ÂèñÈªòËÆ§ÁöÑÂàùÂßãÂÄºÔºàÈªòËÆ§ÂÆûÁé∞‰∏∫Á©∫ÔºåÂèØ‰ª•Ëá™Â∑±ÈáçÂÜô initialValue ÊñπÊ≥ïÊù•ËÆæÁΩÆÈúÄË¶ÅÁöÑÂÄºÔºâ ÁÑ∂ÂêéÂà§Êñ≠ ThreadLocalMap ÊòØÂê¶‰∏∫Á©∫ Â¶ÇÊûú‰∏∫Á©∫ÂàõÂª∫‰∏Ä‰∏™ ThreadLocalMap ÂêåÊó∂Â∞ÜÂàùÂßãÂÄºËÆæÁΩÆËøõÂéª„ÄÇ Â¶ÇÊûú‰∏ç‰∏∫Á©∫ÔºåÁõ¥Êé•ÊääÂàùÂßãÂÄºÂ≠òÂÇ®Âú®ÂÖ∂‰∏≠„ÄÇ set ÊñπÊ≥ïÁöÑË∞ÉÁî®ÊµÅÁ®ã ‰Ω†ÂèØËÉΩÂ≠òÂú®ÁöÑÁñëÈóÆÊØè‰∏™ ThreadLocal Âè™ËÉΩÊîæ‰∏Ä‰∏™ÂØπË±°ÂêóÔºüÊØè‰∏™ ThreadLocal Âè™ËÉΩÊîæ‰∏Ä‰∏™ÂØπË±°„ÄÇË¶ÅÊòØÈúÄË¶ÅÊîæÂÖ∂‰ªñÁöÑÂØπË±°ÔºåÂ∞±ÂÜç new ‰∏Ä‰∏™Êñ∞ÁöÑ ThreadLocal Âá∫Êù•ÔºåËøô‰∏™Êñ∞ÁöÑ ThreadLocal Â∞Ü‰Ωú‰∏∫ key,ÈúÄË¶ÅÊîæÁöÑÂØπË±°‰Ωú‰∏∫valueÔºåÊîæÂú® ThreadLocalMap ‰∏≠„ÄÇ‰πüÂ∞±ÊòØËØ¥‰∏Ä‰∏™Á∫øÁ®ãÂèØ‰ª•Âê´ÊúâÂ§ö‰∏™ ThreadLocal Á±ª„ÄÇ ÂΩìÁÑ∂‰πüÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂú® ThreadLocal Â≠òÊîæ‰∏Ä‰∫õÂÆπÂô®ÂØπË±°ÔºåÊØîÂ¶Ç List„ÄÅSet„ÄÅMapÔºå‰∏Ä‰∏™ ThreadLocal Â≠òÊîæ‰∏Ä‰∏™ÂÆπÂô®ÂØπË±°ÔºåÂÄüÂä©ËØ•ÂÆπÂô®ÂØπË±°‰πüÂèØ‰ª•ÂÆûÁé∞Â≠òÂÇ®Â§ö‰∏™ÂØπË±°„ÄÇ ‰∏∫‰ªÄ‰πà ThreadLocal Âè™Â≠òÂÇ®‰∏Ä‰∏™ÂØπË±°Âç¥Ë¶ÅÁî®‰∏Ä‰∏™ ThreadLocalMap Êù•Â≠òÂÇ®ÂÄºÔºüÂÆûÈôÖ‰∏äÊØè‰∏™Á∫øÁ®ã‰∏≠ÈÉΩÊúâ‰∏Ä‰∏™ ThreadLocal.ThreadLocalMapÔºåÁúüÊ≠£Â≠òÂÇ®Êï∞ÊçÆÁöÑÁ±ªÊòØ ThreadLocalMap ÔºåÂèØ‰ª•Â∞ÜÂÆÉÁúã‰ΩúÊòØ‰∏Ä‰∏™ HashMapÔºåËÄå ThreadLocal ÊòØ‰∏Ä‰∏™Áª¥Êä§Á±ª„ÄÇÊàë‰ª¨Áü•ÈÅìÔºåÂ≠òÂÇ®ÁöÑÊó∂ÂÄôÔºåÈÉΩÊòØ‰ª• ThreadLocal ÂÆû‰æã‰Ωú‰∏∫ keyÔºåÁÑ∂ÂêéÂíå value ‰∏ÄËµ∑‰Ωú‰∏∫ÈîÆÂÄºÂØπÂ≠òÂÇ®Âà∞ ThreadLocalMap ‰∏≠„ÄÇÂΩìÊàë‰ª¨Ë∞ÉÁî®‰∏çÂêå ThreadLocal ÁöÑ set ÊñπÊ≥ïÊó∂ÔºåÂ¶ÇÊûú ThreadLocalMap ‰∏ç‰∏∫Á©∫ÔºåÈÇ£‰πàÁõ¥Êé•Âú®ÈáåÈù¢Â≠òÂÇ®ÈîÆÂÄºÂØπÂ∞±ÂèØ‰ª•‰∫ÜÔºå‰∏çÈúÄË¶ÅÂÜçÂàõÂª∫Êñ∞ÁöÑÂÄº„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÂêå‰∏Ä‰∏™Á∫øÁ®ã‰∏äÁöÑ‰∏çÂêå ThreadLocal ÂØπË±°ÔºåÂ≠òÂÇ®ÁöÑÂÄºÊòØÂú®Âêå‰∏Ä‰∏™ ThreadLocalMap ‰∏ä„ÄÇ Ê≤°Êúâ ThreadLocal ËÉΩ‰∏çËÉΩËß£ÂÜ≥ÈóÆÈ¢òÔºüËÉΩ„ÄÇ ÂèØ‰ª•Ëá™Â∑±ÂÆö‰πâ‰∏Ä‰∏™ÈùôÊÄÅÁöÑ mapÔºåÂ∞ÜÂΩìÂâç thread ‰Ωú‰∏∫ keyÔºåÂ∞ÜÁõÆÊ†áÂÄº‰Ωú‰∏∫ valueÔºåput Âà∞ map ‰∏≠ÔºåËøô‰πüÊòØ‰∏ÄËà¨‰∫∫ÁöÑÊÉ≥Ê≥ï„ÄÇ ThreadLocal ÁöÑÂÆûÁé∞ÂàöÂ•ΩÁõ∏ÂèçÔºåÂÆÉÊòØÂú®ÊØè‰∏™Á∫øÁ®ã‰∏≠Êúâ‰∏Ä‰∏™ mapÔºåËÄåÂ∞Ü ThreadLocal ÂÆû‰æã‰Ωú‰∏∫ keyÔºåËøôÊ†∑ÊØè‰∏™ map ‰∏≠ÁöÑÈ°πÊï∞ÂæàÂ∞ëÔºåËÄå‰∏îÂΩìÁ∫øÁ®ãÈîÄÊØÅÊó∂Áõ∏Â∫îÁöÑ‰∏úË•ø‰πü‰∏ÄËµ∑ÈîÄÊØÅ‰∫Ü„ÄÇÂõ†‰∏∫ÂêÑÁ∫øÁ®ãËÆøÈóÆÁöÑ map ÊòØÂêÑËá™‰∏çÂêåÁöÑ mapÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅÂêåÊ≠•ÔºåÈÄüÂ∫¶‰ºöÂø´‰∫õÔºõËÄåÂ¶ÇÊûúÊääÊâÄÊúâÁ∫øÁ®ãË¶ÅÁî®ÁöÑÂØπË±°ÈÉΩÊîæÂà∞‰∏Ä‰∏™ÈùôÊÄÅ map‰∏≠ÁöÑËØù Â§öÁ∫øÁ®ãÂπ∂ÂèëËÆøÈóÆÈúÄË¶ÅËøõË°åÂêåÊ≠•„ÄÇ ÊâÄ‰ª•ËØ¥ ThreadLocal Âè™ÊòØÂÆûÁé∞Á∫øÁ®ãÁßÅÊúâÂèòÈáèÁöÑ‰∏ÄÁßçÊñπÂºè„ÄÇ‰ΩÜÊòØÁªºÂêàÊù•ÁúãËøôÁßçÊñπÂºèÁõ∏ÊØîÂÖ∂‰ªñÂÆûÁé∞ÊñπÂºèË¶ÅÊõ¥Â•Ω„ÄÇ ÂÖ∏ÂûãÂ∫îÁî®Êàë‰ª¨ÈÄöÂ∏∏‰ºöÁî®‰∏ãÈù¢ÁöÑÊñπÂºè‰∏∫ÊôÆÈÄöÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper„ÄÇ 123456789101112class LooperThread extends Thread &#123; public Handler mHandler; public void run() &#123; Looper.prepare();//‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper mHandler = new Handler() &#123; public void handleMessage(Message msg) &#123; // process incoming messages here &#125; &#125;; Looper.loop();//ÂºÄÂêØÊ∂àÊÅØÂæ™ÁéØ &#125; &#125; Android ‰∏≠ÊØè‰∏™Á∫øÁ®ã‰∏≠ÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™ LooperÔºåËøôÁßçÈôêÂà∂Â∞±ÊòØÈÄöËøá ThreadLocal Êù•ÂÆûÁé∞ÁöÑ„ÄÇ 12345public final class Looper &#123; //ÂàõÂª∫‰∏Ä‰∏™ ThreadLocal ÂØπË±°ÔºåÂÖ∂Ê≥õÂûãÁ±ªÂûã‰∏∫ LooperÔºåÂú®Ë∞ÉÁî® prepare ‰πãÂâç sThreadLocal.get() ÈÉΩËøîÂõûÁ©∫„ÄÇ static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;(); //...&#125; ÂàõÂª∫ Looper Êó∂‰ºöÂêåÊó∂ÂàõÂª∫‰∏Ä‰∏™Ê≥õÂûãÁ±ªÂûã‰∏∫ Looper ÁöÑ ThreadLocal ÂØπË±°„ÄÇ Looper#prepare()ÔºåÈÄöËøá prepare ÊñπÊ≥ïÂèØ‰ª•‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper„ÄÇ 12345678910public static void prepare() &#123; prepare(true);&#125;private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123;//Â¶ÇÊûúÁ∫øÁ®ãÂ∑≤ÁªèÂ≠òÂú® Looper ‰∫Ü throw new RuntimeException("Only one Looper may be created per thread"); &#125; sThreadLocal.set(new Looper(quitAllowed));//‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper ÂØπË±°ÔºåÂπ∂Â∞ÜÂÆÉÂ≠òÂÇ®Âú®ÂΩìÂâçÁ∫øÁ®ãÁöÑ ThreadLocalMap ‰∏≠&#125; Looper#myLooper() ÔºåÈÄöËøáËØ•ÊñπÊ≥ïÂèØ‰ª•Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ Looper ÂØπË±° 123public static @Nullable Looper myLooper() &#123; return sThreadLocal.get();&#125; Ê≥®ÊÑèÂ¶ÇÊûú‰∏Ä‰∏™ÂØπË±°ÁöÑÂºïÁî®Ë¢´Â§ö‰∏™Á∫øÁ®ãÊåÅÊúâÔºåÈÇ£‰πàÂç≥‰ΩøËØ•ÂØπË±°Â≠òÂú® ThreadLocalMap ‰∏≠‰πü‰∏çÊòØÁ∫øÁ®ãÁöÑÊú¨Âú∞ÂèòÈáè„ÄÇ È¶ñÂÖàÔºåThreadLocal ‰∏çÊòØÁî®Êù•Ëß£ÂÜ≥ÂÖ±‰∫´ÂØπË±°ÁöÑÂ§öÁ∫øÁ®ãËÆøÈóÆÈóÆÈ¢òÁöÑÔºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºåÈÄöËøá ThreadLocal.set() Âà∞Á∫øÁ®ã‰∏≠ÁöÑÂØπË±°ÊòØËØ•Á∫øÁ®ãËá™Â∑±‰ΩøÁî®ÁöÑÂØπË±°ÔºåÂÖ∂‰ªñÁ∫øÁ®ãÊòØ‰∏çÈúÄË¶ÅËÆøÈóÆÁöÑÔºå‰πüËÆøÈóÆ‰∏çÂà∞ÁöÑ„ÄÇÂêÑ‰∏™Á∫øÁ®ã‰∏≠ËÆøÈóÆÁöÑÊòØ‰∏çÂêåÁöÑÂØπË±°„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÔºåÂÖ∂‰ªñÁ∫øÁ®ãËÉΩÂê¶ËÆøÈóÆÔºåËøòË¶ÅÁúã‰Ω†ÁöÑ set ËøõÂéªÁöÑÂØπË±°ÂºïÁî®ÊòØÂê¶Ë¢´ÂÖ∂‰ªñÁ∫øÁ®ãÊåÅÊúâ„ÄÇ Â¶ÇÊûú‰∏§‰∏™Á∫øÁ®ãÈÉΩÂ≠òÂÖ•Âêå‰∏Ä‰∏™ÂØπË±°ÂºïÁî®ÔºåÈÇ£Â∞±‰ºöÊúâÁ∫øÁ®ãÂÖ±‰∫´ÈóÆÈ¢ò„ÄÇ ÊÄªÁªì ThreadLocal ÈÄöËøáÊìç‰Ωú Thread ‰∏≠ÁöÑ‰∏Ä‰∏™ mapÔºà ThreadLocal.ThreadLocalMapÔºâÔºåÊù•ÂÆûÁé∞Âú® Therad ‰∏≠Ê∑ªÂä†‰∏Ä‰∏™ÈÄªËæë‰∏äÁöÑÊàêÂëòÂèòÈáè„ÄÇ Êàë‰ª¨ÊÄªÁªì ThreadLocal ÂÖ∑‰ΩìÊòØÊÄé‰πà‰∏ÄÊ≠•‰∏ÄÊ≠•Âéª‰∏∫ÊØè‰∏Ä‰∏™Á∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™~Á∫øÁ®ãÁßÅÊúâÂèòÈáè~ÁöÑÔºö È¶ñÂÖàÔºåÂú®ÊØè‰∏™Á∫øÁ®ã Thread ÂÜÖÈÉ®Êúâ‰∏Ä‰∏™ ThreadLocal.ThreadLocalMap Á±ªÂûãÁöÑÊàêÂëòÂèòÈáè threadLocalsÔºåËøô‰∏™ threadLocals Â∞±ÊòØÁî®Êù•Â≠òÂÇ®~Á∫øÁ®ãÁßÅÊúâÂèòÈáèÁöÑ~ÔºåÈîÆÂÄºÔºàkeyÔºâ‰∏∫ÂΩìÂâç ThreadLocal ÂèòÈáèÔºåÂÄº value ‰∏∫~Á∫øÁ®ãÁöÑÁßÅÊúâÂèòÈáè~ÔºàÂç≥ T Á±ªÂûãÁöÑÂèòÈáèÔºâ„ÄÇ ÂàùÂßãÊó∂ÔºåÂú® Thread ÈáåÈù¢ÔºåthreadLocals ‰∏∫Á©∫ÔºåÂΩìÈÄöËøá ThreadLocal ÂèòÈáèË∞ÉÁî® get() ÊñπÊ≥ïÊàñËÄÖ set() ÊñπÊ≥ïÔºåÂ∞±‰ºöÂØπ Thread Á±ª‰∏≠ÁöÑ threadLocals ËøõË°åÂàùÂßãÂåñÔºåÂπ∂‰∏î‰ª•ÂΩìÂâç ThreadLocal ÂèòÈáè‰∏∫ keyÔºå‰ª• ThreadLocal Ë¶Å‰øùÂ≠òÁöÑ~Á∫øÁ®ãÁßÅÊúâÂèòÈáè~‰∏∫ valueÔºåÂ≠òÂà∞ threadLocals ‰∏≠„ÄÇ Ê≥®ÊÑèÔºåÂ¶ÇÊûúÊòØ ÂÖàË∞ÉÁî® get() ÊñπÊ≥ïËÄå‰∏çÊòØ set() ÊñπÊ≥ïÁöÑËØùÔºå‰ºöËøîÂõû null ÁÑ∂ÂêéÂú®ÂΩìÂâçÁ∫øÁ®ãÈáåÈù¢ÔºåÂ¶ÇÊûúË¶Å‰ΩøÁî®~ËØ•Á∫øÁ®ãÁßÅÊúâÂèòÈáè~ÔºåÂ∞±ÂèØ‰ª•ÈÄöËøá get ÊñπÊ≥ïÂú® ÂΩìÂâçÁ∫øÁ®ãÁöÑThreadLocal.ThreadLocalMap ‰∏≠Êü•Êâæ„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Ê≠£Á°ÆÁêÜËß£ ThreadLocal ThreadLocal and synchronized Ë°•ÂÖÖ ThreadLocal JavaÂπ∂ÂèëÁºñÁ®ãÔºöÊ∑±ÂÖ•ÂâñÊûêThreadLocal AndroidÂÖ≥‰∫éThreadLocalÁöÑÊÄùËÄÉÂíåÊÄªÁªì Ê∑±ÂÖ•ÁêÜËß£ThreadLocal ‰ªéÈúÄÊ±ÇÁöÑËßíÂ∫¶ÂéªÁêÜËß£ThreadLocalÂèäÊ∫êÁ†ÅËß£Êûê Â¶ÇÊûúÊú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>Âπ∂Âèë</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊòéÁôΩÂéüÁêÜ,ËΩªÊùæËß£ÂÜ≥ÂÜÖÂ≠òÊ≥ÑÊºè]]></title>
    <url>%2Fblog%2F2017%2F08%2F19%2F%E6%98%8E%E7%99%BD%E5%8E%9F%E7%90%86-%E8%BD%BB%E6%9D%BE%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%2F</url>
    <content type="text"><![CDATA[Áõ∏‰ø°„ÄåÂÜÖÂ≠òÊ≥ÑÊºè„Äç ÈóÆÈ¢òÔºåÊòØ‰∏Ä‰∏™Êå∫ËÆ©ÂºÄÂèëËÄÖÂ§¥ÁñºÁöÑ‰∫ãÊÉÖÔºåÁ¨îËÄÖÂú®ÂõûÈ°æ‰ª•‰∏∫‰ª£Á†ÅÊó∂ÔºåÊÉäËÆ∂ÂèëÁé∞ÔºöÂàùÂ≠¶ Android Êó∂ÔºåËÆ∏Â§ö‰∏ç‰øÆËæπÂπÖÁöÑ‰ª£Á†Å‰π†ÊÉØÔºåÂØºËá¥‰∫ÜËÆ∏Â§öÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢òÔºåÂÄüÊ≠§ÂàÜÊûêÂÖ∂ÂéüÂõ†ÔºåÊääËá™Â∑±ÊåñËøáÁöÑÂùëË°•‰∏Ä‰∏ãÔºå‰πüÂ∏åÊúõÂ•îË∑ëÂú® Android ÂºÄÂèëÈÅìË∑Ø‰∏äÁöÑ‰Ω†ËÉΩÂ§ü‰ºòÈõÖÈÅøÂÖç„ÄÇ ‰ªÄ‰πàÊòØÂÜÖÂ≠òÊ≥ÑÊºè ÂØπ‰∫é C++ Êù•ËØ¥ÔºåÂÜÖÂ≠òÊ≥ÑÊºèÂ∞±ÊòØ new Âá∫Êù•ÁöÑÂØπË±°Ê≤°Êúâ deleteÔºå‰øóÁß∞ÈáéÊåáÈíàÔºõ ËÄåÂØπ‰∫é java ËÄåË®ÄÔºåÂ∞±ÊòØÂ≠òÊîæÂú®Â†Ü‰∏äÁöÑ Object Êó†Ê≥ïË¢´ GC Ê≠£Â∏∏ÂõûÊî∂Ôºõ ÂàÜÊûê‰πãÂâçÊàë‰ª¨ÂÖàÊù•ÁúãÁúã‰∏â‰∏™Âü∫Á°ÄÁü•ËØÜÁÇπ„ÄÇ Âü∫Á°ÄÁü•ËØÜjava ÁöÑÂÜÖÂ≠òÂàÜÈÖçÁÆÄËø∞ËøêË°åÊó∂Êï∞ÊçÆÂå∫ÂüüÂÜÖÂ≠òÊ®°ÂûãÂõæ ÊñπÊ≥ïÂå∫Ôºànon-heapÔºâÔºöÁºñËØëÊó∂Â∞±ÂàÜÈÖçÂ•ΩÔºåÂú®Á®ãÂ∫èÊï¥‰∏™ËøêË°åÊúüÈó¥ÈÉΩÂ≠òÂú®„ÄÇÂÆÉ‰∏ªË¶ÅÂ≠òÊîæÈùôÊÄÅÊï∞ÊçÆÂíåÂ∏∏ÈáèÔºõ Ê†àÂå∫ÔºöÂΩìÊñπÊ≥ïÊâßË°åÊó∂Ôºå‰ºöÂú®Ê†àÂå∫ÂÜÖÂ≠ò‰∏≠ÂàõÂª∫ÊñπÊ≥ï‰ΩìÂÜÖÈÉ®ÁöÑÂ±ÄÈÉ®ÂèòÈáèÔºåÊñπÊ≥ïÁªìÊùüÂêéËá™Âä®ÈáäÊîæÂÜÖÂ≠òÔºõ Â†ÜÂå∫ÔºàheapÔºâÔºöÈÄöÂ∏∏Áî®Êù•Â≠òÊîæ new Âá∫Êù•ÁöÑÂØπË±°„ÄÇÁî± GC Ë¥üË¥£ÂõûÊî∂„ÄÇ ÂõõÁßç‰∏çÂêåÁ±ªÂûãÁöÑÂºïÁî®GC ËøáÁ®ã‰∏éÂØπË±°ÁöÑÂºïÁî®Á±ªÂûãÊúâÁùÄÂæàÂ§ßÁöÑËÅîÁ≥ªÔºå‰∏ãÈù¢Êàë‰ª¨Â∞±ÁúãÁúã Java ‰∏≠ÔºàAndroid ‰∏≠Â≠òÂú®Â∑ÆÂºÇÔºâÁöÑÂõõÁßçÂºïÁî®Ôºö Âº∫ÂºïÁî®ÔºàStrong ReferenceÔºâ:JVM ÂÆÅÊÑøÊäõÂá∫ OOMÔºå‰πü‰∏ç‰ºöËÆ© GC ÂõûÊî∂Â≠òÂú®Âº∫ÂºïÁî®ÁöÑÂØπË±°„ÄÇ ËΩØÂºïÁî®ÔºàSoft ReferenceÔºâ ÔºöÂè™ÊúâÂÜÖÂ≠ò‰∏çË∂≥Êó∂ÔºåÊâç‰ºöË¢´ GC ÂõûÊî∂„ÄÇ Âº±ÂºïÁî®Ôºàweak ReferenceÔºâÔºöÂú® GC Êó∂ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÂØπË±°Âè™Â≠òÂú®Âº±ÂºïÁî®ÔºåÂ∞Ü‰ºöË¢´ÂõûÊî∂ ËôöÂºïÁî®ÔºàPhantom ReferenceÔºâÔºö‰ªª‰ΩïÊó∂ÂÄôÈÉΩÂèØ‰ª•Ë¢´ GC ÂõûÊî∂ÔºåÂΩìÂûÉÂúæÂõûÊî∂Âô®ÂáÜÂ§áÂõûÊî∂‰∏Ä‰∏™ÂØπË±°Êó∂ÔºåÂ¶ÇÊûúÂèëÁé∞ÂÆÉËøòÊúâËôöÂºïÁî®ÔºåÂ∞±‰ºöÂú®ÂõûÊî∂ÂØπË±°ÁöÑÂÜÖÂ≠ò‰πãÂâçÔºåÊääËøô‰∏™ËôöÂºïÁî®Âä†ÂÖ•Âà∞‰∏é‰πãÂÖ≥ËÅîÁöÑÂºïÁî®ÈòüÂàó‰∏≠„ÄÇÁ®ãÂ∫èÂèØ‰ª•ÈÄöËøáÂà§Êñ≠ÂºïÁî®ÈòüÂàó‰∏≠ÊòØÂê¶Â≠òÂú®ËØ•ÂØπË±°ÁöÑËôöÂºïÁî®ÔºåÊù•‰∫ÜËß£Ëøô‰∏™ÂØπË±°ÊòØÂê¶Â∞ÜË¶ÅË¢´ÂõûÊî∂„ÄÇÂèØ‰ª•Áî®Êù•‰Ωú‰∏∫ GC ÂõûÊî∂ Object ÁöÑÊ†áÂøó„ÄÇ ‰∏é Android ‰∏≠ÁöÑÂ∑ÆÂºÇÔºöÂú® 2.3 ‰ª•ÂêéÁâàÊú¨‰∏≠ÔºåÂç≥‰ΩøÂÜÖÂ≠òÂ§üÁî®ÔºåAndroid Á≥ªÁªü‰ºö‰ºòÂÖàÂ∞Ü SoftReference ÁöÑÂØπË±°ÊèêÂâçÂõûÊî∂Êéâ, ÂÖ∂‰ªñÂíå Java ‰∏≠ÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇÂõ†Ê≠§Ë∞∑Ê≠åÂÆòÊñπÂª∫ËÆÆÁî® LruCache(least recentlly use ÊúÄÂ∞ëÊúÄËøë‰ΩøÁî®ÁÆóÊ≥ï)„ÄÇ‰ºöÂ∞ÜÂÜÖÂ≠òÊéßÂà∂Âú®‰∏ÄÂÆöÁöÑÂ§ßÂ∞èÂÜÖ, Ë∂ÖÂá∫ÊúÄÂ§ßÂÄºÊó∂‰ºöËá™Âä®ÂõûÊî∂, Ëøô‰∏™ÊúÄÂ§ßÂÄºÂºÄÂèëËÄÖËá™Â∑±ÂÆö„ÄÇ ÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ïÂÜÖÂ≠òÊ≥ÑÊºèÊòØÂõ†‰∏∫ÂÜÖÂ≠òÊó†Ê≥ïË¢´Ê≠£Â∏∏ÂõûÊî∂ÂºïËµ∑„ÄÇ‰∏∫‰ªÄ‰πàÊó†Ê≥ïË¢´ÂõûÊî∂ÔºüÊàë‰ª¨ÂâçÈù¢ÊòØËøô‰πàËØ¥ÁöÑ‚Äî‚Äî„ÄåÂõ†‰∏∫ÂÆÉÁöÑÂº∫/ËΩØÂºïÁî®Ë¢´ÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÊåÅÊúâ„Äç„ÄÇÂèØ‰∏∫‰ªÄ‰πàÂºïÁî®Ë¢´ÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÊåÅÊúâÂ∞±‰∏çËÉΩËøõË°åÈáäÊîæÂë¢ÔºüËøôÂ∞±Ê∂âÂèäÂà∞‰∫ÜÂûÉÂúæÂõûÊî∂Êú∫Âà∂„ÄÇ ËøõË°åÂûÉÂúæÂõûÊî∂ÁöÑÁ¨¨‰∏Ä‰∏™ÈóÆÈ¢òÊòØÂ¶Ç‰ΩïÁ°ÆÂÆöÂì™‰∫õÂØπË±°ÊòØÂèØ‰ª•Ë¢´ÂõûÊî∂ÁöÑÂûÉÂúæ„ÄÇÈÄöÂ∏∏Êúâ‰∏§ÁßçÂà§Êñ≠ÊñπÊ≥ïÔºå‰∏ÄÁßçÊòØÂºïÁî®ËÆ°Êï∞ÊñπÊ≥ïÔºåÂè¶‰∏ÄÁßçÊòØÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ï„ÄÇ‰∏ªÊµÅÁöÑÂïÜÁî®Á®ãÂ∫èËØ≠Ë®ÄÁöÑ‰∏ªÊµÅÂÆûÁé∞‰∏≠ÔºåÈÉΩÊòØÈÄöËøáÂèØËææÊÄßÂàÜÊûêÊù•Âà§Êñ≠ÂØπË±°ÊòØÂê¶Â≠òÊ¥ªÁöÑ„ÄÇ ÂèØËææÊÄßÂàÜÊûêÁÆóÊ≥ïÁöÑÂü∫Êú¨ÊÄùË∑ØÊòØËøôÊ†∑ÁöÑÔºö ÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑÁß∞‰∏∫ GC Root ÁöÑÂØπË±°‰Ωú‰∏∫Ëµ∑ÂßãÁÇπÔºå‰ªéËøô‰∫õËäÇÁÇπÂºÄÂßãÂêë‰∏ãÊêúÁ¥¢ÔºåÊêúÁ¥¢Ëµ∞ËøáÁöÑË∑ØÂæÑÁß∞‰∏∫„ÄéÂºïÁî®Èìæ„ÄèÔºàReference ChainÔºâ ÂΩì‰∏Ä‰∏™ÂØπË±°Âà∞ GC Root Ê≤°Êúâ‰ªª‰ΩïÂºïÁî®ÈìæÁõ∏ËøûÊó∂ÔºåÂàôËØÅÊòéÊ≠§ÂØπË±°ÊòØ‰∏çÂèØÁî®ÁöÑ„ÄÇ ÈóÆÈ¢òÊù•‰∫ÜÔºåÂà∞Â∫ï‰ªÄ‰πàÊòØ GC Root Âë¢Ôºü R Â§ßÂú®Áü•‰πé‰∏≠ËøôÊ†∑Á≠îÈÅìÔºöÊâÄË∞ì‚ÄúGC roots‚ÄùÔºåÊàñËÄÖËØ¥tracing GCÁöÑ‚ÄúÊ†πÈõÜÂêà‚ÄùÔºå‰∏ÄÁªÑÂøÖÈ°ªÊ¥ªË∑ÉÁöÑ==ÂºïÁî®== ÊâÄÊúâJavaÁ∫øÁ®ãÂΩìÂâçÊ¥ªË∑ÉÁöÑÊ†àÂ∏ßÈáåÊåáÂêëGCÂ†ÜÈáåÁöÑÂØπË±°ÁöÑÂºïÁî®ÔºõÊç¢Âè•ËØùËØ¥ÔºåÂΩìÂâçÊâÄÊúâÊ≠£Âú®Ë¢´Ë∞ÉÁî®ÁöÑÊñπÊ≥ïÁöÑÂºïÁî®Á±ªÂûãÁöÑÂèÇÊï∞/Â±ÄÈÉ®ÂèòÈáè/‰∏¥Êó∂ÂÄº„ÄÇ VMÁöÑ‰∏Ä‰∫õÈùôÊÄÅÊï∞ÊçÆÁªìÊûÑÈáåÊåáÂêëGCÂ†ÜÈáåÁöÑÂØπË±°ÁöÑÂºïÁî®Ôºå‰æãÂ¶ÇËØ¥HotSpot VMÈáåÁöÑUniverseÈáåÊúâÂæàÂ§öËøôÊ†∑ÁöÑÂºïÁî®„ÄÇ JNI handlesÔºåÂåÖÊã¨global handlesÂíålocal handles ÔºàÁúãÊÉÖÂÜµÔºâÊâÄÊúâÂΩìÂâçË¢´Âä†ËΩΩÁöÑJavaÁ±ª ÔºàÁúãÊÉÖÂÜµÔºâJavaÁ±ªÁöÑËøêË°åÊó∂Â∏∏ÈáèÊ±†ÈáåÁöÑÂºïÁî®Á±ªÂûãÂ∏∏ÈáèÔºàStringÊàñClassÁ±ªÂûãÔºâ ÔºàÁúãÊÉÖÂÜµÔºâStringÂ∏∏ÈáèÊ±†ÔºàStringTableÔºâÈáåÁöÑÂºïÁî® ÂÖ≥‰∫é GC ÂõûÊî∂Êú∫Âà∂ÔºåÂèØ‰ª•ÂèÇËÄÉ‰∏ãËøôÁØáÊñáÁ´† ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂç±ÂÆ≥ ËøêË°åÊÄßËÉΩÁöÑÈóÆÈ¢ò: AndroidÂú®ËøêË°åÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÂÜÖÂ≠òÊ≥ÑÊºèÂ∞ÜÂØºËá¥ÂÖ∂‰ªñÁªÑ‰ª∂ÂèØÁî®ÁöÑÂÜÖÂ≠òÂèòÂ∞ëÔºå‰∏ÄÊñπÈù¢‰ºö‰ΩøÂæóGCÁöÑÈ¢ëÁéáÂä†ÂâßÔºåÂú®ÂèëÁîüGCÁöÑÊó∂ÂÄôÔºåÊâÄÊúâËøõÁ®ãÈÉΩÂøÖÈ°ªËøõË°åÁ≠âÂæÖÔºåGCÁöÑÈ¢ëÁéáË∂äÂ§öÔºå‰ªéËÄåÁî®Êà∑Ë∂äÂÆπÊòìÊÑüÁü•Âà∞Âç°È°ø„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÂÜÖÂ≠òÂèòÂ∞ëÔºåÂ∞ÜÂèØËÉΩ‰ΩøÂæóÁ≥ªÁªü‰ºöÈ¢ùÂ§ñÂàÜÈÖçÁªô‰Ω†‰∏Ä‰∫õÂÜÖÂ≠òÔºåËÄåÂΩ±ÂìçÊï¥‰∏™Á≥ªÁªüÁöÑËøêË°åÁä∂ÂÜµ„ÄÇ ËøêË°åÂ¥©Ê∫ÉÈóÆÈ¢ò: ÂÜÖÂ≠òÊ≥ÑÈú≤ÊòØÂÜÖÂ≠òÊ∫¢Âá∫(OOM)ÁöÑÈáçË¶ÅÂéüÂõ†‰πã‰∏ÄÔºå‰ºöÂØºËá¥ Crash„ÄÇÂ¶ÇÊûúÂ∫îÁî®Á®ãÂ∫èÂú®Ê∂àËÄóÂÖâ‰∫ÜÊâÄÊúâÁöÑÂèØÁî®Â†ÜÁ©∫Èó¥ÔºåÈÇ£‰πàÂÜçËØïÂõæÂú®Â†Ü‰∏äÂàÜÈÖçÊñ∞ÂØπË±°Êó∂Â∞±‰ºöÂºïËµ∑ OOM(Out Of Memory Error) ÂºÇÂ∏∏ÔºåÊ≠§Êó∂Â∫îÁî®Á®ãÂ∫èÂ∞±‰ºöÂ¥©Ê∫ÉÈÄÄÂá∫„ÄÇ ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂÖ∏ÂûãÊ°à‰æãË¶ÅÊÉ≥ÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÊºèÔºåÈ¶ñÂÖàË¶ÅÁü•ÈÅìÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂéüÂõ†„ÄÇÂÜÖÂ≠òÊ≥ÑÊºèÊú¨Ë¥®ÂéüÂõ†:==ÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÊåÅÊúâÁü≠ÁîüÂëΩÂë®ÊúüÂØπË±°ÁöÑÂº∫/ËΩØÂºïÁî®„ÄÇÂØºËá¥Êú¨Â∫îËØ•Ë¢´ÂõûÊî∂ÁöÑÁü≠ÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°Êó†Ê≥ïË¢´Ê≠£Â∏∏ÂõûÊî∂==„ÄÇ Ëøô‰πàËÆ≤ÂèØËÉΩÊØîËæÉÊäΩË±°„ÄÇ‰∏æ‰∏™Â∏∏ËßÅÁöÑÊ†óÂ≠êÔºöÂçï‰æãÊ®°Âºè‰∏≠ÔºåÊàë‰ª¨Â∏∏Â∏∏Âú®Ëé∑ÂèñÂçï‰æãÂØπË±°Êó∂ÈúÄË¶Å‰º†‰∏Ä‰∏™ Context „ÄÇÂçï‰æãÂØπË±°ÊòØ‰∏Ä‰∏™ÈïøÁîüÂëΩÂë®ÊúüÁöÑÂØπË±°ÔºàÂ∫îÁî®Á®ãÂ∫èÁªìÊùüÊó∂ÊâçÁªàÁªìÔºâÔºåËÄåÂ¶ÇÊûúÊàë‰ª¨‰º†ÈÄíÁöÑÊòØÊüê‰∏Ä‰∏™ Activity ‰Ωú‰∏∫ context,ÈÇ£‰πàËøô‰∏™ Activity Â∞±‰ºöÂõ†‰∏∫ÂºïÁî®Ë¢´ÊåÅÊúâËÄåÊó†Ê≥ïÈîÄÊØÅÔºå‰ªéËÄåÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ ‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÁúãÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂ∏∏ËßÅ‰æãÂ≠ê„ÄÇ Ê∞∏ËøúÁöÑ SingletonÂçï‰æãÁöÑ‰ΩøÁî®Âú®Êàë‰ª¨ÁöÑÁ®ãÂ∫è‰∏≠ÈöèÂ§ÑÂèØËßÅÔºåÂõ†‰∏∫‰ΩøÁî®ÂÆÉÂèØ‰ª•Ëß£ÂÜ≥Êàë‰ª¨Âú®Á®ãÂ∫è‰∏≠ÈáçÂ§çÂàõÂª∫ÂØπË±°ÁöÑÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØÁî±‰∫éÂçï‰æãÊ®°ÂºèÁöÑÈùôÊÄÅÁâπÊÄßÔºå‰ΩøÂæóÂÆÉÁöÑÁîüÂëΩÂë®ÊúüÂíåÊàë‰ª¨ÁöÑÂ∫îÁî®‰∏ÄÊ†∑ÈïøÔºå‰∏Ä‰∏çÂ∞èÂøÉËÆ©Âçï‰æãÊó†ÈôêÂà∂ÁöÑÊåÅÊúâ Activity ÁöÑÂº∫ÂºïÁî®Â∞±‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ Ëß£ÂÜ≥ Â∫îËØ•Êää‰º†ÂÖ•ÁöÑ Context Êîπ‰∏∫ÂêåÂ∫îÁî®ÁîüÂëΩÂë®Êúü‰∏ÄÊ†∑ÈïøÁöÑ Application ‰∏≠ÁöÑ Context„ÄÇ ‰πüÂèØ‰ª•ÈÄöËøáÈáçÂÜô ApplicationÔºåÊèê‰æõ getContext ÊñπÊ≥ï,ÈÇ£Ê†∑Â∞±‰∏çÈúÄË¶ÅÂú®Ëé∑ÂèñÂçï‰æãÊó∂‰º†ÂÖ• context„ÄÇ 123456789101112public class BaseApplication extends Application&#123; private static ApplicationContext sContext; @Override public void onCreate()&#123; super.onCreate(); sContext = getApplicationContext(); &#125; public static Context getApplicationContext()&#123; return sContext; &#125;&#125; Handler ÂºïÂèëÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÁî±‰∫é Handler ÈÄöÂ∏∏‰ºöË¢´ Message ÊâÄÊåÅÊúâÔºåËÄå Message ÈÄöÂ∏∏‰ºöÈó¥Êé•Âú∞Ë¢´‰∏ªÁ∫øÁ®ãÊåÅÊúâÔºåÂ¶ÇÊûúÂàõÂª∫ Handler ÁöÑÊó∂ÂÄôÔºåÁõ¥Êé•ÈÄöËøá new ÁöÑÊñπÂºèÂàõÂª∫ÂåøÂêçÂÜÖÈÉ®Á±ªÔºàÈªòËÆ§ÊåÅÊúâ Â§ñÈÉ®Á±ªÁöÑÂº∫ÂºïÁî®Ôºånew Êìç‰ΩúÈÄöÂ∏∏ÊòØ Activity ÊàñËÄÖÊòØ Fragment ÂÜÖÈÉ®Áõ¥Êé•ÔºâÔºåÂú®ÁïåÈù¢ÈÄÄÂá∫ÁöÑÊó∂ÂÄôÔºåÂèàÊ≤°ÊúâË∞ÉÁî® android.os.Handler#removeCallbacksAndMessagesÊñπÊ≥ïÔºåÂèØËÉΩÂ∞±‰ºöÂØºËá¥ÂÆÉÁöÑÁîüÂëΩÂë®ÊúüÂíå Activity ‰∏ç‰∏ÄËá¥„ÄÇËøõËÄåÂÆπÊòìÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ 12345678910111213141516171819202122public class HandlerBadActivity extends AppCompatActivity &#123; private final Handler handler = new Handler()&#123;//ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºåÊåÅÊúâÂ§ñÈÉ®Á±ªÁöÑÂº∫ÂºïÁî® @Override public void handleMessage(Message msg) &#123; super.handleMessage(msg); &#125; &#125;; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_handler_bad); // Âª∂Ëøü 5min ÂèëÈÄÅ‰∏Ä‰∏™Ê∂àÊÅØ handler.postDelayed(new Runnable() &#123;//ÂÜÖÈÉ®‰ºöÂ∞ÜËØ• Runable Â∞ÅË£Ö‰∏∫‰∏Ä‰∏™ Message ÂØπË±°ÔºåÂêåÊó∂Â∞Ü Message.target ËµãÂÄº‰∏∫ handler @Override public void run() &#123; //do something &#125; &#125;, 1000 * 60 * 5); this.finish(); &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠ÂèëÈÄÅ‰∫Ü‰∏Ä‰∏™Âª∂Êó∂ 5 ÂàÜÈíüÊâßË°åÁöÑ MessageÔºåÂΩìËØ• Activity ÈÄÄÂá∫ÁöÑÊó∂ÂÄôÔºåÂª∂Êó∂‰ªªÂä°ÔºàMessageÔºâËøòÂú®‰∏ªÁ∫øÁ®ãÁöÑ MessageQueue ‰∏≠Á≠âÂæÖÔºåÊ≠§Êó∂ÁöÑ Message ÊåÅÊúâ Handler ÁöÑÂº∫ÂºïÁî®ÔºàÂàõÂª∫Êó∂ÈÄöËøá Message.target ËøõË°åÊåáÂÆöÔºâÔºåÂπ∂‰∏îÁî±‰∫é Handler ÊòØ HandlerBadActivity ÁöÑÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºåÊâÄ‰ª• Handler ‰ºöÊåÅÊúâ‰∏Ä‰∏™ÊåáÂêë HandlerBadActivity ÁöÑÂº∫ÂºïÁî®ÔºåÂêåÊó∂ Message Ë¢´ MessageQueue ÊâÄÊåÅÊúâÔºåMessageQueue ÂèàË¢´‰∏ªÁ∫øÁ®ã Looper ÊåÅÊúâÔºå‰∏ªÁ∫øÁ®ã Looper Ë¢´‰∏ªÁ∫øÁ®ãÁöÑ looper ÊâÄÊåÅÊúâÔºàÂºïÁî®Èìæ‰∏∫Ôºö ‰∏ªThread ‚Äî&gt; Looper‚Äî&gt; MessageQueue ‚Äî&gt; Message ‚Äî&gt; Handler ÂÆû‰æã ‚Äî&gt; Activity Ôºâ ÊâÄ‰ª•ËôΩÁÑ∂Ê≠§Êó∂ HandlerBadActivity Ë∞ÉÁî®‰∫Ü finish ‰πüÊó†Ê≥ïËøõË°åÂÜÖÂ≠òÂõûÊî∂ÔºåÈÄ†ÊàêÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ Ëß£ÂÜ≥Â∞Ü Handler Â£∞Êòé‰∏∫ÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºå‰ΩÜÊòØË¶ÅÊ≥®ÊÑèÂ¶ÇÊûúÁî®Âà∞ Context Á≠âÂ§ñÈÉ®Á±ªÁöÑ Èùûstatic ÂØπË±°ÔºåËøòÊòØÂ∫îËØ•‰ΩøÁî® ApplicationContext ÊàñËÄÖÈÄöËøáÂº±ÂºïÁî®Êù•ÊåÅÊúâËøô‰∫õÂ§ñÈÉ®ÂØπË±°„ÄÇ123456789101112131415161718192021public class HandlerGoodActivity extends AppCompatActivity &#123; private static final class MyHandler extends Handler&#123;//Â£∞Êòé‰∏∫ÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºàÈÅøÂÖçÊåÅÊúâÂ§ñÈÉ®Á±ªÁöÑÂº∫ÂºïÁî®Ôºâ private final WeakReference&lt;HandlerGoodActivity&gt; mActivity; public MyHandler(HandlerGoodActivity activity)&#123; this.mActivity = new WeakReference&lt;HandlerGoodActivity&gt;(activity);//‰ΩøÁî®Âº±ÂºïÁî® &#125; @Override public void handleMessage(Message msg) &#123; HandlerGoodActivity activity = mActivity.get(); if (activity == null || activity.isFinishing() || activity.isDestroyed()) &#123;//Âà§Êñ≠ activity ÊòØÂê¶‰∏∫Á©∫Ôºå‰ª•ÂèäÊòØÂê¶Ê≠£Âú®Ë¢´ÈîÄÊØÅ„ÄÅÊàñËÄÖÂ∑≤ÁªèË¢´ÈîÄÊØÅ removeCallbacksAndMessages(null); return; &#125; // do something &#125; &#125; private final MyHandler myHandler = new MyHandler(this);&#125; ÊÖéÁî® static ÊàêÂëòÂèòÈáè‰ªéÂâçÈù¢ÁöÑ‰ªãÁªçÊàë‰ª¨Áü•ÈÅìÔºåstatic ‰øÆÈ•∞ÁöÑÂèòÈáè‰Ωç‰∫éÂÜÖÂ≠òÁöÑÊñπÊ≥ïÂå∫ÔºåÂÖ∂ÁîüÂëΩÂë®Êúü‰∏é App ÁöÑÁîüÂëΩÂë®Êúü‰∏ÄËá¥„ÄÇËøôÂøÖÁÑ∂‰ºöÂØºËá¥‰∏ÄÁ≥ªÂàóÈóÆÈ¢òÔºåÂ¶ÇÊûú‰Ω†ÁöÑ app ËøõÁ®ãËÆæËÆ°‰∏äÊòØÈïøÈ©ªÂÜÖÂ≠òÁöÑÔºåÈÇ£Âç≥‰Ωø app ÂàáÂà∞ÂêéÂè∞ÔºåËøôÈÉ®ÂàÜÂÜÖÂ≠ò‰πü‰∏ç‰ºöË¢´ÈáäÊîæ„ÄÇ Ëß£ÂÜ≥‰∏çË¶ÅÂú®Á±ªÂàùÂßãÊó∂ÂàùÂßãÂåñÈùôÊÄÅÊàêÂëòÔºå‰πüÂ∞±ÊòØÂèØ‰ª•ËÄÉËôëÊáíÂä†ËΩΩ„ÄÇÊû∂ÊûÑËÆæËÆ°‰∏äË¶ÅÊÄùËÄÉÊòØÂê¶ÁúüÁöÑÊúâÂøÖË¶ÅËøôÊ†∑ÂÅöÔºåÂ∞ΩÈáèÈÅøÂÖç„ÄÇÂ¶ÇÊûúÊû∂ÊûÑÈúÄË¶ÅËøô‰πàËÆæËÆ°ÔºåÈÇ£‰πàÊ≠§ÂØπË±°ÁöÑÁîüÂëΩÂë®Êúü‰Ω†ÊúâË¥£‰ªªÁÆ°ÁêÜËµ∑Êù•„ÄÇ ÂΩìÁÑ∂ÔºåApplication ÁöÑ context ‰∏çÊòØ‰∏áËÉΩÁöÑÔºåÊâÄ‰ª•‰πü‰∏çËÉΩÈöè‰æø‰π±Áî®ÔºåÂØπ‰∫éÊúâ‰∫õÂú∞ÊñπÂàôÂøÖÈ°ª‰ΩøÁî® Activity ÁöÑ ContextÔºåÂØπ‰∫éApplicationÔºåServiceÔºåActivity‰∏âËÄÖÁöÑContextÁöÑÂ∫îÁî®Âú∫ÊôØÂ¶Ç‰∏ãÔºö ËØ¥ÊòéÔºö NO1 Ë°®Á§∫ Application Âíå Service ÂèØ‰ª•ÂêØÂä®‰∏Ä‰∏™ ActivityÔºå‰∏çËøáÈúÄË¶Å==ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ task ‰ªªÂä°ÈòüÂàó==„ÄÇ ÂØπ‰∫é Dialog ËÄåË®ÄÔºåÂè™ÊúâÂú® Activity ‰∏≠ÊâçËÉΩÂàõÂª∫ ‰∏ãÈù¢‰∏æ‰∏Ä‰∏™ÈöêËîΩÁöÑÊ†óÂ≠ê ‰ΩøÁî®Á≥ªÁªüÊúçÂä°ÂºïÂèëÁöÑÂÜÖÂ≠òÊ≥ÑÊºè‰∏∫‰∫ÜÊñπ‰æøÊàë‰ª¨‰ΩøÁî®‰∏Ä‰∫õÂ∏∏ËßÅÁöÑÁ≥ªÁªüÊúçÂä°ÔºåActivity ÂÅö‰∫Ü‰∏Ä‰∫õÂ∞ÅË£Ö„ÄÇÊØîÂ¶ÇËØ¥ÔºåÂèØ‰ª•ÈÄöËøá getPackageManager Âú® Activtiy ‰∏≠Ëé∑Âèñ PackageManagerServiceÔºå‰ΩÜÊòØÔºåÈáåÈù¢ÂÆûÈôÖ‰∏äË∞ÉÁî®‰∫Ü Activity ÂØπÂ∫îÁöÑ ContextImpl ‰∏≠ÁöÑ getPackageManager ÊñπÊ≥ï ContextWrapper#getPackageManager 1234@Overridepublic PackageManager getPackageManager() &#123; return mBase.getPackageManager();&#125; ContextImpl#getPackageManager 1234567891011121314@Overridepublic PackageManager getPackageManager() &#123; if (mPackageManager != null) &#123; return mPackageManager; &#125; IPackageManager pm = ActivityThread.getPackageManager(); if (pm != null) &#123; // Doesn't matter if we make more than one instance. return (mPackageManager = new ApplicationPackageManager(this, pm));//ÂàõÂª∫ ApplicationPackageManager &#125; return null;&#125; ApplicationPackageManager#ApplicationPackageManager 12345ApplicationPackageManager(ContextImpl context, IPackageManager pm) &#123; mContext = context;//‰øùÂ≠ò ContextImpl ÁöÑÂº∫ÂºïÁî® mPM = pm;&#125; 123456private UserManagerService(Context context, PackageManagerService pm, Object packagesLock, File dataDir) &#123; mContext = context;//ÊåÅÊúâÂ§ñÈÉ® Context ÂºïÁî® mPm = pm; //‰ª£Á†ÅÁúÅÁï•&#125; PackageManagerService#PackageManagerService 1234567public class PackageManagerService extends IPackageManager.Stub &#123; static UserManagerService sUserManager;//ÊåÅÊúâ UMS ÈùôÊÄÅÂºïÁî® public PackageManagerService(Context context, Installer installer, boolean factoryTest, boolean onlyCore) &#123; sUserManager = new UserManagerService(context, this, mPackages);//ÂàùÂßãÂåñ UMS &#125;&#125; Á¨îËÄÖÈÅáÂà∞ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢òÊòØÂõ†‰∏∫Âú® Activity ‰∏≠Ë∞ÉÁî®‰∫Ü getPackageManger ÊñπÊ≥ïËé∑Âèñ PMS ÔºåËØ•ÊñπÊ≥ïË∞ÉÁî®ÁöÑÊòØ ContextImplÔºåÊ≠§Êó∂Â¶ÇÊûúContextImpl ‰∏≠ PackageManager ‰∏∫ nullÔºåÂ∞±‰ºöÂàõÂª∫‰∏Ä‰∏™ PackageMangerÔºàContextImpl ‰ºöÂ∞ÜËá™Â∑±‰º†ÈÄíËøõÂéªÔºåËÄå ContextImpl ÁöÑ mOuterContext ‰∏∫ ActivityÔºâÔºåÂàõÂª∫ PackageManager ÂÆûÈôÖ‰∏ä‰ºöÂàõÂª∫ PackageManagerServiceÔºàÁÆÄÁß∞ PMSÔºâÔºåËÄå PMS ÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠‰ºöÂàõÂª∫‰∏Ä‰∏™ UserMangerÔºàUserManger ÂàùÂßãÂåñ‰πãÂêé‰ºöÊåÅÊúâ ContextImpl ÁöÑÂº∫ÂºïÁî®Ôºâ„ÄÇ Âè™Ë¶Å PMS ÁöÑ class Êú™Ë¢´ÈîÄÊØÅÔºåÈÇ£‰πàÂ∞±‰ºö‰∏ÄÁõ¥ÂºïÁî®ÁùÄ UserManger ÔºåËøõËÄåÂØºËá¥ÂÖ∂ÂÖ≥ËÅîÂà∞ÁöÑËµÑÊ∫êÊó†Ê≥ïÊ≠£Â∏∏ÈáäÊîæ„ÄÇ Â∞èÁªìÊú¨‰æãÁöÑÂºïÁî®ÈìæÂ§ßËá¥Â¶Ç‰∏ãÔºö ÊñπÊ≥ïÂå∫‰∏≠Ôºà1.8 ÂêéÁßªÂà∞‰∫Ü ÂÖÉÁ©∫Èó¥ÔºâÂê´ÊúâÂ∑≤ÁªèÂä†ËΩΩÁöÑ PMS classÔºåPMS ÈùôÊÄÅÂºïÁî® ‚Äì&gt; UserMangerÔºàmContextÔºâ ‚Äì&gt; ContextImplÔºàmOuterContextÔºâ ‚Äì&gt; Activity (ËµÑÊ∫êÊó†Ê≥ïË¢´Ê≠£Â∏∏ÂõûÊî∂) ÈÄöÂ∏∏ËøôÁßçÂÜÖÂ≠òÊ≥ÑÊºèÊÄªÊòØÊØîËæÉÈöêËîΩÔºå‰∏ç‰ΩøÁî®Ê£ÄÊµãÂ∑•ÂÖ∑ÔºåÊ†πÊú¨Â∞±ÊÉ≥‰∏çÂà∞ÔºåÂéüÊù•ÈÇ£‰∏ÄË°å‰ª£Á†ÅÁ´üÁÑ∂‰ºöÂºïÂèëÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ Ëß£ÂÜ≥Â∞ÜgetPackageManager() Êîπ‰∏∫ getApplication()#getPackageManager() „ÄÇËøôÊ†∑ÂºïÁî®ÁöÑÂ∞±ÊòØ Application ContextÔºåËÄåÈùû Activity ‰∫Ü„ÄÇ ËøúÁ¶ªÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÂíåÂåøÂêçÁ±ªÔºåÊúâÈúÄË¶ÅÊó∂ËØ∑‰ΩøÁî®ÈùôÊÄÅÂÜÖÈÉ®Á±ª‰∏∫‰ªÄ‰πàË¶ÅÊÄé‰πàÂÅöÂë¢?Âõ†‰∏∫‰ΩøÁî®ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÂíåÂåøÂêçÁ±ªÈÉΩ‰ºöÈªòËÆ§ÊåÅÊúâÂ§ñÈÉ®Á±ªÁöÑÂºïÁî®ÔºåÂ¶ÇÊûúÁîüÂëΩÂë®Êúü‰∏ç‰∏ÄËá¥ÔºåÂ∞±‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ Áúã‰∏Ä‰∏™‰æãÂ≠ê„ÄÇ 1234567891011121314151617public class NestedClassLeakActivity extends AppCompatActivity &#123; class InnerClass &#123;//ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ª &#125; private static InnerClass sInner;//ÊåáÂêëÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÁöÑÈùôÊÄÅÂºïÁî® @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_nested_class); if (sInner == null) &#123; sInner = new InnerClass();//ÂàõÂª∫ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÁöÑÂÆû‰æã &#125; &#125;&#125; Êú¨‰æã‰∏≠ÔºåÂõ†‰∏∫ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÈªòËÆ§‰ºöÊåÅÊúâÂ§ñÈÉ®Á±ªÁöÑÂºïÁî®ÔºåËÄåÂ§ñÈÉ®Á±ª‰∏≠ÂèàÊúâ‰∏Ä‰∏™ËØ•ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÁöÑÈùôÊÄÅÂÆû‰æãÔºåËØ•ÈùôÊÄÅÂÆû‰æãÁöÑÁîüÂëΩÂë®ÊúüÂíåÂ∫îÁî®ÁöÑ‰∏ÄÊ†∑ÈïøÔºåËÄåÈùôÊÄÅÂÆû‰æãÂèàÊåÅÊúâ Activity ÁöÑÂºïÁî®ÔºåÂõ†Ê≠§ÂØºËá¥ Activity ÁöÑÂÜÖÂ≠òËµÑÊ∫ê‰∏çËÉΩÊ≠£Â∏∏ÂõûÊî∂„ÄÇ Ëß£ÂÜ≥ Â∞ÜËØ•ÂÜÖÈÉ®Á±ªËÆæ‰∏∫ÈùôÊÄÅÂÜÖÈÉ®Á±ª ‰πüÂèØ‰ª•Â∞ÜËØ•ÂÜÖÈÉ®Á±ªÊäΩÂèñÂá∫Êù•Â∞ÅË£ÖÊàê‰∏Ä‰∏™Âçï‰æã ÈõÜÂêàÂºïÂèëÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÊàë‰ª¨ÈÄöÂ∏∏‰ºöÊää‰∏Ä‰∫õÂØπË±°ÁöÑÂºïÁî®Âä†ÂÖ•Âà∞ÈõÜÂêàÂÆπÂô®ÔºàÊØîÂ¶ÇArrayListÔºâ‰∏≠ÔºåÂΩìÊàë‰ª¨‰∏çÂÜçÈúÄË¶ÅËØ•ÂØπË±°Êó∂ÔºàÈÄöÂ∏∏‰ºöË∞ÉÁî® remove ÊñπÊ≥ïÔºâÔºåÂπ∂Ê≤°ÊúâÊääÂÆÉÁöÑÂºïÁî®‰ªéÈõÜÂêà‰∏≠Ê∏ÖÁêÜÊéâÔºàÂÖ∂‰∏≠ÁöÑ‰∏ÄÁßçÊÉÖÂÜµÂ∞±ÊòØ remove ÊñπÊ≥ïÊ≤°ÊúâÂ∞Ü‰∏çÂÜçÈúÄË¶ÅÁöÑÂºïÁî®ËµãÂÄº‰∏∫ nullÔºâÔºå‰∏ãÈù¢‰ª• ArrayList ÁöÑ remove ÊñπÊ≥ï‰∏∫‰æã 12345678910111213141516public E remove( int index) &#123; // Êï∞ÁªÑË∂äÁïåÊ£ÄÊü• RangeCheck(index); modCount++; // ÂèñÂá∫Ë¶ÅÂà†Èô§‰ΩçÁΩÆÁöÑÂÖÉÁ¥†Ôºå‰æõËøîÂõû‰ΩøÁî® E oldValue = (E) elementData[index]; // ËÆ°ÁÆóÊï∞ÁªÑË¶ÅÂ§çÂà∂ÁöÑÊï∞Èáè int numMoved = size - index - 1; // Êï∞ÁªÑÂ§çÂà∂ÔºåÂ∞±ÊòØÂ∞Üindex‰πãÂêéÁöÑÂÖÉÁ¥†ÂæÄÂâçÁßªÂä®‰∏Ä‰∏™‰ΩçÁΩÆ if (numMoved &gt; 0) System. arraycopy(elementData, index+1, elementData, index, numMoved); // Â∞ÜÊï∞ÁªÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†ÁΩÆÁ©∫ÔºàÂõ†‰∏∫Âà†Èô§‰∫Ü‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÁÑ∂ÂêéindexÂêéÈù¢ÁöÑÂÖÉÁ¥†ÈÉΩÂêëÂâçÁßªÂä®‰∫ÜÔºåÊâÄ‰ª•ÊúÄÂêé‰∏Ä‰∏™Â∞±Ê≤°Áî®‰∫ÜÔºâÔºåÂ•ΩËÆ©gcÂ∞ΩÂø´ÂõûÊî∂ elementData[--size ] = null; // Let gc do its work return oldValue;&#125; elementData[--size ] = null; // Let gc do its work Â¶ÇÊûúÊõøÊç¢‰∏∫ --sizeÔºåÂ∞±‰ºöÂØºËá¥Â∑≤Áªè„ÄåÁßªÈô§„ÄçÁöÑÂØπË±°Âõ†‰∏∫Âº∫ÂºïÁî®Ë¢´ÈõÜÂêàÊåÅÊúâÔºåËÄåÊó†Ê≥ïÊ≠£Â∏∏Ë¢´ gc ÂõûÊî∂„ÄÇ WebView ÂºïÂèëÁöÑÂÜÖÂ≠òÊ≥ÑÊºèWebView Ëß£ÊûêÁΩëÈ°µÊó∂‰ºöÁî≥ËØ∑NativeÂ†ÜÂÜÖÂ≠òÁî®‰∫é‰øùÂ≠òÈ°µÈù¢ÂÖÉÁ¥†ÔºåÂΩìÈ°µÈù¢ËæÉÂ§çÊùÇÊó∂‰ºöÊúâÂæàÂ§ßÁöÑÂÜÖÂ≠òÂç†Áî®„ÄÇÂ¶ÇÊûúÈ°µÈù¢ÂåÖÂê´ÂõæÁâáÔºåÂÜÖÂ≠òÂç†Áî®‰ºöÊõ¥‰∏•Èáç„ÄÇÂπ∂‰∏îÊâìÂºÄÊñ∞È°µÈù¢Êó∂Ôºå‰∏∫‰∫ÜËÉΩÂø´ÈÄüÂõûÈÄÄÔºå‰πãÂâçÈ°µÈù¢Âç†Áî®ÁöÑÂÜÖÂ≠ò‰πü‰∏ç‰ºöÈáäÊîæ„ÄÇÊúâÊó∂ÊµèËßàÂçÅÂá†‰∏™ÁΩëÈ°µÔºåÈÉΩ‰ºöÂç†Áî®Âá†ÁôæÂÖÜÁöÑÂÜÖÂ≠ò„ÄÇËøôÊ†∑Âä†ËΩΩÁΩëÈ°µËæÉÂ§öÊó∂Ôºå‰ºöÂØºËá¥Á≥ªÁªü‰∏çÂ†™ÈáçË¥üÔºåÊúÄÁªàÂº∫Âà∂ÂÖ≥Èó≠Â∫îÁî®Ôºå‰πüÂ∞±ÊòØÂá∫Áé∞Â∫îÁî®Èó™ÈÄÄÊàñÈáçÂêØ„ÄÇ Áî±‰∫éÂç†Áî®ÁöÑÈÉΩÊòØ Native Â†ÜÂÜÖÂ≠òÔºåÊâÄ‰ª•ÂÆûÈôÖÂç†Áî®ÁöÑÂÜÖÂ≠òÂ§ßÂ∞è‰∏ç‰ºöÊòæÁ§∫Âú®Â∏∏Áî®ÁöÑ DDMS Heap Â∑•ÂÖ∑‰∏≠Ôºà DMS Heap Â∑•ÂÖ∑ÁúãÂà∞ÁöÑÂè™ÊòØJavaËôöÊãüÊú∫ÂàÜÈÖçÁöÑÂÜÖÂ≠òÔºåÂç≥‰ΩøNativeÂ†ÜÂÜÖÂ≠òÂ∑≤ÁªèÂç†Áî®‰∫ÜÂá†ÁôæÂÖÜÔºåËøôÈáåÊòæÁ§∫ÁöÑËøòÂè™ÊòØÂá†ÂÖÜÊàñÂçÅÂá†ÂÖÜÔºâ„ÄÇÂè™Êúâ‰ΩøÁî® adb shell ‰∏≠ÁöÑ‰∏Ä‰∫õÂëΩ‰ª§ÊØîÂ¶Ç dumpsys meminfo ÂåÖÂêçÔºåÊàñËÄÖÂú®Á®ãÂ∫è‰∏≠‰ΩøÁî® Debug.getNativeHeapSize() ÊâçËÉΩÁúãÂà∞ Native Â†ÜÂÜÖÂ≠ò‰ø°ÊÅØ„ÄÇ ÊçÆËØ¥Áî±‰∫é WebView ÁöÑ‰∏Ä‰∏™ BUGÔºåÂç≥‰ΩøÂÆÉÊâÄÂú®ÁöÑ Activity(ÊàñËÄÖService) ÁªìÊùü‰πüÂ∞±ÊòØ onDestroy() ‰πãÂêéÔºåÊàñËÄÖÁõ¥Êé•Ë∞ÉÁî® WebView.destroy()‰πãÂêéÔºåÂÆÉÊâÄÂç†Áî®Ëøô‰∫õÂÜÖÂ≠ò‰πü‰∏ç‰ºöË¢´ÈáäÊîæ„ÄÇ Ëß£ÂÜ≥Êää‰ΩøÁî®‰∫Ü WebView ÁöÑ Activity (ÊàñËÄÖ Service) ÊîæÂú®ÂçïÁã¨ÁöÑËøõÁ®ãÈáå„ÄÇ Á≥ªÁªüÂú®Ê£ÄÊµãÂà∞Â∫îÁî®Âç†Áî®ÂÜÖÂ≠òËøáÂ§ßÊúâÂèØËÉΩË¢´Á≥ªÁªüÂπ≤Êéâ ‰πüÂèØ‰ª•Âú®ÂÆÉÊâÄÂú®ÁöÑ Activity(ÊàñËÄÖ Service) ÁªìÊùüÂêéÔºåË∞ÉÁî® System.exit(0)Ôºå‰∏ªÂä®KillÊéâËøõÁ®ã„ÄÇÁî±‰∫éÁ≥ªÁªüÁöÑÂÜÖÂ≠òÂàÜÈÖçÊòØ‰ª•ËøõÁ®ã‰∏∫ÂáÜÁöÑÔºåËøõÁ®ãÂÖ≥Èó≠ÂêéÔºåÁ≥ªÁªü‰ºöËá™Âä®ÂõûÊî∂ÊâÄÊúâÂÜÖÂ≠ò„ÄÇ ‰ΩøÁî® WebView ÁöÑÈ°µÈù¢ÔºàActivityÔºâÔºåÂú®ÁîüÂëΩÂë®ÊúüÁªìÊùüÈ°µÈù¢ÈÄÄÂá∫ÔºàonDestoryÔºâÁöÑÊó∂ÂÄôÔºå‰∏ªÂä®Ë∞ÉÁî®WebView.onPause()==‰ª•Âèä==WebView.destory()‰ª•‰æøËÆ©Á≥ªÁªüÈáäÊîæ WebView Áõ∏ÂÖ≥ËµÑÊ∫ê„ÄÇ ÂÖ∂‰ªñÂ∏∏ËßÅÁöÑÂºïËµ∑ÂÜÖÂ≠òÊ≥ÑÊºèÂéüÂõ† Android 3.0 ‰ª•‰∏ãÔºåBitmap Âú®‰∏ç‰ΩøÁî®ÁöÑÊó∂ÂÄôÊ≤°Êúâ‰ΩøÁî® recycle() ÈáäÊîæÂÜÖÂ≠ò„ÄÇ ÈùûÈùôÊÄÅÂÜÖÈÉ®Á±ªÁöÑÈùôÊÄÅÂÆû‰æãÂÆπÊòìÈÄ†ÊàêÂÜÖÂ≠òÊ≥ÑÊºèÔºöÂç≥‰∏Ä‰∏™Á±ª‰∏≠Â¶ÇÊûú‰Ω†‰∏çËÉΩÂ§üÊéßÂà∂ÂÆÉÂÖ∂‰∏≠ÂÜÖÈÉ®Á±ªÁöÑÁîüÂëΩÂë®ÊúüÔºàË≠¨Â¶ÇActivity‰∏≠ÁöÑ‰∏Ä‰∫õÁâπÊÆäHandlerÁ≠âÔºâÔºåÂàôÂ∞ΩÈáè‰ΩøÁî®ÈùôÊÄÅÁ±ªÂíåÂº±ÂºïÁî®Êù•Â§ÑÁêÜÔºàË≠¨Â¶ÇViewRootÁöÑÂÆûÁé∞Ôºâ„ÄÇ Ë≠¶ÊÉïÁ∫øÁ®ãÊú™ÁªàÊ≠¢ÈÄ†ÊàêÁöÑÂÜÖÂ≠òÊ≥ÑÈú≤ÔºõË≠¨Â¶ÇÂú® Activity ‰∏≠ÂÖ≥ËÅî‰∫Ü‰∏Ä‰∏™ÁîüÂëΩÂë®ÊúüË∂ÖËøá Activity ÁöÑ ThreadÔºåÂú®ÈÄÄÂá∫ Activity Êó∂ÂàáËÆ∞ÁªìÊùüÁ∫øÁ®ã„ÄÇ ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ‰æãÂ≠êÂ∞±ÊòØ HandlerThread ÁöÑ run ÊñπÊ≥ï„ÄÇËØ•ÊñπÊ≥ïÂú®ËøôÈáåÊòØ‰∏Ä‰∏™Ê≠ªÂæ™ÁéØÔºåÂÆÉ‰∏ç‰ºöËá™Â∑±ÁªìÊùüÔºåÁ∫øÁ®ãÁöÑÁîüÂëΩÂë®ÊúüË∂ÖËøá‰∫Ü Activity ÁîüÂëΩÂë®ÊúüÔºåÊàë‰ª¨ÂøÖÈ°ªÊâãÂä®Âú® Activity ÁöÑÈîÄÊØÅÊñπÊ≥ï‰∏≠‰∏≠Ë∞ÉÁî® thread.getLooper().quit() Êâç‰∏ç‰ºöÊ≥ÑÈú≤„ÄÇ ÂØπË±°ÁöÑÊ≥®ÂÜå‰∏éÂèçÊ≥®ÂÜåÊ≤°ÊúâÊàêÂØπÂá∫Áé∞ÈÄ†ÊàêÁöÑÂÜÖÂ≠òÊ≥ÑÈú≤ÔºõË≠¨Â¶ÇÊ≥®ÂÜåÂπøÊí≠Êé•Êî∂Âô®„ÄÅÊ≥®ÂÜåËßÇÂØüËÄÖÔºàÂÖ∏ÂûãÁöÑË≠¨Â¶ÇÊï∞ÊçÆÂ∫ìÁöÑÁõëÂê¨ÔºâÁ≠â„ÄÇ ÂàõÂª∫‰∏éÂÖ≥Èó≠Ê≤°ÊúâÊàêÂØπÂá∫Áé∞ÈÄ†ÊàêÁöÑÊ≥ÑÈú≤ÔºõË≠¨Â¶ÇCursorËµÑÊ∫êÂøÖÈ°ªÊâãÂä®ÂÖ≥Èó≠ÔºåWebViewÂøÖÈ°ªÊâãÂä®ÈîÄÊØÅÔºåÊµÅÁ≠âÂØπË±°ÂøÖÈ°ªÊâãÂä®ÂÖ≥Èó≠Á≠â„ÄÇ ÈÅøÂÖç‰ª£Á†ÅËÆæËÆ°Ê®°ÂºèÁöÑÈîôËØØÈÄ†ÊàêÂÜÖÂ≠òÊ≥ÑÈú≤ÔºõË≠¨Â¶ÇÂæ™ÁéØÂºïÁî®ÔºåA ÊåÅÊúâ BÔºåB ÊåÅÊúâ CÔºåC ÊåÅÊúâ AÔºåËøôÊ†∑ÁöÑËÆæËÆ°Ë∞ÅÈÉΩÂæó‰∏çÂà∞ÈáäÊîæ„ÄÇ ÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÊ£ÄÊµãÂ∑•ÂÖ∑ LeakCanary ÊòØ Apache ÂºÄÊ∫êÁöÑ‰∏Ä‰∏™Ëá™Âä®Ê£ÄÊµãÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÊ°ÜÊû∂„ÄÇÂÖ∑‰ΩìÁî®Ê≥ïÂèØ‰ª•ÂèÇËÄÉ LeakCanary‚Äî‚ÄîÂ¶Ç‰ΩïÊ£ÄÊµã Activity ÊòØÂê¶Ê≥ÑÊºè ‰ΩøÁî® AS Monitor + MAT Ëá™Â∑±ÂàÜÊûêÂÜÖÂ≠òÊ≥ÑÊºèÂéüÂõ†„ÄÇËôΩÁÑ∂MAT‰∏ç‰ºöÂáÜÁ°ÆÂëäËØâ‰Ω†‰Ω†ÁöÑ‰ª£Á†ÅÂì™Ê≥ÑÊºè‰∫ÜÔºå‰ΩÜÊòØÂÆÉ‰ºöÁªô‰Ω†ÂèëÁé∞Âì™Ê≥ÑÈú≤ÁöÑÊï∞ÊçÆÂíåÁ∫øÁ¥¢„ÄÇ AS 3.0 ‰∏≠Êèê‰æõ‰∫Ü Profiler Â∑•ÂÖ∑ÔºåËøôÈáåÁÆÄËø∞‰∏Ä‰∏ã‰ΩøÁî®ÊµÅÁ®ãÔºöÊâãÂä®ÁÇπÂáª GC ÊåâÈíÆÔºàÂõæÊ†áÊòØ‰∏Ä‰∏™ÂûÉÂúæÊ°∂Ôºâ‚Äî&gt; ÈÄâÊã© Dump ÂÜÖÂ≠òÔºàÁ≠âÂæÖ20ÁßíÂ∑¶Âè≥Ôºâ‚Äî&gt; ‰∏ãÊñπ‰ºöÂºπÂá∫ÂàÜÊûêÁªìÊûúÁ™óÂè£‚Äî&gt; ‰∏ãÊãâÈÄâÊã© app heap Ôºå‰∏ãÊãâÈÄâÊã© Arrange by package‚Äî&gt;Âà∞ÂåÖ‰∏ãÂØªÊâæËá™Â∑±ËÆ§‰∏∫ÂèØËÉΩÂèëÁîüÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÁ±ªÔºåÂçïÂáªÈÄâ‰∏≠Á±ª ‚Äî&gt; Âè≥ËæπÂºπÂá∫ Instance View Á™óÂè£ÔºåÊòæÁ§∫ËØ•Á±ªÁöÑÊâÄÊúâÂÆû‰æã ‚Äî&gt; ÈÄâ‰∏≠Êüê‰∏Ä‰∏™ÂÆû‰æã ‚Äì&gt; ‰∏ãÊñπ‰ºöÂºπÂá∫ Reference Á™óÂè£ÔºàÊòæÁ§∫ËØ•ÂÆû‰æãÁöÑÊâÄÊúâÂºïÁî®ÔºâÔºåÁÑ∂ÂêéÂàÜÊûê‰∏Ä‰∏ãÂà∞Â∫ïÊòØË∞ÅÂº∫ÂºïÁî®‰∫ÜËØ•ÂÆû‰æãÔºåÂØºËá¥ÂÜÖÂ≠òÊó†Ê≥ïÈáäÊîæ„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Android ÊÄßËÉΩ‰ºòÂåñ ËØ¶Ëß£ÂÜÖÂ≠ò‰ºòÂåñÁöÑÊù•ÈæôÂéªËÑâ ÂÜÖÂ≠òÊ≥ÑÊºèÂÖ®Ëß£ÊûêÔºå‰ªéÊ≠§ÊãíÁªùANRÔºåËÆ©OOMËøúÁ¶ª‰Ω†ÁöÑË∫´ËæπÔºåË∑üÂÜÖÂ≠òÊ≥ÑÊºèsay byebye ÊòéÁôΩÂéüÁêÜÔºåËΩªÊùæÂ∫îÂØπAndroidÂÜÖÂ≠òÊ≥ÑÊºè Â¶ÇÊûúÊú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊèêÂá∫ÂíåÊàëËÆ®ËÆ∫ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>ÊÄßËÉΩ‰ºòÂåñ</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>ÊÄßËÉΩ‰ºòÂåñ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidÊ∫êÁ†Å‰∏≠ÁöÑ‰ª£ÁêÜÊ®°Âºè]]></title>
    <url>%2Fblog%2F2017%2F08%2F18%2FAndroid%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[‰ª£ÁêÜÊ®°ÂºèÁöÑÂÆö‰πâ‰ª£ÁêÜÊ®°Âºè‰πüÁß∞‰∏∫ÂßîÊâòÊ®°ÂºèÔºå‰∏∫ÂÖ∂‰ªñÂØπË±°Êèê‰æõ‰∏ÄÁßç‰ª£ÁêÜ‰ª•ÊéßÂà∂ÂØπËøô‰∏™ÂØπË±°ÁöÑËÆøÈóÆ„ÄÇ ‰ª£ÁêÜÊ®°ÂºèÁöÑ‰ΩøÁî®Âú∫ÊôØÂΩìÊó†Ê≥ïÊàñ‰∏çÊÉ≥ËÆøÈóÆÊüê‰∏™ÂØπË±°ÊàñËÄÖËÆøÈóÆÊüê‰∏™ÂØπË±°Â≠òÂú®Âõ∞ÈöæÊó∂ÂèØ‰ª•ÈÄöËøá‰∏Ä‰∏™‰ª£ÁêÜÂØπË±°Êù•Èó¥Êé•ËÆøÈóÆ„ÄÇ ‰∏∫‰∫Ü‰øùËØÅÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÁöÑÈÄèÊòéÊÄßÔºåÂßîÊâòÂØπË±°‰∏é‰ª£ÁêÜÂØπË±°ÈúÄË¶ÅÂÆûÁé∞Áõ∏ÂêåÁöÑÊé•Âè£ÔºàÊàñÁªßÊâøÁõ∏ÂêåÁöÑÊäΩË±°Á±ªÔºâ ‰ª£ÁêÜÊ®°ÂºèÁöÑUMLÁ±ªÂõæ ËßíËâ≤‰ªãÁªçÔºö Subject ÊäΩË±°‰∏ªÈ¢òÁ±ª ‰∏ªË¶ÅËÅåË¥£ÊòØÂ£∞ÊòéÁúüÂÆû‰∏ªÈ¢òÁ±ª‰∏é‰ª£ÁêÜÁöÑÂÖ±ÂêåÊé•Âè£ÊñπÊ≥ïÔºåËØ•Á±ªÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ª‰πüÂèØ‰ª•ÊòØ‰∏Ä‰∏™Êé•Âè£ RealSubject ÁúüÂÆû‰∏ªÈ¢òÁ±ª ‰πüÁß∞‰∏∫Ë¢´ÂßîÊâòÁ±ªÊàñË¢´‰ª£ÁêÜÁêÜÁ±ªÔºåËØ•Á±ªÂÆö‰πâ‰∫Ü‰ª£ÁêÜÊâÄË°®Á§∫ÁöÑÁúüÂÆûÂØπË±°ÔºåÁî±ÂÖ∂ÊâßË°åÂÖ∑‰ΩìÁöÑ‰∏öÂä°ÈÄªËæëÊñπÊ≥ïÔºåËÄåÂÆ¢Êà∑Á±ªÂàôÈÄöËøá‰ª£ÁêÜÁ±ªÈó¥Êé•Âú∞Ë∞ÉÁî®ÁúüÂÆû‰∏ªÈ¢òÁ±ª‰∏≠ÂÆö‰πâÁöÑÊñπÊ≥ï„ÄÇ ProxySubject ‰ª£ÁêÜÁ±ª ‰πüÁß∞‰∏∫ÂßîÊâòÁ±ªÔºåÊåÅÊúâ‰∏Ä‰∏™ÂØπÁúüÂÆû‰∏ªÈ¢òÁ±ªÁöÑÂºïÁî®ÔºåÂú®ÂÖ∂ÂÆûÁé∞ÁöÑÊé•Âè£ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®ÁúüÂÆû‰∏ªÈ¢òÁ±ª‰∏≠Áõ∏Â∫îÁöÑÊé•Âè£ÊñπÊ≥ïÊâßË°åÔºå‰ª•Ê≠§Ëµ∑Âà∞‰ª£ÁêÜÁöÑ‰ΩúÁî®„ÄÇ Client ‰ΩøÁî®‰ª£ÁêÜÁ±ªÁöÑÁ±ª ‰ª£ÁêÜÊ®°ÂºèÁöÑÁÆÄÂçïÂÆûÁé∞‰ª£ÁêÜÊ®°ÂºèÂ§ßËá¥ÂèØÂàÜ‰∏∫‰∏§Â§ßÈÉ®ÂàÜÔºåÈùôÊÄÅ‰ª£ÁêÜÂíåÂä®ÊÄÅ‰ª£ÁêÜ„ÄÇ Âä®ÊÄÅ‰ª£ÁêÜÈÄöËøáÂèçÂ∞ÑÊú∫Âà∂Âä®ÊÄÅÂú∞ÁîüÊàê‰ª£ÁêÜËÄÖÁöÑÂØπË±°Ôºåcode Èò∂ÊÆµ‰∏çÈúÄË¶ÅÁü•ÈÅì‰ª£ÁêÜË∞ÅÔºå‰ª£ÁêÜÁöÑÁúüÊ≠£ÂØπË±°‰ºöÂú®ÊâßË°åÈò∂ÊÆµÁ°ÆÂÆö„ÄÇ Java Êèê‰æõ‰∏Ä‰∏™‰æøÊç∑ÁöÑÂä®ÊÄÅ‰ª£ÁêÜÊé•Âè£ InvocationHandlerÔºåÂÆûÁé∞ËØ•Êé•Âè£ÈúÄË¶ÅÈáçÂÜôÂÖ∂Ë∞ÉÁî®ÊñπÊ≥ï invoke„ÄÇ Âä®ÊÄÅ‰ª£ÁêÜÈÄöËøá‰∏Ä‰∏™‰ª£ÁêÜÁ±ªÊù•‰ª£ÁêÜ N Â§ö‰∏™Ë¢´‰ª£ÁêÜÁ±ªÔºåÂÖ∂ÂÆûË¥®ÊòØÂØπ‰ª£ÁêÜËÄÖ‰∏éË¢´‰ª£ÁêÜËÄÖËøõË°åËß£ËÄ¶Ôºå‰Ωø‰∏§ËÄÖ‰πãÈó¥Ê≤°ÊúâÁõ¥Êé•ÁöÑÁöÑËÄ¶ÂêàÂÖ≥Á≥ª„ÄÇ ‰ª£ÁêÜÂèØ‰ª•Áúã‰ΩúÊòØ ÂØπË∞ÉÁî®ÁõÆÊ†áÁöÑ‰∏Ä‰∏™ÂåÖË£ÖÔºåËøôÊ†∑Êàë‰ª¨ÂØπÁõÆÊ†á‰ª£Á†ÅÁöÑË∞ÉÁî®‰∏çÊòØÁõ¥Êé•ÂèëÁîüÁöÑÔºåËÄåÊòØ‰ª£ÁêÜÂÆåÊàê„ÄÇÔºàËßÇÁÇπÔºöÂ§ßÈÉ®ÂàÜÂä®ÊÄÅ‰ª£ÁêÜÁöÑÂú∫ÊôØÂèØ‰ª•Áúã‰ΩúÊòØ Ë£ÖÈ•∞Âô®Ê®°ÂºèÁöÑÂ∫îÁî®„ÄÇÔºâ ÈùôÊÄÅ‰ª£ÁêÜ vs Âä®ÊÄÅ‰ª£ÁêÜÁõ∏ÂØπËÄåË®ÄÈùôÊÄÅ‰ª£ÁêÜÂàôÂè™ËÉΩ‰∏∫ÁªôÂÆöÊé•Âè£‰∏ãÁöÑÂÆûÁé∞Á±ªÂÅö‰ª£ÁêÜÔºåÂ¶ÇÊûúÊé•Âè£‰∏çÂêåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÈáçÊñ∞ÂÆö‰πâ‰∏çÂêå‰ª£ÁêÜÁ±ªÔºåËæÉ‰∏∫Â§çÊùÇ„ÄÇ ‰ΩÜÊòØÈùôÊÄÅ‰ª£ÁêÜÊõ¥Á¨¶ÂêàÈù¢ÂêëÂØπË±°ÁöÑÂéüÂàô„ÄÇ ÂÆûÈôÖÂºÄÂèë‰∏≠ÂÖ∑‰Ωì‰ΩøÁî®Âì™ÁßçÊñπÂºèÊù•ÂÆûÁé∞‰ª£ÁêÜÔºåÁúãËá™Â∑±ÁöÑÂÅèÂ•Ω„ÄÇ ÂàÜÁ±ªÈùôÊÄÅ‰ª£ÁêÜÂíåÂä®ÊÄÅ‰ª£ÁêÜÊòØ‰ªé code ÊñπÈù¢Êù•Âå∫ÂàÜ‰ª£ÁêÜÊ®°ÂºèÁöÑ„ÄÇ ‰πüÂèØ‰ª•‰ªéÂÖ∂‰ΩøÁî®ËåÉÂõ¥Êù•Âå∫ÂàÜ‰∏çÂêåÁ±ªÂûãÁöÑ‰ª£ÁêÜÂÆûÁé∞Ôºö ËøúÁ®ã‰ª£ÁêÜÔºàRemote ProxyÔºâ‰∏∫Êüê‰∏™ÂØπË±°Âú®‰∏çÂêåÁöÑÂÜÖÂ≠òÂú∞ÂùÄÁ©∫Èó¥Êèê‰æõÂ±ÄÈÉ®‰ª£ÁêÜ„ÄÇ‰ΩøÁ≥ªÁªüÂèØ‰ª•Â∞Ü Server ÈÉ®ÂàÜÁöÑÂÆûÁé∞ÈöêËóèÔºå‰ª•‰æø Client ÂèØ‰ª•‰∏çËÄÉËôë Server ÁöÑÂ≠òÂú®„ÄÇ ËôöÊãü‰ª£ÁêÜÔºàVirtual ProxyÔºâ‰ΩøÁî®‰∏Ä‰∏™‰ª£ÁêÜÂØπË±°Ë°®Á§∫‰∏Ä‰∏™ÂçÅÂàÜËÄóËµÑÊ∫êÁöÑÂØπË±°Âπ∂Âú®ÁúüÊ≠£ÈúÄË¶ÅÊó∂ÊâçÂàõÂª∫„ÄÇ ‰øùÊä§‰ª£ÁêÜ(Protection Proxy)Ôºö‰ΩøÁî®‰ª£ÁêÜÊéßÂà∂ÂØπÂéüÂßãÂØπË±°ÁöÑËÆøÈóÆ„ÄÇËØ•Á±ªÂûãÁöÑ‰ª£ÁêÜÂ∏∏Ë¢´Áî®‰∫éÂéüÂßãÂØπË±°ÂÖ∑Êúâ‰∏çÂêåËÆøÈóÆÊùÉÈôêÁöÑÊÉÖÂÜµ„ÄÇ Êô∫ËÉΩÂºïÁî®(Smart Reference)ÔºöÂú®ËÆøÈóÆÂéüÂßãÂØπË±°Êó∂ÊâßË°å‰∏Ä‰∫õËá™Â∑±ÁöÑÈôÑÂä†Êìç‰ΩúÂπ∂ÂØπÊåáÂêëÂéüÂßãÂØπË±°ÁöÑÂºïÁî®ËÆ°Êï∞„ÄÇ ÈùôÂä®ÊÄÅ‰ª£ÁêÜÈÉΩÂèØ‰ª•Â∫îÁî®‰∫é‰∏äËø∞ 4 ÁßçÊÉÖÂΩ¢„ÄÇ AndroidÊ∫êÁ†Å‰∏≠ÁöÑ‰ª£ÁêÜÊ®°ÂºèÂÆûÁé∞‰ª• ActivityManager ‰∏∫‰æã„ÄÇ ÊäΩË±°Êé•Âè£: IActivityManager ‰ª£ÁêÜÁ±ª ActivityManagerProxy Ë¢´‰ª£ÁêÜÁ±ª ActivityManagerNative(ÊäΩË±°Á±ªÔºåÂπ∂‰∏çÂ§ÑÁêÜÂ§™Â§öÁöÑÈÄªËæëÔºåÂ§ßÈÉ®ÂàÜÈÄªËæëÁî±ÂÖ∂Â≠êÁ±ª‚Äî‚ÄîActivityManagerService ÊâøÊãÖ) ActivityManagerService(ÁúüÂÆûÈÉ®ÂàÜ) ActivityManagerService ÊòØÁ≥ªÁªüÁ∫ßÁöÑ Service Âπ∂‰∏îËøêË°å‰∫éÁã¨Á´ãÁöÑËøõÁ®ãÁ©∫Èó¥‰∏≠ÔºåÂèØ‰ª•ÈÄöËøá ServiceManger Ëé∑ÂèñÂà∞ÂÆÉ„ÄÇ ActivityManagerProxy ËøêË°å‰∫éËá™Â∑±ÊâÄÂ§ÑÁöÑËøõÁ®ãÁ©∫Èó¥‰∏≠Ôºà‰πüÂ∞±ÊòØËØ¥Ôºå‰∏é ActivityManagerService ËøêË°åÂú®‰∏çÂêåÁöÑËøõÁ®ã‰∏≠Ôºâ ÊâÄ‰ª•Ê≠§Â§ÑÊ∫êÁ†ÅÊâÄÂÆûÁé∞ÁöÑ‰ª£ÁêÜÂÆûË¥®‰∏∫==ËøúÁ®ã‰ª£ÁêÜ==„ÄÇ ActivityManagerProxy Âú®ÂÆûÈôÖÁöÑÈÄªËæëÂ§ÑÁêÜÂπ∂Ê≤°ÊúâËøáÂ§öÂú∞Ë¢´Â§ñÈÉ®Á±ª‰ΩøÁî®ÔºåAndroid ‰∏≠ÁÆ°ÁêÜ‰∏éÁª¥Êä§ Activity Áõ∏ÂÖ≥‰ø°ÊÅØÁöÑÁ±ªÊòØÂè¶‰∏Ä‰∏™Âè´ÂÅö ActivityManager ÁöÑÁ±ª„ÄÇ‰∏çËøáÂÆûË¥®‰∏ä ActivityManager Â§ßÂ§öÊï∞ÈÄªËæëËøòÊòØÁî± ActivityManagerProxy ÊâøÊãÖ„ÄÇÔºàÊ≥®ÊÑèÔºöActivityManager Âπ∂Ê≤°ÊúâÂÆûÁé∞ IActivityManager Êé•Âè£ÔºåÂÆÉÁõ¥Êé•ÁªßÊâøËá™ ObjectÔºâ ‰ª• ActivityManager ÁöÑ getAppTasks() ÊñπÊ≥ï‰∏∫‰æã1234567891011121314public List&lt;ActivityManager.AppTask&gt; getAppTasks() &#123; ArrayList&lt;AppTask&gt; tasks = new ArrayList&lt;AppTask&gt;(); List&lt;IAppTask&gt; appTasks; try &#123; appTasks = ActivityManagerNative.getDefault().getAppTasks(mContext.getPackageName()); &#125; catch (RemoteException e) &#123; throw e.rethrowFromSystemServer(); &#125; int numAppTasks = appTasks.size(); for (int i = 0; i &lt; numAppTasks; i++) &#123; tasks.add(new AppTask(appTasks.get(i))); &#125; return tasks;&#125; ActivityManagerNative.getDefault();ÊñπÊ≥ï ËøîÂõû‰∏Ä‰∏™ IActivityManager Á±ªÂûãÁöÑÂØπË±°ÔºåÈÄöËøáËØ•ÂØπË±°Ë∞ÉÁî®ÂÖ∂ getAppTasks ÊñπÊ≥ï123static public IActivityManager getDefault() &#123; return gDefault.get();&#125; gDefault Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü123456789private static final Singleton&lt;IActivityManager&gt; gDefault = new Singleton&lt;IActivityManager&gt;() &#123; protected IActivityManager create() &#123; IBinder b = ServiceManager.getService("activity");//Ëé∑Âèñ AMS //‰ª£Á†ÅÁúÅÁï• IActivityManager am = asInterface(b);//ÂÆåÊàêÂàõÂª∫‰∏Ä‰∏™ AMS ÁöÑÂÆ¢Êà∑Á´ØÁ´Ø‰ª£ÁêÜÂØπË±°‚Äî‚Äî ActivityManagerProxy //‰ª£Á†ÅÁúÅÁï• return am; &#125;&#125;; ‰∏äËø∞‰ª£Á†Å‰∏≠ÊûÑÈÄ†‰∫Ü‰∏Ä‰∏™ Singleton&lt;IActivityManager&gt; Á±ªÂûãÁöÑ gDefault ÂØπË±°ÔºåÂÖ∂‰∏≠ÈÄöËøá ServiceManager.getService(&quot;activity&quot;); Ëé∑Âèñ‰∏Ä‰∏™Á≥ªÁªüÁ∫ßÁöÑ ServiceÔºåËÄåËØ• Service ÂÆûË¥®‰∏äÂ∞±ÊòØ AMSÔºåÊé•ÁùÄË∞ÉÁî® asInterface ÊñπÊ≥ïÔºåÂàõÂª∫‰∏Ä‰∏™ ActivityManagerProxy ÂØπË±°„ÄÇ ActivityManagerNative.asInterface ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞1234567891011static public IActivityManager asInterface(IBinder obj) &#123; if (obj == null) &#123; return null; &#125; IActivityManager in = (IActivityManager)obj.queryLocalInterface(descriptor); if (in != null) &#123; return in; &#125; return new ActivityManagerProxy(obj);&#125; ActivityManagerProxy ÁöÑ getTasks ÊñπÊ≥ïÔºåÂ∞ÜÊï∞ÊçÆÊâìÂåÖË∑®ËøõÁ®ã‰º†ÈÄíÁªô Server Á´ØÁöÑ AMS Â§ÑÁêÜ12345678910111213141516171819202122232425public List&lt;ActivityManager.RunningTaskInfo&gt; getTasks(int maxNum, int flags) throws RemoteException &#123; Parcel data = Parcel.obtain(); Parcel reply = Parcel.obtain(); data.writeInterfaceToken(IActivityManager.descriptor); data.writeInt(maxNum); data.writeInt(flags); mRemote.transact(GET_TASKS_TRANSACTION, data, reply, 0); reply.readException(); ArrayList&lt;ActivityManager.RunningTaskInfo&gt; list = null; int N = reply.readInt(); if (N &gt;= 0) &#123; list = new ArrayList&lt;&gt;(); while (N &gt; 0) &#123; ActivityManager.RunningTaskInfo info = ActivityManager.RunningTaskInfo.CREATOR .createFromParcel(reply); list.add(info); N--; &#125; &#125; data.recycle(); reply.recycle(); return list; &#125; ÁúãÁúã AMS ‰∏≠ÁöÑ getTasks ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ1234567891011121314151617181920212223242526272829303132333435@Overridepublic List&lt;IAppTask&gt; getAppTasks(String callingPackage) &#123; int callingUid = Binder.getCallingUid(); long ident = Binder.clearCallingIdentity(); synchronized(this) &#123; ArrayList&lt;IAppTask&gt; list = new ArrayList&lt;IAppTask&gt;(); try &#123; if (DEBUG_ALL) Slog.v(TAG, "getAppTasks"); final int N = mRecentTasks.size(); for (int i = 0; i &lt; N; i++) &#123; TaskRecord tr = mRecentTasks.get(i); // Skip tasks that do not match the caller. We don't need to verify // callingPackage, because we are also limiting to callingUid and know // that will limit to the correct security sandbox. if (tr.effectiveUid != callingUid) &#123; continue; &#125; Intent intent = tr.getBaseIntent(); if (intent == null || !callingPackage.equals(intent.getComponent().getPackageName())) &#123; continue; &#125; ActivityManager.RecentTaskInfo taskInfo = createRecentTaskInfoFromTaskRecord(tr); AppTaskImpl taskImpl = new AppTaskImpl(taskInfo.persistentId, callingUid); list.add(taskImpl); &#125; &#125; finally &#123; Binder.restoreCallingIdentity(ident); &#125; return list; &#125;&#125; Android ‰∏≠ÁöÑ Binder Ë∑®ËøõÁ®ãÈÄö‰ø°Êú∫Âà∂‰∏é AIDLÂõõ‰∏™ÈáçË¶ÅÁ±ªÔºö Binder Client Á±ªÊØî PC„ÄÅÁªàÁ´ØËÆæÂ§á Binder Server Á±ªÊØî ÊúçÂä°Âô® Binder DriverÔºàÂÆûÁé∞Âú®ÂÜÖÊ†∏‰∏≠Ôºâ Á±ªÊØî Ë∑ØÁî±Âô® Binder Manager Á±ªÊØî DNS ÊúçÂä°Âô® Âõ†‰∏∫‰æùËµñ‰∫éÊäΩË±°ÔºåÂä†‰∏äÊú¨Âú∞‰ª£ÁêÜÁ±ªÁöÑÂ≠òÂú®ÔºåÊâÄ‰ª•Ë∞ÉÁî®ËøúÁ®ãÊñπÊ≥ïÊó∂ÔºåËøòÊòØ‰∏éË∞ÉÁî®Êú¨Âú∞ÁöÑÊôÆÈÄöÁöÑÊñπÊ≥ï‰∏ÄÊ†∑„ÄÇ‰ΩÜÊòØ‰ª£ÁêÜÁ±ªÂÜÖÈÉ®ÈúÄË¶ÅÂØπÂèÇÊï∞‰ªÄ‰πàÁöÑËøõË°åÊâìÂåÖÂ§ÑÁêÜÔºåÁÑ∂ÂêéÂÜçÈÄöËøá Binder Êú∫Âà∂ÔºåË∑®ËøõÁ®ãÂ∞ÜÊï∞ÊçÆ‰º†ÈÄíÁªôËøúÁ®ãÊñπÊ≥ïÔºåËøúÁ®ãÊñπÊ≥ïÊâßË°åÂÆåÊØïÂÜçËøîÂõûÊï∞ÊçÆ„ÄÇ Binder Driver ÂÆûÁé∞Âú®ÂÜÖÊ†∏‰∏≠Ôºå‰∏ªË¶ÅË¥üË¥£ Binder ÈÄö‰ø°ÁöÑÂª∫Á´ãÔºå‰ª•Âèä BinderÊï∞ÊçÆÂú®ËøõÁ®ãÈó¥ÁöÑ‰º†ÈÄíÂíå Binder ÂºïÁî®ËÆ°Êï∞ÁÆ°ÁêÜ/Êï∞ÊçÆÂåÖÁöÑ‰º†ËæìÁ≠â„ÄÇ Binder Client Âíå Binder Server ‰πãÈó¥ÁöÑË∑®ËøõÁ®ãÈÄö‰ø°Áªü‰∏ÄÈÄöËøá Binder Driver Â§ÑÁêÜËΩ¨ÂèëÔºå ÂØπ‰∫é Binder Client ËÄåË®ÄÔºåÂÆÉÂè™ÈúÄË¶ÅÁü•ÈÅìËá™Â∑±Ë¶Å‰ΩøÁî®ÁöÑ Binder ÁöÑÂêçÂ≠ó‰ª•ÂèäËØ• Binder ÂÆû‰ΩìÂú® ServerManager ‰∏≠ÁöÑ 0 Âè∑ÂºïÁî®Âç≥ÂèØ„ÄÇ ËÆøÈóÆÂéüÁêÜÔºö ÈÄöËøá 0 Âè∑ÂºïÁî®ÂéªËÆøÈóÆ ServerManager Ëé∑ÂèñËØ• Binder ÁöÑÂºïÁî®Ôºå ÂæóÂà∞ÂºïÁî®ÂêéÂ∞±ÂèØ‰ª•ÂÉèÊôÆÈÄöÊñπÊ≥ïË∞ÉÁî®ÈÇ£Ê†∑Ë∞ÉÁî® Binder ÂÆû‰ΩìÁöÑÊñπÊ≥ï ServerManager Áî®Êù•ÁÆ°ÁêÜ Binder ServerÔºàAndroid ‰∏≠ÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ ServiceÔºâ Binder Client ÈÄöËøáÂÆÉÊù•Êü•ËØ¢ Binder Server ÁöÑÂºïÁî® ServerManager ÊòØ‰∏Ä‰∏™Ê†áÂáÜÁöÑ Binder ServerÔºåÂπ∂‰∏îÂú® Android ‰∏≠Á∫¶ÂÆöÂÖ∂Âú® Binder ÈÄö‰ø°ËøáÁ®ã‰∏≠ÁöÑÂîØ‰∏ÄÊ†áËØÜÔºàÁ±ª‰ºº‰∫é IP Âú∞ÂùÄÔºâÊ∞∏Ëøú‰∏∫ 0„ÄÇ Âú® IServiceManager Êé•Âè£‰∏≠ÂÆö‰πâÊúâÂØπÂ§ñÂºÄÊîæÁöÑÊé•Âè£ÊñπÊ≥ïÔºå‰æõÂÆ¢Êà∑Á´ØËÆøÈóÆ„ÄÇ ÂåøÂêç Binder„ÄÇÂæàÂ§öÊó∂ÂÄô Binder Server ‰ºöÂ∞Ü‰∏Ä‰∏™ Binder ÂÆû‰ΩìÂ∞ÅË£ÖËøõÊï∞ÊçÆÂåÖ‰º†ÈÄíÁªô Binder ClientÔºåËÄåÊ≠§Êó∂ Binder Server ‰ºöÂú®ËØ•Êï∞ÊçÆÂåÖ‰∏≠Ê†áÊ≥® Binder ÂÆû‰ΩìÁöÑ‰ΩçÁΩÆÔºåBinder Driver ‰ºö‰∏∫ËØ•ÂåøÂêçÁöÑ Binder ÁîüÊàêÂÆû‰ΩìÁªìÁÇπÂíåÂÆû‰ΩìÂºïÁî®ÔºåÂπ∂Â∞ÜËØ•ÂºïÁî®‰º†ÈÄíÁªô Binder Client„ÄÇ IServiceManager Êé•Âè£(Â£∞Êòé ServerManger ÂØπÂ§ñÊèê‰æõÁöÑÊñπÊ≥ï„ÄÅÊï∞ÊçÆ )1234567891011121314151617181920212223public interface IServiceManager extends IInterface &#123; public IBinder getService(String name) throws RemoteException; public IBinder checkService(String name) throws RemoteException; */ public void addService(String name, IBinder service, boolean allowIsolated) throws RemoteException; public String[] listServices() throws RemoteException; public void setPermissionController(IPermissionController controller) throws RemoteException; static final String descriptor = "android.os.IServiceManager"; int GET_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION; int CHECK_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+1; int ADD_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+2; int LIST_SERVICES_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+3; int CHECK_SERVICES_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+4; int SET_PERMISSION_CONTROLLER_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+5;&#125; ÂèÇËÄÉ„ÄäAndorid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Â¶ÇÊûúÊú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÔºåËØ∑Â§ßÂÆ∂ÊèêÂá∫ÂíåÊàëËÆ®ËÆ∫ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê∑±ÂÖ•ÁêÜËß£ LayoutInflater]]></title>
    <url>%2Fblog%2F2017%2F08%2F17%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20LayoutInflater%2F</url>
    <content type="text"><![CDATA[‰∏Ä„ÄÅÊ¶ÇËø∞ View rootView = LayoutInflater.from(getContext()).inflate(R.layout.bitable_grid_view, this, false); Android ÂºÄÂèëËÄÖÂØπ‰∏äÈù¢ËøôË°å‰ª£Á†ÅÂ∫îËØ•‰∏çÈôåÁîüÔºåÊàë‰ª¨ÈÄöÂ∏∏Áî®Ëøô‰∏™ÊñπÊ≥ïÊù•Ê∏≤Êüì‰∏Ä‰∏™Â∏ÉÂ±Ä„ÄÇÂÖ∂‰∏≠ÁöÑÂéüÁêÜÊòØÊÄé‰πàÊ†∑ÁöÑÂë¢ÔºüÊú¨Êñá‰∏ªË¶ÅÂàÜÊûê LayoutInflater ÁöÑÂàõÂª∫ËøáÁ®ã‰ª•Âèä inflate ÊñπÊ≥ïÁöÑÂéüÁêÜ„ÄÇ ‰∫å„ÄÅLayoutInflater ÊòØÂ¶Ç‰ΩïÂàõÂª∫ÁöÑ‰ªé LayoutInflater#from ÊñπÊ≥ïÁúãËµ∑„ÄÇ 12345678public static LayoutInflater from(Context context) &#123; LayoutInflater LayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); if (LayoutInflater == null) &#123; throw new AssertionError("LayoutInflater not found."); &#125; return LayoutInflater;&#125; ‰ªé‰ª£Á†Å‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåLayoutInflater ÊòØÈÄöËøá Context#getSystemService ÁöÑÊñπÂºèËé∑ÂèñÁöÑ„ÄÇ Context ÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåÂÆÉÁöÑÂÖ∑‰ΩìÂÆûÁé∞Á±ª‰∏∫ ContextImpl„ÄÇÊâÄ‰ª•Â∫îËØ•Áúã ContextImpl ÁöÑ getSystemService ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇ ContextImpl#getSystemService 1234@Overridepublic Object getSystemService(String name) &#123; return SystemServiceRegistry.getSystemService(this, name);&#125; ContextImpl#getSystemService ÊñπÊ≥ïÂèàÂßîÊâò‰∫Ü SystemServiceRegistry„ÄÇ SystemServiceRegistry ‰∏≠Êúâ‰∏Ä‰∏™ HashMap&lt;String, ServiceFetcher&lt;?&gt;&gt; ÔºåËØ• HashMap ‰ª•ÊúçÂä°ÂêçÁß∞‰∏∫ keyÔºå‰ª•ÊúçÂä°Áõ∏ÂØπÂ∫îÁöÑ ServiceFetcher ‰Ωú‰∏∫ value„ÄÇ 12private static final HashMap&lt;String, ServiceFetcher&lt;?&gt;&gt; SYSTEM_SERVICE_FETCHERS = new HashMap&lt;&gt;(); ÂÖ∑‰ΩìÁöÑËé∑ÂèñÊñπÊ≥ï‰∏∫ 1234567/** * Gets a system service from a given context. */public static Object getSystemService(ContextImpl ctx, String name) &#123; ServiceFetcher&lt;?&gt; fetcher = SYSTEM_SERVICE_FETCHERS.get(name); return fetcher != null ? fetcher.getService(ctx) : null;&#125; Ê†πÊçÆÊúçÂä°ÂêçÁß∞ÂéªËé∑ÂèñÁõ∏Â∫îÁöÑ ServiceFetcherÔºå Â¶ÇÊûú ServiceFetcher ‰∏ç‰∏∫Á©∫ÔºåÂàôË∞ÉÁî® ServiceFetcher.getService ÊñπÊ≥ïËé∑ÂèñÁõ∏Â∫îÊúçÂä°ÁöÑÂºïÁî®„ÄÇ Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî®‰ºöÂÖàÂàõÂª∫ÔºåÁÑ∂ÂêéÁõ¥Êé•ËøîÂõû Âê¶ÂàôÁõ¥Êé•ËøîÂõûÁºìÂ≠òÁöÑÂÄº Â¶ÇÊûú ServiceFetcher ‰∏∫Á©∫ÔºåÂàôËøîÂõû null„ÄÇ SYSTEM_SERVICE_FETCHER Êï∞ÊçÆÂàùÂßãÂåñSYSTEM_SERVICE_FETCHERS ÊòØ‰∏Ä‰∏™ÈîÆ‰∏∫ String, ÂÄº‰∏∫ ServiceFetcher&lt;?&gt; ÁöÑÈùôÊÄÅ HashMap Â∏∏ÈáèÔºåÂÖ∂‰∏≠ÁöÑÊï∞ÊçÆÊòØÂú®ÈùôÊÄÅ‰ª£Á†ÅÂùó‰∏≠ÊèíÂÖ•ÁöÑ„ÄÇ LayoutInflater ÂØπÂ∫îÁöÑ ServiceFetcher Â∞±ÊòØÂú®Ëøô‰∏™Êó∂ÂÄôÂ≠òÂÇ®ËøõÂéªÁöÑ„ÄÇ 12345678910static &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class, new CachedServiceFetcher&lt;LayoutInflater&gt;() &#123; @Override public LayoutInflater createService(ContextImpl ctx) &#123; return new PhoneLayoutInflater(ctx.getOuterContext()); &#125;&#125;); //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å&#125; ‰∏∫‰ªÄ‰πàË¶ÅÊîæÂú® CachedServiceFetcher ‰∏≠ËÄå‰∏çÊòØÁõ¥Êé•ÂàõÂª∫Âë¢ÔºüServiceFetcher ÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåÁ≥ªÁªü‰ΩøÁî®ÁöÑ‰∏Ä‰∏™ÂÖ∑‰ΩìÂÆûÁé∞Á±ª‰∏∫ CachedServiceFetcher„ÄÇ‰ªéÂêçÂ≠óÊù•ÁúãÔºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÂÆûÁé∞ÊáíÂä†ËΩΩÔºåÂΩìÈ¶ñÊ¨°ÈúÄË¶Å‰ΩøÁî®ÊâçËß¶ÂèëÂàùÂßãÂåñÔºåÈÅøÂÖçÊµ™Ë¥πËµÑÊ∫ê„ÄÇ CachedServiceFetcher#getService ÊñπÊ≥ïÁöÑÂÆûÁé∞ 1234567891011121314151617public final T getService(ContextImpl ctx) &#123; final Object[] cache = ctx.mServiceCache; synchronized (cache) &#123; // Fetch or create the service. Object service = cache[mCacheIndex];//ÂÖà‰ªé ContextImpl ÁöÑÁºìÂ≠òÂàóË°®‰∏≠Ëé∑ÂèñÔºåÂ¶ÇÊûúÊ≤°ÊúâÁºìÂ≠òÂÜçË∞ÉÁî® CachedServiceFetcher#createService ÊñπÊ≥ïÂàõÂª∫ PhoneLayoutInflater if (service == null) &#123; try &#123; service = createService(ctx);//ÂàõÂª∫ÂØπÂ∫îÁöÑ service cache[mCacheIndex] = service;//Â≠òÂÇ®Âà∞ÁºìÂ≠òÊï∞ÁªÑ‰∏≠ &#125; catch (ServiceNotFoundException e) &#123; onServiceNotFound(e); &#125; &#125; return (T)service; &#125;&#125; Â∞èÁªìÈÄöËøá from ÁöÑÊñπÂºèËé∑Âèñ LayoutInflaterÔºåÊúÄÁªàË∞ÉÁî®ÁöÑÊòØ SystemServiceRegistry ÁöÑ getService ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ï‰ºö‰ªé ContextImpl ‰∏≠Áª¥Êä§ÁöÑÁºìÂ≠òÊï∞ÁªÑ‰∏≠Ëé∑ÂèñÊúçÂä°ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÂàôË∞ÉÁî® createService ÊñπÊ≥ïÂàõÂª∫‰∏Ä‰∏™ PhoneLayoutInflater„ÄÇÔºàÊ≥®ÔºöLayoutInflater ÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåÁ≥ªÁªüÂàõÂª∫ÁöÑÊòØÂÆÉÁöÑÂ≠êÁ±ª‚Äî‚Äî PhoneLayoutInflaterÔºâ onCreateView ÊòØ PhoneLayoutInflater ‰∏≠ÊúÄÈáçË¶ÅÁöÑÊñπÊ≥ï„ÄÇ‰∏∫‰ªÄ‰πàËØ¥ÂÆÉÈáçË¶ÅÔºåÂêéÈù¢‰ºöÊèêÂà∞„ÄÇ 1234567891011121314151617181920/** Override onCreateView to instantiate names that correspond to the widgets known to the Widget factory. If we don't find a match, call through to our super class.*///‰∏∫Á≥ªÁªüÂÜÖÁΩÆÁöÑÊéß‰ª∂Ê∑ªÂä†ÂâçÁºÄ„ÄÇÊØîÂ¶Ç‰∏∫ TextView Ê∑ªÂä†ÂâçÁºÄÔºåÁªìÊûú‰∏∫ android.widget.TextView@Override protected View onCreateView(String name, AttributeSet attrs) throws ClassNotFoundException &#123; for (String prefix : sClassPrefixList) &#123; try &#123; View view = createView(name, prefix, attrs); if (view != null) &#123; return view; &#125; &#125; catch (ClassNotFoundException e) &#123; // In this case we want to let the base class take a crack // at it. &#125; &#125; return super.onCreateView(name, attrs);&#125; ‰∏â„ÄÅÂ∏ÉÂ±ÄÂàõÂª∫ËøáÁ®ã‰∏ÄËà¨Êàë‰ª¨Âú®Ê∏≤Êüì ListView ÊàñËÄÖ RecyclerView ‰∏≠ÁöÑÂàóË°®È°πÊó∂ÔºåÈÉΩ‰ºöË∞ÉÁî® inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) ÊñπÊ≥ïÔºàÊúâÊó∂‰πü‰ºö‰ΩøÁî®‰∏§‰∏™ÂèÇÊï∞ÁöÑÊñπÊ≥ïÔºâ„ÄÇÂèØ‰ª•ÁúãÂà∞ËØ•ÊñπÊ≥ïÂÜÖÈÉ®‰ºöË∞ÉÁî® inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot)„ÄÇ 123public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) &#123; return inflate(resource, root, root != null);&#125; 1234567891011public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) &#123; final Resources res = getContext().getResources(); //‰ª£Á†ÅÁúÅÁï• //Ëé∑Âèñ xml Ëß£ÊûêÂô® final XmlResourceParser parser = res.getLayout(resource); try &#123; return inflate(parser, root, attachToRoot); &#125; finally &#123; parser.close(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) &#123; synchronized (mConstructorArgs) &#123; final Context inflaterContext = mContext; final AttributeSet attrs = Xml.asAttributeSet(parser); Context lastContext = (Context) mConstructorArgs[0]; mConstructorArgs[0] = inflaterContext; //Â≠òÂÇ®‰º†ÂÖ•ÁöÑÁà∂ËßÜÂõæ View result = root; try &#123; int type; // ÂèòÈáèÊü•ÊâæÊ†πËäÇÁÇπ while ((type = parser.next()) != XmlPullParser.START_TAG &amp;&amp; type != XmlPullParser.END_DOCUMENT) &#123; // Empty &#125; final String name = parser.getName(); if (TAG_MERGE.equals(name)) &#123; //1. Ëß£Êûê merge Ê†áÁ≠æ rInflate(parser, root, inflaterContext, attrs, false); &#125; else &#123; // 2. ‰∏çÊòØ merge ÂÖÉÁ¥†Â∞±Áõ¥Êé•Ëß£ÊûêÂ∏ÉÂ±Ä‰∏≠ÁöÑËßÜÂõæ // Temp is the root view that was found in the xml final View temp = createViewFromTag(root, name, inflaterContext, attrs); ViewGroup.LayoutParams params = null; if (root != null) &#123; // ÁîüÊàêÂ∏ÉÂ±ÄÂèÇÊï∞ params = root.generateLayoutParams(attrs); if (!attachToRoot) &#123; //Â¶ÇÊûú attachToRoot ‰∏∫ falseÔºåÂ∞±Áªô temp ËÆæÁΩÆÂ∏ÉÂ±ÄÂèÇÊï∞ temp.setLayoutParams(params); &#125; &#125; // Ëß£Êûê temp ËßÜÂõæ‰∏ãÁöÑÊâÄÊúâÂ≠ê View rInflateChildren(parser, temp, attrs, true); // Â¶ÇÊûú root ‰∏ç‰∏∫Á©∫Âπ∂‰∏î attachToRoot ‰∏∫ trueÔºåÈÇ£‰πàÂ∞Ü temp Ê∑ªÂä†Âà∞ Áà∂ËßÜÂõæ‰∏≠ if (root != null &amp;&amp; attachToRoot) &#123; root.addView(temp, params); &#125; //Â¶ÇÊûú root ‰∏∫Á©∫ ÊàñËÄÖ attachToRoot ‰∏∫ falseÔºåËøîÂõû xml ‰∏≠ÁöÑ rootÔºåËÄå‰∏çÊòØÁà∂ËßÜÂõæ if (root == null || !attachToRoot) &#123; result = temp; &#125; &#125; &#125; return result; &#125;&#125; ‰ª•‰∏äÁöÑ inflate ÊñπÊ≥ï‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†Ê≠• Ëß£Êûê xml ÁöÑÊ†πÊ†áÁ≠æ Â¶ÇÊûúÊ†πÊ†áÁ≠æÊòØ mergeÔºåË∞ÉÁî® rInflate ËøõË°åËß£ÊûêÔºårInflate ‰ºöÂ∞Ü merge Ê†áÁ≠æ‰∏ãÁöÑÊâÄÊúâÂ≠ê View Áõ¥Êé•Ê∑ªÂä†Âà∞Ê†πÊ†áÁ≠æ‰∏≠ Â¶ÇÊûúÊ†áÁ≠æÊòØÊôÆÈÄöÂÖÉÁ¥†ÔºåË∞ÉÁî® createFromTagÔºåÁîüÊàêÁõ∏Â∫îÁöÑ view„ÄÇ Ë∞ÉÁî® rInflate Ëß£Êûê temp Ê†πÂÖÉÁ¥†‰∏ãÁöÑÊâÄÊúâÂ≠ê ViewÔºåÂπ∂‰∏îÂ∞ÜËøô‰∫õÂ≠ê View ÈÉΩÊ∑ªÂä†Âà∞ temp ‰∏ã ËøîÂõûËß£ÊûêÂà∞ÁöÑÊ†πËßÜÂõæ„ÄÇ Êàë‰ª¨ÂÖà‰ªéËß£ÊûêÂçï‰∏™ÂÖÉÁ¥†ÁöÑ createViewFromTag ÊñπÊ≥ïÁúãËµ∑„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr) &#123; if (name.equals("view")) &#123; name = attrs.getAttributeValue(null, "class"); &#125; // Apply a theme wrapper, if allowed and one is specified. if (!ignoreThemeAttr) &#123; final TypedArray ta = context.obtainStyledAttributes(attrs, ATTRS_THEME); final int themeResId = ta.getResourceId(0, 0); if (themeResId != 0) &#123; context = new ContextThemeWrapper(context, themeResId); &#125; ta.recycle(); &#125; try &#123; View view; //Áî®Êà∑ÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ LayoutInlflater ÁöÑ factory Êù•Ëá™Ë°åËß£Êûê ViewÔºåÈªòËÆ§Ëøô‰∫õ Factory ÈÉΩ‰∏∫Á©∫ÔºåÂèØÂøΩÁï•ËøôÊÆµ if (mFactory2 != null) &#123; view = mFactory2.onCreateView(parent, name, context, attrs); &#125; else if (mFactory != null) &#123; view = mFactory.onCreateView(name, context, attrs); &#125; else &#123; view = null; &#125; if (view == null &amp;&amp; mPrivateFactory != null) &#123; view = mPrivateFactory.onCreateView(parent, name, context, attrs); &#125; if (view == null) &#123; final Object lastContext = mConstructorArgs[0]; mConstructorArgs[0] = context; try &#123; if (-1 == name.indexOf('.')) &#123; // Ëß£ÊûêÂÜÖÁΩÆ View Êéß‰ª∂ view = onCreateView(parent, name, attrs); &#125; else &#123; // Ëß£ÊûêËá™ÂÆö‰πâÊéß‰ª∂ view = createView(name, null, attrs); &#125; &#125; finally &#123; mConstructorArgs[0] = lastContext; &#125; &#125; return view; &#125; //‰ª£Á†ÅÁúÅÁï• onCreateView ÊñπÊ≥ïÂíå createView ÊñπÊ≥ïÊúâ‰Ωï‰∏çÂêåÔºüÂâçÈù¢ÁöÑ‰ªãÁªç‰∏≠ÔºåÊàë‰ª¨ÊúâÊèêÂà∞ LayoutInlflater ÂàõÂª∫ÁöÑÂÆûÈôÖÁ±ªÂûã‰∏∫ PhoneLayoutInlflater ÔºåPhoneLayoutInlflater Ë¶ÜÂÜô‰∫Ü onCreateView ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂ∞±ÊòØÂú® View ÁöÑÊ†áÁ≠æÂêçÂâçÊ∑ªÂä†‰∏Ä‰∏™ &quot;android.widget.&quot; Êàñ &quot;android.webkit.&quot; Êàñ &quot;android.app.&quot;ÂâçÁºÄ„ÄÇÁÑ∂ÂêéÂÜç‰º†ÈÄíÁªô createView Ëß£Êûê„ÄÇ ‰πüÂ∞±ÊòØËØ¥ÂÜÖÁΩÆ View ÂíåËá™ÂÆö‰πâ View ÊúÄÁªàÈÉΩË∞ÉÁî®‰∫Ü createView ËøõË°åËß£Êûê„ÄÇ ‰∏∫‰ªÄ‰πàË¶ÅËøô‰πàËÆæËÆ°Âë¢ÔºüËøôÊòØ‰∏∫‰∫ÜÊñπ‰æøÂºÄÂèëËÄÖÂú® xml Êñá‰ª∂‰∏≠Êõ¥Êñπ‰æø‰ΩøÁî®Á≥ªÁªüÂÜÖÁΩÆÁöÑ ViewÔºàÂè™ÈúÄË¶ÅÂÜô View ÂêçÁß∞ËÄå‰∏çÈúÄË¶ÅÂÜôÂÆåÊï¥ÁöÑË∑ØÂæÑÔºâÔºåÂ¶ÇÊûúÊòØËá™ÂÆö‰πâÊéß‰ª∂ÊàñËÄÖÁ¨¨‰∏âÊñπÂ∫ìÔºåÂÜôÂÆåÊï¥Ë∑ØÂæÑ„ÄÇ createView ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ã 12345678910111213141516171819202122232425262728293031323334353637383940414243//Ê†πÊçÆÂÆåÊï¥Ë∑ØÂæÑÁöÑÁ±ªÂêçÈÄöËøáÂèçÂ∞ÑÊú∫Âà∂ÊûÑÈÄ† View ÂØπË±°public final View createView(String name, String prefix, AttributeSet attrs) throws ClassNotFoundException, InflateException &#123; //‰ªéÁºìÂ≠ò‰∏≠Ëé∑ÂèñÊûÑÈÄ†ÂáΩÊï∞ Constructor&lt;? extends View&gt; constructor = sConstructorMap.get(name); if (constructor != null &amp;&amp; !verifyClassLoader(constructor)) &#123; constructor = null; sConstructorMap.remove(name); &#125; Class&lt;? extends View&gt; clazz = null; try &#123; Trace.traceBegin(Trace.TRACE_TAG_VIEW, name); // ÁºìÂ≠ò‰∏≠Êâæ‰∏çÂà∞ÊûÑÈÄ†ÂáΩÊï∞ if (constructor == null) &#123; //Â¶ÇÊûúÂâçÁºÄÔºàprefixÔºâ‰∏ç‰∏∫Á©∫ÔºåÊûÑÈÄ†ÂÆåÊï¥Ë∑ØÂæÑÔºåÂπ∂‰∏îÂä†ËΩΩËØ•Á±ª clazz = mContext.getClassLoader().loadClass( prefix != null ? (prefix + name) : name).asSubclass(View.class); //‰ª£Á†ÅÁúÅÁï• //‰ªé class ÂØπË±°‰∏≠Ëé∑ÂèñÊûÑÈÄ†ÂáΩÊï∞ constructor = clazz.getConstructor(mConstructorSignature); constructor.setAccessible(true); sConstructorMap.put(name, constructor); &#125; else &#123; //‰ª£Á†ÅÁúÅÁï• &#125; &#125; Object[] args = mConstructorArgs; args[1] = attrs; //ÈÄöËøáÂèçÂ∞ÑÊûÑÈÄ† View final View view = constructor.newInstance(args); if (view instanceof ViewStub) &#123; // Use the same context when inflating ViewStub later. final ViewStub viewStub = (ViewStub) view; viewStub.setLayoutInflater(cloneInContext((Context) args[0])); &#125; return view; &#125; //ÁúÅÁï•ÂêÑÁßç catch„ÄÅfinally ‰ª£Á†Å&#125; createView ÊñπÊ≥ï‰∏≠ÔºåÂ¶ÇÊûúÊéß‰ª∂ÂêçÊúâÂâçÁºÄÂ∞±ÂÖàÊûÑÈÄ† View ÁöÑÂÆåÊï¥Ë∑ØÂæÑÔºåÂπ∂‰∏îÂ∞ÜËØ•Á±ªÂä†ËΩΩÂà∞ËôöÊãüÊú∫‰∏≠ ÁÑ∂ÂêéËé∑ÂèñËØ•Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞Âπ∂ÁºìÂ≠òËµ∑Êù•ÔºåÂÜçÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞Êù•ÂàõÂª∫ËØ• View ÁöÑÂØπË±°Ôºå ÊúÄÂêéÂ∞Ü View ÂØπË±°ËøîÂõûÔºåËøôÂ∞±ÊòØËß£ÊûêÂçï‰∏™ View ÁöÑËøáÁ®ã 123456789101112131415161718192021222324252627282930313233343536373839404142void rInflate(XmlPullParser parser, View parent, Context context, AttributeSet attrs, boolean finishInflate) throws XmlPullParserException, IOException &#123; //Ëé∑ÂèñÊ†ëÁöÑÊ∑±Â∫¶ final int depth = parser.getDepth(); int type; //ÈÄê‰∏™ÂÖÉÁ¥†Ëß£Êûê while (((type = parser.next()) != XmlPullParser.END_TAG || parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) &#123; if (type != XmlPullParser.START_TAG) &#123; continue; &#125; final String name = parser.getName(); if (TAG_REQUEST_FOCUS.equals(name)) &#123; parseRequestFocus(parser, parent); &#125; else if (TAG_TAG.equals(name)) &#123; parseViewTag(parser, parent, attrs); &#125; else if (TAG_INCLUDE.equals(name)) &#123;//Ëß£Êûê include Ê†áÁ≠æ if (parser.getDepth() == 0) &#123; throw new InflateException("&lt;include /&gt; cannot be the root element"); &#125; parseInclude(parser, context, parent, attrs); &#125; else if (TAG_MERGE.equals(name)) &#123;Ëß£Êûê merge Ê†áÁ≠æ throw new InflateException("&lt;merge /&gt; must be the root element"); &#125; else &#123; //Ê†πÊçÆÂÖÉÁ¥†ÂêçËøõË°åËß£Êûê final View view = createViewFromTag(parent, name, context, attrs); final ViewGroup viewGroup = (ViewGroup) parent; final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs); //ÈÄíÂΩíË∞ÉÁî®ËøõË°åËß£ÊûêÔºåÂç≥Ê∑±Â∫¶‰ºòÂÖàÈÅçÂéÜ rInflateChildren(parser, view, attrs, true); //Â∞ÜËß£ÊûêÂà∞ÁöÑ View Ê∑ªÂä†Âà∞ÂÆÉÁöÑÁà∂ËßÜÂõæ‰∏≠ viewGroup.addView(view, params); &#125; &#125; if (finishInflate) &#123; parent.onFinishInflate(); &#125;&#125; rInflate() ÈÄöËøáÊ∑±Â∫¶‰ºòÂÖàÈÅçÂéÜÊù•ÊûÑÈÄ†ËßÜÂõæÊ†ë„ÄÇÊØèËß£ÊûêÂà∞‰∏Ä‰∏™ View ÂÖÉÁ¥†Â∞±‰ºöÈÄíÂΩíË∞ÉÁî® rInflateÔºåÁõ¥Âà∞ËøôÊù°Ë∑ØÂæÑ‰∏ãÁöÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÁÑ∂ÂêéÂú®ÂõûÊ∫ØËøáÊù•Â∞ÜÊØè‰∏™ View ÂÖÉÁ¥†Ê∑ªÂä†Âà∞ÂÆÉ‰ª¨ÁöÑ parent ‰∏≠„ÄÇ ÈÄöËøá rInflate ÁöÑËß£Êûê‰πãÂêéÔºåÊï¥Ê£µËßÜÂõæÊ†ëÂ∞±ÊûÑÂª∫ÂÆåÊØï„ÄÇÂΩìË∞ÉÁî®‰∫Ü Activity ÁöÑ onResume ‰πãÂêéÔºå‰πãÂâçÈÄöËøá setContentView ËÆæÁΩÆÁöÑÂÜÖÂÆπÂ∞±‰ºöÂá∫Áé∞Âú®Êàë‰ª¨ÁöÑËßÜÈáé‰∏≠„ÄÇ Âõõ„ÄÅÂ∏∏ËßÅÈóÆÈ¢òinflate ÊñπÊ≥ïÊúâÂ§öÁßçÈáçËΩΩÔºåÂÆÉ‰ª¨ÁöÑÂå∫Âà´Âú®Âì™ÈáåÔºü‰∏â‰∏™ÂèÇÊï∞ÁöÑ infalte ÊñπÊ≥ïÁöÑÂêÑ‰∏™ÂèÇÊï∞ÁöÑÂê´‰πâÊòØ‰ªÄ‰πàÔºü LayoutInflater#inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) resource ÂèÇÊï∞‰∏∫Â∏ÉÂ±ÄËµÑÊ∫ê„ÄÇÊòØ‰∏Ä‰∏™ xml Êñá‰ª∂„ÄÇ Ëã• root ‰∏ç‰∏∫Á©∫Êó∂ Â¶ÇÊûú attachToRoot ‰∏∫ trueÔºåÂàôÂÆÉÊòØ xml Êñá‰ª∂ÁöÑÊ†πÂ∏ÉÂ±ÄÁöÑÁà∂Â∏ÉÂ±Ä„ÄÇÔºà‰πüÂ∞±ÊòØËØ¥ÔºåÊ∏≤ÊüìÂá∫Êù•ÁöÑÂ∏ÉÂ±ÄË¢´ add root ‰∏≠„ÄÇÂêåÊó∂Ôºåinflate ÊñπÊ≥ïÁöÑËøîÂõûÂÄº‰∏∫ rootÔºâ Â¶ÇÊûú attachToRoot ‰∏∫ falseÔºåÂÆÉÂè™ÊòØ‰∏∫ xml Êñá‰ª∂ÁöÑÊ†πÂ∏ÉÂ±Ä Êèê‰æõ‰∏ÄÁªÑ LayoutParams ÂÄº„ÄÇÂêåÊó∂ inflate ÊñπÊ≥ïËøîÂõûÁöÑ xml Êñá‰ª∂ÁöÑÊ†πÂ∏ÉÂ±Ä„ÄÇ ‰∏§‰∏™ÂèÇÊï∞ÁöÑ inflate ÊñπÊ≥ïÔºåÂÜÖÈÉ®‰πüÊòØË∞ÉÁî®‰∏â‰∏™ÂèÇÊï∞ÁöÑ infalte ÊñπÊ≥ï 123public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) &#123; return inflate(resource, root, root != null);&#125; ÂΩì root ‰∏ç‰∏∫Á©∫ÁöÑÊó∂ÂÄôÔºåinflate(@LayoutRes int resource, @Nullable ViewGroup root) ÊñπÊ≥ïÈªòËÆ§Â∞ÜÊ∏≤ÊüìÂêéÁöÑÂ∏ÉÂ±Ä add Âà∞ root ‰∏≠„ÄÇ ËøòÊúâÂè¶Â§ñ‰∏§ÁßçÈáçËΩΩÔºåÂå∫Âà´‰ªÖÂú®‰∫éÂÆÉ‰ª¨ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÈÉΩÊòØ XmlPullParserÔºåroot Âíå attachToRoot ÂèÇÊï∞Ë°®Áé∞‰∏é‰∏äËø∞‰∏ÄËá¥„ÄÇ Â∞èÁªìÂàõÂª∫ÊµÅÁ®ãÂ§ßËá¥Â¶Ç‰∏ãÔºö È¶ñÂÖàÊü•ÊâæÊ†πÊ†áÁ≠æ Â¶ÇÊûúÊòØ mergeÔºåË∞ÉÁî® rInflate Âê¶ÂàôÔºåË∞ÉÁî® createViewFromTag Â¶ÇÊûúÊòØÁ≥ªÁªüÂÜÖÁΩÆÊéß‰ª∂ÔºàÈÄöËøáÂêçÁß∞‰∏≠ÊòØÂê¶Âê´Êúâ„Äå.„ÄçÊù•Âà§Êñ≠ÔºâÔºåË∞ÉÁî® PhoneLayoutInflater.onCreateView() ÊñπÊ≥ïÊ∑ªÂä†ÂâçÁºÄÔºå Â§ÑÁêÜÂêéÂ∞ÜÂÆåÊï¥Ë∑ØÂæÑ‰º†Áªô LayoutInflater.createView() ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂÜÖÈÉ®‰ºöÈÄöËøáÂèçÂ∞ÑÁöÑÊñπÂºèÂàõÂª∫Âá∫ÂØπÂ∫îÁöÑ view ÂÆû‰æã„ÄÇ Âê¶ÂàôÔºåÁõ¥Êé•Ë∞ÉÁî® LayoutInflater.createView() ËøõË°åËß£Êûê„ÄÇËØ•ÊñπÊ≥ïÂÜÖÈÉ®‰ºöÈÄöËøáÂèçÂ∞ÑÁöÑÊñπÂºèÂàõÂª∫Âá∫ÂØπÂ∫îÁöÑ view ÂÆû‰æã„ÄÇ ‰∫î„ÄÅÊãìÂ±ïÁî®Ê≥ïÂâçÈù¢ÊèêÂà∞Âú®Â∏ÉÂ±ÄÂàõÂª∫ËøáÁ®ã‰∏≠Ôºå‰ºöË∞ÉÁî® createViewFromTag ÊñπÊ≥ï„ÄÇ createViewFromTag ÊñπÊ≥ï‰∏≠ÔºåÊúâ‰∏ã‰∏ÄÊÆµ‰ª£Á†Å„ÄÇ 123456789View view;//Áî®Êà∑ÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ LayoutInlflater ÁöÑ factory Êù•Ëá™Ë°åËß£Êûê ViewÔºåÈªòËÆ§Ëøô‰∫õ Factory ÈÉΩ‰∏∫Á©∫ÔºåÂèØÂøΩÁï•ËøôÊÆµif (mFactory2 != null) &#123; view = mFactory2.onCreateView(parent, name, context, attrs);//Â¶ÇÊûúFactory2‰∏ç‰∏∫Á©∫ÔºåË∞ÉÁî® mFactory2 ÂàõÂª∫ view&#125; else if (mFactory != null) &#123; view = mFactory.onCreateView(name, context, attrs);&#125; else &#123; view = null;&#125; 1234567891011121314151617public interface Factory2 extends Factory &#123; /** * Version of &#123;@link #onCreateView(String, Context, AttributeSet)&#125; * that also supplies the parent that the view created view will be * placed in. * * @param parent The parent that the created view will be placed * in; &lt;em&gt;note that this may be null&lt;/em&gt;. * @param name Tag name to be inflated. * @param context The context the view is being created in. * @param attrs Inflation attributes as specified in XML file. * * @return View Newly created view. Return null for the default * behavior. */ public View onCreateView(View parent, String name, Context context, AttributeSet attrs);&#125; Êàë‰ª¨ÂèØ‰ª•Ëá™Â∑±ÂÆûÁé∞ Factory ‰∏≠ÁöÑ onCreateView ÊñπÊ≥ï„ÄÇÁ≥ªÁªüÂú®Â°´ÂÖÖ view Ââç‰ºöÂõûË∞ÉËØ•ÊñπÊ≥ïÔºåÂèØ‰ª•ËøîÂõû‰ªÄ‰πàÊ†∑ÁöÑ view Â∑≤ÁªèÂÖ∂‰∏≠ÁöÑÂ±ûÊÄß„ÄÇ 1.ÂÖ®Â±ÄÊõøÊç¢Â≠ó‰ΩìÂ±ûÊÄßÂõ†‰∏∫Â≠ó‰ΩìÊòØ TextView ÁöÑ‰∏Ä‰∏™Â±ûÊÄßÔºå‰∏∫‰∫ÜÂä†‰∏Ä‰∏™Â±ûÊÄßÔºåÊàë‰ª¨Â∞±Ê≤°ÂøÖË¶ÅÂéªÂÖ®ÈÉ®ÁöÑÂ∏ÉÂ±Ä‰∏≠ËøõË°åÊõ¥ÊîπÔºåÂè™ÈúÄË¶Å‰∏äÊàë‰ª¨ÁöÑ onCreateView ‰∏≠ÔºåÂèëÁé∞ÊòØ TextViewÔºåÂ∞±ÂéªËÆæÁΩÆÊàë‰ª¨ÂØπÂ∫îÁöÑÂ≠ó‰Ωì„ÄÇ 1234567891011121314151617181920212223242526272829public static Typeface typeface;@Overrideprotected void onCreate(Bundle savedInstanceState)&#123; if (typeface == null)&#123; typeface = Typeface.createFromAsset(getAssets(), "xxxx.ttf"); &#125; LayoutInflaterCompat.setFactory2(LayoutInflater.from(this), new LayoutInflater.Factory2() &#123; @Override public View onCreateView(String name, Context context, AttributeSet attrs) &#123; return null; &#125; @Override public View onCreateView(View parent, String name, Context context, AttributeSet attrs) &#123; AppCompatDelegate delegate = getDelegate(); View view = delegate.createView(parent, name, context, attrs); if ( view!= null &amp;&amp; (view instanceof TextView))&#123; ((TextView) view).setTypeface(typeface); &#125; return view; &#125; &#125;); super.onCreate(savedInstanceState); setContentView(R.layout.activity_main);&#125; 2.Âä®ÊÄÅÊç¢ËÇ§ÂäüËÉΩÂü∫Êú¨ÂéüÁêÜÂíå‰∏äÈù¢ÁöÑÊõ¥Êç¢Â≠ó‰ΩìÁ±ª‰ººÔºåÊàë‰ª¨ÂèØ‰ª•ÂØπÂÅö‰∫ÜÊ†áËÆ∞ÁöÑ View ËøõË°åËØÜÂà´ÔºåÁÑ∂ÂêéÂú® onCreateView ÈÅçÂéÜÂà∞ÂÆÉÁöÑÊó∂ÂÄôÔºåÊõ¥ÊîπÂÆÉÁöÑ‰∏Ä‰∫õÂ±ûÊÄßÔºåÊØîÂ¶ÇËÉåÊôØËâ≤Á≠âÔºåÁÑ∂ÂêéÂÜç‰∫§ÁªôÁ≥ªÁªüÂéªÁîüÊàê View„ÄÇ 3.Êó†ÈúÄÁºñÂÜô shape„ÄÅselectorÔºåÁõ¥Êé•Âú® xml ËÆæÁΩÆÂÄºÊó†ÈúÄËá™ÂÆö‰πâ ViewÔºåÂΩªÂ∫ïËß£Êîæ shapeÔºåselector Âêß ÊñáÁ´†‰∏≠ËÆ≤Âà∞Êàë‰ª¨Â¶ÇÊûúË¶ÅËÆæÁΩÆÊéß‰ª∂ÁöÑËßíÂ∫¶Á≠âÂ±ûÊÄßÂÄºÔºå‰∏çÈúÄË¶ÅÂÜçÂéªÂÜôÁâπÂÆöÁöÑ shape ÊàñËÄÖ selector Êñá‰ª∂ÔºåÁõ¥Êé•Âú® xml ‰∏≠ÂÜôÂÖ•Ôºö 123456789101112131415&lt;Button android:id=&quot;@+id/btn&quot; android:layout_width=&quot;130dp&quot; android:layout_height=&quot;36dp&quot; android:layout_marginTop=&quot;5dp&quot; android:gravity=&quot;center&quot; android:padding=&quot;0dp&quot; android:text=&quot;Ë∑≥ËΩ¨Âà∞ÂàóË°®&quot; android:textColor=&quot;#4F94CD&quot; android:textSize=&quot;20sp&quot; app:bl_corners_radius=&quot;20dp app:bl_gradient_angle=&quot;0&quot; app:bl_gradient_endColor=&quot;#4F94CD&quot; app:bl_gradient_startColor=&quot;#63B8FF&quot; app:bl_shape=&quot;rectangle&quot; /&gt; ÂÖ∂ÂéüÁêÜ‰πüÊòØÈÄöËøáËá™ÂÆö‰πâ FactoryÔºåÂú®Factory2#onCreateViewÊñπÊ≥ïÈáåÈù¢ÔºåÂà§Êñ≠ attrs ÁöÑÂèÇÊï∞ÂêçÂ≠óÔºåÊØîÂ¶ÇÂèëÁé∞ÂêçÂ≠óÊòØÊàë‰ª¨Âà∂ÂÆöÁöÑ stroke_color Â±ûÊÄßÔºåÂ∞±ÂéªÈÄöËøá‰ª£Á†ÅÊâãÂä®Â∏Æ‰ªñÂéªËÆæÁΩÆËøô‰∏™ÂÄº,Êàë‰ª¨Êù•Êü•Áúã‰∏ãÂÆÉÁöÑ onCreateView ÊñπÊ≥ïÔºö 1234567891011121314151617181920212223@Overridepublic View onCreateView(String name, Context context, AttributeSet attrs) &#123; //ÁúÅÁï•‰∏Ä‰∫õ‰ª£Á†Å if (typedArray.getBoolean(R.styleable.background_ripple_enable, false) &amp;&amp; typedArray.hasValue(R.styleable.background_ripple_color)) &#123; int color = typedArray.getColor(R.styleable.background_ripple_color, 0); if (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123; Drawable contentDrawable = (stateListDrawable == null ? drawable : stateListDrawable); RippleDrawable rippleDrawable = new RippleDrawable(ColorStateList.valueOf(color), contentDrawable, contentDrawable); view.setClickable(true); view.setBackground(rippleDrawable); &#125; else &#123; StateListDrawable tmpDrawable = new StateListDrawable(); GradientDrawable unPressDrawable = DrawableFactory.getDrawable(typedArray); unPressDrawable.setColor(color); tmpDrawable.addState(new int[]&#123;-android.R.attr.state_pressed&#125;, drawable); tmpDrawable.addState(new int[]&#123;android.R.attr.state_pressed&#125;, unPressDrawable); view.setClickable(true); view.setBackground(tmpDrawable); &#125; &#125; return view;&#125; ÂÖ≠„ÄÅÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Android ÊäÄËÉΩÊ†ë ‚Äî LayoutInflater Factory Â∞èÁªì Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidÊ∫êÁ†Å‰∏≠ÁöÑËßÇÂØüËÄÖÊ®°Âºè]]></title>
    <url>%2Fblog%2F2017%2F08%2F09%2FAndroid%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Ëß£ÂÜ≥„ÄÅËß£ËÄ¶ÁöÑÈí•Âåô‚Äî‚ÄîËßÇÂØüËÄÖÊ®°ÂºèÂÆö‰πâËßÇÂØüËÄÖÊ®°ÂºèÂÆö‰πâ‰∫ÜÂØπË±°Èó¥‰∏ÄÁßç‰∏ÄÂØπÂ§öÁöÑ‰æùËµñÂÖ≥Á≥ªÔºå‰ΩøÂæóÊØèÂΩì‰∏Ä‰∏™ÂØπË±°ÊîπÂèòÁä∂ÊÄÅÔºåÂàôÊâÄÊúâ‰æùËµñ‰∫éÂÆÉÁöÑÂØπË±°ÈÉΩ‰ºöÂæóÂà∞ÈÄöÁü•Âπ∂Ë¢´Ëá™Âä®Êõ¥Êñ∞„ÄÇ ‰ΩøÁî®Âú∫ÊôØ ÂÖ≥ËÅîË°å‰∏∫Âú∫ÊôØ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂÖ≥ËÅîË°å‰∏∫ÊòØÂèØÊãÜÂàÜÁöÑÔºåËÄå‰∏çÊòØ‚ÄúÁªÑÂêà‚ÄùÂÖ≥Á≥ª ‰∫ã‰ª∂Â§öÁ∫ßËß¶ÂèëÂú∫ÊôØ Ë∑®Á≥ªÁªüÁöÑÊ∂àÊÅØ‰∫§Êç¢Âú∫ÊôØÔºåÂ¶ÇÊ∂àÊÅØÈòüÂàó„ÄÅ‰∫ã‰ª∂ÊÄªÁ∫øÁöÑÂ§ÑÁêÜÊú∫Âà∂„ÄÇ UML Á±ªÂõæUML Á±ªÂõæÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö Âõõ‰∏™ËßíËâ≤Ôºö Subject ÊäΩË±°‰∏ªÈ¢òÔºàÊäΩË±°ÁöÑË¢´ËßÇÂØüËÄÖÔºâ„ÄÇÊääÊâÄÊúâËßÇÂØüËÄÖÂØπË±°ÁöÑÂºïÁî®‰øùÂ≠òÂú®‰∏Ä‰∏™ÈõÜÂêàÈáåÔºåÊØè‰∏™‰∏ªÈ¢òÂèØ‰ª•Êúâ‰ªªÊÑèÊï∞ÈáèÁöÑËßÇÂØüËÄÖÔºåÊèê‰æõÊé•Âè£‰æõÊ∑ªÂä†ÂíåÂà†Èô§ËßÇÂØüËÄÖÂØπË±°„ÄÇ ConcreteSubject ÂÖ∑‰Ωì‰∏ªÈ¢òÔºàÂÖ∑‰ΩìÁöÑË¢´ËßÇÂØüËÄÖÔºâ„ÄÇÂ∞ÜÊúâÂÖ≥Áä∂ÊÄÅÂ≠òÂÖ•ÂÖ∑‰ΩìËßÇÂØüËÄÖÂØπË±°ÔºåÂú®ÂÖ∑‰Ωì‰∏ªÈ¢òÁöÑÂÜÖÈÉ®ÂÆûÁé∞ÂèëÁîüÊîπÂèòÊó∂ÔºåÁªôÊâÄÊúâÊ≥®ÂÜåËøáÁöÑËßÇÂØüËÄÖÂèëÂá∫ÈÄöÁü• Observer ÊäΩË±°ËßÇÂØüËÄÖ„ÄÇÂÆö‰πâ‰∏Ä‰∏™Êõ¥Êñ∞Êé•Âè£ÔºåÁî®Êù•Êé•Êî∂‰∏ªÈ¢òÊõ¥ÊîπÊó∂ÂÅöÂá∫Áõ∏Â∫îÁöÑÊìç‰ΩúÔºàÊØîÂ¶ÇÊõ¥Êñ∞Ëá™Ë∫´ÁöÑÁä∂ÊÄÅÔºâ ConcreteObserver ÂÖ∑‰ΩìËßÇÂØüËÄÖÔºàÂÆûÁé∞ÊäΩË±°ËßÇÂØüËÄÖÊâÄÂÆö‰πâÁöÑÊõ¥Êñ∞Êé•Âè£Ôºå‰ª•‰æøÂú®‰∏ªÈ¢òÁä∂ÊÄÅÊõ¥ÊîπÊó∂Êõ¥Êñ∞Ëá™Ë∫´ÁöÑÁä∂ÊÄÅÔºâ Android ListView ÁöÑËßÇÂØüËÄÖÊ®°ÂºèListView Âíå RecyclerView Âú® Android ‰∏≠ÈÉΩÂç†ÊçÆÁùÄÂæàÈáçË¶ÅÁöÑÂú∞‰Ωç„ÄÇ ‰ΩøÁî®Ëøô‰∏§‰∏™ÁªÑ‰ª∂Êó∂ÔºåÊÄªÂÖç‰∏ç‰∫ÜÊï∞ÊçÆÊõ¥Êñ∞ÁöÑÊÉÖÂÜµÔºöÂΩìË¶ÅÊõ¥Êñ∞Êï∞ÊçÆÊó∂Êàë‰ª¨ÈÄöÂ∏∏ÈÉΩ‰ºöË∞ÉÁî® Adapter.notifyDataSetChanged()ÔºåËøôÂÖ∂‰∏≠ÁöÑÂéüÁêÜÂèàÊòØÊÄé‰πàÊ†∑ÁöÑÂë¢Ôºü ‰∏ãÈù¢‰ª• ListView ‰Ωú‰∏∫‰∏Ä‰∏™Ê†óÂ≠êÔºåÁúãÁúãÂÖ∂‰∏≠ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊòØÊÄé‰πàÊ†∑ÁöÑ„ÄÇ 123public void notifyDataSetChanged() &#123; mDataSetObservable.notifyChanged();&#125; 1234567891011public void notifyChanged() &#123; synchronized(mObservers) &#123; // since onChanged() is implemented by the app, it could do anything, including // removing itself from &#123;@link mObservers&#125; - and that could cause problems if // an iterator is used on the ArrayList &#123;@link mObservers&#125;. // to avoid such problems, just march thru the list in the reverse order. for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123; mObservers.get(i).onChanged(); &#125; &#125;&#125; notifyDataSetChanged ÊñπÊ≥ï‰ºöË∞ÉÁî® DataSetObservable.notifyChanged() ÊñπÊ≥ï,notifyChanged() ÂÜÖÈÉ®‰ºöÈÅçÂéÜË∞ÉÁî®ËßÇÂØüËÄÖÁöÑ onChanged() ÊñπÊ≥ï„ÄÇÈÄöÁü•Êï∞ÊçÆÊõ¥Êñ∞„ÄÇ ‰ΩÜÊòØËßÇÂØüËÄÖÂèàÊòØ‰ªÄ‰πàÊó∂ÂÄôÊ≥®ÂÜåÁöÑÂë¢Ôºü ‰ª•‰∏ã‰∏∫ setAdapter ÁöÑÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞Ôºö12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455@Overridepublic void setAdapter(ListAdapter adapter) &#123; //Â¶ÇÊûú Â∑≤ÁªèÊúâ Adapter Â≠òÂú®ÔºåÂÖàËß£Èô§Ê≥®ÂÜå if (mAdapter != null &amp;&amp; mDataSetObserver != null) &#123; mAdapter.unregisterDataSetObserver(mDataSetObserver); &#125; resetList(); mRecycler.clear(); if (mHeaderViewInfos.size() &gt; 0|| mFooterViewInfos.size() &gt; 0) &#123; mAdapter = wrapHeaderListAdapterInternal(mHeaderViewInfos, mFooterViewInfos, adapter); &#125; else &#123; mAdapter = adapter; &#125; mOldSelectedPosition = INVALID_POSITION; mOldSelectedRowId = INVALID_ROW_ID; // AbsListView#setAdapter will update choice mode states. super.setAdapter(adapter); if (mAdapter != null) &#123; mAreAllItemsSelectable = mAdapter.areAllItemsEnabled(); mOldItemCount = mItemCount; mItemCount = mAdapter.getCount(); checkFocus(); // ÊûÑÂª∫‰∏Ä‰∏™ AdapterDataSetObserver mDataSetObserver = new AdapterDataSetObserver(); mAdapter.registerDataSetObserver(mDataSetObserver);//Ê≥®ÂÜåËßÇÂØüËÄÖ mRecycler.setViewTypeCount(mAdapter.getViewTypeCount()); int position; if (mStackFromBottom) &#123; position = lookForSelectablePosition(mItemCount - 1, false); &#125; else &#123; position = lookForSelectablePosition(0, true); &#125; setSelectedPositionInt(position); setNextSelectedPositionInt(position); if (mItemCount == 0) &#123; // Nothing selected checkSelectionChanged(); &#125; &#125; else &#123; mAreAllItemsSelectable = true; checkFocus(); // Nothing selected checkSelectionChanged(); &#125; requestLayout();&#125; ÈÄöËøáÊ∫êÁ†ÅÂèØ‰ª•ÁúãÂà∞ÔºåsetAdapter ÊñπÊ≥ïÂÜÖÈÉ®‰ºöÊûÑÂª∫‰∏Ä‰∏™ AdapterDataSetObserver ÔºåÁÑ∂ÂêéÊ≥®ÂÜå‰∏∫ËßÇÂØüËÄÖ„ÄÇÊàë‰ª¨ËøòÂèØ‰ª•ÁúãÂà∞Ê≥®ÂÜåÁöÑÊó∂ÂÄôÊòØÈÄöËøá Adapter Êù•Ê≥®ÂÜåÁöÑ„ÄÇ Adapter Êé•Âè£‰∏≠Â£∞Êòé‰∫ÜÊ≥®ÂÜåÂíåËß£Ê≥®ÂÜåÁöÑÊñπÊ≥ïÁ≠æÂêç„ÄÇ1234567891011121314151617public interface Adapter &#123; /** * Register an observer that is called when changes happen to the data used by this adapter. * * @param observer the object that gets notified when the data set changes. */ void registerDataSetObserver(DataSetObserver observer); /** * Unregister an observer that has previously been registered with this * adapter via &#123;@link #registerDataSetObserver&#125;. * * @param observer the object to unregister. */ void unregisterDataSetObserver(DataSetObserver observer); //‰ª£Á†ÅÁúÅÁï•&#125; ËÄå BaseAdapter ÂÆûÁé∞‰∫Ü ListAdapter Êé•Âè£ÔºåListAdapter Êé•Âè£ÂèàÁªßÊâøËá™ Adapter Êé•Âè£„ÄÇBaseAdapter ‰∏≠Ê≥®ÂÜåÊñπÊ≥ïÂíåËß£Èô§Ê≥®ÂÜåÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞Ôºö 1234567public void registerDataSetObserver(DataSetObserver observer) &#123; mDataSetObservable.registerObserver(observer);&#125;public void unregisterDataSetObserver(DataSetObserver observer) &#123; mDataSetObservable.unregisterObserver(observer);&#125; BaseAdapter ‰∏≠Ê≥®ÂÜåÊñπÊ≥ïÂíåËß£Èô§Ê≥®ÂÜåÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÈÉΩÊòØÈÄöËøá mDataSetObservable Êù•ÂÆåÊàêÁöÑ„ÄÇÊü•Áúã‰∏Ä‰∏ã DataSetObservable ÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ1234567891011121314151617public class DataSetObservable extends Observable&lt;DataSetObserver&gt; &#123; public void notifyChanged() &#123; synchronized(mObservers) &#123; for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123; mObservers.get(i).onChanged(); &#125; &#125; &#125; public void notifyInvalidated() &#123; synchronized (mObservers) &#123; for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123; mObservers.get(i).onInvalidated(); &#125; &#125; &#125;&#125; ËØ•Á±ªÁªßÊâø‰∫Ü android.database ÂåÖ‰∏ãÁöÑ Observable Á±ªÔºåËÄå Observable Á±ª‰∏≠Â≠òÊúâÊâÄÊúâËßÇÂØüËÄÖÁöÑÂºïÁî®Ôºå‰ª•ÂèäÊ≥®ÂÜåÂíåËß£Ê≥®ÂÜåÊñπÊ≥ï„ÄÇ ListView ‰∏≠ÁöÑ onChange ÊñπÊ≥ïÂÖ∑‰ΩìÂÆûÁé∞ÂèàÊòØ‰ªÄ‰πàÊ†∑ÁöÑ? ËøòËÆ∞ÂæóÂâçÈù¢Êàë‰ª¨ËØ¥ Observer ÊòØÂ¶Ç‰ΩïÊ≥®ÂÜåÁöÑÂêóÔºüÊ≥®ÂÜåÊó∂ÔºåÊàë‰ª¨ÊûÑÂª∫ÁöÑÊòØ AdapterDataSetObserver„ÄÇ ËØ•Á±ªÊòØ AbsListView ÁöÑÂÜÖÈÉ®Á±ª„ÄÇ AbsListView.AdapterDataSetObserver ÁªßÊâøËá™ AdapterView.AdapterDataSetObserver onChange ÊñπÊ≥ïÁöÑ‰∏ªË¶ÅÈÄªËæëÈÉΩÂú® AdapterDataSetObserver ‰∏≠ 12345678910111213141516171819202122class AdapterDataSetObserver extends DataSetObserver &#123; //‰ª£Á†ÅÁúÅÁï• ... @Override public void onChanged() &#123; mDataChanged = true; mOldItemCount = mItemCount; mItemCount = getAdapter().getCount(); // Detect the case where a cursor that was previously invalidated has // been repopulated with new data. if (AdapterView.this.getAdapter().hasStableIds() &amp;&amp; mInstanceState != null &amp;&amp; mOldItemCount == 0 &amp;&amp; mItemCount &gt; 0) &#123; AdapterView.this.onRestoreInstanceState(mInstanceState); mInstanceState = null; &#125; else &#123; rememberSyncState(); &#125; checkFocus(); requestLayout(); &#125; //‰ª£Á†ÅÁúÅÁï• ...&#125; onChange ÊñπÊ≥ï‰∏≠Ôºå‰ºöËé∑ÂèñÂΩìÂâç Adapter ‰∏≠ÁöÑÊï∞ÊçÆÈõÜÁöÑÊñ∞Êï∞ÈáèÔºåÊñπÊ≥ïÁöÑÊúÄÂêéË∞ÉÁî® ListView ÁöÑ requestLayout() ÊñπÊ≥ïÈáçÊñ∞ËøõË°åÂ∏ÉÂ±Ä„ÄÇ ‰ªé‰∏äÈù¢ÁöÑÂàÜÊûê‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ AbsListView ÊòØÊäΩË±°ÁöÑËßÇÂØüËÄÖ ListView ÊòØÂÖ∑‰ΩìÁöÑËßÇÂØüËÄÖ Adapter Êé•Âè£ÊòØÊäΩË±°ÁöÑË¢´ËßÇÂØüËÄÖ BaseAdapter ÊòØÂÖ∑‰ΩìÁöÑË¢´ËßÇÂØüËÄÖÔºåÂÖ∂ÂÜÖÈÉ®ÂÆûÈôÖ‰∏äÊòØÈÄöËøá android.database ÂåÖ‰∏ãÁöÑ Observerable Êù•ÂÆûÁé∞Ê≥®ÂÜåÂíåÁõëÂê¨ÁöÑ„ÄÇ Â∞èÁªì AdapterView ‰∏≠Êúâ‰∏Ä‰∏™ AdapterDataSetObserver ÂÜÖÈÉ®Á±ªÔºå Âú® ListView ‰∏≠ËÆæÁΩÆ AdapterÔºàÂç≥Ë∞ÉÁî® ListView ÁöÑ setAdapter ÊñπÊ≥ïÔºâÊó∂ÔºåÂÖ∂ÂÜÖÈÉ®‰ºöÊûÑÂª∫‰∏Ä‰∏™ AdapterDataSetObserverÔºåÂπ∂Ê≥®ÂÜåÂà∞ Adapter ‰∏≠„ÄÇÂèØËßÅËØ•Âú∫ÊôØ‰∏≠ ListView ÊâÆÊºî‰∏Ä‰∏™ËßÇÂØüËÄÖËßíËâ≤„ÄÇ ËÄå Adapter ‰∏≠Êúâ‰∏Ä‰∏™Êï∞ÊçÆÈõÜÂèØËßÇÂØüËÄÖ DataSetObserable„ÄÇÂç≥‰∏Ä‰∏™Ë¢´ËßÇÂØüËÄÖ„ÄÇ Êï∞ÊçÆÈõÜÂèëÁîüÂèòÂåñÊó∂ÔºåÂºÄÂèëËÄÖÊâãÂä®Ë∞ÉÁî® Adapter.notifyDataSetChanged ÊñπÊ≥ïÔºånotifyDataSetChanged ‰ºöË∞ÉÁî® DataSetObserverable.notifyChanged() notifyChanged() ÊñπÊ≥ï‰ºöÈÅçÂéÜÊâÄÊúâËßÇÂØüËÄÖÔºåÂπ∂Ë∞ÉÁî®ËßÇÂØüËÄÖÁöÑ onChanged ÊñπÊ≥ïÔºå onChanged ‰ºöËé∑Âèñ Adapter ‰∏≠Êï∞ÊçÆÈõÜÁöÑÊñ∞Êï∞ÈáèÔºåÂêåÊó∂‰ºöË∞ÉÁî® View.requestLayout ÊñπÊ≥ïÈÄöÁü• ListView Êõ¥Êñ∞Â∏ÉÂ±ÄÔºåÂà∑Êñ∞Áî®Êà∑ÁïåÈù¢„ÄÇ ËôΩÁÑ∂ RecyclerView Áõ¥Êé•ÁªßÊâøËá™ ViewGroupÔºåËÄå‰∏çÊòØ AdapterView Ôºå‰ΩÜÊòØÊõ¥Êñ∞ÂàóË°®Êï∞ÊçÆÈõÜÊñπÊ≥ïÁöÑÂÜÖÈÉ®‰πüÊòØÈÄöËøáËßÇÂØüËÄÖÊ®°ÂºèÊù•ÂÆûÁé∞ÁöÑ„ÄÇÂè™ÊòØÂú®ÂÖ∂‰∏≠Â§öÊèê‰æõ‰∫ÜÂçï‰∏™Êï∞ÊçÆÊàñËÄÖÊåáÂÆöËåÉÂõ¥Êï∞ÊçÆÊõ¥Êñ∞Á≠âÂõûË∞ÉÊé•Âè£Ôºå‰æõÂºÄÂèëËÄÖ‰ΩøÁî®„ÄÇÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•ÂéªÁúãÁúã RecyclerView ‰∏≠ËßÇÂØüËÄÖÊ®°ÂºèÁöÑÂÆûÁé∞„ÄÇ ‰ΩúËÄÖÊ∞¥Âπ≥ÊúâÈôêÔºåÁñèÊºè‰πãÂ§ÑÔºåÊÅ≥ËØ∑ÊåáÂá∫„ÄÇ ÂèÇËÄÉ „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Á¨¨ÂçÅ‰∫åÁ´†]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Toast ÂéüÁêÜ]]></title>
    <url>%2Fblog%2F2017%2F07%2F28%2FToast%20%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%2F</url>
    <content type="text"><![CDATA[Â∫èË®ÄToast.makeText(context,&quot;msg&quot;,Toast.Length_SHORT).show(); Êàë‰ª¨ÈÉΩÁü•ÈÅìË∞ÉÁî®‰∫ÜËøôË°å‰ª£Á†ÅÔºå‰æø‰ºöËß¶ÂèëÊòæÁ§∫ Toast ‰ø°ÊÅØÔºå‰ΩÜÊòØ‰ªéË∞ÉÁî®ÂºÄÂßãÂà∞ÊòæÁ§∫Âá∫Êù•ÁöÑÂÖ∑‰ΩìËøáÁ®ãÊòØÊÄé‰πàÊ†∑ÁöÑÔºåÈáåÈù¢ÂÖ∑‰ΩìÂÆûÁé∞ÂèàÊòØÊÄé‰πàÊ†∑ÁöÑÂë¢Ôºü ÂéüÁêÜÂú® Toast ÂÜÖÈÉ®Êúâ‰∏§Á±ª IPC ËøáÁ®ã„ÄÇ Á¨¨‰∏ÄÁ±ªÔºö Toast ËÆøÈóÆ NotificationManagerService Á¨¨‰∫åÁ±ªÔºöNotificationManagerService ÂõûË∞É Toast ÈáåÁöÑ TN Êé•Âè£„ÄÇ Toast Â±û‰∫éÁ≥ªÁªü WindowÔºåÂÆÉÂÜÖÈÉ®ÁöÑËßÜÂõæÁî±‰∏§ÁßçÊñπÂºèÊåáÂÆöÔºå‰∏ÄÁßçÊòØÁ≥ªÁªüÈªòËÆ§ÁöÑÊ†∑ÂºèÔºåÂè¶‰∏ÄÁßçÊòØËá™ÂÆö‰πâ‰∏Ä‰∏™ view ÁÑ∂ÂêéÈÄöËøá setView ÊñπÊ≥ïÂ∞Ü view ËÆæÁΩÆËøõÂéª„ÄÇ‰∏çÁÆ°Âì™‰∏ÄÁßçÊñπÂºèÔºåÂÆÉ‰ª¨ÈÉΩÂØπÂ∫î Toast ÁöÑ‰∏Ä‰∏™ View Á±ªÂûãÁöÑÂÜÖÈÉ®ÊàêÂëò mNextView„ÄÇ Toast Êèê‰æõ show Âíå cancel ÊñπÊ≥ïÂàÜÂà´Áî®‰∫éÊòæÁ§∫ÂíåÈöêËóè viewÔºåÂÆÉ‰ª¨ÁöÑÂÜÖÈÉ®ÈÉΩÊòØ‰∏Ä‰∏™ IPC ËøáÁ®ã„ÄÇ Toast ÊúâÂÆöÊó∂ÂèñÊ∂àÂäüËÉΩÔºåÊâÄ‰ª•Á≥ªÁªüÈááÁî®‰∫Ü HandlerÔºàÂà©Áî®ÂÖ∂‰∏≠ÁöÑ sendMessageDelayed() ÊñπÊ≥ïÔºâ Toast.show() Ë∞ÉÁî®ÊµÅÁ®ãÂ§ßËá¥Â¶Ç‰∏ãÔºö ÂÖàÊù•ÁúãÁúã Toast.makeText ÊñπÊ≥ï1234567891011121314public static Toast makeText(Context context, CharSequence text, @Duration int duration) &#123; Toast result = new Toast(context);//ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ Toast ÂØπË±° LayoutInflater inflate = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);//Ëé∑Âèñ LayoutInflater View v = inflate.inflate(com.android.internal.R.layout.transient_notification, null); //Ê∏≤ÊüìÂá∫Á≥ªÁªüÈªòËÆ§ÁöÑÂ∏ÉÂ±Ä TextView tv = (TextView)v.findViewById(com.android.internal.R.id.message); tv.setText(text);//Â∞ÜÊàë‰ª¨ÁöÑ‰ø°ÊÅØËÆæÁΩÆÂà∞ TextView ‰∏≠Âéª result.mNextView = v;//Êää view ËµãÁªô Toast ÂÜÖÈÉ®ÁöÑView result.mDuration = duration;//ËÆæÁΩÆ toast Êó∂Èïø return result;&#125; ÂÜçÁûß‰∏ÄÁûß Toast.show(); ÊñπÊ≥ï12345678910111213141516public void show() &#123; if (mNextView == null) &#123;//Âà§Êñ≠ÔºåÂ¶ÇÊûúÊ≤°ÊúâËÆæÁΩÆ Toast ÁöÑ viewÔºåÂ∞±ÊäõÂá∫ÂºÇÂ∏∏ throw new RuntimeException(&quot;setView must have been called&quot;); &#125; INotificationManager service = getService();//Ëé∑Âèñ INotificationManager String pkg = mContext.getOpPackageName();// Ëé∑ÂèñË∞ÉÁî®ËÄÖÁöÑÂåÖÂêç TN tn = mTN;//Áªô TN ËµãÂÄº tn.mNextView = mNextView; try &#123; service.enqueueToast(pkg, tn, mDuration); &#125; catch (RemoteException e) &#123; // Empty &#125;&#125; ËøôÈáåÈù¢ÊúâÂá†‰∏™Âú∞ÊñπÁúãËµ∑Êù•ÊØîËæÉÈôåÁîü INotificationManager ÊòØ‰ªÄ‰πàÔºåTN ÂèàÊòØ‰ªÄ‰πàÔºü INotificationManager ÁöÑÂÄºÊòØ‰ªé getService() ÊñπÊ≥ï‰∏≠ÂæóÊù•ÁöÑ„ÄÇÊàë‰ª¨ÂÖàÊü•Áúã‰∏ã getService() ÁöÑÂÜÖÈÉ®ÂÆûÁé∞Ôºö1234567static private INotificationManager getService() &#123; if (sService != null) &#123; return sService; &#125; sService = INotificationManager.Stub.asInterface(ServiceManager.getService(&quot;notification&quot;)); return sService;&#125; ‰∫ÜËß£ Binder ÁöÑÂêåÂ≠¶Â∫îËØ•‰∏ÄÁúã‰æøÁü•ÈÅìÔºåËøôÈáåÁî®Âà∞‰∫Ü Binder„ÄÇ INotificationManager ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Âú® NotificationManagerService ‰∏≠ÔºåÁÆÄ‰æøËµ∑ËßÅÔºåÂêéÁª≠ÂÜÖÂÆπÂ∞Ü NotificationManagerService Áß∞‰∏∫ NMS„ÄÇ TN ÂèàÊòØ‰ªÄ‰πàÔºü123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140private static class TN extends ITransientNotification.Stub &#123; final Runnable mHide = new Runnable() &#123; @Override public void run() &#123; handleHide(); // Don't do this in handleHide() because it is also invoked by handleShow() mNextView = null; &#125; &#125;; private final WindowManager.LayoutParams mParams = new WindowManager.LayoutParams(); final Handler mHandler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; IBinder token = (IBinder) msg.obj; handleShow(token); &#125; &#125;; int mGravity; int mX, mY; float mHorizontalMargin; float mVerticalMargin; View mView; View mNextView; int mDuration; WindowManager mWM; static final long SHORT_DURATION_TIMEOUT = 5000; static final long LONG_DURATION_TIMEOUT = 1000; TN() &#123; // XXX This should be changed to use a Dialog, with a Theme.Toast // defined that sets up the layout params appropriately. final WindowManager.LayoutParams params = mParams; params.height = WindowManager.LayoutParams.WRAP_CONTENT; params.width = WindowManager.LayoutParams.WRAP_CONTENT; params.format = PixelFormat.TRANSLUCENT; params.windowAnimations = com.android.internal.R.style.Animation_Toast; params.type = WindowManager.LayoutParams.TYPE_TOAST; params.setTitle("Toast"); params.flags = WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE; &#125; /** * schedule handleShow into the right thread */ @Override public void show(IBinder windowToken) &#123; if (localLOGV) Log.v(TAG, "SHOW: " + this); mHandler.obtainMessage(0, windowToken).sendToTarget(); &#125; /** * schedule handleHide into the right thread */ @Override public void hide() &#123; if (localLOGV) Log.v(TAG, "HIDE: " + this); mHandler.post(mHide); &#125; public void handleShow(IBinder windowToken) &#123; if (localLOGV) Log.v(TAG, "HANDLE SHOW: " + this + " mView=" + mView + " mNextView=" + mNextView); if (mView != mNextView) &#123; // remove the old view if necessary handleHide(); mView = mNextView; Context context = mView.getContext().getApplicationContext(); String packageName = mView.getContext().getOpPackageName(); if (context == null) &#123; context = mView.getContext(); &#125; mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE); // We can resolve the Gravity here by using the Locale for getting // the layout direction final Configuration config = mView.getContext().getResources().getConfiguration(); final int gravity = Gravity.getAbsoluteGravity(mGravity, config.getLayoutDirection()); mParams.gravity = gravity; if ((gravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) == Gravity.FILL_HORIZONTAL) &#123; mParams.horizontalWeight = 1.0f; &#125; if ((gravity &amp; Gravity.VERTICAL_GRAVITY_MASK) == Gravity.FILL_VERTICAL) &#123; mParams.verticalWeight = 1.0f; &#125; mParams.x = mX; mParams.y = mY; mParams.verticalMargin = mVerticalMargin; mParams.horizontalMargin = mHorizontalMargin; mParams.packageName = packageName; mParams.hideTimeoutMilliseconds = mDuration == Toast.LENGTH_LONG ? LONG_DURATION_TIMEOUT : SHORT_DURATION_TIMEOUT; mParams.token = windowToken; if (mView.getParent() != null) &#123; if (localLOGV) Log.v(TAG, "REMOVE! " + mView + " in " + this); mWM.removeView(mView); &#125; if (localLOGV) Log.v(TAG, "ADD! " + mView + " in " + this); mWM.addView(mView, mParams); trySendAccessibilityEvent(); &#125; &#125; private void trySendAccessibilityEvent() &#123; AccessibilityManager accessibilityManager = AccessibilityManager.getInstance(mView.getContext()); if (!accessibilityManager.isEnabled()) &#123; return; &#125; // treat toasts as notifications since they are used to // announce a transient piece of information to the user AccessibilityEvent event = AccessibilityEvent.obtain( AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED); event.setClassName(getClass().getName()); event.setPackageName(mView.getContext().getPackageName()); mView.dispatchPopulateAccessibilityEvent(event); accessibilityManager.sendAccessibilityEvent(event); &#125; public void handleHide() &#123; if (localLOGV) Log.v(TAG, "HANDLE HIDE: " + this + " mView=" + mView); if (mView != null) &#123; // note: checking parent() just to make sure the view has // been added... i have seen cases where we get here when // the view isn't yet added, so let's try not to crash. if (mView.getParent() != null) &#123; if (localLOGV) Log.v(TAG, "REMOVE! " + mView + " in " + this); mWM.removeViewImmediate(mView); &#125; mView = null; &#125; &#125;&#125; TN ÊòØ Toast ÁöÑ‰∏Ä‰∏™ÁßÅÊúâÁöÑÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºåÁªßÊâøËá™ ITransientNotification.Stub ‰πüÊòØÁî®Âà∞‰∫Ü Binder Êú∫Âà∂„ÄÇ Âú®ÂõûÂà∞ show ÊñπÊ≥ï„ÄÇËØ•ÊñπÊ≥ïÊúÄÂêéË∞ÉÁî®‰∫Ü service.enqueueToast(pkg, tn, mDuration); ÊñπÊ≥ï„ÄÇÊàë‰ª¨Âà∞ NMS ÁúãÁúãËØ•ÊñπÊ≥ïÁöÑ‰∏ªË¶ÅÂÆûÁé∞„ÄÇ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253 @Overridepublic void enqueueToast(String pkg, ITransientNotification callback, int duration)&#123; //.... final boolean isSystemToast = isCallerSystem() || ("android".equals(pkg));//ÊòØÂê¶ÊòØ android Á≥ªÁªüÁöÑ toast final boolean isPackageSuspended = isPackageSuspendedForUser(pkg, Binder.getCallingUid()); //... synchronized (mToastQueue) &#123; int callingPid = Binder.getCallingPid(); long callingId = Binder.clearCallingIdentity(); try &#123; ToastRecord record; int index = indexOfToastLocked(pkg, callback);//Ê†πÊçÆÂåÖÂêçÂíåÂõûË∞ÉÊù•Ëé∑ÂèñÁöÑÂØπÂ∫îÂåÖÂêçÁöÑ Toast ÁöÑÂú® mToastQueue ‰∏≠ÁöÑ‰ΩçÁΩÆÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâ //Â¶ÇÊûúÂØπÂ∫îÂåÖÂêçÁöÑ Toast Â∑≤ÁªèÂ≠òÂú®‰∫ÜÔºåÂàôÁõ¥Êé•Âú®Âéü‰ΩçÊõ¥Êñ∞Ôºå‰∏ç‰ºöÊääÂÆÉÊéíÂà∞ÈòüÂ∞æ if (index &gt;= 0) &#123; record = mToastQueue.get(index); record.update(duration); &#125; else &#123; //ÈôêÂà∂ÈùûÁ≥ªÁªüÂ∫îÁî®ÁöÑÊï∞ÈáèÔºà‰∏çËÉΩË∂ÖËøá 50ÔºâÔºåÈò≤Ê≠¢ DOS ÊîªÂáªÂêåÊó∂‰πüÊòØ‰∏∫‰∫ÜËß£ÂÜ≥ÂÜÖÂ≠òÊ≥ÑÊºèÈóÆÈ¢ò if (!isSystemToast) &#123; int count = 0; final int N = mToastQueue.size(); for (int i=0; i&lt;N; i++) &#123; final ToastRecord r = mToastQueue.get(i); if (r.pkg.equals(pkg)) &#123; count++; if (count &gt;= MAX_PACKAGE_NOTIFICATIONS) &#123; Slog.e(TAG, "Package has already posted " + count + " toasts. Not showing more. Package=" + pkg); return; &#125; &#125; &#125; &#125; Binder token = new Binder(); mWindowManagerInternal.addWindowToken(token, WindowManager.LayoutParams.TYPE_TOAST); record = new ToastRecord(callingPid, pkg, callback, duration, token);//Â∞Ü Toast ÂåÖË£Ö‰∏∫ ToastRecord mToastQueue.add(record);//Âä†ÂÖ• mToastQueue index = mToastQueue.size() - 1; keepProcessAliveIfNeededLocked(callingPid); &#125; if (index == 0) &#123; showNextToastLocked();//ÊòæÁ§∫‰∏ã‰∏ÄÊù° Toast &#125; &#125; finally &#123; Binder.restoreCallingIdentity(callingId); &#125; &#125;&#125; ËØ•ÊñπÊ≥ï‰ºöÂ∞Ü Toast ËØ∑Ê±ÇÂ∞ÅË£Ö‰∏∫ ToastRecord Âπ∂Â∞ÜÂÖ∂Ê∑ªÂä†Ëøõ mToastQueue ÈòüÂàó‰∏≠„ÄÇ mToastQueue ÊòØ‰∏Ä‰∏™ ArrayList Ê≥®ÊÑèÔºöÊØè‰∏™ÈùûÁ≥ªÁªüÂ∫îÁî®ÊúÄÂ§öÂè™ËÉΩÊúâ 50 ‰∏™ToastRecord„ÄÇÂ¶ÇÊûúË∂ÖÂá∫‰∫ÜÊúÄÂ§ßÂÄºÔºåÂ∞±‰ºöÂá∫Èîô„ÄÇ ËøôÊ†∑ÂÅö‰∏ªË¶ÅÊòØ‰∏∫‰∫Ü Èò≤Ê≠¢ DOSÔºàDenial Of ServiceÔºâ ÊãíÁªùÊúçÂä°ÊîªÂáªÔºàËã±ËØ≠Ôºödenial-of-service attackÔºåÁº©ÂÜôÔºöDoS attack„ÄÅDoSÔºâ‰∫¶Áß∞Ê¥™Ê∞¥ÊîªÂáªÔºåÊòØ‰∏ÄÁßçÁΩëÁªúÊîªÂáªÊâãÊ≥ïÔºåÂÖ∂ÁõÆÁöÑÂú®‰∫é‰ΩøÁõÆÊ†áÁîµËÑëÁöÑÁΩëÁªúÊàñÁ≥ªÁªüËµÑÊ∫êËÄóÂ∞ΩÔºå‰ΩøÊúçÂä°ÊöÇÊó∂‰∏≠Êñ≠ÊàñÂÅúÊ≠¢ÔºåÂØºËá¥ÂÖ∂Ê≠£Â∏∏Áî®Êà∑Êó†Ê≥ïËÆøÈóÆ„ÄÇ Â∞Ü ToastRecord Âä†ÂÖ•ÈòüÂàó‰πãÂêéÔºå enqueueToast ËøòË∞ÉÁî®‰∫Ü showNextToastLocked(); ÊñπÊ≥ï, ËØ•ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö12345678910111213void showNextToastLocked() &#123; ToastRecord record = mToastQueue.get(0); while (record != null) &#123; if (DBG) Slog.d(TAG, &quot;Show pkg=&quot; + record.pkg + &quot; callback=&quot; + record.callback); try &#123; record.callback.show(record.token);//Ë∞ÉÁî® record ÂØπË±°‰∏≠ callback ÁöÑ show ÊñπÊ≥ï scheduleTimeoutLocked(record); //Ë∂ÖÊó∂ÊèêÈÜíÔºåÊéßÂà∂ÊòæÁ§∫Êó∂Èó¥ return; &#125; catch (RemoteException e) &#123; //...‰ª£Á†ÅÁúÅÁï• &#125; &#125;&#125; ËøôÈáåÁöÑ callBack ÊòØ‰ªÄ‰πàÔºü ÂÆÉÊòØÂú® ToastRecord ‰∏≠ÁöÑÔºåÁûÖÁûÖ ToastRecord ÁöÑÊûÑÈÄ†ÊñπÊ≥ï„ÄÇ12345678ToastRecord(int pid, String pkg, ITransientNotification callback, int duration, Binder token) &#123; this.pid = pid; this.pkg = pkg; this.callback = callback; this.duration = duration; this.token = token;&#125; Âú® enqueueToast ÊñπÊ≥ï‰∏≠ÔºåÂ∞Ü Toast ÂåÖË£Ö‰∏∫ ToastRecord ÔºåÂàõÂª∫‰∫Ü ToastRecord ÂØπË±°„ÄÇ record = new ToastRecord(callingPid, pkg, callback, duration, token);//Â∞Ü Toast ÂåÖË£Ö‰∏∫ ToastRecord callBack ÊòØ enqueueToast ‰∏≠ÁöÑ‰∏Ä‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨ÁöÑË∞ÉÁî®Â¶Ç‰∏ãÔºö service.enqueueToast(pkg, tn, mDuration); Ê≤°ÈîôÔºåcallBack ÂÆûÈôÖ‰∏äÂ∞±ÊòØÂâçÈù¢ËÆ≤Âà∞ÁöÑ Toast ÁöÑÂÜÖÈÉ®Á±ª TN„ÄÇ ÂõûÂà∞ÂâçÈù¢ÁúãÁúãÔºåTN Á°ÆÂÆûÁªßÊâø‰∫Ü ITransientNotification.Stub„ÄÇ showNextToastLocked() ÊñπÊ≥ïË∞ÉÁî® callBack ÁöÑ show() ÊñπÊ≥ïÊù•ÊòæÁ§∫ Toast„ÄÇ 12345@Overridepublic void show(IBinder windowToken) &#123; if (localLOGV) Log.v(TAG, &quot;SHOW: &quot; + this); mHandler.obtainMessage(0, windowToken).sendToTarget();&#125; 1234567final Handler mHandler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; IBinder token = (IBinder) msg.obj; handleShow(token); &#125;&#125;; ÂÖ∂ÂÖ∑‰ΩìÂÆûÁé∞ÂèàÊòØÂú® handleShow(token);1234567891011121314151617public void handleShow(IBinder windowToken) &#123; if (mView != mNextView) &#123; // Â¶ÇÊûúÊúâÂøÖË¶ÅÁöÑËØùÔºåÂ∞ÜËøòÂú®ÊòæÁ§∫ÁöÑ toast ÈöêËóèÊéâ handleHide(); mView = mNextView; //‰ª£Á†ÅÁúÅÁï• mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);//Ëé∑Âèñ windowManager //ÁúÅÁï•‰ª£Á†ÅÔºåÁªôÂ∏ÉÂ±ÄÂèÇÊï∞ËµãÂÄº if (mView.getParent() != null) &#123; if (localLOGV) Log.v(TAG, "REMOVE! " + mView + " in " + this); mWM.removeView(mView); &#125; mWM.addView(mView, mParams); trySendAccessibilityEvent(); &#125;&#125; ‰ª•‰∏ä‰ª£Á†ÅÊ†∏ÂøÉÂú®‰∫é12mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);mWM.addView(mView, mParams); Â∞Ü Toast ÁöÑËßÜÂõæÊ∑ªÂä†Âà∞ Window ‰∏≠„ÄÇ ËøôÊ†∑ View Â∞±ËÉΩÈ°∫Âà©ÊòæÁ§∫Âá∫Êù•‰∫Ü„ÄÇ ‰Ω†ÂèØËÉΩ‰ºöÈóÆÔºå‰∏∫‰ªÄ‰πà TN Ë∞ÉÁî® show ÊñπÊ≥ïË¶ÅÁî®Âà∞ÁöÑ Handler Ôºü Âõ†‰∏∫ËØ•ÊñπÊ≥ïÊòØË¢´ÊòØË¢´ NMS ‰ª•Ë∑®ËøõÁ®ãÊñπÂºèË∞ÉÁî®ÁöÑÔºåÂõ†Ê≠§ÂÆÉ‰ª¨ËøêË°åÂú® Binder Á∫øÁ®ãÊ±†‰∏≠„ÄÇ‰∏∫‰∫ÜÂ∞ÜÊâßË°åÁéØÂ¢ÉÂàáÊç¢Âà∞ Toast ËØ∑Ê±ÇÊâÄÂú®ÁöÑÁ∫øÁ®ãÔºåÂú®ÂÆÉ‰ª¨ÂÜÖÈÉ®‰ΩøÁî®‰∫Ü Handler„ÄÇ ÈÇ£‰πàÊó∂Èó¥Âà∞‰∫Ü Toast ÂèàÊòØÊÄé‰πàÊ†∑ÂèñÊ∂àÁöÑÂë¢Ôºü Âú®‰ª§ Toast ÊòæÁ§∫ÊñπÊ≥ïË∞ÉÁî®ËøáÁ®ã‰∏≠ Êàë‰ª¨‰πüË∞ÉÁî®‰∫Ü scheduleTimeoutLocked(record); ÊñπÊ≥ï„ÄÇ 123456private void scheduleTimeoutLocked(ToastRecord r)&#123; mHandler.removeCallbacksAndMessages(r); Message m = Message.obtain(mHandler, MESSAGE_TIMEOUT, r); long delay = r.duration == Toast.LENGTH_LONG ? LONG_DELAY : SHORT_DELAY;//ËÆæÁΩÆ Âª∂ËøüÊó∂Èó¥ mHandler.sendMessageDelayed(m, delay);&#125; SHORT_DELAY ‰∏∫ 2s LONG_DELAY ‰∏∫ 3.5s scheduleTimeoutLocked ‰ºöÂèëÂá∫Ê∂àÊÅØÁªô hanlder,Êî∂Âà∞Áõ∏Â∫îÁöÑ‰ø°ÊÅØÂêé handleMessage ÊñπÊ≥ï‰ºöË∞ÉÁî®handleTimeout((ToastRecord)msg.obj);, ËØ•ÊñπÊ≥ïÂèà‰ºöË∞ÉÁî® cancelToastLocked(index); 123456789void cancelToastLocked(int index) &#123; ToastRecord record = mToastQueue.get(index); try &#123; record.callback.hide();// &#125; catch (RemoteException e) &#123; //‰ª£Á†ÅÁúÅÁï• &#125; //‰ª£Á†ÅÁúÅÁï•&#125; ÂèØ‰ª•ÁúãÂà∞ÈöêËóè Toast ÁöÑÂÆûÁé∞‰πüÊòØÂú® TN ‰∏≠ÁöÑ„ÄÇ‰∏é handleShow ÂØπÂ∫îÔºåÊúâ‰∏Ä‰∏™ handleHide ÊñπÊ≥ï„ÄÇËØ•ÊñπÊ≥ï‰ºöÂ∞Ü Toast ÁöÑËßÜÂõæ‰ªé Window ‰∏≠ÁßªÈô§„ÄÇÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö12345678public void handleHide() &#123; if (mView != null) &#123; if (mView.getParent() != null) &#123; mWM.removeViewImmediate(mView); &#125; mView = null; &#125;&#125; Toast ÁöÑ„Äå‰∏Ä‰∏™ Bug„ÄçÂÖ∂ÂÆûËøôÊòØ‰∏Ä‰∏™Á≥ªÁªüÁöÑBugÔºåË∞∑Ê≠å‰∏∫‰∫ÜËÆ©Â∫îÁî®ÁöÑ Toast ËÉΩÂ§üÊòæÁ§∫Âú®ÂÖ∂‰ªñÂ∫îÁî®‰∏äÈù¢ÔºåÊâÄ‰ª•‰ΩøÁî®‰∫ÜÈÄöÁü•Ê†èÁõ∏ÂÖ≥ÁöÑ APIÔºå‰ΩÜÊòØËøô‰∏™ API ÈöèÁùÄÁî®Êà∑Â±èËîΩÈÄöÁü•Ê†èËÄåÂèòÂæó‰∏çÂèØÁî®ÔºåÁ≥ªÁªüÈîôËØØÂú∞ËÆ§‰∏∫‰Ω†Ê≤°ÊúâÈÄöÁü•Ê†èÊùÉÈôêÔºå‰ªéËÄåÈó¥Êé•ÂØºËá¥ Toast Êúâ show ËØ∑Ê±ÇÊó∂Ë¢´Á≥ªÁªüÊâÄÊã¶Êà™ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ToastÈÄöÁü•Ê†èÊùÉÈôêÂ°´ÂùëÊåáÂçó Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆËØ∑Âú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂàõÂª∫ÂûãÊ®°Âºè‰πãÂçï‰æãÊ®°Âºè]]></title>
    <url>%2Fblog%2F2017%2F07%2F20%2F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[‰∏Ä„ÄÅ‰ªÄ‰πàÊòØÂçï‰æãÊ®°ÂºèÔºüwiki ÁªôÂá∫ÁöÑÂÆö‰πâÂ¶Ç‰∏ãÔºöÂçï‰æãÊ®°ÂºèÔºå‰πüÂè´ÂçïÂ≠êÊ®°ÂºèÔºåÊòØ‰∏ÄÁßçÂ∏∏Áî®ÁöÑËΩØ‰ª∂ËÆæËÆ°Ê®°Âºè„ÄÇÂú®Â∫îÁî®Ëøô‰∏™Ê®°ÂºèÊó∂ÔºåÂçï‰æãÂØπË±°ÁöÑÁ±ªÂøÖÈ°ª‰øùËØÅÂè™Êúâ‰∏Ä‰∏™ÂÆû‰æãÂ≠òÂú®„ÄÇËÆ∏Â§öÊó∂ÂÄôÊï¥‰∏™Á≥ªÁªüÂè™ÈúÄË¶ÅÊã•Êúâ‰∏Ä‰∏™ÁöÑÂÖ®Â±ÄÂØπË±°ÔºåËøôÊ†∑ÊúâÂà©‰∫éÊàë‰ª¨ÂçèË∞ÉÁ≥ªÁªüÊï¥‰ΩìÁöÑË°å‰∏∫„ÄÇ ÊØîÂ¶ÇÂú®Êüê‰∏™ÊúçÂä°Âô®Á®ãÂ∫è‰∏≠ÔºåËØ•ÊúçÂä°Âô®ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÂ≠òÊîæÂú®‰∏Ä‰∏™Êñá‰ª∂‰∏≠ÔºåËøô‰∫õÈÖçÁΩÆÊï∞ÊçÆÁî±‰∏Ä‰∏™Âçï‰æãÂØπË±°Áªü‰∏ÄËØªÂèñÔºåÁÑ∂ÂêéÊúçÂä°ËøõÁ®ã‰∏≠ÁöÑÂÖ∂‰ªñÂØπË±°ÂÜçÈÄöËøáËøô‰∏™Âçï‰æãÂØπË±°Ëé∑ÂèñËøô‰∫õÈÖçÁΩÆ‰ø°ÊÅØ„ÄÇËøôÁßçÊñπÂºèÁÆÄÂåñ‰∫ÜÂú®Â§çÊùÇÁéØÂ¢É‰∏ãÁöÑÈÖçÁΩÆÁÆ°ÁêÜ„ÄÇ ‰∫å„ÄÅ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Âçï‰æãÊ®°ÂºèÔºü Êúâ‰∏Ä‰∫õÂØπË±°ÁöÑÂÜÖÂ≠òÊ∂àËÄóÊØîËæÉÂ§ßÔºåÂàõÂª∫Â§öÊ¨°‰ºöÈÄ†ÊàêÂæàÂ§ßÁöÑËµÑÊ∫êÂºÄÊîØ„ÄÇ Êñπ‰æøÈÖçÁΩÆ„ÄÇ ‰æãÂ¶Ç ÁΩëÁªúËØ∑Ê±ÇÁªèÂ∏∏Ë¶ÅÁî®Âà∞ cookieÔºåÂ¶ÇÊûú‰ΩøÁî® OkHttp ÂèØ‰ª•Â∞ÜÂÖ∂Â∞ÅË£Ö‰∏∫‰∏Ä‰∏™Âçï‰æãÂ∑•ÂÖ∑Á±ªÔºåÂÜÖÈÉ®‰ΩøÁî® CookJar ÂØπ cookie ËøõË°åÁÆ°ÁêÜÔºåËøôÊ†∑ÂêéÁª≠ÁöÑËØ∑Ê±ÇÂ∞±‰ºöÊñπ‰æøÂæàÂ§ö„ÄÇ ÂÆâÂÖ®ÊÄß„ÄÇÊØîÂ¶Ç SQLite Êï∞ÊçÆÂ∫ìÁöÑÂ¢ûÂà†Êü•ÊîπÔºåÈÄöËøáÂçï‰æãÂØπË±°ÂØπÂ§ñÊèê‰æõÂ¢ûÂà†Êü•ÊîπÂäüËÉΩÔºåÂèØ‰ª•ÈÅøÂÖç‰∏Ä‰∫õÂπ∂ÂèëÈîôËØØ„ÄÇ ‰∏â„ÄÅÂçï‰æãÊ®°ÂºèÁöÑÂÆûÁé∞ÊñπÂºè1. È•øÊ±âÊ®°Âºè1234567891011public class Singleton &#123; private static Singleton sInstance = new Singleton(); private Singleton()&#123; &#125; public static Singleton getInstance() &#123; return sInstance; &#125;&#125; Âú®Â£∞ÊòéÈùôÊÄÅÂØπË±°Êó∂Â∞±ÊääÂÆÉÂàùÂßãÂåñ„ÄÇÔºàÂõ†‰∏∫È•øÔºåÊâÄ‰ª•Ëø´‰∏çÂèäÂæÖÂÖàÊääÂÆÉ new Âá∫Êù•Ôºâ 2. ÊáíÊ±âÊ®°Âºè1234567891011121314public class Singleton &#123; private static Singleton sInstance; private Singleton() &#123; &#125; public static synchronized Singleton getInstance() &#123; if (sInstance == null) &#123; sInstance = new Singleton(); &#125; return sInstance; &#125;&#125; Âú® getInstance ÊñπÊ≥ï‰∏≠Ê∑ªÂä†‰∫Ü synchronized ÂÖ≥ÈîÆÂ≠óÔºå‰πüÂ∞±ÊòØ ‰∏Ä‰∏™ÈóÆÈ¢òÔºöÂç≥‰Ωø instance Â∑≤ÁªèË¢´ÂàùÂßãÂåñÔºå‰πãÂêéÁöÑÊØèÊ¨°Ë∞ÉÁî®ËøòÊòØ‰ºö ËøõË°åÂêåÊ≠•ÔºåËøôÊ†∑‰ºöÊ∂àËÄó‰∏çÂøÖË¶ÅÁöÑËµÑÊ∫ê ‰∏∫‰ªÄ‰πàÂè´ÂÅöÊáíÊ±âÂë¢ÔºüÂÖ∂ÂÆûÂèØ‰ª•ÁêÜËß£‰∏∫ÊáíÂä†ËΩΩÔºåÊúâÈúÄË¶ÅÁöÑÊó∂ÂÄôÔºåÂÜçÊääÂÆÉÂä†ËΩΩÂá∫Êù•„ÄÇ ÊáíÊ±âÂçï‰æãÊ®°ÂºèÁöÑ ‰ºòÁÇπÔºöÂçï‰æãÂè™ÊúâÂú®‰ΩøÁî®Êó∂Êâç‰ºöË¢´ÂÆû‰æãÂåñÔºåÂú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äËäÇÁ∫¶‰∫ÜËµÑÊ∫ê„ÄÇ Áº∫ÁÇπÔºöÁ¨¨‰∏ÄÊ¨°Âä†ËΩΩÊó∂ÈúÄË¶ÅÂèäÊó∂Âú∞ÂÆû‰æãÂåñÔºåÂèçÂ∫îÁ®çÊÖ¢ÔºåÊúÄÂ§ßÁöÑÈóÆÈ¢òÊòØÔºöÊØèÊ¨°Ë∞ÉÁî®ÈÉΩ‰ºöËøõË°åÂêåÊ≠•ÔºåÈÄ†Êàê‰∏çÂøÖË¶ÅÁöÑÂêåÊ≠•ÂºÄÈîÄ„ÄÇ 3. ÂèåÈáçÊ†°È™åÈîÅ ( DCL )DCL Êó¢ËÉΩÂ§üÂú®ÈúÄË¶ÅÊó∂ÊâçÂàùÂßãÂåñÂÆû‰æãÔºåÂèàËÉΩÂ§ü‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®ÔºåËÄå‰∏îÂçï‰æãÂØπË±°ÂàùÂßãÂåñÂêéÊâçË∞ÉÁî® getInstance ‰∏çËøõË°åÂêåÊ≠•ÈîÅ„ÄÇ12345678910public static Singleton getInstance() &#123; if (sInstance == null) &#123; synchronized (Singleton.class) &#123; if (sInstance == null) &#123; sInstance = new Singleton(); &#125; &#125; &#125; return sInstance;&#125; ‰∏∫‰ªÄ‰πàÂú®ÂêåÊ≠•ÂùóÂÜÖËøòË¶ÅÂÜçËøõË°åÂà§Á©∫ÔºüÂõ†‰∏∫ÂèØËÉΩ‰ºöÊúâÂ§ö‰∏™Á∫øÁ®ã‰∏ÄËµ∑ËøõÂÖ•ÂêåÊ≠•ÂùóÂ§ñÁöÑ ifÔºåÂ¶ÇÊûúÂú®ÂêåÊ≠•ÂùóÂÜÖ‰∏çËøõË°å‰∫åÊ¨°Ê£ÄÈ™åÁöÑËØùÂ∞±‰ºöÁîüÊàêÂ§ö‰∏™ÂÆû‰æã‰∫Ü„ÄÇ ‰∏∫‰ªÄ‰πàË¶ÅÂä† volitale ÂÖ≥ÈîÆÂ≠óÔºüsInstance = new Singleton();ËøôÂè•‰ª£Á†Å‰ºöË¢´ÁºñËØëÊàêÂ§öÊù°Ê±áÁºñÊåá‰ª§ÔºåÂÆÉÂ§ßËá¥ÂÅö‰∫Ü 3 ‰ª∂‰∫ãÊÉÖ Áªô Singleton ÂÆû‰æãÂàÜÈÖçÂÜÖÂ≠ò Ë∞ÉÁî® Singleton ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÔºåÂàùÂßãÂåñÊàêÂëòÂ≠óÊÆµ Â∞Ü sInstance ÂØπË±°ÊåáÂêëÂàÜÈÖçÁöÑÂÜÖÂ≠òÁ©∫Èó¥ ‰ΩÜÊòØÁî±‰∫é Java ÁºñËØëÂô®ÂÖÅËÆ∏Â§ÑÁêÜÂô®‰π±Â∫èÊâßË°åÔºå‰ª•Âèä JDK 1.5 ‰πãÂâç JMMÔºàJava Memory ModelÔºå Java ÂÜÖÂ≠òÊ®°ÂûãÔºâ ‰∏≠ cache„ÄÅÂØÑÂ≠òÂô®Âà∞‰∏ªÂÜÖÂ≠òÂõûÂÜôÈ°∫Â∫èÁöÑËßÑÂÆöÔºå‰∏äÈù¢ÁöÑ 2 Âíå 3 ÁöÑÈ°∫Â∫èÊòØÊó†Ê≥ï‰øùËØÅÁöÑ„ÄÇ Â¶ÇÊûúÊòØ 1-3-2ÔºåÈÇ£‰πàÂΩì 3 ÊâßË°åÂÆåÔºåÂπ∂‰∏î 2 ËøòÊ≤°ÊúâÊâßË°åÁöÑËØùÔºåË¢´ÂàáÊç¢Âà∞Âà∞Á∫øÁ®ã BÔºåËøôÊó∂ sInstance Â∑≤ÁªèÈùûÁ©∫ÔºàÂõ†‰∏∫ 3 Â∑≤ÁªèË¢´ÊâßË°å‰∫ÜÂòõÔºâÔºåËã• Ê≠§Êó∂Á∫øÁ®ã B Áõ¥Êé•ÂèñËµ∞ sInstance ‰ΩøÁî®Êó∂Â∞±‰ºöÊä•Èîô„ÄÇ Ëß£ÂÜ≥ÔºöJDK 1.5 ‰πãÂêéÔºåSUN ÂÆòÊñπË∞ÉÊï¥‰∫Ü JVMÔºåÂÖ∑‰ΩìÂåñ‰∫Ü volatile ÂÖ≥ÈîÆÂ≠óÔºàÁ¶ÅÊ≠¢Êåá‰ª§ÈáçÊéíÂ∫èÔºâ„ÄÇ Â¶ÇÊûúÊòØÂú® JDK 1.5 ‰πãÂêéÔºåÈÇ£‰πàÂè™ÈúÄË¶ÅÊää sInstance ÁöÑÂ£∞Êòé Êîπ‰∏∫ private volatile static Singleton sInstance; Âç≥ÂèØ 4. ÈùôÊÄÅÂÜÖÈÉ®Á±ªÂçï‰æãÊ®°ÂºèDCL Âú®Êüê‰∫õÊÉÖÂÜµ‰∏ã‰ºöÂá∫Áé∞Â§±ÊïàÁöÑÈóÆÈ¢ò„ÄÇËøô‰∏™ÈóÆÈ¢òË¢´Áß∞‰∏∫ÂèåÈáçÊ£ÄÊü•ÈîÅÂÆöÔºàDCLÔºâÂ§±Êïà„ÄÇ 123456789101112public class Singleton&#123; private Singleton()&#123; &#125; public static Singleton getInstance()&#123; return SingletonHolder.sInstance; &#125; private static class SingletonHolder &#123; private static final Singleton sInstance = new Singleton(); &#125;&#125; Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî® Singleton ÁöÑ getInstance ÊñπÊ≥ïÊó∂Êâç‰ºöÂØºËá¥ sInstance Ë¢´ÂàùÂßãÂåñ„ÄÇÂõ†Ê≠§ÔºåÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî® getInstance ÊñπÊ≥ï‰ºöÂØºËá¥ËôöÊãüÊú∫Âä†ËΩΩ SingletonHolder Á±ªÔºåËøôÁßçÊñπÂºè‰∏ç‰ªÖËÉΩÂ§üÁ°Æ‰øùÁ∫øÁ®ãÂÆâÂÖ®Ôºå‰πüËÉΩ‰øùËØÅÂçï‰æãÂØπË±°ÁöÑÂîØ‰∏ÄÊÄß„ÄÇ ÊâÄ‰ª•ËøôÊòØÊé®Ëçê‰ΩøÁî®ÁöÑÂçï‰æãÊ®°ÂºèÂÆûÁé∞ÊñπÂºè 5. Êûö‰∏æÂçï‰æãÂØπÊûö‰∏æ‰∏ç‰∫ÜËß£ÂèØ‰ª•ÂÖàÁúãÁúãÊûö‰∏æËøôÁØáÊñáÁ´† ÂÜôÊ≥ïÁÆÄÂçïÊòØÊûö‰∏æÂçï‰æã ÊúÄÂ§ßÁöÑ‰ºòÁÇπ„ÄÇ123public enum Singleton&#123; INSTANCE;&#125; Ëé∑ÂèñÂØπË±°ÂèØ‰ª•Ëøô‰πàÂÜôÔºö Singleton singleton = Singleton.INSTANCE; Êûö‰∏æÂú® Java ‰∏≠‰∏éÊôÆÈÄöÁöÑÁ±ªÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰∏ç‰ªÖËÉΩÂ§üÊúâÂ≠óÊÆµÔºåËøòËÉΩÂÆö‰πâËá™Â∑±ÁöÑÊñπÊ≥ï„ÄÇ 12345678910public enum Singleton&#123; INSTANCE; //Êûö‰∏æÂÜÖÈÉ®ÂèØ‰ª•ÂÆö‰πâÊàêÂëòÔºõ private String mString; //Êûö‰∏æÂÜÖÈÉ®ÂèØ‰ª•ÂÆö‰πâÊñπÊ≥ïÔºõ public void doSth() &#123; //do sth &#125;&#125; ÊúÄÈáçË¶ÅÁöÑÊòØÈªòËÆ§Êûö‰∏æÂÆû‰æãÁöÑÂàõÂª∫ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂπ∂‰∏î‰ªª‰ΩïÊÉÖÂÜµ‰∏ãÂÆÉÈÉΩÊòØ‰∏Ä‰∏™Âçï‰æã„ÄÇ ‰∏äËø∞Âá†ÁßçÊñπÂºè‰∏≠ÔºåÂú®‰∏Ä‰∏™ÊÉÖÂÜµ‰∏ãÈÉΩ‰ºöÈáçÊñ∞ÂàõÂª∫ÂØπË±°ÁöÑÊÉÖÂÜµÔºåÈÇ£Â∞±ÊòØÂèçÂ∫èÂàóÂåñ„ÄÇ Âç≥‰ΩøÊûÑÈÄ†ÂáΩÊï∞ÊòØÁßÅÊúâÁöÑÔºåÂèçÂ∫èÂàóÂåñÊòØ‰æùÁÑ∂ÂèØ‰ª•ÈÄöËøáÁâπÊÆäÁöÑÈÄîÂæÑÂéªÂàõÂª∫Á±ªÁöÑ‰∏Ä‰∏™Êñ∞ÁöÑÂÆû‰æãÔºåÁõ∏ÂΩì‰∫é Ë∞ÉÁî®ËØ•Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÇ ÂèçÂ∫èÂàóÂåñÊìç‰ΩúÊèê‰æõ‰∫Ü‰∏Ä‰∏™ÂæàÁâπÂà´ÁöÑÈí©Â≠êÂáΩÊï∞ÔºåÁ±ª‰∏≠ÂÖ∑Êúâ‰∏Ä‰∏™ÁßÅÊúâÁöÑ„ÄÅË¢´ÂÆû‰æãÂåñÁöÑÊñπÊ≥ï readResolve(),Ëøô‰∏™ÊñπÊ≥ïÂèØ‰ª•ËÆ©ÂºÄÂèë‰∫∫ÂëòÊéßÂà∂ÂØπË±°ÁöÑÂèçÂ∫èÂàóÂåñ„ÄÇ ‰∏äËø∞Âá†ÁßçÂçï‰æãÊñπÊ≥ï‰∏≠Â¶ÇÊûúË¶ÅÊùúÁªùÂçï‰æãÂØπË±°Âú®Ë¢´ÂèçÂ∫èÂàóÂåñÊó∂ÈáçÊñ∞ÁîüÊàêÂØπË±°ÔºåÈÇ£ÂøÖÈ°ªÂä†ÂÖ•Â¶Ç‰∏ãÊñπÊ≥ïÔºö123private Object readResolve() throws ObjectStreamException &#123; return sInstance;&#125; ‰πüÂ∞±ÊòØÂú® readResolve ÊñπÊ≥ï‰∏≠Â∞Ü sInstance ÂØπË±°ËøîÂõûÔºåËÄå‰∏çÊòØÈªòËÆ§ÁöÑÈáçÊñ∞ÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°„ÄÇ ËÄåÂØπ‰∫éÊûö‰∏æÔºåÂπ∂‰∏çÂ≠òÂú®Ëøô‰∏™ÈóÆÈ¢òÔºåÂõ†‰∏∫Âç≥‰ΩøÂèçÂ∫èÂàóÂåñ‰πü‰∏ç‰ºöÈáçÊñ∞ÁîüÊàêÊñ∞ÁöÑÂÆû‰æã„ÄÇ 6. ‰ΩøÁî®ÂÆπÂô®ÂÆûÁé∞Âçï‰æãÊ®°Âºè1234567891011121314151617public class SingletonManager &#123; private static Map&lt;String, Object&gt; sObjectMap = new HashMap&lt;&gt;(); private SingletonManager() &#123; &#125; public static void registerService(String key, Object instance) &#123; if (!sObjectMap.containsKey(key)) &#123; sObjectMap.put(key, instance); &#125; &#125; public static Object getService(String key) &#123; return sObjectMap.get(key); &#125;&#125; Âú®Á®ãÂ∫èÁöÑÂàùÂßãÔºåÂ∞ÜÂ§öÁßçÂçï‰æãÁ±ªÂûãÊ≥®ÂÖ•Âà∞‰∏Ä‰∏™Áªü‰∏ÄÁöÑÁÆ°ÁêÜÁ±ª‰∏≠Ôºå‰ΩøÁî®Êó∂Ê†ºÊ†πÊçÆ key Ëé∑ÂèñÂØπË±°ÂØπÂ∫îÁ±ªÂûãÁöÑÂØπË±°„ÄÇ ËøôÁßçÂÆûÁé∞ÊñπÂºè‰∏ªË¶ÅÊòØÊñπ‰æøÂØπÂçï‰æãÂØπË±°ËøõË°åÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ Â∞èÁªì ‰∏çÁÆ°‰ΩøÁî®Âì™‰∏ÄÁßçÂΩ¢ÂºèÂÆûÁé∞Âçï‰æãÊ®°ÂºèÔºåÊ†∏ÂøÉÂéüÁêÜÈÉΩÊòØ==Â∞ÜÊûÑÈÄ†ÂáΩÊï∞ÁßÅÊúâÂåñ==ÔºåÂπ∂‰∏î==ÈÄöËøáÈùôÊÄÅÊñπÊ≥ïËé∑ÂèñÂîØ‰∏ÄÁöÑÁöÑÂÆû‰æã==„ÄÇ Âú®Ëé∑ÂèñÁöÑËøáÁ®ã‰∏≠ÂøÖÈ°ª‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®„ÄÅÈò≤Ê≠¢ÂèçÂ∫èÂàóÂåñÂØºËá¥ÈáçÊñ∞ÁîüÊàêÂÆû‰æãÂØπË±°Á≠âÈóÆÈ¢ò„ÄÇ ‰ΩøÁî®Êó∂ÁöÑÊ≥®ÊÑèÁÇπÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÊºè Android ÂºÄÂèë‰∏≠‰ΩøÁî®Âçï‰æãÊ®°ÂºèÔºåÂ¶ÇÊûúËé∑ÂèñÂçï‰æãÂØπË±°ÈúÄË¶Å‰ΩøÁî® ContextÔºåÈÇ£‰πàÂ∞ΩÈáè‰ΩøÁî® ApplicationContext(Âè™Ë¶ÅÁî® context.getApplicationContext() Âç≥ÂèØËé∑Âèñ)„ÄÇÂõ†‰∏∫Â¶ÇÊûú‰ΩøÁî®ÂÖ∂‰ªñ ContextÔºàÂ¶Ç Activity) ÂèØËÉΩ‰ºöÈÄ†Êàê Activiity ÁîüÂëΩÂë®Êúü ÊâßË°åÂÆåÊàê‰πãÂêéÔºåÂõ†‰∏∫ÂÖ∂ÂºïÁî®Ë¢´Âçï‰æãÊâÄÊåÅÊúâÔºåËÄåÊó†Ê≥ïË¢´ÂõûÊî∂„ÄÇ Â§öËøõÁ®ãÁéØÂ¢É‰∏ãÔºåÂçï‰æãÊ®°Âºè‰ºöÂ§±Êïà„ÄÇ Android Ê∫êÁ†Å‰∏≠ÁöÑÂçï‰æãÊ®°ÂºèÁÆÄËø∞Êàë‰ª¨ÁªèÂ∏∏‰ºöÈÄöËøá Context ÂéªËé∑ÂèñÁ≥ªÁªüÊúçÂä°ÔºåÂ¶Ç LayoutInflater„ÄÅNetworkStatsManagerÔºåËøô‰∫õÊúçÂä°Âú®ÂàõÂª∫Êó∂‰ºö‰ª•ÈîÆÂÄºÂØπÁöÑÂΩ¢ÂºèÁºìÂ≠òÂà∞ HashMap ‰∏≠Ôºå‰æø‰∫éÁÆ°ÁêÜ„ÄÇ ÈúÄË¶ÅÊó∂Â∞±ÈÄöËøáË∞ÉÁî® context.getSystemService(String name) ÊñπÊ≥ïËé∑Âèñ „ÄÇÈ¶ñÂÖà‰ºö‰ª• name ‰Ωú‰∏∫ keyÔºåÂà∞ hashMap ‰∏≠Êü•Êâæ‰∏≠Áõ∏Â∫îÁöÑÊúçÂä°ÔºåÂ¶ÇÊûúÂØπÂ∫îÁöÑÊúçÂä°‰∏∫ null Â∞±ÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æãÔºåÂπ∂Â∞ÜËØ•ÂÆû‰æãÁºìÂ≠òÂà∞ HashMap ‰∏≠ÔºõÂ¶ÇÊûúÂØπÂ∫îÁöÑÊúçÂä°Â∑≤ÁªèÂ≠òÂú®ÔºåÂàôÁõ¥Êé•ËøîÂõû„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê wiki Âçï‰æãÊ®°Âºè Android Ê∫êÁ†ÅËÆæËÆ°Ê®°Âºè Âçï‰æãÊ®°Âºè]]></content>
      <categories>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IPC Êú∫Âà∂]]></title>
    <url>%2Fblog%2F2017%2F05%2F04%2FAndroid%20IPC-%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[Android IPCÁÆÄ‰ªãIPC ÊòØ Inter-Process Communication ÁöÑÁº©ÂÜôÔºåÂê´‰πâ‰∏∫ ËøõÁ®ãÈó¥ÈÄö‰ø°ÊàñËÄÖË∑®ËøõÁ®ãÈÄö‰ø°ÔºåÊòØÊåá‰∏§‰∏™ËøõÁ®ã‰πãÈó¥ËøõË°åÊï∞ÊçÆ‰∫§Êç¢ÁöÑËøáÁ®ã„ÄÇaIPC ‰∏çÊòØ Android ÊâÄÁã¨ÊúâÁöÑÔºå‰ªª‰Ωï‰∏Ä‰∏™Êìç‰ΩúÁ≥ªÁªüÈÉΩÈúÄË¶ÅÊúâÁõ∏Â∫îÁöÑ IPC Êú∫Âà∂„ÄÇ Âú® Android ‰∏≠ÊúÄÊúâÁâπËâ≤ÁöÑËøõÁ®ãÈó¥ÈÄö‰ø°ÊñπÂºèÂ∞±ÊòØ Binder ‰∫ÜÔºå ÈÄöËøá Binder ÂèØ‰ª•ËΩªÊùæÂÆûÁé∞ËøõÁ®ãÈó¥ÈÄö‰ø°„ÄÇ Èô§‰∫Ü Binder ÔºåAndroid ËøòÊîØÊåÅ SocketÔºå ÈÄöËøá Socket ‰πüÂèØ‰ª•ÂÆûÁé∞‰ªªÊÑè‰∏§‰∏™ÁªàÁ´Ø‰πãÈó¥ÁöÑÈÄö‰ø°ÔºåÂΩìÁÑ∂‰∏Ä‰∏™ËÆæÂ§áÁöÑ‰∏§‰∏™ËøõÁ®ã‰πãÈó¥ÁöÑ‰πüÂèØ‰ª•ÈÄöËøá Socket ËøõË°åÈÄö‰ø°„ÄÇ Â§öËøõÁ®ãÁöÑÊÉÖÂÜµÂàÜ‰∏§ÁßçÔºö ‰∏Ä‰∏™Â∫îÁî®Âõ†‰∏∫Êüê‰∫õÂéüÂõ†Ëá™Ë∫´ÈúÄË¶ÅÈááÁî®Â§öËøõÁ®ãÊ®°ÂºèÊù•ÂÆûÁé∞ ÂèØËÉΩÁöÑÂéüÂõ†Â¶Ç‰∏ãÔºö Êúâ‰∫õÊ®°ÂùóÈúÄË¶ÅËøêË°åÂú®ÂçïÁã¨ÁöÑËøõÁ®ã‰∏≠ Âä†Â§ß‰∏Ä‰∏™Â∫îÁî®ÂèØ‰ΩøÁî®ÁöÑÂÜÖÂ≠ò ÂΩìÂâçÂ∫îÁî®ÈúÄË¶ÅÂêëÂÖ∂‰ªñÂ∫îÁî®Ëé∑ÂèñÊï∞ÊçÆ„ÄÇ 2 Android‰∏≠ÁöÑÂ§öËøõÁ®ãÊ®°ÂºèÈÄöËøáÁªôÂõõÂ§ßÁªÑ‰ª∂ÊåáÂÆö android:processÂ±ûÊÄßÔºåÂèØ‰ª•ËΩªÊòìÂú∞ÂºÄÂêØÂ§öÁ∫øÁ®ãÊ®°Âºè„ÄÇ 1 ÂºÄÂêØÂ§öËøõÁ®ãÊ®°Âºè‰∏ÄËà¨Âú∞ÔºåÂú® Android ‰∏≠Â§öËøõÁ®ãÊòØÊåá‰∏Ä‰∏™Â∫îÁî®‰∏≠Â≠òÂú®Â§ö‰∏™ËøõÁ®ãÁöÑÊÉÖÂÜµÔºàÊ≠§Â§Ñ‰∏çËÆ®ËÆ∫‰∏§‰∏™Â∫îÁî®‰πãÈó¥ÁöÑÂ§öËøõÁ®ãÊÉÖÂÜµÔºâ È¶ñÂÖàÔºåÂú® Android ‰∏≠‰ΩøÁî®Â§öËøõÁ®ãÂè™Êúâ‰∏ÄÁßçÊñπÊ≥ïÔºå Âú® manifest Êñá‰ª∂‰∏≠ÔºåÁªôÂõõÂ§ßÁªÑ‰ª∂ ÊåáÂÆö android:process Â±ûÊÄß„ÄÇ ÂÖ∂ÂÆûËøòÊúâ‰∏ÄÁßçÈùûÂ∏∏ËßÑÁöÑÂ§öËøõÁ®ãÊñπÊ≥ï‚Äî‚Äî ÈÄöËøá JNI Âú® native Â±ÇÂéª fork ‰∏Ä‰∏™Êñ∞ÁöÑËøõÁ®ã„ÄÇ Ê†πÊçÆ process ÁöÑÂ±ûÊÄßÂÄº‰∏çÂêåÔºåÂàõÂª∫‰∏çÂêåÁöÑËøõÁ®ã„ÄÇ ÈóÆÈ¢òÔºö‰ΩøÁî® „ÄåÔºöxxx„Äç‰∏é ‰ΩøÁî® „Äåxxx.xxx.xxx„Äç‰∏§ÁßçÊñπÂºèÊúâÂå∫Âà´ÂêóÔºü „ÄåÔºö„ÄçÁöÑÂê´‰πâÊòØÊåáÂú®ÂΩìÂâçÁöÑËøõÁ®ãÂêçÂâçÈù¢ÈôÑ‰∏äÂΩìÂâçÁöÑÂåÖÂêçÔºåÂç≥ ËøôÊòØ‰∏ÄÁßçÁÆÄÂÜôÁöÑÊñπÊ≥ï ËøõÁ®ãÂêç‰ª•„ÄåÔºö„ÄçÂºÄÂ§¥ÁöÑËøõÁ®ãÂ±û‰∫éÂΩìÂâçÂ∫îÁî®ÁöÑÁßÅÊúâËøõÁ®ãÔºåÂÖ∂‰ªñÂ∫îÁî®ÁöÑÁªÑ‰ª∂‰∏çÂèØ‰ª•ÂíåÂÆÉË∑ëÂú®Âêå‰∏Ä‰∏™ËøõÁ®ã‰∏≠Ôºå ËÄåËøõÁ®ãÂêç‰∏ç‰ª•„ÄåÔºö„ÄçÂºÄÂ§¥ÁöÑËøõÁ®ãÂ±û‰∫éÂÖ®Â±ÄËøõÁ®ãÔºåÂÖ∂‰ªñÂ∫îÁî®ÈÄöËøá ShareUID ÊñπÂºèÂèØ‰ª•ÂíåÂÆÉË∑ëÂú®Âêå‰∏Ä‰∏™ËøõÁ®ã‰∏≠„ÄÇ Android Á≥ªÁªü‰ºö‰∏∫ÊØè‰∏™Â∫îÁî®ÂàÜÈÖç‰∏Ä‰∏™ ÂîØ‰∏ÄÁöÑ UIDÔºåÂÖ∑ÊúâÁõ∏Âêå UID ÁöÑÂ∫îÁî®ÊâçËÉΩÂÖ±‰∫´Êï∞ÊçÆ„ÄÇ ‰∏§‰∏™Â∫îÁî®Ë∑ëÂú®Âêå‰∏Ä‰∏™ËøõÁ®ã‰∏≠ ÈúÄË¶Å Ëøô‰∏§‰∏™Â∫îÁî®Êúâ Áõ∏ÂêåÁöÑ shareUID Âπ∂‰∏î Á≠æÂêçÁõ∏Âêå„ÄÇ ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•‰∫íÁõ∏ËÆøÈóÆÂØπÊñπÁöÑÁßÅÊúâÁõÆÂΩïÔºåÂ¶Ç data ÁõÆÂΩï„ÄÇ 2 Â§öËøõÁ®ãÊ®°ÂºèÁöÑËøêË°åÊú∫Âà∂==‰∏Ä‰∏™ËøõÁ®ã = ‰∏Ä‰∏™ ËôöÊãüÊú∫== Android ‰∏∫ÊØè‰∏™Â∫îÁî®ÂàÜÈÖç‰∫Ü‰∏Ä‰∏™Áã¨Á´ãÁöÑËôöÊãüÊú∫ÔºåÊàñËÄÖËØ¥‰∏∫ÊØè‰∏™ËøõÁ®ãÂàÜÈÖç‰∏Ä‰∏™Áã¨Á´ãÁöÑËôöÊãüÊú∫Ôºå‰∏çÂêåËôöÊãüÊú∫Âú®ÂÜÖÂ≠òÂàÜÈÖç‰∏äÊúâ‰∏çÂêåÁöÑÂú∞ÂùÄÁ©∫Èó¥ÔºåËøôÂ∞±ÂØºËá¥‰∫Ü‰∏çÂêåËôöÊãüÊú∫ËåÉÊñáÂêå‰∏Ä‰∏™Á±ªÁöÑÂØπË±°‰ºö‰∫ßÁîüÂ§ö‰ªΩÂâØÊú¨„ÄÇ ‰∏ÄËà¨Êù•ËØ¥Ôºå‰ΩøÁî®Â§öËøõÁ®ã‰ºöÈÄ†Êàê‰ª•‰∏ãÂá†ÊñπÈù¢ÈóÆÈ¢ò ÈùôÊÄÅÊàêÂëòÂíåÂçï‰æãÊ®°ÂºèÂÆåÂÖ®Â§±Êïà Á∫øÁ®ãÂêåÊ≠•Êú∫Âà∂ÂÆåÂÖ®Â§±Êïà SharePreferences ÁöÑÂèØÈù†ÊÄß‰∏ãÈôçÔºåÂ•ΩÂÉèÊúâÂ§öËøõÁ®ãÊ®°ÂºèÔºüÊúâÔºå‰ΩÜÊòØ‰∏çÁ®≥ÂÆöÔºåÊâÄ‰ª•Á≥ªÁªüÂ∑≤Áªè‰∏çÊé®Ëçê‰ΩøÁî®‰∫Ü„ÄÇ Application ‰ºöÂ§öÊ¨°ÂàõÂª∫ ÂèØ‰ª•ËøôÊ†∑ÁêÜËß£Âêå‰∏Ä‰∏™Â∫îÁî®Èó¥ÁöÑÂ§öËøõÁ®ãÔºö ÂÆÉÂ∞±Áõ∏ÂΩì‰∫é‰∏§‰∏™‰∏çÂêåÁöÑÂ∫îÁî®ÈááÁî®‰∫Ü ShareUID ÁöÑÊ®°ÂºèÔºåËøôÊ†∑ËÉΩÂ§üÊõ¥Âä†Áõ¥Êé•Âú∞ÁêÜËß£Â§öËøõÁ®ãÊ®°ÂºèÁöÑÊú¨Ë¥®„ÄÇ 3 IPCÂü∫Á°ÄÊ¶ÇÂøµ‰ªãÁªç3.1 SerializableÊé•Âè£SerializableÊé•Âè£ ÔºöJava ÊâÄÊèê‰æõÁöÑ‰∏Ä‰∏™Â∫èÂàóÂåñÊé•Âè£ÔºåÂÆÉÊòØ‰∏Ä‰∏™Á©∫Êé•Âè£Ôºå‰∏∫ÂØπË±°Êèê‰æõÊ†áÂáÜÁöÑÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÊìç‰Ωú„ÄÇ ‰ΩøÁî®Ôºö- Âè™Ë¶ÅÂú®Á±ªÁöÑÂ£∞Êòé‰∏≠ÊåáÊòé‰∏Ä‰∏™Á±ª‰ºº‰∏ãÈù¢ÁöÑÊ†áËØÜÂç≥ÂèØËá™Âä®ÂÆûÁé∞ *ÈªòËÆ§ÁöÑ* Â∫èÂàóÂåñËøáÁ®ãÔºàÂèØ‰ª•Ëá™ÂÆö‰πâÔºâ„ÄÇ - `private static final long serialVersionUID = 87138828109787189L;` Ëøô‰∏™ serialVersionUID ÂèØ‰ª•Ê≤°ÊúâÔºå‰ΩÜÊòØËøôÊ†∑‰ºöÂØπÂèçÂ∫èÂàóÂåñËøáÁ®ã‰∫ßÁîüÂΩ±Âìç„ÄÇ serialVersionUID ÊòØÁî®Êù•ËæÖÂä©Â∫èÂàóÂåñËøáÁ®ãÁöÑÔºåÂéüÂàô‰∏äÂ∫èÂàóÂåñÂêéÁöÑÊï∞ÊçÆ‰∏≠ÁöÑ serialVersionUID Âè™ÊúâÂíåÂΩìÂâçÁ±ªÁöÑ serialVersionUID Áõ∏ÂêåÊâçËÉΩÊ≠£Â∏∏Âú∞Ë¢´ÂèçÂ∫èÂàóÂåñ„ÄÇ serialVersionUID ÁöÑËØ¶ÁªÜÂ∑•‰ΩúÊú∫Âà∂Ôºö Â∫èÂàóÂåñÊòØÊääÂΩìÂâçÁ±ªÁöÑ serialVersionUID ÂÜôÂÖ•Â∫èÂàóÂåñÁöÑÊñá‰ª∂‰∏≠Ôºà‰πüÂèØËÉΩÊòØÂÖ∂‰ªñ‰∏≠‰ªãÔºâÂΩìÂèçÂ∫èÂàóÂåñÊó∂‰ºöÂéªÊ£ÄÊµãÊñá‰ª∂‰∏≠ÁöÑserialVersionUIDÔºåÁúãÂÆÉÊòØÂê¶ÂíåÂΩìÂâçÁ±ªÁöÑserialVersionUID‰∏ÄËá¥ÔºåÂ¶ÇÊûú‰∏ÄËá¥Â∞±ËØ¥ÊòéÂ∫èÂàóÂåñÁöÑÁâàÊú¨‰∏éÂΩìÂâçÁ±ªÁöÑÁâàÊú¨ÊòØÁõ∏ÂêåÁöÑÔºåËøôÊó∂ÂèØ‰ª•ÊàêÂäüÂèçÂ∫èÂàóÂåñ„ÄÇ Âê¶ÂàôËØ¥ÊòéÂΩìÂâçÁ±ªÂíåÂ∫èÂàóÂåñÁöÑÁ±ªÁõ∏ÊØîÂèëÁîü‰∫Ü Êüê‰∫õÂèòÂåñÔºå‰æãÂ¶ÇÔºöÊàêÂëòÂèòÈáèÁöÑÊï∞Èáè„ÄÅÁ±ªÂûãÂèØËÉΩÂèëÁîü‰∫ÜÊîπÂèòÔºåËøôÊó∂Êó†Ê≥ïÊ≠£Â∏∏Â∫èÂàóÂåñÔºå‰ºöÊä•Â¶Ç‰∏ãÈîôËØØÔºö1Exception in thread &quot;main&quot; java.io.InvalidClassException: projectname.clasname; local class incompatible: stream classdesc serialVersionUID = -6009442170907349114, local class serialVersionUID = 6529685098267757690 ‰∏ÄËà¨ËÄåË®ÄÔºåÊàë‰ª¨Â∫îËØ•ÊâãÂä®ÊåáÂÆö serialVersionUID ÁöÑÂÄºÔºåÊØîÂ¶Ç 1LÔºå‰πüÂèØ‰ª•ËÆ© Eclipse Ê†πÊçÆÂΩìÂâçÁ±ªÁöÑÁöÑÁªìÊûÑÂéªËá™Âä®ÁîüÊàêÂÆÉÁöÑ hash ÂÄºÔºåËøôÊ†∑Â∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÊó∂‰∏§ËÄÖÁöÑ serialVersionUIDÊòØÁõ∏ÂêåÁöÑÔºåÂèØ‰ª•Ê≠£Â∏∏ËøõË°åÂèçÂ∫èÂàóÂåñ„ÄÇ Â¶ÇÊûúÁ±ªÁöÑÁªìÊûÑÂèëÁîü‰∫ÜÊîπÂèòÔºåÊØîÂ¶ÇÂ¢ûÂä†/Âà†Èô§‰∫Ü Êüê‰∫õÊàêÂëòÂèòÈáèÔºåÈÇ£‰πàÁ≥ªÁªüÂ∞±‰ºöÈáçÊñ∞ËÆ°ÁÆóÂΩìÂâçÁ±ªÁöÑ hash ÂÄºÂπ∂ÊääÂÆÉËµãÂÄºÁªô serialVersionUID ÔºåËøô‰∏™Êó∂ÂÄôÂΩìÂâçÁ±ªÁöÑ serialVersionUID Â∞±‰ºöÂíåÂ∫èÂàóÂåñÊï∞ÊçÆ‰∏ç‰∏ÄËá¥Ôºå‰∫éÊòØÂèçÂ∫èÂàóÂåñÂ§±Ë¥•„ÄÇ Â¶ÇÊûúÊâãÂä®ÊåáÂÆö‰∫ÜserialVersionUID Â∞±‰∏ç‰ºöÊúâËøô‰∏™ÈóÆÈ¢ò„ÄÇ ‰ΩÜÊòØÂ¶ÇÊûúÁ±ªÁªìÊûÑÂèëÁîü‰∫Ü ==ÈùûÂ∏∏ËßÑÊÄßÊîπÂèò==ÔºåÊØîÂ¶Ç‰øÆÊîπ‰∫ÜÁ±ªÂêç„ÄÅ‰øÆÊîπ‰∫ÜÊàêÂëòÂèòÈáèÁ±ªÂûãÔºåËøô‰∏™Êó∂ÂÄôÂ∞ΩÁÆ° serialVersionUID È™åËØÅÈÄöËøá‰∫ÜÔºå‰ΩÜÊòØÂèçÂ∫èÂàóÂåñËøáÁ®ãËøòÊòØ‰ºöÂ§±Ë¥•ÔºåÂõ†‰∏∫Á±ªÁªìÊûÑÂèëÁîü‰∫ÜÊØÅÁÅ≠ÊÄßÂèòÂåñÔºåÊ†πÊú¨Êó†Ê≥ï‰ªéËÄÅÁâàÊú¨ÁöÑÊï∞ÊçÆ‰∏≠ËøòÂéüÂá∫‰∏Ä‰∏™Êñ∞ÁöÑÁ±ªÁªìÊûÑÁöÑÂØπË±°„ÄÇ Áªº‰∏äÔºåÁ±ªÁªìÊûÑ‰∏çÂèò‰∏îÁ±ªÁöÑÁâàÊú¨‰∏çÂèòÔºàÊ≤°ÊúâÂ¢ûÂä†ÊàñËÄÖÂà†Èô§ÊàêÂëòÂèòÈáèÔºâÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏çÊåáÂÆö serialVersionUID ÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑÔºå‰ΩÜÊòØ‰∏∫‰∫ÜÊèêÈ´òÁ®≥ÂÆöÊÄßÔºåËøòÊòØË¶ÅÊåáÂÆö„ÄÇ ‰∏§ÁÇπË¶ÅÊ≥®ÊÑèÁöÑÔºö ÈùôÊÄÅÊàêÂëòÂèòÈáèÂ±û‰∫éÁ±ª‰∏çÂ±û‰∫éÂØπË±°ÔºåÊâÄ‰ª•‰∏ç‰ºöÂèÇ‰∏éÂ∫èÂàóÂåñËøáÁ®ã„ÄÇ Áî® transient ÂÖ≥ÈîÆÂ≠óÊ†áËÆ∞ÁöÑ ÊàêÂëòÂèòÈáè‰∏çÂèÇ‰∏éÂ∫èÂàóÂåñËøáÁ®ã„ÄÇ Á≥ªÁªüÁöÑÈªòËÆ§Â∫èÂàóÂåñËøáÁ®ã‰πüÊòØÂèØ‰ª•ÊîπÂèòÁöÑ„ÄÇÂè™Ë¶ÅÈáçÊñ∞ÂÆûÁé∞ writeObject Âíå readObject ÊñπÊ≥ïÂç≥ÂèØ„ÄÇ Â¶Ç‰ΩïËøõË°åÂØπË±°ÁöÑÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÔºüÈááÁî® ObjectOutputStream ObjectInputStream Âç≥ÂèØËΩªÊùæÂÆûÁé∞„ÄÇ12345678User user = new User(name);ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(&quot;cache.txt&quot;));objectOutputStream.writeObject(user);objectOutputStream.close();ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(&quot;cache.txt&quot;));User newUser = objectInputStream.readObject();objectInputStream.close(); 3.2 ParcelableÊé•Âè£ÈÄöËøáÂÆûÁé∞ParcelableÊé•Âè£Â∫èÂàóÂåñÂØπË±°ÁöÑÊ≠•È™§Ôºö1„ÄÅÂ£∞ÊòéÂÆûÁé∞Êé•Âè£Parcelable2„ÄÅÂÆûÁé∞ParcelableÁöÑÊñπÊ≥ï writeToParcelÔºåÂ∞Ü‰Ω†ÁöÑÂØπË±°Â∫èÂàóÂåñ‰∏∫‰∏Ä‰∏™ParcelÂØπË±°3„ÄÅÂÆû‰æãÂåñÈùôÊÄÅÂÜÖÈÉ®ÂØπË±°CREATORÂÆûÁé∞Êé•Âè£Parcelable.Creator ÔºåÂÆûÁé∞ ÂèçÂ∫èÂàóÂåñ Parcelable ÁöÑÊñπÊ≥ïËØ¥Êòé ÊñπÊ≥ï ÂäüËÉΩ Ê†áËÆ∞‰Ωç createFromParcel ‰ªéÂ∫èÂàóÂåñÂêéÁöÑÂØπË±°‰∏≠ÂàõÂª∫ÂéüÂßãÂØπË±° newArray ÂàõÂª∫ÊåáÂÆöÈïøÂ∫¶ÁöÑÂéüÂßãÂØπË±°Êï∞ÁªÑ User(Parcel in) ‰ªéÂ∫èÂàóÂåñÂêéÁöÑÂØπË±°‰∏≠ÂàõÂª∫ÂéüÂßãÂØπË±° writeToParcel(Parcel dest, int flags) Â∞ÜÂΩìÂâçÁöÑÂØπË±°ÂÜôÂÖ•Â∫èÂàóÂåñÁªìÊûÑ‰∏≠ÔºåÂÖ∂‰∏≠ flags Ê†áËØÜÊúâ‰∏§ÁßçÂÄºÔºå0 ÊàñËÄÖ 1Ôºõ ‰∏∫ 1 Êó∂Ê†áËØÜÂΩìÂâçÂØπË±°ÈúÄË¶Å‰Ωú‰∏∫ËøîÂõûÂÄºËøîÂõûÔºå‰∏çËÉΩÁ´ãÂç≥ÈáäÊîæËµÑÊ∫êÔºåÂá†‰πéÊâÄÊúâÊÉÖÂÜµÈÉΩ‰∏∫ 0 PARCELABLE_WRITE_RETURN_VALUE describeContents ËøîÂõûÂΩìÂâçÂØπË±°ÁöÑÊèèËø∞Ôºå‰ªÖÂΩìÂΩìÂâçÂØπË±°‰∏≠Â≠òÂú® Êñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊâçËøîÂõû 1ÔºåÂá†‰πéÊâÄÊúâÊÉÖÂÜµÈÉΩËøîÂõû 0 CONTENT_FILE_DESCRIPTOR Êñ∞Âª∫‰∏Ä‰∏™Á±ªÔºåÂÆûÁé∞ Parcelable Êé•Âè£ÔºåÁÑ∂ÂêéÂÜôÂ•ΩÊàêÂëòÂèòÈáèÔºåÂÜç alt + enter Ëá™Âä®Ë°•ÂÖ®‰ª£Á†Å„ÄÇ123456789101112131415161718192021222324252627282930313233343536373839public class User implements Parcelable &#123; private String mName; private int mAge; private String mAddress; private Book mBook; protected User(Parcel in) &#123;//‰ªéÂ∫èÂàóÂåñÂêéÁöÑÂØπË±°‰∏≠ÂàõÂª∫ÂéüÂßãÂØπË±° mName = in.readString(); mAge = in.readInt(); mAddress = in.readString(); mBook = in.readParcelable(Book.class.getClassLoader());//Âõ†‰∏∫ book ‰πüÊòØ‰∏Ä‰∏™ÂèØÂ∫èÂàóÂåñÂØπË±°ÔºåÊâÄ‰ª•ÂÆÉÁöÑÂèçÂ∫èÂàóÂåñËøáÁ®ãÈúÄË¶Å‰º†ÈÄíÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏ä‰∏ãÊñá Á±ªÂä†ËΩΩÂô® &#125; @Override public void writeToParcel(Parcel dest, int flags) &#123;//Â∞ÜÂΩìÂâçÁöÑÂØπË±°ÂÜôÂÖ•Â∫èÂàóÂåñÁªìÊûÑ‰∏≠ÔºåÂÖ∂‰∏≠ flags Ê†áËØÜÊúâ‰∏§ÁßçÂÄºÔºå0 ÊàñËÄÖ 1Ôºõ ‰∏∫ 1 Êó∂Ê†áËØÜÂΩìÂâçÂØπË±°ÈúÄË¶Å‰Ωú‰∏∫ËøîÂõûÂÄºËøîÂõûÔºå‰∏çËÉΩÁ´ãÂç≥ÈáäÊîæËµÑÊ∫êÔºåÂá†‰πéÊâÄÊúâÊÉÖÂÜµÈÉΩ‰∏∫ 0 dest.writeString(mName); dest.writeInt(mAge); dest.writeString(mAddress); dest.writeParcelable(mBook, flags); &#125; @Override public int describeContents() &#123;//Â¶ÇÊó†ÁâπÊÆäÊÉÖÂÜµÔºåËøô‰∏™ÊñπÊ≥ïÈÉΩÊòØËøîÂõû 0Ôºå‰ªÖÂΩìÂΩìÂâçÂØπË±°‰∏≠Â≠òÂú® Êñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊâçËøîÂõû 1 return 0; &#125; //ÂèçÂ∫èÂàóÂåñ public static final Creator&lt;User&gt; CREATOR = new Creator&lt;User&gt;() &#123; @Override public User createFromParcel(Parcel in) &#123; return new User(in); &#125; @Override public User[] newArray(int size) &#123;//ÂàõÂª∫ÊåáÂÆöÈïøÂ∫¶ÁöÑÂéüÂßãÂØπË±°Êï∞ÁªÑ return new User[size]; &#125; &#125;;&#125; ÂØπÊØî Serializable ÊòØ Java ‰∏≠ÁöÑÂ∫èÂàóÂåñÊé•Âè£Ôºå‰ΩøÁî®Ëµ∑Êù•ÁÆÄÂçï‰ΩÜÊòØ==ÂºÄÈîÄÂæàÂ§ß==ÔºåÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÈúÄË¶ÅÂ§ßÈáèÁöÑ I/O Êìç‰Ωú„ÄÇ ËÄå Parcelable ÊòØ Android ‰∏≠Â∫èÂàóÂåñÊñπÂºèÔºåÊõ¥ÈÄÇÂêà‰ΩøÁî®Âú® Android Âπ≥Âè∞‰∏äÔºå==ÊïàÁéáÈ´ò==„ÄÇ Áº∫ÁÇπÔºö‰ΩøÁî®Ëµ∑Êù•È∫ªÁÉ¶„ÄÇ Parcelable ‰∏ªË¶ÅÁî®Âú®ÂÜÖÂ≠òÂ∫èÂàóÂåñ‰∏ä ÈÄöËøá Parcelable Â∞ÜÂØπË±°Â∫èÂàóÂåñÂà∞Â≠òÂÇ®ËÆæÂ§á‰∏≠ ÊàñËÄÖÂ∞ÜÂØπË±°Â∫èÂàóÂåñÂêéÂ≠òÂÇ®ÈÄöËøáÁΩëÁªú‰º†Ëæì‰πüÈÉΩÊòØÂèØ‰ª•ÁöÑÔºå‰ΩÜÊòØËøô‰∏™ËøáÁ®ã‰ºöÁ®çÊòæÂ§çÊùÇÔºåÂú®Ëøô‰∏§ÁßçÊÉÖÂÜµ‰∏ãÔºåÂª∫ËÆÆ‰ΩøÁî® Serializable Êé•Âè£„ÄÇ 3.3 BinderÁõ¥ËßÇÊù•ËØ¥ÔºåBinder ÊòØ Android ÁöÑ‰∏Ä‰∏™Á±ªÔºåÂÆÉÂÆûÁé∞‰∫Ü IBinder Êé•Âè£„ÄÇ ‰ªé IPC ËßíÂ∫¶Êù•ËØ¥Ôºå Binder ÊòØ Android ‰∏≠ÁöÑ‰∏ÄÁßçË∑®ËøõÁ®ãÈÄö‰ø°ÊñπÂºè Binder ËøòÂèØ‰ª•ÁêÜËß£‰∏∫‰∏ÄÁßçËôöÊãüÁöÑÁâ©ÁêÜËÆæÂ§áÔºåÂÆÉÁöÑËÆæÂ§áÈ©±Âä®ÊòØ /dev/binderÔºå ËØ•ÈÄö‰ø°ÊñπÂºèÂú® Linux ‰∏äÊ≤°Êúâ„ÄÇ ‰ªé Android FrameWork ËßíÂ∫¶Êù•ÁúãÔºå Binder ÊòØ ServiceManager ËøûÊé•ÂêÑÁßç Manager (ActivityManager„ÄÅ WindowManagerÔºå Á≠âÁ≠â)ÂíåÁõ∏Â∫îÁöÑ ManagerService ÁöÑÊ°•Ê¢Å ‰ªé Android Â∫îÁî®Â±Ç Êù•ËØ¥ÔºåBinder ÊòØÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Á´ØËøõË°åÈÄö‰ø°ÁöÑÂ™í‰ªãÔºåÂΩì bindService ÁöÑÊó∂ÂÄôÔºåÊúçÂä°Á´Ø‰ºöËøîÂõû‰∏Ä‰∏™ÂåÖÂê´‰∫ÜÊúçÂä°Á´Ø‰∏öÂä°Ë∞ÉÁî®ÁöÑ Binder ÂØπË±°ÔºåÈÄöËøáËøô‰∏™ Binder ÂØπË±°ÔºåÂÆ¢Êà∑Á´ØÂ∞±ÂèØ‰ª•Ëé∑ÂèñÊúçÂä°Á´ØÊèê‰æõÁöÑÊï∞ÊçÆÊàñÊúçÂä°ÔºàÂåÖÊã¨ÊôÆÈÄöÁöÑÊúçÂä° Âíå AIDLÊúçÂä°Ôºâ Android ÂºÄÂèë‰∏≠ÔºåBinder ‰∏ªË¶ÅÁî®Âú® Service ‰∏≠ÔºåÂåÖÊã¨ AIDL Âíå MessengerÔºå ÊôÆÈÄö Service ‰∏≠ÁöÑ Binder ‰∏çÊ∂âÂèäËøõÁ®ãÈó¥ÈÄö‰ø°ÔºåÊâÄ‰ª•ËæÉ‰∏∫ÁÆÄÂçïÔºåÊó†Ê≥ïÊ∂âÂèäÊ†∏ÂøÉ Messenger ÁöÑÂ∫ïÂ±ÇÂÖ∂ÂÆûÊòØ AIDL Á§∫‰æã‰∏≠ÔºåÁºñÂÜô‰ª£Á†ÅÊó∂ÔºåÊü•Êâæ aidl ÁîüÊàêÁöÑÊé•Âè£ÔºåProject ==„Äãapp==„Äãbuild ==„Äãsource==„Äãdebug==„Äãcom.xxx.xx.xx==„Äã ÁõÆÊ†áÁ±ª ==Ê≥®ÊÑè==ÔºöAIDL ÁöÑÁâπÊÆä‰πãÂ§ÑÔºöÂ∞ΩÁÆ°‰∏§‰∏™Á±ªÈÉΩ‰Ωç‰∫éÂêå‰∏Ä‰∏™ÂåÖ‰∏≠ÔºåËøòÊòØÈúÄË¶ÅÂØºÂÖ•Áõ∏Â∫îÁöÑÁ±ª„ÄÇ ==ÊâÄÊúâ==ÂèØ‰ª•Âú® Binder ‰∏≠‰º†ËæìÁöÑÊé•Âè£ÈÉΩÈúÄË¶ÅÁªßÊâøËá™ IInterface Êé•Âè£„ÄÇ Ê†óÂ≠ê123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150/* * This file is auto-generated. DO NOT MODIFY. * Original file: D:\\Android_RDC_project\\AndroidLearning\\app\\src\\main\\aidl\\com\\android\\rdc\\androidlearning\\IBookManager.aidl */package com.android.rdc.androidlearning;public interface IBookManager extends android.os.IInterface &#123; /** * Local-side IPC implementation stub class. */ public static abstract class Stub extends android.os.Binder implements com.android.rdc.androidlearning.IBookManager &#123; private static final java.lang.String DESCRIPTOR = "com.android.rdc.androidlearning.IBookManager";//Binder ÁöÑÂîØ‰∏ÄÊ†áËØÜÔºå‰∏ÄËà¨Áî®ÂΩìÂâç Binder ÁöÑÂÖ®Á±ªÂêçË°®Á§∫ /** * Construct the stub at attach it to the interface. */ public Stub() &#123; this.attachInterface(this, DESCRIPTOR); &#125; /** * Â∞ÜÔºàÊúçÂä°Á´ØÁöÑ Binder ÂØπË±°ÔºâËΩ¨Êç¢‰∏∫ÔºàÂÆ¢Êà∑Á´ØÊâÄÈúÄÁöÑ AIDL Á±ªÂûãÁöÑÂØπË±°Ôºâ * Ëã•ÊúçÂä°Á´Ø‰∏é ÂÆ¢Êà∑Á´ØÂ§ÑÂú®Âêå‰∏Ä‰∏™ËøõÁ®ãÔºåÂàôËøîÂõûÊúçÂä°Á´ØÁöÑ Stub ÂØπË±°Êú¨Ë∫´ * Âê¶ÂàôËøîÂõûÁ≥ªÁªüÂ∞ÅË£ÖÂêéÁöÑ Stub.Proxy * Cast an IBinder object into an com.android.rdc.androidlearning.IBookManager interface, * generating a proxy if needed. */ public static com.android.rdc.androidlearning.IBookManager asInterface(android.os.IBinder obj) &#123; if ((obj == null)) &#123; return null; &#125; android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR); if (((iin != null) &amp;&amp; (iin instanceof com.android.rdc.androidlearning.IBookManager))) &#123; return ((com.android.rdc.androidlearning.IBookManager) iin); &#125; return new com.android.rdc.androidlearning.IBookManager.Stub.Proxy(obj); &#125; /** * ËøîÂõûÂΩìÂâçÁöÑ Binder ÂØπË±° * */ @Override public android.os.IBinder asBinder() &#123; return this; &#125; /** * ËøêË°åÂú®„ÄéÊúçÂä°Á´Ø„ÄèÁöÑ Binder Á∫øÁ®ãÊ±†‰∏≠ÔºåÂÆ¢Êà∑Á´ØÂèëËµ∑ ÔºåÂΩìÂÆ¢Êà∑Á´ØÂèëËµ∑Ë∑®ËøõÁ®ãËØ∑Ê±ÇÊó∂ÔºåËøúÁ®ãËØ∑Ê±Ç‰ºöÈÄöËøáÁ≥ªÁªüÂ∫ïÂ±ÇÂ∞ÅË£ÖÂêé‰∫§Áî±Ê≠§ÊñπÊ≥ïÊù•Â§ÑÁêÜ * ÈÄöËøácode ÂèØ‰ª•Á°ÆÂÆöËØ∑Ê±ÇÁöÑÁõÆÊ†áÊñπÊ≥ï * ÔºàÂ¶ÇÊûúÁõÆÊ†áÊñπÊ≥ïÊúâÂèÇÊï∞ÁöÑËØùÔºâ ‰ªé data ‰∏≠ÂèñÂá∫ÁõÆÊ†áÊñπÊ≥ïÊâÄÈúÄÁöÑÂèÇÊï∞ÔºåÁÑ∂ÂêéÊâßË°å * ÂΩìÁõÆÊ†áÊñπÊ≥ïÊâßË°åÂÆåÊØïÂêéÔºåÔºàÂ¶ÇÊûúÊúâËøîÂõûÂÄºÁöÑËØùÔºâÂêë reply ‰∏≠ÂÜôÂÖ•ËøîÂõûÂÄº * Â¶ÇÊûú onTransact ËøîÂõû false ÔºåÈÇ£‰πàÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÂ§±Ë¥•„ÄÇÂõ†Ê≠§ÂèØ‰ª•Âà©Áî®Ëøô‰∏™ÁâπÊÄßÊù•ÂÅöÊùÉÈôêÈ™åËØÅ„ÄÇ * */ @Override public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; case INTERFACE_TRANSACTION: &#123; reply.writeString(DESCRIPTOR); return true; &#125; case TRANSACTION_getBookList: &#123; data.enforceInterface(DESCRIPTOR); java.util.List&lt;com.android.rdc.androidlearning.Book&gt; _result = this.getBookList(); reply.writeNoException(); reply.writeTypedList(_result); return true; &#125; case TRANSACTION_addBook: &#123; data.enforceInterface(DESCRIPTOR); com.android.rdc.androidlearning.Book _arg0; if ((0 != data.readInt())) &#123; _arg0 = com.android.rdc.androidlearning.Book.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.addBook(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags); &#125; private static class Proxy implements com.android.rdc.androidlearning.IBookManager &#123; private android.os.IBinder mRemote; Proxy(android.os.IBinder remote) &#123; mRemote = remote; &#125; @Override public android.os.IBinder asBinder() &#123; return mRemote; &#125; public java.lang.String getInterfaceDescriptor() &#123; return DESCRIPTOR; &#125; /** * Ê≠§ÊñπÊ≥ïËøêË°åÂú®„ÄéÂÆ¢Êà∑Á´Ø„Äè * */ @Override public java.util.List&lt;com.android.rdc.androidlearning.Book&gt; getBookList() throws android.os.RemoteException &#123; android.os.Parcel _data = android.os.Parcel.obtain(); android.os.Parcel _reply = android.os.Parcel.obtain(); java.util.List&lt;com.android.rdc.androidlearning.Book&gt; _result; try &#123; _data.writeInterfaceToken(DESCRIPTOR); mRemote.transact(Stub.TRANSACTION_getBookList, _data, _reply, 0);//Ë∞ÉÁî® transact ÂèëËµ∑ËøúÁ®ãËØ∑Ê±Ç„ÄÇÁÑ∂ÂêéÂΩìÂâçÁ∫øÁ®ãÊåÇËµ∑Ôºå _reply.readException();// RPC ËøáÁ®ãËøîÂõûÂêéÔºåÂΩìÂâçÁ∫øÁ®ãÁªßÁª≠ÊâßË°å _result = _reply.createTypedArrayList(com.android.rdc.androidlearning.Book.CREATOR); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; return _result; &#125; /** * ÊâßË°åËøáÁ®ã‰∏é getBookList ‰∏ÄÊ†∑Ôºå * */ @Override public void addBook(com.android.rdc.androidlearning.Book book) throws android.os.RemoteException &#123; android.os.Parcel _data = android.os.Parcel.obtain(); android.os.Parcel _reply = android.os.Parcel.obtain(); try &#123; _data.writeInterfaceToken(DESCRIPTOR); if ((book != null)) &#123; _data.writeInt(1); book.writeToParcel(_data, 0); &#125; else &#123; _data.writeInt(0); &#125; mRemote.transact(Stub.TRANSACTION_addBook, _data, _reply, 0); _reply.readException(); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; &#125; &#125; static final int TRANSACTION_getBookList = (android.os.IBinder.FIRST_CALL_TRANSACTION + 0); static final int TRANSACTION_addBook = (android.os.IBinder.FIRST_CALL_TRANSACTION + 1); &#125; public java.util.List&lt;com.android.rdc.androidlearning.Book&gt; getBookList() throws android.os.RemoteException; public void addBook(com.android.rdc.androidlearning.Book book) throws android.os.RemoteException;&#125; 4 Android‰∏≠ÁöÑIPCÊñπÂºè4.1 ‰ΩøÁî®BundleÂõõÂ§ßÁªÑ‰ª∂‰∏≠ÁöÑ‰∏âÂ§ßÁªÑ‰ª∂ÔºàActivity„ÄÅService„ÄÅReceiverÔºâÈÉΩÊòØÊîØÊåÅÂú® Intent ‰∏≠‰º†ÈÄí Bundle Êï∞ÊçÆÁöÑÔºåBundle ÂÆûÁé∞‰∫Ü Parcelable Êé•Âè£ÔºåÊâÄ‰ª•ÂÆÉÂèØ‰ª•Êñπ‰æøÂú∞Âú®‰∏çÂêåÁöÑËøõÁ®ãÈó¥ ‰º†Ëæì„ÄÇ Âõ†Ê≠§ÔºåÂΩìÊàë‰ª¨Âú®‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÂêØÂä®‰∫ÜÂè¶‰∏Ä‰∏™ËøõÁ®ãÁöÑ Activity„ÄÅService„ÄÅReceiverÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Âú® Bundle ‰∏≠ÈôÑÂä†Êàë‰ª¨ÈúÄË¶Å‰º†ËæìÁªôËøúÁ®ãËøõÁ®ãÁöÑ‰ø°ÊÅØÂπ∂ÈÄöËøá Intent ‰º†ÈÄíÂá∫Âéª„ÄÇ ÂΩìÁÑ∂Êàë‰ª¨ÊâÄ‰º†ËæìÁöÑÊï∞ÊçÆÂøÖÈ°ªËÉΩÂ§üË¢´Â∫èÂàóÂåñÔºåÂ¶ÇÔºö Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûã ÂÆûÁé∞‰∫Ü Parcelable Êé•Âè£ÁöÑÂØπË±°„ÄÇ ÂÆûÁé∞‰∫Ü Serialiable Êé•Âè£ÁöÑÂØπË±°„ÄÇ ‰∏Ä‰∫õ Android ÊîØÊåÅÁöÑÁâπÊÆäÂØπË±°„ÄÇ Charserquence StringArrayList IntegerArrayList Size ‚Ä¶ ÁâπÊÆäÁöÑ‰ΩøÁî®Âú∫ÊôØÔºöËøõÁ®ã A Ë¶ÅËøõË°åËÆ°ÁÆóÔºåÂπ∂Â∞ÜËÆ°ÁÆóÁªìÊûúÂèëÈÄÅÁªôËøõÁ®ã BÔºå‰ΩÜÊòØËØ•ËÆ°ÁÆóÁªìÊûú‰∏çÊîØÊåÅÊîæÂÖ• Bundle ‰∏≠„ÄÇ Ëß£ÂÜ≥ÔºöÂú® A ‰∏≠ÔºåÈÄöËøá Intent Êù•ÂêØÂä®Á∫øÁ®ã B ÁöÑ‰∏Ä‰∏™ Service ÁªÑ‰ª∂ÔºàÊØîÂ¶Ç IntentServiceÔºâÔºåËÆ© Service Âú®ÂêéÂè∞ËÆ°ÁÆóÔºåËÆ°ÁÆóÂÆå‰ª•ÂêéÂÜçÂêØÂä® B ËøõÁ®ã‰∏≠ÊÉ≥Ë¶ÅÂêØÂä®ÁöÑÁõÆÊ†áÁªÑ‰ª∂„ÄÇ Ê†∏ÂøÉÊÄùÊÉ≥ÔºöÂ∞ÜÂéüÊú¨ÈúÄË¶ÅÂú® A ËøõÁ®ãÁöÑËÆ°ÁÆó‰ªªÂä°ËΩ¨ÁßªÂà∞ B ËøõÁ®ãÁöÑÊúçÂä°‰∏≠ÔºåËøôÊ†∑Â∞±ÈÅøÂÖç‰∫ÜËøõÁ®ãÈó¥ÈÄö‰ø°ÁöÑÈóÆÈ¢òÔºåËÄå‰∏î‰ª£‰ª∑‰πü‰∏çÂ§ß„ÄÇ 4.2 ‰ΩøÁî®Êñá‰ª∂ÂÖ±‰∫´‰∏§‰∏™ËøõÁ®ãÈÄöËøáËØª/ÂÜôÂêå‰∏Ä‰∏™Êñá‰ª∂‰∫§Êç¢Êï∞ÊçÆ„ÄÇ ÊØîÂ¶ÇÔºåËøõÁ®ã A ÂÜôÂÖ•ÔºåËøõÁ®ã B ËØªÂèñ„ÄÇ ËÉåÊôØÁü•ËØÜÔºö Window ‰∏äÔºå‰∏Ä‰∏™Êñá‰ª∂Â¶ÇÊûúË¢´Âä†‰∫ÜÊéíÊñ•ÈîÅÂ∞Ü‰ºöÂØºËá¥ÂÖ∂‰ªñÁ∫øÁ®ãÊó†Ê≥ïÂØπÂÖ∂ËøõË°åËÆøÈóÆÔºàÂåÖÊã¨ËØªÂíåÂÜôÔºâ„ÄÇ Android Âü∫‰∫é LinuxÔºåÂÖ∂ËØª/ÂÜôÊñá‰ª∂ÂèØ‰ª•Êó†ÈôêÂà∂Âú∞ËøõË°åÔºåÁîöËá≥‰∏§‰∏™Á∫øÁ®ãÂØπÂêå‰∏Ä‰∏™Êñá‰ª∂Âπ∂Ë°åÂÜô‰πüÊòØÂÖÅËÆ∏ÁöÑ„ÄÇÔºàÂ∞ΩÁÆ°ËøôÂèØËÉΩ‰ºöÂá∫Áé∞‰∏Ä‰∫õÈóÆÈ¢òÔºâ Â∫îÁî®Ôºö Â∫èÂàóÂåñ‰∏Ä‰∏™ÂØπË±°Âà∞Êñá‰ª∂Á≥ªÁªü‰∏≠ÁöÑÂêåÊó∂Ôºå‰ªéÂè¶‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÊÅ¢Â§çËøô‰∏™ÂØπË±°„ÄÇ Âè¶‰∏Ä‰∏™ËøõÁ®ãÊàêÂäüÂú∞ÊÅ¢Â§ç‰πãÂâçÂ≠òÂÇ®ÁöÑÂØπË±°ÁöÑÂÜÖÂÆπÔºå‰ΩÜÊòØ‰ªñ‰ª¨Êú¨Ë¥®ËøòÊòØ‰∏§‰∏™ÂØπË±°„ÄÇ ÂèØËÉΩÂ≠òÂú®ÁöÑÈóÆÈ¢òÔºöÂπ∂ÂèëËØª/ÂÜôÔºåËØªÂá∫ÁöÑÂÜÖÂÆπÂèØËÉΩ‰∏çÊòØÊúÄÊñ∞ÁöÑ„ÄÇ Ëß£ÂÜ≥Ôºö ËÆæÊ≥ïÈÅøÂÖç ËÄÉËôë‰ΩøÁî®Á∫øÁ®ãÂêåÊ≠•Êù•ÈôêÂà∂ÔºåÂ§ö‰∏™Á∫øÁ®ãÁöÑÂÜôÊìç‰Ωú„ÄÇ Êñá‰ª∂ÂÖ±‰∫´ÈÄÇÂêàÂØπÊï∞ÊçÆÂêåÊ≠•Ë¶ÅÊ±Ç‰∏çÈ´òÁöÑËøõÁ®ã‰πãÈó¥ËøõË°åÈÄö‰ø°„ÄÇ SharepreferenceSharePreference ÊòØ‰∏™Áâπ‰æã Â∫ïÂ±ÇÈÄöËøá xml Êñá‰ª∂ÁöÑÊñπÂºèÊù•Â≠òÂÇ®ÈîÆÂÄºÂØπÔºåÔºå‰∏ÄËà¨ËÄåË®ÄÔºåÂÆÉ‰Ωç‰∫é /data/data/ÂΩìÂâçÂ∫îÁî®ÁöÑÂåÖÂêç/share_prefs ÁõÆÂΩï‰∏ãÔºå Áî±‰∫éÁ≥ªÁªüÂØπ SharePreference ÁöÑËØªÂÜôÊìç‰ΩúÊúâ‰∏ÄÂÆöÁöÑÁºìÂ≠òÁ≠ñÁï•ÔºåÂç≥Âú®ÂÜÖÂ≠ò*Êúâ‰∏Ä‰ªΩ SharePreferce ÁöÑÁºìÂ≠ò„ÄÇÂú®Â§öËøõÁ®ãÊ®°Âºè‰∏ãÔºåÁ≥ªÁªüÂØπÂÆÉÁöÑËØªÂÜôÊìç‰ΩúÂ∞±ÂèòÂæó‰∏çÂèØÈù†„ÄÇÈ´òÂπ∂ÂèëÁä∂ÊÄÅ‰∏ãÔºåSharePreference ÂæàÂ§ßÂá†Áéá‰ºö‰∏¢Â§±Êï∞ÊçÆ„ÄÇ ‰∏çÂª∫ËÆÆÂú®ËøõÁ®ãÈó¥ÈÄö‰ø°‰ΩøÁî® SharePreference 4.3 ‰ΩøÁî®Messenger„Äé‰ø°‰Ωø„ÄèÈÄöËøáÂÆÉÂèØ‰ª•Âú®‰∏çÂêåËøõÁ®ã‰∏≠‰º†ÈÄí Message ÂØπË±°ÔºåÂú® Message ‰∏≠ÊîæÂÖ•Êàë‰ª¨ÈúÄË¶Å‰º†ÈÄíÁöÑÊï∞ÊçÆÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞ËøõÁ®ãÈó¥ÁöÑÊï∞ÊçÆ‰º†ÈÄí‰∫Ü„ÄÇ Messenger ‰∏ÄÊ¨°Â§ÑÁêÜ‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÊâÄ‰ª•ÊúçÂä°Á´Ø‰∏çÁî®ËÄÉËôëÁ∫øÁ®ãÂêåÊ≠•ÁöÑÈóÆÈ¢òÔºàÂõ†‰∏∫‰∏çÂ≠òÂú®Âπ∂ÂèëÊâßË°åÁöÑÊÉÖÂΩ¢Ôºâ„ÄÇ 1. ÊúçÂä°Á´ØËøõÁ®ãÂÆ¢Êà∑Á´ØËøõÁ®ãÂú® Messager ‰∏≠ËøõË°åÊï∞ÊçÆ‰º†ÈÄíÂøÖÈ°ªÂ∞ÜÊï∞ÊçÆÊîæÂÖ• Messenger ‰∏≠Ôºå Message ‰∏≠ÊîØÊåÅÊï∞ÊçÆÁ±ªÂûãÂ∞±ÊòØ Messenger ÊâÄÊîØÊåÅÁöÑ‰º†ËæìÁ±ªÂûã Message ‰∏≠ÊâÄËÉΩ‰ΩøÁî®ÁöÑËΩΩ‰ΩìÂè™Êúâ int what; int ar1 int arg2 Messenger replyTo Object obj 2 ‰πãÂâç obj Â≠óÊÆµ‰∏çÊîØÊåÅË∑®ËøõÁ®ã‰º†Ëæì 2 ‰πãÂêé obj ‰πü‰ªÖÁ≥ªÁªüÊèê‰æõÁöÑÂÆûÁé∞ Parcelable Êé•Âè£ÁöÑÁöÑÂØπË±° Âç≥ FrameWork class Bundle ËøòÂ•ΩÊàë‰ª¨Êúâ Bundle ÔºåÊîØÊåÅÊØîËæÉÂ§öÁöÑÊï∞ÊçÆÁ±ªÂûã Â¶ÇÊûúË¶ÅËÆ©„ÄéÊúçÂä°Á´Ø„ÄèËÉΩÂ§üÂõûÂ§ç‰ø°ÊÅØ„ÄÇ ÈÇ£‰πàÂΩìÂÆ¢Êà∑Á´ØÂèëÈÄÅÊ∂àÊÅØÁöÑÊó∂ÂÄôÔºåÈúÄË¶ÅÊää Êé•Êî∂ÊúçÂä°Á´ØÂõûÂ§çÁöÑ Messenger ÈÄöËøá Message ÁöÑ replyTo ÂèÇÊï∞‰º†ÈÄíÁªôÊúçÂä°Á´Ø„ÄÇ4.4 ‰ΩøÁî®AIDL Android Êé•Âè£ÂÆö‰πâËØ≠Ë®Ä(Android Interface Definition Language) Messenger Âè™ËÉΩ‰º†ÈÄíÊ∂àÊÅØÔºå‰∏çËÉΩË∑®ËøõÁ®ãË∞ÉÁî®ÊñπÊ≥ï„ÄÇËÄå‰∏îÂè™ËÉΩ‰∏≤Ë°åÂ§ÑÁêÜÂÆ¢Êà∑Á´ØÂèëÊù•ÁöÑËØ∑Ê±Ç„ÄÇ ËôΩÁÑ∂ÂÆÉÂ∫ïÂ±Ç‰πüÊòØ‰ΩøÁî® AIDL ÂÆûÁé∞ÁöÑ„ÄÇ ÂèØ‰ª•‰ΩøÁî® AIDL Êù•ÂÆûÁé∞Ë∑®ËøõÁ®ãÁöÑÊñπÊ≥ïË∞ÉÁî®„ÄÇ aidl Êñá‰ª∂ÁöÑ‰ΩúÁî®ÊòØ sdk Ê†πÊçÆÂÆÉÊù•ÁîüÊàêÁõ∏Â∫îÁöÑ java ‰ª£Á†ÅÔºå‰πüÂ∞±ÊòØÂú®ÁºñËØëÊó∂ÊúâÁî®ÔºåÂú®ÁºñËØëÂÆå‰πãÂêéÔºåÂç≥‰ΩøÂà†Èô§Êéâ aidl Êñá‰ª∂Ôºå‰πüÊòØÂèØ‰ª•ÁöÑÔºå‰ΩÜÊòØËøôÊ†∑ÁöÑËØùÂ¶ÇÊûúÈáçÊñ∞ÁºñËØëÂ∞±Ê≤°Ê≥ïÁîüÊàê java ‰ª£Á†Å‰∫Ü„ÄÇ Â∞ÜÁºñÂÜôÁöÑ .aidl Êñá‰ª∂‰øùÂ≠òÂú®È°πÁõÆÁöÑ src/ ÁõÆÂΩïÂÜÖÔºåÂΩì‰Ω†ÂºÄÂèëÂ∫îÁî®Êó∂ÔºåSDK Â∑•ÂÖ∑‰ºöÂú®È°πÁõÆÁöÑ gen/ ÁõÆÂΩï‰∏≠ÁîüÊàê IBinder Êé•Âè£Êñá‰ª∂„ÄÇÁîüÊàêÁöÑÊñá‰ª∂Âêç‰∏é .aidl Êñá‰ª∂Âêç‰∏ÄËá¥ÔºåÂè™ÊòØ‰ΩøÁî®‰∫Ü .java Êâ©Â±ïÂêçÔºà‰æãÂ¶ÇÔºåIRemoteService.aidl ÁîüÊàêÁöÑÊñá‰ª∂ÂêçÊòØ IRemoteService.javaÔºâ„ÄÇ Â¶ÇÊûú‰ΩøÁî® Android StudioÔºåÂ¢ûÈáèÁºñËØëÂá†‰πé‰ºöÁ´ãÂç≥ÁîüÊàê Binder Á±ª„ÄÇ Â¶ÇÊûú‰∏çÊòØ‰ΩøÁî® Android StudioÔºåÂàô Gradle Â∑•ÂÖ∑‰ºöÂú®‰∏ã‰∏ÄÊ¨°ÂºÄÂèëÂ∫îÁî®Êó∂ÁîüÊàê Binder Á±ª ÈÄöÂ∏∏Â∫îËØ•Âú®ÁºñÂÜôÂÆå .aidl Êñá‰ª∂ÂêéÁ´ãÂç≥Áî® gradle assembleDebug ÔºàÊàñ gradle assembleReleaseÔºâÁºñËØëÈ°πÁõÆÔºå‰ª•‰æøÊÇ®ÁöÑ‰ª£Á†ÅËÉΩÂ§üÈìæÊé•Âà∞ÁîüÊàêÁöÑÁ±ª„ÄÇ 1. ÊúçÂä°Á´ØÁî®‰∏Ä‰∏™ Service Êù•ÁõëÂê¨ÂÆ¢Êà∑ÁöÑËøûÊé•ËØ∑Ê±ÇÔºåÂàõÂª∫‰∏Ä‰∏™ AIDL Êñá‰ª∂ÔºåÂ∞ÜÊö¥Èú≤ÁªôÂÆ¢Êà∑Á´ØÁöÑÊé•Âè£Âú®Ëøô‰∏™ AIDL Êñá‰ª∂‰∏≠Â£∞ÊòéÔºåÊúÄÂêéÂú® Service ÂÆûÁé∞ËØ•Êé•Âè£„ÄÇ 2. ÂÆ¢Êà∑Á´Ø ÁªëÂÆöÊúçÂä°Á´Ø ServiceÔºå ÁªëÂÆöÊàêÂäüÂêéÂ∞ÜÊúçÂä°Á´ØËøîÂõûÁöÑ IBinder ËΩ¨Âåñ‰∏∫ AIDL Êé•Âè£ÊâÄÂ±ûÁöÑÁ±ªÂûã Ê≥®ÊÑè‰∏çÊòØÂπ≥Êó∂ÈÇ£Ê†∑Âº∫ËΩ¨ÔºåËÄåÊòØ IBookManager.Stub.asInterface(iBinder); Êé•ÁùÄÂ∞±ÂèØ‰ª•‰ΩøÁî® AIDL ‰∏≠ÁöÑÊñπÊ≥ï‰∫Ü„ÄÇ AIDL ÊîØÊåÅÁöÑÊï∞ÊçÆÁ±ªÂûãÔºö Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûã CharSequence List Âè™ÊîØÊåÅ ArrayList Map Âè™ÊîØÊåÅ HashMap Parcelable AIDLÔºöAIDL Êé•Âè£Êú¨Ë∫´‰πüÂèØ‰ª•Âú® AIDL Êñá‰ª∂‰∏≠‰ΩøÁî® AIDL ‰∏≠Êó†Ê≥ï‰ΩøÁî®ÊôÆÈÄöÁöÑÊé•Âè£ Ê≥®ÊÑèÔºö Ëá™ÂÆö‰πâÁöÑ ParcelableÂØπË±°‰∏ÄÂÆöË¶ÅÊòæÂºèÂú∞ import ËøõÊù•„ÄÇÔºà‰∏çÁÆ°ÂÆÉ‰ª¨ÊòØÂê¶‰∏éÂΩìÂâçÁöÑ AIDL Êñá‰ª∂‰Ωç‰∫éÂêå‰∏Ä‰∏™ÂåÖ‰∏≠Ôºâ Â¶ÇÊûú AIDL Êñá‰ª∂‰∏≠Áî®Âà∞‰∫ÜËá™ÂÆö‰πâÁöÑ Parcelable ÂØπË±°ÔºåÂøÖÈ°ª‰ΩøÁî®Êñ∞Âª∫‰∏Ä‰∏™ÂíåÂÆÉÂêåÂêçÁöÑ aidl Êñá‰ª∂ÔºåÂπ∂Âú®ÂÖ∂‰∏≠Â£∞ÊòéÂÆÉ‰∏∫ parcelable Á±ªÂûã Â¶Ç Book.java Book.aidl Ë¶ÅÂú®ÂÖ∂‰∏≠Â£∞Êòé pacelable Book; Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûã‰ª•Â§ñÁöÑÂèÇÊï∞ÈúÄË¶Å==Ê†á‰∏äÊñπÂêë== in ËæìÂÖ•ÂûãÂèÇÊï∞ÔºåÁ±ª‰ºº‰∫éÊôÆÈÄöÊñπÊ≥ïÁöÑÂèÇÊï∞ out ËæìÂá∫ÂûãÂèÇÊï∞Ôºå Á±ª‰ºº‰∫éËøîÂõûÂÄº inout ËæìÂÖ•ËæìÂÖ•ÂûãÂèÇÊï∞ ÊâÄ‰ª•ËØ¥ÔºåËæìÂÖ•ËæìÂá∫ÊòØÈíàÂØπËøô‰∏™ÊñπÊ≥ïËÄåË®ÄÁöÑÔºåËÄå‰∏çÊòØ C/S ÁªìÊûÑ‰∏≠ÁöÑËæìÂÖ•/ËæìÂá∫„ÄÇ AIDL Êé•Âè£‰∏≠Âè™ÊîØÊåÅÊñπÊ≥ïÔºå‰∏çÊîØÊåÅÂ£∞ÊòéÈùôÊÄÅÂèòÈáèÔºà==Ë∑ü‰º†ÁªüÁöÑÊé•Âè£ÊúâÂå∫Âà´==Ôºâ AIDL ÂåÖÁªìÊûÑÂú®ÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Á´ØË¶Å‰øùÊåÅ‰∏ÄËá¥ÔºåÂê¶ÂàôËøêË°å‰ºöÂá∫Èîô„ÄÇ Âõ†‰∏∫ÂÆ¢Êà∑Á´ØÈúÄË¶ÅÂèçÂ∫èÂàóÂåñÊúçÂä°Á´Ø‰∏≠Âíå aidl Êé•Âè£Áõ∏ÂÖ≥ÁöÑÁ±ª„ÄÇ AIDL Êé•Âè£‰∏≠ÊâÄÊîØÊåÅÁöÑÊòØÊäΩË±°ÁöÑ List ÔºåËÄå List Âè™ÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåËôΩÁÑ∂ÊúçÂä°Á´Ø‰ΩøÁî® CopyOnWriteArrayList ,‰ΩÜÊòØÂú® Binder ‰∏≠‰ºöÊåâÁÖß List ÁöÑËßÑËåÉÂéªËÆøÈóÆÊï∞ÊçÆÂπ∂ÊúÄÁªàÂΩ¢Êàê‰∏Ä‰∏™ ArrayList ‰º†ÈÄíÁªôÂÆ¢Êà∑Á´Ø„ÄÇ ConcurrentHashMap ÂêåÁêÜ Âú®ÊúçÂä°Á´ØË∞ÉÁî®ÂÆ¢Êà∑Á´ØÔºàÊ≥®ÂÜåÊó∂ÁöÑ‰ΩøÁî®ÁöÑÊé•Âè£‰∏≠)ÁöÑÊñπÊ≥ïÔºåÂú®ÂÆ¢Êà∑Á´ØÁöÑ Binder Á∫øÁ®ãÊ±†‰∏≠ÊâßË°å„ÄÇ ÂØπË±°ÊòØ‰∏çËÉΩÁõ¥Êé•Ë∑®ËøõÁ®ã‰º†ËæìÁöÑÔºåÂØπË±°ÁöÑË∑®ËøõÁ®ã‰º†ËæìÊú¨Ë¥®‰∏äÈÉΩÊòØÂèçÂ∫èÂàóÂåñËøáÁ®ã RemoteCallBackList ÊòØÁ≥ªÁªü‰∏ìÈó®Áî®Êù•ÂèëÂà†Èô§Ë∑®ËøõÁ®ãÁöÑ listener ÁöÑÊé•Âè£„ÄÇ ÂÆÉÊòØ‰∏Ä‰∏™Ê≥õÂûãÔºåÊîØÊåÅÁÆ°ÁêÜ‰ªªÊÑèÁöÑ AIDL Êé•Âè£ public class RemoteCallBackList&lt;E extends IInterface&gt; ÂΩìÂÆ¢Êà∑Á´ØËøõÁ®ãÁªàÊ≠¢‰πãÂêéÔºå RemoteCallBackList ËÉΩÂ§üËá™Âä®Ê∫¢Âá∫ÂÆ¢Êà∑Á´ØÊâÄÊ≥®ÂÜåÁöÑ listener ÂÖ∂ÂÜÖÈÉ®Êúâ‰∏Ä‰∏™ ArrayMap&lt;IBinder,CallBack&gt;Áî®Êù•‰∏ìÈó®‰øùÂ≠òÊâÄÊúâÁöÑ AIDL ÂõûË∞É CallBack Â∞ÅË£Ö‰∫ÜÁúüÊ≠£ÁöÑËøúÁ®ã listener„ÄÇÂΩìÂÆ¢Êà∑Á´ØÊ≥®ÂÜå listener ÁöÑÊó∂ÂÄôÔºå‰ºöÂ∞ÜÂÖ∂‰∏≠ÁöÑ‰ø°ÊÅØÂ≠òÂÖ• mCallBack ‰∏≠12IBinder key = listener.asBinder();callBack value = new Callback(listener,cookie); Â§öÊ¨°Ë∑®ËøõÁ®ã‰º†ËæìÂÆ¢Êà∑Á´ØÁöÑÂêå‰∏Ä‰∏™ÂØπË±°‰ºöÂú®ÊúçÂä°Á´ØÁîüÊàê‰∏çÂêåÁöÑÂØπË±°Ôºå‰ΩÜÊòØËøô‰∫õÊñ∞ÁîüÊàêÁöÑÂØπË±°Êúâ‰∏Ä‰∏™ ÂÖ±ÂêåÁÇπÔºåÈÇ£Â∞±ÊòØ==ÂÆÉ‰ª¨Â∫ïÂ±ÇÁöÑ Binder ÂØπË±°ÊòØÂêå‰∏Ä‰∏™== ==Ê≥®ÊÑè==: RemoteCallBackList ‰ΩøÁî®ÊñπÂºèÊØîËæÉÁâπÂà´„ÄÇÂπ∂‰∏çÂÉè list ÈÇ£Ê†∑ beginBroadcast() finishBroadcast() Ëøô‰∏§‰∏™ÊñπÊ≥ï==‰∏ÄÂÆöË¶ÅÈÖçÂØπ‰ΩøÁî®== getBroadcastItem()12345678final int N = mCallBackList.beginBroadcast();for (int i = 0; i &lt; N; i++) &#123; IOnNewBookArrivedListener l = mCallBackList.getBroadcastItem(i); if (l != null) &#123; l.onNewBookArrived(book); &#125;&#125;mCallBackList.finishBroadcast(); ÂÆ¢Êà∑Á´ØÁöÑ onServiceConnected Âíå onServiceDisconnected(ComponentName name)ÈÉΩÊâßË°åÂú® UI Á∫øÁ®ã‰∏≠Ôºå‰∏çÂèØ‰ª•Âú®ÈáåÈù¢Ë∞ÉÁî®ÊúçÂä°Á´ØËÄóÊó∂ÁöÑÊñπÊ≥ï„ÄÇ ÊúçÂä°Á´ØÊñπÊ≥ïÊú¨Ë∫´ËøêË°åÂú®ÊúçÂä°Á´ØÁöÑ Binder Á∫øÁ®ãÊ±†‰∏≠ÔºåÊâÄ‰ª•ÊúçÂä°Á´ØÊñπÊ≥ïÊú¨Ë∫´Âç≥ÂèØÊâßË°åÂ§ßÈáèËÄóÊó∂Êìç‰Ωú„ÄÇ ‰∏çË¶ÅÂú®ÊúçÂä°Á´ØÊñπÊ≥ï‰∏≠ÂºÄÁ∫øÁ®ãÂéªÊâßË°åÂºÇÊ≠•‰ªªÂä°„ÄÇ ÊúçÂä°Á´Ø‰πüÊúâÂèØËÉΩËøêË°åÂú® UI Á∫øÁ®ãÔºåËøôÊó∂Ë¶ÅÂ∞ΩÈáèÈÅøÂÖçË∞ÉÁî®ËÄóÊó∂ÊñπÊ≥ï„ÄÇ Binder Ê≠ª‰∫°Âêé ËøõÁ®ãÁ©∫Èó¥ÂàÜ‰∏∫Áî®Êà∑Á©∫Èó¥ÂíåÂÜÖÊ†∏Á©∫Èó¥ Áî®Êà∑Á©∫Èó¥ÔºåÊï∞ÊçÆ‰∫íÁõ∏ÈöîÁ¶ª ÂÜÖÊ†∏Á©∫Èó¥ Êï∞ÊçÆÂÖ±‰∫´ ÈÄöËøáÂÜÖÊ†∏ ÂÆûÁé∞Ë∑®ËøõÁ®ãË∞ÉÁî® ËøõÁ®ã A Ë∞ÉÁî®ËøõÁ®ã B ÁöÑÂáΩÊï∞ Áü•ÈÅìË∞ÉÁî®ÁöÑÊòØÂì™‰∏Ä‰∏™ÂØπË±°ÁöÑÂì™‰∏Ä‰∏™ÊñπÊ≥ï ‰º†ÈÄíÊñπÊ≥ïÂèÇÊï∞ ËøõÁ®ã B ÊâßË°åÂÆå‰πãÂêéÔºåËøîÂõûÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªôËøõÁ®ã A„ÄÇ Êú¨Ë¥®‰∏äÂ∞±ÊòØ Êï∞ÊçÆÁöÑ‰º†ÈÄí„ÄÇ ÂÆ¢Êà∑Á´ØË∞ÉÁî®ÁöÑËøõÁ®ã Binder ÂØπË±°ÁöÑÂºïÁî®Ôºà‰∏Ä‰∏™‰ª£ÁêÜÔºâÔºåÂÆûÈôÖÊâßË°åËøòÊòØÂú®ÊúçÂä°Á´ØÁöÑ„ÄÇ Client ËøõÁ®ãÁöÑÁöÑÊìç‰ΩúÂÆûÈôÖ‰∏äÂØπ‰ª£ÁêÜÂØπË±°ÁöÑÊìç‰ΩúÔºå‰ª£ÁêÜÂØπË±°Âà©Áî® Binder È©±Âä®ÊâæÂà∞ÁúüÊ≠£ÁöÑ BinderÂØπË±°ÔºåÂπ∂ÈÄöÁü• Server ËøõÁ®ãÂÆåÊàêÊìç‰Ωú„ÄÇ ÈááÁî®ÁöÑÊòØ C/S ÁöÑÊû∂ÊûÑ„ÄÇ 4.5 ‰ΩøÁî®ContentProviderÂæÖË°•ÂÖÖ 4.6 ‰ΩøÁî®SocketÂæÖË°•ÂÖÖ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê „ÄäAndroidÂºÄÂèëËâ∫ÊúØÊé¢Á¥¢„Äã Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫ê„ÄÇË∞¢Ë∞¢ÔºÅ ##]]></content>
      <categories>
        <category>Android ËøõÈò∂</category>
        <category>IPC</category>
      </categories>
      <tags>
        <tag>Android ËøõÈò∂</tag>
        <tag>IPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Service ÂÖ®Èù¢ÊÄªÁªì]]></title>
    <url>%2Fblog%2F2017%2F05%2F03%2FService-%E5%85%A8%E9%9D%A2%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[Service ÊòØ‰∏ÄÁßçËÆ°ÁÆóÂûãÁöÑÁªÑ‰ª∂„ÄÇ ‰∏Ä„ÄÅ‰ΩøÁî®Âú∫ÊôØÁ∫øÁ®ãËøòÊòØÊúçÂä°ÔºüÁÆÄÂçïÂú∞ËØ¥ÔºåÊúçÂä°ÊòØ‰∏ÄÁßç‰∏çÈúÄË¶ÅÁî®Êà∑‰∫§‰∫í‰πüÂèØÂú®ÂêéÂè∞ËøêË°åÁöÑÁªÑ‰ª∂„ÄÇ Âõ†Ê≠§ÔºåÊàë‰ª¨Â∫îËØ•‰ªÖÂú®ÂøÖË¶ÅÊó∂ÊâçÂàõÂª∫ÊúçÂä°„ÄÇ Â¶ÇÈúÄÂú®‰∏ªÁ∫øÁ®ãÂ§ñÈÉ®Ôºà‰πüÂ∞±ÊòØÂ∑•‰ΩúÁ∫øÁ®ãÔºâÊâßË°åÂ∑•‰ΩúÔºåÂπ∂‰∏îÂè™ÊòØÂú®Áî®Êà∑Ê≠£Âú®‰∏éÂ∫îÁî®‰∫§‰∫íÊó∂ÊâçÊúâÊ≠§ÈúÄË¶ÅÔºåÂàôÂ∫îÂàõÂª∫Êñ∞Á∫øÁ®ãËÄåÈùûÊúçÂä°„ÄÇ Â¶ÇÊûúÁ°ÆÂÆûË¶Å‰ΩøÁî®ÊúçÂä°ÔºåÂàôÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÆÉ‰ªç‰ºöÂú®Â∫îÁî®ÁöÑ‰∏ªÁ∫øÁ®ã‰∏≠ËøêË°åÔºåÂõ†Ê≠§ÔºåÂ¶ÇÊûúÊúçÂä°ÊâßË°åÁöÑÊòØÂØÜÈõÜÂûãÊàñÈòªÂ°ûÊÄßÊìç‰ΩúÔºåÈÇ£‰πàÂ∫îËØ•Âú®ÊúçÂä°ÂÜÖÂàõÂª∫Êñ∞Á∫øÁ®ã„ÄÇ Ê≥®ÊÑèÔºöÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÊúçÂä°‰∏éÊúçÂä°Â£∞ÊòéÊâÄÂú®ÁöÑÂ∫îÁî®ËøêË°å‰∫éÂêå‰∏ÄËøõÁ®ãÔºåËÄå‰∏îËøêË°å‰∫éËØ•Â∫îÁî®ÁöÑ‰∏ªÁ∫øÁ®ã‰∏≠„ÄÇ‰∏∫‰∫ÜÈÅøÂÖçÂΩ±ÂìçÂ∫îÁî®ÊÄßËÉΩÔºåÊÇ®Â∫îÂú®ÊúçÂä°ÂÜÖÂêØÂä®Êñ∞Á∫øÁ®ã„ÄÇ Âõ†‰∏∫ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÆÉ‰ºöÂú®Â∫îÁî®‰∏çÁÆ°ÊòØÂê¶Áî®ÊúçÂä°ÔºåËÄóÊó∂ÁöÑÊìç‰ΩúÈÉΩÊòØÈúÄË¶ÅÂè¶Â§ñËµ∑‰∏Ä‰∏™Á∫øÁ®ãÁöÑ„ÄÇ ‰ªéÊ¶ÇÂøµ‰∏äÁúãÔºåÊúçÂä°ÊòØ‰∏Ä‰∏™ÁªÑ‰ª∂ÔºåÁ∫øÁ®ãÊòØÊìç‰ΩúÁ≥ªÁªüÁöÑÊúÄÂ∞èÊâßË°åÂçï‰Ωç„ÄÇ Áõ¥Êé•Ëµ∑ Thread ÁöÑÂèØÊéßÊÄßÊ≤°ÈÇ£‰πàÈ´òÔºåÂÆÉÊâÄ‰æùÈôÑÁöÑ Activity finish Êéâ‰πãÂêéÔºåÂ¶ÇÊûú‰Ω†Ê≤°Êúâ‰∏ªÂä®ÂÅúÊ≠¢ Thread ÊàñËÄÖ Thread ÈáåÁöÑ run ÊñπÊ≥ïÊ≤°ÊúâÊâßË°åÂÆåÊØïÁöÑËØùÔºåThread ‰πü‰ºö‰∏ÄÁõ¥ÊâßË°å„ÄÇ‰Ω†Ê≤°ÊúâÂäûÊ≥ïÂú®‰∏çÂêåÁöÑ Activity ‰∏≠ÂØπÂêå‰∏Ä Thread ËøõË°åÊéßÂà∂„ÄÇ ÂèØ‰ª•ÊèêÈ´òËøõÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºå‰ΩøÂæóËøõÁ®ãÊ≤°ÈÇ£‰πàÂÆπÊòìË¢´ kill„ÄÇÂ¶ÇÊûúÊòØ‰∏Ä‰∏™ÈïøÊúüÁöÑ‰ªªÂä°ÔºàÊØîÂ¶ÇËØ¥ÈïøËΩÆËØ¢ÔºâÔºåÈÇ£‰πàÁî® Service ÂéªÂÅöÊØîËæÉÂêàÈÄÇ„ÄÇ ÈÄöËøáÂú® manifest ÈáåÂ£∞Êòé ServiceÔºåÊääÈúÄË¶ÅÂêéÂè∞Áõ∏ÂØπÈïøÊúüËøêË°åÁöÑÈÄªËæëÊîæÂú® Service ÈáåÔºå‰Ω†‰æøËé∑Âæó‰∫ÜËøôÊ†∑ÁöÑ‰øùÈöúÔºöÂè™Ë¶ÅÁ≥ªÁªüÂÜÖÂ≠ò‰∏çÊòØÊûÅÁ´Ø‰∏çÂ§üÁî®Ôºå‰Ω†ÁöÑ Service ‰∏ÄÂÆö‰∏ç‰ºöË¢´ kill Êéâ„ÄÇÂØπÁ≥ªÁªüËÄåË®ÄÔºåÂΩìÁúãÂà∞‰∏Ä‰∏™ËøõÁ®ãÈáåÊúâ Service Âú®ËøêË°åÔºåËøô‰∏™ËøõÁ®ãÂ∞±ÂÖ∑ÊúâËæÉÈ´òÁöÑ‰ºòÂÖàÁ∫ßÔºå‰ºöÂú®ÂÜÖÂ≠ò‰∏çË∂≥Ë¢´ÊùÄÁöÑË°åÂàóÈáåÊéíÂæóÊØîËæÉÈù†Âêé„ÄÇ ‰ªé‰∫§‰∫íÁöÑËßíÂ∫¶ÁúãÔºåÂ¶ÇÊûúÊòØ‰∏çÈúÄË¶ÅÁî®Êà∑‰∫§‰∫í‰πüÂèØ‰ª•Âú®ÂêéÂè∞ËøêË°åÔºåÈÇ£‰πàÂèØ‰ª•Áî®ÊúçÂä°„ÄÇÂ¶ÇÊûúÊòØÂú®Áî®Êà∑‰∏éÂ∫îÁî®‰∫§‰∫íÊó∂ÔºàÊØîÂ¶ÇËØ¥ÔºöÂú®ËÆæÁΩÆÈ°µÈù¢‰øÆÊîπÁî®Êà∑‰ø°ÊÅØÔºåÂêåÊ≠•Âà∞ÊúçÂä°Âô®‰∏äÈù¢ÂéªÔºâÈÇ£‰πàÂèØ‰ª•Áî®Á∫øÁ®ã„ÄÇÂ¶ÇÊûúÁ°ÆÂÆöË¶ÅÁî® ThreadÔºåËøòÂèØ‰ª•ËÄÉËôë‰ΩøÁî® AsyncTask Êàñ HandlerThreadÔºåËÄåÈùû‰º†ÁªüÁöÑ Thread Á±ª„ÄÇ ÊâÄ‰ª•Áõ¥Êé•Áî®Á∫øÁ®ãËøòÊòØËµ∑‰∏Ä‰∏™ÊúçÂä°ÂÖ≥ÈîÆÂæóÁúã‰ªªÂä°ÁöÑÁ±ªÂûã„ÄÇÊòØÂê¶ÊòØÈïøÊúüËÄóÊó∂ÁöÑ‰ªªÂä°ÔºåÊòØÂê¶ÈúÄË¶ÅË∑üÁî®Êà∑‰∫§‰∫íÔºü ‰∫å„ÄÅ3 ÁßçÂêØÂä®ÊñπÂºèÊñπÂºè‰∏Ä„ÄÅstart Service Ë∞ÉÁî®ËÄÖÂè™ÊòØË¥üË¥£ÂêØÂä®ÂÆÉÂíåÂÅúÊ≠¢ÂÆÉÔºåÊàñËÄÖÂú®ÂêØÂä®ÂÆÉÁöÑÊó∂ÂÄôÈÄöËøá Intent ‰º†ÈÄí‰∏ÄÁÇπÊï∞ÊçÆÁªôÂÆÉÔºåÈô§Ê≠§‰πãÂ§ñÔºå‰∏§ËÄÖÊ≤°ÊúâÊï∞ÊçÆ‰∫§Êç¢„ÄÅÊ≤°ÊúâÂÖ∂‰ªñÁöÑÂäüËÉΩË∞ÉÁî®ÔºåËøô‰∏§‰∏™ÁªÑ‰ª∂‰πãÈó¥Âü∫Êú¨‰∏ä‰∫í‰∏çÂΩ±Âìç„ÄÇ Â¶ÇÊûúÂ∏åÊúõÊúçÂä°ËøîÂõûÁªìÊûúÔºåÂàôÂêØÂä®ÊúçÂä°ÁöÑÂÆ¢Êà∑Á´ØÂèØ‰ª•‰∏∫ÂπøÊí≠ÂàõÂª∫‰∏Ä‰∏™ PendingIntent Ôºà‰ΩøÁî® getBroadcast()ÔºâÔºåÂπ∂==ÈÄöËøáÂêØÂä®ÊúçÂä°ÁöÑ Intent ‰º†ÈÄíÁªôÊúçÂä°==„ÄÇÁÑ∂ÂêéÔºåÊúçÂä°Â∞±ÂèØ‰ª•‰ΩøÁî®ÂπøÊí≠‰º†ÈÄíÁªìÊûú„ÄÇÂèØ‰ª•Ëé∑ÂèñÂà∞ pendingIntentÔºåÁÑ∂ÂêéÂë¢Ôºü ÊúçÂä°ÂÜÖÈÉ®‰πüÂèØ‰ª•Áõ¥Êé•ÊûÑÈÄ† PendingIntent Âïä„ÄÇ Â¶ÇÊûúÊòØÈÄöËøáÂÆ¢Êà∑Á´ØÁöÑ‰º†ÈÄíÁöÑÔºåÈÇ£‰πàÊúâÂ§ö‰∏™ÂÆ¢Êà∑Á´ØÔºåÂèØ‰ª•Ê†πÊçÆ‰º†ÈÄíÁöÑ intent ÂàÜÂà´Â§ÑÁêÜÔºü Â¶ÇÊûúÂõ†‰∏∫Á≥ªÁªüÂÜÖÂ≠ò‰∏çË∂≥Ë¢´ killÔºå‰πãÂêéÁöÑÂÖ∑‰ΩìË°å‰∏∫‰∏é onStartCommand ÊñπÊ≥ïÁöÑËøîÂõûÂÄºÁõ∏ÂåπÈÖç„ÄÇ ÁîüÂëΩÂë®ÊúüÔºöÂ§ö‰∏™ÊúçÂä°ÂêØÂä®ËØ∑Ê±Ç‰ºöÂØºËá¥Â§öÊ¨°ÂØπÊúçÂä°ÁöÑ onStartCommand() ËøõË°åÁõ∏Â∫îÁöÑË∞ÉÁî®„ÄÇ‰ΩÜÊòØÔºåË¶ÅÂÅúÊ≠¢ÊúçÂä°ÔºåÂè™ÈúÄ‰∏Ä‰∏™ÊúçÂä°ÂÅúÊ≠¢ËØ∑Ê±ÇÔºà‰ΩøÁî® stopSelf() Êàñ stopService()ÔºâÂç≥ÂèØ„ÄÇ ÊñπÂºè‰∫å„ÄÅbind Service ÂÖ∂‰ªñÁªÑ‰ª∂ÈÄöËøáË∞ÉÁî® bindService() ÁªëÂÆö ServiceÔºåËÆ©ÂÆÉËøêË°åËµ∑Êù•ÔºõÂÜçÈÄöËøáË∞ÉÁî® unbindService()Ëß£Èô§ÁªëÂÆö„ÄÇ ÁªÑ‰ª∂Âíå Service ‰πãÈó¥ÁöÑË∞ÉÁî®ÊòØÈÄöËøá Binder Êù•ËøõË°åÁöÑ„ÄÇÊàë‰ª¨ÂèØ‰ª•Êää Binder Áúã‰ΩúÊòØ‰∏Ä‰∏™ËøûÊé•ÂÖ∂‰ªñÁªÑ‰ª∂Âíå Service ÁöÑÊ°•Ê¢Å„ÄÇ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûúÊòØÂú®Âêå‰∏Ä‰∏™ËøõÁ®ãÂÜÖÔºåÂèØ‰ª•Áõ¥Êé•ÁªßÊâø Binder,ÁÑ∂ÂêéÂú®ÈáåÈù¢ÂÆûÁé∞Êèê‰æõÁªôË∞ÉÁî®ËÄÖÁöÑÂäüËÉΩ„ÄÇ Â¶ÇÊûúÊòØË∑®ËøõÁ®ãÔºåÂèØ‰ª•‰ΩøÁî® aidl„ÄÇ Â∞ÜË¶ÅÊèê‰æõÁªôË∞ÉÁî®ÊñπÁöÑÂäüËÉΩÊé•Âè£ÂÜôÂú® aidl Êñá‰ª∂‰∏≠„ÄÇbuild ‰πãÂêéÔºåÁªßÊâø Stub ,ÂÆûÁé∞Áõ∏Â∫îÁöÑÂäüËÉΩ„ÄÇ Ë∞ÉÁî®ÊñπÂú® onServiceConnected ÊñπÊ≥ï‰∏≠ÔºåËé∑ÂèñÂà∞ÊúçÂä°Á´ØÊèê‰æõÁöÑ IBinder ÂØπË±°Â∞±ÂèØ‰ª•ÂÉèË∞ÉÁî®ÊôÆÈÄöÂáΩÊï∞‰∏ÄÊ†∑ÔºåË∞ÉÁî®Áõ∏Â∫îÁöÑÊñπÊ≥ï‰∫Ü„ÄÇ Â¶ÇÊûúÊòØËøúÁ®ãË∞ÉÁî®ÁöÑËØùÔºåÂ∞ÜÂØπÊñπÊèê‰æõÁöÑ IBinder Á±ª ÈÄöËøá asInterface ÊñπÊ≥ïËøõË°åËΩ¨Êç¢„ÄÇÂ¶ÇÊûúÊòØÂú®ÊúçÂä°Á´ØÔºåËøîÂõû binder ÂÆû‰ΩìÔºåÂ¶ÇÊûúÊòØÂú®ÂÆ¢Êà∑Á´ØÔºåËøîÂõû binder Proxy„ÄÇ Â¶ÇÊûúÈúÄË¶ÅÊèê‰æõÊé•Âè£ÁªôË∞ÉÁî®Êñπ‰ΩøÁî®ÔºåÂèØ‰ª•ÈÄöËøá onBind ÊñπÊ≥ï‰∏≠ËøîÂõû‰∏Ä‰∏™ÂèØ‰æõË∞ÉÁî®ËÄÖ‰ΩøÁî®ÁöÑ Binder ÂØπË±°„ÄÇ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûúÁî®Êà∑‰∏ªÂä®Ëß£Èô§ÁªëÂÆöÔºåonServiceDisconnected()ÊòØ‰∏ç‰ºöË¢´Ëß¶ÂèëÁöÑ„ÄÇ Â¶ÇÊûúÁªÑ‰ª∂ÊòØÈÄöËøáË∞ÉÁî® bindService() Êù•ÂàõÂª∫ÊúçÂä°Ôºà‰∏îÊú™Ë∞ÉÁî® onStartCommand()ÔºåÂàôÊúçÂä°Âè™‰ºöÂú®ËØ•ÁªÑ‰ª∂‰∏éÂÖ∂ÁªëÂÆöÊó∂ËøêË°å„ÄÇ‰∏ÄÊó¶ËØ•ÊúçÂä°‰∏éÊâÄÊúâÂÆ¢Êà∑Á´Ø‰πãÈó¥ÁöÑÁªëÂÆöÂÖ®ÈÉ®ÂèñÊ∂àÔºåÁ≥ªÁªü‰æø‰ºöÈîÄÊØÅ„ÄÇ Âç≥‰Ωø‰∏∫ÊúçÂä°ÂêØÁî®‰∫ÜÁªëÂÆöÔºå‰∏ÄÊó¶ÊúçÂä°Êî∂Âà∞ÂØπ onStartCommand() ÁöÑË∞ÉÁî®Ôºà‰πüÂ∞±ÊòØÂú® bind ‰πãÂêéÂèà‰ΩøÁî® start ÁöÑÊñπÂºèÂéªÂêØÂä®Â∫îÁî®ÔºâÔºåÂàôÂøÖÈ°ªÊâãÂä®ÂÅúÊ≠¢ÊúçÂä°„ÄÇÔºàÂÜÖÈÉ®Ë∞ÉÁî® stopSelf ÊàñËÄÖ Áî±Âè¶‰∏Ä‰∏™ÁªÑ‰ª∂ÈÄöËøáË∞ÉÁî®stopService() Êù•ÂÅúÊ≠¢ÂÆÉÔºâ Â§ö‰∏™ÂÆ¢Êà∑Á´ØÂÖàÂêéËøõË°å bindService Âè™ÊúâÁ¨¨‰∏Ä‰∏™Ë∞ÉÁî® bindService Êó∂‰ºöË∞ÉÁî® Service#onBind ÊñπÊ≥ïÔºåÂêéÁª≠ÁöÑÈÉΩÊòØÁõ¥Êé•Âú® ServiceConnection ‰∏≠ËøîÂõû„ÄÇ ÁªëÂÆöÊòØÂºÇÊ≠•ÁöÑ„ÄÇbindService() ‰ºöÁ´ãÂç≥ËøîÂõûÔºå‰ΩÜÊòØ„Äå‰∏ç‰ºö„Äç‰Ωø IBinder ËøîÂõûÂÆ¢Êà∑Á´Ø„ÄÇË¶ÅÊé•Êî∂ IBinderÔºåÂÆ¢Êà∑Á´ØÂøÖÈ°ªÂàõÂª∫‰∏Ä‰∏™ ServiceConnection ÂÆû‰æãÔºåÂπ∂Â∞ÜÂÖ∂‰º†ÈÄíÁªô bindService()„ÄÇServiceConnection ÂåÖÊã¨‰∏Ä‰∏™ÂõûË∞ÉÊñπÊ≥ïÔºåÁ≥ªÁªüÈÄöËøáË∞ÉÁî®ÂÆÉÊù•‰º†ÈÄí IBinder„ÄÇIBinder ËøîÂõûÊòØÂºÇÊ≠•ÁöÑ„ÄÇ Ê≥®ÔºöÂè™Êúâ Activity„ÄÅService Âíå ContentProvider ÂèØ‰ª•ÁªëÂÆöÂà∞ÊúçÂä° ‚Äî Êó†Ê≥ï‰ªéÂπøÊí≠Êé•Êî∂Âô®ÁªëÂÆöÂà∞ÊúçÂä°„ÄÇ ÂàõÂª∫ÊîØÊåÅ bindService ÁöÑ Service ÁöÑÂÖ≥ÈîÆÂú®‰∫éÔºåËá™ÂÆö‰πâ‰∏Ä‰∏™Áõ¥Êé•/Èó¥Êé•ÂÆûÁé∞‰∫Ü IBinder Êé•Âè£ÁöÑÁ±ªÔºàÁºñÂÜôÂäüËÉΩ‰ª£Á†ÅÊèê‰æõÁõ∏Â∫îÁöÑÂäüËÉΩÔºâÁÑ∂ÂêéÈÄöËøá onBind ÊñπÊ≥ïÊääËØ•Á±ªÁöÑÂÆû‰æã‰º†ÈÄíÁªôÂÆ¢Êà∑Á´Ø„ÄÇ Ê≥®ÊÑèÔºöService.onBindÂ¶ÇÊûúËøîÂõûnullÔºåÂàôË∞ÉÁî® bindService ‰ºöÂêØÂä® ServiceÔºå‰ΩÜ‰∏ç‰ºöËøûÊé•‰∏ä ServiceÔºåÂõ†Ê≠§ ServiceConnection.onServiceConnected ‰∏ç‰ºöË¢´Ë∞ÉÁî®Ôºå‰ΩÜ‰Ω†‰ªªÁÑ∂ÈúÄË¶Å‰ΩøÁî® unbindService ÂáΩÊï∞Êñ≠ÂºÄÂÆÉÔºåËøôÊ†∑ Service Êâç‰ºöÂÅúÊ≠¢„ÄÇ ÂàõÂª∫Êèê‰æõÁªëÂÆöÁöÑ ServiceÂàõÂª∫Êèê‰æõÁªëÂÆöÁöÑÊúçÂä°Êó∂ÔºåÊÇ®ÂøÖÈ°ªÊèê‰æõ IBinderÔºåÁî®‰ª•Êèê‰æõÂÆ¢Êà∑Á´ØÁî®Êù•‰∏éÊúçÂä°ËøõË°å‰∫§‰∫íÁöÑÊé•Âè£„ÄÇ ÊÇ®ÂèØ‰ª•ÈÄöËøá‰∏âÁßçÊñπÊ≥ïÂÆö‰πâÊé•Âè£Ôºö 1. Áõ¥Êé•ÁªßÊâø Binder Á±ªÈÄÇÁî®Âú∫ÊôØÔºöÊúçÂä°ÊòØ‰æõÂçï‰∏™Â∫îÁî®‰∏ìÁî®ÔºåÂπ∂‰∏îÂú®‰∏éÂÆ¢Êà∑Á´ØÁõ∏ÂêåÁöÑËøõÁ®ã‰∏≠ËøêË°åÔºàÂ∏∏ËßÅÊÉÖÂÜµÔºâÔºåÂàôÂ∫îÈÄöËøáÊâ©Â±ï Binder Á±ªÂπ∂‰ªé onBind() ËøîÂõûÂÆÉÁöÑ‰∏Ä‰∏™ÂÆû‰æãÊù•ÂàõÂª∫Êé•Âè£„ÄÇÂÆ¢Êà∑Á´ØÊî∂Âà∞ Binder ÂêéÔºåÂèØÂà©Áî®ÂÆÉÁõ¥Êé•ËÆøÈóÆ Binder ÂÆûÁé∞‰∏≠‰πÉËá≥ Service ‰∏≠ÂèØÁî®ÁöÑÂÖ¨ÂÖ±ÊñπÊ≥ï„ÄÇ Â¶ÇÊûúÊúçÂä°Âè™ÊòØ app ÁöÑÂêéÂè∞Â∑•‰ΩúÁ∫øÁ®ãÔºåÂàô‰ºòÂÖàÈááÁî®ËøôÁßçÊñπÊ≥ï„ÄÇ 2. ‰ΩøÁî® MessengerÂ¶ÇÈúÄËÆ©Êé•Âè£Ë∑®‰∏çÂêåÁöÑËøõÁ®ãÂ∑•‰ΩúÔºåÂàôÂèØ‰ΩøÁî® Messenger ‰∏∫ÊúçÂä°ÂàõÂª∫Êé•Âè£„ÄÇÊúçÂä°ÂèØ‰ª•ËøôÁßçÊñπÂºèÂÆö‰πâÂØπÂ∫î‰∫é‰∏çÂêåÁ±ªÂûã Message ÂØπË±°ÁöÑ Handler„ÄÇÊ≠§ Handler ÊòØ Messenger ÁöÑÂü∫Á°ÄÔºåÂêéËÄÖÈöèÂêéÂèØ‰∏éÂÆ¢Êà∑Á´ØÂàÜ‰∫´‰∏Ä‰∏™ IBinderÔºå‰ªéËÄåËÆ©ÂÆ¢Êà∑Á´ØËÉΩÂà©Áî® Message ÂØπË±°ÂêëÊúçÂä°ÂèëÈÄÅÂëΩ‰ª§„ÄÇÊ≠§Â§ñÔºåÂÆ¢Êà∑Á´ØËøòÂèØÂÆö‰πâËá™Êúâ MessengerÔºå‰ª•‰æøÊúçÂä°Âõû‰º†Ê∂àÊÅØ„ÄÇ ËøôÊòØÊâßË°åËøõÁ®ãÈó¥ÈÄö‰ø° (IPC) ÁöÑÊúÄÁÆÄÂçïÊñπÊ≥ïÔºåÂõ†‰∏∫ Messenger ‰ºöÂú®Âçï‰∏ÄÁ∫øÁ®ã‰∏≠ÂàõÂª∫ÂåÖÂê´ÊâÄÊúâËØ∑Ê±ÇÁöÑÈòüÂàóÔºåËøôÊÑèÂë≥ÁùÄÂºÄÂèëËÄÖÊó†ÈúÄËøõË°åÁ∫øÁ®ãÂÆâÂÖ®ÊéßÂà∂ 3.‰ΩøÁî® AIDLAIDLÔºàAndroid Êé•Âè£ÂÆö‰πâËØ≠Ë®ÄÔºâÊâßË°åÊâÄÊúâÂ∞ÜÂØπË±°ÂàÜËß£ÊàêÂéüËØ≠ÁöÑÂ∑•‰ΩúÔºåÊìç‰ΩúÁ≥ªÁªüÂèØ‰ª•ËØÜÂà´Ëøô‰∫õÂéüËØ≠Âπ∂Â∞ÜÂÆÉ‰ª¨ÁºñÁªÑÂà∞ÂêÑËøõÁ®ã‰∏≠Ôºå‰ª•ÊâßË°å IPC„ÄÇ ‰πãÂâçÈááÁî® Messenger ÁöÑÊñπÊ≥ïÂÆûÈôÖ‰∏äÊòØ‰ª• AIDL ‰Ωú‰∏∫ÂÖ∂Â∫ïÂ±ÇÁªìÊûÑ„ÄÇ Â¶Ç‰∏äÊâÄËø∞ÔºåMessenger ‰ºöÂú®Âçï‰∏ÄÁ∫øÁ®ã‰∏≠ÂàõÂª∫ÂåÖÂê´ÊâÄÊúâÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÁöÑÈòüÂàóÔºå‰ª•‰æøÊúçÂä°‰∏ÄÊ¨°Êé•Êî∂‰∏Ä‰∏™ËØ∑Ê±Ç„ÄÇ ‰∏çËøáÔºåÂ¶ÇÊûúÊÇ®ÊÉ≥ËÆ©ÊúçÂä°ÂêåÊó∂Â§ÑÁêÜÂ§ö‰∏™ËØ∑Ê±ÇÔºåÂàôÂèØÁõ¥Êé•‰ΩøÁî® AIDL„ÄÇ Âú®Ê≠§ÊÉÖÂÜµ‰∏ãÔºåÊÇ®ÁöÑÊúçÂä°ÂøÖÈ°ªÂÖ∑Â§áÂ§öÁ∫øÁ®ãÂ§ÑÁêÜËÉΩÂäõÔºåÂπ∂ÈááÁî®Á∫øÁ®ãÂÆâÂÖ®ÂºèËÆæËÆ°„ÄÇ Â¶ÇÈúÄÁõ¥Êé•‰ΩøÁî® AIDLÔºåÊÇ®ÂøÖÈ°ªÂàõÂª∫‰∏Ä‰∏™ÂÆö‰πâÁºñÁ®ãÊé•Âè£ÁöÑ .aidl Êñá‰ª∂„ÄÇAndroid SDK Â∑•ÂÖ∑Âà©Áî®ËØ•Êñá‰ª∂ÁîüÊàê‰∏Ä‰∏™ÂÆûÁé∞Êé•Âè£Âπ∂Â§ÑÁêÜ IPC ÁöÑÊäΩË±°Á±ªÔºåÊÇ®ÈöèÂêéÂèØÂú®ÊúçÂä°ÂÜÖÂØπÂÖ∂ËøõË°åÊâ©Â±ï„ÄÇ ÊñπÂºè‰∏â„ÄÅÊ∑∑ÂêàÂûãÔºåÂêåÊó∂‰ΩøÁî® start Âíå bindService Âπ∂‰∏çÊòØÂè™ËÉΩÁªô‰∏Ä‰∏™ÁªÑ‰ª∂‰ΩøÁî®ÔºåÂÆÉÂèØ‰ª•ÂêåÊó∂ÊúçÂä°‰∫éÂ§ö‰∏™ÁªÑ‰ª∂„ÄÇÊâÄ‰ª•‰∏Ä‰∏™ Service Êó¢ÂèØ‰ª•ÊòØ Start ServiceÔºå‰πüÂèØ‰ª•ÊòØ Bind Service„ÄÇÂè™Ë¶ÅÊää‰∏§ËÄÖÈúÄË¶ÅÂÆûÁé∞ÁöÑÂú∞ÊñπÈÉΩÂÆûÁé∞‰∫ÜÂ∞±Ë°å„ÄÇÁªÑ‰ª∂ A ÂèØ‰ª•ÈÄöËøá startService()ËøêË°å‰∏Ä‰∏™ ServiceÔºåÁªÑ‰ª∂ B ÂèØ‰ª•ÈÄöËøá bindService()ÂÜçÊ¨°ËøêË°åÂêå‰∏Ä‰∏™ Service„ÄÇ ÁîüÂëΩÂë®ÊúüÂèØ‰ª•ÁªëÂÆöÂà∞Â∑≤Áªè‰ΩøÁî® startService() ÂêØÂä®ÁöÑÊúçÂä°„ÄÇ‰æãÂ¶ÇÔºåÂèØ‰ª•ÈÄöËøá‰ΩøÁî® IntentÔºàÊ†áËØÜË¶ÅÊí≠ÊîæÁöÑÈü≥‰πêÔºâË∞ÉÁî® startService() Êù•ÂêØÂä®ÂêéÂè∞Èü≥‰πêÊúçÂä°„ÄÇÈöèÂêéÔºåÂèØËÉΩÂú®Áî®Êà∑ÈúÄË¶ÅÁ®çÂä†ÊéßÂà∂Êí≠ÊîæÂô®ÊàñËé∑ÂèñÊúâÂÖ≥ÂΩìÂâçÊí≠ÊîæÊ≠åÊõ≤ÁöÑ‰ø°ÊÅØÊó∂ÔºåActivity ÂèØ‰ª•ÈÄöËøáË∞ÉÁî® bindService() ÁªëÂÆöÂà∞ÊúçÂä°„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÈô§ÈùûÊâÄÊúâÂÆ¢Êà∑Á´ØÂùáÂèñÊ∂àÁªëÂÆöÔºåÂê¶Âàô stopService() Êàñ stopSelf() ‰∏ç‰ºöÂÆûÈôÖÂÅúÊ≠¢ÊúçÂä°„ÄÇ ÂÖà startService ÁÑ∂Âêé bindSerive ÂÖà bindService ÁÑ∂Âêé startService Âú®Ê∑∑ÂêàÊ®°Âºè‰∏ãÔºåÂè™ÊúâÁ≠âÂà∞Ë∞ÉÁî®‰∫Ü stopSelf Êàñ stopService ‰ª•Âèä ÊâÄÊúâÁöÑÂÆ¢Êà∑Á´ØÈÉΩÂèñÊ∂àÁªëÂÆöÔºåÊúçÂä°Êâç‰ºöÂÅúÊ≠¢ ÂÆòÊñπÊµÅÁ®ãÂõæ onRebindÔºàIntent intentÔºâ ÊñπÊ≥ï‰∏é Activity#onNewIntent ÊñπÊ≥ïÁ±ª‰ºº„ÄÇËØ•ÊñπÊ≥ïÊòØÂê¶Ë¢´Ë∞ÉÁî®ÂèñÂÜ≥‰∫é onUnbind ÊñπÊ≥ïÊòØÂê¶ËøîÂõû true„ÄÇÂΩìÊâÄÊúâÁöÑÂÆ¢Êà∑Á´ØÈÉΩË∞ÉÁî®‰∫Ü unBindServiceÔºåËÄåÊ≤°ÊúâË∞ÉÁî® stopService ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ÈÅøÂÖçËøôÁßçÊÉÖÂÜµ„ÄÇ Â¶ÇÊûúÊòØ trueÔºåÂΩìÊúâÊñ∞ÁöÑË∞ÉÁî®ËøáÊù•ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•Âú® onReBind ÊñπÊ≥ï‰∏≠ÊãøÂà∞ intent„ÄÇ Â¶ÇÊûú‰∏∫ falseÔºåÂΩìÊúâÊñ∞ÁöÑË∞ÉÁî®ËøáÊù•ÁöÑÊó∂ÂÄôÔºå‰ºöËµ∞ onBindonRebind() ËøîÂõûÁ©∫ÂÄºÔºå‰ΩÜÂÆ¢Êà∑Á´Ø‰ªçÂú®ÂÖ∂ onServiceConnected() ÂõûË∞É‰∏≠Êé•Êî∂ IBinder„ÄÇ Â¶ÇÊûúË¶ÅÂêåÊó∂ÊîØÊåÅ start Âíå bindÔºåÈúÄË¶ÅÂêåÊó∂ÂÆûÁé∞‰∏§Â•óÊñπÊ≥ï„ÄÇ onStartCommand onBind Ëøô‰∏§‰∏™ÊñπÊ≥ïÈÉΩÂê´Êúâ‰∏Ä‰∏™ Intent ÂèÇÊï∞ ÈôÑÔºö Â∫îËØ•ÂßãÁªàÊçïËé∑ DeadObjectException ÂºÇÂ∏∏ÔºåÂÆÉ‰ª¨ÊòØÂú®ËøûÊé•‰∏≠Êñ≠Êó∂ÂºïÂèëÁöÑ„ÄÇËøôÊòØËøúÁ®ãÊñπÊ≥ïÂºïÂèëÁöÑÂîØ‰∏ÄÂºÇÂ∏∏„ÄÇ ÂØπË±°ÊòØË∑®ËøõÁ®ãËÆ°Êï∞ÁöÑÂºïÁî®„ÄÇ ÈÄöÂ∏∏Â∫îËØ•Âú®ÂÆ¢Êà∑Á´ØÁîüÂëΩÂë®ÊúüÁöÑÂåπÈÖçÂºïÂÖ• (bring-up) ÂíåÈÄÄÂá∫ (tear-down) Êó∂ÂàªÊúüÈó¥ÈÖçÂØπÁªëÂÆöÂíåÂèñÊ∂àÁªëÂÆö„ÄÇ ‰æãÂ¶ÇÔºöÂ¶ÇÊûúÊÇ®Âè™ÈúÄË¶ÅÂú® Activity ÂèØËßÅÊó∂‰∏éÊúçÂä°‰∫§‰∫íÔºåÂàôÂ∫îÂú® onStart() ÊúüÈó¥ÁªëÂÆöÔºåÂú® onStop() ÊúüÈó¥ÂèñÊ∂àÁªëÂÆö„ÄÇÂ¶ÇÊûúÊÇ®Â∏åÊúõ Activity Âú®ÂêéÂè∞ÂÅúÊ≠¢ËøêË°åÁä∂ÊÄÅ‰∏ã‰ªçÂèØÊé•Êî∂ÂìçÂ∫îÔºåÂàôÂèØÂú® onCreate() ÊúüÈó¥ÁªëÂÆöÔºåÂú® onDestroy() ÊúüÈó¥ÂèñÊ∂àÁªëÂÆö„ÄÇËØ∑Ê≥®ÊÑèÔºåËøôÊÑèÂë≥ÁùÄÊÇ®ÁöÑ Activity Âú®ÂÖ∂Êï¥‰∏™ËøêË°åËøáÁ®ã‰∏≠ÔºàÁîöËá≥ÂåÖÊã¨ÂêéÂè∞ËøêË°åÊúüÈó¥ÔºâÈÉΩÈúÄË¶Å‰ΩøÁî®ÊúçÂä°ÔºåÂõ†Ê≠§Â¶ÇÊûúÊúçÂä°‰Ωç‰∫éÂÖ∂‰ªñËøõÁ®ãÂÜÖÔºåÈÇ£‰πàÂΩìÊÇ®ÊèêÈ´òËØ•ËøõÁ®ãÁöÑÊùÉÈáçÊó∂ÔºåÁ≥ªÁªüÁªàÊ≠¢ËØ•ËøõÁ®ãÁöÑÂèØËÉΩÊÄß‰ºöÂ¢ûÂä†„ÄÇ Ê≥®ÔºöÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÂàáÂãøÂú® Activity ÁöÑ onResume() Âíå onPause() ÊúüÈó¥ÁªëÂÆöÂíåÂèñÊ∂àÁªëÂÆöÔºåÂõ†‰∏∫ÊØè‰∏ÄÊ¨°ÁîüÂëΩÂë®ÊúüËΩ¨Êç¢ÈÉΩ‰ºöÂèëÁîüËøô‰∫õÂõûË∞ÉÔºåÊÇ®Â∫îËØ•‰ΩøÂèëÁîüÂú®Ëøô‰∫õËΩ¨Êç¢ÊúüÈó¥ÁöÑÂ§ÑÁêÜ‰øùÊåÅÂú®ÊúÄ‰ΩéÊ∞¥Âπ≥„ÄÇÊ≠§Â§ñÔºåÂ¶ÇÊûúÊÇ®ÁöÑÂ∫îÁî®ÂÜÖÁöÑÂ§ö‰∏™ Activity ÁªëÂÆöÂà∞Âêå‰∏ÄÊúçÂä°ÔºåÂπ∂‰∏îÂÖ∂‰∏≠‰∏§‰∏™ Activity ‰πãÈó¥ÂèëÁîü‰∫ÜËΩ¨Êç¢ÔºåÂàôÂ¶ÇÊûúÂΩìÂâç Activity Âú®‰∏ã‰∏Ä‰∏™ Activity ÁªëÂÆöÔºàÊÅ¢Â§çÊúüÈó¥Ôºâ‰πãÂâçÂèñÊ∂àÁªëÂÆöÔºàÊöÇÂÅúÊúüÈó¥ÔºâÔºåÁ≥ªÁªüÂèØËÉΩ‰ºöÈîÄÊØÅÊúçÂä°Âπ∂ÈáçÂª∫ÊúçÂä°„ÄÇ ÔºàActivity ÊñáÊ°£‰∏≠‰ªãÁªç‰∫ÜËøôÁßçÊúâÂÖ≥ Activity Â¶Ç‰ΩïÂçèË∞ÉÂÖ∂ÁîüÂëΩÂë®ÊúüÁöÑ Activity ËΩ¨Êç¢„ÄÇÔºâ manifest Êñá‰ª∂‰∏≠Â£∞ÊòéÊúçÂä°android:name Â±ûÊÄßÊòØÂîØ‰∏ÄÂøÖÈúÄÁöÑÂ±ûÊÄßÔºåÁî®‰∫éÊåáÂÆöÊúçÂä°ÁöÑÁ±ªÂêç„ÄÇ ‰∏â„ÄÅÂàõÂª∫ÊúçÂä°‰ªé‰º†Áªü‰∏äËÆ≤ÔºåÊÇ®ÂèØ‰ª•Êâ©Â±ï‰∏§‰∏™Á±ªÊù•ÂàõÂª∫ÂêØÂä®ÊúçÂä°Ôºö ServiceÊâÄÊúâÊúçÂä°ÁöÑÂü∫Á±ª„ÄÇÊâ©Â±ïÊ≠§Á±ªÊó∂ÔºåÂøÖÈ°ªÂàõÂª∫‰∏Ä‰∏™Áî®‰∫éÊâßË°åÊâÄÊúâÊúçÂä°Â∑•‰ΩúÁöÑÊñ∞Á∫øÁ®ãÔºåÂõ†‰∏∫ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÊúçÂä°Â∞Ü‰ΩøÁî®Â∫îÁî®ÁöÑ‰∏ªÁ∫øÁ®ãÔºåËøô‰ºöÈôç‰ΩéÂ∫îÁî®Ê≠£Âú®ËøêË°åÁöÑÊâÄÊúâ Activity ÁöÑÊÄßËÉΩ„ÄÇ IntentServiceService ÁöÑÂ≠êÁ±ªÔºåÂÆÉ‰ΩøÁî®Â∑•‰ΩúÁ∫øÁ®ãÈÄê‰∏ÄÂ§ÑÁêÜÔºà‰∏≤Ë°åÂ§ÑÁêÜÔºâÊâÄÊúâÂêØÂä®ËØ∑Ê±Ç„ÄÇÂ¶ÇÊûúÊÇ®‰∏çË¶ÅÊ±ÇÊúçÂä°ÂêåÊó∂Â§ÑÁêÜÂ§ö‰∏™ËØ∑Ê±ÇÔºåËøôÊòØÊúÄÂ•ΩÁöÑÈÄâÊã©„ÄÇ ÊÇ®Âè™ÈúÄÂÆûÁé∞ onHandleIntent() ÊñπÊ≥ïÂç≥ÂèØÔºåËØ•ÊñπÊ≥ï‰ºöÊé•Êî∂ÊØè‰∏™ÂêØÂä®ËØ∑Ê±ÇÁöÑ IntentÔºå‰ΩøÊÇ®ËÉΩÂ§üÊâßË°åÂêéÂè∞Â∑•‰Ωú„ÄÇ IntentService ÊâßË°å‰ª•‰∏ãÊìç‰ΩúÔºö Ëá™Âä®ÂàõÂª∫ÈªòËÆ§ÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÔºåÁî®‰∫éÂú®Â∫îÁî®ÁöÑ‰∏ªÁ∫øÁ®ãÂ§ñÊâßË°å‰º†ÈÄíÁªô onStartCommand() ÁöÑÊâÄÊúâ Intent„ÄÇ ÂàõÂª∫Â∑•‰ΩúÈòüÂàóÔºåÁî®‰∫éÂ∞Ü Intent ÈÄê‰∏Ä‰º†ÈÄíÁªô onHandleIntent() ÂÆûÁé∞ÔºåËøôÊ†∑ÊÇ®Â∞±Ê∞∏Ëøú‰∏çÂøÖÊãÖÂøÉÂ§öÁ∫øÁ®ãÈóÆÈ¢ò„ÄÇ Âú®Â§ÑÁêÜÂÆåÊâÄÊúâÂêØÂä®ËØ∑Ê±ÇÂêéÂÅúÊ≠¢ÊúçÂä°ÔºåÂõ†Ê≠§ÊÇ®Ê∞∏Ëøú‰∏çÂøÖË∞ÉÁî® stopSelf()„ÄÇ Êèê‰æõ onBind() ÁöÑÈªòËÆ§ÂÆûÁé∞ÔºàËøîÂõû nullÔºâ„ÄÇ Êèê‰æõ onStartCommand() ÁöÑÈªòËÆ§ÂÆûÁé∞ÔºåÂèØÂ∞Ü Intent ‰æùÊ¨°ÂèëÈÄÅÂà∞Â∑•‰ΩúÈòüÂàóÂíå onHandleIntent() ÂÆûÁé∞„ÄÇ Âú®ÂâçÂè∞‰∏≠ÊòæÁ§∫„ÄÅÁßªÈô§Ë¶Å‰ªéÂâçÂè∞ÁßªÈô§ÊúçÂä°ÔºåËØ∑Ë∞ÉÁî® stopForeground()„ÄÇÊ≠§ÊñπÊ≥ïÈááÁî®‰∏Ä‰∏™Â∏ÉÂ∞îÂÄºÔºåÊåáÁ§∫ÊòØÂê¶‰πüÁßªÈô§Áä∂ÊÄÅÊ†èÈÄöÁü•„ÄÇ Ê≠§ÊñπÊ≥ï‰∏ç‰ºöÂÅúÊ≠¢ÊúçÂä°„ÄÇ ‰ΩÜÊòØÔºåÂ¶ÇÊûúÂú®ÊúçÂä°Ê≠£Âú®ÂâçÂè∞ËøêË°åÊó∂Â∞ÜÂÖ∂ÂÅúÊ≠¢ÔºåÂàôÈÄöÁü•‰πü‰ºöË¢´ÁßªÈô§ Start Service Âíå Bind Service Âõõ„ÄÅLocalService ËøòÊòØ RemoteServiceÔºü‰ªÄ‰πàÊó∂ÂÄôÈÄâÊã© local serviceÔºàÂç≥‰∏çÊåáÂÆöÈ¢ùÂ§ñÁöÑËøõÁ®ãÔºâÔºå‰ªÄ‰πàÊó∂ÂÄôÈÄâÊã© remote serviceÔºàÈ¢ùÂ§ñÁöÑËøõÁ®ãÔºâÔºü ÈÄöÂ∏∏Êàë‰ª¨‰ºöÊääÁúüÁöÑÈúÄË¶ÅÈïøÊúüËøêË°åÁöÑ ServiceÔºà‰æãÂ¶Ç IM ‰πãÁ±ªÔºâÊîæÂú®ÂçïÁã¨ÁöÑËøõÁ®ãÈáåÔºåËøôÊ†∑ UI ÊâÄÂú®ÁöÑËøõÁ®ãÂú®ÂøÖË¶ÅÁöÑÊó∂ÂÄô‰ªçÁÑ∂ÂèØ‰ª•Ë¢´Á≥ªÁªü kill ÊéâÊù•ËÖæÂá∫ÂÜÖÂ≠ò„ÄÇ ËÄå local service ÈÄöÂ∏∏Áî®Êù•Â§ÑÁêÜ‰∏Ä‰∫õÈúÄË¶ÅÁü≠ÊúüËøêË°å‰ΩÜ‰ªçÁÑ∂Ë∂ÖÂá∫ activity Ê¥ªÂä®Âë®ÊúüÁöÑ‰ªªÂä°ÔºåÊâì‰∏™ÊØîÊñπÔºåÂèëÈÄÅÁü≠‰ø°ÊàñÂΩ©‰ø°„ÄÇËøôÊ†∑ÁöÑ‰ªªÂä°ÊâßË°åÂÆå‰ª•ÂêéÔºåservice Â∞±ÂèØ‰ª• stop Ëá™Â∑±Ôºå‰ªçÁÑ∂‰∏çÂ¶®Á¢çÊï¥‰∏™ UI ËøõÁ®ãË¢´ÂõûÊî∂Êéâ„ÄÇ ‰∫î„ÄÅ‰ΩïÊó∂‰ºöË¢´ killÔºü ÂΩì‰∏î‰ªÖÂΩìÂÜÖÂ≠ò‰∏çË∂≥ÔºåËÄåÊ≠§Êó∂ÊúâÂÖ∂‰ªñËøõÁ®ãÁöÑ Activty ÂÖ∑ÊúâÁî®Êà∑ÁÑ¶ÁÇπÔºàÊàñËÄÖËØ¥ÔºåÂú®‰∫éÁî®Êà∑‰∫§‰∫íÔºâÊó∂Ôºåandroid Á≥ªÁªü‰ºöÂº∫Âà∂ stop ÊúçÂä°„ÄÇ Â¶ÇÊûúÂ∞ÜÊúçÂä°ÁªëÂÆöÂà∞ÂÖ∑ÊúâÁî®Êà∑ÁÑ¶ÁÇπÁöÑ ActivityÔºåÂàôÂÆÉ‰∏çÂ§™ÂèØËÉΩ‰ºöÁªàÊ≠¢Ôºõ Â¶ÇÊûúÂ∞ÜÊúçÂä°Â£∞Êòé‰∏∫Âú®ÂâçÂè∞ËøêË°åÔºåÂàôÂÆÉÂá†‰πéÊ∞∏Ëøú‰∏ç‰ºöÁªàÊ≠¢„ÄÇ Â¶ÇÊûúÊúçÂä°Â∑≤ÂêØÂä®Âπ∂Ë¶ÅÈïøÊó∂Èó¥ËøêË°åÔºåÂàôÁ≥ªÁªü‰ºöÈöèÁùÄÊó∂Èó¥ÁöÑÊé®ÁßªÈôç‰ΩéÊúçÂä°Âú®ÂêéÂè∞‰ªªÂä°ÂàóË°®‰∏≠ÁöÑ‰ΩçÁΩÆÔºåËÄåÊúçÂä°‰πüÂ∞ÜÈöè‰πãÂèòÂæóÈùûÂ∏∏ÂÆπÊòìË¢´ÁªàÊ≠¢Ôºõ Â¶ÇÊûúÊúçÂä°ÊòØÈÄöËøá startService ÂêØÂä®ÁöÑÔºåÈúÄË¶ÅÈÄöËøáÈáçÂÜô onStartCommand ÊñπÊ≥ïÂ¶•ÂñÑÂ§ÑÁêÜÁ≥ªÁªüÂØπÂÆÉÁöÑÈáçÂêØ„ÄÇ Âõ†‰∏∫Â¶ÇÊûúÁ≥ªÁªüÁªàÊ≠¢ÊúçÂä°ÔºåÈÇ£‰πà‰∏ÄÊó¶ËµÑÊ∫êÂèòÂæóÂÜçÊ¨°ÂèØÁî®ÔºåÁ≥ªÁªü‰æø‰ºöÈáçÂêØÊúçÂä°Ôºà‰∏çËøáËøôËøòÂèñÂÜ≥‰∫é‰ªé onStartCommand() ËøîÂõûÁöÑÂÄºÔºâ„ÄÇ Q:Â¶ÇÊûú‰ªÖÈÄöËøá bindService ÂêØÂä®ÔºåÊúçÂä°Ë¢´ kill ‰πãÂêéÔºåÊòØÂê¶ÈáçÂêØ‰ªçÁÑ∂ÂèñÂÜ≥‰∫é onStartCommand ÁöÑËøîÂõûÂÄºÂêóÔºü ‰∏ç‰ºöÔºåonStartCommand ÊñπÊ≥ïÈÉΩÊ≤°ÊúâË¢´Ë∞ÉÁî®ÔºåÊÄé‰πàÁü•ÈÅìÂÆÉÁöÑËøîÂõûÂÄºÂë¢Ôºü ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê Start Service Âíå Bind Service Service Bind Service Android ‰∏≠ Local Service ÊúÄÊú¨Ë¥®ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºü Android ‰∏≠ÁöÑ Service ÂÖ®Èù¢ÊÄªÁªì Áî±‰∫éÊú¨‰∫∫Ê∞¥Âπ≥ÊúâÈôêÔºåÂèØËÉΩÂá∫‰∫éËØØËß£ÊàñËÄÖÁ¨îËØØÈöæÂÖçÂá∫ÈîôÔºåÂ¶ÇÊûúÂèëÁé∞ÊúâÈóÆÈ¢òÊàñËÄÖÂØπÊñá‰∏≠ÂÜÖÂÆπÂ≠òÂú®ÁñëÈóÆÊ¨¢ËøéÂú®‰∏ãÈù¢ËØÑËÆ∫Âå∫ÂëäËØâÊàëÔºåËØ∑ÂØπÈóÆÈ¢òÊèèËø∞Â∞ΩÈáèËØ¶ÁªÜÔºå‰ª•Â∏ÆÂä©ÊàëÂèØ‰ª•Âø´ÈÄüÊâæÂà∞ÈóÆÈ¢òÊ†πÊ∫ê„ÄÇË∞¢Ë∞¢ÔºÅ]]></content>
      <categories>
        <category>Android Âü∫Á°Ä</category>
      </categories>
      <tags>
        <tag>Android Âü∫Á°Ä</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Ê∂àÊÅØÊú∫Âà∂Ëß£Êûê]]></title>
    <url>%2Fblog%2F2017%2F04%2F28%2FAndroid-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[Ê¶ÇËø∞ÊèêËµ∑ HandlerÔºåÁõ∏‰ø°Â§ßÂÆ∂ÈÉΩ‰∏ç‰ºöÈôåÁîüÔºåÊó•Â∏∏ÂºÄÂèë‰∏≠‰∏çÂèØÈÅøÂÖçÂú∞Ë¶Å‰ΩøÁî®Âà∞ÂÆÉ„ÄÇ‰ªäÂ§©Ë¶ÅËÆ≤ÁöÑÊòØÊ∂àÊÅØÊú∫Âà∂„ÄÇÊ∂àÊÅØÊú∫Âà∂ÔºüÂíãÂê¨Ëµ∑Êù•ÊúâÁÇπÊäΩË±°„ÄÇÂÖ∂ÂÆûÊàë‰ª¨Âú®‰ΩøÁî® Handler ÁöÑÊó∂ÂÄôÔºåÂ∞±‰ΩøÁî®‰∫Ü Android ÁöÑÊ∂àÊÅØÊú∫Âà∂„ÄÇ ‰ªéÂºÄÂèëÁöÑËßíÂ∫¶Êù•ÁúãÔºåHandler ÊòØ Android Ê∂àÊÅØÊú∫Âà∂ÁöÑ‰∏äÂ±ÇÊé•Âè£ÔºåËøô‰ΩøÂæóÂºÄÂèëËøáÁ®ã‰∏≠Âè™ÈúÄË¶ÅËÆæËÆ°ËøôÊñπÈù¢ÁöÑÂÜÖÂÆπÂç≥ÂèØ„ÄÇ‰ΩÜÊòØ‰Ωú‰∏∫‰∏ÄÂêçÂêàÊ†ºÁöÑÂºÄÂèëËÄÖÔºåÂºÑÊ∏ÖÂÆÉÁöÑÂÆûÁé∞ÂéüÁêÜÊòØÂæàÊúâÂøÖË¶ÅÁöÑ„ÄÇ ‰øóËØùËØ¥ÂæóÂ•ΩÔºå‰∏ÄÂõæËÉúÂçÉË®ÄÔºåÊàë‰ª¨ÂÖàÊù•Áúã‰∏ã Android Ê∂àÊÅØÊú∫Âà∂ÁÆÄÂçïÁ§∫ÊÑèÂõæÔºàÂõæÁâáÂèÇËÄÉËá™ËøôÁØáÊñáÁ´†Ôºâ„ÄÇ Êàë‰ª¨Êää Thread ÊØî‰ΩúÊòØ‰∏Ä‰∏™ ÂèëÂä®Êú∫ÔºåMessageQueue Áúã‰ΩúÊòØ‰∏ÄÊù°ÊµÅÊ∞¥Á∫øÔºåMessage Â∞±ÂÉèÊòØÊµÅÊ∞¥Á∫ø‰∏äÁöÑÂ∑•‰∫∫ÔºåLooper ÊòØÊµÅÊ∞¥Á∫ø‰∏ãÁöÑÊªöÁ≠íÔºåHandler ÂÉèÊòØ‰∏Ä‰∏™Â∑•‰∫∫ÔºåÂÆÉË¥üË¥£Êää Message Ëøô‰∏™‰∫ßÂìÅÈÄÅÂà∞ÊµÅÊ∞¥Á∫ø‰∏äÔºåÊúÄÂêéÂèàË¥üË¥£ÊääÂÆÉÂèñËµ∞„ÄÇ ËøôÂπÖÂõæ‰∏≠ÁöÑÂêÑ‰∏™ÁªÑ‰ª∂ÁöÑËØ¥ÊòéÂ¶Ç‰∏ãÔºö Looper ==„Äã ÊªöËΩÆ MessageQueue ==„Äã ÊµÅÊ∞¥Á∫ø Message ==&gt; ÊµÅÊ∞¥Á∫ø‰∏äÁöÑ‰∫ßÂìÅ Handler ==„Äã ÊâÆÊºîÊää„Äé‰∫ßÂìÅ„ÄèÈÄÅËøõÊµÅÊ∞¥Á∫øÔºåÂÆå‰∫Ü‰ª•ÂêéÂèàÊää„Äé‰∫ßÂìÅ„ÄèÂèñËµ∞ÁöÑËßíËâ≤ Thread ==„Äã Âä®Âäõ Âè¶Â§ñËøòÊúâ‰∏Ä‰∏™ÈáçË¶ÅÊ¶ÇÂøµ ‚Äî‚ÄîThreadLocal Âõæ‰∏≠Ê≤°ÊúâÊ†áÊòéÂá∫Êù•„ÄÇ‰∏ãÈù¢ÂØπÂêÑ‰∏™ÈÉ®ÂàÜËøõË°åËØ¶ÁªÜ‰ªãÁªç„ÄÇ Android ÁöÑÊ∂àÊÅØÊú∫Âà∂ÂàÜÊûê‰ªé Handler Âá∫ÂèëÁõ∏‰ø°ÂæàÂ§öÂÅö Android ÂºÄÂèëÁöÑÂêåÂ≠¶ÈÉΩÂÜôËøá‰∏é‰∏ãÈù¢Áõ∏‰ººÁöÑ‰ª£Á†Å„ÄÇÂú®Â≠êÁ∫øÁ®ã‰∏≠ÂÅö‰∏Ä‰∫õËÄóÊó∂Êìç‰ΩúÔºåÊØîÂ¶ÇÁΩëÁªúËØ∑Ê±ÇÔºåÊìç‰ΩúÂÆåÊàê‰πãÂêéÔºåÂ∞ÜËøîÂõûÁöÑÊï∞ÊçÆÂåÖË£Ö‰∏∫ Message ÂØπË±°ÁÑ∂ÂêéË∞ÉÁî® sendMessageXxx ÊñπÊ≥ïÔºåÊúÄÂêéÂú® handleMessage ÊñπÊ≥ï‰∏≠ÂØπÁªìÊûúËøõË°åÂ§ÑÁêÜ„ÄÇ 12345678910111213141516171819202122232425Handler mHandler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case 1: //handle break; default: super.handleMessage(msg); &#125; &#125;&#125;;public void do() &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; //do sth Message message = mHandler.obtainMessage(); message.what = 1; message.obj = result; mHandler.sendMessage(message); &#125; &#125;);&#125; ‰ªé Handler.sendMessage(message) Âà∞ Handler.handlerMessageÊñπÊ≥ïÁªèÂéÜ‰∫Ü‰ªÄ‰πàÊ†∑ÁöÑËøáÁ®ãÔºü Êàë‰ª¨ÂÖàÁúãÁúã sendMessage ÊñπÊ≥ïÂÜÖÈÉ®ÊòØÊÄé‰πàÂÆûÁé∞ÁöÑ„ÄÇ 12345678910111213141516171819202122232425262728293031public final boolean sendMessage(Message msg)&#123; return sendMessageDelayed(msg, 0);&#125;public final boolean sendMessageDelayed(Message msg, long delayMillis)&#123; if (delayMillis &lt; 0) &#123; delayMillis = 0; &#125; return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);&#125;public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + " sendMessageAtTime() called with no mQueue"); Log.w("Looper", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, uptimeMillis);&#125;private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis);&#125; Êï¥‰∏™Ë∞ÉÁî®ÊµÅÁ®ãÊòØËøôÊ†∑ÁöÑ sendMessage ==„Äã sendMessageDelayed ==„Äã sendMessageAtTime ==„Äã enqueueMessage ==„Äã MessageQueue.enqueueMessage Êàë‰ª¨ÂèØËÉΩËøò‰ºöË∞ÉÁî® Handler.post(Runnable)ÊñπÊ≥ïÂà∞ÁõÆÊ†áÁ∫øÁ®ã‰∏≠ÊâßË°å run ÊñπÊ≥ï„ÄÇpost ÊñπÊ≥ï‰ºöÂÖàË∞ÉÁî® getPostMessageÊñπÊ≥ïÂ∞Ü Runable ÂåÖË£Ö‰∏∫ ‰∏Ä‰∏™ Message ÂØπË±°ÔºåÔºàRunnable Â∞±Â≠òÂÇ®Âú® callback ‰∏≠Ôºâ„ÄÇÂÖ∂‰ªñÁöÑ postXxx(Runnable)ÊñπÊ≥ïÂÜÖÈÉ®ÂÆûÁé∞‰πüÊòØËøôÊ†∑ÁöÑÊµÅÁ®ãÔºåÈ¶ñÂÖàÂ∞Ü Runnable ÂåÖË£Ö‰∏∫‰∏Ä‰∏™ Message ÂØπË±°ÁÑ∂ÂêéË∞ÉÁî®Áõ∏Â∫îÁöÑ sendXxx ÊñπÊ≥ï„ÄÇ 123456789public final boolean post(Runnable r)&#123; return sendMessageDelayed(getPostMessage(r), 0);&#125;private static Message getPostMessage(Runnable r) &#123;//Â∞Ü Runnable ÂåÖË£Ö‰∏∫‰∏Ä‰∏™ Message ÂØπË±° Message m = Message.obtain(); m.callback = r; return m;&#125; ‰ªé‰∏äËø∞ÁöÑË∞ÉÁî®ÊµÅÁ®ãÂèØ‰ª•ÁúãÂá∫ sendXxx ÊàñËÄÖ postXxx ÊñπÊ≥ïÊúÄÁªàÈÉΩ‰ºöË∞ÉÁî® MessageQueue ÁöÑ enqueueMessageÊñπÊ≥ïÔºåÂ∞Ü Message ËøΩÂä†Âà∞ MessageQueue ‰∏≠„ÄÇ Â∞èÁªì Handler ÁöÑÊ∂àÊÅØÁöÑÂèëÈÄÅÂèØ‰ª•ÈÄöËøá post ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ï‰ª•Âèä send ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ïÊù•ÂÆûÁé∞„ÄÇ post Á≥ªÂàóÊñπÊ≥ïÊúÄÁªàÊòØÈÄöËøá send ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ïÊù•ÂÆûÁé∞ÁöÑ„ÄÇ Handler ÁöÑÂèëÈÄÅÊ∂àÊÅØÁöÑËøáÁ®ã‰ªÖ‰ªÖÊòØÂêëÊ∂àÊÅØÈòüÂàóÊèíÂÖ•‰∫Ü‰∏ÄÊù°Ê∂àÊÅØ„ÄÇ MessageQueue ÂØπË±°ÊòØ‰ªéÂì™ÈáåÊù•ÁöÑÔºümQueue ÊòØ Handler ÁöÑ‰∏Ä‰∏™ÊàêÂëòÂèòÈáèÔºåÂÆÉÊòØÂú®Âì™ÈáåÂàùÂßãÂåñÁöÑÂë¢ÔºüÂÖàÁúãÁúã Handler ÁöÑÊûÑÈÄ†ÊñπÊ≥ï 123456789101112131415public Handler() &#123; this(null, false);&#125;public Handler(Callback callback, boolean async) &#123; //‰ª£Á†ÅÁúÅÁï• mLooper = Looper.myLooper();//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ Looper if (mLooper == null) &#123; throw new RuntimeException(//ÊäõÂá∫ÂºÇÂ∏∏Ôºå‰∏çËÉΩÂú®Ê≤°Êúâ Looper ÁöÑÁ∫øÁ®ãÂàõÂª∫ Handler "Can't create handler inside thread that has not called Looper.prepare()"); &#125; mQueue = mLooper.mQueue;//‰ªéÊú¨Á∫øÁ®ãÁöÑ Looper ‰∏≠Ëé∑Âèñ MessageQueue mCallback = callback;//ÂõûË∞É mAsynchronous = async;//ÊòØÂê¶ÂºÇÊ≠•&#125; Êàë‰ª¨ÁúãÂà∞ mQueue ÊòØ‰ªé Looper ‰∏≠ÂèñÂá∫ÁöÑ„ÄÇÂú®Ëß£ËØ¥ Looper ‰πãÂâçÔºåÊàë‰ª¨ÂÖàÁúãÁúãÂâçÈù¢ÊèêÂà∞ÁöÑ MessageQueue „ÄÇ MessageQueue ÁöÑÂ∑•‰ΩúÂéüÁêÜMessageQueue ‰∏ªË¶ÅÂåÖÂê´‰∏§‰∏™Êìç‰ΩúÔºöÊèíÂÖ•ÂíåËØªÂèñÔºàÂàÜÂà´ÂØπÂ∫î enqueueMessage Âíå next ÊñπÊ≥ïÔºâ„ÄÇ È°æÂêçÊÄù‰πâÔºåenqueueMessage ÁöÑ‰ΩúÁî®ÊòØÂæÄÈòüÂàó‰∏≠ÊèíÂÖ•‰∏ÄÊù°‰ø°ÊÅØ„ÄÇ next() ÁöÑ‰ΩúÁî®ÊòØ‰ªéÈòüÂàó‰∏≠ÂèñÂá∫‰∏ÄÊù°‰ø°ÊÅØÂπ∂Â∞ÜÂÖ∂‰ªéÊ∂àÊÅØÈòüÂàó‰∏≠ÁßªÈô§„ÄÇ ËôΩÁÑ∂ MessageQueue Âêç‰∏∫Ê∂àÊÅØÈòüÂàóÔºå‰ΩÜÊòØÂÆÉÁöÑÂÜÖÈÉ®ÂÆûÁé∞Âπ∂‰∏çÊòØÁî®ÈòüÂàóÔºåËÄåÊòØÈÄöËøá‰∏Ä‰∏™ÂçïÈìæË°®ÁöÑÊï∞ÊçÆÁªìÊûÑÊù•Áª¥Êä§Ê∂àÊÅØÂàóË°®„ÄÇ ‰∏∫‰ªÄ‰πàÈÄâÊã©‰ΩøÁî®ÂçïÈìæË°®ÁªìÊûÑÔºü Âõ†‰∏∫ Message ÊòØÂèØ‰ª•ÂÆöÊó∂ÂèëÈÄÅÁöÑÔºåËã•‰ΩøÁî®ÊôÆÈÄöÁöÑÈòüÂàóÔºåÂΩìÊèíÂÖ•‰∏Ä‰∏™ÂèëÈÄÅÊó∂Èó¥Êôö‰∫éÈòüÈ¶ñ Message ÂèëÈÄÅÊó∂Èó¥ÁöÑÊñ∞ MessageÔºåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÊèíÈòüÔºåÂÆûÁé∞Ëµ∑Êù•‰∏çÊñπ‰æøÔºåËÄå‰ΩøÁî®‰ºòÂÖàÈòüÂàóÂèàÊòæÂæóÊØîËæÉÂ§çÊùÇ„ÄÇÂõ†Ê≠§Â∞±ÈááÁî®‰∫ÜÂçïÈìæË°®ÂÆûÁé∞„ÄÇ Êé•‰∏ãÊù•Êàë‰ª¨ÈáçÁÇπÁúãÁúã enqueueMessage ÊñπÊ≥ïÂíå next ÊñπÊ≥ï„ÄÇ enqueueMessage ÊñπÊ≥ïÔºö12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455boolean enqueueMessage(Message msg, long when) &#123; if (msg.target == null) &#123; // Ë¶ÅËøõÂÖ•ÈòüÂàóÁöÑÊ∂àÊÅØÂØπË±°ÁöÑÁõÆÊ†á handler ‰∏çËÉΩ‰∏∫Á©∫ throw new IllegalArgumentException("Message must have a target."); &#125; if (msg.isInUse()) &#123; // Ë¶ÅËøõÂÖ•ÈòüÁöÑÊ∂àÊÅØ‰∏çËÉΩÂ§ÑÂú®‰ΩøÁî®Áä∂ÊÄÅ throw new IllegalStateException(msg + " This message is already in use."); &#125; synchronized (this) &#123;//ÂÖ•ÈòüÈúÄË¶ÅÂÖàËé∑ÂèñÂÜÖÁΩÆÈîÅ if (mQuitting) &#123; // Â∑≤ÁªèË∞ÉÁî®Ëøá Looper.quit / Looper.quitSafely ÊñπÊ≥ï„ÄÇ MessageQueue ‰∏≠‰∏çËÉΩÂÜçËøΩÂä† Message ÂØπË±° IllegalStateException e = new IllegalStateException( msg.target + " sending message to a Handler on a dead thread"); Log.w(TAG, e.getMessage(), e); msg.recycle();//ÂõûÊî∂Ê∂àÊÅØ return false;//ËøîÂõû false Ë°®Á§∫ÂÖ•ÈòüÂ§±Ë¥• &#125; // Ê†áËÆ∞Ê∂àÊÅØ‰∏∫‰ΩøÁî®Áä∂ÊÄÅÔºõËÆæÁΩÆÊ∂àÊÅØÂèëÈÄÅÁöÑÊó∂Èó¥ÔºõÊòØÂê¶ÈúÄË¶ÅÂî§ÈÜí msg.markInUse(); msg.when = when; Message p = mMessages; boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; //Â∞ÜÊ∂àÊÅØÊèíÂÖ•Âà∞ÈòüÈ¶ñ msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; //ÈÄöËøáËØ•Âæ™ÁéØÊâæÂà∞ÂêàÈÄÇÁöÑÊèíÂÖ•‰ΩçÁΩÆÔºà‰ª•ÂèëÈÄÅÁöÑÊó∂Èó¥‰Ωú‰∏∫ÊéíÂ∫èÁöÑÊ†áÂáÜÔºâ for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; //ÊèíÂÖ•ÈòüÂàóÁöÑÊåáÂÆö‰ΩçÁΩÆ‰∏≠ msg.next = p; prev.next = msg; &#125; // We can assume mPtr != 0 because mQuitting is false. if (needWake) &#123; nativeWake(mPtr);//ÂΩìÂâçÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÔºåÈÄöËøá„ÄåÂÜôÊèèËø∞Á¨¶„ÄçÂî§ÈÜíÁ∫øÁ®ãÔºå‰ªéËÄå‰ΩøÂæó MessageQueue#next ÊñπÊ≥ï‰∏≠ÁöÑ nativePollOnce ËÉΩÂ§üËøîÂõû„ÄÇÔºàÂÆûÈôÖ‰∏äËøêÁî®‰∫Ü Linux ÁöÑ epoll Êú∫Âà∂Ôºâ &#125; &#125; return true;&#125; ‰ªé‰ª£Á†Å‰∏≠‰∏çÈöæÁúãÂá∫ÔºåenqueueMessaege ËôΩÁÑ∂ÊúâÁÇπÈïøÔºå‰ΩÜÊòØÈÄªËæëËøòÊòØÊØîËæÉÊ∏ÖÊô∞ÁöÑ„ÄÇÂÆÉÂÖàÂÅö‰∫Ü‰∏Ä‰∫õÁä∂ÊÄÅÂà§Êñ≠‰ª•Âèä‰∏Ä‰∫õËæπÁïåÊ£ÄÊµãÔºåÂÆå‰∫Ü‰ª•ÂêéÂÜçËøõË°åÂçïÈìæË°®ÁöÑÊèíÂÖ•Êìç‰Ωú„ÄÇ next ÊñπÊ≥ï1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465Message next() &#123; final long ptr = mPtr; if (ptr == 0) &#123; return null; &#125; //‰ª£Á†ÅÁúÅÁï• for (;;) &#123; if (nextPollTimeoutMillis != 0) &#123; Binder.flushPendingCommands(); &#125; //Â§ÑÁêÜ native Â±Ç‰∫ã‰ª∂ÔºàÂÜÖÈÉ®‰ΩøÁî® Linux ÁöÑ epoll Êú∫Âà∂ÔºâÔºåÂèØËÉΩ‰ºöÈòªÂ°û nativePollOnce(ptr, nextPollTimeoutMillis); synchronized (this) &#123; // Try to retrieve the next message. Return if found. final long now = SystemClock.uptimeMillis(); Message prevMsg = null; Message msg = mMessages; if (msg != null &amp;&amp; msg.target == null) &#123;//Â¶ÇÊûúÊ∂àÊÅØÁöÑÁõÆÊ†á Handler ‰∏∫Á©∫ do &#123; // ÊâæÂá∫ÈòüÂàó‰∏≠‰∏ã‰∏Ä‰∏™ÂºÇÊ≠• Message ÂØπË±° prevMsg = msg; msg = msg.next; &#125; while (msg != null &amp;&amp; !msg.isAsynchronous()); &#125; if (msg != null) &#123; if (now &lt; msg.when) &#123; // ËÆ°ÁÆó‰∏ã‰∏ÄÊù°Ê∂àÊÅØÁöÑÊâßË°åÊó∂Èó¥ÔºåËÆæÁΩÆ‰∏Ä‰∏™Âî§ÈÜíÁöÑÂª∂Ëøü nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE); &#125; else &#123; // ÈòüÈ¶ñ Message ÊâßË°åÁöÑÊó∂Êú∫Âà∞‰∫ÜÔºåËé∑Âèñ‰∏ÄÊù°Ê∂àÊÅØ mBlocked = false; if (prevMsg != null) &#123; prevMsg.next = msg.next; &#125; else &#123; mMessages = msg.next; &#125; msg.next = null; if (DEBUG) Log.v(TAG, "Returning message: " + msg); msg.markInUse();//Ê†áËÆ∞ Message ‰∏∫Ê≠£Âú®‰ΩøÁî®Áä∂ÊÄÅ return msg;//ËøîÂõûÊ∂àÊÅØ &#125; &#125; else &#123; // ÈòüÂàó‰∏≠Ê≤°ÊúâÊ∂àÊÅØ‰∫Ü nextPollTimeoutMillis = -1; &#125; // Â§ñÈÉ®Ë∞ÉÁî®‰∫Ü quit ÊñπÊ≥ï„ÄÇÈÄÄÂá∫ if (mQuitting) &#123; dispose(); //Â§ÑÁêÜÂ∫ïÂ±ÇÊ∂àÊÅØÈòüÂàó„ÄÇÂÆûÈôÖ‰∏äÁßªÈô§‰∫Ü native Â±ÇÁöÑÊ∂àÊÅØÈòüÂàó return null; &#125; if (pendingIdleHandlerCount &lt; 0 &amp;&amp; (mMessages == null || now &lt; mMessages.when)) &#123; pendingIdleHandlerCount = mIdleHandlers.size(); &#125; if (pendingIdleHandlerCount &lt;= 0) &#123; // Ê≤°ÊúâÂèØËøêË°åÁöÑÈó≤ÁΩÆ handler„ÄÇË∑≥Âá∫Êú¨Ê¨°Âæ™ÁéØÂÜçÁ≠âÂæÖ„ÄÇ mBlocked = true; continue; &#125; //‰ª£Á†ÅÁúÅÁï• &#125; &#125; next ÊñπÊ≥ï‰∏≠Êúâ‰∏Ä‰∏™Ê≠ªÂæ™ÁéØÔºåÂÖ∂‰∏ªË¶ÅÈÄªËæëÂ¶Ç‰∏ã: Â¶ÇÊûúÊ∂àÊÅØÈòüÂàó‰∏≠Ê≤°ÊúâÊ∂àÊÅØÔºåÈÇ£‰πà next ‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£Èáå„ÄÇ ÂΩìÈòüÈ¶ñÁöÑÊ∂àÊÅØËÆæÁΩÆ‰∫ÜÂª∂ËøüÊâßË°åÊó∂Ôºå‰ºöÈÄ†ÊàêÁü≠Êó∂Èó¥ÁöÑÈòªÂ°û„ÄÇ ÂΩìÊúâÊñ∞Ê∂àÊÅØÂà∞Êù•Êó∂Ôºånext ÊñπÊ≥ï‰ºöËøîÂõûËøôÊù°‰ø°ÊÅØÂπ∂Â∞ÜÂÖ∂‰ªéÂçïÈìæË°®‰∏≠ÁßªÈô§„ÄÇ ÂΩìË∞ÉÁî®‰∫Ü quit ÊñπÊ≥ï‰πãÂêéÔºåmQuitting ‰∏∫ true Ôºånext ÊñπÊ≥ï‰ºöÁßªÈô§ native Â±ÇÁöÑÊ∂àÊÅØÈòüÂàóÂπ∂ËøîÂõû null„ÄÇ Êï¥‰∏™ next ÊñπÊ≥ïÁöÑÈÄªËæëÂ¶Ç‰∏ãÔºö ‰ªéÊ∂àÊÅØÈòüÂàó‰∏≠‰æùÊ¨°ÂèñÂá∫Ê∂àÊÅØ„ÄÇÂ¶ÇÊûúËøô‰∏™Ê∂àÊÅØÂà∞‰∫ÜÊâßË°åÊó∂Èó¥ÔºåÈÇ£‰πàÂ∞±Â∞ÜËØ•Ê∂àÊÅØËøîÂõûÁªô LooperÔºåÂπ∂‰∏îÂ∞ÜÊ∂àÊÅØÈòüÂàóÈìæË°®ÁöÑÊåáÈíàÂêéÁßª„ÄÇÂÆûÈôÖ‰∏äÊ∂àÊÅØÈòüÂàóÁª¥Êä§ÁùÄ‰∏Ä‰∏™ÂàÜÂèëÂ±èÈöú(dispatch barrier)ÔºåÂΩì‰∏Ä‰∏™ Message ÁöÑÊó∂Èó¥Êà≥‰Ωé‰∫éËøô‰∏™ÂÄºÁöÑÊó∂ÂÄôÔºåÊ∂àÊÅØÂ∞±‰ºöË¢´ÂàÜÂèëÁªô Handler ËøõË°åÂ§ÑÁêÜ„ÄÇÂΩ¢Ë±°‰∏ÄÁÇπÔºüÁúãÁúã‰∏ãÈù¢ËøôÂº†ÂõæÔºàÂõæÁâáÊù•Ëá™ Android Handler InternalsÔºå‰æµÂà†Ôºâ ‰Ωç‰∫é dispatch barrier Â∑¶ËæπÁöÑ Message ÈÉΩË¢´ÈòªÂ°ûÁùÄÔºå‰Ωç‰∫éÂÖ∂Âè≥ËæπÁöÑÊòØÂç≥Â∞ÜÂàÜÂèëÁöÑ Message„ÄÇ Êàë‰ª¨ÊòØ‰∏çÊòØËØ•ËØ¥‰∏ã Looper ‰∫ÜÔºå‰∏ã‰∏ã‰∏™Â∞±Âà∞ÂÆÉ‰∫ÜÔºåÂú®Ê≠§‰πãÂâçÈúÄË¶ÅÂÖàÁúãÁúã ThreadLocal Áõ∏ÂÖ≥Áü•ËØÜ„ÄÇ ThreadLocal ÁÆÄ‰ªãThreadLocal ÊòØ‰∏Ä‰∏™Á∫øÁ®ãÂÜÖÈÉ®ÁöÑÊï∞ÊçÆÂ≠òÂÇ®Á±ªÔºåÈÄöËøáÂÆÉÂèØ‰ª•Âú®ÊåáÂÆöÁöÑÁ∫øÁ®ã‰∏≠Â≠òÂÇ®Êï∞ÊçÆÔºåÊï∞ÊçÆÂ≠òÂÇ®ÂêéÔºåÂè™ÊúâÂú®ÊåáÂÆöÁ∫øÁ®ã‰∏≠ÊâçËÉΩËé∑ÂèñÂà∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÂØπ‰∫éÂÖ∂‰ªñÁ∫øÁ®ãÊù•ËØ¥ÂàôÊó†Ê≥ïËé∑ÂèñÂà∞Êï∞ÊçÆ„ÄÇ ‰ΩøÁî®Âú∫ÊôØÔºö ÂΩìÊüê‰∫õÊï∞ÊçÆÊòØ‰ª•Á∫øÁ®ã‰∏∫‰ΩúÁî®ÂüüÂπ∂‰∏î‰∏çÂêåÁ∫øÁ®ãÂÖ∑Êúâ‰∏çÂêåÁöÑÊï∞ÊçÆÂâØÊú¨ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ËÄÉËôëÈááÁî® ThrradLocal„ÄÇ Âú® Android ‰∏≠ÔºåLooper Á±ªÂ∞±ÊòØÂà©Áî®‰∫Ü ThreadLocal ÁöÑÁâπÊÄßÔºå‰øùËØÅÊØè‰∏™Á∫øÁ®ãÂè™Â≠òÂú®‰∏Ä‰∏™ Looper ÂØπË±°„ÄÇ Â§çÊùÇÈÄªËæë‰∏ãÁöÑÂØπË±°‰º†ÈÄí„ÄÇ ÊØîÂ¶ÇÁõëÂê¨Âô®ÁöÑ‰º†ÈÄí„ÄÇ ‰ªé ThreadLocal ÁöÑ set Âíå get ÊñπÊ≥ï ÂèØ‰ª•ÁúãÂá∫ÔºåÂÆÉ‰ª¨ÊâÄÊìç‰ΩúÁöÑÂØπË±°ÈÉΩÊòØÂΩìÂâçÁ∫øÁ®ãÁöÑ localValues ÂØπË±°ÁöÑ table Êï∞ÁªÑÔºåÂõ†Ê≠§Âú®‰∏çÂêåÁöÑÁ∫øÁ®ã‰∏≠ËÆøÈóÆÂêå‰∏Ä‰∏™ ThreadLocal ÁöÑ get Âíå set ÊñπÊ≥ïÔºå‰ªñ‰ª¨ÂØπ ThreadLocal ÊâÄÂÅöÁöÑËØª/ÂÜôÊìç‰Ωú‰ªÖÈôê‰∫éÂêÑËá™Á∫øÁ®ãÁöÑÂÜÖÈÉ®„ÄÇ ÂÖ≥‰∫é ThreadLocal ÁöÑÂÖ∑‰Ωì‰ªãÁªçËØ∑ËßÅ ËøôÁØáÊñáÁ´† ÁêÜËß£ ThreadLocal ÂØπÂêéÈù¢ÁêÜËß£ Looper ÊúâÂæàÂ§ßÁöÑÂ∏ÆÂä©ÔºåÂª∫ËÆÆÂÖàÁªÜÁúã ThreadLocal ÁöÑÂÜÖÂÆπÂÜçÁúãÂêéÈù¢ÁöÑÂÜÖÂÆπ„ÄÇ Looper ÁöÑÂ∑•‰ΩúÂéüÁêÜAndroid ÁöÑÂÆòÊñπÊñáÊ°£‰∏≠ÊòØËøô‰πà‰ªãÁªç Looper ÁöÑÔºö Looper ÊòØ‰∏Ä‰∏™Áî®Êù•‰∏∫Âçï‰∏™Á∫øÁ®ãËøêË°åÊ∂àÊÅØÂæ™ÁéØÁöÑÁ±ª„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÁ∫øÁ®ãÊòØÊ≤°Êúâ‰∏Ä‰∏™ Looper Ë∑ü‰ªñ‰ª¨Áõ∏ÂÖ≥ËÅîÁöÑ„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Á∫øÁ®ãÈúÄË¶Å looper ÁöÑËØùÔºåÂèØ‰ª•ÈÄöËøáÂÖàË∞ÉÁî® prepare() ÊñπÊ≥ïÂàùÂßãÂåñ‰∏Ä‰∏™Êú¨Á∫øÁ®ãÁöÑ Looper ÂÆû‰æã„ÄÇÁÑ∂ÂêéË∞ÉÁî® loop ÊñπÊ≥ïËÆ©ÂÆÉÂºÄÂßãÂ§ÑÁêÜ‰ø°ÊÅØÔºå‰∏ÄÁõ¥Âà∞Âæ™ÁéØÁªìÊùü„ÄÇ Êàë‰ª¨ÈÄöÂ∏∏ÈÄöËøá Handler Á±ª‰∏é Looper ÁöÑÊâì‰∫§ÈÅì„ÄÇ ‰∏Ä‰∏™ Á∫øÁ®ãÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™ LooperÔºå‰∏Ä‰∏™ Looper ‰∏≠Êúâ‰∏Ä‰∏™Ê∂àÊÅØÈòüÂàóÔºàÂâçÈù¢ Hanlder ‰∏≠ÁöÑ MessageQueue ÂØπË±°Â∞±ÊòØ‰ªé Looper ‰∏≠ÂèñÂá∫ÁöÑÔºâÔºåÂπ∂‰∏îÊåÅÊúâÂÆÉÊâÄÂú®Á∫øÁ®ãÁöÑÂºïÁî®„ÄÇLooper Â∞±ÂÉè‰∏Ä‰∏™„ÄåÊ≠ªÂæ™ÁéØ„ÄçÔºàÈÄöËøá quit ÊàñËÄÖ quitSafely ÊñπÊ≥ïÂèØ‰ª•ÈÄÄÂá∫ÔºâÔºåÂÆÉ‰ºö‰∏çÊñ≠Âú∞‰ªé MessageQueue ‰∏≠Êü•ÁúãÊòØÂê¶ÊúâÊñ∞Ê∂àÊÅØ„ÄÇÂ¶ÇÊûúÊúâÔºåÂ∞±Ë∞ÉÁî® handler.dispatchMessage ÊñπÊ≥ïËøõË°åÂ§ÑÁêÜÔºõÂ¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£Èáå„ÄÇ ÂàõÂª∫ LooperÊàë‰ª¨ÂÖàÁúãÁúã Looper ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºö 1234private Looper(boolean quitAllowed) &#123; mQueue = new MessageQueue(quitAllowed);//ÂàõÂª∫‰∏Ä‰∏™Ê∂àÊÅØÈòüÂàó mThread = Thread.currentThread(); //ÊääÂΩìÂâçÁ∫øÁ®ãÁöÑÂØπË±°‰øùÂ≠òËµ∑Êù•&#125; Looper ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂàõÂª∫‰∫Ü‰∏Ä‰∏™Ê∂àÊÅØÈòüÂàóÔºåÂπ∂‰∏î‰ºö‰øùÂ≠òÂΩìÂâçÁ∫øÁ®ãÂØπË±°„ÄÇ ÂàõÂª∫ÊôÆÈÄöÁ∫øÁ®ã‰∏äÁöÑ LooperLooper ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÊòØÁßÅÊúâÁöÑÔºåÈÇ£‰πàË¶ÅÂàõÂª∫‰∏Ä‰∏™ Looper„ÄÇÔºüË∞ÉÁî® Looper.prepare()Âç≥ÂèØ‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper ÂØπË±°ÔºåÊé•ÁùÄÈÄöËøá Looper.loop() ÊñπÊ≥ïÂºÄÂêØÊ∂àÊÅØÂæ™ÁéØ„ÄÇË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºöÂú®Â≠êÁ∫øÁ®ã‰∏≠ÔºåÂ¶ÇÊûúÊâãÂä®‰∏∫ÂÖ∂ÂàõÂª∫‰∫Ü LooperÔºåÈÇ£‰πàÂú®ÊâÄÊúâÁöÑ‰ªªÂä°ÂÆåÊàê‰πãÂêéÔºåÈúÄË¶ÅË∞ÉÁî® quit ÊñπÊ≥ïÊù•ÁªàÊ≠¢Ê∂àÊÅØÂæ™ÁéØÔºåÂê¶ÂàôËøô‰∏™Â≠êÁ∫øÁ®ãÂ∞±‰ºö‰∏ÄÁõ¥Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅ„ÄÇ Êàë‰ª¨Áúã‰∏ã prepare ÊñπÊ≥ïÂÆûÁé∞ 1234567891011121314public static void prepare() &#123; prepare(true);&#125;private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException("Only one Looper may be created per thread");//‰∏Ä‰∏™Á∫øÁ®ãÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™ Looper &#125; sThreadLocal.set(new Looper(quitAllowed));//‰∏∫ÂΩìÂâçÁ∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™ Looper &#125;public static @Nullable Looper myLooper() &#123;//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁöÑ Looper ÂØπË±° return sThreadLocal.get();&#125; ÂàõÂª∫‰∏ªÁ∫øÁ®ã‰∏äÁöÑ LooperÊúâ‰∏Ä‰∏™Ë¶ÅÊ≥®ÊÑèÁöÑÂú∞ÊñπÂ∞±ÊòØ Looper ÁöÑÂè¶‰∏Ä‰∏™ÂàõÂª∫ÊñπÊ≥ï ‚Äî‚Äî prepareMainLooper„ÄÇ prepareMainLooper Âú®Â∫îÁî®ÁöÑÂÖ•Âè£ÊñπÊ≥ïÔºàActivityThread.main() Ôºâ‰∏≠Ë¢´Ë∞ÉÁî®ÔºåÁî®Êù•ÂêØÂä®‰∏ªÁ∫øÁ®ãÁöÑÊ∂àÊÅØÂæ™ÁéØ„ÄÇ 123456789101112131415public static void main(String[] args) &#123; //‰ª£Á†ÅÁúÅÁï• Process.setArgV0("&lt;pre-initialized&gt;"); Looper.prepareMainLooper();//ÂàõÂª∫‰∏ªÁ∫øÁ®ãÁöÑ Looper ActivityThread thread = new ActivityThread(); thread.attach(false); if (sMainThreadHandler == null) &#123; sMainThreadHandler = thread.getHandler();//ÂàõÂª∫‰∏ªÁ∫øÁ®ãÁöÑ Handler &#125; //‰ª£Á†ÅÁúÅÁï• Looper.loop();//ÂºÄÂêØ‰∏ªÁ∫øÁ®ãÊ∂àÊÅØÂæ™ÁéØ&#125; 123456789101112131415public static void prepareMainLooper() &#123; prepare(false); synchronized (Looper.class) &#123; if (sMainLooper != null) &#123; throw new IllegalStateException("The main Looper has already been prepared."); &#125; sMainLooper = myLooper(); &#125;&#125;public static Looper getMainLooper() &#123;//ËØ•ÊñπÊ≥ï‰ΩøÂæóÂú®‰ªª‰ΩïÂú∞ÊñπÈÉΩÂèØ‰ª•Ëé∑Âæó‰∏ªÁ∫øÁ®ãÁöÑÊ∂àÊÅØÂæ™ÁéØ synchronized (Looper.class) &#123; return sMainLooper; &#125;&#125; Â∞èÁªìÂú®Â∫îÁî®ÂêØÂä®Êó∂‰ºöÂºÄÂêØ‰∏Ä‰∏™‰∏ªÁ∫øÁ®ãÔºàUI Á∫øÁ®ãÔºâÔºåÂπ∂‰∏îÂºÄÂêØÊ∂àÊÅØÂæ™ÁéØÔºåÂ∫îÁî®‰∏çÊñ≠Âú∞‰ªéËØ•Ê∂àÊÅØÈòüÂàó‰∏≠ÂèñÂá∫„ÄÅÂ§ÑÁêÜÊ∂àÊÅØËææÂà∞Á®ãÂ∫èËøêË°åÁöÑÁªìÊûú„ÄÇ loop ÊñπÊ≥ïÂâçÈù¢ÊâÄËÆ≤ÈÉΩÊòØ Looper Ëá™Ë∫´ÁöÑ‰∏Ä‰∫õÁâπÊÄßÔºåÊ≤°ÊúâÊèêÂà∞ÂÆÉÊòØÊÄé‰πàË∑üÂÖ∂‰ªñÈÉ®ÂàÜ‰∫§‰∫íÁöÑ„ÄÇLooper ‰∏éÂÖ∂‰ªñ MessageQueue „ÄÅHanlder ÁöÑ‰∫§‰∫í‰∏ªË¶ÅÂú® loop ÊñπÊ≥ï‰∏≠„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÁúã loop ÊñπÊ≥ïÁöÑÊ∫êÁ†Å„ÄÇ 12345678910111213141516171819202122232425262728293031323334public static void loop() &#123; final Looper me = myLooper();//Ëé∑ÂèñÊú¨Á∫øÁ®ãÁöÑ Looper if (me == null) &#123; throw new RuntimeException("No Looper; Looper.prepare() wasn't called on this thread.");//Ë∞ÉÁî® loop ÊñπÊ≥ï‰πãÂâçÂøÖÈ°ªÂÖàË∞ÉÁî® Looper.prepare() ÊñπÊ≥ïÂàõÂª∫ Looper &#125; final MessageQueue queue = me.mQueue;//Ëé∑ÂèñÊâÄÂú®Á∫øÁ®ãÁöÑÊ∂àÊÅØÈòüÂàó // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); for (;;) &#123; Message msg = queue.next(); // ÈòªÂ°ûÊñπÊ≥ïÔºåÂ¶ÇÊûúÊ≤°ÊúâËé∑ÂèñÂà∞Ê∂àÊÅØÔºåÂ∞±‰∏ÄÁõ¥ÈòªÂ°ûÂú®ËøôÈáå if (msg == null) &#123; //Âè™ÊúâÂΩì msg == null Êó∂Êâç‰ºöÈÄÄÂá∫Âæ™ÁéØ return; &#125; // ‰ª£Á†ÅÁúÅÁï• try &#123; msg.target.dispatchMessage(msg);// ËøôÈáåÁöÑ msg.target ÊòØÂèëÈÄÅËøôÊù°‰ø°ÊÅØÁöÑ Handler ÂØπË±°ÔºåËøôÊ†∑ Handler ÂèëÈÄÅÁöÑÊ∂àÊÅØÊúÄÁªàÂèà‰∫§ÁªôÂÆÉÁöÑ dispatchMessage ÊñπÊ≥ïÊù•Â§ÑÁêÜ‰∫Ü„ÄÇ &#125; finally &#123; // ‰ª£Á†ÅÁúÅÁï• &#125; // ‰ª£Á†ÅÁúÅÁï• // Make sure that during the course of dispatching the // identity of the thread wasn't corrupted. final long newIdent = Binder.clearCallingIdentity(); // ‰ª£Á†ÅÁúÅÁï• msg.recycleUnchecked();//Ë∞ÉÁî® Message ÁöÑÂõûÊî∂ÊñπÊ≥ï &#125;&#125; Áî±Ê∫êÁ†ÅÂèØËßÅ loop ÊñπÊ≥ïÊòØ‰∏Ä‰∏™Ê≠ªÂæ™ÁéØÔºåÂîØ‰∏ÄË∑≥Âá∫Âæ™ÁéØÁöÑÊñπÂºèÊòØ MessageQueue ÁöÑ next ÊñπÊ≥ïËøîÂõû‰∫Ü null„ÄÇ ÂΩìÊàë‰ª¨Ë∞ÉÁî® Looper ÁöÑ quit ÊñπÊ≥ïÊó∂ÔºåLooper ‰ºöË∞ÉÁî® MessageQueue ÁöÑ quit Êàñ quitSafely ÊñπÊ≥ïÊù•ÈÄöÁü•Ê∂àÊÅØÈòüÂàóÈÄÄÂá∫ÔºåÂê¶Âàô loop ÊñπÊ≥ï‰ºö‰∏ÄÁõ¥Âæ™ÁéØ‰∏ãÂéª„ÄÇ Âè¶Â§ñÔºå‰ª£Á†Å‰∏≠ÂèØ‰ª•ÁúãÂà∞Ôºåloop Ë∞ÉÁî®‰∫Ü MessageQueue ÁöÑ next ÊñπÊ≥ïÊù•Ëé∑ÂèñÊñ∞Ê∂àÊÅØÔºåËÄå next ÊòØ‰∏Ä‰∏™ÈòªÂ°ûÊìç‰ΩúÔºåÂΩìÊ≤°ÊúâÊ∂àÊÅØÊó∂Ôºånext ÊñπÊ≥ï‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£ÈáåÔºåËøô‰πüÂØºËá¥‰∫Ü loop ÊñπÊ≥ï‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£Èáå„ÄÇ msg.target.dispatchMessage(msg);// ËøôÈáåÁöÑ msg.target ÊòØÂèëÈÄÅËøôÊù°‰ø°ÊÅØÁöÑ Handler ÂØπË±°ÔºåËøôÊ†∑ Handler ÂèëÈÄÅÁöÑÊ∂àÊÅØÊúÄÁªàÂèà‰∫§ÁªôÂÆÉÁöÑ dispatchMessage ÊñπÊ≥ïÊù•Â§ÑÁêÜ‰∫Ü„ÄÇ Áªï‰∫ÜËøô‰πà‰∏Ä‰∏™Â§ßÂúàÊÑè‰πâ‰ΩïÂú®ÔºüÈÄöÂ∏∏Êàë‰ª¨ÈÉΩ‰ºöÂú®Â≠êÁ∫øÁ®ã‰∏≠Ë∞ÉÁî® Handler.sendMessageXxx ÊàñËÄÖ Handler.postXxx ÊñπÊ≥ïÔºå ËÄåHandler ÁöÑ dispatchMessage ÊñπÊ≥ïÊòØÂú®ÂàõÂª∫ Handler ÁöÑÈÇ£‰∏™Á∫øÁ®ã‰∏≠ÊâßË°åÁöÑÔºåËøôÊ†∑Â∞±È°∫Âà©Âú∞Â∞Ü‰ª£Á†ÅÂàáÊç¢Âà∞ÁõÆÊ†áÁ∫øÁ®ã‰∏≠ÂéªÊâßË°å‰∫Ü„ÄÇ ÈÄÄÂá∫ LooperLooper ‰πüÊòØÂèØ‰ª•ÈÄÄÂá∫ÁöÑÔºàËøôÈáåÁöÑÈÄÄÂá∫ Looper ‰∏ªË¶ÅÊòØÊåáË∑≥Âá∫ loop ÊñπÊ≥ï‰∏≠ÁöÑÊ≠ªÂæ™ÁéØÔºâ„ÄÇÈÄöËøáË∞ÉÁî® Looper ÁöÑ quit ÊñπÊ≥ïÊàñËÄÖ quitSafely ÊñπÊ≥ïÂç≥ÂèØ„ÄÇÈÇ£‰πàËøô‰∫åËÄÖÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü Ë∞ÉÁî® Looper ÁöÑ quit ÊñπÊ≥ïÂèØ‰ª•Áõ¥Êé•ÈÄÄÂá∫Looper„ÄÇ Ë∞ÉÁî® Looper ÁöÑ quitSafely ÊñπÊ≥ïÂè™ÊòØËÆæÂÆö‰∫Ü‰∏Ä‰∏™ÈÄÄÂá∫Ê†áËÆ∞ÔºåÁÑ∂ÂêéÊääÊ∂àÊÅØÈòüÂàó‰∏≠Â∑≤ÊúâÁöÑÊ∂àÊÅØÂ§ÑÁêÜÂÆåÊâçÈÄÄÂá∫ Looper„ÄÇ Êàë‰ª¨Êù•ÁúãÁúãËøô‰∏§‰∏™ÊñπÊ≥ïÁöÑÂÆûÁé∞ 12345678//Looper.quitpublic void quit() &#123; mQueue.quit(false);&#125;//Looper.quitSafelypublic void quitSafely() &#123; mQueue.quit(true);&#125; mQueue ÁöÑÂÆûÈôÖÁ±ªÂûã‰∏∫ MessageQueueÔºåLooper ÁöÑ‰∏§‰∏™ quit ÊñπÊ≥ïÈÉΩÊòØÈÄöËøáË∞ÉÁî® MessageQueue ÁöÑ quit ÊñπÊ≥ïÊù•ÂÆûÁé∞ÁöÑ„ÄÇ 1234567891011121314151617181920void quit(boolean safe) &#123; if (!mQuitAllowed) &#123; throw new IllegalStateException("Main thread not allowed to quit.");//‰∏ªÁ∫øÁ®ãÁöÑ Looper Êó†Ê≥ïÈÄÄÂá∫„ÄÇ‰∏ªÁ∫øÁ®ãÁöÑ Looper ÊòØÈÄöËøá prepareMainLooper ÊñπÊ≥ïÂàõÂª∫ÁöÑÔºåÂàõÂª∫Êó∂Ë∞ÉÁî®‰∫Ü prepareÔºàfalseÔºâÔºå‰πüÂ∞±ÊòØ‰ª§ mQuitAllowed = false &#125; synchronized (this) &#123; if (mQuitting) &#123;//ÊòØÂê¶Ê≠£Âú®ÈÄÄÂá∫ return; &#125; mQuitting = true; if (safe) &#123; //ÂÆâÂÖ®ÈÄÄÂá∫,‰∏ç‰ºöÂèñÊ∂àÊâßË°åÊó∂Êú∫Êó©‰∫éÊàñÁ≠â‰∫éÂΩìÂâçÊó∂Èó¥ÁöÑ Message removeAllFutureMessagesLocked(); &#125; else &#123; removeAllMessagesLocked();//ÁßªÈô§ MessageQueue ‰∏≠ÊâÄÊúâÁöÑÊ∂àÊÅØ &#125; // We can assume mPtr != 0 because mQuitting was previously false. nativeWake(mPtr); &#125;&#125; MessageQueue.next() ÊñπÊ≥ïÁâáÊÆµ„ÄÇÂΩìË∞ÉÁî®‰∫Ü quit ÊñπÊ≥ï‰πãÂêé‰ºö‰ΩøÂæó mQuitting ‰∏∫ trueÔºå‰ªéËÄåÂØºËá¥ next ÊñπÊ≥ïËøîÂõû nullÔºå‰∏ÄÊó¶ next ÊñπÊ≥ïËøîÂõû nullÔºå Looper.loop Â∞±Ë∑≥Âá∫‰∫ÜÊ≠ªÂæ™ÁéØ„ÄÇ 1234if (mQuitting) &#123; dispose();//ÈîÄÊØÅ native Â±ÇÁöÑÊ∂àÊÅØÈòüÂàó„ÄÇ return null;&#125; MessageQueue.enqueueMessage ÊñπÊ≥ïÁâáÊÆµ 1234567if (mQuitting) &#123; IllegalStateException e = new IllegalStateException( msg.target + " sending message to a Handler on a dead thread"); Log.w(TAG, e.getMessage(), e); msg.recycle(); return false;&#125; ‰ªéËøôÈáåÂÆûÁé∞ÂèØ‰ª•ÁúãÂà∞ÔºåË∞ÉÁî®‰∫Ü Looper.quit / quitSafely ÊñπÊ≥ï‰πãÂêéÔºåÂÜçÈÄöËøá Handler ÂèëÈÄÅÁöÑÊ∂àÊÅØÊó†Ê≥ïÊ∑ªÂä†Âà∞ MessageQueue ‰∏≠ÔºåÊ≠§Êó∂ Handler ÁöÑ send ÊñπÊ≥ï‰ºöËøîÂõû false„ÄÇ android.os.MessageQueue#dispose 123456789// ÈîÄÊØÅÂ∫ïÂ±ÇÁöÑÊ∂àÊÅØÈòüÂàó// Must only be called on the looper thread or the finalizer.//Âè™ËÉΩÂú®‰∏ç looper Á∫øÁ®ãÊàñËÄÖ finalizer ‰∏≠Ë∞ÉÁî®private void dispose() &#123; if (mPtr != 0) &#123; nativeDestroy(mPtr); mPtr = 0; &#125;&#125; ÂõûÂà∞ Handler Looper ÁöÑ loop ÊñπÊ≥ï‰∏≠ÊúâËøôÊ†∑‰∏ÄË°å‰ª£Á†Å msg.target.dispatchMessage(msg);ËØ•ÊñπÊ≥ïË∞ÉÁî®ÁöÑÂ∞±ÊòØ Handler.dispatchMessage ÊñπÊ≥ï„ÄÇdispatchMessage ÊñπÊ≥ï‰ºöÊ†πÊçÆÊÉÖÂÜµÂØπ Message ËøõË°åÂàÜÂèë„ÄÇ Handler.class ‰ª£Á†ÅÁâáÊÆµ 12345678910111213141516171819202122232425262728293031323334/** * Handle system messages here. */public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; handleCallback(msg);//ÂõûË∞ÉÊâßË°å Runnable ÁöÑ run ÊñπÊ≥ï &#125; else &#123; if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123;//ÊâßË°åÂàõÂª∫ Handler Êó∂ÊåáÂÆöÁöÑ Callback#handleMessage ÊñπÊ≥ï„ÄÇ return; &#125; &#125; handleMessage(msg);//ÊâßË°å handleMessage(msg) ÊñπÊ≥ï &#125;&#125;public void handleMessage(Message msg) &#123;//Á©∫ÂÆûÁé∞ÔºåÈúÄË¶ÅÁî±Â≠êÁ±ªË¶ÜÂÜô&#125;private static void handleCallback(Message message) &#123; message.callback.run(); // callback ÁöÑÂÆûÈôÖÁ±ªÂûã‰∏∫ RunnableÔºåËøôË°å‰ª£Á†ÅÁöÑ‰ΩúÁî®Â∞±ÊòØÂõûË∞É Runnable ÁöÑ run ÊñπÊ≥ï&#125;/** * Callback interface you can use when instantiating a Handler to avoid * having to implement your own subclass of Handler. */public interface Callback &#123; /** * @param msg A &#123;@link android.os.Message Message&#125; object * @return True if no further handling is desired */ public boolean handleMessage(Message msg);&#125; dispatchMessage ÊñπÊ≥ïÁöÑÈÄªËæëÔºöÂ¶ÇÊûú Message Ëá™Ë∫´ËÆæÁΩÆ‰∫Ü callbackÔºåÈÇ£‰πà‰∫ã‰ª∂‰ºöÁõ¥Êé•ÂàÜÊ¥æÁªô msg#callback#run ÊñπÊ≥ïÂ§ÑÁêÜ„ÄÇÂê¶ÂàôÔºåÂ¶ÇÊûúÁªô Handler ËÆæÁΩÆ‰∫Ü Callback ÁöÑËØùÔºå‰ºöÂÖàÂ∞Ü‰∫ã‰ª∂ÂàÜÊ¥æÁªô Callback#handleMessage ÊñπÊ≥ïÂ§ÑÁêÜÔºåÂ¶ÇÊûúËøîÂõûÂÄº‰∏∫ trueÔºåËØ¥Êòé‰∏çÈúÄË¶ÅÂÜçÂÅöËøõ‰∏ÄÊ≠•ÁöÑÂ§ÑÁêÜÔºåÂ¶ÇÊûúËøîÂõû falseÊàñËÄÖÊòØÊ≤°ÊúâÁªô Handler ËÆæÁΩÆcallback ÁöÑ ËØùÔºåÂàô‰ºöÊâßË°å Handler#handleMessage ÊñπÊ≥ï„ÄÇ Handler ÁöÑ Callback Êúâ‰ªÄ‰πà‰ΩúÁî®Âë¢Ôºü Êèê‰æõ‰∫ÜÂè¶‰∏ÄÁßç‰ΩøÁî® handler Â§ÑÁêÜÊ∂àÊÅØÁöÑÊñπÂºèÔºåÂú®ÂÆû‰æãÂåñ Handler Êó∂ÂèØ‰ª•‰ΩøÁî®Callback ÔºåËÄå‰∏çÊòØËá™Â∑±ÂÆûÁé∞‰∏Ä‰∏™ handler Â≠êÁ±ª„ÄÇ ÂèØ‰ª•ÂÅö‰∏Ä‰∫õÊ∂àÊÅØËøáÊª§„ÄÇ Handler Â∞èÁªìHandler ÁöÑÂ∑•‰Ωú‰∏ªË¶ÅÂåÖÂê´Ê∂àÊÅØÁöÑÂèëÈÄÅÂíåÊé•Êî∂ËøáÁ®ãÔºàËøòÊúâ‰∏Ä‰∏™„ÄåÂàÜÂèëËøáÁ®ã„ÄçÔºâ„ÄÇ Ê∂àÊÅØÁöÑÂèëÈÄÅÂèØ‰ª•ÈÄöËøá post ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ï‰ª•Âèä send ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ïÊù•ÂÆûÁé∞„ÄÇ post Á≥ªÂàóÊñπÊ≥ïÊúÄÁªàÊòØÈÄöËøá send ÁöÑ‰∏ÄÁ≥ªÂàóÊñπÊ≥ïÊù•ÂÆûÁé∞ÁöÑ„ÄÇ Êü•ÁúãÊ∫êÁ†Å‰∏çÈöæÂèëÁé∞ÔºåHandler ÁöÑÂèëÈÄÅÊ∂àÊÅØÁöÑËøáÁ®ã‰ªÖ‰ªÖÊòØÂêë MessageQueue ÊèíÂÖ•‰∫Ü‰∏ÄÊù° MessageÔºåMessageQueue ÁöÑ next ÊñπÊ≥ïÂ∞±‰ºöËøîÂõûÊ≠§ Message Áªô LooperÔºå Looper Âú® loop ÊñπÊ≥ï‰∏≠ÂØπ Message ËøõË°åÂ§ÑÁêÜÔºåÊúÄÁªàÁî± Looper ‰∫§ÂõûÁªô Handler Â§ÑÁêÜÔºàË∞ÉÁî® Handler ÁöÑ dispatchMessage ÊñπÊ≥ïÔºâ„ÄÇ Êï∞ÈáèÂÖ≥Á≥ª‰∏Ä‰∏™Á∫øÁ®ãÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™ Looper Ôºå‰∏Ä‰∏™ MessageQueueÔºåÂèØ‰ª•ÊúâÂ§ö‰∏™ Handler„ÄÇ MessageQueue Â∞ÅË£ÖÂú® Looper ‰∏≠„ÄÇ ÈóÆÈ¢ò‰∏∫‰ªÄ‰πà‰∏ªÁ∫øÁ®ã‰∏ç‰ºöÂõ†‰∏∫ Looper.loop()ÈáåÁöÑÊ≠ªÂæ™ÁéØÂç°Ê≠ªÔºüÈòªÂ°ûÊòØÊúâÁöÑÔºå‰ΩÜÊòØ‰∏ç‰ºöÂç°‰Ωè‰∏ªË¶ÅÂéüÂõ†Êúâ 2 ‰∏™Ôºö 1.Linux ÁöÑ epoll Êú∫Âà∂ÂΩìÊ≤°ÊúâÊ∂àÊÅØÁöÑÊó∂ÂÄô‰ºö epoll.waitÔºåÁ≠âÂæÖÂè•ÊüÑÂÜôÁöÑÊó∂ÂÄôÂÜçÂî§ÈÜíÔºåËøô‰∏™Êó∂ÂÄôÂÖ∂ÂÆûÊòØÈòªÂ°ûÁöÑ„ÄÇ 2.ÊâÄÊúâÁöÑ ui Êìç‰ΩúÈÉΩÈÄöËøá handler Êù•ÂèëÊ∂àÊÅØÊìç‰Ωú„ÄÇÊØîÂ¶ÇÂ±èÂπïÂà∑Êñ∞ 16ms ‰∏Ä‰∏™Ê∂àÊÅØÔºå‰Ω†ÁöÑÂêÑÁßçÁÇπÂáª‰∫ã‰ª∂ÔºåÂ∞±‰ºöÊúâÂè•ÊüÑÂÜôÊìç‰ΩúÔºåÂî§ÈÜí‰∏äÊñáÁöÑ wait Êìç‰ΩúÔºåÊâÄ‰ª•‰∏ç‰ºöË¢´Âç°Ê≠ª‰∫Ü„ÄÇ ‰∏Ä‰∏™ÊØîËæÉÂΩ¢Ë±°ÁöÑÊØîÂñªÔºö Â∞±ÂÉè‰∏ÄËæÜËΩ¶Âú®ÂúÜÂΩ¢ËµõËΩ¶ÈÅì‰∏äË∑ëÔºå‰∏ÄËæπË∑ë(‰∏ÄËæπÊâßË°å‰ªªÂä°)ÔºåÊØîÂ¶ÇÂºÄÂà∞Â∏Ç‰∏≠ÂøÉ‰π∞Áì∂Ê∞¥Ôºå‰ªªÂä°ÂÆåÊàêÂèàÂõûÂà∞ÂàöÂàöÁ¶ªÂºÄÁöÑÂú∞ÊñπÔºåÁªßÁª≠ÂêÑÁßçÊâßË°å‰π∞Ê∞¥ÁöÑ‰ªªÂä°ÔºåÁõ¥Âà∞Ê≤°Êúâ‰ªªÂä°‰∫ÜÔºàmsg ‰∏∫Á©∫ÔºâÔºåË°å‰∫ÜÔºåË∑ë‰∏ÄÂúàÂõûÂà∞Ëµ∑ÁÇπ„ÄÇÁù°ËßâÔºàepoll_waitÔºâÔºåÊúâ‰ªªÂä°Âè´ÈÜí‰Ω†ÔºàÂî§ÈÜí waitÔºâÔºå‰Ω†ÂèàÂºÄÂßãË∑ë‰∏ÄÂúà„ÄÇËæπË∑ëËæπÊé•Âçï„ÄÇ ÊÉ≥Ëøõ‰∏ÄÊ≠•‰∫ÜËß£ÁöÑÂêåÂ≠¶ÂèØ‰ª•Áúã‰∏ãÁü•‰πé‰∏äÂØπËØ•ÈóÆÈ¢òÁöÑËÆ®ËÆ∫ ÊÄªÁªìLooper ÂØπË±°Â∞ÅË£Ö‰∫ÜÊ∂àÊÅØÈòüÂàóÔºåLooper ÂØπË±°Ë¢´Â∞ÅË£ÖÂú® ThreadLocal ‰∏≠ÔºåÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºå‰∏çÂêåÁ∫øÁ®ã‰πãÈó¥ÁöÑ Looper Êó†Ê≥ïÂÖ±‰∫´„ÄÇHandler ÈÄöËøá‰∏é Looper ‰πãÈó¥ÁöÑÁªëÂÆöÊù•ÂÆûÁé∞‰∏éÊâßË°åÁ∫øÁ®ã‰πãÈó¥ÁöÑÁªëÂÆöÔºåhandler ÂèëÈÄÅÊ∂àÊÅØÊó∂‰ºöÂ∞Ü Message ÂØπË±°ËøΩÂä†Âà∞‰∏éÁ∫øÁ®ãÁõ∏ÂÖ≥ÁöÑÊ∂àÊÅØÈòüÂàó‰∏≠ÔºåÁÑ∂ÂêéÁî± Looper ÂõûË∞ÉÂÆÉÁöÑÂàÜÂèëÊ∂àÊÅØÊñπÊ≥ïÔºåÊ†πÊçÆÊÉÖÂÜµÂ§ÑÁêÜÊ∂àÊÅØ„ÄÇ ÊúÄÂêéÊàë‰ª¨Áúã‰∏ÄÂº†ÂÆåÊï¥ÁöÑÊµÅÁ®ãÂõæÔºàÂõæÁâáÂèÇËÄÉËá™Handler ÂºÇÊ≠•ÈÄö‰ø°Êú∫Âà∂ÂÖ®Èù¢Ëß£ÊûêÔºâÔºåÁ¨îËÄÖ‰øÆÊîπ‰∫ÜÂéüÂõæ‰∏≠ÁöÑ Handler dispatchMessage ÊñπÊ≥ïÊèèËø∞„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏éÂ≠¶‰π†ËµÑÊ∫êÊé®Ëçê ÁêÜËß£ Java ‰∏≠ÁöÑ ThreadLocal Ë∞àË∞à ThreadLocal Android ‰∏≠ Handler ÁöÑ‰ΩøÁî® Handler ÂºÇÊ≠•ÈÄö‰ø°Êú∫Âà∂ÂÖ®Èù¢Ëß£Êûê Ê∑±ÂÖ•Ê∫êÁ†ÅËß£Êûê Android ‰∏≠ÁöÑ Handler,Message,MessageQueue,Looper Êé¢Á¥¢ Android Â§ßÊùÄÂô®‚Äî‚Äî Handler „ÄäAndroid ÂºÄÂèëËâ∫ÊúØÊé¢Á¥¢„Äã „ÄäAndroid Ê∫êÁ†ÅËÆæËÆ°Ê®°ÂºèËß£Êûê‰∏éÂÆûÊàò„Äã Â¶ÇÊûúÊú¨Êñá‰∏≠Êúâ‰∏çÊ≠£Á°ÆÁöÑÁªìËÆ∫„ÄÅËØ¥Ê≥ïÊàñËÄÖË°®Ëø∞‰∏çÊ∏ÖÊô∞ÁöÑÂú∞ÊñπÔºåÊÅ≥ËØ∑Â§ßÂÆ∂ÊåáÂá∫ÔºåÂÖ±ÂêåÊé¢ËÆ®ÔºåÂÖ±ÂêåËøõÊ≠•ÔºåË∞¢Ë∞¢!]]></content>
      <categories>
        <category>ÂéüÁêÜÂàÜÊûê</category>
        <category>Android ËøõÈò∂</category>
      </categories>
      <tags>
        <tag>ÂéüÁêÜÂàÜÊûê</tag>
        <tag>Android ËøõÈò∂</tag>
      </tags>
  </entry>
</search>
